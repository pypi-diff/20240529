# Comparing `tmp/gdsfactory-7.9.3.tar.gz` & `tmp/gdsfactory-7.9.4.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "gdsfactory-7.9.3.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
+gzip compressed data, was "gdsfactory-7.9.4.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
```

## Comparing `gdsfactory-7.9.3.tar` & `gdsfactory-7.9.4.tar`

### file list

```diff
@@ -1,470 +1,469 @@
--rw-r--r--   0        0        0     1072 2023-12-22 02:20:33.392386 gdsfactory-7.9.3/LICENSE
--rw-r--r--   0        0        0     7957 2023-12-22 02:20:33.392386 gdsfactory-7.9.3/README.md
--rw-r--r--   0        0        0     3321 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/__init__.py
--rw-r--r--   0        0        0     1859 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/add_keepout.py
--rw-r--r--   0        0        0    12794 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/add_labels.py
--rw-r--r--   0        0        0     3682 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/add_loopback.py
--rw-r--r--   0        0        0     3524 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/add_padding.py
--rw-r--r--   0        0        0    18124 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/add_pins.py
--rw-r--r--   0        0        0    14682 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/add_ports.py
--rw-r--r--   0        0        0     3314 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/add_tapers.py
--rw-r--r--   0        0        0     3178 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/add_tapers_cross_section.py
--rw-r--r--   0        0        0     1772 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/add_termination.py
--rw-r--r--   0        0        0     1856 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/asserts.py
--rw-r--r--   0        0        0    12901 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/cell.py
--rw-r--r--   0        0        0     3723 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/cli.py
--rw-r--r--   0        0        0    99080 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/component.py
--rw-r--r--   0        0        0    25136 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/component_layout.py
--rw-r--r--   0        0        0    30995 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/component_reference.py
--rw-r--r--   0        0        0     1179 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/components/C.py
--rw-r--r--   0        0        0     1107 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/components/L.py
--rw-r--r--   0        0        0    21243 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/components/__init__.py
--rw-r--r--   0        0        0     5853 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/components/add_fiber_array_optical_south_electrical_north.py
--rw-r--r--   0        0        0     2572 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/components/add_fiducials.py
--rw-r--r--   0        0        0     9563 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/components/add_grating_couplers.py
--rw-r--r--   0        0        0     1853 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/components/add_trenches.py
--rw-r--r--   0        0        0     3665 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/components/align.py
--rw-r--r--   0        0        0     2538 2023-12-22 02:20:33.396386 gdsfactory-7.9.3/gdsfactory/components/array_component.py
--rw-r--r--   0        0        0     4584 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/array_with_fanout.py
--rw-r--r--   0        0        0     4319 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/array_with_via.py
--rw-r--r--   0        0        0     4073 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/awg.py
--rw-r--r--   0        0        0     1882 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/bbox.py
--rw-r--r--   0        0        0     2450 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/bend_circular.py
--rw-r--r--   0        0        0     2227 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/bend_circular_heater.py
--rw-r--r--   0        0        0     7170 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/bend_euler.py
--rw-r--r--   0        0        0     3555 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/bend_s.py
--rw-r--r--   0        0        0     4754 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/bezier.py
--rw-r--r--   0        0        0     1586 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cavity.py
--rw-r--r--   0        0        0     5756 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cdc.py
--rw-r--r--   0        0        0     2911 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cdsem_all.py
--rw-r--r--   0        0        0     1809 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cdsem_bend180.py
--rw-r--r--   0        0        0     1923 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cdsem_coupler.py
--rw-r--r--   0        0        0     1924 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cdsem_straight.py
--rw-r--r--   0        0        0     1560 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cdsem_straight_density.py
--rw-r--r--   0        0        0      878 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/circle.py
--rw-r--r--   0        0        0     5873 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coh_rx_dual_pol.py
--rw-r--r--   0        0        0     8911 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coh_rx_single_pol.py
--rw-r--r--   0        0        0     5005 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coh_tx_dual_pol.py
--rw-r--r--   0        0        0     6083 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coh_tx_single_pol.py
--rw-r--r--   0        0        0     2707 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/compass.py
--rw-r--r--   0        0        0     9898 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/component_lattice.py
--rw-r--r--   0        0        0    11731 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/component_lattice_generic.py
--rw-r--r--   0        0        0     7169 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/component_sequence.py
--rw-r--r--   0        0        0      810 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/copy_layers.py
--rw-r--r--   0        0        0     2771 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler.py
--rw-r--r--   0        0        0     1895 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler90.py
--rw-r--r--   0        0        0     1802 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler90bend.py
--rw-r--r--   0        0        0     4549 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler_adiabatic.py
--rw-r--r--   0        0        0     1813 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler_asymmetric.py
--rw-r--r--   0        0        0     4823 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler_bent.py
--rw-r--r--   0        0        0     4244 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler_broadband.py
--rw-r--r--   0        0        0     3970 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler_full.py
--rw-r--r--   0        0        0     5097 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler_ring.py
--rw-r--r--   0        0        0     1578 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler_straight.py
--rw-r--r--   0        0        0     1433 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler_straight_asymmetric.py
--rw-r--r--   0        0        0     2130 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/coupler_symmetric.py
--rw-r--r--   0        0        0     2177 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cross.py
--rw-r--r--   0        0        0    12341 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/crossing_waveguide.py
--rw-r--r--   0        0        0      500 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
--rw-r--r--   0        0        0     1014 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
--rw-r--r--   0        0        0    19749 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
--rw-r--r--   0        0        0    19751 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
--rw-r--r--   0        0        0    19749 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
--rw-r--r--   0        0        0    19751 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
--rw-r--r--   0        0        0    19775 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
--rw-r--r--   0        0        0     3143 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
--rw-r--r--   0        0        0     5867 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cutback_2x2.py
--rw-r--r--   0        0        0     6717 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cutback_bend.py
--rw-r--r--   0        0        0     4132 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cutback_component.py
--rw-r--r--   0        0        0     4476 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cutback_loss.py
--rw-r--r--   0        0        0     2676 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/cutback_splitter.py
--rw-r--r--   0        0        0     3104 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/dbr.py
--rw-r--r--   0        0        0     4364 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/dbr_tapered.py
--rw-r--r--   0        0        0     2414 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/delay_snake.py
--rw-r--r--   0        0        0     3176 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/delay_snake2.py
--rw-r--r--   0        0        0     3245 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/delay_snake3.py
--rw-r--r--   0        0        0     4315 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/delay_snake_sbend.py
--rw-r--r--   0        0        0     1537 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/dicing_lane.py
--rw-r--r--   0        0        0     4340 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/die.py
--rw-r--r--   0        0        0     2981 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/die_bbox.py
--rw-r--r--   0        0        0     2818 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/die_bbox_frame.py
--rw-r--r--   0        0        0     7496 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/disk.py
--rw-r--r--   0        0        0     6332 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/edge_coupler_array.py
--rw-r--r--   0        0        0     1188 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/ellipse.py
--rw-r--r--   0        0        0     1756 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/extend_ports_list.py
--rw-r--r--   0        0        0     7112 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/extension.py
--rw-r--r--   0        0        0      981 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/fiber.py
--rw-r--r--   0        0        0     1479 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/fiber_array.py
--rw-r--r--   0        0        0      921 2023-12-22 02:20:33.400386 gdsfactory-7.9.3/gdsfactory/components/fiducial_squares.py
--rwxr-xr-x   0        0        0    23952 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/fonts/OCR-A.ttf
--rw-r--r--   0        0        0     3092 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ge_detector_straight_si_contacts.py
--rw-r--r--   0        0        0     2458 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_array.py
--rw-r--r--   0        0        0     4531 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_dual_pol.py
--rw-r--r--   0        0        0     7310 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_elliptical.py
--rw-r--r--   0        0        0     7221 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
--rw-r--r--   0        0        0     4949 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_elliptical_lumerical.py
--rw-r--r--   0        0        0     4719 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_elliptical_trenches.py
--rw-r--r--   0        0        0     1747 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_functions.py
--rw-r--r--   0        0        0     7556 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_loss.py
--rw-r--r--   0        0        0     1818 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_loss_fiber_single.py
--rw-r--r--   0        0        0     4063 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_rectangular.py
--rw-r--r--   0        0        0     4691 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
--rw-r--r--   0        0        0     3860 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
--rw-r--r--   0        0        0     1608 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/grating_coupler_tree.py
--rw-r--r--   0        0        0     8732 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/greek_cross.py
--rw-r--r--   0        0        0     1019 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/hline.py
--rw-r--r--   0        0        0     3643 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/interdigital_capacitor.py
--rw-r--r--   0        0        0     3428 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/interdigital_capacitor_enclosed.py
--rw-r--r--   0        0        0     1799 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/litho_calipers.py
--rw-r--r--   0        0        0     1218 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/litho_ruler.py
--rw-r--r--   0        0        0     1278 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/litho_steps.py
--rw-r--r--   0        0        0      844 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/logo.py
--rw-r--r--   0        0        0     1679 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/loop_mirror.py
--rw-r--r--   0        0        0     4256 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mmi.py
--rw-r--r--   0        0        0     3400 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mmi1x2.py
--rw-r--r--   0        0        0     2471 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mmi1x2_with_sbend.py
--rw-r--r--   0        0        0     3267 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mmi2x2.py
--rw-r--r--   0        0        0     2926 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mmi2x2_with_sbend.py
--rw-r--r--   0        0        0     4423 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mmi_90degree_hybrid.py
--rw-r--r--   0        0        0     3293 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mode_converter.py
--rw-r--r--   0        0        0     8462 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mzi.py
--rw-r--r--   0        0        0     2464 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mzi_arm.py
--rw-r--r--   0        0        0     5822 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mzi_arms.py
--rw-r--r--   0        0        0    12188 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mzi_lattice.py
--rw-r--r--   0        0        0     4023 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mzi_pads_center.py
--rw-r--r--   0        0        0     6221 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mzit.py
--rw-r--r--   0        0        0     3485 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mzit_lattice.py
--rw-r--r--   0        0        0     5992 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/mzm.py
--rw-r--r--   0        0        0     3539 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/nxn.py
--rw-r--r--   0        0        0     1940 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/optimal_90deg.py
--rw-r--r--   0        0        0     3778 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/optimal_hairpin.py
--rw-r--r--   0        0        0     6131 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/optimal_step.py
--rw-r--r--   0        0        0     6289 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/pack_doe.py
--rw-r--r--   0        0        0     3833 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/pad.py
--rw-r--r--   0        0        0     1919 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/pad_gsg.py
--rw-r--r--   0        0        0     1159 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/pads_shorted.py
--rw-r--r--   0        0        0     3718 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/polarization_splitter_rotator.py
--rw-r--r--   0        0        0     1115 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ramp.py
--rw-r--r--   0        0        0     4069 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/rectangle.py
--rw-r--r--   0        0        0     2916 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/rectangle_with_slits.py
--rw-r--r--   0        0        0     1059 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/rectangular_ring.py
--rw-r--r--   0        0        0     1594 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/regular_polygon.py
--rw-r--r--   0        0        0     3276 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/resistance_meander.py
--rw-r--r--   0        0        0     2629 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/resistance_sheet.py
--rw-r--r--   0        0        0     1260 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring.py
--rw-r--r--   0        0        0     4142 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_crow.py
--rw-r--r--   0        0        0     5034 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_crow_couplers.py
--rw-r--r--   0        0        0     3561 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_double.py
--rw-r--r--   0        0        0     2782 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_double_bend_coupler.py
--rw-r--r--   0        0        0     5797 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_double_heater.py
--rw-r--r--   0        0        0     7616 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_double_pn.py
--rw-r--r--   0        0        0    11219 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_section_based.py
--rw-r--r--   0        0        0     4050 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_single.py
--rw-r--r--   0        0        0     1751 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_single_array.py
--rw-r--r--   0        0        0     6868 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_single_bend_coupler.py
--rw-r--r--   0        0        0     2781 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_single_dut.py
--rw-r--r--   0        0        0     5206 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_single_heater.py
--rw-r--r--   0        0        0     5382 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/ring_single_pn.py
--rw-r--r--   0        0        0     2290 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/seal_ring.py
--rw-r--r--   0        0        0     3745 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/snspd.py
--rw-r--r--   0        0        0     2047 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/spiral_double.py
--rw-r--r--   0        0        0     5846 2023-12-22 02:20:33.404386 gdsfactory-7.9.3/gdsfactory/components/spiral_external_io.py
--rw-r--r--   0        0        0    16567 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/spiral_heater.py
--rw-r--r--   0        0        0    11932 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/spiral_inner_io.py
--rw-r--r--   0        0        0     1742 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/splitter_chain.py
--rw-r--r--   0        0        0     5281 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/splitter_tree.py
--rw-r--r--   0        0        0     2045 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/straight.py
--rw-r--r--   0        0        0     1055 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/straight_array.py
--rw-r--r--   0        0        0     7408 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/straight_heater_doped_rib.py
--rw-r--r--   0        0        0     1922 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/straight_heater_doped_strip.py
--rw-r--r--   0        0        0     8216 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/straight_heater_meander.py
--rw-r--r--   0        0        0     8592 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/straight_heater_meander_doped.py
--rw-r--r--   0        0        0     9870 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/straight_heater_metal.py
--rw-r--r--   0        0        0     2704 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/straight_pin.py
--rw-r--r--   0        0        0     3950 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/straight_pin_slot.py
--rw-r--r--   0        0        0      656 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/straight_rib.py
--rw-r--r--   0        0        0      821 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/switch_tree.py
--rw-r--r--   0        0        0     7335 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/taper.py
--rw-r--r--   0        0        0     3653 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/taper_adiabatic.py
--rw-r--r--   0        0        0     3508 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/taper_cross_section.py
--rw-r--r--   0        0        0     1719 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/taper_from_csv.py
--rw-r--r--   0        0        0     1287 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/taper_parabolic.py
--rw-r--r--   0        0        0     1883 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/terminator.py
--rw-r--r--   0        0        0     3080 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/text.py
--rw-r--r--   0        0        0     4210 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/text_freetype.py
--rw-r--r--   0        0        0     3227 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/text_rectangular.py
--rw-r--r--   0        0        0     3897 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/text_rectangular_font.py
--rw-r--r--   0        0        0     2892 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/triangles.py
--rw-r--r--   0        0        0      969 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/verniers.py
--rw-r--r--   0        0        0     3052 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/version_stamp.py
--rw-r--r--   0        0        0     2413 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/via.py
--rw-r--r--   0        0        0     3034 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/via_corner.py
--rw-r--r--   0        0        0     5342 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/via_cutback.py
--rw-r--r--   0        0        0    12367 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/via_stack.py
--rw-r--r--   0        0        0     4707 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/via_stack_slot.py
--rw-r--r--   0        0        0     4941 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/via_stack_with_offset.py
--rw-r--r--   0        0        0     1324 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/wafer.py
--rw-r--r--   0        0        0     5371 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/wire.py
--rw-r--r--   0        0        0      978 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/components/wire_sbend.py
--rw-r--r--   0        0        0    11435 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/config.py
--rw-r--r--   0        0        0    38409 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/constants.py
--rw-r--r--   0        0        0    88076 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/cross_section.py
--rw-r--r--   0        0        0     2963 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/decorators.py
--rw-r--r--   0        0        0    11832 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/difftest.py
--rw-r--r--   0        0        0      668 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/difftest_git.py
--rw-r--r--   0        0        0     1029 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/events.py
--rw-r--r--   0        0        0      267 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/export/__init__.py
--rw-r--r--   0        0        0     3312 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/export/to_3d.py
--rw-r--r--   0        0        0     7531 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/export/to_gerber.py
--rw-r--r--   0        0        0     1908 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/export/to_np.py
--rw-r--r--   0        0        0     3095 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/export/to_stl.py
--rw-r--r--   0        0        0    11904 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/fill.py
--rw-r--r--   0        0        0     7780 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/font.py
--rw-r--r--   0        0        0    10384 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/functions.py
--rw-r--r--   0        0        0     1019 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/README.md
--rw-r--r--   0        0        0     2598 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/__init__.py
--rw-r--r--   0        0        0     1008 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/containers.py
--rw-r--r--   0        0        0      163 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/generic_tech.sh
--rw-r--r--   0        0        0     8246 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/get_klayout_pyxs.py
--rw-r--r--   0        0        0      161 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/README.md
--rw-r--r--   0        0        0     2281 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/d25/generic_tech.lyd25
--rw-r--r--   0        0        0      104 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/drc/Makefile
--rw-r--r--   0        0        0        0 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/drc/__init__.py
--rw-r--r--   0        0        0     2787 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/drc/errors.py
--rw-r--r--   0        0        0     6192 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/grain.xml
--rw-r--r--   0        0        0    10140 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/icon_128x128.png
--rw-r--r--   0        0        0     4248 2023-12-22 02:20:33.408386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/icon_64x64.png
--rw-r--r--   0        0        0    41092 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/layers.lyp
--rw-r--r--   0        0        0       27 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/.gitignore
--rw-r--r--   0        0        0      494 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/Makefile
--rw-r--r--   0        0        0     4064 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/README.md
--rw-r--r--   0        0        0     2421 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md
--rw-r--r--   0        0        0     9696 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc
--rw-r--r--   0        0        0    12379 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py
--rw-r--r--   0        0        0     7235 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs
--rw-r--r--   0        0        0     3446 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs
--rw-r--r--   0        0        0      479 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/devices_connections.lvs
--rw-r--r--   0        0        0      582 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs
--rw-r--r--   0        0        0      108 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_derivations.lvs
--rw-r--r--   0        0        0      186 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_connections.lvs
--rw-r--r--   0        0        0      398 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_derivations.lvs
--rw-r--r--   0        0        0      574 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs
--rw-r--r--   0        0        0     6034 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs
--rw-r--r--   0        0        0    10692 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/run_lvs.py
--rw-r--r--   0        0        0      477 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/testing/testcases/README.md
--rw-r--r--   0        0        0     4836 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py
--rw-r--r--   0        0        0      926 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice
--rw-r--r--   0        0        0      709 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
--rw-r--r--   0        0        0      538 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
--rw-r--r--   0        0        0        0 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/python/__init__.py
--rw-r--r--   0        0        0      114 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
--rw-r--r--   0        0        0     4312 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
--rw-r--r--   0        0        0     5851 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/tech.lyt
--rw-r--r--   0        0        0     4258 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/xsection/xsection_generic.pyxs
--rw-r--r--   0        0        0     4537 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/xsection/xsection_generic.xs
--rw-r--r--   0        0        0     4731 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/xsection/xsection_planarized.pyxs
--rw-r--r--   0        0        0     5508 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/xsection/xsection_planarized.xs
--rw-r--r--   0        0        0     1746 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/layer_map.py
--rw-r--r--   0        0        0    13834 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/layer_stack.py
--rw-r--r--   0        0        0    10772 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/layer_views.yaml
--rw-r--r--   0        0        0     3854 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/generic_tech/simulation_settings.py
--rw-r--r--   0        0        0      999 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/__init__.py
--rw-r--r--   0        0        0     4869 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/boolean.py
--rw-r--r--   0        0        0     3789 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/boolean_klayout.py
--rw-r--r--   0        0        0     1862 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/boolean_polygons.py
--rw-r--r--   0        0        0     4921 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/fill_klayout.py
--rw-r--r--   0        0        0     1655 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/fillet.py
--rw-r--r--   0        0        0     6614 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/functions.py
--rw-r--r--   0        0        0     2144 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/invert.py
--rw-r--r--   0        0        0     3692 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/layer_priority.py
--rw-r--r--   0        0        0     3066 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/manhattanize.py
--rw-r--r--   0        0        0     4184 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/maskprep.py
--rw-r--r--   0        0        0     1203 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/maskprep_flat.py
--rw-r--r--   0        0        0     3378 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/offset.py
--rw-r--r--   0        0        0     3810 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/outline.py
--rw-r--r--   0        0        0     2465 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/trim.py
--rw-r--r--   0        0        0     3080 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/union.py
--rw-r--r--   0        0        0     1783 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/geometry/xor_diff.py
--rw-r--r--   0        0        0     1329 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/get_factories.py
--rw-r--r--   0        0        0    23795 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/get_netlist.py
--rw-r--r--   0        0        0    14635 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/get_netlist_flat.py
--rw-r--r--   0        0        0    10626 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/grid.py
--rw-r--r--   0        0        0     5087 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/install.py
--rw-r--r--   0        0        0     1855 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/klive.py
--rw-r--r--   0        0        0      682 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/labels/__init__.py
--rw-r--r--   0        0        0     5014 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/labels/add_label_yaml.py
--rw-r--r--   0        0        0     3594 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/labels/ehva.py
--rw-r--r--   0        0        0     1915 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/labels/get_test_manifest.py
--rw-r--r--   0        0        0     3796 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/labels/merge_test_metadata.py
--rw-r--r--   0        0        0     4672 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/labels/siepic.py
--rw-r--r--   0        0        0     4894 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/labels/write_labels.py
--rw-r--r--   0        0        0     3938 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/labels/write_test_manifest.py
--rw-r--r--   0        0        0     5935 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/name.py
--rw-r--r--   0        0        0    12948 2023-12-22 02:20:33.412386 gdsfactory-7.9.3/gdsfactory/pack.py
--rw-r--r--   0        0        0    54971 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/path.py
--rw-r--r--   0        0        0    31694 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/pdk.py
--rw-r--r--   0        0        0     6216 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/picmodel.py
--rw-r--r--   0        0        0     5029 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/pixelate.py
--rw-r--r--   0        0        0      303 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/plugins/__init__.py
--rw-r--r--   0        0        0     4341 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/polygon.py
--rw-r--r--   0        0        0    33963 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/port.py
--rw-r--r--   0        0        0    37851 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/quickplotter.py
--rw-r--r--   0        0        0      726 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/read/__init__.py
--rw-r--r--   0        0        0     1714 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/read/from_dphox.py
--rw-r--r--   0        0        0     1263 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/read/from_gdspaths.py
--rw-r--r--   0        0        0     3253 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/read/from_np.py
--rw-r--r--   0        0        0     2606 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/read/from_phidl.py
--rw-r--r--   0        0        0     7094 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/read/from_updk.py
--rw-r--r--   0        0        0    37937 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/read/from_yaml.py
--rw-r--r--   0        0        0     5937 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/read/from_yaml_template.py
--rw-r--r--   0        0        0     6001 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/read/import_gds.py
--rw-r--r--   0        0        0     3369 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/read/labels.py
--rw-r--r--   0        0        0     3753 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/__init__.py
--rw-r--r--   0        0        0     3089 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/add_electrical_pads_shortest.py
--rw-r--r--   0        0        0     3545 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/add_electrical_pads_top.py
--rw-r--r--   0        0        0     3150 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/add_electrical_pads_top_dc.py
--rw-r--r--   0        0        0     8653 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/add_fiber_array.py
--rw-r--r--   0        0        0    10631 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/add_fiber_single.py
--rw-r--r--   0        0        0     9356 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/add_pads.py
--rw-r--r--   0        0        0    39737 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/all_angle.py
--rw-r--r--   0        0        0     3879 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/auto_taper.py
--rw-r--r--   0        0        0      981 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/factories.py
--rw-r--r--   0        0        0     4486 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/fanout.py
--rw-r--r--   0        0        0     2807 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/fanout2x2.py
--rw-r--r--   0        0        0    26633 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_bundle.py
--rw-r--r--   0        0        0     9523 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_bundle_corner.py
--rw-r--r--   0        0        0     7004 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_bundle_from_steps.py
--rw-r--r--   0        0        0    13296 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_bundle_from_waypoints.py
--rw-r--r--   0        0        0     5385 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_bundle_path_length_match.py
--rw-r--r--   0        0        0     2086 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_bundle_sbend.py
--rw-r--r--   0        0        0    17637 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_bundle_u.py
--rw-r--r--   0        0        0     1486 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_input_labels.py
--rw-r--r--   0        0        0    10586 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_route.py
--rw-r--r--   0        0        0    10827 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_route_astar.py
--rw-r--r--   0        0        0     6518 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_route_from_steps.py
--rw-r--r--   0        0        0     2998 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_route_sbend.py
--rw-r--r--   0        0        0     3337 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_routes_bend180.py
--rw-r--r--   0        0        0     2177 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/get_routes_straight.py
--rw-r--r--   0        0        0    35603 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/manhattan.py
--rw-r--r--   0        0        0    10037 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/path_length_matching.py
--rw-r--r--   0        0        0    24571 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/route_fiber_array.py
--rw-r--r--   0        0        0     8645 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/route_fiber_single.py
--rw-r--r--   0        0        0    18072 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/route_ports_to_side.py
--rw-r--r--   0        0        0     4341 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/route_quad.py
--rw-r--r--   0        0        0    14289 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/route_sharp.py
--rw-r--r--   0        0        0    10146 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/route_south.py
--rw-r--r--   0        0        0     5641 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/sort_ports.py
--rw-r--r--   0        0        0     2433 2023-12-22 02:20:33.416386 gdsfactory-7.9.3/gdsfactory/routing/utils.py
--rw-r--r--   0        0        0     5645 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/routing/validation.py
--rw-r--r--   0        0        0     2767 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/01_component_pcell.py
--rw-r--r--   0        0        0     1088 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/01_component_pcell_with_pins.py
--rw-r--r--   0        0        0      344 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/02_component_autoname.py
--rw-r--r--   0        0        0      886 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/03_move.py
--rw-r--r--   0        0        0      862 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/04_connect.py
--rw-r--r--   0        0        0      655 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/05_remove_layers.py
--rw-r--r--   0        0        0      925 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/06_remapping_layers.py
--rw-r--r--   0        0        0     1057 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/07_flattening_device.py
--rw-r--r--   0        0        0      475 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/08_group.py
--rw-r--r--   0        0        0     1673 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/11_component_layout.py
--rw-r--r--   0        0        0     2501 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/12_component_refs.py
--rw-r--r--   0        0        0     1013 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/13_component_netlist.py
--rw-r--r--   0        0        0     2537 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/14_component_connectivity.py
--rw-r--r--   0        0        0     1683 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/15_component_sequence1.py
--rw-r--r--   0        0        0     1891 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/16_component_sequence2.py
--rw-r--r--   0        0        0     1030 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/17_ports.py
--rw-r--r--   0        0        0      272 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/18_port_markers.py
--rw-r--r--   0        0        0      361 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/19_references.py
--rw-r--r--   0        0        0      561 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/20_components.py
--rw-r--r--   0        0        0      565 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/21_add_fiber_array.py
--rw-r--r--   0        0        0      550 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/22_add_fiber_single.py
--rw-r--r--   0        0        0      631 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/22_add_pads.py
--rw-r--r--   0        0        0      381 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/24_doe.py
--rw-r--r--   0        0        0      715 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/24_doe_2.py
--rw-r--r--   0        0        0      720 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/24_doe_3.py
--rw-r--r--   0        0        0      309 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/25_slot_cross_section.py
--rw-r--r--   0        0        0     1400 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/30_lidar.py
--rw-r--r--   0        0        0     1653 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/30_lidar_pcell.py
--rw-r--r--   0        0        0     1943 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/30_lidar_with_pads.py
--rw-r--r--   0        0        0     2209 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/40_routing_add_pads.py
--rw-r--r--   0        0        0        0 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/__init__.py
--rw-r--r--   0        0        0     1407 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing.py
--rw-r--r--   0        0        0      558 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
--rw-r--r--   0        0        0     6062 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
--rw-r--r--   0        0        0      444 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
--rw-r--r--   0        0        0      463 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
--rw-r--r--   0        0        0     1552 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
--rw-r--r--   0        0        0     1315 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
--rw-r--r--   0        0        0      602 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
--rw-r--r--   0        0        0     3317 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
--rw-r--r--   0        0        0     1484 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
--rw-r--r--   0        0        0     3045 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
--rw-r--r--   0        0        0     3788 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
--rw-r--r--   0        0        0     2416 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/big_device.py
--rw-r--r--   0        0        0       19 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/Makefile
--rw-r--r--   0        0        0        0 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/__init__.py
--rw-r--r--   0        0        0     1129 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/benchmark/fill_demo.py
--rw-r--r--   0        0        0      343 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
--rw-r--r--   0        0        0      627 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/circuits/mask.pic.yml
--rw-r--r--   0        0        0      597 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
--rw-r--r--   0        0        0      625 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
--rw-r--r--   0        0        0      598 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/circuits/pads.pic.yml
--rw-r--r--   0        0        0      286 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/circuits/rectangles.pic.yml
--rw-r--r--   0        0        0     2258 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/drc_errors.py
--rw-r--r--   0        0        0      158 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/layers_sky130.py
--rw-r--r--   0        0        0      363 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/layers_xsection.py
--rw-r--r--   0        0        0     2708 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/lvs.py
--rw-r--r--   0        0        0      602 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/demo/pcell.py
--rw-r--r--   0        0        0      752 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/fixme/manhattan.py
--rw-r--r--   0        0        0    28360 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/images/logo.png
--rw-r--r--   0        0        0     4174 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/netlists/mzi.yml
--rw-r--r--   0        0        0     5840 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/netlists/mzi_full.yml
--rw-r--r--   0        0        0        0 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/__init__.py
--rw-r--r--   0        0        0     3181 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/fab_c.py
--rw-r--r--   0        0        0      233 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/fab_c_to_updk.py
--rw-r--r--   0        0        0      471 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/fab_d/__init__.py
--rw-r--r--   0        0        0     1872 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/fab_d/phase_shifters.py
--rw-r--r--   0        0        0     1745 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c.py
--rw-r--r--   0        0        0       50 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
--rw-r--r--   0        0        0       93 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
--rw-r--r--   0        0        0       85 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
--rw-r--r--   0        0        0      139 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
--rw-r--r--   0        0        0       90 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
--rw-r--r--   0        0        0      126 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
--rw-r--r--   0        0        0       48 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
--rw-r--r--   0        0        0     1023 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
--rw-r--r--   0        0        0     2830 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
--rw-r--r--   0        0        0     3014 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
--rw-r--r--   0        0        0     1283 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
--rw-r--r--   0        0        0     2848 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
--rw-r--r--   0        0        0     1061 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
--rw-r--r--   0        0        0     1054 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
--rw-r--r--   0        0        0     2833 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
--rw-r--r--   0        0        0     9637 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
--rw-r--r--   0        0        0     3625 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
--rw-r--r--   0        0        0     3603 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
--rw-r--r--   0        0        0     9595 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
--rw-r--r--   0        0        0      840 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
--rw-r--r--   0        0        0     3426 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
--rw-r--r--   0        0        0     2342 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/sample_reticle.py
--rw-r--r--   0        0        0      417 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/snap_bends.py
--rw-r--r--   0        0        0      317 2023-12-22 02:20:33.420386 gdsfactory-7.9.3/gdsfactory/samples/snap_issue.py
--rw-r--r--   0        0        0     4691 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/serialization.py
--rw-r--r--   0        0        0     1962 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/show.py
--rw-r--r--   0        0        0      525 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/simulation/__init__.py
--rw-r--r--   0        0        0     2155 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/snap.py
--rw-r--r--   0        0        0     4230 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/symbols.py
--rw-r--r--   0        0        0      334 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/technology/__init__.py
--rw-r--r--   0        0        0      343 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/technology/color_utils.py
--rw-r--r--   0        0        0     6886 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/technology/klayout_tech.py
--rw-r--r--   0        0        0     2074 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/technology/layer_map.py
--rw-r--r--   0        0        0    18137 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/technology/layer_stack.py
--rw-r--r--   0        0        0    42550 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/technology/layer_views.py
--rw-r--r--   0        0        0     8680 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/technology/processes.py
--rw-r--r--   0        0        0     1598 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/technology/read_from_layers_info.py
--rw-r--r--   0        0        0      674 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/technology/xml_utils.py
--rw-r--r--   0        0        0     1425 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/technology/yaml_utils.py
--rw-r--r--   0        0        0     9739 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/typings.py
--rw-r--r--   0        0        0     6166 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/watch.py
--rw-r--r--   0        0        0     6730 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/gdsfactory/write_cells.py
--rw-r--r--   0        0        0     5442 2023-12-22 02:20:33.424386 gdsfactory-7.9.3/pyproject.toml
--rw-r--r--   0        0        0    10771 1970-01-01 00:00:00.000000 gdsfactory-7.9.3/PKG-INFO
+-rw-r--r--   0        0        0     1072 2024-01-01 14:16:51.405364 gdsfactory-7.9.4/LICENSE
+-rw-r--r--   0        0        0     7957 2024-01-01 14:16:51.405364 gdsfactory-7.9.4/README.md
+-rw-r--r--   0        0        0     3321 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/__init__.py
+-rw-r--r--   0        0        0     1859 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/add_keepout.py
+-rw-r--r--   0        0        0    12678 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/add_labels.py
+-rw-r--r--   0        0        0     3682 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/add_loopback.py
+-rw-r--r--   0        0        0     3524 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/add_padding.py
+-rw-r--r--   0        0        0    18436 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/add_pins.py
+-rw-r--r--   0        0        0    14680 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/add_ports.py
+-rw-r--r--   0        0        0     3314 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/add_tapers.py
+-rw-r--r--   0        0        0     3178 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/add_tapers_cross_section.py
+-rw-r--r--   0        0        0     1772 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/add_termination.py
+-rw-r--r--   0        0        0     1856 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/asserts.py
+-rw-r--r--   0        0        0    12861 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/cell.py
+-rw-r--r--   0        0        0     3723 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/cli.py
+-rw-r--r--   0        0        0   100672 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/component.py
+-rw-r--r--   0        0        0    28054 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/component_layout.py
+-rw-r--r--   0        0        0    30995 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/component_reference.py
+-rw-r--r--   0        0        0     1179 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/C.py
+-rw-r--r--   0        0        0     1107 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/L.py
+-rw-r--r--   0        0        0    21243 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/__init__.py
+-rw-r--r--   0        0        0     5900 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/add_fiber_array_optical_south_electrical_north.py
+-rw-r--r--   0        0        0     2572 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/add_fiducials.py
+-rw-r--r--   0        0        0     9563 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/add_grating_couplers.py
+-rw-r--r--   0        0        0     1853 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/add_trenches.py
+-rw-r--r--   0        0        0     3665 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/align.py
+-rw-r--r--   0        0        0     2538 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/array_component.py
+-rw-r--r--   0        0        0     4584 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/array_with_fanout.py
+-rw-r--r--   0        0        0     4319 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/array_with_via.py
+-rw-r--r--   0        0        0     4073 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/awg.py
+-rw-r--r--   0        0        0     1882 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/bbox.py
+-rw-r--r--   0        0        0     2482 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/bend_circular.py
+-rw-r--r--   0        0        0     2227 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/bend_circular_heater.py
+-rw-r--r--   0        0        0     7160 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/bend_euler.py
+-rw-r--r--   0        0        0     3555 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/bend_s.py
+-rw-r--r--   0        0        0     4761 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/bezier.py
+-rw-r--r--   0        0        0     1586 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/cavity.py
+-rw-r--r--   0        0        0     5756 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/cdc.py
+-rw-r--r--   0        0        0     2911 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/cdsem_all.py
+-rw-r--r--   0        0        0     1809 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/cdsem_bend180.py
+-rw-r--r--   0        0        0     1923 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/cdsem_coupler.py
+-rw-r--r--   0        0        0     1924 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/cdsem_straight.py
+-rw-r--r--   0        0        0     1560 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/cdsem_straight_density.py
+-rw-r--r--   0        0        0      878 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/circle.py
+-rw-r--r--   0        0        0     5873 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/coh_rx_dual_pol.py
+-rw-r--r--   0        0        0     8911 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/coh_rx_single_pol.py
+-rw-r--r--   0        0        0     5005 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/coh_tx_dual_pol.py
+-rw-r--r--   0        0        0     6083 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/coh_tx_single_pol.py
+-rw-r--r--   0        0        0     2707 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/compass.py
+-rw-r--r--   0        0        0     9898 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/component_lattice.py
+-rw-r--r--   0        0        0    11731 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/component_lattice_generic.py
+-rw-r--r--   0        0        0     7169 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/component_sequence.py
+-rw-r--r--   0        0        0      810 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/copy_layers.py
+-rw-r--r--   0        0        0     2771 2024-01-01 14:16:51.409364 gdsfactory-7.9.4/gdsfactory/components/coupler.py
+-rw-r--r--   0        0        0     1895 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/coupler90.py
+-rw-r--r--   0        0        0     1802 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/coupler90bend.py
+-rw-r--r--   0        0        0     4549 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/coupler_adiabatic.py
+-rw-r--r--   0        0        0     1813 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/coupler_asymmetric.py
+-rw-r--r--   0        0        0     4823 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/coupler_bent.py
+-rw-r--r--   0        0        0     4244 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/coupler_broadband.py
+-rw-r--r--   0        0        0     3970 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/coupler_full.py
+-rw-r--r--   0        0        0     5097 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/coupler_ring.py
+-rw-r--r--   0        0        0     1578 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/coupler_straight.py
+-rw-r--r--   0        0        0     1444 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/coupler_straight_asymmetric.py
+-rw-r--r--   0        0        0     2130 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/coupler_symmetric.py
+-rw-r--r--   0        0        0     2177 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/cross.py
+-rw-r--r--   0        0        0    12308 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/crossing_waveguide.py
+-rw-r--r--   0        0        0      500 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
+-rw-r--r--   0        0        0     1014 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
+-rw-r--r--   0        0        0    19749 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
+-rw-r--r--   0        0        0    19751 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
+-rw-r--r--   0        0        0    19749 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
+-rw-r--r--   0        0        0    19751 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
+-rw-r--r--   0        0        0    19775 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
+-rw-r--r--   0        0        0     3143 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
+-rw-r--r--   0        0        0     5867 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/cutback_2x2.py
+-rw-r--r--   0        0        0     6717 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/cutback_bend.py
+-rw-r--r--   0        0        0     4088 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/cutback_component.py
+-rw-r--r--   0        0        0     4476 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/cutback_loss.py
+-rw-r--r--   0        0        0     2676 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/cutback_splitter.py
+-rw-r--r--   0        0        0     3104 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/dbr.py
+-rw-r--r--   0        0        0     4446 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/dbr_tapered.py
+-rw-r--r--   0        0        0     2414 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/delay_snake.py
+-rw-r--r--   0        0        0     3176 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/delay_snake2.py
+-rw-r--r--   0        0        0     3245 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/delay_snake3.py
+-rw-r--r--   0        0        0     4315 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/delay_snake_sbend.py
+-rw-r--r--   0        0        0     1537 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/dicing_lane.py
+-rw-r--r--   0        0        0     4340 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/die.py
+-rw-r--r--   0        0        0     2981 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/die_bbox.py
+-rw-r--r--   0        0        0     2818 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/die_bbox_frame.py
+-rw-r--r--   0        0        0     7496 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/disk.py
+-rw-r--r--   0        0        0     6332 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/edge_coupler_array.py
+-rw-r--r--   0        0        0     1188 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/ellipse.py
+-rw-r--r--   0        0        0     1756 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/extend_ports_list.py
+-rw-r--r--   0        0        0     7132 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/extension.py
+-rw-r--r--   0        0        0      981 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/fiber.py
+-rw-r--r--   0        0        0     1479 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/fiber_array.py
+-rw-r--r--   0        0        0      921 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/fiducial_squares.py
+-rwxr-xr-x   0        0        0    23952 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/fonts/OCR-A.ttf
+-rw-r--r--   0        0        0     3092 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/ge_detector_straight_si_contacts.py
+-rw-r--r--   0        0        0     2458 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_array.py
+-rw-r--r--   0        0        0     4531 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_dual_pol.py
+-rw-r--r--   0        0        0     7883 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_elliptical.py
+-rw-r--r--   0        0        0     7221 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
+-rw-r--r--   0        0        0     4949 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_elliptical_lumerical.py
+-rw-r--r--   0        0        0     4719 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_elliptical_trenches.py
+-rw-r--r--   0        0        0     1747 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_functions.py
+-rw-r--r--   0        0        0     7556 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_loss.py
+-rw-r--r--   0        0        0     1818 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_loss_fiber_single.py
+-rw-r--r--   0        0        0     4063 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_rectangular.py
+-rw-r--r--   0        0        0     4691 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
+-rw-r--r--   0        0        0     3860 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
+-rw-r--r--   0        0        0     1608 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/grating_coupler_tree.py
+-rw-r--r--   0        0        0     8732 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/greek_cross.py
+-rw-r--r--   0        0        0     1019 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/hline.py
+-rw-r--r--   0        0        0     3643 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/interdigital_capacitor.py
+-rw-r--r--   0        0        0     3428 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/interdigital_capacitor_enclosed.py
+-rw-r--r--   0        0        0     1799 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/litho_calipers.py
+-rw-r--r--   0        0        0     1218 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/litho_ruler.py
+-rw-r--r--   0        0        0     1278 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/litho_steps.py
+-rw-r--r--   0        0        0      844 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/logo.py
+-rw-r--r--   0        0        0     1679 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/loop_mirror.py
+-rw-r--r--   0        0        0     4285 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/mmi.py
+-rw-r--r--   0        0        0     3429 2024-01-01 14:16:51.413364 gdsfactory-7.9.4/gdsfactory/components/mmi1x2.py
+-rw-r--r--   0        0        0     2471 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mmi1x2_with_sbend.py
+-rw-r--r--   0        0        0     3296 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mmi2x2.py
+-rw-r--r--   0        0        0     2926 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mmi2x2_with_sbend.py
+-rw-r--r--   0        0        0     4423 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mmi_90degree_hybrid.py
+-rw-r--r--   0        0        0     3293 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mode_converter.py
+-rw-r--r--   0        0        0     8462 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mzi.py
+-rw-r--r--   0        0        0     2464 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mzi_arm.py
+-rw-r--r--   0        0        0     5822 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mzi_arms.py
+-rw-r--r--   0        0        0    12188 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mzi_lattice.py
+-rw-r--r--   0        0        0     4023 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mzi_pads_center.py
+-rw-r--r--   0        0        0     6277 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mzit.py
+-rw-r--r--   0        0        0     3485 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mzit_lattice.py
+-rw-r--r--   0        0        0     5992 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/mzm.py
+-rw-r--r--   0        0        0     3539 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/nxn.py
+-rw-r--r--   0        0        0     1940 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/optimal_90deg.py
+-rw-r--r--   0        0        0     3778 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/optimal_hairpin.py
+-rw-r--r--   0        0        0     6131 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/optimal_step.py
+-rw-r--r--   0        0        0     6289 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/pack_doe.py
+-rw-r--r--   0        0        0     3914 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/pad.py
+-rw-r--r--   0        0        0     1919 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/pad_gsg.py
+-rw-r--r--   0        0        0     1159 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/pads_shorted.py
+-rw-r--r--   0        0        0     3718 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/polarization_splitter_rotator.py
+-rw-r--r--   0        0        0     1115 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ramp.py
+-rw-r--r--   0        0        0     4105 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/rectangle.py
+-rw-r--r--   0        0        0     2916 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/rectangle_with_slits.py
+-rw-r--r--   0        0        0     1059 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/rectangular_ring.py
+-rw-r--r--   0        0        0     1594 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/regular_polygon.py
+-rw-r--r--   0        0        0     3276 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/resistance_meander.py
+-rw-r--r--   0        0        0     2614 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/resistance_sheet.py
+-rw-r--r--   0        0        0     1260 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring.py
+-rw-r--r--   0        0        0     4142 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_crow.py
+-rw-r--r--   0        0        0     5034 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_crow_couplers.py
+-rw-r--r--   0        0        0     3561 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_double.py
+-rw-r--r--   0        0        0     2782 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_double_bend_coupler.py
+-rw-r--r--   0        0        0     5797 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_double_heater.py
+-rw-r--r--   0        0        0     7616 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_double_pn.py
+-rw-r--r--   0        0        0    10838 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_section_based.py
+-rw-r--r--   0        0        0     4050 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_single.py
+-rw-r--r--   0        0        0     1751 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_single_array.py
+-rw-r--r--   0        0        0     6868 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_single_bend_coupler.py
+-rw-r--r--   0        0        0     2740 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_single_dut.py
+-rw-r--r--   0        0        0     5206 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_single_heater.py
+-rw-r--r--   0        0        0     5382 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/ring_single_pn.py
+-rw-r--r--   0        0        0     2290 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/seal_ring.py
+-rw-r--r--   0        0        0     3745 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/snspd.py
+-rw-r--r--   0        0        0     2047 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/spiral_double.py
+-rw-r--r--   0        0        0     6090 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/spiral_external_io.py
+-rw-r--r--   0        0        0    16530 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/spiral_heater.py
+-rw-r--r--   0        0        0    11932 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/spiral_inner_io.py
+-rw-r--r--   0        0        0     1742 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/splitter_chain.py
+-rw-r--r--   0        0        0     5242 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/splitter_tree.py
+-rw-r--r--   0        0        0     2080 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/straight.py
+-rw-r--r--   0        0        0     1055 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/straight_array.py
+-rw-r--r--   0        0        0     7408 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/straight_heater_doped_rib.py
+-rw-r--r--   0        0        0     1922 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/straight_heater_doped_strip.py
+-rw-r--r--   0        0        0     8216 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/straight_heater_meander.py
+-rw-r--r--   0        0        0     8592 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/straight_heater_meander_doped.py
+-rw-r--r--   0        0        0     9864 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/straight_heater_metal.py
+-rw-r--r--   0        0        0     2704 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/straight_pin.py
+-rw-r--r--   0        0        0     3950 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/straight_pin_slot.py
+-rw-r--r--   0        0        0      656 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/straight_rib.py
+-rw-r--r--   0        0        0      821 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/switch_tree.py
+-rw-r--r--   0        0        0     7335 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/taper.py
+-rw-r--r--   0        0        0     3688 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/taper_adiabatic.py
+-rw-r--r--   0        0        0     3508 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/taper_cross_section.py
+-rw-r--r--   0        0        0     1719 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/taper_from_csv.py
+-rw-r--r--   0        0        0     1287 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/taper_parabolic.py
+-rw-r--r--   0        0        0     1883 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/terminator.py
+-rw-r--r--   0        0        0     3080 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/text.py
+-rw-r--r--   0        0        0     4210 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/text_freetype.py
+-rw-r--r--   0        0        0     3227 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/text_rectangular.py
+-rw-r--r--   0        0        0     3897 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/text_rectangular_font.py
+-rw-r--r--   0        0        0     2892 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/triangles.py
+-rw-r--r--   0        0        0      969 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/verniers.py
+-rw-r--r--   0        0        0     3052 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/version_stamp.py
+-rw-r--r--   0        0        0     2524 2024-01-01 14:16:51.417364 gdsfactory-7.9.4/gdsfactory/components/via.py
+-rw-r--r--   0        0        0     3034 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/components/via_corner.py
+-rw-r--r--   0        0        0     5342 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/components/via_cutback.py
+-rw-r--r--   0        0        0    10801 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/components/via_stack.py
+-rw-r--r--   0        0        0     4707 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/components/via_stack_slot.py
+-rw-r--r--   0        0        0     4941 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/components/via_stack_with_offset.py
+-rw-r--r--   0        0        0     1324 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/components/wafer.py
+-rw-r--r--   0        0        0     5371 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/components/wire.py
+-rw-r--r--   0        0        0      978 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/components/wire_sbend.py
+-rw-r--r--   0        0        0    12179 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/config.py
+-rw-r--r--   0        0        0    38409 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/constants.py
+-rw-r--r--   0        0        0    88511 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/cross_section.py
+-rw-r--r--   0        0        0     2963 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/decorators.py
+-rw-r--r--   0        0        0    11913 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/difftest.py
+-rw-r--r--   0        0        0      668 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/difftest_git.py
+-rw-r--r--   0        0        0     1029 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/events.py
+-rw-r--r--   0        0        0      267 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/export/__init__.py
+-rw-r--r--   0        0        0     3276 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/export/to_3d.py
+-rw-r--r--   0        0        0     7531 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/export/to_gerber.py
+-rw-r--r--   0        0        0     1908 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/export/to_np.py
+-rw-r--r--   0        0        0     3095 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/export/to_stl.py
+-rw-r--r--   0        0        0    11904 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/fill.py
+-rw-r--r--   0        0        0     7780 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/font.py
+-rw-r--r--   0        0        0    10387 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/functions.py
+-rw-r--r--   0        0        0     1019 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/README.md
+-rw-r--r--   0        0        0     2598 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/__init__.py
+-rw-r--r--   0        0        0     1008 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/containers.py
+-rw-r--r--   0        0        0      163 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/generic_tech.sh
+-rw-r--r--   0        0        0     8246 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/get_klayout_pyxs.py
+-rw-r--r--   0        0        0      161 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/README.md
+-rw-r--r--   0        0        0     2281 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/d25/generic_tech.lyd25
+-rw-r--r--   0        0        0      104 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/drc/Makefile
+-rw-r--r--   0        0        0        0 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/drc/__init__.py
+-rw-r--r--   0        0        0     2787 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/drc/errors.py
+-rw-r--r--   0        0        0     6192 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/grain.xml
+-rw-r--r--   0        0        0    10140 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/icon_128x128.png
+-rw-r--r--   0        0        0     4248 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/icon_64x64.png
+-rw-r--r--   0        0        0    41092 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/layers.lyp
+-rw-r--r--   0        0        0       27 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/.gitignore
+-rw-r--r--   0        0        0      494 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/Makefile
+-rw-r--r--   0        0        0     4064 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/README.md
+-rw-r--r--   0        0        0     2421 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md
+-rw-r--r--   0        0        0     9696 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc
+-rw-r--r--   0        0        0    12379 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py
+-rw-r--r--   0        0        0     7235 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs
+-rw-r--r--   0        0        0     3446 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs
+-rw-r--r--   0        0        0      479 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/devices_connections.lvs
+-rw-r--r--   0        0        0      582 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs
+-rw-r--r--   0        0        0      108 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_derivations.lvs
+-rw-r--r--   0        0        0      186 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_connections.lvs
+-rw-r--r--   0        0        0      398 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_derivations.lvs
+-rw-r--r--   0        0        0      574 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs
+-rw-r--r--   0        0        0     6034 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs
+-rw-r--r--   0        0        0    10692 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/run_lvs.py
+-rw-r--r--   0        0        0      477 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/testing/testcases/README.md
+-rw-r--r--   0        0        0     4836 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py
+-rw-r--r--   0        0        0      926 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice
+-rw-r--r--   0        0        0      709 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
+-rw-r--r--   0        0        0      538 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
+-rw-r--r--   0        0        0        0 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/python/__init__.py
+-rw-r--r--   0        0        0      114 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
+-rw-r--r--   0        0        0     4312 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
+-rw-r--r--   0        0        0     5851 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/tech.lyt
+-rw-r--r--   0        0        0     4258 2024-01-01 14:16:51.421364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/xsection/xsection_generic.pyxs
+-rw-r--r--   0        0        0     4537 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/xsection/xsection_generic.xs
+-rw-r--r--   0        0        0     4731 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/xsection/xsection_planarized.pyxs
+-rw-r--r--   0        0        0     5508 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/xsection/xsection_planarized.xs
+-rw-r--r--   0        0        0     1746 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/generic_tech/layer_map.py
+-rw-r--r--   0        0        0    13834 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/generic_tech/layer_stack.py
+-rw-r--r--   0        0        0    10772 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/generic_tech/layer_views.yaml
+-rw-r--r--   0        0        0     3854 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/generic_tech/simulation_settings.py
+-rw-r--r--   0        0        0      999 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/__init__.py
+-rw-r--r--   0        0        0     4869 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/boolean.py
+-rw-r--r--   0        0        0     3789 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/boolean_klayout.py
+-rw-r--r--   0        0        0     1862 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/boolean_polygons.py
+-rw-r--r--   0        0        0     4921 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/fill_klayout.py
+-rw-r--r--   0        0        0     1655 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/fillet.py
+-rw-r--r--   0        0        0     6614 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/functions.py
+-rw-r--r--   0        0        0     2144 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/invert.py
+-rw-r--r--   0        0        0     3692 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/layer_priority.py
+-rw-r--r--   0        0        0     3066 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/manhattanize.py
+-rw-r--r--   0        0        0     8780 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/maskprep.py
+-rw-r--r--   0        0        0     1203 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/maskprep_flat.py
+-rw-r--r--   0        0        0     3378 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/offset.py
+-rw-r--r--   0        0        0     3810 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/outline.py
+-rw-r--r--   0        0        0     2465 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/trim.py
+-rw-r--r--   0        0        0     3080 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/union.py
+-rw-r--r--   0        0        0     1783 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/geometry/xor_diff.py
+-rw-r--r--   0        0        0     1329 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/get_factories.py
+-rw-r--r--   0        0        0    23485 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/get_netlist.py
+-rw-r--r--   0        0        0    14635 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/get_netlist_flat.py
+-rw-r--r--   0        0        0    10694 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/grid.py
+-rw-r--r--   0        0        0     5087 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/install.py
+-rw-r--r--   0        0        0     1855 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/klive.py
+-rw-r--r--   0        0        0      567 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/labels/__init__.py
+-rw-r--r--   0        0        0     5227 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/labels/add_label_yaml.py
+-rw-r--r--   0        0        0     3301 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/labels/ehva.py
+-rw-r--r--   0        0        0     2552 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/labels/get_test_manifest.py
+-rw-r--r--   0        0        0     4718 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/labels/siepic.py
+-rw-r--r--   0        0        0     4894 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/labels/write_labels.py
+-rw-r--r--   0        0        0     3938 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/labels/write_test_manifest.py
+-rw-r--r--   0        0        0     5935 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/name.py
+-rw-r--r--   0        0        0    12895 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/pack.py
+-rw-r--r--   0        0        0    54947 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/path.py
+-rw-r--r--   0        0        0    31826 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/pdk.py
+-rw-r--r--   0        0        0     6182 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/picmodel.py
+-rw-r--r--   0        0        0     5029 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/pixelate.py
+-rw-r--r--   0        0        0      303 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/plugins/__init__.py
+-rw-r--r--   0        0        0     4341 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/polygon.py
+-rw-r--r--   0        0        0    34006 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/port.py
+-rw-r--r--   0        0        0    37851 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/quickplotter.py
+-rw-r--r--   0        0        0      726 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/read/__init__.py
+-rw-r--r--   0        0        0     1714 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/read/from_dphox.py
+-rw-r--r--   0        0        0     1263 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/read/from_gdspaths.py
+-rw-r--r--   0        0        0     3253 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/read/from_np.py
+-rw-r--r--   0        0        0     2606 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/read/from_phidl.py
+-rw-r--r--   0        0        0     7094 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/read/from_updk.py
+-rw-r--r--   0        0        0    37894 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/read/from_yaml.py
+-rw-r--r--   0        0        0     5937 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/read/from_yaml_template.py
+-rw-r--r--   0        0        0     6445 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/read/import_gds.py
+-rw-r--r--   0        0        0     3369 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/read/labels.py
+-rw-r--r--   0        0        0     3753 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/routing/__init__.py
+-rw-r--r--   0        0        0     3069 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/routing/add_electrical_pads_shortest.py
+-rw-r--r--   0        0        0     3545 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/routing/add_electrical_pads_top.py
+-rw-r--r--   0        0        0     3150 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/routing/add_electrical_pads_top_dc.py
+-rw-r--r--   0        0        0     8549 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/routing/add_fiber_array.py
+-rw-r--r--   0        0        0    10572 2024-01-01 14:16:51.425364 gdsfactory-7.9.4/gdsfactory/routing/add_fiber_single.py
+-rw-r--r--   0        0        0     9356 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/add_pads.py
+-rw-r--r--   0        0        0    39737 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/all_angle.py
+-rw-r--r--   0        0        0     3879 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/auto_taper.py
+-rw-r--r--   0        0        0      981 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/factories.py
+-rw-r--r--   0        0        0     4486 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/fanout.py
+-rw-r--r--   0        0        0     2807 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/fanout2x2.py
+-rw-r--r--   0        0        0    26592 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_bundle.py
+-rw-r--r--   0        0        0     9523 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_bundle_corner.py
+-rw-r--r--   0        0        0     7004 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_bundle_from_steps.py
+-rw-r--r--   0        0        0    13212 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_bundle_from_waypoints.py
+-rw-r--r--   0        0        0     5385 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_bundle_path_length_match.py
+-rw-r--r--   0        0        0     2086 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_bundle_sbend.py
+-rw-r--r--   0        0        0    17637 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_bundle_u.py
+-rw-r--r--   0        0        0     1486 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_input_labels.py
+-rw-r--r--   0        0        0    10502 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_route.py
+-rw-r--r--   0        0        0    10827 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_route_astar.py
+-rw-r--r--   0        0        0     6492 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_route_from_steps.py
+-rw-r--r--   0        0        0     2998 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_route_sbend.py
+-rw-r--r--   0        0        0     3337 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_routes_bend180.py
+-rw-r--r--   0        0        0     2177 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/get_routes_straight.py
+-rw-r--r--   0        0        0    35603 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/manhattan.py
+-rw-r--r--   0        0        0    10037 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/path_length_matching.py
+-rw-r--r--   0        0        0    24571 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/route_fiber_array.py
+-rw-r--r--   0        0        0     8645 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/route_fiber_single.py
+-rw-r--r--   0        0        0    18072 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/route_ports_to_side.py
+-rw-r--r--   0        0        0     4341 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/route_quad.py
+-rw-r--r--   0        0        0    14289 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/route_sharp.py
+-rw-r--r--   0        0        0    10146 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/route_south.py
+-rw-r--r--   0        0        0     5641 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/sort_ports.py
+-rw-r--r--   0        0        0     2433 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/utils.py
+-rw-r--r--   0        0        0     5645 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/routing/validation.py
+-rw-r--r--   0        0        0     2767 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/01_component_pcell.py
+-rw-r--r--   0        0        0     1088 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/01_component_pcell_with_pins.py
+-rw-r--r--   0        0        0      344 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/02_component_autoname.py
+-rw-r--r--   0        0        0      886 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/03_move.py
+-rw-r--r--   0        0        0      862 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/04_connect.py
+-rw-r--r--   0        0        0      655 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/05_remove_layers.py
+-rw-r--r--   0        0        0      925 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/06_remapping_layers.py
+-rw-r--r--   0        0        0     1057 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/07_flattening_device.py
+-rw-r--r--   0        0        0      475 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/08_group.py
+-rw-r--r--   0        0        0     1673 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/11_component_layout.py
+-rw-r--r--   0        0        0     2501 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/12_component_refs.py
+-rw-r--r--   0        0        0     1013 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/13_component_netlist.py
+-rw-r--r--   0        0        0     2537 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/14_component_connectivity.py
+-rw-r--r--   0        0        0     1683 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/15_component_sequence1.py
+-rw-r--r--   0        0        0     1891 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/16_component_sequence2.py
+-rw-r--r--   0        0        0     1030 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/17_ports.py
+-rw-r--r--   0        0        0      272 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/18_port_markers.py
+-rw-r--r--   0        0        0      361 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/19_references.py
+-rw-r--r--   0        0        0      561 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/20_components.py
+-rw-r--r--   0        0        0      565 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/21_add_fiber_array.py
+-rw-r--r--   0        0        0      550 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/22_add_fiber_single.py
+-rw-r--r--   0        0        0      631 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/22_add_pads.py
+-rw-r--r--   0        0        0      381 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/24_doe.py
+-rw-r--r--   0        0        0      715 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/24_doe_2.py
+-rw-r--r--   0        0        0      720 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/24_doe_3.py
+-rw-r--r--   0        0        0      309 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/25_slot_cross_section.py
+-rw-r--r--   0        0        0     1400 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/30_lidar.py
+-rw-r--r--   0        0        0     1653 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/30_lidar_pcell.py
+-rw-r--r--   0        0        0     1943 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/30_lidar_with_pads.py
+-rw-r--r--   0        0        0     2209 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/40_routing_add_pads.py
+-rw-r--r--   0        0        0        0 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/__init__.py
+-rw-r--r--   0        0        0     1407 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing.py
+-rw-r--r--   0        0        0      558 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
+-rw-r--r--   0        0        0     6062 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
+-rw-r--r--   0        0        0      444 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
+-rw-r--r--   0        0        0      463 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
+-rw-r--r--   0        0        0     1552 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
+-rw-r--r--   0        0        0     1315 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
+-rw-r--r--   0        0        0      602 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
+-rw-r--r--   0        0        0     3317 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
+-rw-r--r--   0        0        0     1484 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
+-rw-r--r--   0        0        0     3045 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
+-rw-r--r--   0        0        0     3788 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
+-rw-r--r--   0        0        0     2416 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/big_device.py
+-rw-r--r--   0        0        0       19 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/demo/Makefile
+-rw-r--r--   0        0        0        0 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/demo/__init__.py
+-rw-r--r--   0        0        0     1129 2024-01-01 14:16:51.429364 gdsfactory-7.9.4/gdsfactory/samples/demo/benchmark/fill_demo.py
+-rw-r--r--   0        0        0      343 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
+-rw-r--r--   0        0        0      627 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/demo/circuits/mask.pic.yml
+-rw-r--r--   0        0        0      597 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
+-rw-r--r--   0        0        0      625 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
+-rw-r--r--   0        0        0      598 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/demo/circuits/pads.pic.yml
+-rw-r--r--   0        0        0      286 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/demo/circuits/rectangles.pic.yml
+-rw-r--r--   0        0        0     2258 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/demo/drc_errors.py
+-rw-r--r--   0        0        0      158 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/demo/layers_sky130.py
+-rw-r--r--   0        0        0      363 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/demo/layers_xsection.py
+-rw-r--r--   0        0        0     2708 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/demo/lvs.py
+-rw-r--r--   0        0        0      602 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/demo/pcell.py
+-rw-r--r--   0        0        0      752 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/fixme/manhattan.py
+-rw-r--r--   0        0        0    28360 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/images/logo.png
+-rw-r--r--   0        0        0     4174 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/netlists/mzi.yml
+-rw-r--r--   0        0        0     5840 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/netlists/mzi_full.yml
+-rw-r--r--   0        0        0        0 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/__init__.py
+-rw-r--r--   0        0        0     3181 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/fab_c.py
+-rw-r--r--   0        0        0      233 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/fab_c_to_updk.py
+-rw-r--r--   0        0        0      471 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/fab_d/__init__.py
+-rw-r--r--   0        0        0     1872 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/fab_d/phase_shifters.py
+-rw-r--r--   0        0        0     1745 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c.py
+-rw-r--r--   0        0        0       50 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
+-rw-r--r--   0        0        0       93 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
+-rw-r--r--   0        0        0       85 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
+-rw-r--r--   0        0        0      139 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
+-rw-r--r--   0        0        0       90 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
+-rw-r--r--   0        0        0      126 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
+-rw-r--r--   0        0        0       48 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
+-rw-r--r--   0        0        0     1023 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
+-rw-r--r--   0        0        0     1599 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
+-rw-r--r--   0        0        0     1578 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
+-rw-r--r--   0        0        0     1283 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
+-rw-r--r--   0        0        0     1549 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
+-rw-r--r--   0        0        0     1061 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
+-rw-r--r--   0        0        0     1054 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
+-rw-r--r--   0        0        0     1551 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
+-rw-r--r--   0        0        0     4690 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
+-rw-r--r--   0        0        0     3625 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
+-rw-r--r--   0        0        0     3603 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
+-rw-r--r--   0        0        0     4671 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
+-rw-r--r--   0        0        0      840 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
+-rw-r--r--   0        0        0     1439 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
+-rw-r--r--   0        0        0     2342 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/sample_reticle.py
+-rw-r--r--   0        0        0      417 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/snap_bends.py
+-rw-r--r--   0        0        0      317 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/samples/snap_issue.py
+-rw-r--r--   0        0        0     5632 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/serialization.py
+-rw-r--r--   0        0        0     1962 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/show.py
+-rw-r--r--   0        0        0      525 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/simulation/__init__.py
+-rw-r--r--   0        0        0     2155 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/snap.py
+-rw-r--r--   0        0        0     4212 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/symbols.py
+-rw-r--r--   0        0        0      334 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/technology/__init__.py
+-rw-r--r--   0        0        0      343 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/technology/color_utils.py
+-rw-r--r--   0        0        0     6886 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/technology/klayout_tech.py
+-rw-r--r--   0        0        0     2074 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/technology/layer_map.py
+-rw-r--r--   0        0        0    18137 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/technology/layer_stack.py
+-rw-r--r--   0        0        0    42552 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/technology/layer_views.py
+-rw-r--r--   0        0        0     8680 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/technology/processes.py
+-rw-r--r--   0        0        0     1598 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/technology/read_from_layers_info.py
+-rw-r--r--   0        0        0      674 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/technology/xml_utils.py
+-rw-r--r--   0        0        0     1425 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/technology/yaml_utils.py
+-rw-r--r--   0        0        0     9739 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/typings.py
+-rw-r--r--   0        0        0     6166 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/watch.py
+-rw-r--r--   0        0        0     6730 2024-01-01 14:16:51.433364 gdsfactory-7.9.4/gdsfactory/write_cells.py
+-rw-r--r--   0        0        0     5440 2024-01-01 14:16:51.437364 gdsfactory-7.9.4/pyproject.toml
+-rw-r--r--   0        0        0    10771 1970-01-01 00:00:00.000000 gdsfactory-7.9.4/PKG-INFO
```

### Comparing `gdsfactory-7.9.3/LICENSE` & `gdsfactory-7.9.4/LICENSE`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/README.md` & `gdsfactory-7.9.4/README.md`

 * *Files 0% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-# gdsfactory 7.9.3
+# gdsfactory 7.9.4
 
 [![docs](https://github.com/gdsfactory/gdsfactory/actions/workflows/pages.yml/badge.svg)](https://gdsfactory.github.io/gdsfactory/)
 [![PyPI](https://img.shields.io/pypi/v/gdsfactory)](https://pypi.org/project/gdsfactory/)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/gdsfactory.svg)](https://anaconda.org/conda-forge/gdsfactory)
 [![Dockerhub](https://img.shields.io/docker/pulls/joamatab/gdsfactory)](https://hub.docker.com/r/joamatab/gdsfactory)
 [![PyPI Python](https://img.shields.io/pypi/pyversions/gdsfactory.svg)](https://pypi.python.org/pypi/gdsfactory)
 [![Downloads](https://static.pepy.tech/badge/gdsfactory)](https://pepy.tech/project/gdsfactory)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/__init__.py` & `gdsfactory-7.9.4/gdsfactory/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/add_keepout.py` & `gdsfactory-7.9.4/gdsfactory/add_keepout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/add_labels.py` & `gdsfactory-7.9.4/gdsfactory/add_labels.py`

 * *Files 1% similar despite different names*

```diff
@@ -54,25 +54,25 @@
         port: to label.
         gc: grating coupler component or reference.
         gc_index: grating_coupler index, which grating_coupler we are labelling.
         component_name: optional name.
         component_prefix: component prefix.
         prefix: prefix to add to the label.
     """
-    polarization = gc.info.get("polarization") or gc.metadata_child.get("polarization")
-    wavelength = gc.info.get("wavelength") or gc.metadata_child.get("wavelength")
+    polarization = gc.info.polarization
+    wavelength = gc.info.wavelength
 
     if polarization not in ["te", "tm"]:
         raise ValueError(f"polarization {polarization!r} needs to be [te, tm]")
     if not isinstance(wavelength, int | float) or not 0.5 < wavelength < 5.0:
         raise ValueError(
             f"{wavelength} needs to be > 0.5um and < 5um. Make sure it's in um"
         )
 
-    component_name = component_name or port.parent.metadata_child.get("name")
+    component_name = component_name or port.parent.name
 
     text = f"{prefix}_{polarization}_{int(wavelength*1e3)}_({component_prefix}{component_name}){suffix}"
     if isinstance(gc_index, int):
         text += f"_{gc_index}_{port.name}"
     else:
         text = f"_{port.name}"
```

### Comparing `gdsfactory-7.9.3/gdsfactory/add_loopback.py` & `gdsfactory-7.9.4/gdsfactory/add_loopback.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/add_padding.py` & `gdsfactory-7.9.4/gdsfactory/add_padding.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/add_pins.py` & `gdsfactory-7.9.4/gdsfactory/add_pins.py`

 * *Files 1% similar despite different names*

```diff
@@ -17,14 +17,17 @@
 from typing import TYPE_CHECKING
 
 import gdstk
 import numpy as np
 from numpy import ndarray
 from omegaconf import OmegaConf
 
+from gdsfactory.cell import container
+from gdsfactory.port import select_ports_electrical, select_ports_optical
+
 if TYPE_CHECKING:
     from gdsfactory.component import Component
     from gdsfactory.component_reference import ComponentReference
     from gdsfactory.port import Port
 
 Layer = tuple[int, int]
 Layers = tuple[Layer, ...]
@@ -522,14 +525,18 @@
         else reference.get_ports_list()
     )
     for port in ports:
         function(component=component, port=port, **kwargs)
     return component
 
 
+add_pins_optical = partial(add_pins, select_ports=select_ports_optical)
+add_pins_electrical = partial(add_pins, select_ports=select_ports_electrical)
+add_pins_container = partial(container, function=add_pins)
+
 add_pins_triangle = partial(add_pins, function=add_pin_triangle)
 add_pins_center = partial(add_pins, function=add_pin_rectangle)
 add_pin_inside1nm = partial(
     add_pin_rectangle_inside, pin_length=1 * nm, layer_label=None
 )
 add_pin_inside2um = partial(add_pin_rectangle_inside, pin_length=2, layer_label=None)
 add_pins_inside1nm = partial(add_pins, function=add_pin_inside1nm)
@@ -548,15 +555,15 @@
         reference: ComponentReference.
         layer_label: layer spec.
     """
     from gdsfactory.pdk import get_layer
 
     layer_label = get_layer(layer_label)
 
-    settings_dict = OmegaConf.to_container(reference.settings.full)
+    settings_dict = OmegaConf.to_container(reference.settings)
     settings_string = f"settings={json.dumps(settings_dict)}"
     if len(settings_string) > 1024:
         raise ValueError(f"label > 1024 characters: {settings_string}")
     component.add_label(
         position=reference.center, text=settings_string, layer=layer_label
     )
 
@@ -620,11 +627,11 @@
     # c.show(show_ports=True)
     # c = gf.components.straight(length=2)
     # c.show(show_ports_suborts=True)
     # p1 = len(c1.get_polygons())
     # p2 = len(c2.get_polygons())
     # assert p2 == p1 + 2
     # c1 = gf.components.straight_heater_metal(length=2)
-    c = gf.components.straight(decorator=add_pins)
+    c = gf.components.straight()
+    c2 = add_pins_container(component=c)
     # cc.show(show_ports=False)
-    c.show(show_subports=True)
-    c.show(show_ports=True)
+    c2.show(show_ports=False)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/add_ports.py` & `gdsfactory-7.9.4/gdsfactory/add_ports.py`

 * *Files 0% similar despite different names*

```diff
@@ -10,15 +10,15 @@
 from gdsfactory.port import Port, read_port_markers, sort_ports_clockwise
 from gdsfactory.snap import snap_to_grid
 from gdsfactory.typings import LayerSpec
 
 
 def add_ports_from_markers_square(
     component: Component,
-    pin_layer: LayerSpec = "DEVREC",
+    pin_layer: LayerSpec = "PORT",
     port_layer: LayerSpec | None = None,
     orientation: int | None = 90,
     min_pin_area_um2: float = 0,
     max_pin_area_um2: float = 150 * 150,
     pin_extra_width: float = 0.0,
     port_names: tuple[str, ...] | None = None,
     port_name_prefix: str | None = None,
```

### Comparing `gdsfactory-7.9.3/gdsfactory/add_tapers.py` & `gdsfactory-7.9.4/gdsfactory/add_tapers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/add_tapers_cross_section.py` & `gdsfactory-7.9.4/gdsfactory/add_tapers_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/add_termination.py` & `gdsfactory-7.9.4/gdsfactory/add_termination.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/asserts.py` & `gdsfactory-7.9.4/gdsfactory/asserts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/cell.py` & `gdsfactory-7.9.4/gdsfactory/cell.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,23 +1,25 @@
 """Cell decorator for functions that return a Component."""
 from __future__ import annotations
 
 import functools
 import hashlib
 import inspect
+import warnings
 from collections.abc import Callable
 from functools import partial
-from typing import Any, TypeVar, overload
+from typing import TypeVar, overload
 
-from pydantic import BaseModel, validate_call
+from pydantic import validate_call
 
 from gdsfactory.component import Component, name_counters
+from gdsfactory.component_layout import CellSettings
 from gdsfactory.config import CONF
 from gdsfactory.name import clean_name, get_name_short
-from gdsfactory.serialization import clean_dict, clean_value_name
+from gdsfactory.serialization import clean_value_name
 
 CACHE: dict[str, Component] = {}
 CACHE_IDS = set()
 
 INFO_VERSION = 2
 
 _F = TypeVar("_F", bound=Callable)
@@ -49,29 +51,14 @@
 
 
 def print_cache() -> None:
     for k in CACHE:
         print(k)
 
 
-class Settings(BaseModel):
-    name: str
-    function_name: str | None = None
-    module: str | None = None
-
-    info: dict[str, Any] = {}  # derived properties (length, resistance)
-    info_version: int = INFO_VERSION
-
-    full: dict[str, Any] = {}
-    changed: dict[str, Any] = {}
-    default: dict[str, Any] = {}
-
-    child: dict[str, Any] | None = None
-
-
 # Type signature when calling as a decorator on a function
 @overload
 def cell(func: _F) -> _F:
     ...
 
 
 # Type signature when calling the decorator itself (i.e., decorator factory)
@@ -163,17 +150,27 @@
     @functools.wraps(func)
     def wrapper(*args, **kwargs) -> Component:
         nonlocal ports_not_manhattan, ports_off_grid, max_name_length
         from gdsfactory.pdk import get_active_pdk
 
         active_pdk = get_active_pdk()
 
-        info = kwargs.pop("info", {})  # TODO: remove info
-        name = _name = kwargs.pop("name", None)  # TODO: remove name
-        prefix = kwargs.pop("prefix", func.__name__)  # TODO: remove prefix
+        info = kwargs.pop("info", {})
+        name = _name = kwargs.pop("name", None)
+        prefix = kwargs.pop("prefix", None)
+
+        if name:
+            warnings.warn("name is deprecated and will be removed soon.")
+        if prefix:
+            warnings.warn("prefix is deprecated and will be removed soon.")
+        if info:
+            warnings.warn("info is deprecated and will be removed soon.")
+
+        prefix = prefix or func.__name__
+
         sig = inspect.signature(func)
         args_as_kwargs = dict(zip(sig.parameters.keys(), args))
         args_as_kwargs.update(kwargs)
 
         if max_name_length is None:
             max_name_length = CONF.max_name_length
         if ports_off_grid is None:
@@ -242,14 +239,17 @@
 
         name = get_name_short(name, max_name_length=max_name_length)
         decorator = kwargs.pop("decorator", default_decorator)
         # if no decorator is specified, but there is one specified for the active PDK, use the PDK's default decorator
         if decorator is None and active_pdk.default_decorator is not None:
             decorator = active_pdk.default_decorator
 
+        if decorator:
+            warnings.warn("decorator is deprecated and will be removed soon.")
+
         if name in CACHE:
             # print(f"CACHE LOAD {name} {func.__name__}({named_args_string})")
             return CACHE[name]
 
         # print(f"BUILD {name} {func.__name__}({named_args_string})")
         if not callable(func):
             raise ValueError(
@@ -276,57 +276,50 @@
 
         if not isinstance(component, Component):
             raise CellReturnTypeError(
                 f"function {func.__name__!r} return type = {type(component)}",
                 "make sure that functions with @cell decorator return a Component",
             )
 
-        metadata_child = None
-        if get_child_name and _name is None:
-            if component.child is None:
+        if get_child_name:
+            if not component.child:
                 raise ValueError(
-                    f"{name}: get_child_name was defined, but component has no child! Be sure to assign the component a child attribute."
+                    f"component {component.name} does not have a child component. "
+                    "Make sure you use component_new.copy_child_info(component)"
                 )
-            metadata_child = dict(component.child.settings)
-            component_name = f"{metadata_child.get('name')}_{name}"
+            child_name = component.child.function_name
+            component_name = f"{child_name}_{name}"
             component_name = get_name_short(
                 component_name, max_name_length=max_name_length
             )
-            # if cache and component_name in CACHE:
-            # return CACHE[component_name]
         else:
             component_name = name
 
+        for k, v in dict(info).items():
+            component.info[k] = v
+
         if autoname:
             component.rename(component_name, max_name_length=max_name_length)
         if get_child_name:
             CACHE[name] = component
 
-        info = info or {}
-        component.info.update(**info)
         if add_settings:
-            component.settings = Settings(
-                name=component_name,
-                function_name=func.__name__,
-                module=func.__module__,
-                changed=clean_dict(changed),
-                default=clean_dict(default),
-                full=clean_dict(full),
-                info=component.info,
-            )
+            component.settings = CellSettings(**full)
+            component.function_name = func.__name__
+            component.module = func.__module__
             component.__doc__ = func.__doc__
 
         if decorator:
             if not callable(decorator):
                 raise ValueError(f"decorator = {type(decorator)} needs to be callable")
             component_new = decorator(component)
             component = component_new or component
             CACHE[component_name] = component
 
-        component.lock()
+        component._locked = True
         CACHE_IDS.add(id(component))
         return component
 
     return (
         wrapper
         if func is not None
         else partial(
@@ -364,20 +357,29 @@
 
     """
     import gdsfactory as gf
 
     component = gf.get_component(component)
     c = Component()
     cref = c << component
+    c.add_ports(cref.ports)
     function(c, **kwargs)
-    c.ports = cref.ports
     c.copy_child_info(component)
     return c
 
 
 if __name__ == "__main__":
+    from functools import partial
+
     import gdsfactory as gf
 
-    c = gf.components.straight(info={"simulation": "eme"}, name="hi")
-    print(c.name)
-    # print(c.info["simulation"])
+    c = partial(gf.components.mzi, decorator=gf.add_padding)
+    c = gf.routing.add_fiber_array(c)
     c.show()
+
+    # c = gf.components.straight(info={"simulation": "eme"}, name="hi")
+    # c = gf.components.straight()
+    # c = gf.Component()
+    # print(type(c.info))
+    # print(c.name)
+    # print(c.info["simulation"])
+    # c.show()
```

### Comparing `gdsfactory-7.9.3/gdsfactory/cli.py` & `gdsfactory-7.9.4/gdsfactory/cli.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/component.py` & `gdsfactory-7.9.4/gdsfactory/component.py`

 * *Files 1% similar despite different names*

```diff
@@ -31,6163 +31,6262 @@
 000001e0: 7320 6e70 0a69 6d70 6f72 7420 7961 6d6c  s np.import yaml
 000001f0: 0a66 726f 6d20 6f6d 6567 6163 6f6e 6620  .from omegaconf 
 00000200: 696d 706f 7274 2044 6963 7443 6f6e 6669  import DictConfi
 00000210: 670a 0a66 726f 6d20 6764 7366 6163 746f  g..from gdsfacto
 00000220: 7279 2069 6d70 6f72 7420 736e 6170 0a66  ry import snap.f
 00000230: 726f 6d20 6764 7366 6163 746f 7279 2e63  rom gdsfactory.c
 00000240: 6f6d 706f 6e65 6e74 5f6c 6179 6f75 7420  omponent_layout 
-00000250: 696d 706f 7274 2028 0a20 2020 204c 6162  import (.    Lab
-00000260: 656c 2c0a 2020 2020 5f61 6c69 676e 2c0a  el,.    _align,.
-00000270: 2020 2020 5f64 6973 7472 6962 7574 652c      _distribute,
-00000280: 0a20 2020 205f 4765 6f6d 6574 7279 4865  .    _GeometryHe
-00000290: 6c70 6572 2c0a 2020 2020 5f70 6172 7365  lper,.    _parse
-000002a0: 5f6c 6179 6572 2c0a 2020 2020 6765 745f  _layer,.    get_
-000002b0: 706f 6c79 676f 6e73 2c0a 2020 2020 7070  polygons,.    pp
-000002c0: 7269 6e74 5f70 6f72 7473 2c0a 290a 6672  rint_ports,.).fr
-000002d0: 6f6d 2067 6473 6661 6374 6f72 792e 636f  om gdsfactory.co
-000002e0: 6d70 6f6e 656e 745f 7265 6665 7265 6e63  mponent_referenc
-000002f0: 6520 696d 706f 7274 2043 6f6d 706f 6e65  e import Compone
-00000300: 6e74 5265 6665 7265 6e63 652c 2053 697a  ntReference, Siz
-00000310: 6549 6e66 6f0a 6672 6f6d 2067 6473 6661  eInfo.from gdsfa
-00000320: 6374 6f72 792e 636f 6e66 6967 2069 6d70  ctory.config imp
-00000330: 6f72 7420 434f 4e46 2c20 4744 5344 4952  ort CONF, GDSDIR
-00000340: 5f54 454d 502c 206c 6f67 6765 720a 6672  _TEMP, logger.fr
-00000350: 6f6d 2067 6473 6661 6374 6f72 792e 6e61  om gdsfactory.na
-00000360: 6d65 2069 6d70 6f72 7420 6765 745f 6e61  me import get_na
-00000370: 6d65 5f73 686f 7274 0a66 726f 6d20 6764  me_short.from gd
-00000380: 7366 6163 746f 7279 2e70 6f6c 7967 6f6e  sfactory.polygon
-00000390: 2069 6d70 6f72 7420 506f 6c79 676f 6e0a   import Polygon.
-000003a0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-000003b0: 706f 7274 2069 6d70 6f72 7420 280a 2020  port import (.  
-000003c0: 2020 506f 7274 2c0a 2020 2020 6175 746f    Port,.    auto
-000003d0: 5f72 656e 616d 655f 706f 7274 732c 0a20  _rename_ports,. 
-000003e0: 2020 2061 7574 6f5f 7265 6e61 6d65 5f70     auto_rename_p
-000003f0: 6f72 7473 5f63 6f75 6e74 6572 5f63 6c6f  orts_counter_clo
-00000400: 636b 7769 7365 2c0a 2020 2020 6175 746f  ckwise,.    auto
-00000410: 5f72 656e 616d 655f 706f 7274 735f 6c61  _rename_ports_la
-00000420: 7965 725f 6f72 6965 6e74 6174 696f 6e2c  yer_orientation,
-00000430: 0a20 2020 2061 7574 6f5f 7265 6e61 6d65  .    auto_rename
-00000440: 5f70 6f72 7473 5f6f 7269 656e 7461 7469  _ports_orientati
-00000450: 6f6e 2c0a 2020 2020 6d61 705f 706f 7274  on,.    map_port
-00000460: 735f 6c61 7965 725f 746f 5f6f 7269 656e  s_layer_to_orien
-00000470: 7461 7469 6f6e 2c0a 2020 2020 6d61 705f  tation,.    map_
-00000480: 706f 7274 735f 746f 5f6f 7269 656e 7461  ports_to_orienta
-00000490: 7469 6f6e 5f63 6377 2c0a 2020 2020 6d61  tion_ccw,.    ma
-000004a0: 705f 706f 7274 735f 746f 5f6f 7269 656e  p_ports_to_orien
-000004b0: 7461 7469 6f6e 5f63 772c 0a20 2020 2073  tation_cw,.    s
-000004c0: 656c 6563 745f 706f 7274 732c 0a29 0a66  elect_ports,.).f
-000004d0: 726f 6d20 6764 7366 6163 746f 7279 2e73  rom gdsfactory.s
-000004e0: 6572 6961 6c69 7a61 7469 6f6e 2069 6d70  erialization imp
-000004f0: 6f72 7420 636c 6561 6e5f 6469 6374 0a66  ort clean_dict.f
-00000500: 726f 6d20 6764 7366 6163 746f 7279 2e73  rom gdsfactory.s
-00000510: 6e61 7020 696d 706f 7274 2073 6e61 705f  nap import snap_
-00000520: 746f 5f67 7269 640a 0a69 6620 5459 5045  to_grid..if TYPE
-00000530: 5f43 4845 434b 494e 473a 0a20 2020 2066  _CHECKING:.    f
-00000540: 726f 6d20 6764 7366 6163 746f 7279 2e74  rom gdsfactory.t
-00000550: 6563 686e 6f6c 6f67 7920 696d 706f 7274  echnology import
-00000560: 204c 6179 6572 5374 6163 6b2c 204c 6179   LayerStack, Lay
-00000570: 6572 5669 6577 730a 2020 2020 6672 6f6d  erViews.    from
-00000580: 2067 6473 6661 6374 6f72 792e 7479 7069   gdsfactory.typi
-00000590: 6e67 7320 696d 706f 7274 2028 0a20 2020  ngs import (.   
-000005a0: 2020 2020 2043 6f6f 7264 696e 6174 652c       Coordinate,
-000005b0: 0a20 2020 2020 2020 2043 726f 7373 5365  .        CrossSe
-000005c0: 6374 696f 6e2c 0a20 2020 2020 2020 2043  ction,.        C
-000005d0: 726f 7373 5365 6374 696f 6e53 7065 632c  rossSectionSpec,
-000005e0: 0a20 2020 2020 2020 2046 6c6f 6174 322c  .        Float2,
-000005f0: 0a20 2020 2020 2020 204c 6179 6572 2c0a  .        Layer,.
-00000600: 2020 2020 2020 2020 4c61 7965 7273 2c0a          Layers,.
-00000610: 2020 2020 2020 2020 4c61 7965 7253 7065          LayerSpe
-00000620: 632c 0a20 2020 2020 2020 2050 6174 6854  c,.        PathT
-00000630: 7970 652c 0a20 2020 2029 0a0a 7661 6c69  ype,.    )..vali
-00000640: 645f 706c 6f74 7465 7273 203d 205b 226d  d_plotters = ["m
-00000650: 6174 706c 6f74 6c69 6222 2c20 226b 6c61  atplotlib", "kla
-00000660: 796f 7574 222c 2022 6b77 6562 225d 0a41  yout", "kweb"].A
-00000670: 7869 7320 3d20 4c69 7465 7261 6c5b 2278  xis = Literal["x
-00000680: 222c 2022 7922 5d0a 6f73 2e65 6e76 6972  ", "y"].os.envir
-00000690: 6f6e 5b22 4b57 4542 5f46 494c 4553 4c4f  on["KWEB_FILESLO
-000006a0: 4341 5449 4f4e 225d 203d 2073 7472 2847  CATION"] = str(G
-000006b0: 4453 4449 525f 5445 4d50 290a 0a0a 636c  DSDIR_TEMP)...cl
-000006c0: 6173 7320 556e 6361 6368 6564 436f 6d70  ass UncachedComp
-000006d0: 6f6e 656e 7457 6172 6e69 6e67 2855 7365  onentWarning(Use
-000006e0: 7257 6172 6e69 6e67 293a 0a20 2020 2070  rWarning):.    p
-000006f0: 6173 730a 0a0a 636c 6173 7320 556e 6361  ass...class Unca
-00000700: 6368 6564 436f 6d70 6f6e 656e 7445 7272  chedComponentErr
-00000710: 6f72 2856 616c 7565 4572 726f 7229 3a0a  or(ValueError):.
-00000720: 2020 2020 7061 7373 0a0a 0a63 6c61 7373      pass...class
-00000730: 204d 7574 6162 696c 6974 7945 7272 6f72   MutabilityError
-00000740: 2856 616c 7565 4572 726f 7229 3a0a 2020  (ValueError):.  
-00000750: 2020 7061 7373 0a0a 0a64 6566 205f 6765    pass...def _ge
-00000760: 745f 6465 7065 6e64 656e 6369 6573 2863  t_dependencies(c
-00000770: 6f6d 706f 6e65 6e74 2c20 7265 6665 7265  omponent, refere
-00000780: 6e63 6573 5f73 6574 2920 2d3e 204e 6f6e  nces_set) -> Non
-00000790: 653a 0a20 2020 2066 6f72 2072 6566 2069  e:.    for ref i
-000007a0: 6e20 636f 6d70 6f6e 656e 742e 7265 6665  n component.refe
-000007b0: 7265 6e63 6573 3a0a 2020 2020 2020 2020  rences:.        
-000007c0: 7265 6665 7265 6e63 6573 5f73 6574 2e61  references_set.a
-000007d0: 6464 2872 6566 2e72 6566 5f63 656c 6c29  dd(ref.ref_cell)
-000007e0: 0a20 2020 2020 2020 205f 6765 745f 6465  .        _get_de
-000007f0: 7065 6e64 656e 6369 6573 2872 6566 2e72  pendencies(ref.r
-00000800: 6566 5f63 656c 6c2c 2072 6566 6572 656e  ef_cell, referen
-00000810: 6365 735f 7365 7429 0a0a 0a6d 7574 6162  ces_set)...mutab
-00000820: 696c 6974 795f 6572 726f 725f 6d65 7373  ility_error_mess
-00000830: 6167 6520 3d20 2222 220a 596f 7520 6361  age = """.You ca
-00000840: 6e6e 6f74 206d 6f64 6966 7920 6120 436f  nnot modify a Co
-00000850: 6d70 6f6e 656e 7420 6166 7465 7220 6372  mponent after cr
-00000860: 6561 7469 6f6e 2061 7320 6974 2077 696c  eation as it wil
-00000870: 6c20 6166 6665 6374 2061 6c6c 206f 6620  l affect all of 
-00000880: 6974 7320 696e 7374 616e 6365 732e 0a0a  its instances...
-00000890: 4372 6561 7465 2061 206e 6577 2043 6f6d  Create a new Com
-000008a0: 706f 6e65 6e74 2061 6e64 2061 6464 2061  ponent and add a
-000008b0: 2072 6566 6572 656e 6365 2074 6f20 6974   reference to it
-000008c0: 2e0a 0a46 6f72 2065 7861 6d70 6c65 3a0a  ...For example:.
-000008d0: 0a23 2042 4144 0a63 203d 2067 662e 636f  .# BAD.c = gf.co
-000008e0: 6d70 6f6e 656e 7473 2e62 656e 645f 6575  mponents.bend_eu
-000008f0: 6c65 7228 290a 632e 6164 645f 7265 6628  ler().c.add_ref(
-00000900: 6766 2e63 6f6d 706f 6e65 6e74 732e 6d7a  gf.components.mz
-00000910: 6928 2929 0a0a 2320 474f 4f44 0a63 203d  i())..# GOOD.c =
-00000920: 2067 662e 436f 6d70 6f6e 656e 7428 290a   gf.Component().
-00000930: 632e 6164 645f 7265 6628 6766 2e63 6f6d  c.add_ref(gf.com
-00000940: 706f 6e65 6e74 732e 6265 6e64 5f65 756c  ponents.bend_eul
-00000950: 6572 2829 290a 632e 6164 645f 7265 6628  er()).c.add_ref(
-00000960: 6766 2e63 6f6d 706f 6e65 6e74 732e 6d7a  gf.components.mz
-00000970: 6928 2929 0a22 2222 0a0a 6d6f 7665 5f65  i())."""..move_e
-00000980: 7272 6f72 5f6d 6573 7361 6765 203d 2022  rror_message = "
-00000990: 2222 0a59 6f75 2063 616e 6e6f 7420 6d6f  "".You cannot mo
-000009a0: 7665 2061 2043 6f6d 706f 6e65 6e74 2e20  ve a Component. 
-000009b0: 596f 7520 6361 6e20 6372 6561 7465 2061  You can create a
-000009c0: 206e 6577 2043 6f6d 706f 6e65 6e74 2c20   new Component, 
-000009d0: 6164 6420 6120 7265 6665 7265 6e63 6520  add a reference 
-000009e0: 746f 2074 6865 206f 7468 6572 2043 6f6d  to the other Com
-000009f0: 706f 6e65 6e74 2061 6e64 2074 6865 6e20  ponent and then 
-00000a00: 6d6f 7665 2074 6865 2072 6566 6572 656e  move the referen
-00000a10: 6365 2e0a 0a46 6f72 2065 7861 6d70 6c65  ce...For example
-00000a20: 3a0a 0a23 2042 4144 0a63 203d 2067 662e  :..# BAD.c = gf.
-00000a30: 636f 6d70 6f6e 656e 7473 2e73 7472 6169  components.strai
-00000a40: 6768 7428 290a 632e 786d 696e 203d 2031  ght().c.xmin = 1
-00000a50: 300a 0a23 2047 4f4f 440a 6320 3d20 6766  0..# GOOD.c = gf
-00000a60: 2e43 6f6d 706f 6e65 6e74 2829 0a72 6566  .Component().ref
-00000a70: 203d 2063 2e61 6464 5f72 6566 2867 662e   = c.add_ref(gf.
-00000a80: 636f 6d70 6f6e 656e 7473 2e73 7472 6169  components.strai
-00000a90: 6768 7428 2929 2023 206f 7220 7265 6620  ght()) # or ref 
-00000aa0: 3d20 6320 3c3c 2067 662e 636f 6d70 6f6e  = c << gf.compon
-00000ab0: 656e 7473 2e73 7472 6169 6768 7428 290a  ents.straight().
-00000ac0: 7265 662e 786d 696e 203d 2031 300a 2222  ref.xmin = 10.""
-00000ad0: 220a 0a5f 7469 6d65 7374 616d 7032 3031  ".._timestamp201
-00000ae0: 3920 3d20 6461 7465 7469 6d65 2e64 6174  9 = datetime.dat
-00000af0: 6574 696d 652e 6672 6f6d 7469 6d65 7374  etime.fromtimest
-00000b00: 616d 7028 3135 3732 3031 3431 3932 2e38  amp(1572014192.8
-00000b10: 3237 3329 0a0a 2320 476c 6f62 616c 2064  273)..# Global d
-00000b20: 6963 7469 6f6e 6172 7920 746f 2068 6f6c  ictionary to hol
-00000b30: 6420 636f 756e 7465 7273 2066 6f72 2065  d counters for e
-00000b40: 6163 6820 6e61 6d65 0a6e 616d 655f 636f  ach name.name_co
-00000b50: 756e 7465 7273 203d 2043 6f75 6e74 6572  unters = Counter
-00000b60: 2829 0a0a 0a76 616c 6964 5f61 6e63 686f  ()...valid_ancho
-00000b70: 725f 706f 696e 745f 6b65 7977 6f72 6473  r_point_keywords
-00000b80: 203d 205b 0a20 2020 2022 6365 222c 0a20   = [.    "ce",. 
-00000b90: 2020 2022 6377 222c 0a20 2020 2022 6e63     "cw",.    "nc
-00000ba0: 222c 0a20 2020 2022 6e65 222c 0a20 2020  ",.    "ne",.   
-00000bb0: 2022 6e77 222c 0a20 2020 2022 7363 222c   "nw",.    "sc",
-00000bc0: 0a20 2020 2022 7365 222c 0a20 2020 2022  .    "se",.    "
-00000bd0: 7377 222c 0a20 2020 2022 6365 6e74 6572  sw",.    "center
-00000be0: 222c 0a20 2020 2022 6363 222c 0a5d 0a76  ",.    "cc",.].v
-00000bf0: 616c 6964 5f61 6e63 686f 725f 7661 6c75  alid_anchor_valu
-00000c00: 655f 6b65 7977 6f72 6473 203d 205b 0a20  e_keywords = [. 
-00000c10: 2020 2022 736f 7574 6822 2c0a 2020 2020     "south",.    
-00000c20: 2277 6573 7422 2c0a 2020 2020 2265 6173  "west",.    "eas
-00000c30: 7422 2c0a 2020 2020 226e 6f72 7468 222c  t",.    "north",
-00000c40: 0a5d 0a23 2072 6566 6572 2074 6f20 6120  .].# refer to a 
-00000c50: 7369 6e67 756c 6172 2028 7820 6f72 2079  singular (x or y
-00000c60: 2920 7661 6c75 650a 0a76 616c 6964 5f61  ) value..valid_a
-00000c70: 6e63 686f 7273 203d 2076 616c 6964 5f61  nchors = valid_a
-00000c80: 6e63 686f 725f 706f 696e 745f 6b65 7977  nchor_point_keyw
-00000c90: 6f72 6473 202b 2076 616c 6964 5f61 6e63  ords + valid_anc
-00000ca0: 686f 725f 7661 6c75 655f 6b65 7977 6f72  hor_value_keywor
-00000cb0: 6473 0a23 2066 756c 6c20 7365 7420 6f66  ds.# full set of
-00000cc0: 2076 616c 6964 2061 6e63 686f 7220 6b65   valid anchor ke
-00000cd0: 7977 6f72 6473 2028 6569 7468 6572 2072  ywords (either r
-00000ce0: 6566 6572 7269 6e67 2074 6f20 706f 696e  eferring to poin
-00000cf0: 7473 206f 7220 7661 6c75 6573 290a 0a0a  ts or values)...
-00000d00: 6465 6620 5f72 6e64 2861 7272 2c20 7072  def _rnd(arr, pr
-00000d10: 6563 6973 696f 6e3d 3165 2d34 293a 0a20  ecision=1e-4):. 
-00000d20: 2020 2061 7272 203d 206e 702e 6173 636f     arr = np.asco
-00000d30: 6e74 6967 756f 7573 6172 7261 7928 6172  ntiguousarray(ar
-00000d40: 7229 0a20 2020 206e 6469 6769 7473 203d  r).    ndigits =
-00000d50: 2072 6f75 6e64 282d 6d61 7468 2e6c 6f67   round(-math.log
-00000d60: 3130 2870 7265 6369 7369 6f6e 2929 0a20  10(precision)). 
-00000d70: 2020 2072 6574 7572 6e20 6e70 2e61 7363     return np.asc
-00000d80: 6f6e 7469 6775 6f75 7361 7272 6179 2861  ontiguousarray(a
-00000d90: 7272 2e72 6f75 6e64 286e 6469 6769 7473  rr.round(ndigits
-00000da0: 2920 2f20 7072 6563 6973 696f 6e2c 2064  ) / precision, d
-00000db0: 7479 7065 3d6e 702e 696e 7436 3429 0a0a  type=np.int64)..
-00000dc0: 0a63 6c61 7373 2043 6f6d 706f 6e65 6e74  .class Component
-00000dd0: 285f 4765 6f6d 6574 7279 4865 6c70 6572  (_GeometryHelper
-00000de0: 293a 0a20 2020 2022 2222 4120 436f 6d70  ):.    """A Comp
-00000df0: 6f6e 656e 7420 6973 2061 6e20 656d 7074  onent is an empt
-00000e00: 7920 6361 6e76 6173 2077 6865 7265 2079  y canvas where y
-00000e10: 6f75 2061 6464 2070 6f6c 7967 6f6e 732c  ou add polygons,
-00000e20: 2072 6566 6572 656e 6365 7320 616e 6420   references and 
-00000e30: 706f 7274 7320 5c0a 2020 2020 2020 2020  ports \.        
-00000e40: 2020 2020 2874 6f20 636f 6e6e 6563 7420      (to connect 
-00000e50: 746f 206f 7468 6572 2063 6f6d 706f 6e65  to other compone
-00000e60: 6e74 7329 2e0a 0a20 2020 202d 2073 746f  nts)...    - sto
-00000e70: 7265 7320 7365 7474 696e 6773 2074 6861  res settings tha
-00000e80: 7420 796f 7520 7573 6520 746f 2062 7569  t you use to bui
-00000e90: 6c64 2074 6865 2063 6f6d 706f 6e65 6e74  ld the component
-00000ea0: 0a20 2020 202d 2073 746f 7265 7320 696e  .    - stores in
-00000eb0: 666f 2074 6861 7420 796f 7520 7761 6e74  fo that you want
-00000ec0: 2074 6f20 7573 650a 2020 2020 2d20 6361   to use.    - ca
-00000ed0: 6e20 7265 7475 726e 2070 6f72 7473 2062  n return ports b
-00000ee0: 7920 7479 7065 2028 6f70 7469 6361 6c2c  y type (optical,
-00000ef0: 2065 6c65 6374 7269 6361 6c20 2e2e 2e29   electrical ...)
-00000f00: 0a20 2020 202d 2063 616e 2072 6574 7572  .    - can retur
-00000f10: 6e20 6e65 746c 6973 7420 666f 7220 6369  n netlist for ci
-00000f20: 7263 7569 7420 7369 6d75 6c61 7469 6f6e  rcuit simulation
-00000f30: 0a20 2020 202d 2063 616e 2077 7269 7465  .    - can write
-00000f40: 2074 6f20 4744 532c 204f 4153 4953 0a20   to GDS, OASIS. 
-00000f50: 2020 202d 2063 616e 2073 686f 7720 696e     - can show in
-00000f60: 204b 4c61 796f 7574 2c20 6d61 7470 6c6f   KLayout, matplo
-00000f70: 746c 6962 2c20 3344 0a20 2020 202d 2063  tlib, 3D.    - c
-00000f80: 616e 2072 6574 7572 6e20 636f 7079 2c20  an return copy, 
-00000f90: 6d69 7272 6f72 2c20 666c 6174 7465 6e65  mirror, flattene
-00000fa0: 6420 286e 6f20 7265 6665 7265 6e63 6573  d (no references
-00000fb0: 290a 0a20 2020 2041 7267 733a 0a20 2020  )..    Args:.   
-00000fc0: 2020 2020 206e 616d 653a 2063 6f6d 706f       name: compo
-00000fd0: 6e65 6e74 5f6e 616d 652e 2055 7365 2040  nent_name. Use @
-00000fe0: 6365 6c6c 2064 6563 6f72 6174 6f72 2066  cell decorator f
-00000ff0: 6f72 2061 7574 6f2d 6e61 6d69 6e67 2e0a  or auto-naming..
-00001000: 2020 2020 2020 2020 7769 7468 5f75 7569          with_uui
-00001010: 643a 2061 6464 7320 756e 6971 7565 2069  d: adds unique i
-00001020: 6465 6e74 6966 6965 722e 0a0a 2020 2020  dentifier...    
-00001030: 5072 6f70 6572 7469 6573 3a0a 2020 2020  Properties:.    
-00001040: 2020 2020 696e 666f 3a20 6469 6374 696f      info: dictio
-00001050: 6e61 7279 2074 6861 7420 696e 636c 7564  nary that includ
-00001060: 6573 0a20 2020 2020 2020 2020 2020 202d  es.            -
-00001070: 2064 6572 6976 6564 2070 726f 7065 7274   derived propert
-00001080: 6965 730a 2020 2020 2020 2020 2020 2020  ies.            
-00001090: 2d20 6578 7465 726e 616c 206d 6574 6164  - external metad
-000010a0: 6174 6120 2874 6573 745f 7072 6f74 6f63  ata (test_protoc
-000010b0: 6f6c 2c20 646f 6373 2c20 2e2e 2e29 0a20  ol, docs, ...). 
-000010c0: 2020 2020 2020 2020 2020 202d 2073 696d             - sim
-000010d0: 756c 6174 696f 6e5f 7365 7474 696e 6773  ulation_settings
-000010e0: 0a20 2020 2020 2020 2020 2020 202d 2066  .            - f
-000010f0: 756e 6374 696f 6e5f 6e61 6d65 0a20 2020  unction_name.   
-00001100: 2020 2020 2020 2020 202d 206e 616d 653a           - name:
-00001110: 2066 6f72 2074 6865 2063 6f6d 706f 6e65   for the compone
-00001120: 6e74 0a0a 2020 2020 2020 2020 7365 7474  nt..        sett
-00001130: 696e 6773 3a0a 2020 2020 2020 2020 2020  ings:.          
-00001140: 2020 6675 6c6c 3a20 6675 6c6c 2073 6574    full: full set
-00001150: 7469 6e67 7320 7061 7373 6564 2074 6f20  tings passed to 
-00001160: 7468 6520 6675 6e63 7469 6f6e 2074 6f20  the function to 
-00001170: 6372 6561 7465 2063 6f6d 706f 6e65 6e74  create component
-00001180: 2e0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
-00001190: 616e 6765 643a 2063 6861 6e67 6564 2073  anged: changed s
-000011a0: 6574 7469 6e67 732e 0a20 2020 2020 2020  ettings..       
-000011b0: 2020 2020 2064 6566 6175 6c74 3a20 6465       default: de
-000011c0: 6661 756c 7420 636f 6d70 6f6e 656e 7420  fault component 
-000011d0: 7365 7474 696e 6773 2e0a 2020 2020 2020  settings..      
-000011e0: 2020 2020 2020 6368 696c 643a 2064 6963        child: dic
-000011f0: 7420 696e 666f 2066 726f 6d20 7468 6520  t info from the 
-00001200: 6368 696c 6472 656e 2c20 6966 2061 6e79  children, if any
-00001210: 2e0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
-00001220: 6566 205f 5f69 6e69 745f 5f28 0a20 2020  ef __init__(.   
-00001230: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00001240: 2020 206e 616d 653a 2073 7472 203d 2022     name: str = "
-00001250: 556e 6e61 6d65 6422 2c0a 2020 2020 2020  Unnamed",.      
-00001260: 2020 7769 7468 5f75 7569 643a 2062 6f6f    with_uuid: boo
-00001270: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-00001280: 2020 206d 6178 5f6e 616d 655f 6c65 6e67     max_name_leng
-00001290: 7468 3a20 696e 7420 7c20 4e6f 6e65 203d  th: int | None =
-000012a0: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
-000012b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-000012c0: 2249 6e69 7469 616c 697a 6520 7468 6520  "Initialize the 
-000012d0: 436f 6d70 6f6e 656e 7420 6f62 6a65 6374  Component object
-000012e0: 2e22 2222 0a0a 2020 2020 2020 2020 7365  ."""..        se
-000012f0: 6c66 2e75 6964 203d 2073 7472 2875 7569  lf.uid = str(uui
-00001300: 642e 7575 6964 3428 2929 5b3a 385d 0a20  d.uuid4())[:8]. 
-00001310: 2020 2020 2020 2069 6620 7769 7468 5f75         if with_u
-00001320: 7569 6420 6f72 206e 616d 6520 3d3d 2022  uid or name == "
-00001330: 556e 6e61 6d65 6422 3a0a 2020 2020 2020  Unnamed":.      
-00001340: 2020 2020 2020 6e61 6d65 202b 3d20 6622        name += f"
-00001350: 5f7b 7365 6c66 2e75 6964 7d22 0a0a 2020  _{self.uid}"..  
-00001360: 2020 2020 2020 7365 6c66 2e5f 6365 6c6c        self._cell
-00001370: 203d 2067 6473 746b 2e43 656c 6c28 2255   = gdstk.Cell("U
-00001380: 6e6e 616d 6564 2229 0a20 2020 2020 2020  nnamed").       
-00001390: 2073 656c 662e 7265 6e61 6d65 286e 616d   self.rename(nam
-000013a0: 652c 206d 6178 5f6e 616d 655f 6c65 6e67  e, max_name_leng
-000013b0: 7468 3d6d 6178 5f6e 616d 655f 6c65 6e67  th=max_name_leng
-000013c0: 7468 290a 2020 2020 2020 2020 7365 6c66  th).        self
-000013d0: 2e69 6e66 6f3a 2064 6963 745b 7374 722c  .info: dict[str,
-000013e0: 2041 6e79 5d20 3d20 7b7d 0a0a 2020 2020   Any] = {}..    
-000013f0: 2020 2020 7365 6c66 2e73 6574 7469 6e67      self.setting
-00001400: 733a 2064 6963 745b 7374 722c 2041 6e79  s: dict[str, Any
-00001410: 5d20 3d20 7b7d 0a20 2020 2020 2020 2073  ] = {}.        s
-00001420: 656c 662e 5f6c 6f63 6b65 6420 3d20 4661  elf._locked = Fa
-00001430: 6c73 650a 2020 2020 2020 2020 7365 6c66  lse.        self
-00001440: 2e5f 6765 745f 6368 696c 645f 6e61 6d65  ._get_child_name
-00001450: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00001460: 2073 656c 662e 5f72 6566 6572 656e 6365   self._reference
-00001470: 5f6e 616d 6573 5f63 6f75 6e74 6572 203d  _names_counter =
-00001480: 2043 6f75 6e74 6572 2829 0a20 2020 2020   Counter().     
-00001490: 2020 2073 656c 662e 5f72 6566 6572 656e     self._referen
-000014a0: 6365 5f6e 616d 6573 5f75 7365 6420 3d20  ce_names_used = 
-000014b0: 7365 7428 290a 2020 2020 2020 2020 7365  set().        se
-000014c0: 6c66 2e5f 6e61 6d65 645f 7265 6665 7265  lf._named_refere
-000014d0: 6e63 6573 203d 207b 7d0a 2020 2020 2020  nces = {}.      
-000014e0: 2020 7365 6c66 2e5f 7265 6665 7265 6e63    self._referenc
-000014f0: 6573 203d 205b 5d0a 0a20 2020 2020 2020  es = []..       
-00001500: 2073 656c 662e 706f 7274 7320 3d20 7b7d   self.ports = {}
-00001510: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
-00001520: 696c 6420 3d20 4e6f 6e65 0a0a 2020 2020  ild = None..    
-00001530: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00001540: 6620 7265 6665 7265 6e63 6573 2873 656c  f references(sel
-00001550: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-00001560: 726e 2073 656c 662e 5f72 6566 6572 656e  rn self._referen
-00001570: 6365 730a 0a20 2020 2040 7072 6f70 6572  ces..    @proper
-00001580: 7479 0a20 2020 2064 6566 2070 6f6c 7967  ty.    def polyg
-00001590: 6f6e 7328 7365 6c66 2920 2d3e 206c 6973  ons(self) -> lis
-000015a0: 745b 506f 6c79 676f 6e5d 3a0a 2020 2020  t[Polygon]:.    
-000015b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000015c0: 5f63 656c 6c2e 706f 6c79 676f 6e73 0a0a  _cell.polygons..
-000015d0: 2020 2020 6465 6620 6172 6561 2873 656c      def area(sel
-000015e0: 662c 206c 6179 6572 3a20 4c61 7965 7253  f, layer: LayerS
-000015f0: 7065 6320 7c20 4e6f 6e65 203d 204e 6f6e  pec | None = Non
-00001600: 6529 202d 3e20 666c 6f61 743a 0a20 2020  e) -> float:.   
-00001610: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00001620: 7468 6520 6172 6561 206f 6620 7468 6520  the area of the 
-00001630: 636f 6d70 6f6e 656e 742e 0a0a 2020 2020  component...    
-00001640: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00001650: 2020 2020 2020 6c61 7965 723a 2069 6620        layer: if 
-00001660: 4e6f 6e65 2072 6574 7572 6e73 2074 6865  None returns the
-00001670: 2061 7265 6120 6f66 2074 6865 2063 6f6d   area of the com
-00001680: 706f 6e65 6e74 2e0a 2020 2020 2020 2020  ponent..        
-00001690: 2020 2020 2020 2020 4966 206c 6179 6572          If layer
-000016a0: 2069 7320 7370 6563 6966 6965 6420 7265   is specified re
-000016b0: 7475 726e 7320 7468 6520 6172 6561 206f  turns the area o
-000016c0: 6620 7468 6520 636f 6d70 6f6e 656e 7420  f the component 
-000016d0: 696e 2074 6861 7420 6c61 7965 722e 0a20  in that layer.. 
-000016e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000016f0: 2020 2069 6620 6e6f 7420 6c61 7965 723a     if not layer:
-00001700: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00001710: 7572 6e20 7365 6c66 2e5f 6365 6c6c 2e61  urn self._cell.a
-00001720: 7265 6128 4661 6c73 6529 0a20 2020 2020  rea(False).     
-00001730: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-00001740: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
-00001750: 745f 6c61 7965 720a 0a20 2020 2020 2020  t_layer..       
-00001760: 206c 6179 6572 203d 2067 6574 5f6c 6179   layer = get_lay
-00001770: 6572 286c 6179 6572 290a 2020 2020 2020  er(layer).      
-00001780: 2020 6c61 7965 725f 746f 5f61 7265 6120    layer_to_area 
-00001790: 3d20 7365 6c66 2e5f 6365 6c6c 2e61 7265  = self._cell.are
-000017a0: 6128 5472 7565 290a 2020 2020 2020 2020  a(True).        
-000017b0: 7265 7475 726e 206c 6179 6572 5f74 6f5f  return layer_to_
-000017c0: 6172 6561 5b6c 6179 6572 5d0a 0a20 2020  area[layer]..   
-000017d0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-000017e0: 6566 206c 6162 656c 7328 7365 6c66 2920  ef labels(self) 
-000017f0: 2d3e 206c 6973 745b 4c61 6265 6c5d 3a0a  -> list[Label]:.
-00001800: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00001810: 656c 662e 5f63 656c 6c2e 6c61 6265 6c73  elf._cell.labels
-00001820: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00001830: 2020 2020 6465 6620 7061 7468 7328 7365      def paths(se
-00001840: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-00001850: 7572 6e20 7365 6c66 2e5f 6365 6c6c 2e70  urn self._cell.p
-00001860: 6174 6873 0a0a 2020 2020 4070 726f 7065  aths..    @prope
-00001870: 7274 790a 2020 2020 6465 6620 6e61 6d65  rty.    def name
-00001880: 2873 656c 6629 202d 3e20 7374 723a 0a20  (self) -> str:. 
-00001890: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000018a0: 6c66 2e5f 6365 6c6c 2e6e 616d 650a 0a20  lf._cell.name.. 
-000018b0: 2020 2040 6e61 6d65 2e73 6574 7465 720a     @name.setter.
-000018c0: 2020 2020 6465 6620 6e61 6d65 2873 656c      def name(sel
-000018d0: 662c 206e 616d 6529 202d 3e20 4e6f 6e65  f, name) -> None
-000018e0: 3a0a 2020 2020 2020 2020 7365 6c66 2e72  :.        self.r
-000018f0: 656e 616d 6528 6e61 6d65 290a 0a20 2020  ename(name)..   
-00001900: 2064 6566 2072 656e 616d 6528 7365 6c66   def rename(self
-00001910: 2c20 6e61 6d65 3a20 7374 722c 2063 6163  , name: str, cac
-00001920: 6865 3a20 626f 6f6c 203d 2054 7275 652c  he: bool = True,
-00001930: 206d 6178 5f6e 616d 655f 6c65 6e67 7468   max_name_length
-00001940: 3a20 696e 7420 7c20 4e6f 6e65 203d 204e  : int | None = N
-00001950: 6f6e 6529 3a0a 2020 2020 2020 2020 6672  one):.        fr
-00001960: 6f6d 2067 6473 6661 6374 6f72 792e 6365  om gdsfactory.ce
-00001970: 6c6c 2069 6d70 6f72 7420 4341 4348 452c  ll import CACHE,
-00001980: 2072 656d 6f76 655f 6672 6f6d 5f63 6163   remove_from_cac
-00001990: 6865 0a0a 2020 2020 2020 2020 6966 206d  he..        if m
-000019a0: 6178 5f6e 616d 655f 6c65 6e67 7468 2069  ax_name_length i
-000019b0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-000019c0: 2020 2020 6d61 785f 6e61 6d65 5f6c 656e      max_name_len
-000019d0: 6774 6820 3d20 434f 4e46 2e6d 6178 5f6e  gth = CONF.max_n
-000019e0: 616d 655f 6c65 6e67 7468 0a0a 2020 2020  ame_length..    
-000019f0: 2020 2020 6966 206c 656e 286e 616d 6529      if len(name)
-00001a00: 203e 206d 6178 5f6e 616d 655f 6c65 6e67   > max_name_leng
-00001a10: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
-00001a20: 6e61 6d65 5f73 686f 7274 203d 2067 6574  name_short = get
-00001a30: 5f6e 616d 655f 7368 6f72 7428 6e61 6d65  _name_short(name
-00001a40: 2c20 6d61 785f 6e61 6d65 5f6c 656e 6774  , max_name_lengt
-00001a50: 683d 6d61 785f 6e61 6d65 5f6c 656e 6774  h=max_name_lengt
-00001a60: 6829 0a20 2020 2020 2020 2020 2020 2077  h).            w
-00001a70: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
-00001a80: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00001a90: 207b 6e61 6d65 7d20 6973 2074 6f6f 206c   {name} is too l
-00001aa0: 6f6e 672e 204d 6178 206c 656e 6774 6820  ong. Max length 
-00001ab0: 6973 207b 6d61 785f 6e61 6d65 5f6c 656e  is {max_name_len
-00001ac0: 6774 687d 2e20 5265 6e61 6d69 6e67 2074  gth}. Renaming t
-00001ad0: 6f20 7b6e 616d 655f 7368 6f72 747d 222c  o {name_short}",
-00001ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001af0: 2073 7461 636b 6c65 7665 6c3d 322c 0a20   stacklevel=2,. 
-00001b00: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00001b10: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-00001b20: 6e61 6d65 5f73 686f 7274 0a0a 2020 2020  name_short..    
-00001b30: 2020 2020 6966 2073 656c 662e 6e61 6d65      if self.name
-00001b40: 2021 3d20 6e61 6d65 3a0a 2020 2020 2020   != name:.      
-00001b50: 2020 2020 2020 2320 6966 2074 6869 7320        # if this 
-00001b60: 636f 6d70 6f6e 656e 7420 6973 2072 6567  component is reg
-00001b70: 6973 7465 7265 6420 756e 6465 7220 6974  istered under it
-00001b80: 7320 6f6c 6420 6e61 6d65 2069 6e20 7468  s old name in th
-00001b90: 6520 6361 6368 652c 2072 656d 6f76 6520  e cache, remove 
-00001ba0: 6974 0a20 2020 2020 2020 2020 2020 206f  it.            o
-00001bb0: 6c64 5f6e 616d 6520 3d20 7365 6c66 2e6e  ld_name = self.n
-00001bc0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-00001bd0: 6966 2043 4143 4845 2e67 6574 286f 6c64  if CACHE.get(old
-00001be0: 5f6e 616d 6529 2069 7320 7365 6c66 3a0a  _name) is self:.
-00001bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c00: 7265 6d6f 7665 5f66 726f 6d5f 6361 6368  remove_from_cach
-00001c10: 6528 7365 6c66 2e6e 616d 6529 0a0a 2020  e(self.name)..  
-00001c20: 2020 2020 2020 2020 2020 2320 6361 6368            # cach
-00001c30: 6520 7468 6520 6e65 7720 6e61 6d65 2061  e the new name a
-00001c40: 6e64 2061 6464 2074 6f20 636f 756e 7465  nd add to counte
-00001c50: 7220 6966 2073 7065 6369 6669 6564 0a20  r if specified. 
-00001c60: 2020 2020 2020 2020 2020 2069 6620 6361             if ca
-00001c70: 6368 6520 6973 2054 7275 653a 0a20 2020  che is True:.   
-00001c80: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00001c90: 655f 636f 756e 7465 7273 5b6e 616d 655d  e_counters[name]
-00001ca0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00001cb0: 2020 2020 2020 6966 206e 616d 655f 636f        if name_co
-00001cc0: 756e 7465 7273 5b6e 616d 655d 203e 2031  unters[name] > 1
-00001cd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00001ce0: 2020 2020 2020 6e61 6d65 203d 2066 227b        name = f"{
-00001cf0: 6e61 6d65 7d24 7b6e 616d 655f 636f 756e  name}${name_coun
-00001d00: 7465 7273 5b6e 616d 655d 2d31 7d22 0a20  ters[name]-1}". 
-00001d10: 2020 2020 2020 2020 2020 2020 2020 2043                 C
-00001d20: 4143 4845 5b6e 616d 655d 203d 2073 656c  ACHE[name] = sel
-00001d30: 660a 0a20 2020 2020 2020 2073 656c 662e  f..        self.
-00001d40: 5f63 656c 6c2e 6e61 6d65 203d 206e 616d  _cell.name = nam
-00001d50: 650a 0a20 2020 2064 6566 205f 5f69 7465  e..    def __ite
-00001d60: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-00001d70: 2020 2022 2222 596f 7520 6361 6e20 6974     """You can it
-00001d80: 6572 6174 6520 6f76 6572 2070 6f6c 7967  erate over polyg
-00001d90: 6f6e 732c 2070 6174 6873 2c20 6c61 6265  ons, paths, labe
-00001da0: 6c73 2061 6e64 2072 6566 6572 656e 6365  ls and reference
-00001db0: 732e 2222 220a 2020 2020 2020 2020 7265  s.""".        re
-00001dc0: 7475 726e 2069 7465 7274 6f6f 6c73 2e63  turn itertools.c
-00001dd0: 6861 696e 2873 656c 662e 706f 6c79 676f  hain(self.polygo
-00001de0: 6e73 2c20 7365 6c66 2e70 6174 6873 2c20  ns, self.paths, 
-00001df0: 7365 6c66 2e6c 6162 656c 732c 2073 656c  self.labels, sel
-00001e00: 662e 7265 6665 7265 6e63 6573 290a 0a20  f.references).. 
-00001e10: 2020 2064 6566 2067 6574 5f70 6f6c 7967     def get_polyg
-00001e20: 6f6e 5f65 6e63 6c6f 7375 7265 2873 656c  on_enclosure(sel
-00001e30: 6629 202d 3e20 506f 6c79 676f 6e3a 0a20  f) -> Polygon:. 
-00001e40: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00001e50: 7320 7368 6170 656c 7920 506f 6c79 676f  s shapely Polygo
-00001e60: 6e20 7769 7468 2065 6e63 6c6f 7375 7265  n with enclosure
-00001e70: 2e22 2222 0a20 2020 2020 2020 2069 6d70  .""".        imp
-00001e80: 6f72 7420 7368 6170 656c 790a 0a20 2020  ort shapely..   
-00001e90: 2020 2020 2072 6574 7572 6e20 7368 6170       return shap
-00001ea0: 656c 792e 506f 6c79 676f 6e28 7365 6c66  ely.Polygon(self
-00001eb0: 2e5f 6365 6c6c 2e63 6f6e 7665 785f 6875  ._cell.convex_hu
-00001ec0: 6c6c 2829 290a 0a20 2020 2064 6566 2067  ll())..    def g
-00001ed0: 6574 5f70 6f6c 7967 6f6e 5f62 626f 7828  et_polygon_bbox(
-00001ee0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00001ef0: 2020 2020 2020 2064 6566 6175 6c74 3a20         default: 
-00001f00: 666c 6f61 7420 3d20 302e 302c 0a20 2020  float = 0.0,.   
-00001f10: 2020 2020 2074 6f70 3a20 666c 6f61 7420       top: float 
-00001f20: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
-00001f30: 2020 2020 2020 2062 6f74 746f 6d3a 2066         bottom: f
-00001f40: 6c6f 6174 207c 204e 6f6e 6520 3d20 4e6f  loat | None = No
-00001f50: 6e65 2c0a 2020 2020 2020 2020 7269 6768  ne,.        righ
-00001f60: 743a 2066 6c6f 6174 207c 204e 6f6e 6520  t: float | None 
-00001f70: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00001f80: 6c65 6674 3a20 666c 6f61 7420 7c20 4e6f  left: float | No
-00001f90: 6e65 203d 204e 6f6e 652c 0a20 2020 2029  ne = None,.    )
-00001fa0: 202d 3e20 506f 6c79 676f 6e3a 0a20 2020   -> Polygon:.   
-00001fb0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00001fc0: 7368 6170 656c 7920 506f 6c79 676f 6e20  shapely Polygon 
-00001fd0: 7769 7468 2062 6f75 6e64 696e 6720 626f  with bounding bo
-00001fe0: 782e 0a0a 2020 2020 2020 2020 4172 6773  x...        Args
-00001ff0: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-00002000: 6661 756c 743a 2064 6566 6175 6c74 2070  fault: default p
-00002010: 6164 6469 6e67 2069 6e20 756d 2e0a 2020  adding in um..  
-00002020: 2020 2020 2020 2020 2020 746f 703a 206e            top: n
-00002030: 6f72 7468 2070 6164 6469 6e67 2069 6e20  orth padding in 
-00002040: 756d 2e0a 2020 2020 2020 2020 2020 2020  um..            
-00002050: 626f 7474 6f6d 3a20 736f 7574 6820 7061  bottom: south pa
-00002060: 6464 696e 6720 696e 2075 6d2e 0a20 2020  dding in um..   
-00002070: 2020 2020 2020 2020 2072 6967 6874 3a20           right: 
-00002080: 6561 7374 2070 6164 6469 6e67 2069 6e20  east padding in 
-00002090: 756d 2e0a 2020 2020 2020 2020 2020 2020  um..            
-000020a0: 6c65 6674 3a20 7765 7374 2070 6164 6469  left: west paddi
-000020b0: 6e67 2069 6e20 756d 2e0a 2020 2020 2020  ng in um..      
-000020c0: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
-000020d0: 706f 7274 2073 6861 7065 6c79 0a0a 2020  port shapely..  
-000020e0: 2020 2020 2020 2878 6d69 6e2c 2079 6d69        (xmin, ymi
-000020f0: 6e29 2c20 2878 6d61 782c 2079 6d61 7829  n), (xmax, ymax)
-00002100: 203d 2073 656c 662e 6262 6f78 0a20 2020   = self.bbox.   
-00002110: 2020 2020 2074 6f70 203d 2074 6f70 2069       top = top i
-00002120: 6620 746f 7020 6973 206e 6f74 204e 6f6e  f top is not Non
-00002130: 6520 656c 7365 2064 6566 6175 6c74 0a20  e else default. 
-00002140: 2020 2020 2020 2062 6f74 746f 6d20 3d20         bottom = 
-00002150: 626f 7474 6f6d 2069 6620 626f 7474 6f6d  bottom if bottom
-00002160: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-00002170: 6520 6465 6661 756c 740a 2020 2020 2020  e default.      
-00002180: 2020 7269 6768 7420 3d20 7269 6768 7420    right = right 
-00002190: 6966 2072 6967 6874 2069 7320 6e6f 7420  if right is not 
-000021a0: 4e6f 6e65 2065 6c73 6520 6465 6661 756c  None else defaul
-000021b0: 740a 2020 2020 2020 2020 6c65 6674 203d  t.        left =
-000021c0: 206c 6566 7420 6966 206c 6566 7420 6973   left if left is
-000021d0: 206e 6f74 204e 6f6e 6520 656c 7365 2064   not None else d
-000021e0: 6566 6175 6c74 0a20 2020 2020 2020 2070  efault.        p
-000021f0: 6f69 6e74 7320 3d20 5b0a 2020 2020 2020  oints = [.      
-00002200: 2020 2020 2020 5b78 6d69 6e20 2d20 6c65        [xmin - le
-00002210: 6674 2c20 796d 696e 202d 2062 6f74 746f  ft, ymin - botto
-00002220: 6d5d 2c0a 2020 2020 2020 2020 2020 2020  m],.            
-00002230: 5b78 6d61 7820 2b20 7269 6768 742c 2079  [xmax + right, y
-00002240: 6d69 6e20 2d20 626f 7474 6f6d 5d2c 0a20  min - bottom],. 
-00002250: 2020 2020 2020 2020 2020 205b 786d 6178             [xmax
-00002260: 202b 2072 6967 6874 2c20 796d 6178 202b   + right, ymax +
-00002270: 2074 6f70 5d2c 0a20 2020 2020 2020 2020   top],.         
-00002280: 2020 205b 786d 696e 202d 206c 6566 742c     [xmin - left,
-00002290: 2079 6d61 7820 2b20 746f 705d 2c0a 2020   ymax + top],.  
-000022a0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-000022b0: 7265 7475 726e 2073 6861 7065 6c79 2e50  return shapely.P
-000022c0: 6f6c 7967 6f6e 2870 6f69 6e74 7329 0a0a  olygon(points)..
-000022d0: 2020 2020 6465 6620 6765 745f 706f 6c79      def get_poly
-000022e0: 676f 6e73 280a 2020 2020 2020 2020 7365  gons(.        se
-000022f0: 6c66 2c0a 2020 2020 2020 2020 6279 5f73  lf,.        by_s
-00002300: 7065 633a 2062 6f6f 6c20 7c20 7475 706c  pec: bool | tupl
-00002310: 655b 696e 742c 2069 6e74 5d20 3d20 4661  e[int, int] = Fa
-00002320: 6c73 652c 0a20 2020 2020 2020 2064 6570  lse,.        dep
-00002330: 7468 3a20 696e 7420 7c20 4e6f 6e65 203d  th: int | None =
-00002340: 204e 6f6e 652c 0a20 2020 2020 2020 2069   None,.        i
-00002350: 6e63 6c75 6465 5f70 6174 6873 3a20 626f  nclude_paths: bo
-00002360: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
-00002370: 2020 2061 735f 6172 7261 793a 2062 6f6f     as_array: boo
-00002380: 6c20 3d20 5472 7565 2c0a 2020 2020 2020  l = True,.      
-00002390: 2020 6173 5f73 6861 7065 6c79 3a20 626f    as_shapely: bo
-000023a0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-000023b0: 2020 2020 6173 5f73 6861 7065 6c79 5f6d      as_shapely_m
-000023c0: 6572 6765 643a 2062 6f6f 6c20 3d20 4661  erged: bool = Fa
-000023d0: 6c73 652c 0a20 2020 2029 202d 3e20 6c69  lse,.    ) -> li
-000023e0: 7374 5b50 6f6c 7967 6f6e 5d20 7c20 6469  st[Polygon] | di
-000023f0: 6374 5b74 7570 6c65 5b69 6e74 2c20 696e  ct[tuple[int, in
-00002400: 745d 2c20 6c69 7374 5b50 6f6c 7967 6f6e  t], list[Polygon
-00002410: 5d5d 3a0a 2020 2020 2020 2020 2222 2252  ]]:.        """R
-00002420: 6574 7572 6e20 6120 6c69 7374 206f 6620  eturn a list of 
-00002430: 706f 6c79 676f 6e73 2069 6e20 7468 6973  polygons in this
-00002440: 2063 656c 6c2e 0a0a 2020 2020 2020 2020   cell...        
-00002450: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00002460: 2020 6279 5f73 7065 633a 2062 6f6f 6c20    by_spec: bool 
-00002470: 6f72 206c 6179 6572 0a20 2020 2020 2020  or layer.       
-00002480: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-00002490: 2c20 7468 6520 7265 7475 726e 2076 616c  , the return val
-000024a0: 7565 2069 7320 6120 6469 6374 696f 6e61  ue is a dictiona
-000024b0: 7279 2077 6974 6820 7468 650a 2020 2020  ry with the.    
-000024c0: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-000024d0: 676f 6e73 206f 6620 6561 6368 2069 6e64  gons of each ind
-000024e0: 6976 6964 7561 6c20 7061 6972 2028 6c61  ividual pair (la
-000024f0: 7965 722c 2064 6174 6174 7970 6529 2c20  yer, datatype), 
-00002500: 7768 6963 680a 2020 2020 2020 2020 2020  which.          
-00002510: 2020 2020 2020 6172 6520 7573 6564 2061        are used a
-00002520: 7320 6b65 7973 2e20 2049 6620 7365 7420  s keys.  If set 
-00002530: 746f 2061 2074 7570 6c65 206f 6620 286c  to a tuple of (l
-00002540: 6179 6572 2c20 6461 7461 7479 7065 292c  ayer, datatype),
-00002550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002560: 206f 6e6c 7920 706f 6c79 676f 6e73 2077   only polygons w
-00002570: 6974 6820 7468 6174 2073 7065 6369 6669  ith that specifi
-00002580: 6361 7469 6f6e 2061 7265 2072 6574 7572  cation are retur
-00002590: 6e65 642e 0a20 2020 2020 2020 2020 2020  ned..           
-000025a0: 2064 6570 7468 3a20 696e 7465 6765 7220   depth: integer 
-000025b0: 6f72 204e 6f6e 650a 2020 2020 2020 2020  or None.        
-000025c0: 2020 2020 2020 2020 4966 206e 6f74 204e          If not N
-000025d0: 6f6e 652c 2064 6566 696e 6573 2066 726f  one, defines fro
-000025e0: 6d20 686f 7720 6d61 6e79 2072 6566 6572  m how many refer
-000025f0: 656e 6365 206c 6576 656c 7320 746f 0a20  ence levels to. 
-00002600: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00002610: 6574 7269 6576 6520 706f 6c79 676f 6e73  etrieve polygons
-00002620: 2e20 2052 6566 6572 656e 6365 7320 6265  .  References be
-00002630: 6c6f 7720 7468 6973 206c 6576 656c 2077  low this level w
-00002640: 696c 6c20 7265 7375 6c74 0a20 2020 2020  ill result.     
-00002650: 2020 2020 2020 2020 2020 2069 6e20 6120             in a 
-00002660: 626f 756e 6469 6e67 2062 6f78 2e20 2049  bounding box.  I
-00002670: 6620 6062 795f 7370 6563 6020 6973 2054  f `by_spec` is T
-00002680: 7275 6520 7468 6520 6b65 7920 7769 6c6c  rue the key will
-00002690: 2062 6520 7468 650a 2020 2020 2020 2020   be the.        
-000026a0: 2020 2020 2020 2020 6e61 6d65 206f 6620          name of 
-000026b0: 7468 6973 2063 656c 6c2e 0a20 2020 2020  this cell..     
-000026c0: 2020 2020 2020 2069 6e63 6c75 6465 5f70         include_p
-000026d0: 6174 6873 3a20 4966 2054 7275 652c 2070  aths: If True, p
-000026e0: 6f6c 7967 6f6e 616c 2072 6570 7265 7365  olygonal represe
-000026f0: 6e74 6174 696f 6e20 6f66 2070 6174 6873  ntation of paths
-00002700: 2061 7265 2061 6c73 6f20 696e 636c 7564   are also includ
-00002710: 6564 2069 6e20 7468 6520 7265 7375 6c74  ed in the result
-00002720: 2e0a 2020 2020 2020 2020 2020 2020 6173  ..            as
-00002730: 5f61 7272 6179 3a20 7768 656e 2061 735f  _array: when as_
-00002740: 6172 7261 793d 6661 6c73 652c 2072 6574  array=false, ret
-00002750: 7572 6e20 7468 6520 506f 6c79 676f 6e20  urn the Polygon 
-00002760: 6f62 6a65 6374 7320 696e 7374 6561 642e  objects instead.
-00002770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002780: 2070 6f6c 7967 6f6e 206f 626a 6563 7473   polygon objects
-00002790: 2068 6176 6520 6d6f 7265 2069 6e66 6f72   have more infor
-000027a0: 6d61 7469 6f6e 2028 6573 7065 6369 616c  mation (especial
-000027b0: 6c79 2077 6865 6e20 6279 5f73 7065 633d  ly when by_spec=
-000027c0: 4661 6c73 6529 2061 6e64 2061 7265 2066  False) and are f
-000027d0: 6173 7465 7220 746f 2072 6574 7269 6576  aster to retriev
-000027e0: 652e 0a20 2020 2020 2020 2020 2020 2061  e..            a
-000027f0: 735f 7368 6170 656c 793a 2072 6574 7572  s_shapely: retur
-00002800: 6e73 2073 6861 7065 6c79 2070 6f6c 7967  ns shapely polyg
-00002810: 6f6e 732e 0a20 2020 2020 2020 2020 2020  ons..           
-00002820: 2061 735f 7368 6170 656c 795f 6d65 7267   as_shapely_merg
-00002830: 6564 3a20 7265 7475 726e 7320 6120 7368  ed: returns a sh
-00002840: 6170 656c 7920 706f 6c79 676f 6e69 7a65  apely polygonize
-00002850: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00002860: 6e73 0a20 2020 2020 2020 2020 2020 206f  ns.            o
-00002870: 7574 3a20 6c69 7374 206f 6620 6172 7261  ut: list of arra
-00002880: 792d 6c69 6b65 5b4e 5d5b 325d 206f 7220  y-like[N][2] or 
-00002890: 6469 6374 696f 6e61 7279 0a20 2020 2020  dictionary.     
-000028a0: 2020 2020 2020 2020 2020 204c 6973 7420             List 
-000028b0: 636f 6e74 6169 6e69 6e67 2074 6865 2063  containing the c
-000028c0: 6f6f 7264 696e 6174 6573 206f 6620 7468  oordinates of th
-000028d0: 6520 7665 7274 6963 6573 206f 6620 6561  e vertices of ea
-000028e0: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
-000028f0: 2020 2070 6f6c 7967 6f6e 2c20 6f72 2064     polygon, or d
-00002900: 6963 7469 6f6e 6172 7920 7769 7468 2077  ictionary with w
-00002910: 6974 6820 7468 6520 6c69 7374 206f 6620  ith the list of 
-00002920: 706f 6c79 676f 6e73 2028 6966 0a20 2020  polygons (if.   
-00002930: 2020 2020 2020 2020 2020 2020 2060 6279               `by
-00002940: 5f73 7065 6360 2069 7320 5472 7565 292e  _spec` is True).
-00002950: 0a0a 2020 2020 2020 2020 4e6f 7465 3a0a  ..        Note:.
-00002960: 2020 2020 2020 2020 2020 2020 496e 7374              Inst
-00002970: 616e 6365 7320 6f66 2060 466c 6578 5061  ances of `FlexPa
-00002980: 7468 6020 616e 6420 6052 6f62 7573 7450  th` and `RobustP
-00002990: 6174 6860 2061 7265 2061 6c73 6f20 696e  ath` are also in
-000029a0: 636c 7564 6564 2069 6e0a 2020 2020 2020  cluded in.      
-000029b0: 2020 2020 2020 7468 6520 7265 7375 6c74        the result
-000029c0: 2062 7920 636f 6d70 7574 696e 6720 7468   by computing th
-000029d0: 6569 7220 706f 6c79 676f 6e61 6c20 626f  eir polygonal bo
-000029e0: 756e 6461 7279 2e0a 2020 2020 2020 2020  undary..        
-000029f0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00002a00: 726e 2067 6574 5f70 6f6c 7967 6f6e 7328  rn get_polygons(
-00002a10: 0a20 2020 2020 2020 2020 2020 2069 6e73  .            ins
-00002a20: 7461 6e63 653d 7365 6c66 2c0a 2020 2020  tance=self,.    
-00002a30: 2020 2020 2020 2020 6279 5f73 7065 633d          by_spec=
-00002a40: 6279 5f73 7065 632c 0a20 2020 2020 2020  by_spec,.       
-00002a50: 2020 2020 2064 6570 7468 3d64 6570 7468       depth=depth
-00002a60: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
-00002a70: 636c 7564 655f 7061 7468 733d 696e 636c  clude_paths=incl
-00002a80: 7564 655f 7061 7468 732c 0a20 2020 2020  ude_paths,.     
-00002a90: 2020 2020 2020 2061 735f 6172 7261 793d         as_array=
-00002aa0: 6173 5f61 7272 6179 2c0a 2020 2020 2020  as_array,.      
-00002ab0: 2020 2020 2020 6173 5f73 6861 7065 6c79        as_shapely
-00002ac0: 3d61 735f 7368 6170 656c 792c 0a20 2020  =as_shapely,.   
-00002ad0: 2020 2020 2020 2020 2061 735f 7368 6170           as_shap
-00002ae0: 656c 795f 6d65 7267 6564 3d61 735f 7368  ely_merged=as_sh
-00002af0: 6170 656c 795f 6d65 7267 6564 2c0a 2020  apely_merged,.  
-00002b00: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-00002b10: 2067 6574 5f64 6570 656e 6465 6e63 6965   get_dependencie
-00002b20: 7328 7365 6c66 2c20 7265 6375 7273 6976  s(self, recursiv
-00002b30: 653a 2062 6f6f 6c20 3d20 4661 6c73 6529  e: bool = False)
-00002b40: 202d 3e20 6c69 7374 5b43 6f6d 706f 6e65   -> list[Compone
-00002b50: 6e74 5d3a 0a20 2020 2020 2020 2022 2222  nt]:.        """
-00002b60: 5265 7475 726e 2061 206c 6973 7420 6f66  Return a list of
-00002b70: 2043 6f6d 706f 6e65 6e74 7320 7265 6665   Components refe
-00002b80: 7265 6e63 6564 2062 7920 7468 6973 2043  renced by this C
-00002b90: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
-00002ba0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00002bb0: 2020 2020 2072 6563 7572 7369 7665 3a20       recursive: 
-00002bc0: 4966 2054 7275 6520 7265 7475 726e 7320  If True returns 
-00002bd0: 6465 7065 6e64 656e 6369 6573 2072 6563  dependencies rec
-00002be0: 7572 7369 7665 6c79 2e0a 0a20 2020 2020  ursively...     
-00002bf0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00002c00: 6620 6e6f 7420 7265 6375 7273 6976 653a  f not recursive:
-00002c10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00002c20: 7572 6e20 6c69 7374 287b 7265 662e 7061  urn list({ref.pa
-00002c30: 7265 6e74 2066 6f72 2072 6566 2069 6e20  rent for ref in 
-00002c40: 7365 6c66 2e72 6566 6572 656e 6365 737d  self.references}
-00002c50: 290a 0a20 2020 2020 2020 2072 6566 6572  )..        refer
-00002c60: 656e 6365 735f 7365 7420 3d20 7365 7428  ences_set = set(
-00002c70: 290a 2020 2020 2020 2020 5f67 6574 5f64  ).        _get_d
-00002c80: 6570 656e 6465 6e63 6965 7328 7365 6c66  ependencies(self
-00002c90: 2c20 7265 6665 7265 6e63 6573 5f73 6574  , references_set
-00002ca0: 3d72 6566 6572 656e 6365 735f 7365 7429  =references_set)
-00002cb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00002cc0: 6c69 7374 2872 6566 6572 656e 6365 735f  list(references_
-00002cd0: 7365 7429 0a0a 2020 2020 6465 6620 6765  set)..    def ge
-00002ce0: 745f 636f 6d70 6f6e 656e 745f 7370 6563  t_component_spec
-00002cf0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00002d00: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-00002d10: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-00002d20: 2020 2020 2020 2022 636f 6d70 6f6e 656e         "componen
-00002d30: 7422 3a20 7365 6c66 2e73 6574 7469 6e67  t": self.setting
-00002d40: 732e 6675 6e63 7469 6f6e 5f6e 616d 652c  s.function_name,
-00002d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002d60: 2022 7365 7474 696e 6773 223a 2073 656c   "settings": sel
-00002d70: 662e 7365 7474 696e 6773 2e63 6861 6e67  f.settings.chang
-00002d80: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-00002d90: 7d0a 2020 2020 2020 2020 2020 2020 6966  }.            if
-00002da0: 2073 656c 662e 7365 7474 696e 6773 0a20   self.settings. 
-00002db0: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-00002dc0: 7b22 636f 6d70 6f6e 656e 7422 3a20 7365  {"component": se
-00002dd0: 6c66 2e6e 616d 652c 2022 7365 7474 696e  lf.name, "settin
-00002de0: 6773 223a 207b 7d7d 0a20 2020 2020 2020  gs": {}}.       
-00002df0: 2029 0a0a 2020 2020 6465 6620 5f5f 6765   )..    def __ge
-00002e00: 7469 7465 6d5f 5f28 7365 6c66 2c20 6b65  titem__(self, ke
-00002e10: 793a 2073 7472 207c 2069 6e74 2920 2d3e  y: str | int) ->
-00002e20: 2050 6f72 743a 0a20 2020 2020 2020 2022   Port:.        "
-00002e30: 2222 4163 6365 7373 2072 6566 6572 656e  ""Access referen
-00002e40: 6365 2070 6f72 7473 2e22 2222 0a20 2020  ce ports.""".   
-00002e50: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00002e60: 6365 286b 6579 2c20 696e 7429 3a0a 2020  ce(key, int):.  
-00002e70: 2020 2020 2020 2020 2020 6b65 7920 3d20            key = 
-00002e80: 6c69 7374 2873 656c 662e 706f 7274 732e  list(self.ports.
-00002e90: 6b65 7973 2829 295b 6b65 795d 0a0a 2020  keys())[key]..  
-00002ea0: 2020 2020 2020 6966 206b 6579 206e 6f74        if key not
-00002eb0: 2069 6e20 7365 6c66 2e70 6f72 7473 3a0a   in self.ports:.
-00002ec0: 2020 2020 2020 2020 2020 2020 706f 7274              port
-00002ed0: 7320 3d20 6c69 7374 2873 656c 662e 706f  s = list(self.po
-00002ee0: 7274 732e 6b65 7973 2829 290a 2020 2020  rts.keys()).    
-00002ef0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00002f00: 6c75 6545 7272 6f72 2866 227b 6b65 7921  lueError(f"{key!
-00002f10: 727d 206e 6f74 2069 6e20 7b70 6f72 7473  r} not in {ports
-00002f20: 7d22 290a 0a20 2020 2020 2020 2072 6574  }")..        ret
-00002f30: 7572 6e20 7365 6c66 2e70 6f72 7473 5b6b  urn self.ports[k
-00002f40: 6579 5d0a 0a20 2020 2064 6566 205f 5f6c  ey]..    def __l
-00002f50: 7368 6966 745f 5f28 7365 6c66 2c20 656c  shift__(self, el
-00002f60: 656d 656e 7429 202d 3e20 436f 6d70 6f6e  ement) -> Compon
-00002f70: 656e 7452 6566 6572 656e 6365 3a0a 2020  entReference:.  
-00002f80: 2020 2020 2020 2222 2243 6f6e 7665 6e69        """Conveni
-00002f90: 656e 6365 206f 7065 7261 746f 7220 6571  ence operator eq
-00002fa0: 7569 7661 6c65 6e74 2074 6f20 6164 645f  uivalent to add_
-00002fb0: 7265 6628 292e 2222 220a 2020 2020 2020  ref().""".      
-00002fc0: 2020 7265 7475 726e 2073 656c 662e 6164    return self.ad
-00002fd0: 645f 7265 6628 656c 656d 656e 7429 0a0a  d_ref(element)..
-00002fe0: 2020 2020 6465 6620 756e 6c6f 636b 2873      def unlock(s
-00002ff0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00003000: 2020 2020 2020 2222 224f 6e6c 7920 646f        """Only do
-00003010: 2074 6869 7320 6966 2079 6f75 206b 6e6f   this if you kno
-00003020: 7720 7768 6174 2079 6f75 2061 7265 2064  w what you are d
-00003030: 6f69 6e67 2e22 2222 0a20 2020 2020 2020  oing.""".       
-00003040: 2073 656c 662e 5f6c 6f63 6b65 6420 3d20   self._locked = 
-00003050: 4661 6c73 650a 0a20 2020 2064 6566 206c  False..    def l
-00003060: 6f63 6b28 7365 6c66 2920 2d3e 204e 6f6e  ock(self) -> Non
-00003070: 653a 0a20 2020 2020 2020 2022 2222 4d61  e:.        """Ma
-00003080: 6b65 7320 7375 7265 2063 6f6d 706f 6e65  kes sure compone
-00003090: 6e74 7320 6361 6e27 7420 6164 6420 6e65  nts can't add ne
-000030a0: 7720 656c 656d 656e 7473 206f 7220 6d6f  w elements or mo
-000030b0: 7665 2065 7869 7374 696e 6720 6f6e 6573  ve existing ones
-000030c0: 2e0a 0a20 2020 2020 2020 2043 6f6d 706f  ...        Compo
-000030d0: 6e65 6e74 7320 6c6f 636b 2061 7574 6f6d  nents lock autom
-000030e0: 6174 6963 616c 6c79 2077 6865 6e20 676f  atically when go
-000030f0: 696e 6720 696e 746f 2074 6865 2043 4143  ing into the CAC
-00003100: 4845 2074 6f0a 2020 2020 2020 2020 656e  HE to.        en
-00003110: 7375 7265 206f 6e65 2063 6f6d 706f 6e65  sure one compone
-00003120: 6e74 2064 6f65 7320 6e6f 7420 6368 616e  nt does not chan
-00003130: 6765 206f 7468 6572 730a 2020 2020 2020  ge others.      
-00003140: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
-00003150: 6c66 2e5f 6c6f 636b 6564 203d 2054 7275  lf._locked = Tru
-00003160: 650a 0a20 2020 2064 6566 205f 5f73 6574  e..    def __set
-00003170: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
-00003180: 2c20 656c 656d 656e 7429 3a0a 2020 2020  , element):.    
-00003190: 2020 2020 2222 2241 6c6c 6f77 2061 6464      """Allow add
-000031a0: 696e 6720 706f 6c79 676f 6e73 2061 6e64  ing polygons and
-000031b0: 2063 656c 6c20 7265 6665 7265 6e63 6573   cell references
-000031c0: 2e0a 0a20 2020 2020 2020 206c 696b 6520  ...        like 
-000031d0: 445b 2761 7263 3327 5d20 3d20 7067 2e61  D['arc3'] = pg.a
-000031e0: 7263 2829 0a0a 2020 2020 2020 2020 4172  rc()..        Ar
-000031f0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00003200: 6b65 793a 2041 6c69 6173 206e 616d 652e  key: Alias name.
-00003210: 0a20 2020 2020 2020 2020 2020 2065 6c65  .            ele
-00003220: 6d65 6e74 3a20 4f62 6a65 6374 2074 6861  ment: Object tha
-00003230: 7420 7769 6c6c 2062 6520 6163 6365 7373  t will be access
-00003240: 6962 6c65 2062 7920 616c 6961 7320 6e61  ible by alias na
-00003250: 6d65 2e0a 0a20 2020 2020 2020 2022 2222  me...        """
-00003260: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00003270: 7374 616e 6365 2865 6c65 6d65 6e74 2c20  stance(element, 
-00003280: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
-00003290: 6365 207c 2050 6f6c 7967 6f6e 293a 0a20  ce | Polygon):. 
-000032a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000032b0: 6e61 6d65 645f 7265 6665 7265 6e63 6573  named_references
-000032c0: 5b6b 6579 5d20 3d20 656c 656d 656e 740a  [key] = element.
-000032d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000032e0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000032f0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00003300: 2020 2020 2020 2020 2020 2020 6622 5472              f"Tr
-00003310: 6965 6420 746f 2061 7373 6967 6e20 616c  ied to assign al
-00003320: 6961 7320 7b6b 6579 2172 7d20 696e 2043  ias {key!r} in C
-00003330: 6f6d 706f 6e65 6e74 207b 7365 6c66 2e6e  omponent {self.n
-00003340: 616d 6521 727d 2c22 0a20 2020 2020 2020  ame!r},".       
-00003350: 2020 2020 2020 2020 2022 6275 7420 6661           "but fa
-00003360: 696c 6564 2062 6563 6175 7365 2074 6865  iled because the
-00003370: 2069 7465 6d20 7761 7320 6e6f 7420 6120   item was not a 
-00003380: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
-00003390: 6365 220a 2020 2020 2020 2020 2020 2020  ce".            
-000033a0: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
-000033b0: 686f 640a 2020 2020 6465 6620 5f5f 6765  hod.    def __ge
-000033c0: 745f 7661 6c69 6461 746f 7273 5f5f 2863  t_validators__(c
-000033d0: 6c73 293a 0a20 2020 2020 2020 2022 2222  ls):.        """
-000033e0: 4765 7420 7661 6c69 6461 746f 7273 2066  Get validators f
-000033f0: 6f72 2074 6865 2043 6f6d 706f 6e65 6e74  or the Component
-00003400: 206f 626a 6563 742e 2222 220a 2020 2020   object.""".    
-00003410: 2020 2020 7969 656c 6420 636c 732e 7661      yield cls.va
-00003420: 6c69 6461 7465 0a0a 2020 2020 4063 6c61  lidate..    @cla
-00003430: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00003440: 2076 616c 6964 6174 6528 636c 732c 2076   validate(cls, v
-00003450: 2c20 5f69 6e66 6f29 3a0a 2020 2020 2020  , _info):.      
-00003460: 2020 2222 2250 7964 616e 7469 6320 6173    """Pydantic as
-00003470: 7375 6d65 7320 636f 6d70 6f6e 656e 7420  sumes component 
-00003480: 6973 2076 616c 6964 2069 6620 7468 6520  is valid if the 
-00003490: 666f 6c6c 6f77 696e 6720 6172 6520 7472  following are tr
-000034a0: 7565 2e0a 0a20 2020 2020 2020 202d 206e  ue...        - n
-000034b0: 616d 6520 6368 6172 6163 7465 7273 203c  ame characters <
-000034c0: 2070 646b 2e63 656c 6c5f 6465 636f 7261   pdk.cell_decora
-000034d0: 746f 725f 7365 7474 696e 6773 2e6d 6178  tor_settings.max
-000034e0: 5f6e 616d 655f 6c65 6e67 7468 0a20 2020  _name_length.   
-000034f0: 2020 2020 202d 2069 7320 6e6f 7420 656d       - is not em
-00003500: 7074 7920 2868 6173 2072 6566 6572 656e  pty (has referen
-00003510: 6365 7320 6f72 2070 6f6c 7967 6f6e 7329  ces or polygons)
-00003520: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00003530: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-00003540: 746f 7279 2e70 646b 2069 6d70 6f72 7420  tory.pdk import 
-00003550: 6765 745f 6163 7469 7665 5f70 646b 0a0a  get_active_pdk..
-00003560: 2020 2020 2020 2020 7064 6b20 3d20 6765          pdk = ge
-00003570: 745f 6163 7469 7665 5f70 646b 2829 0a0a  t_active_pdk()..
-00003580: 2020 2020 2020 2020 6d61 785f 6e61 6d65          max_name
-00003590: 5f6c 656e 6774 6820 3d20 7064 6b2e 6365  _length = pdk.ce
-000035a0: 6c6c 5f64 6563 6f72 6174 6f72 5f73 6574  ll_decorator_set
-000035b0: 7469 6e67 732e 6d61 785f 6e61 6d65 5f6c  tings.max_name_l
-000035c0: 656e 6774 680a 2020 2020 2020 2020 6173  ength.        as
-000035d0: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
-000035e0: 0a20 2020 2020 2020 2020 2020 2076 2c20  .            v, 
-000035f0: 436f 6d70 6f6e 656e 740a 2020 2020 2020  Component.      
-00003600: 2020 292c 2066 2254 7970 6545 7272 6f72    ), f"TypeError
-00003610: 2c20 476f 7420 7b74 7970 6528 7629 7d2c  , Got {type(v)},
-00003620: 2065 7870 6563 7469 6e67 2043 6f6d 706f   expecting Compo
-00003630: 6e65 6e74 220a 2020 2020 2020 2020 6173  nent".        as
-00003640: 7365 7274 2028 0a20 2020 2020 2020 2020  sert (.         
-00003650: 2020 206c 656e 2876 2e6e 616d 6529 203c     len(v.name) <
-00003660: 3d20 6d61 785f 6e61 6d65 5f6c 656e 6774  = max_name_lengt
-00003670: 680a 2020 2020 2020 2020 292c 2066 226e  h.        ), f"n
-00003680: 616d 6520 607b 762e 6e61 6d65 7d60 207b  ame `{v.name}` {
-00003690: 6c65 6e28 762e 6e61 6d65 297d 203e 207b  len(v.name)} > {
-000036a0: 6d61 785f 6e61 6d65 5f6c 656e 6774 687d  max_name_length}
-000036b0: 2022 0a20 2020 2020 2020 2072 6574 7572   ".        retur
-000036c0: 6e20 760a 0a20 2020 2040 7072 6f70 6572  n v..    @proper
-000036d0: 7479 0a20 2020 2064 6566 206e 616d 6564  ty.    def named
-000036e0: 5f72 6566 6572 656e 6365 7328 7365 6c66  _references(self
-000036f0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00003700: 6e20 7365 6c66 2e5f 6e61 6d65 645f 7265  n self._named_re
-00003710: 6665 7265 6e63 6573 0a0a 2020 2020 6465  ferences..    de
-00003720: 6620 6164 645f 6c61 6265 6c28 0a20 2020  f add_label(.   
-00003730: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00003740: 2020 2074 6578 743a 2073 7472 203d 2022     text: str = "
-00003750: 6865 6c6c 6f22 2c0a 2020 2020 2020 2020  hello",.        
-00003760: 706f 7369 7469 6f6e 3a20 7475 706c 655b  position: tuple[
-00003770: 666c 6f61 742c 2066 6c6f 6174 5d20 3d20  float, float] = 
-00003780: 2830 2e30 2c20 302e 3029 2c0a 2020 2020  (0.0, 0.0),.    
-00003790: 2020 2020 6d61 676e 6966 6963 6174 696f      magnificatio
-000037a0: 6e3a 2066 6c6f 6174 203d 2031 2e30 2c0a  n: float = 1.0,.
-000037b0: 2020 2020 2020 2020 726f 7461 7469 6f6e          rotation
-000037c0: 3a20 666c 6f61 7420 3d20 302c 0a20 2020  : float = 0,.   
-000037d0: 2020 2020 2061 6e63 686f 723a 2073 7472       anchor: str
-000037e0: 203d 2022 6f22 2c0a 2020 2020 2020 2020   = "o",.        
-000037f0: 6c61 7965 723a 204c 6179 6572 5370 6563  layer: LayerSpec
-00003800: 203d 2022 5445 5854 222c 0a20 2020 2020   = "TEXT",.     
-00003810: 2020 2078 5f72 6566 6c65 6374 696f 6e3a     x_reflection:
-00003820: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-00003830: 2020 2029 202d 3e20 4c61 6265 6c3a 0a20     ) -> Label:. 
-00003840: 2020 2020 2020 2022 2222 4164 6473 204c         """Adds L
-00003850: 6162 656c 2074 6f20 7468 6520 436f 6d70  abel to the Comp
-00003860: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
-00003870: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00003880: 2020 7465 7874 3a20 4c61 6265 6c20 7465    text: Label te
-00003890: 7874 2e0a 2020 2020 2020 2020 2020 2020  xt..            
-000038a0: 706f 7369 7469 6f6e 3a20 782d 2c20 792d  position: x-, y-
-000038b0: 636f 6f72 6469 6e61 7465 7320 6f66 2074  coordinates of t
-000038c0: 6865 204c 6162 656c 206c 6f63 6174 696f  he Label locatio
-000038d0: 6e2e 0a20 2020 2020 2020 2020 2020 206d  n..            m
-000038e0: 6167 6e69 6669 6361 7469 6f6e 3a20 4d61  agnification: Ma
-000038f0: 676e 6966 6963 6174 696f 6e20 6661 6374  gnification fact
-00003900: 6f72 2066 6f72 2074 6865 204c 6162 656c  or for the Label
-00003910: 2074 6578 742e 0a20 2020 2020 2020 2020   text..         
-00003920: 2020 2072 6f74 6174 696f 6e3a 2041 6e67     rotation: Ang
-00003930: 6c65 2072 6f74 6174 696f 6e20 6f66 2074  le rotation of t
-00003940: 6865 204c 6162 656c 2074 6578 742e 0a20  he Label text.. 
-00003950: 2020 2020 2020 2020 2020 2061 6e63 686f             ancho
-00003960: 723a 207b 276e 272c 2027 6527 2c20 2773  r: {'n', 'e', 's
-00003970: 272c 2027 7727 2c20 276f 272c 2027 6e65  ', 'w', 'o', 'ne
-00003980: 272c 2027 6e77 272c 202e 2e2e 7d0a 2020  ', 'nw', ...}.  
-00003990: 2020 2020 2020 2020 2020 2020 2020 506f                Po
-000039a0: 7369 7469 6f6e 206f 6620 7468 6520 616e  sition of the an
-000039b0: 6368 6f72 2072 656c 6174 6976 6520 746f  chor relative to
-000039c0: 2074 6865 2074 6578 742e 0a20 2020 2020   the text..     
-000039d0: 2020 2020 2020 206c 6179 6572 3a20 5370         layer: Sp
-000039e0: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
-000039f0: 746f 2070 7574 204c 6162 656c 206f 6e2e  to put Label on.
-00003a00: 0a20 2020 2020 2020 2020 2020 2078 5f72  .            x_r
-00003a10: 6566 6c65 6374 696f 6e3a 2054 7275 6520  eflection: True 
-00003a20: 7265 666c 6563 7473 2061 6372 6f73 7320  reflects across 
-00003a30: 7468 6520 686f 7269 7a6f 6e74 616c 2061  the horizontal a
-00003a40: 7869 7320 6265 666f 7265 2072 6f74 6174  xis before rotat
-00003a50: 696f 6e2e 0a20 2020 2020 2020 2022 2222  ion..        """
-00003a60: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
-00003a70: 7366 6163 746f 7279 2e70 646b 2069 6d70  sfactory.pdk imp
-00003a80: 6f72 7420 6765 745f 6c61 7965 720a 0a20  ort get_layer.. 
-00003a90: 2020 2020 2020 206c 6179 6572 203d 2067         layer = g
-00003aa0: 6574 5f6c 6179 6572 286c 6179 6572 290a  et_layer(layer).
-00003ab0: 0a20 2020 2020 2020 2067 6473 5f6c 6179  .        gds_lay
-00003ac0: 6572 2c20 6764 735f 6461 7461 7479 7065  er, gds_datatype
-00003ad0: 203d 206c 6179 6572 0a0a 2020 2020 2020   = layer..      
-00003ae0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-00003af0: 6e63 6528 7465 7874 2c20 7374 7229 3a0a  nce(text, str):.
-00003b00: 2020 2020 2020 2020 2020 2020 7465 7874              text
-00003b10: 203d 2074 6578 740a 2020 2020 2020 2020   = text.        
-00003b20: 6c61 6265 6c20 3d20 4c61 6265 6c28 0a20  label = Label(. 
-00003b30: 2020 2020 2020 2020 2020 2074 6578 743d             text=
-00003b40: 7465 7874 2c0a 2020 2020 2020 2020 2020  text,.          
-00003b50: 2020 6f72 6967 696e 3d70 6f73 6974 696f    origin=positio
-00003b60: 6e2c 0a20 2020 2020 2020 2020 2020 2061  n,.            a
-00003b70: 6e63 686f 723d 616e 6368 6f72 2c0a 2020  nchor=anchor,.  
-00003b80: 2020 2020 2020 2020 2020 6d61 676e 6966            magnif
-00003b90: 6963 6174 696f 6e3d 6d61 676e 6966 6963  ication=magnific
-00003ba0: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
-00003bb0: 2020 2072 6f74 6174 696f 6e3d 726f 7461     rotation=rota
-00003bc0: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-00003bd0: 2020 6c61 7965 723d 6764 735f 6c61 7965    layer=gds_laye
-00003be0: 722c 0a20 2020 2020 2020 2020 2020 2074  r,.            t
-00003bf0: 6578 7474 7970 653d 6764 735f 6461 7461  exttype=gds_data
-00003c00: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-00003c10: 2020 785f 7265 666c 6563 7469 6f6e 3d78    x_reflection=x
-00003c20: 5f72 6566 6c65 6374 696f 6e2c 0a20 2020  _reflection,.   
-00003c30: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-00003c40: 656c 662e 6164 6428 6c61 6265 6c29 0a20  elf.add(label). 
-00003c50: 2020 2020 2020 2072 6574 7572 6e20 6c61         return la
-00003c60: 6265 6c0a 0a20 2020 2040 7072 6f70 6572  bel..    @proper
-00003c70: 7479 0a20 2020 2064 6566 2062 626f 7828  ty.    def bbox(
-00003c80: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00003c90: 2222 5265 7475 726e 7320 7468 6520 626f  ""Returns the bo
-00003ca0: 756e 6469 6e67 2062 6f78 206f 6620 7468  unding box of th
-00003cb0: 6520 436f 6d70 6f6e 656e 7452 6566 6572  e ComponentRefer
-00003cc0: 656e 6365 2e22 2222 0a20 2020 2020 2020  ence.""".       
-00003cd0: 2062 626f 7820 3d20 7365 6c66 2e5f 6365   bbox = self._ce
-00003ce0: 6c6c 2e62 6f75 6e64 696e 675f 626f 7828  ll.bounding_box(
-00003cf0: 290a 2020 2020 2020 2020 6966 2062 626f  ).        if bbo
-00003d00: 7820 6973 204e 6f6e 653a 0a20 2020 2020  x is None:.     
-00003d10: 2020 2020 2020 2062 626f 7820 3d20 2828         bbox = ((
-00003d20: 302c 2030 292c 2028 302c 2030 2929 0a20  0, 0), (0, 0)). 
-00003d30: 2020 2020 2020 2072 6574 7572 6e20 736e         return sn
-00003d40: 6170 5f74 6f5f 6772 6964 286e 702e 6172  ap_to_grid(np.ar
-00003d50: 7261 7928 6262 6f78 2929 0a0a 2020 2020  ray(bbox))..    
-00003d60: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00003d70: 6620 706f 7274 735f 6c61 7965 7228 7365  f ports_layer(se
-00003d80: 6c66 2920 2d3e 2064 6963 745b 7374 722c  lf) -> dict[str,
-00003d90: 2073 7472 5d3a 0a20 2020 2020 2020 2022   str]:.        "
-00003da0: 2222 5265 7475 726e 7320 6120 6d61 7070  ""Returns a mapp
-00003db0: 696e 6720 6672 6f6d 206c 6179 6572 305f  ing from layer0_
-00003dc0: 6c61 7965 7231 5f45 303a 2070 6f72 744e  layer1_E0: portN
-00003dd0: 616d 652e 2222 220a 2020 2020 2020 2020  ame.""".        
-00003de0: 7265 7475 726e 206d 6170 5f70 6f72 7473  return map_ports
-00003df0: 5f6c 6179 6572 5f74 6f5f 6f72 6965 6e74  _layer_to_orient
-00003e00: 6174 696f 6e28 7365 6c66 2e70 6f72 7473  ation(self.ports
-00003e10: 290a 0a20 2020 2064 6566 2070 6f72 745f  )..    def port_
-00003e20: 6279 5f6f 7269 656e 7461 7469 6f6e 5f63  by_orientation_c
-00003e30: 7728 7365 6c66 2c20 6b65 793a 2073 7472  w(self, key: str
-00003e40: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-00003e50: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00003e60: 706f 7274 2062 7920 696e 6465 7869 6e67  port by indexing
-00003e70: 2074 6865 6d20 636c 6f63 6b77 6973 652e   them clockwise.
-00003e80: 2222 220a 2020 2020 2020 2020 6d20 3d20  """.        m = 
-00003e90: 6d61 705f 706f 7274 735f 746f 5f6f 7269  map_ports_to_ori
-00003ea0: 656e 7461 7469 6f6e 5f63 7728 7365 6c66  entation_cw(self
-00003eb0: 2e70 6f72 7473 2c20 2a2a 6b77 6172 6773  .ports, **kwargs
-00003ec0: 290a 2020 2020 2020 2020 6966 206b 6579  ).        if key
-00003ed0: 206e 6f74 2069 6e20 6d3a 0a20 2020 2020   not in m:.     
-00003ee0: 2020 2020 2020 2072 6169 7365 204b 6579         raise Key
-00003ef0: 4572 726f 7228 6622 7b6b 6579 7d20 6e6f  Error(f"{key} no
-00003f00: 7420 696e 207b 6c69 7374 286d 2e6b 6579  t in {list(m.key
-00003f10: 7328 2929 7d22 290a 2020 2020 2020 2020  s())}").        
-00003f20: 6b65 7932 203d 206d 5b6b 6579 5d0a 2020  key2 = m[key].  
-00003f30: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00003f40: 662e 706f 7274 735b 6b65 7932 5d0a 0a20  f.ports[key2].. 
-00003f50: 2020 2064 6566 2070 6f72 745f 6279 5f6f     def port_by_o
-00003f60: 7269 656e 7461 7469 6f6e 5f63 6377 2873  rientation_ccw(s
-00003f70: 656c 662c 206b 6579 3a20 7374 722c 202a  elf, key: str, *
-00003f80: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-00003f90: 2020 2222 2252 6574 7572 6e73 2070 6f72    """Returns por
-00003fa0: 7420 6279 2069 6e64 6578 696e 6720 7468  t by indexing th
-00003fb0: 656d 2063 6c6f 636b 7769 7365 2e22 2222  em clockwise."""
-00003fc0: 0a20 2020 2020 2020 206d 203d 206d 6170  .        m = map
-00003fd0: 5f70 6f72 7473 5f74 6f5f 6f72 6965 6e74  _ports_to_orient
-00003fe0: 6174 696f 6e5f 6363 7728 7365 6c66 2e70  ation_ccw(self.p
-00003ff0: 6f72 7473 2c20 2a2a 6b77 6172 6773 290a  orts, **kwargs).
-00004000: 2020 2020 2020 2020 6966 206b 6579 206e          if key n
-00004010: 6f74 2069 6e20 6d3a 0a20 2020 2020 2020  ot in m:.       
-00004020: 2020 2020 2072 6169 7365 204b 6579 4572       raise KeyEr
-00004030: 726f 7228 6622 7b6b 6579 7d20 6e6f 7420  ror(f"{key} not 
-00004040: 696e 207b 6c69 7374 286d 2e6b 6579 7328  in {list(m.keys(
-00004050: 2929 7d22 290a 2020 2020 2020 2020 6b65  ))}").        ke
-00004060: 7932 203d 206d 5b6b 6579 5d0a 2020 2020  y2 = m[key].    
-00004070: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00004080: 706f 7274 735b 6b65 7932 5d0a 0a20 2020  ports[key2]..   
-00004090: 2064 6566 2067 6574 5f70 6f72 7473 5f78   def get_ports_x
-000040a0: 7369 7a65 2873 656c 662c 202a 2a6b 7761  size(self, **kwa
-000040b0: 7267 7329 202d 3e20 666c 6f61 743a 0a20  rgs) -> float:. 
-000040c0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-000040d0: 7320 7864 6973 7461 6e63 6520 6672 6f6d  s xdistance from
-000040e0: 2065 6173 7420 746f 2077 6573 7420 706f   east to west po
-000040f0: 7274 732e 0a0a 2020 2020 2020 2020 4b65  rts...        Ke
-00004100: 7977 6f72 6420 4172 6773 3a0a 2020 2020  yword Args:.    
-00004110: 2020 2020 2020 2020 6c61 7965 723a 2070          layer: p
-00004120: 6f72 7420 4744 5320 6c61 7965 722e 0a20  ort GDS layer.. 
-00004130: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00004140: 783a 2077 6974 6820 696e 2070 6f72 7420  x: with in port 
-00004150: 6e61 6d65 2e0a 2020 2020 2020 2020 2020  name..          
-00004160: 2020 6f72 6965 6e74 6174 696f 6e3a 2069    orientation: i
-00004170: 6e20 6465 6772 6565 732e 0a20 2020 2020  n degrees..     
-00004180: 2020 2020 2020 2077 6964 7468 3a20 706f         width: po
-00004190: 7274 2077 6964 7468 2e0a 2020 2020 2020  rt width..      
-000041a0: 2020 2020 2020 6c61 7965 7273 5f65 7863        layers_exc
-000041b0: 6c75 6465 643a 204c 6973 7420 6f66 206c  luded: List of l
-000041c0: 6179 6572 7320 746f 2065 7863 6c75 6465  ayers to exclude
-000041d0: 2e0a 2020 2020 2020 2020 2020 2020 706f  ..            po
-000041e0: 7274 5f74 7970 653a 206f 7074 6963 616c  rt_type: optical
-000041f0: 2c20 656c 6563 7472 6963 616c 2c20 2e2e  , electrical, ..
-00004200: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00004210: 2020 2020 2020 706f 7274 735f 6377 203d        ports_cw =
-00004220: 2073 656c 662e 6765 745f 706f 7274 735f   self.get_ports_
-00004230: 6c69 7374 2863 6c6f 636b 7769 7365 3d54  list(clockwise=T
-00004240: 7275 652c 202a 2a6b 7761 7267 7329 0a20  rue, **kwargs). 
-00004250: 2020 2020 2020 2070 6f72 7473 5f63 6377         ports_ccw
-00004260: 203d 2073 656c 662e 6765 745f 706f 7274   = self.get_port
-00004270: 735f 6c69 7374 2863 6c6f 636b 7769 7365  s_list(clockwise
-00004280: 3d46 616c 7365 2c20 2a2a 6b77 6172 6773  =False, **kwargs
-00004290: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000042a0: 2070 6f72 7473 5f63 6377 5b30 5d2e 7820   ports_ccw[0].x 
-000042b0: 2d20 706f 7274 735f 6377 5b30 5d2e 780a  - ports_cw[0].x.
-000042c0: 0a20 2020 2064 6566 2067 6574 5f70 6f72  .    def get_por
-000042d0: 7473 5f79 7369 7a65 2873 656c 662c 202a  ts_ysize(self, *
-000042e0: 2a6b 7761 7267 7329 202d 3e20 666c 6f61  *kwargs) -> floa
-000042f0: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
-00004300: 7475 726e 7320 7964 6973 7461 6e63 6520  turns ydistance 
-00004310: 6672 6f6d 2065 6173 7420 746f 2077 6573  from east to wes
-00004320: 7420 706f 7274 732e 0a0a 2020 2020 2020  t ports...      
-00004330: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
-00004340: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00004350: 723a 2070 6f72 7420 4744 5320 6c61 7965  r: port GDS laye
-00004360: 722e 0a20 2020 2020 2020 2020 2020 2070  r..            p
-00004370: 7265 6669 783a 2077 6974 6820 696e 2070  refix: with in p
-00004380: 6f72 7420 6e61 6d65 2e0a 2020 2020 2020  ort name..      
-00004390: 2020 2020 2020 6f72 6965 6e74 6174 696f        orientatio
-000043a0: 6e3a 2069 6e20 6465 6772 6565 732e 0a20  n: in degrees.. 
-000043b0: 2020 2020 2020 2020 2020 2077 6964 7468             width
-000043c0: 3a20 706f 7274 2077 6964 7468 2028 756d  : port width (um
-000043d0: 292e 0a20 2020 2020 2020 2020 2020 206c  )..            l
-000043e0: 6179 6572 735f 6578 636c 7564 6564 3a20  ayers_excluded: 
-000043f0: 4c69 7374 206f 6620 6c61 7965 7273 2074  List of layers t
-00004400: 6f20 6578 636c 7564 652e 0a20 2020 2020  o exclude..     
-00004410: 2020 2020 2020 2070 6f72 745f 7479 7065         port_type
-00004420: 3a20 6f70 7469 6361 6c2c 2065 6c65 6374  : optical, elect
-00004430: 7269 6361 6c2c 202e 2e2e 0a20 2020 2020  rical, ....     
-00004440: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
-00004450: 6f72 7473 5f63 7720 3d20 7365 6c66 2e67  orts_cw = self.g
-00004460: 6574 5f70 6f72 7473 5f6c 6973 7428 636c  et_ports_list(cl
-00004470: 6f63 6b77 6973 653d 5472 7565 2c20 2a2a  ockwise=True, **
-00004480: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-00004490: 706f 7274 735f 6363 7720 3d20 7365 6c66  ports_ccw = self
-000044a0: 2e67 6574 5f70 6f72 7473 5f6c 6973 7428  .get_ports_list(
-000044b0: 636c 6f63 6b77 6973 653d 4661 6c73 652c  clockwise=False,
-000044c0: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-000044d0: 2020 2072 6574 7572 6e20 706f 7274 735f     return ports_
-000044e0: 6363 775b 305d 2e79 202d 2070 6f72 7473  ccw[0].y - ports
-000044f0: 5f63 775b 305d 2e79 0a0a 2020 2020 6465  _cw[0].y..    de
-00004500: 6620 706c 6f74 5f6e 6574 6c69 7374 280a  f plot_netlist(.
-00004510: 2020 2020 2020 2020 7365 6c66 2c20 7769          self, wi
-00004520: 7468 5f6c 6162 656c 733a 2062 6f6f 6c20  th_labels: bool 
-00004530: 3d20 5472 7565 2c20 666f 6e74 5f77 6569  = True, font_wei
-00004540: 6768 743a 2073 7472 203d 2022 6e6f 726d  ght: str = "norm
-00004550: 616c 222c 202a 2a6b 7761 7267 730a 2020  al", **kwargs.  
-00004560: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-00004570: 506c 6f74 7320 6120 6e65 746c 6973 7420  Plots a netlist 
-00004580: 6772 6170 6820 7769 7468 206e 6574 776f  graph with netwo
-00004590: 726b 782e 0a0a 2020 2020 2020 2020 4172  rkx...        Ar
-000045a0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-000045b0: 7769 7468 5f6c 6162 656c 733a 2061 6464  with_labels: add
-000045c0: 206c 6162 656c 2074 6f20 6561 6368 206e   label to each n
-000045d0: 6f64 652e 0a20 2020 2020 2020 2020 2020  ode..           
-000045e0: 2066 6f6e 745f 7765 6967 6874 3a20 6e6f   font_weight: no
-000045f0: 726d 616c 2c20 626f 6c64 2e0a 2020 2020  rmal, bold..    
-00004600: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-00004610: 3a20 6b65 7977 6f72 6420 6172 6775 6d65  : keyword argume
-00004620: 6e74 7320 666f 7220 7468 6520 6765 745f  nts for the get_
-00004630: 6e65 746c 6973 7420 6675 6e63 7469 6f6e  netlist function
-00004640: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00004650: 2020 2020 2069 6d70 6f72 7420 6d61 7470       import matp
-00004660: 6c6f 746c 6962 2e70 7970 6c6f 7420 6173  lotlib.pyplot as
-00004670: 2070 6c74 0a20 2020 2020 2020 2069 6d70   plt.        imp
-00004680: 6f72 7420 6e65 7477 6f72 6b78 2061 7320  ort networkx as 
-00004690: 6e78 0a0a 2020 2020 2020 2020 706c 742e  nx..        plt.
-000046a0: 6669 6775 7265 2829 0a20 2020 2020 2020  figure().       
-000046b0: 206e 6574 6c69 7374 203d 2073 656c 662e   netlist = self.
-000046c0: 6765 745f 6e65 746c 6973 7428 2a2a 6b77  get_netlist(**kw
-000046d0: 6172 6773 290a 2020 2020 2020 2020 636f  args).        co
-000046e0: 6e6e 6563 7469 6f6e 7320 3d20 6e65 746c  nnections = netl
-000046f0: 6973 745b 2263 6f6e 6e65 6374 696f 6e73  ist["connections
-00004700: 225d 0a20 2020 2020 2020 2070 6c61 6365  "].        place
-00004710: 6d65 6e74 7320 3d20 6e65 746c 6973 745b  ments = netlist[
-00004720: 2270 6c61 6365 6d65 6e74 7322 5d0a 2020  "placements"].  
-00004730: 2020 2020 2020 4720 3d20 6e78 2e47 7261        G = nx.Gra
-00004740: 7068 2829 0a20 2020 2020 2020 2047 2e61  ph().        G.a
-00004750: 6464 5f65 6467 6573 5f66 726f 6d28 0a20  dd_edges_from(. 
-00004760: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
-00004770: 2020 2020 2020 2020 2020 2020 2028 222c               (",
-00004780: 222e 6a6f 696e 286b 2e73 706c 6974 2822  ".join(k.split("
-00004790: 2c22 295b 3a2d 315d 292c 2022 2c22 2e6a  ,")[:-1]), ",".j
-000047a0: 6f69 6e28 762e 7370 6c69 7428 222c 2229  oin(v.split(",")
-000047b0: 5b3a 2d31 5d29 290a 2020 2020 2020 2020  [:-1])).        
-000047c0: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-000047d0: 2069 6e20 636f 6e6e 6563 7469 6f6e 732e   in connections.
-000047e0: 6974 656d 7328 290a 2020 2020 2020 2020  items().        
-000047f0: 2020 2020 5d0a 2020 2020 2020 2020 290a      ].        ).
-00004800: 2020 2020 2020 2020 706f 7320 3d20 7b6b          pos = {k
-00004810: 3a20 2876 5b22 7822 5d2c 2076 5b22 7922  : (v["x"], v["y"
-00004820: 5d29 2066 6f72 206b 2c20 7620 696e 2070  ]) for k, v in p
-00004830: 6c61 6365 6d65 6e74 732e 6974 656d 7328  lacements.items(
-00004840: 297d 0a20 2020 2020 2020 206c 6162 656c  )}.        label
-00004850: 7320 3d20 7b6b 3a20 222c 222e 6a6f 696e  s = {k: ",".join
-00004860: 286b 2e73 706c 6974 2822 2c22 295b 3a31  (k.split(",")[:1
-00004870: 5d29 2066 6f72 206b 2069 6e20 706c 6163  ]) for k in plac
-00004880: 656d 656e 7473 2e6b 6579 7328 297d 0a20  ements.keys()}. 
-00004890: 2020 2020 2020 206e 782e 6472 6177 280a         nx.draw(.
-000048a0: 2020 2020 2020 2020 2020 2020 472c 0a20              G,. 
-000048b0: 2020 2020 2020 2020 2020 2077 6974 685f             with_
-000048c0: 6c61 6265 6c73 3d77 6974 685f 6c61 6265  labels=with_labe
-000048d0: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
-000048e0: 666f 6e74 5f77 6569 6768 743d 666f 6e74  font_weight=font
-000048f0: 5f77 6569 6768 742c 0a20 2020 2020 2020  _weight,.       
-00004900: 2020 2020 206c 6162 656c 733d 6c61 6265       labels=labe
-00004910: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
-00004920: 706f 733d 706f 732c 0a20 2020 2020 2020  pos=pos,.       
-00004930: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-00004940: 6e20 470a 0a20 2020 2064 6566 2070 6c6f  n G..    def plo
-00004950: 745f 6e65 746c 6973 745f 666c 6174 280a  t_netlist_flat(.
-00004960: 2020 2020 2020 2020 7365 6c66 2c20 7769          self, wi
-00004970: 7468 5f6c 6162 656c 733a 2062 6f6f 6c20  th_labels: bool 
-00004980: 3d20 5472 7565 2c20 666f 6e74 5f77 6569  = True, font_wei
-00004990: 6768 743a 2073 7472 203d 2022 6e6f 726d  ght: str = "norm
-000049a0: 616c 222c 202a 2a6b 7761 7267 730a 2020  al", **kwargs.  
-000049b0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-000049c0: 506c 6f74 7320 6120 6e65 746c 6973 7420  Plots a netlist 
-000049d0: 6772 6170 6820 7769 7468 206e 6574 776f  graph with netwo
-000049e0: 726b 782e 0a0a 2020 2020 2020 2020 4172  rkx...        Ar
-000049f0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00004a00: 666c 6174 3a20 6966 2074 7275 652c 2077  flat: if true, w
-00004a10: 696c 6c20 706c 6f74 2074 6865 2066 6c61  ill plot the fla
-00004a20: 7420 6e65 746c 6973 740a 2020 2020 2020  t netlist.      
-00004a30: 2020 2020 2020 7769 7468 5f6c 6162 656c        with_label
-00004a40: 733a 2061 6464 206c 6162 656c 2074 6f20  s: add label to 
-00004a50: 6561 6368 206e 6f64 652e 0a20 2020 2020  each node..     
-00004a60: 2020 2020 2020 2066 6f6e 745f 7765 6967         font_weig
-00004a70: 6874 3a20 6e6f 726d 616c 2c20 626f 6c64  ht: normal, bold
-00004a80: 2e0a 2020 2020 2020 2020 2020 2020 2a2a  ..            **
-00004a90: 6b77 6172 6773 3a20 6b65 7977 6f72 6420  kwargs: keyword 
-00004aa0: 6172 6775 6d65 6e74 7320 666f 7220 7468  arguments for th
-00004ab0: 6520 6765 745f 6e65 746c 6973 7420 6675  e get_netlist fu
-00004ac0: 6e63 7469 6f6e 0a20 2020 2020 2020 2022  nction.        "
-00004ad0: 2222 0a20 2020 2020 2020 2069 6d70 6f72  "".        impor
-00004ae0: 7420 6d61 7470 6c6f 746c 6962 2e70 7970  t matplotlib.pyp
-00004af0: 6c6f 7420 6173 2070 6c74 0a20 2020 2020  lot as plt.     
-00004b00: 2020 2069 6d70 6f72 7420 6e65 7477 6f72     import networ
-00004b10: 6b78 2061 7320 6e78 0a0a 2020 2020 2020  kx as nx..      
-00004b20: 2020 706c 742e 6669 6775 7265 2829 0a20    plt.figure(). 
-00004b30: 2020 2020 2020 206e 6574 6c69 7374 203d         netlist =
-00004b40: 2073 656c 662e 6765 745f 6e65 746c 6973   self.get_netlis
-00004b50: 745f 666c 6174 282a 2a6b 7761 7267 7329  t_flat(**kwargs)
-00004b60: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
-00004b70: 696f 6e73 203d 206e 6574 6c69 7374 5b22  ions = netlist["
-00004b80: 636f 6e6e 6563 7469 6f6e 7322 5d0a 2020  connections"].  
-00004b90: 2020 2020 2020 706c 6163 656d 656e 7473        placements
-00004ba0: 203d 206e 6574 6c69 7374 5b22 706c 6163   = netlist["plac
-00004bb0: 656d 656e 7473 225d 0a20 2020 2020 2020  ements"].       
-00004bc0: 2063 6f6e 6e65 6374 696f 6e73 5f6c 6973   connections_lis
-00004bd0: 7420 3d20 5b5d 0a20 2020 2020 2020 2066  t = [].        f
-00004be0: 6f72 206b 2c20 765f 6c69 7374 2069 6e20  or k, v_list in 
-00004bf0: 636f 6e6e 6563 7469 6f6e 732e 6974 656d  connections.item
-00004c00: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00004c10: 2063 6f6e 6e65 6374 696f 6e73 5f6c 6973   connections_lis
-00004c20: 742e 6578 7465 6e64 280a 2020 2020 2020  t.extend(.      
-00004c30: 2020 2020 2020 2020 2020 2822 2c22 2e6a            (",".j
-00004c40: 6f69 6e28 6b2e 7370 6c69 7428 222c 2229  oin(k.split(",")
-00004c50: 5b3a 2d31 5d29 2c20 222c 222e 6a6f 696e  [:-1]), ",".join
-00004c60: 2876 2e73 706c 6974 2822 2c22 295b 3a2d  (v.split(",")[:-
-00004c70: 315d 2929 0a20 2020 2020 2020 2020 2020  1])).           
-00004c80: 2020 2020 2066 6f72 2076 2069 6e20 765f       for v in v_
-00004c90: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
-00004ca0: 2029 0a20 2020 2020 2020 2047 203d 206e   ).        G = n
-00004cb0: 782e 4772 6170 6828 290a 2020 2020 2020  x.Graph().      
-00004cc0: 2020 472e 6164 645f 6564 6765 735f 6672    G.add_edges_fr
-00004cd0: 6f6d 2863 6f6e 6e65 6374 696f 6e73 5f6c  om(connections_l
-00004ce0: 6973 7429 0a20 2020 2020 2020 2070 6f73  ist).        pos
-00004cf0: 203d 207b 6b3a 2028 765b 2278 225d 2c20   = {k: (v["x"], 
-00004d00: 765b 2279 225d 2920 666f 7220 6b2c 2076  v["y"]) for k, v
-00004d10: 2069 6e20 706c 6163 656d 656e 7473 2e69   in placements.i
-00004d20: 7465 6d73 2829 7d0a 2020 2020 2020 2020  tems()}.        
-00004d30: 6c61 6265 6c73 203d 207b 6b3a 2022 2c22  labels = {k: ","
-00004d40: 2e6a 6f69 6e28 6b2e 7370 6c69 7428 222c  .join(k.split(",
-00004d50: 2229 5b3a 315d 2920 666f 7220 6b20 696e  ")[:1]) for k in
-00004d60: 2070 6c61 6365 6d65 6e74 732e 6b65 7973   placements.keys
-00004d70: 2829 7d0a 2020 2020 2020 2020 6e78 2e64  ()}.        nx.d
-00004d80: 7261 7728 0a20 2020 2020 2020 2020 2020  raw(.           
-00004d90: 2047 2c0a 2020 2020 2020 2020 2020 2020   G,.            
-00004da0: 7769 7468 5f6c 6162 656c 733d 7769 7468  with_labels=with
-00004db0: 5f6c 6162 656c 732c 0a20 2020 2020 2020  _labels,.       
-00004dc0: 2020 2020 2066 6f6e 745f 7765 6967 6874       font_weight
-00004dd0: 3d66 6f6e 745f 7765 6967 6874 2c0a 2020  =font_weight,.  
-00004de0: 2020 2020 2020 2020 2020 6c61 6265 6c73            labels
-00004df0: 3d6c 6162 656c 732c 0a20 2020 2020 2020  =labels,.       
-00004e00: 2020 2020 2070 6f73 3d70 6f73 2c0a 2020       pos=pos,.  
-00004e10: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00004e20: 7265 7475 726e 2047 0a0a 2020 2020 6465  return G..    de
-00004e30: 6620 6765 745f 6e65 746c 6973 745f 7961  f get_netlist_ya
-00004e40: 6d6c 2873 656c 662c 202a 2a6b 7761 7267  ml(self, **kwarg
-00004e50: 7329 202d 3e20 6469 6374 5b73 7472 2c20  s) -> dict[str, 
-00004e60: 416e 795d 3a0a 2020 2020 2020 2020 6672  Any]:.        fr
-00004e70: 6f6d 2067 6473 6661 6374 6f72 792e 6765  om gdsfactory.ge
-00004e80: 745f 6e65 746c 6973 7420 696d 706f 7274  t_netlist import
-00004e90: 2067 6574 5f6e 6574 6c69 7374 5f79 616d   get_netlist_yam
-00004ea0: 6c0a 0a20 2020 2020 2020 2072 6574 7572  l..        retur
-00004eb0: 6e20 6765 745f 6e65 746c 6973 745f 7961  n get_netlist_ya
-00004ec0: 6d6c 2873 656c 662c 202a 2a6b 7761 7267  ml(self, **kwarg
-00004ed0: 7329 0a0a 2020 2020 6465 6620 7772 6974  s)..    def writ
-00004ee0: 655f 6e65 746c 6973 7428 7365 6c66 2c20  e_netlist(self, 
-00004ef0: 6669 6c65 7061 7468 3a20 7374 7229 202d  filepath: str) -
-00004f00: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00004f10: 2222 2257 7269 7465 206e 6574 6c69 7374  """Write netlist
-00004f20: 2069 6e20 5941 4d4c 2e22 2222 0a20 2020   in YAML.""".   
-00004f30: 2020 2020 206e 6574 6c69 7374 203d 2073       netlist = s
-00004f40: 656c 662e 6765 745f 6e65 746c 6973 7428  elf.get_netlist(
-00004f50: 290a 2020 2020 2020 2020 6e65 746c 6973  ).        netlis
-00004f60: 7420 3d20 636c 6561 6e5f 6469 6374 286e  t = clean_dict(n
-00004f70: 6574 6c69 7374 290a 2020 2020 2020 2020  etlist).        
-00004f80: 6669 6c65 7061 7468 203d 2070 6174 686c  filepath = pathl
-00004f90: 6962 2e50 6174 6828 6669 6c65 7061 7468  ib.Path(filepath
-00004fa0: 290a 2020 2020 2020 2020 6669 6c65 7061  ).        filepa
-00004fb0: 7468 2e77 7269 7465 5f74 6578 7428 7961  th.write_text(ya
-00004fc0: 6d6c 2e64 756d 7028 6e65 746c 6973 7429  ml.dump(netlist)
-00004fd0: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
-00004fe0: 5f6e 6574 6c69 7374 5f64 6f74 2873 656c  _netlist_dot(sel
-00004ff0: 662c 2066 696c 6570 6174 683a 2073 7472  f, filepath: str
-00005000: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2920   | None = None) 
-00005010: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00005020: 2022 2222 5772 6974 6520 6e65 746c 6973   """Write netlis
-00005030: 7420 6772 6170 6820 696e 2044 4f54 2066  t graph in DOT f
-00005040: 6f72 6d61 742e 2222 220a 2020 2020 2020  ormat.""".      
-00005050: 2020 6672 6f6d 206e 6574 776f 726b 782e    from networkx.
-00005060: 6472 6177 696e 672e 6e78 5f61 6772 6170  drawing.nx_agrap
-00005070: 6820 696d 706f 7274 2077 7269 7465 5f64  h import write_d
-00005080: 6f74 0a0a 2020 2020 2020 2020 6669 6c65  ot..        file
-00005090: 7061 7468 203d 2066 696c 6570 6174 6820  path = filepath 
-000050a0: 6f72 2066 227b 7365 6c66 2e6e 616d 657d  or f"{self.name}
-000050b0: 2e64 6f74 220a 0a20 2020 2020 2020 2047  .dot"..        G
-000050c0: 203d 2073 656c 662e 706c 6f74 5f6e 6574   = self.plot_net
-000050d0: 6c69 7374 2829 0a20 2020 2020 2020 2077  list().        w
-000050e0: 7269 7465 5f64 6f74 2847 2c20 6669 6c65  rite_dot(G, file
-000050f0: 7061 7468 290a 0a20 2020 2064 6566 2067  path)..    def g
-00005100: 6574 5f6e 6574 6c69 7374 2873 656c 662c  et_netlist(self,
-00005110: 202a 2a6b 7761 7267 7329 202d 3e20 6469   **kwargs) -> di
-00005120: 6374 5b73 7472 2c20 416e 795d 3a0a 2020  ct[str, Any]:.  
-00005130: 2020 2020 2020 2222 2246 726f 6d20 436f        """From Co
-00005140: 6d70 6f6e 656e 7420 7265 7475 726e 7320  mponent returns 
-00005150: 696e 7374 616e 6365 732c 2063 6f6e 6e65  instances, conne
-00005160: 6374 696f 6e73 2061 6e64 2070 6c61 6365  ctions and place
-00005170: 6d65 6e74 7320 6469 6374 2e0a 0a20 2020  ments dict...   
-00005180: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
-00005190: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-000051a0: 6f6d 706f 6e65 6e74 3a20 746f 2065 7874  omponent: to ext
-000051b0: 7261 6374 206e 6574 6c69 7374 2e0a 2020  ract netlist..  
-000051c0: 2020 2020 2020 2020 2020 6675 6c6c 5f73            full_s
-000051d0: 6574 7469 6e67 733a 2054 7275 6520 7265  ettings: True re
-000051e0: 7475 726e 7320 616c 6c2c 2066 616c 7365  turns all, false
-000051f0: 2063 6861 6e67 6564 2073 6574 7469 6e67   changed setting
-00005200: 732e 0a20 2020 2020 2020 2020 2020 2074  s..            t
-00005210: 6f6c 6572 616e 6365 3a20 746f 6c65 7261  olerance: tolera
-00005220: 6e63 6520 696e 206e 6d20 746f 2063 6f6e  nce in nm to con
-00005230: 7369 6465 7220 7477 6f20 706f 7274 7320  sider two ports 
-00005240: 636f 6e6e 6563 7465 642e 0a20 2020 2020  connected..     
-00005250: 2020 2020 2020 2065 7863 6c75 6465 5f70         exclude_p
-00005260: 6f72 745f 7479 7065 733a 206f 7074 696f  ort_types: optio
-00005270: 6e61 6c20 6c69 7374 206f 6620 706f 7274  nal list of port
-00005280: 2074 7970 6573 2074 6f20 6578 636c 7564   types to exclud
-00005290: 6520 6672 6f6d 206e 6574 6c69 7374 696e  e from netlistin
-000052a0: 672e 0a20 2020 2020 2020 2020 2020 2067  g..            g
-000052b0: 6574 5f69 6e73 7461 6e63 655f 6e61 6d65  et_instance_name
-000052c0: 3a20 6675 6e63 7469 6f6e 2074 6f20 6765  : function to ge
-000052d0: 7420 696e 7374 616e 6365 206e 616d 652e  t instance name.
-000052e0: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
-000052f0: 6f77 5f6d 756c 7469 706c 653a 2046 616c  ow_multiple: Fal
-00005300: 7365 2074 6f20 7261 6973 6520 616e 2065  se to raise an e
-00005310: 7272 6f72 2069 6620 6d6f 7265 2074 6861  rror if more tha
-00005320: 6e20 7477 6f20 706f 7274 7320 7368 6172  n two ports shar
-00005330: 6520 7468 6520 7361 6d65 2063 6f6e 6e65  e the same conne
-00005340: 6374 696f 6e2e 0a20 2020 2020 2020 2020  ction..         
-00005350: 2020 2020 2020 2069 6620 5472 7565 2c20         if True, 
-00005360: 7769 6c6c 2072 6574 7572 6e20 6b65 793a  will return key:
-00005370: 205b 7661 6c75 655d 2070 6169 7273 2077   [value] pairs w
-00005380: 6974 6820 5b76 616c 7565 5d20 6120 6c69  ith [value] a li
-00005390: 7374 206f 6620 616c 6c20 636f 6e6e 6563  st of all connec
-000053a0: 7465 6420 696e 7374 616e 6365 732e 0a0a  ted instances...
-000053b0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-000053c0: 0a20 2020 2020 2020 2020 2020 204e 6574  .            Net
-000053d0: 6c69 7374 2064 6963 7420 2869 6e73 7461  list dict (insta
-000053e0: 6e63 6573 2c20 636f 6e6e 6563 7469 6f6e  nces, connection
-000053f0: 732c 2070 6c61 6365 6d65 6e74 732c 2070  s, placements, p
-00005400: 6f72 7473 290a 2020 2020 2020 2020 2020  orts).          
-00005410: 2020 2020 2020 696e 7374 616e 6365 733a        instances:
-00005420: 2044 6963 7420 6f66 2069 6e73 7461 6e63   Dict of instanc
-00005430: 6520 6e61 6d65 2061 6e64 2073 6574 7469  e name and setti
-00005440: 6e67 732e 0a20 2020 2020 2020 2020 2020  ngs..           
-00005450: 2020 2020 2063 6f6e 6e65 6374 696f 6e73       connections
-00005460: 3a20 4469 6374 206f 6620 496e 7374 616e  : Dict of Instan
-00005470: 6365 314e 616d 652c 706f 7274 4e61 6d65  ce1Name,portName
-00005480: 3a20 496e 7374 616e 6365 324e 616d 652c  : Instance2Name,
-00005490: 706f 7274 4e61 6d65 2e0a 2020 2020 2020  portName..      
-000054a0: 2020 2020 2020 2020 2020 706c 6163 656d            placem
-000054b0: 656e 7473 3a20 4469 6374 206f 6620 696e  ents: Dict of in
-000054c0: 7374 616e 6365 206e 616d 6573 2061 6e64  stance names and
-000054d0: 2070 6c61 6365 6d65 6e74 7320 2878 2c20   placements (x, 
-000054e0: 792c 2072 6f74 6174 696f 6e29 2e0a 2020  y, rotation)..  
-000054f0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00005500: 7274 733a 2044 6963 7420 706f 7274 4e61  rts: Dict portNa
-00005510: 6d65 3a20 436f 6d70 6f6e 656e 744e 616d  me: ComponentNam
-00005520: 652c 706f 7274 2e0a 2020 2020 2020 2020  e,port..        
-00005530: 2020 2020 2020 2020 6e61 6d65 3a20 6e61          name: na
-00005540: 6d65 206f 6620 636f 6d70 6f6e 656e 742e  me of component.
-00005550: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00005560: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-00005570: 746f 7279 2e67 6574 5f6e 6574 6c69 7374  tory.get_netlist
-00005580: 2069 6d70 6f72 7420 6765 745f 6e65 746c   import get_netl
-00005590: 6973 740a 0a20 2020 2020 2020 2072 6574  ist..        ret
-000055a0: 7572 6e20 6765 745f 6e65 746c 6973 7428  urn get_netlist(
-000055b0: 636f 6d70 6f6e 656e 743d 7365 6c66 2c20  component=self, 
-000055c0: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
-000055d0: 6566 2067 6574 5f6e 6574 6c69 7374 5f72  ef get_netlist_r
-000055e0: 6563 7572 7369 7665 2873 656c 662c 202a  ecursive(self, *
-000055f0: 2a6b 7761 7267 7329 202d 3e20 6469 6374  *kwargs) -> dict
-00005600: 5b73 7472 2c20 4469 6374 436f 6e66 6967  [str, DictConfig
-00005610: 5d3a 0a20 2020 2020 2020 2022 2222 5265  ]:.        """Re
-00005620: 7475 726e 7320 7265 6375 7273 6976 6520  turns recursive 
-00005630: 6e65 746c 6973 7420 666f 7220 6120 636f  netlist for a co
-00005640: 6d70 6f6e 656e 7420 616e 6420 7375 6263  mponent and subc
-00005650: 6f6d 706f 6e65 6e74 732e 0a0a 2020 2020  omponents...    
-00005660: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
-00005670: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00005680: 6d70 6f6e 656e 743a 2074 6f20 6578 7472  mponent: to extr
-00005690: 6163 7420 6e65 746c 6973 742e 0a20 2020  act netlist..   
-000056a0: 2020 2020 2020 2020 2063 6f6d 706f 6e65           compone
-000056b0: 6e74 5f73 7566 6669 783a 2073 7566 6669  nt_suffix: suffi
-000056c0: 7820 746f 2061 7070 656e 6420 746f 2065  x to append to e
-000056d0: 6163 6820 636f 6d70 6f6e 656e 7420 6e61  ach component na
-000056e0: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
-000056f0: 2020 2020 7573 6566 756c 2069 6620 746f      useful if to
-00005700: 2073 6176 6520 616e 6420 7265 6c6f 6164   save and reload
-00005710: 2061 2062 6163 6b2d 616e 6e6f 7461 7465   a back-annotate
-00005720: 6420 6e65 746c 6973 742e 0a20 2020 2020  d netlist..     
-00005730: 2020 2020 2020 2067 6574 5f6e 6574 6c69         get_netli
-00005740: 7374 5f66 756e 633a 2066 756e 6374 696f  st_func: functio
-00005750: 6e20 746f 2065 7874 7261 6374 2069 6e64  n to extract ind
-00005760: 6976 6964 7561 6c20 6e65 746c 6973 7473  ividual netlists
-00005770: 2e0a 2020 2020 2020 2020 2020 2020 6675  ..            fu
-00005780: 6c6c 5f73 6574 7469 6e67 733a 2054 7275  ll_settings: Tru
-00005790: 6520 7265 7475 726e 7320 616c 6c2c 2066  e returns all, f
-000057a0: 616c 7365 2063 6861 6e67 6564 2073 6574  alse changed set
-000057b0: 7469 6e67 732e 0a20 2020 2020 2020 2020  tings..         
-000057c0: 2020 2074 6f6c 6572 616e 6365 3a20 746f     tolerance: to
-000057d0: 6c65 7261 6e63 6520 696e 206e 6d20 746f  lerance in nm to
-000057e0: 2063 6f6e 7369 6465 7220 7477 6f20 706f   consider two po
-000057f0: 7274 7320 636f 6e6e 6563 7465 642e 0a20  rts connected.. 
-00005800: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
-00005810: 6465 5f70 6f72 745f 7479 7065 733a 206f  de_port_types: o
-00005820: 7074 696f 6e61 6c20 6c69 7374 206f 6620  ptional list of 
-00005830: 706f 7274 2074 7970 6573 2074 6f20 6578  port types to ex
-00005840: 636c 7564 6520 6672 6f6d 206e 6574 6c69  clude from netli
-00005850: 7374 696e 672e 0a20 2020 2020 2020 2020  sting..         
-00005860: 2020 2067 6574 5f69 6e73 7461 6e63 655f     get_instance_
-00005870: 6e61 6d65 3a20 6675 6e63 7469 6f6e 2074  name: function t
-00005880: 6f20 6765 7420 696e 7374 616e 6365 206e  o get instance n
-00005890: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
-000058a0: 2061 6c6c 6f77 5f6d 756c 7469 706c 653a   allow_multiple:
-000058b0: 2046 616c 7365 2074 6f20 7261 6973 6520   False to raise 
-000058c0: 616e 2065 7272 6f72 2069 6620 6d6f 7265  an error if more
-000058d0: 2074 6861 6e20 7477 6f20 706f 7274 7320   than two ports 
-000058e0: 7368 6172 6520 7468 6520 7361 6d65 2063  share the same c
-000058f0: 6f6e 6e65 6374 696f 6e2e 0a20 2020 2020  onnection..     
-00005900: 2020 2020 2020 2020 2020 2069 6620 5472             if Tr
-00005910: 7565 2c20 7769 6c6c 2072 6574 7572 6e20  ue, will return 
-00005920: 6b65 793a 205b 7661 6c75 655d 2070 6169  key: [value] pai
-00005930: 7273 2077 6974 6820 5b76 616c 7565 5d20  rs with [value] 
-00005940: 6120 6c69 7374 206f 6620 616c 6c20 636f  a list of all co
-00005950: 6e6e 6563 7465 6420 696e 7374 616e 6365  nnected instance
-00005960: 732e 0a0a 2020 2020 2020 2020 5265 7475  s...        Retu
-00005970: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
-00005980: 2044 6963 7469 6f6e 6172 7920 6f66 206e   Dictionary of n
-00005990: 6574 6c69 7374 732c 206b 6579 6564 2062  etlists, keyed b
-000059a0: 7920 7468 6520 6e61 6d65 206f 6620 6561  y the name of ea
-000059b0: 6368 2063 6f6d 706f 6e65 6e74 2e0a 2020  ch component..  
-000059c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000059d0: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
-000059e0: 792e 6765 745f 6e65 746c 6973 7420 696d  y.get_netlist im
-000059f0: 706f 7274 2067 6574 5f6e 6574 6c69 7374  port get_netlist
-00005a00: 5f72 6563 7572 7369 7665 0a0a 2020 2020  _recursive..    
-00005a10: 2020 2020 7265 7475 726e 2067 6574 5f6e      return get_n
-00005a20: 6574 6c69 7374 5f72 6563 7572 7369 7665  etlist_recursive
-00005a30: 2863 6f6d 706f 6e65 6e74 3d73 656c 662c  (component=self,
-00005a40: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00005a50: 6465 6620 6765 745f 6e65 746c 6973 745f  def get_netlist_
-00005a60: 666c 6174 2873 656c 662c 202a 2a6b 7761  flat(self, **kwa
-00005a70: 7267 7329 202d 3e20 6469 6374 5b73 7472  rgs) -> dict[str
-00005a80: 2c20 4469 6374 436f 6e66 6967 5d3a 0a20  , DictConfig]:. 
-00005a90: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00005aa0: 7320 6120 6e65 746c 6973 7420 7768 6572  s a netlist wher
-00005ab0: 6520 616c 6c20 7375 6269 6e73 7461 6e63  e all subinstanc
-00005ac0: 6573 2061 7265 2065 7870 6f73 6564 2061  es are exposed a
-00005ad0: 6e64 2069 6e64 6570 656e 6465 6e74 6c79  nd independently
-00005ae0: 206e 616d 6564 2e0a 0a20 2020 2020 2020   named...       
-00005af0: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
-00005b00: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
-00005b10: 6e65 6e74 3a20 746f 2065 7874 7261 6374  nent: to extract
-00005b20: 206e 6574 6c69 7374 2e0a 2020 2020 2020   netlist..      
-00005b30: 2020 2020 2020 636f 6d70 6f6e 656e 745f        component_
-00005b40: 7375 6666 6978 3a20 7375 6666 6978 2074  suffix: suffix t
-00005b50: 6f20 6170 7065 6e64 2074 6f20 6561 6368  o append to each
-00005b60: 2063 6f6d 706f 6e65 6e74 206e 616d 652e   component name.
-00005b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005b80: 2075 7365 6675 6c20 6966 2074 6f20 7361   useful if to sa
-00005b90: 7665 2061 6e64 2072 656c 6f61 6420 6120  ve and reload a 
-00005ba0: 6261 636b 2d61 6e6e 6f74 6174 6564 206e  back-annotated n
-00005bb0: 6574 6c69 7374 2e0a 2020 2020 2020 2020  etlist..        
-00005bc0: 2020 2020 6765 745f 6e65 746c 6973 745f      get_netlist_
-00005bd0: 6675 6e63 3a20 6675 6e63 7469 6f6e 2074  func: function t
-00005be0: 6f20 6578 7472 6163 7420 696e 6469 7669  o extract indivi
-00005bf0: 6475 616c 206e 6574 6c69 7374 732e 0a20  dual netlists.. 
-00005c00: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
-00005c10: 7365 7474 696e 6773 3a20 5472 7565 2072  settings: True r
-00005c20: 6574 7572 6e73 2061 6c6c 2c20 6661 6c73  eturns all, fals
-00005c30: 6520 6368 616e 6765 6420 7365 7474 696e  e changed settin
-00005c40: 6773 2e0a 2020 2020 2020 2020 2020 2020  gs..            
-00005c50: 746f 6c65 7261 6e63 653a 2074 6f6c 6572  tolerance: toler
-00005c60: 616e 6365 2069 6e20 6e6d 2074 6f20 636f  ance in nm to co
-00005c70: 6e73 6964 6572 2074 776f 2070 6f72 7473  nsider two ports
-00005c80: 2063 6f6e 6e65 6374 6564 2e0a 2020 2020   connected..    
-00005c90: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
-00005ca0: 706f 7274 5f74 7970 6573 3a20 6f70 7469  port_types: opti
-00005cb0: 6f6e 616c 206c 6973 7420 6f66 2070 6f72  onal list of por
-00005cc0: 7420 7479 7065 7320 746f 2065 7863 6c75  t types to exclu
-00005cd0: 6465 2066 726f 6d20 6e65 746c 6973 7469  de from netlisti
-00005ce0: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
-00005cf0: 6765 745f 696e 7374 616e 6365 5f6e 616d  get_instance_nam
-00005d00: 653a 2066 756e 6374 696f 6e20 746f 2067  e: function to g
-00005d10: 6574 2069 6e73 7461 6e63 6520 6e61 6d65  et instance name
-00005d20: 2e0a 2020 2020 2020 2020 2020 2020 616c  ..            al
-00005d30: 6c6f 775f 6d75 6c74 6970 6c65 3a20 4661  low_multiple: Fa
-00005d40: 6c73 6520 746f 2072 6169 7365 2061 6e20  lse to raise an 
-00005d50: 6572 726f 7220 6966 206d 6f72 6520 7468  error if more th
-00005d60: 616e 2074 776f 2070 6f72 7473 2073 6861  an two ports sha
-00005d70: 7265 2074 6865 2073 616d 6520 636f 6e6e  re the same conn
-00005d80: 6563 7469 6f6e 2e0a 2020 2020 2020 2020  ection..        
-00005d90: 2020 2020 2020 2020 6966 2054 7275 652c          if True,
-00005da0: 2077 696c 6c20 7265 7475 726e 206b 6579   will return key
-00005db0: 3a20 5b76 616c 7565 5d20 7061 6972 7320  : [value] pairs 
-00005dc0: 7769 7468 205b 7661 6c75 655d 2061 206c  with [value] a l
-00005dd0: 6973 7420 6f66 2061 6c6c 2063 6f6e 6e65  ist of all conne
-00005de0: 6374 6564 2069 6e73 7461 6e63 6573 2e0a  cted instances..
-00005df0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00005e00: 3a0a 2020 2020 2020 2020 2020 2020 4469  :.            Di
-00005e10: 6374 696f 6e61 7279 206f 6620 6e65 746c  ctionary of netl
-00005e20: 6973 7473 2c20 6b65 7965 6420 6279 2074  ists, keyed by t
-00005e30: 6865 206e 616d 6520 6f66 2065 6163 6820  he name of each 
-00005e40: 636f 6d70 6f6e 656e 742e 0a20 2020 2020  component..     
-00005e50: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00005e60: 726f 6d20 6764 7366 6163 746f 7279 2e67  rom gdsfactory.g
-00005e70: 6574 5f6e 6574 6c69 7374 5f66 6c61 7420  et_netlist_flat 
-00005e80: 696d 706f 7274 2067 6574 5f6e 6574 6c69  import get_netli
-00005e90: 7374 5f66 6c61 740a 0a20 2020 2020 2020  st_flat..       
-00005ea0: 2072 6574 7572 6e20 6765 745f 6e65 746c   return get_netl
-00005eb0: 6973 745f 666c 6174 2863 6f6d 706f 6e65  ist_flat(compone
-00005ec0: 6e74 3d73 656c 662c 202a 2a6b 7761 7267  nt=self, **kwarg
-00005ed0: 7329 0a0a 2020 2020 6465 6620 6173 7365  s)..    def asse
-00005ee0: 7274 5f70 6f72 7473 5f6f 6e5f 6772 6964  rt_ports_on_grid
-00005ef0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-00005f00: 6772 6964 5f66 6163 746f 723a 2069 6e74  grid_factor: int
-00005f10: 203d 2031 2c20 6572 726f 725f 7479 7065   = 1, error_type
-00005f20: 3a20 7374 7220 3d20 2265 7272 6f72 220a  : str = "error".
-00005f30: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-00005f40: 2020 2020 2020 2022 2222 4173 7365 7274         """Assert
-00005f50: 7320 7468 6174 2061 6c6c 2070 6f72 7473  s that all ports
-00005f60: 2061 7265 206f 6e20 6772 6964 2e22 2222   are on grid."""
-00005f70: 0a20 2020 2020 2020 2066 6f72 2070 6f72  .        for por
-00005f80: 7420 696e 2073 656c 662e 706f 7274 732e  t in self.ports.
-00005f90: 7661 6c75 6573 2829 3a0a 2020 2020 2020  values():.      
-00005fa0: 2020 2020 2020 706f 7274 2e61 7373 6572        port.asser
-00005fb0: 745f 6f6e 5f67 7269 6428 6772 6964 5f66  t_on_grid(grid_f
-00005fc0: 6163 746f 723d 6772 6964 5f66 6163 746f  actor=grid_facto
-00005fd0: 722c 2065 7272 6f72 5f74 7970 653d 6572  r, error_type=er
-00005fe0: 726f 725f 7479 7065 290a 0a20 2020 2064  ror_type)..    d
-00005ff0: 6566 2061 7373 6572 745f 706f 7274 735f  ef assert_ports_
-00006000: 6d61 6e68 6174 7461 6e28 7365 6c66 2c20  manhattan(self, 
-00006010: 6572 726f 725f 7479 7065 3a20 7374 7220  error_type: str 
-00006020: 3d20 2265 7272 6f72 2229 202d 3e20 4e6f  = "error") -> No
-00006030: 6e65 3a0a 2020 2020 2020 2020 2222 2241  ne:.        """A
-00006040: 7373 6572 7473 2074 6861 7420 616c 6c20  sserts that all 
-00006050: 706f 7274 7320 6172 6520 6f6e 206d 616e  ports are on man
-00006060: 6861 7474 616e 2061 6e67 6c65 7320 2830  hattan angles (0
-00006070: 2c20 3930 2c20 3138 302c 2032 3730 292e  , 90, 180, 270).
-00006080: 2222 220a 2020 2020 2020 2020 666f 7220  """.        for 
-00006090: 706f 7274 2069 6e20 7365 6c66 2e70 6f72  port in self.por
-000060a0: 7473 2e76 616c 7565 7328 293a 0a20 2020  ts.values():.   
-000060b0: 2020 2020 2020 2020 2070 6f72 742e 6173           port.as
-000060c0: 7365 7274 5f6d 616e 6861 7474 616e 2865  sert_manhattan(e
-000060d0: 7272 6f72 5f74 7970 653d 6572 726f 725f  rror_type=error_
-000060e0: 7479 7065 290a 0a20 2020 2064 6566 2067  type)..    def g
-000060f0: 6574 5f70 6f72 7473 2873 656c 662c 2064  et_ports(self, d
-00006100: 6570 7468 3a20 696e 7420 7c20 4e6f 6e65  epth: int | None
-00006110: 203d 2030 293a 0a20 2020 2020 2020 2022   = 0):.        "
-00006120: 2222 5265 7475 726e 7320 636f 7069 6573  ""Returns copies
-00006130: 206f 6620 616c 6c20 7468 6520 706f 7274   of all the port
-00006140: 7320 6f66 2074 6865 2043 6f6d 706f 6e65  s of the Compone
-00006150: 6e74 2c20 726f 7461 7465 6420 616e 6420  nt, rotated and 
-00006160: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00006170: 2020 7472 616e 736c 6174 6564 2073 6f20    translated so 
-00006180: 7468 6174 2074 6865 7927 7265 2069 6e20  that they're in 
-00006190: 7468 6569 7220 746f 702d 6c65 7665 6c20  their top-level 
-000061a0: 706f 7369 7469 6f6e 2e0a 0a20 2020 2020  position...     
-000061b0: 2020 2054 6865 2050 6f72 7473 2072 6574     The Ports ret
-000061c0: 7572 6e65 6420 6172 6520 636f 7069 6573  urned are copies
-000061d0: 206f 6620 7468 6520 6f72 6967 696e 616c   of the original
-000061e0: 732c 2062 7574 2065 6163 6820 636f 7079  s, but each copy
-000061f0: 2068 6173 2074 6865 2073 616d 650a 2020   has the same.  
-00006200: 2020 2020 2020 6060 7569 6460 6020 6173        ``uid`` as
-00006210: 2074 6865 206f 7269 6769 6e61 6c20 736f   the original so
-00006220: 2074 6861 7420 7468 6579 2063 616e 2062   that they can b
-00006230: 6520 7472 6163 6564 2062 6163 6b20 746f  e traced back to
-00006240: 2074 6865 206f 7269 6769 6e61 6c20 6966   the original if
-00006250: 206e 6565 6465 642e 0a0a 2020 2020 2020   needed...      
-00006260: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00006270: 2020 2020 6465 7074 683a 2049 6620 6e6f      depth: If no
-00006280: 7420 4e6f 6e65 2c20 6465 6669 6e65 7320  t None, defines 
-00006290: 6672 6f6d 2068 6f77 206d 616e 7920 7265  from how many re
-000062a0: 6665 7265 6e63 6520 6c65 7665 6c73 2074  ference levels t
-000062b0: 6f20 7265 7472 6965 7665 2050 6f72 7473  o retrieve Ports
-000062c0: 2066 726f 6d2e 0a0a 2020 2020 2020 2020   from...        
-000062d0: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
-000062e0: 2020 2020 2070 6f72 745f 6c69 7374 203a       port_list :
-000062f0: 206c 6973 7420 6f66 2050 6f72 7420 4c69   list of Port Li
-00006300: 7374 206f 6620 616c 6c20 506f 7274 7320  st of all Ports 
-00006310: 696e 2074 6865 2043 6f6d 706f 6e65 6e74  in the Component
-00006320: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00006330: 2020 2020 2020 706f 7274 5f6c 6973 7420        port_list 
-00006340: 3d20 5b70 2e5f 636f 7079 2829 2066 6f72  = [p._copy() for
-00006350: 2070 2069 6e20 7365 6c66 2e70 6f72 7473   p in self.ports
-00006360: 2e76 616c 7565 7328 295d 0a0a 2020 2020  .values()]..    
-00006370: 2020 2020 6966 2064 6570 7468 2069 7320      if depth is 
-00006380: 4e6f 6e65 206f 7220 6465 7074 6820 3e20  None or depth > 
-00006390: 303a 0a20 2020 2020 2020 2020 2020 2066  0:.            f
-000063a0: 6f72 2072 2069 6e20 7365 6c66 2e72 6566  or r in self.ref
-000063b0: 6572 656e 6365 733a 0a20 2020 2020 2020  erences:.       
-000063c0: 2020 2020 2020 2020 206e 6577 5f64 6570           new_dep
-000063d0: 7468 203d 204e 6f6e 6520 6966 2064 6570  th = None if dep
-000063e0: 7468 2069 7320 4e6f 6e65 2065 6c73 6520  th is None else 
-000063f0: 6465 7074 6820 2d20 310a 2020 2020 2020  depth - 1.      
-00006400: 2020 2020 2020 2020 2020 7265 665f 706f            ref_po
-00006410: 7274 7320 3d20 722e 7061 7265 6e74 2e67  rts = r.parent.g
-00006420: 6574 5f70 6f72 7473 2864 6570 7468 3d6e  et_ports(depth=n
-00006430: 6577 5f64 6570 7468 290a 0a20 2020 2020  ew_depth)..     
-00006440: 2020 2020 2020 2020 2020 2023 2054 7261             # Tra
-00006450: 6e73 666f 726d 2070 6f72 7473 2074 6861  nsform ports tha
-00006460: 7420 6361 6d65 2066 726f 6d20 6120 7265  t came from a re
-00006470: 6665 7265 6e63 650a 2020 2020 2020 2020  ference.        
-00006480: 2020 2020 2020 2020 7265 665f 706f 7274          ref_port
-00006490: 735f 7472 616e 7366 6f72 6d65 6420 3d20  s_transformed = 
-000064a0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-000064b0: 2020 2066 6f72 2072 7020 696e 2072 6566     for rp in ref
-000064c0: 5f70 6f72 7473 3a0a 2020 2020 2020 2020  _ports:.        
-000064d0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-000064e0: 706f 7274 203d 2072 702e 5f63 6f70 7928  port = rp._copy(
-000064f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00006500: 2020 2020 2020 6e65 775f 6365 6e74 6572        new_center
-00006510: 2c20 6e65 775f 6f72 6965 6e74 6174 696f  , new_orientatio
-00006520: 6e20 3d20 722e 5f74 7261 6e73 666f 726d  n = r._transform
-00006530: 5f70 6f72 7428 0a20 2020 2020 2020 2020  _port(.         
-00006540: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00006550: 702e 6365 6e74 6572 2c0a 2020 2020 2020  p.center,.      
-00006560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006570: 2020 7270 2e6f 7269 656e 7461 7469 6f6e    rp.orientation
-00006580: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006590: 2020 2020 2020 2020 2020 722e 6f72 6967            r.orig
-000065a0: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
-000065b0: 2020 2020 2020 2020 2020 2020 722e 726f              r.ro
-000065c0: 7461 7469 6f6e 2c0a 2020 2020 2020 2020  tation,.        
-000065d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065e0: 722e 785f 7265 666c 6563 7469 6f6e 2c0a  r.x_reflection,.
-000065f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006600: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00006610: 2020 2020 2020 2020 2020 6e65 775f 706f            new_po
-00006620: 7274 2e63 656e 7465 7220 3d20 6e65 775f  rt.center = new_
-00006630: 6365 6e74 6572 0a20 2020 2020 2020 2020  center.         
-00006640: 2020 2020 2020 2020 2020 206e 6577 5f70             new_p
-00006650: 6f72 742e 6e65 775f 6f72 6965 6e74 6174  ort.new_orientat
-00006660: 696f 6e20 3d20 6e65 775f 6f72 6965 6e74  ion = new_orient
-00006670: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
-00006680: 2020 2020 2020 2020 2020 7265 665f 706f            ref_po
-00006690: 7274 735f 7472 616e 7366 6f72 6d65 642e  rts_transformed.
-000066a0: 6170 7065 6e64 286e 6577 5f70 6f72 7429  append(new_port)
-000066b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000066c0: 2070 6f72 745f 6c69 7374 202b 3d20 7265   port_list += re
-000066d0: 665f 706f 7274 735f 7472 616e 7366 6f72  f_ports_transfor
-000066e0: 6d65 640a 0a20 2020 2020 2020 2072 6574  med..        ret
-000066f0: 7572 6e20 706f 7274 5f6c 6973 740a 0a20  urn port_list.. 
-00006700: 2020 2064 6566 2067 6574 5f70 6f72 7473     def get_ports
-00006710: 5f64 6963 7428 7365 6c66 2c20 2a2a 6b77  _dict(self, **kw
-00006720: 6172 6773 2920 2d3e 2064 6963 745b 7374  args) -> dict[st
-00006730: 722c 2050 6f72 745d 3a0a 2020 2020 2020  r, Port]:.      
-00006740: 2020 2222 2252 6574 7572 6e73 2061 2064    """Returns a d
-00006750: 6963 7420 6f66 2070 6f72 7473 2e0a 0a20  ict of ports... 
-00006760: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
-00006770: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00006780: 206c 6179 6572 3a20 706f 7274 2047 4453   layer: port GDS
-00006790: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-000067a0: 2020 2020 7072 6566 6978 3a20 7365 6c65      prefix: sele
-000067b0: 6374 2070 6f72 7473 2077 6974 6820 7072  ct ports with pr
-000067c0: 6566 6978 2069 6e20 706f 7274 206e 616d  efix in port nam
-000067d0: 652e 0a20 2020 2020 2020 2020 2020 2073  e..            s
-000067e0: 7566 6669 783a 2073 656c 6563 7420 706f  uffix: select po
-000067f0: 7274 7320 7769 7468 2070 6f72 7420 6e61  rts with port na
-00006800: 6d65 2073 7566 6669 782e 0a20 2020 2020  me suffix..     
-00006810: 2020 2020 2020 206f 7269 656e 7461 7469         orientati
-00006820: 6f6e 3a20 7365 6c65 6374 2070 6f72 7473  on: select ports
-00006830: 2077 6974 6820 6f72 6965 6e74 6174 696f   with orientatio
-00006840: 6e20 696e 2064 6567 7265 6573 2e0a 2020  n in degrees..  
-00006850: 2020 2020 2020 2020 2020 7769 6474 683a            width:
-00006860: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
-00006870: 7468 2070 6f72 7420 7769 6474 682e 0a20  th port width.. 
-00006880: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-00006890: 735f 6578 636c 7564 6564 3a20 4c69 7374  s_excluded: List
-000068a0: 206f 6620 6c61 7965 7273 2074 6f20 6578   of layers to ex
-000068b0: 636c 7564 652e 0a20 2020 2020 2020 2020  clude..         
-000068c0: 2020 2070 6f72 745f 7479 7065 3a20 7365     port_type: se
-000068d0: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
-000068e0: 706f 7274 5f74 7970 6520 286f 7074 6963  port_type (optic
-000068f0: 616c 2c20 656c 6563 7472 6963 616c 2c20  al, electrical, 
-00006900: 7665 7274 6963 616c 5f74 6529 2e0a 2020  vertical_te)..  
-00006910: 2020 2020 2020 2020 2020 636c 6f63 6b77            clockw
-00006920: 6973 653a 2069 6620 5472 7565 2c20 736f  ise: if True, so
-00006930: 7274 2070 6f72 7473 2063 6c6f 636b 7769  rt ports clockwi
-00006940: 7365 2c20 4661 6c73 653a 2063 6f75 6e74  se, False: count
-00006950: 6572 2d63 6c6f 636b 7769 7365 2e0a 2020  er-clockwise..  
-00006960: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00006970: 2020 7265 7475 726e 2073 656c 6563 745f    return select_
-00006980: 706f 7274 7328 7365 6c66 2e70 6f72 7473  ports(self.ports
-00006990: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
-000069a0: 2064 6566 2067 6574 5f70 6f72 7473 5f6c   def get_ports_l
-000069b0: 6973 7428 7365 6c66 2c20 2a2a 6b77 6172  ist(self, **kwar
-000069c0: 6773 2920 2d3e 206c 6973 745b 506f 7274  gs) -> list[Port
-000069d0: 5d3a 0a20 2020 2020 2020 2022 2222 5265  ]:.        """Re
-000069e0: 7475 726e 7320 6c69 7374 206f 6620 706f  turns list of po
-000069f0: 7274 732e 0a0a 2020 2020 2020 2020 4b65  rts...        Ke
-00006a00: 7977 6f72 6420 4172 6773 3a0a 2020 2020  yword Args:.    
-00006a10: 2020 2020 2020 2020 6c61 7965 723a 2073          layer: s
-00006a20: 656c 6563 7420 706f 7274 7320 7769 7468  elect ports with
-00006a30: 2047 4453 206c 6179 6572 2e0a 2020 2020   GDS layer..    
-00006a40: 2020 2020 2020 2020 7072 6566 6978 3a20          prefix: 
-00006a50: 7365 6c65 6374 2070 6f72 7473 2077 6974  select ports wit
-00006a60: 6820 7072 6566 6978 2069 6e20 706f 7274  h prefix in port
-00006a70: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
-00006a80: 2020 2073 7566 6669 783a 2073 656c 6563     suffix: selec
-00006a90: 7420 706f 7274 7320 7769 7468 2070 6f72  t ports with por
-00006aa0: 7420 6e61 6d65 2073 7566 6669 782e 0a20  t name suffix.. 
-00006ab0: 2020 2020 2020 2020 2020 206f 7269 656e             orien
-00006ac0: 7461 7469 6f6e 3a20 7365 6c65 6374 2070  tation: select p
-00006ad0: 6f72 7473 2077 6974 6820 6f72 6965 6e74  orts with orient
-00006ae0: 6174 696f 6e20 696e 2064 6567 7265 6573  ation in degrees
-00006af0: 2e0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
-00006b00: 6965 6e74 6174 696f 6e3a 2073 656c 6563  ientation: selec
-00006b10: 7420 706f 7274 7320 7769 7468 206f 7269  t ports with ori
-00006b20: 656e 7461 7469 6f6e 2069 6e20 6465 6772  entation in degr
-00006b30: 6565 732e 0a20 2020 2020 2020 2020 2020  ees..           
-00006b40: 2077 6964 7468 3a20 7365 6c65 6374 2070   width: select p
-00006b50: 6f72 7473 2077 6974 6820 706f 7274 2077  orts with port w
-00006b60: 6964 7468 2e0a 2020 2020 2020 2020 2020  idth..          
-00006b70: 2020 6c61 7965 7273 5f65 7863 6c75 6465    layers_exclude
-00006b80: 643a 204c 6973 7420 6f66 206c 6179 6572  d: List of layer
-00006b90: 7320 746f 2065 7863 6c75 6465 2e0a 2020  s to exclude..  
-00006ba0: 2020 2020 2020 2020 2020 706f 7274 5f74            port_t
-00006bb0: 7970 653a 2073 656c 6563 7420 706f 7274  ype: select port
-00006bc0: 7320 7769 7468 2070 6f72 745f 7479 7065  s with port_type
-00006bd0: 2028 6f70 7469 6361 6c2c 2065 6c65 6374   (optical, elect
-00006be0: 7269 6361 6c2c 2076 6572 7469 6361 6c5f  rical, vertical_
-00006bf0: 7465 292e 0a20 2020 2020 2020 2020 2020  te)..           
-00006c00: 2063 6c6f 636b 7769 7365 3a20 6966 2054   clockwise: if T
-00006c10: 7275 652c 2073 6f72 7420 706f 7274 7320  rue, sort ports 
-00006c20: 636c 6f63 6b77 6973 652c 2046 616c 7365  clockwise, False
-00006c30: 3a20 636f 756e 7465 722d 636c 6f63 6b77  : counter-clockw
-00006c40: 6973 652e 0a20 2020 2020 2020 2022 2222  ise..        """
-00006c50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00006c60: 6c69 7374 2873 656c 6563 745f 706f 7274  list(select_port
-00006c70: 7328 7365 6c66 2e70 6f72 7473 2c20 2a2a  s(self.ports, **
-00006c80: 6b77 6172 6773 292e 7661 6c75 6573 2829  kwargs).values()
-00006c90: 290a 0a20 2020 2064 6566 2067 6574 5f70  )..    def get_p
-00006ca0: 6f72 7473 5f70 616e 6461 7328 7365 6c66  orts_pandas(self
-00006cb0: 293a 0a20 2020 2020 2020 2069 6d70 6f72  ):.        impor
-00006cc0: 7420 7061 6e64 6173 2061 7320 7064 0a0a  t pandas as pd..
-00006cd0: 2020 2020 2020 2020 636f 6c5f 7370 6563          col_spec
-00006ce0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00006cf0: 2022 6e61 6d65 222c 0a20 2020 2020 2020   "name",.       
-00006d00: 2020 2020 2022 7769 6474 6822 2c0a 2020       "width",.  
-00006d10: 2020 2020 2020 2020 2020 2263 656e 7465            "cente
-00006d20: 7222 2c0a 2020 2020 2020 2020 2020 2020  r",.            
-00006d30: 226f 7269 656e 7461 7469 6f6e 222c 0a20  "orientation",. 
-00006d40: 2020 2020 2020 2020 2020 2022 6c61 7965             "laye
-00006d50: 7222 2c0a 2020 2020 2020 2020 2020 2020  r",.            
-00006d60: 2270 6f72 745f 7479 7065 222c 0a20 2020  "port_type",.   
-00006d70: 2020 2020 2020 2020 2022 7368 6561 725f           "shear_
-00006d80: 616e 676c 6522 2c0a 2020 2020 2020 2020  angle",.        
-00006d90: 5d0a 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
-00006da0: 6e20 7064 2e44 6174 6146 7261 6d65 280a  n pd.DataFrame(.
-00006db0: 2020 2020 2020 2020 2020 2020 5b70 6f72              [por
-00006dc0: 742e 746f 5f64 6963 7428 2920 666f 7220  t.to_dict() for 
-00006dd0: 706f 7274 2069 6e20 7365 6c66 2e67 6574  port in self.get
-00006de0: 5f70 6f72 7473 5f6c 6973 7428 295d 2c20  _ports_list()], 
-00006df0: 636f 6c75 6d6e 733d 636f 6c5f 7370 6563  columns=col_spec
-00006e00: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00006e10: 6465 6620 6765 745f 706f 7274 735f 706f  def get_ports_po
-00006e20: 6c61 7273 2873 656c 6629 3a0a 2020 2020  lars(self):.    
-00006e30: 2020 2020 696d 706f 7274 2070 6f6c 6172      import polar
-00006e40: 7320 6173 2070 6c0a 0a20 2020 2020 2020  s as pl..       
-00006e50: 2063 6f6c 5f73 7065 6320 3d20 7b0a 2020   col_spec = {.  
-00006e60: 2020 2020 2020 2020 2020 226e 616d 6522            "name"
-00006e70: 3a20 706c 2e55 7466 382c 0a20 2020 2020  : pl.Utf8,.     
-00006e80: 2020 2020 2020 2022 7769 6474 6822 3a20         "width": 
-00006e90: 706c 2e46 6c6f 6174 3634 2c0a 2020 2020  pl.Float64,.    
-00006ea0: 2020 2020 2020 2020 2263 656e 7465 7222          "center"
-00006eb0: 3a20 706c 2e4c 6973 7428 706c 2e46 6c6f  : pl.List(pl.Flo
-00006ec0: 6174 3634 292c 0a20 2020 2020 2020 2020  at64),.         
-00006ed0: 2020 2022 6f72 6965 6e74 6174 696f 6e22     "orientation"
-00006ee0: 3a20 706c 2e46 6c6f 6174 3634 2c0a 2020  : pl.Float64,.  
-00006ef0: 2020 2020 2020 2020 2020 226c 6179 6572            "layer
-00006f00: 223a 2070 6c2e 4c69 7374 2870 6c2e 5549  ": pl.List(pl.UI
-00006f10: 6e74 3136 292c 0a20 2020 2020 2020 2020  nt16),.         
-00006f20: 2020 2022 706f 7274 5f74 7970 6522 3a20     "port_type": 
-00006f30: 706c 2e55 7466 382c 0a20 2020 2020 2020  pl.Utf8,.       
-00006f40: 2020 2020 2022 7368 6561 725f 616e 676c       "shear_angl
-00006f50: 6522 3a20 706c 2e46 6c6f 6174 3634 2c0a  e": pl.Float64,.
-00006f60: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-00006f70: 2020 2072 6574 7572 6e20 706c 2e44 6174     return pl.Dat
-00006f80: 6146 7261 6d65 280a 2020 2020 2020 2020  aFrame(.        
-00006f90: 2020 2020 5b70 6f72 742e 746f 5f64 6963      [port.to_dic
-00006fa0: 7428 2920 666f 7220 706f 7274 2069 6e20  t() for port in 
-00006fb0: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
-00006fc0: 6973 7428 295d 2c20 7363 6865 6d61 3d63  ist()], schema=c
-00006fd0: 6f6c 5f73 7065 630a 2020 2020 2020 2020  ol_spec.        
-00006fe0: 290a 0a20 2020 2064 6566 2072 6566 280a  )..    def ref(.
-00006ff0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00007000: 2020 2020 2020 706f 7369 7469 6f6e 3a20        position: 
-00007010: 436f 6f72 6469 6e61 7465 203d 2028 302c  Coordinate = (0,
-00007020: 2030 292c 0a20 2020 2020 2020 2070 6f72   0),.        por
-00007030: 745f 6964 3a20 7374 7220 7c20 4e6f 6e65  t_id: str | None
-00007040: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00007050: 2072 6f74 6174 696f 6e3a 2066 6c6f 6174   rotation: float
-00007060: 203d 2030 2c0a 2020 2020 2020 2020 685f   = 0,.        h_
-00007070: 6d69 7272 6f72 3a20 626f 6f6c 203d 2046  mirror: bool = F
-00007080: 616c 7365 2c0a 2020 2020 2020 2020 765f  alse,.        v_
-00007090: 6d69 7272 6f72 3a20 626f 6f6c 203d 2046  mirror: bool = F
-000070a0: 616c 7365 2c0a 2020 2020 2920 2d3e 2043  alse,.    ) -> C
-000070b0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-000070c0: 653a 0a20 2020 2020 2020 2022 2222 5265  e:.        """Re
-000070d0: 7475 726e 7320 436f 6d70 6f6e 656e 7420  turns Component 
-000070e0: 7265 6665 7265 6e63 652e 0a0a 2020 2020  reference...    
-000070f0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00007100: 2020 2020 2020 706f 7369 7469 6f6e 3a20        position: 
-00007110: 782c 2079 2070 6f73 6974 696f 6e2e 0a20  x, y position.. 
-00007120: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
-00007130: 6964 3a20 6e61 6d65 206f 6620 7468 6520  id: name of the 
-00007140: 706f 7274 2e0a 2020 2020 2020 2020 2020  port..          
-00007150: 2020 726f 7461 7469 6f6e 3a20 696e 2064    rotation: in d
-00007160: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
-00007170: 2020 2020 685f 6d69 7272 6f72 3a20 686f      h_mirror: ho
-00007180: 7269 7a6f 6e74 616c 206d 6972 726f 7220  rizontal mirror 
-00007190: 7573 696e 6720 7920 6178 6973 2028 782c  using y axis (x,
-000071a0: 2031 2920 2831 2c20 3029 2e0a 2020 2020   1) (1, 0)..    
-000071b0: 2020 2020 2020 2020 2020 2020 5468 6973              This
-000071c0: 2069 7320 7468 6520 6d6f 7374 2063 6f6d   is the most com
-000071d0: 6d6f 6e20 6d69 7272 6f72 2e0a 2020 2020  mon mirror..    
-000071e0: 2020 2020 2020 2020 765f 6d69 7272 6f72          v_mirror
-000071f0: 3a20 7665 7274 6963 616c 206d 6972 726f  : vertical mirro
-00007200: 7220 7573 696e 6720 7820 6178 6973 2028  r using x axis (
-00007210: 312c 2079 2920 2830 2c20 7929 2e0a 2020  1, y) (0, y)..  
-00007220: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00007230: 2020 5f72 6566 203d 2043 6f6d 706f 6e65    _ref = Compone
-00007240: 6e74 5265 6665 7265 6e63 6528 7365 6c66  ntReference(self
-00007250: 290a 0a20 2020 2020 2020 2069 6620 706f  )..        if po
-00007260: 7274 5f69 6420 616e 6420 706f 7274 5f69  rt_id and port_i
-00007270: 6420 6e6f 7420 696e 2073 656c 662e 706f  d not in self.po
-00007280: 7274 733a 0a20 2020 2020 2020 2020 2020  rts:.           
-00007290: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000072a0: 7228 6622 706f 7274 207b 706f 7274 5f69  r(f"port {port_i
-000072b0: 647d 206e 6f74 2069 6e20 7b73 656c 662e  d} not in {self.
-000072c0: 706f 7274 732e 6b65 7973 2829 7d22 290a  ports.keys()}").
-000072d0: 0a20 2020 2020 2020 206f 7269 6769 6e20  .        origin 
-000072e0: 3d20 7365 6c66 2e70 6f72 7473 5b70 6f72  = self.ports[por
-000072f0: 745f 6964 5d2e 6365 6e74 6572 2069 6620  t_id].center if 
-00007300: 706f 7274 5f69 6420 656c 7365 2028 302c  port_id else (0,
-00007310: 2030 290a 2020 2020 2020 2020 6966 2068   0).        if h
-00007320: 5f6d 6972 726f 723a 0a20 2020 2020 2020  _mirror:.       
-00007330: 2020 2020 205f 7265 662e 6d69 7272 6f72       _ref.mirror
-00007340: 5f78 2870 6f72 745f 6964 290a 0a20 2020  _x(port_id)..   
-00007350: 2020 2020 2069 6620 765f 6d69 7272 6f72       if v_mirror
-00007360: 3a0a 2020 2020 2020 2020 2020 2020 5f72  :.            _r
-00007370: 6566 2e6d 6972 726f 725f 7928 706f 7274  ef.mirror_y(port
-00007380: 5f69 6429 0a0a 2020 2020 2020 2020 6966  _id)..        if
-00007390: 2072 6f74 6174 696f 6e20 213d 2030 3a0a   rotation != 0:.
-000073a0: 2020 2020 2020 2020 2020 2020 5f72 6566              _ref
-000073b0: 2e72 6f74 6174 6528 726f 7461 7469 6f6e  .rotate(rotation
-000073c0: 2c20 6f72 6967 696e 290a 2020 2020 2020  , origin).      
-000073d0: 2020 5f72 6566 2e6d 6f76 6528 6f72 6967    _ref.move(orig
-000073e0: 696e 2c20 706f 7369 7469 6f6e 290a 0a20  in, position).. 
-000073f0: 2020 2020 2020 2072 6574 7572 6e20 5f72         return _r
-00007400: 6566 0a0a 2020 2020 6465 6620 7265 665f  ef..    def ref_
-00007410: 6365 6e74 6572 2873 656c 662c 2070 6f73  center(self, pos
-00007420: 6974 696f 6e3d 2830 2c20 3029 293a 0a20  ition=(0, 0)):. 
-00007430: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00007440: 7320 6120 7265 6665 7265 6e63 6520 6f66  s a reference of
-00007450: 2074 6865 2063 6f6d 706f 6e65 6e74 2063   the component c
-00007460: 656e 7465 7265 6420 6174 2028 783d 302c  entered at (x=0,
-00007470: 2079 3d30 292e 2222 220a 2020 2020 2020   y=0).""".      
-00007480: 2020 7369 203d 2073 656c 662e 7369 7a65    si = self.size
-00007490: 5f69 6e66 6f0a 2020 2020 2020 2020 7963  _info.        yc
-000074a0: 203d 2073 692e 736f 7574 6820 2b20 7369   = si.south + si
-000074b0: 2e68 6569 6768 7420 2f20 320a 2020 2020  .height / 2.    
-000074c0: 2020 2020 7863 203d 2073 692e 7765 7374      xc = si.west
-000074d0: 202b 2073 692e 7769 6474 6820 2f20 320a   + si.width / 2.
-000074e0: 2020 2020 2020 2020 6365 6e74 6572 203d          center =
-000074f0: 2028 7863 2c20 7963 290a 2020 2020 2020   (xc, yc).      
-00007500: 2020 5f72 6566 203d 2043 6f6d 706f 6e65    _ref = Compone
-00007510: 6e74 5265 6665 7265 6e63 6528 7365 6c66  ntReference(self
-00007520: 290a 2020 2020 2020 2020 5f72 6566 2e6d  ).        _ref.m
-00007530: 6f76 6528 6365 6e74 6572 2c20 706f 7369  ove(center, posi
-00007540: 7469 6f6e 290a 2020 2020 2020 2020 7265  tion).        re
-00007550: 7475 726e 205f 7265 660a 0a20 2020 2064  turn _ref..    d
-00007560: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
-00007570: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
-00007580: 2020 2222 2252 6574 7572 6e20 6120 7374    """Return a st
-00007590: 7269 6e67 2072 6570 7265 7365 6e74 6174  ring representat
-000075a0: 696f 6e20 6f66 2074 6865 206f 626a 6563  ion of the objec
-000075b0: 742e 2222 220a 2020 2020 2020 2020 7265  t.""".        re
-000075c0: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
-000075d0: 2020 2066 227b 7365 6c66 2e6e 616d 657d     f"{self.name}
-000075e0: 3a20 7569 6420 7b73 656c 662e 7569 647d  : uid {self.uid}
-000075f0: 2c20 220a 2020 2020 2020 2020 2020 2020  , ".            
-00007600: 6622 706f 7274 7320 7b6c 6973 7428 7365  f"ports {list(se
-00007610: 6c66 2e70 6f72 7473 2e6b 6579 7328 2929  lf.ports.keys())
-00007620: 7d2c 2022 0a20 2020 2020 2020 2020 2020  }, ".           
-00007630: 2066 2272 6566 6572 656e 6365 7320 7b6c   f"references {l
-00007640: 6973 7428 7365 6c66 2e6e 616d 6564 5f72  ist(self.named_r
-00007650: 6566 6572 656e 6365 732e 6b65 7973 2829  eferences.keys()
-00007660: 297d 2c20 220a 2020 2020 2020 2020 2020  )}, ".          
-00007670: 2020 6622 7b6c 656e 2873 656c 662e 706f    f"{len(self.po
-00007680: 6c79 676f 6e73 297d 2070 6f6c 7967 6f6e  lygons)} polygon
-00007690: 7322 0a20 2020 2020 2020 2029 0a0a 2020  s".        )..  
-000076a0: 2020 6465 6620 7070 7269 6e74 2873 656c    def pprint(sel
-000076b0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-000076c0: 2020 2020 2222 2250 7269 6e74 7320 636f      """Prints co
-000076d0: 6d70 6f6e 656e 7420 696e 666f 2e22 2222  mponent info."""
-000076e0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-000076f0: 2020 2020 2020 2020 2020 6672 6f6d 2072            from r
-00007700: 6963 6820 696d 706f 7274 2070 7265 7474  ich import prett
-00007710: 790a 0a20 2020 2020 2020 2020 2020 2070  y..            p
-00007720: 7265 7474 792e 696e 7374 616c 6c28 290a  retty.install().
-00007730: 2020 2020 2020 2020 2020 2020 7072 6574              pret
-00007740: 7479 2e70 7072 696e 7428 7365 6c66 2e74  ty.pprint(self.t
-00007750: 6f5f 6469 6374 2829 290a 2020 2020 2020  o_dict()).      
-00007760: 2020 6578 6365 7074 2049 6d70 6f72 7445    except ImportE
-00007770: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00007780: 2020 7072 696e 7428 7961 6d6c 2e64 756d    print(yaml.dum
-00007790: 7028 7365 6c66 2e74 6f5f 6469 6374 2829  p(self.to_dict()
-000077a0: 2929 0a0a 2020 2020 6465 6620 7070 7269  ))..    def ppri
-000077b0: 6e74 5f70 6f72 7473 2873 656c 662c 2073  nt_ports(self, s
-000077c0: 6f72 745f 6279 5f6e 616d 653a 2062 6f6f  ort_by_name: boo
-000077d0: 6c20 3d20 5472 7565 2c20 2a2a 6b77 6172  l = True, **kwar
-000077e0: 6773 2920 2d3e 204e 6f6e 653a 0a20 2020  gs) -> None:.   
-000077f0: 2020 2020 2022 2222 5072 696e 7473 2070       """Prints p
-00007800: 6f72 7473 2069 6e20 6120 7269 6368 2074  orts in a rich t
-00007810: 6162 6c65 2e0a 0a20 2020 2020 2020 204b  able...        K
-00007820: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
-00007830: 2020 2020 2020 2020 206c 6179 6572 3a20           layer: 
-00007840: 7365 6c65 6374 2070 6f72 7473 2077 6974  select ports wit
-00007850: 6820 4744 5320 6c61 7965 722e 0a20 2020  h GDS layer..   
-00007860: 2020 2020 2020 2020 2070 7265 6669 783a           prefix:
-00007870: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
-00007880: 7468 2070 7265 6669 7820 696e 2070 6f72  th prefix in por
-00007890: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
-000078a0: 2020 2020 7375 6666 6978 3a20 7365 6c65      suffix: sele
-000078b0: 6374 2070 6f72 7473 2077 6974 6820 706f  ct ports with po
-000078c0: 7274 206e 616d 6520 7375 6666 6978 2e0a  rt name suffix..
-000078d0: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
-000078e0: 6e74 6174 696f 6e3a 2073 656c 6563 7420  ntation: select 
-000078f0: 706f 7274 7320 7769 7468 206f 7269 656e  ports with orien
-00007900: 7461 7469 6f6e 2069 6e20 6465 6772 6565  tation in degree
-00007910: 732e 0a20 2020 2020 2020 2020 2020 206f  s..            o
-00007920: 7269 656e 7461 7469 6f6e 3a20 7365 6c65  rientation: sele
-00007930: 6374 2070 6f72 7473 2077 6974 6820 6f72  ct ports with or
-00007940: 6965 6e74 6174 696f 6e20 696e 2064 6567  ientation in deg
-00007950: 7265 6573 2e0a 2020 2020 2020 2020 2020  rees..          
-00007960: 2020 7769 6474 683a 2073 656c 6563 7420    width: select 
-00007970: 706f 7274 7320 7769 7468 2070 6f72 7420  ports with port 
-00007980: 7769 6474 682e 0a20 2020 2020 2020 2020  width..         
-00007990: 2020 206c 6179 6572 735f 6578 636c 7564     layers_exclud
-000079a0: 6564 3a20 4c69 7374 206f 6620 6c61 7965  ed: List of laye
-000079b0: 7273 2074 6f20 6578 636c 7564 652e 0a20  rs to exclude.. 
-000079c0: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
-000079d0: 7479 7065 3a20 7365 6c65 6374 2070 6f72  type: select por
-000079e0: 7473 2077 6974 6820 706f 7274 5f74 7970  ts with port_typ
-000079f0: 6520 286f 7074 6963 616c 2c20 656c 6563  e (optical, elec
-00007a00: 7472 6963 616c 2c20 7665 7274 6963 616c  trical, vertical
-00007a10: 5f74 6529 2e0a 2020 2020 2020 2020 2020  _te)..          
-00007a20: 2020 636c 6f63 6b77 6973 653a 2069 6620    clockwise: if 
-00007a30: 5472 7565 2c20 736f 7274 2070 6f72 7473  True, sort ports
-00007a40: 2063 6c6f 636b 7769 7365 2c20 4661 6c73   clockwise, Fals
-00007a50: 653a 2063 6f75 6e74 6572 2d63 6c6f 636b  e: counter-clock
-00007a60: 7769 7365 2e0a 2020 2020 2020 2020 2222  wise..        ""
-00007a70: 220a 0a20 2020 2020 2020 2070 7072 696e  "..        pprin
-00007a80: 745f 706f 7274 7328 7365 6c66 2e67 6574  t_ports(self.get
-00007a90: 5f70 6f72 7473 5f6c 6973 7428 736f 7274  _ports_list(sort
-00007aa0: 5f62 795f 6e61 6d65 3d73 6f72 745f 6279  _by_name=sort_by
-00007ab0: 5f6e 616d 652c 202a 2a6b 7761 7267 7329  _name, **kwargs)
-00007ac0: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
-00007ad0: 0a20 2020 2064 6566 206d 6574 6164 6174  .    def metadat
-00007ae0: 615f 6368 696c 6428 7365 6c66 2920 2d3e  a_child(self) ->
-00007af0: 2064 6963 743a 0a20 2020 2020 2020 2022   dict:.        "
-00007b00: 2222 5265 7475 726e 7320 6d65 7461 6461  ""Returns metada
-00007b10: 7461 2066 726f 6d20 6368 696c 6420 6966  ta from child if
-00007b20: 2061 6e79 2c20 4f74 6865 7277 6973 6520   any, Otherwise 
-00007b30: 7265 7475 726e 7320 636f 6d70 6f6e 656e  returns componen
-00007b40: 7420 6f77 6e2e 0a0a 2020 2020 2020 2020  t own...        
-00007b50: 6d65 7461 6461 7461 2047 7265 6174 2074  metadata Great t
-00007b60: 6f20 6163 6365 7373 2074 6865 2063 6869  o access the chi
-00007b70: 6c64 7265 6e20 6d65 7461 6461 7461 2061  ldren metadata a
-00007b80: 7420 7468 6520 626f 7474 6f6d 206f 6620  t the bottom of 
-00007b90: 7468 650a 2020 2020 2020 2020 6869 6572  the.        hier
-00007ba0: 6172 6368 792e 0a20 2020 2020 2020 2022  archy..        "
-00007bb0: 2222 0a20 2020 2020 2020 2073 6574 7469  "".        setti
-00007bc0: 6e67 7320 3d20 6469 6374 2873 656c 662e  ngs = dict(self.
-00007bd0: 7365 7474 696e 6773 290a 0a20 2020 2020  settings)..     
-00007be0: 2020 2077 6869 6c65 2073 6574 7469 6e67     while setting
-00007bf0: 732e 6765 7428 2263 6869 6c64 2229 3a0a  s.get("child"):.
-00007c00: 2020 2020 2020 2020 2020 2020 7365 7474              sett
-00007c10: 696e 6773 203d 2073 6574 7469 6e67 732e  ings = settings.
-00007c20: 6765 7428 2263 6869 6c64 2229 0a0a 2020  get("child")..  
-00007c30: 2020 2020 2020 7265 7475 726e 2064 6963        return dic
-00007c40: 7428 7365 7474 696e 6773 290a 0a20 2020  t(settings)..   
-00007c50: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00007c60: 6566 206d 6574 6164 6174 6128 7365 6c66  ef metadata(self
-00007c70: 2920 2d3e 2064 6963 743a 0a20 2020 2020  ) -> dict:.     
-00007c80: 2020 2072 6574 7572 6e20 6469 6374 2873     return dict(s
-00007c90: 656c 662e 7365 7474 696e 6773 290a 0a20  elf.settings).. 
-00007ca0: 2020 2064 6566 2061 6464 5f70 6f72 7428     def add_port(
-00007cb0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00007cc0: 2020 2020 2020 206e 616d 653a 2073 7472         name: str
-00007cd0: 207c 206f 626a 6563 7420 7c20 4e6f 6e65   | object | None
-00007ce0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00007cf0: 2063 656e 7465 723a 2074 7570 6c65 5b66   center: tuple[f
-00007d00: 6c6f 6174 2c20 666c 6f61 745d 207c 204e  loat, float] | N
-00007d10: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00007d20: 2020 2020 7769 6474 683a 2066 6c6f 6174      width: float
-00007d30: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00007d40: 2020 2020 2020 2020 6f72 6965 6e74 6174          orientat
-00007d50: 696f 6e3a 2066 6c6f 6174 207c 204e 6f6e  ion: float | Non
-00007d60: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00007d70: 2020 706f 7274 3a20 506f 7274 207c 204e    port: Port | N
-00007d80: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00007d90: 2020 2020 6c61 7965 723a 204c 6179 6572      layer: Layer
-00007da0: 5370 6563 207c 204e 6f6e 6520 3d20 4e6f  Spec | None = No
-00007db0: 6e65 2c0a 2020 2020 2020 2020 706f 7274  ne,.        port
-00007dc0: 5f74 7970 653a 2073 7472 207c 204e 6f6e  _type: str | Non
-00007dd0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00007de0: 2020 6372 6f73 735f 7365 6374 696f 6e3a    cross_section:
-00007df0: 2043 726f 7373 5365 6374 696f 6e53 7065   CrossSectionSpe
-00007e00: 6320 7c20 4e6f 6e65 203d 204e 6f6e 652c  c | None = None,
-00007e10: 0a20 2020 2020 2020 2073 6865 6172 5f61  .        shear_a
-00007e20: 6e67 6c65 3a20 666c 6f61 7420 7c20 4e6f  ngle: float | No
-00007e30: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
-00007e40: 2020 2069 6e66 6f3a 2064 6963 745b 7374     info: dict[st
-00007e50: 722c 2041 6e79 5d20 7c20 4e6f 6e65 203d  r, Any] | None =
-00007e60: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
-00007e70: 506f 7274 3a0a 2020 2020 2020 2020 2222  Port:.        ""
-00007e80: 2241 6464 2070 6f72 7420 746f 2063 6f6d  "Add port to com
-00007e90: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
-00007ea0: 2059 6f75 2063 616e 2063 6f70 7920 616e   You can copy an
-00007eb0: 2065 7869 7374 696e 6720 706f 7274 206c   existing port l
-00007ec0: 696b 6520 6164 645f 706f 7274 2870 6f72  ike add_port(por
-00007ed0: 7420 3d20 6578 6973 7469 6e67 5f70 6f72  t = existing_por
-00007ee0: 7429 206f 720a 2020 2020 2020 2020 6372  t) or.        cr
-00007ef0: 6561 7465 2061 206e 6577 2070 6f72 7420  eate a new port 
-00007f00: 6164 645f 706f 7274 286d 796e 616d 652c  add_port(myname,
-00007f10: 206d 7963 656e 7465 722c 206d 7977 6964   mycenter, mywid
-00007f20: 7468 2c20 6d79 6f72 6965 6e74 6174 696f  th, myorientatio
-00007f30: 6e29 2e0a 2020 2020 2020 2020 596f 7520  n)..        You 
-00007f40: 6361 6e20 616c 736f 2063 6f70 7920 616e  can also copy an
-00007f50: 2065 7869 7374 696e 6720 706f 7274 0a20   existing port. 
-00007f60: 2020 2020 2020 2077 6974 6820 6120 6e65         with a ne
-00007f70: 7720 6e61 6d65 2061 6464 5f70 6f72 7428  w name add_port(
-00007f80: 706f 7274 203d 2065 7869 7374 696e 675f  port = existing_
-00007f90: 706f 7274 2c20 6e61 6d65 203d 206e 6577  port, name = new
-00007fa0: 5f6e 616d 6529 0a0a 2020 2020 2020 2020  _name)..        
-00007fb0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00007fc0: 2020 6e61 6d65 3a20 706f 7274 206e 616d    name: port nam
-00007fd0: 652e 0a20 2020 2020 2020 2020 2020 2063  e..            c
-00007fe0: 656e 7465 723a 2078 2c20 792e 0a20 2020  enter: x, y..   
-00007ff0: 2020 2020 2020 2020 2077 6964 7468 3a20           width: 
-00008000: 696e 2075 6d2e 0a20 2020 2020 2020 2020  in um..         
-00008010: 2020 206f 7269 656e 7461 7469 6f6e 3a20     orientation: 
-00008020: 696e 2064 6567 2e0a 2020 2020 2020 2020  in deg..        
-00008030: 2020 2020 706f 7274 3a20 6f70 7469 6f6e      port: option
-00008040: 616c 2070 6f72 742e 0a20 2020 2020 2020  al port..       
-00008050: 2020 2020 206c 6179 6572 3a20 706f 7274       layer: port
-00008060: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-00008070: 2020 2020 706f 7274 5f74 7970 653a 206f      port_type: o
-00008080: 7074 6963 616c 2c20 656c 6563 7472 6963  ptical, electric
-00008090: 616c 2c20 7665 7274 6963 616c 5f64 632c  al, vertical_dc,
-000080a0: 2076 6572 7469 6361 6c5f 7465 2c20 7665   vertical_te, ve
-000080b0: 7274 6963 616c 5f74 6d2e 2044 6566 6175  rtical_tm. Defau
-000080c0: 6c74 7320 746f 206f 7074 6963 616c 2e0a  lts to optical..
-000080d0: 2020 2020 2020 2020 2020 2020 6372 6f73              cros
-000080e0: 735f 7365 6374 696f 6e3a 2070 6f72 7420  s_section: port 
-000080f0: 6372 6f73 735f 7365 6374 696f 6e2e 0a20  cross_section.. 
-00008100: 2020 2020 2020 2020 2020 2073 6865 6172             shear
-00008110: 5f61 6e67 6c65 3a20 616e 206f 7074 696f  _angle: an optio
-00008120: 6e61 6c20 616e 676c 6520 746f 2073 6865  nal angle to she
-00008130: 6172 2070 6f72 7420 6661 6365 2069 6e20  ar port face in 
-00008140: 6465 6772 6565 732e 0a20 2020 2020 2020  degrees..       
-00008150: 2020 2020 2069 6e66 6f3a 2044 6963 7420       info: Dict 
-00008160: 636f 6e74 6169 6e69 6e67 2061 7262 6974  containing arbit
-00008170: 7261 7279 2069 6e66 6f72 6d61 7469 6f6e  rary information
-00008180: 2061 626f 7574 2074 6865 2070 6f72 742e   about the port.
-00008190: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000081a0: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-000081b0: 746f 7279 2e70 646b 2069 6d70 6f72 7420  tory.pdk import 
-000081c0: 6765 745f 6372 6f73 735f 7365 6374 696f  get_cross_sectio
-000081d0: 6e2c 2067 6574 5f6c 6179 6572 0a0a 2020  n, get_layer..  
-000081e0: 2020 2020 2020 6c61 7965 7220 3d20 6765        layer = ge
-000081f0: 745f 6c61 7965 7228 6c61 7965 7229 0a0a  t_layer(layer)..
-00008200: 2020 2020 2020 2020 6966 2070 6f72 743a          if port:
-00008210: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00008220: 6e6f 7420 6973 696e 7374 616e 6365 2870  not isinstance(p
-00008230: 6f72 742c 2050 6f72 7429 3a0a 2020 2020  ort, Port):.    
-00008240: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00008250: 6520 5661 6c75 6545 7272 6f72 2866 2261  e ValueError(f"a
-00008260: 6464 5f70 6f72 7428 2920 6e65 6564 7320  dd_port() needs 
-00008270: 6120 506f 7274 2c20 676f 7420 7b74 7970  a Port, got {typ
-00008280: 6528 706f 7274 297d 2229 0a20 2020 2020  e(port)}").     
-00008290: 2020 2020 2020 2070 203d 2070 6f72 742e         p = port.
-000082a0: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
-000082b0: 2020 2069 6620 6e61 6d65 2069 7320 6e6f     if name is no
-000082c0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-000082d0: 2020 2020 2020 2020 702e 6e61 6d65 203d          p.name =
-000082e0: 206e 616d 650a 2020 2020 2020 2020 2020   name.          
-000082f0: 2020 6966 2063 656e 7465 7220 6973 206e    if center is n
-00008300: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00008310: 2020 2020 2020 2020 2070 2e63 656e 7465           p.cente
-00008320: 7220 3d20 6365 6e74 6572 0a20 2020 2020  r = center.     
-00008330: 2020 2020 2020 2069 6620 7769 6474 6820         if width 
-00008340: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00008350: 2020 2020 2020 2020 2020 2020 2070 2e77               p.w
-00008360: 6964 7468 203d 2077 6964 7468 0a20 2020  idth = width.   
-00008370: 2020 2020 2020 2020 2069 6620 6f72 6965           if orie
-00008380: 6e74 6174 696f 6e20 6973 206e 6f74 204e  ntation is not N
-00008390: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000083a0: 2020 2020 2070 2e6f 7269 656e 7461 7469       p.orientati
-000083b0: 6f6e 203d 206f 7269 656e 7461 7469 6f6e  on = orientation
-000083c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000083d0: 706f 7274 5f74 7970 6520 6973 206e 6f74  port_type is not
-000083e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000083f0: 2020 2020 2020 2070 2e70 6f72 745f 7479         p.port_ty
-00008400: 7065 203d 2070 6f72 745f 7479 7065 0a20  pe = port_type. 
-00008410: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
-00008420: 7965 7220 6973 206e 6f74 204e 6f6e 653a  yer is not None:
-00008430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008440: 2070 2e6c 6179 6572 203d 206c 6179 6572   p.layer = layer
-00008450: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00008460: 7368 6561 725f 616e 676c 6520 6973 206e  shear_angle is n
-00008470: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00008480: 2020 2020 2020 2020 2070 2e73 6865 6172           p.shear
-00008490: 5f61 6e67 6c65 203d 2073 6865 6172 5f61  _angle = shear_a
-000084a0: 6e67 6c65 0a20 2020 2020 2020 2020 2020  ngle.           
-000084b0: 2069 6620 6372 6f73 735f 7365 6374 696f   if cross_sectio
-000084c0: 6e20 6973 206e 6f74 204e 6f6e 653a 0a20  n is not None:. 
-000084d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000084e0: 2e63 726f 7373 5f73 6563 7469 6f6e 203d  .cross_section =
-000084f0: 2063 726f 7373 5f73 6563 7469 6f6e 0a20   cross_section. 
-00008500: 2020 2020 2020 2020 2020 2069 6620 696e             if in
-00008510: 666f 2069 7320 6e6f 7420 4e6f 6e65 3a0a  fo is not None:.
-00008520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008530: 702e 696e 666f 203d 2069 6e66 6f0a 2020  p.info = info.  
-00008540: 2020 2020 2020 2020 2020 702e 7061 7265            p.pare
-00008550: 6e74 203d 2073 656c 660a 0a20 2020 2020  nt = self..     
-00008560: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-00008570: 6365 286e 616d 652c 2050 6f72 7429 3a0a  ce(name, Port):.
-00008580: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
-00008590: 6e61 6d65 2e63 6f70 7928 290a 2020 2020  name.copy().    
-000085a0: 2020 2020 2020 2020 702e 7061 7265 6e74          p.parent
-000085b0: 203d 2073 656c 660a 2020 2020 2020 2020   = self.        
-000085c0: 2020 2020 6e61 6d65 203d 2070 2e6e 616d      name = p.nam
-000085d0: 650a 2020 2020 2020 2020 656c 6966 2063  e.        elif c
-000085e0: 656e 7465 7220 6973 204e 6f6e 653a 0a20  enter is None:. 
-000085f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00008600: 2056 616c 7565 4572 726f 7228 2250 6f72   ValueError("Por
-00008610: 7420 6e65 6564 7320 6365 6e74 6572 2070  t needs center p
-00008620: 6172 616d 6574 6572 2028 782c 2079 2920  arameter (x, y) 
-00008630: 756d 2e22 290a 0a20 2020 2020 2020 2065  um.")..        e
-00008640: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00008650: 2070 203d 2050 6f72 7428 0a20 2020 2020   p = Port(.     
-00008660: 2020 2020 2020 2020 2020 206e 616d 653d             name=
-00008670: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00008680: 2020 2020 2020 6365 6e74 6572 3d63 656e        center=cen
-00008690: 7465 722c 0a20 2020 2020 2020 2020 2020  ter,.           
-000086a0: 2020 2020 2077 6964 7468 3d77 6964 7468       width=width
-000086b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000086c0: 2020 6f72 6965 6e74 6174 696f 6e3d 6f72    orientation=or
-000086d0: 6965 6e74 6174 696f 6e2c 0a20 2020 2020  ientation,.     
-000086e0: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-000086f0: 743d 7365 6c66 2c0a 2020 2020 2020 2020  t=self,.        
-00008700: 2020 2020 2020 2020 6c61 7965 723d 6c61          layer=la
-00008710: 7965 722c 0a20 2020 2020 2020 2020 2020  yer,.           
-00008720: 2020 2020 2070 6f72 745f 7479 7065 3d70       port_type=p
-00008730: 6f72 745f 7479 7065 206f 7220 226f 7074  ort_type or "opt
-00008740: 6963 616c 222c 0a20 2020 2020 2020 2020  ical",.         
-00008750: 2020 2020 2020 2063 726f 7373 5f73 6563         cross_sec
-00008760: 7469 6f6e 3d67 6574 5f63 726f 7373 5f73  tion=get_cross_s
-00008770: 6563 7469 6f6e 2863 726f 7373 5f73 6563  ection(cross_sec
-00008780: 7469 6f6e 290a 2020 2020 2020 2020 2020  tion).          
-00008790: 2020 2020 2020 6966 2063 726f 7373 5f73        if cross_s
-000087a0: 6563 7469 6f6e 0a20 2020 2020 2020 2020  ection.         
-000087b0: 2020 2020 2020 2065 6c73 6520 4e6f 6e65         else None
-000087c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000087d0: 2020 7368 6561 725f 616e 676c 653d 7368    shear_angle=sh
-000087e0: 6561 725f 616e 676c 652c 0a20 2020 2020  ear_angle,.     
-000087f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00008800: 2020 2020 2070 2e70 6172 656e 7420 3d20       p.parent = 
-00008810: 7365 6c66 0a20 2020 2020 2020 2020 2020  self.           
-00008820: 2069 6620 696e 666f 2069 7320 6e6f 7420   if info is not 
-00008830: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00008840: 2020 2020 2020 702e 696e 666f 203d 2069        p.info = i
-00008850: 6e66 6f0a 2020 2020 2020 2020 6966 206e  nfo.        if n
-00008860: 616d 6520 6973 206e 6f74 204e 6f6e 653a  ame is not None:
-00008870: 0a20 2020 2020 2020 2020 2020 2070 2e6e  .            p.n
-00008880: 616d 6520 3d20 6e61 6d65 0a20 2020 2020  ame = name.     
-00008890: 2020 2069 6620 702e 6e61 6d65 2069 6e20     if p.name in 
-000088a0: 7365 6c66 2e70 6f72 7473 3a0a 2020 2020  self.ports:.    
-000088b0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-000088c0: 6c75 6545 7272 6f72 2866 2261 6464 5f70  lueError(f"add_p
-000088d0: 6f72 7428 2920 506f 7274 206e 616d 6520  ort() Port name 
-000088e0: 7b70 2e6e 616d 6521 727d 2065 7869 7374  {p.name!r} exist
-000088f0: 7320 696e 207b 7365 6c66 2e6e 616d 6521  s in {self.name!
-00008900: 727d 2229 0a0a 2020 2020 2020 2020 7365  r}")..        se
-00008910: 6c66 2e70 6f72 7473 5b70 2e6e 616d 655d  lf.ports[p.name]
-00008920: 203d 2070 0a20 2020 2020 2020 2072 6574   = p.        ret
-00008930: 7572 6e20 700a 0a20 2020 2064 6566 2061  urn p..    def a
-00008940: 6464 5f70 6f72 7473 280a 2020 2020 2020  dd_ports(.      
-00008950: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00008960: 706f 7274 733a 2049 7465 7261 626c 655b  ports: Iterable[
-00008970: 506f 7274 5d20 7c20 6469 6374 5b73 7472  Port] | dict[str
-00008980: 2c20 506f 7274 5d2c 0a20 2020 2020 2020  , Port],.       
-00008990: 2070 7265 6669 783a 2073 7472 203d 2022   prefix: str = "
-000089a0: 222c 0a20 2020 2020 2020 2073 7566 6669  ",.        suffi
-000089b0: 783a 2073 7472 203d 2022 222c 0a20 2020  x: str = "",.   
-000089c0: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-000089d0: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-000089e0: 2020 2020 2020 2222 2241 6464 2061 206c        """Add a l
-000089f0: 6973 7420 6f72 2064 6963 7420 6f66 2070  ist or dict of p
-00008a00: 6f72 7473 2e0a 0a20 2020 2020 2020 2079  orts...        y
-00008a10: 6f75 2063 616e 2069 6e63 6c75 6465 2061  ou can include a
-00008a20: 2070 7265 6669 7820 746f 2061 6464 2074   prefix to add t
-00008a30: 6f20 7468 6520 6e65 7720 706f 7274 206e  o the new port n
-00008a40: 616d 6573 2074 6f20 6176 6f69 6420 6e61  ames to avoid na
-00008a50: 6d65 2063 6f6e 666c 6963 7473 2e0a 0a20  me conflicts... 
-00008a60: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00008a70: 2020 2020 2020 2020 2070 6f72 7473 3a20           ports: 
-00008a80: 6c69 7374 206f 7220 6469 6374 206f 6620  list or dict of 
-00008a90: 706f 7274 732e 0a20 2020 2020 2020 2020  ports..         
-00008aa0: 2020 2070 7265 6669 783a 2074 6f20 7072     prefix: to pr
-00008ab0: 6570 656e 6420 746f 2065 6163 6820 706f  epend to each po
-00008ac0: 7274 206e 616d 652e 0a20 2020 2020 2020  rt name..       
-00008ad0: 2020 2020 2073 7566 6669 783a 2074 6f20       suffix: to 
-00008ae0: 6170 7065 6e64 2074 6f20 6561 6368 2070  append to each p
-00008af0: 6f72 7420 6e61 6d65 2e0a 2020 2020 2020  ort name..      
-00008b00: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00008b10: 2068 6173 6174 7472 2870 6f72 7473 2c20   hasattr(ports, 
-00008b20: 2276 616c 7565 7322 293a 0a20 2020 2020  "values"):.     
-00008b30: 2020 2020 2020 2066 6f72 2070 6f72 745f         for port_
-00008b40: 6e61 6d65 2c20 706f 7274 2069 6e20 706f  name, port in po
-00008b50: 7274 732e 6974 656d 7328 293a 0a20 2020  rts.items():.   
-00008b60: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00008b70: 6520 3d20 6622 7b70 7265 6669 787d 7b70  e = f"{prefix}{p
-00008b80: 6f72 745f 6e61 6d65 7d7b 7375 6666 6978  ort_name}{suffix
-00008b90: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-00008ba0: 2020 2073 656c 662e 6164 645f 706f 7274     self.add_port
-00008bb0: 286e 616d 653d 6e61 6d65 2c20 706f 7274  (name=name, port
-00008bc0: 3d70 6f72 742c 202a 2a6b 7761 7267 7329  =port, **kwargs)
-00008bd0: 0a0a 2020 2020 2020 2020 656c 7365 3a0a  ..        else:.
-00008be0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00008bf0: 706f 7274 2069 6e20 706f 7274 733a 0a20  port in ports:. 
-00008c00: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00008c10: 616d 6520 3d20 6622 7b70 7265 6669 787d  ame = f"{prefix}
-00008c20: 7b70 6f72 742e 6e61 6d65 7d7b 7375 6666  {port.name}{suff
-00008c30: 6978 7d22 0a20 2020 2020 2020 2020 2020  ix}".           
-00008c40: 2020 2020 2073 656c 662e 6164 645f 706f       self.add_po
-00008c50: 7274 286e 616d 653d 6e61 6d65 2c20 706f  rt(name=name, po
-00008c60: 7274 3d70 6f72 742c 202a 2a6b 7761 7267  rt=port, **kwarg
-00008c70: 7329 0a0a 2020 2020 6465 6620 736e 6170  s)..    def snap
-00008c80: 5f70 6f72 7473 5f74 6f5f 6772 6964 2873  _ports_to_grid(s
-00008c90: 656c 662c 2067 7269 645f 6661 6374 6f72  elf, grid_factor
-00008ca0: 3a20 696e 7420 3d20 3129 202d 3e20 4e6f  : int = 1) -> No
-00008cb0: 6e65 3a0a 2020 2020 2020 2020 666f 7220  ne:.        for 
-00008cc0: 706f 7274 2069 6e20 7365 6c66 2e70 6f72  port in self.por
-00008cd0: 7473 2e76 616c 7565 7328 293a 0a20 2020  ts.values():.   
-00008ce0: 2020 2020 2020 2020 2070 6f72 742e 736e           port.sn
-00008cf0: 6170 5f74 6f5f 6772 6964 2867 7269 645f  ap_to_grid(grid_
-00008d00: 6661 6374 6f72 3d67 7269 645f 6661 6374  factor=grid_fact
-00008d10: 6f72 290a 0a20 2020 2064 6566 2072 656d  or)..    def rem
-00008d20: 6f76 655f 6c61 7965 7273 280a 2020 2020  ove_layers(.    
-00008d30: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00008d40: 2020 6c61 7965 7273 3a20 6c69 7374 5b4c    layers: list[L
-00008d50: 6179 6572 5370 6563 5d2c 0a20 2020 2020  ayerSpec],.     
-00008d60: 2020 2069 6e63 6c75 6465 5f6c 6162 656c     include_label
-00008d70: 733a 2062 6f6f 6c20 3d20 5472 7565 2c0a  s: bool = True,.
-00008d80: 2020 2020 2020 2020 696e 7665 7274 5f73          invert_s
-00008d90: 656c 6563 7469 6f6e 3a20 626f 6f6c 203d  election: bool =
-00008da0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00008db0: 7265 6375 7273 6976 653a 2062 6f6f 6c20  recursive: bool 
-00008dc0: 3d20 5472 7565 2c0a 2020 2020 2920 2d3e  = True,.    ) ->
-00008dd0: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
-00008de0: 2020 2020 2222 2252 656d 6f76 6520 6120      """Remove a 
-00008df0: 6c69 7374 206f 6620 6c61 7965 7273 2061  list of layers a
-00008e00: 6e64 2072 6574 7572 6e73 2074 6865 2073  nd returns the s
-00008e10: 616d 6520 436f 6d70 6f6e 656e 742e 0a0a  ame Component...
-00008e20: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00008e30: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
-00008e40: 3a20 6c69 7374 206f 6620 6c61 7965 7273  : list of layers
-00008e50: 2074 6f20 7265 6d6f 7665 2e0a 2020 2020   to remove..    
-00008e60: 2020 2020 2020 2020 696e 636c 7564 655f          include_
-00008e70: 6c61 6265 6c73 3a20 7265 6d6f 7665 206c  labels: remove l
-00008e80: 6162 656c 7320 6f6e 2074 686f 7365 206c  abels on those l
-00008e90: 6179 6572 732e 0a20 2020 2020 2020 2020  ayers..         
-00008ea0: 2020 2069 6e76 6572 745f 7365 6c65 6374     invert_select
-00008eb0: 696f 6e3a 2072 656d 6f76 6573 2061 6c6c  ion: removes all
-00008ec0: 206c 6179 6572 7320 6578 6365 7074 206c   layers except l
-00008ed0: 6179 6572 7320 7370 6563 6966 6965 642e  ayers specified.
-00008ee0: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
-00008ef0: 7572 7369 7665 3a20 6f70 6572 6174 6520  ursive: operate 
-00008f00: 6f6e 2074 6865 2063 656c 6c73 2069 6e63  on the cells inc
-00008f10: 6c75 6465 6420 696e 2074 6869 7320 6365  luded in this ce
-00008f20: 6c6c 2e0a 2020 2020 2020 2020 2222 220a  ll..        """.
-00008f30: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-00008f40: 6661 6374 6f72 7920 696d 706f 7274 2067  factory import g
-00008f50: 6574 5f6c 6179 6572 0a0a 2020 2020 2020  et_layer..      
-00008f60: 2020 636f 6d70 6f6e 656e 7420 3d20 7365    component = se
-00008f70: 6c66 2e66 6c61 7474 656e 2829 2069 6620  lf.flatten() if 
-00008f80: 7265 6375 7273 6976 6520 616e 6420 7365  recursive and se
-00008f90: 6c66 2e72 6566 6572 656e 6365 7320 656c  lf.references el
-00008fa0: 7365 2073 656c 660a 2020 2020 2020 2020  se self.        
-00008fb0: 6c61 7965 7273 203d 205b 6765 745f 6c61  layers = [get_la
-00008fc0: 7965 7228 6c61 7965 7229 2066 6f72 206c  yer(layer) for l
-00008fd0: 6179 6572 2069 6e20 6c61 7965 7273 5d0a  ayer in layers].
-00008fe0: 0a20 2020 2020 2020 2073 686f 756c 645f  .        should_
-00008ff0: 7265 6d6f 7665 203d 206e 6f74 2069 6e76  remove = not inv
-00009000: 6572 745f 7365 6c65 6374 696f 6e0a 2020  ert_selection.  
-00009010: 2020 2020 2020 636f 6d70 6f6e 656e 742e        component.
-00009020: 5f63 656c 6c2e 6669 6c74 6572 280a 2020  _cell.filter(.  
-00009030: 2020 2020 2020 2020 2020 7370 6563 3d6c            spec=l
-00009040: 6179 6572 732c 0a20 2020 2020 2020 2020  ayers,.         
-00009050: 2020 2072 656d 6f76 653d 7368 6f75 6c64     remove=should
-00009060: 5f72 656d 6f76 652c 0a20 2020 2020 2020  _remove,.       
-00009070: 2020 2020 2070 6f6c 7967 6f6e 733d 5472       polygons=Tr
-00009080: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-00009090: 7061 7468 733d 5472 7565 2c0a 2020 2020  paths=True,.    
-000090a0: 2020 2020 2020 2020 6c61 6265 6c73 3d69          labels=i
-000090b0: 6e63 6c75 6465 5f6c 6162 656c 732c 0a20  nclude_labels,. 
-000090c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000090d0: 2072 6574 7572 6e20 636f 6d70 6f6e 656e   return componen
-000090e0: 740a 0a20 2020 2064 6566 2065 7874 7261  t..    def extra
-000090f0: 6374 280a 2020 2020 2020 2020 7365 6c66  ct(.        self
-00009100: 2c0a 2020 2020 2020 2020 6c61 7965 7273  ,.        layers
-00009110: 3a20 6c69 7374 5b4c 6179 6572 5370 6563  : list[LayerSpec
-00009120: 5d2c 0a20 2020 2020 2020 2069 6e63 6c75  ],.        inclu
-00009130: 6465 5f6c 6162 656c 733a 2062 6f6f 6c20  de_labels: bool 
-00009140: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-00009150: 7265 6375 7273 6976 653a 2062 6f6f 6c20  recursive: bool 
-00009160: 3d20 5472 7565 2c0a 2020 2020 2920 2d3e  = True,.    ) ->
-00009170: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
-00009180: 2020 2020 2222 2245 7874 7261 6374 2070      """Extract p
-00009190: 6f6c 7967 6f6e 7320 6672 6f6d 2061 2043  olygons from a C
-000091a0: 6f6d 706f 6e65 6e74 2061 6e64 2072 6574  omponent and ret
-000091b0: 7572 6e73 2061 206e 6577 2043 6f6d 706f  urns a new Compo
-000091c0: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
-000091d0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-000091e0: 206c 6179 6572 733a 206c 6973 7420 6f66   layers: list of
-000091f0: 206c 6179 6572 7320 746f 2065 7874 7261   layers to extra
-00009200: 6374 2e0a 2020 2020 2020 2020 2020 2020  ct..            
-00009210: 696e 636c 7564 655f 6c61 6265 6c73 3a20  include_labels: 
-00009220: 6578 7472 6163 7420 6c61 6265 6c73 206f  extract labels o
-00009230: 6e20 7468 6f73 6520 6c61 7965 7273 2e0a  n those layers..
-00009240: 2020 2020 2020 2020 2020 2020 7265 6375              recu
-00009250: 7273 6976 653a 206f 7065 7261 7465 206f  rsive: operate o
-00009260: 6e20 7468 6520 6365 6c6c 7320 696e 636c  n the cells incl
-00009270: 7564 6564 2069 6e20 7468 6973 2063 656c  uded in this cel
-00009280: 6c2e 0a20 2020 2020 2020 2022 2222 0a20  l..        """. 
-00009290: 2020 2020 2020 2063 203d 2073 656c 662e         c = self.
-000092a0: 636f 7079 2829 0a0a 2020 2020 2020 2020  copy()..        
-000092b0: 7265 7475 726e 2063 2e72 656d 6f76 655f  return c.remove_
-000092c0: 6c61 7965 7273 280a 2020 2020 2020 2020  layers(.        
-000092d0: 2020 2020 6c61 7965 7273 2c0a 2020 2020      layers,.    
-000092e0: 2020 2020 2020 2020 696e 7665 7274 5f73          invert_s
-000092f0: 656c 6563 7469 6f6e 3d54 7275 652c 0a20  election=True,. 
-00009300: 2020 2020 2020 2020 2020 2072 6563 7572             recur
-00009310: 7369 7665 3d72 6563 7572 7369 7665 2c0a  sive=recursive,.
-00009320: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-00009330: 7564 655f 6c61 6265 6c73 3d69 6e63 6c75  ude_labels=inclu
-00009340: 6465 5f6c 6162 656c 732c 0a20 2020 2020  de_labels,.     
-00009350: 2020 2029 0a0a 2020 2020 6465 6620 6164     )..    def ad
-00009360: 645f 706f 6c79 676f 6e28 0a20 2020 2020  d_polygon(.     
-00009370: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00009380: 2070 6f69 6e74 732c 0a20 2020 2020 2020   points,.       
-00009390: 206c 6179 6572 3a20 7374 7220 7c20 696e   layer: str | in
-000093a0: 7420 7c20 7475 706c 655b 696e 742c 2069  t | tuple[int, i
-000093b0: 6e74 5d20 7c20 6e70 2e6e 616e 203d 206e  nt] | np.nan = n
-000093c0: 702e 6e61 6e2c 0a20 2020 2020 2020 2073  p.nan,.        s
-000093d0: 6e61 705f 746f 5f67 7269 643a 2062 6f6f  nap_to_grid: boo
-000093e0: 6c20 3d20 5472 7565 2c0a 2020 2020 2920  l = True,.    ) 
-000093f0: 2d3e 2050 6f6c 7967 6f6e 3a0a 2020 2020  -> Polygon:.    
-00009400: 2020 2020 2222 2241 6464 7320 6120 506f      """Adds a Po
-00009410: 6c79 676f 6e20 746f 2074 6865 2043 6f6d  lygon to the Com
-00009420: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
-00009430: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00009440: 2020 2070 6f69 6e74 733a 2043 6f6f 7264     points: Coord
-00009450: 696e 6174 6573 206f 6620 7468 6520 7665  inates of the ve
-00009460: 7274 6963 6573 206f 6620 7468 6520 506f  rtices of the Po
-00009470: 6c79 676f 6e2e 0a20 2020 2020 2020 2020  lygon..         
-00009480: 2020 206c 6179 6572 3a20 6c61 7965 7220     layer: layer 
-00009490: 7370 6563 2074 6f20 6164 6420 706f 6c79  spec to add poly
-000094a0: 676f 6e20 6f6e 2e0a 2020 2020 2020 2020  gon on..        
-000094b0: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-000094c0: 2067 6473 6661 6374 6f72 792e 7064 6b20   gdsfactory.pdk 
-000094d0: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
-000094e0: 0a0a 2020 2020 2020 2020 6966 206c 6179  ..        if lay
-000094f0: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
-00009500: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00009510: 6f6e 650a 2020 2020 2020 2020 656c 6966  one.        elif
-00009520: 2069 7369 6e73 7461 6e63 6528 6c61 7965   isinstance(laye
-00009530: 722c 2073 6574 293a 0a20 2020 2020 2020  r, set):.       
-00009540: 2020 2020 2070 6f6c 7967 6f6e 7320 3d20       polygons = 
-00009550: 5b73 656c 662e 6164 645f 706f 6c79 676f  [self.add_polygo
-00009560: 6e28 706f 696e 7473 2c20 6c79 2920 666f  n(points, ly) fo
-00009570: 7220 6c79 2069 6e20 6c61 7965 725d 0a20  r ly in layer]. 
-00009580: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00009590: 6e20 706f 6c79 676f 6e73 5b30 5d0a 0a20  n polygons[0].. 
-000095a0: 2020 2020 2020 206c 6179 6572 203d 2067         layer = g
-000095b0: 6574 5f6c 6179 6572 286c 6179 6572 290a  et_layer(layer).
-000095c0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000095d0: 7461 6e63 6528 706f 696e 7473 2c20 6764  tance(points, gd
-000095e0: 7374 6b2e 506f 6c79 676f 6e29 3a0a 2020  stk.Polygon):.  
-000095f0: 2020 2020 2020 2020 2020 2320 6966 206c            # if l
-00009600: 6179 6572 2069 7320 756e 7370 6563 6966  ayer is unspecif
-00009610: 6965 6420 6f72 206d 6174 6368 6573 206f  ied or matches o
-00009620: 7269 6769 6e61 6c20 706f 6c79 676f 6e2c  riginal polygon,
-00009630: 206a 7573 7420 6164 6420 6974 2061 732d   just add it as-
-00009640: 6973 0a20 2020 2020 2020 2020 2020 2070  is.            p
-00009650: 6f6c 7967 6f6e 203d 2070 6f69 6e74 730a  olygon = points.
-00009660: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00009670: 6179 6572 2069 7320 6e70 2e6e 616e 206f  ayer is np.nan o
-00009680: 7220 280a 2020 2020 2020 2020 2020 2020  r (.            
-00009690: 2020 2020 6973 696e 7374 616e 6365 286c      isinstance(l
-000096a0: 6179 6572 2c20 7475 706c 6529 2061 6e64  ayer, tuple) and
-000096b0: 2028 706f 6c79 676f 6e2e 6c61 7965 722c   (polygon.layer,
-000096c0: 2070 6f6c 7967 6f6e 2e64 6174 6174 7970   polygon.datatyp
-000096d0: 6529 203d 3d20 6c61 7965 720a 2020 2020  e) == layer.    
-000096e0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-000096f0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00009700: 6f6e 203d 2050 6f6c 7967 6f6e 2870 6f6c  on = Polygon(pol
-00009710: 7967 6f6e 2e70 6f69 6e74 732c 2028 706f  ygon.points, (po
-00009720: 6c79 676f 6e2e 6c61 7965 722c 2070 6f6c  lygon.layer, pol
-00009730: 7967 6f6e 2e64 6174 6174 7970 6529 290a  ygon.datatype)).
-00009740: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00009750: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009760: 2020 6c61 7965 722c 2064 6174 6174 7970    layer, datatyp
-00009770: 6520 3d20 5f70 6172 7365 5f6c 6179 6572  e = _parse_layer
-00009780: 286c 6179 6572 290a 2020 2020 2020 2020  (layer).        
-00009790: 2020 2020 2020 2020 706f 6c79 676f 6e20          polygon 
-000097a0: 3d20 506f 6c79 676f 6e28 706f 6c79 676f  = Polygon(polygo
-000097b0: 6e2e 706f 696e 7473 2c20 286c 6179 6572  n.points, (layer
-000097c0: 2c20 6461 7461 7479 7065 2929 0a0a 2020  , datatype))..  
-000097d0: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-000097e0: 6174 7472 2870 6f69 6e74 732c 2022 7072  attr(points, "pr
-000097f0: 6f70 6572 7469 6573 2229 3a0a 2020 2020  operties"):.    
-00009800: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-00009810: 676f 6e2e 7072 6f70 6572 7469 6573 203d  gon.properties =
-00009820: 2064 6565 7063 6f70 7928 706f 696e 7473   deepcopy(points
-00009830: 2e70 726f 7065 7274 6965 7329 0a0a 2020  .properties)..  
-00009840: 2020 2020 2020 2020 2020 6966 2070 6f6c            if pol
-00009850: 7967 6f6e 2e61 7265 6128 2920 3e20 303a  ygon.area() > 0:
-00009860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009870: 2073 656c 662e 5f61 6464 5f70 6f6c 7967   self._add_polyg
-00009880: 6f6e 7328 706f 6c79 676f 6e29 0a20 2020  ons(polygon).   
-00009890: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000098a0: 706f 6c79 676f 6e0a 0a20 2020 2020 2020  polygon..       
-000098b0: 2065 6c69 6620 6861 7361 7474 7228 706f   elif hasattr(po
-000098c0: 696e 7473 2c20 2267 656f 6d73 2229 3a0a  ints, "geoms"):.
-000098d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000098e0: 6765 6f6d 2069 6e20 706f 696e 7473 2e67  geom in points.g
-000098f0: 656f 6d73 3a0a 2020 2020 2020 2020 2020  eoms:.          
-00009900: 2020 2020 2020 706f 6c79 676f 6e20 3d20        polygon = 
-00009910: 7365 6c66 2e61 6464 5f70 6f6c 7967 6f6e  self.add_polygon
-00009920: 2867 656f 6d2c 206c 6179 6572 3d6c 6179  (geom, layer=lay
-00009930: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-00009940: 7265 7475 726e 2070 6f6c 7967 6f6e 0a20  return polygon. 
-00009950: 2020 2020 2020 2065 6c69 6620 6861 7361         elif hasa
-00009960: 7474 7228 706f 696e 7473 2c20 2265 7874  ttr(points, "ext
-00009970: 6572 696f 7222 293a 2020 2320 706f 696e  erior"):  # poin
-00009980: 7473 2069 7320 6120 7368 6170 656c 7920  ts is a shapely 
-00009990: 506f 6c79 676f 6e0a 2020 2020 2020 2020  Polygon.        
-000099a0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000099b0: 5f61 6464 5f70 6f6c 7967 6f6e 5f73 6861  _add_polygon_sha
-000099c0: 7065 6c79 286c 6179 6572 2c20 706f 696e  pely(layer, poin
-000099d0: 7473 290a 0a20 2020 2020 2020 2070 6f69  ts)..        poi
-000099e0: 6e74 7320 3d20 6e70 2e61 7361 7272 6179  nts = np.asarray
-000099f0: 2870 6f69 6e74 7329 0a20 2020 2020 2020  (points).       
-00009a00: 2069 6620 706f 696e 7473 2e6e 6469 6d20   if points.ndim 
-00009a10: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-00009a20: 2020 7265 7475 726e 205b 7365 6c66 2e61    return [self.a
-00009a30: 6464 5f70 6f6c 7967 6f6e 2870 6f6c 792c  dd_polygon(poly,
-00009a40: 206c 6179 6572 3d6c 6179 6572 2920 666f   layer=layer) fo
-00009a50: 7220 706f 6c79 2069 6e20 706f 696e 7473  r poly in points
-00009a60: 5d0a 2020 2020 2020 2020 6966 206c 6179  ].        if lay
-00009a70: 6572 2069 7320 6e70 2e6e 616e 3a0a 2020  er is np.nan:.  
-00009a80: 2020 2020 2020 2020 2020 6c61 7965 7220            layer 
-00009a90: 3d20 300a 0a20 2020 2020 2020 2069 6620  = 0..        if 
-00009aa0: 706f 696e 7473 2e6e 6469 6d20 3d3d 2032  points.ndim == 2
-00009ab0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00009ac0: 6164 6420 7369 6e67 6c65 2070 6f6c 7967  add single polyg
-00009ad0: 6f6e 2066 726f 6d20 706f 696e 7473 0a20  on from points. 
-00009ae0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00009af0: 6e28 706f 696e 7473 5b30 5d29 203e 2032  n(points[0]) > 2
-00009b00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009b10: 2020 2320 436f 6e76 6572 7420 746f 2066    # Convert to f
-00009b20: 6f72 6d20 5b5b 312c 325d 2c5b 332c 345d  orm [[1,2],[3,4]
-00009b30: 2c5b 352c 365d 5d0a 2020 2020 2020 2020  ,[5,6]].        
-00009b40: 2020 2020 2020 2020 706f 696e 7473 203d          points =
-00009b50: 206e 702e 636f 6c75 6d6e 5f73 7461 636b   np.column_stack
-00009b60: 2870 6f69 6e74 7329 0a20 2020 2020 2020  (points).       
-00009b70: 2020 2020 2070 6f69 6e74 7320 3d20 736e       points = sn
-00009b80: 6170 2e73 6e61 705f 746f 5f67 7269 6428  ap.snap_to_grid(
-00009b90: 706f 696e 7473 2920 6966 2073 6e61 705f  points) if snap_
-00009ba0: 746f 5f67 7269 6420 656c 7365 2070 6f69  to_grid else poi
-00009bb0: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
-00009bc0: 6c61 7965 722c 2064 6174 6174 7970 6520  layer, datatype 
-00009bd0: 3d20 5f70 6172 7365 5f6c 6179 6572 286c  = _parse_layer(l
-00009be0: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
-00009bf0: 2020 706f 6c79 676f 6e20 3d20 506f 6c79    polygon = Poly
-00009c00: 676f 6e28 706f 696e 7473 2c20 286c 6179  gon(points, (lay
-00009c10: 6572 2c20 6461 7461 7479 7065 2929 0a20  er, datatype)). 
-00009c20: 2020 2020 2020 2020 2020 2069 6620 706f             if po
-00009c30: 6c79 676f 6e2e 6172 6561 2829 203e 2030  lygon.area() > 0
-00009c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009c50: 2020 7365 6c66 2e5f 6164 645f 706f 6c79    self._add_poly
-00009c60: 676f 6e73 2870 6f6c 7967 6f6e 290a 2020  gons(polygon).  
-00009c70: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00009c80: 2070 6f6c 7967 6f6e 0a20 2020 2020 2020   polygon.       
-00009c90: 2065 6c69 6620 706f 696e 7473 2e6e 6469   elif points.ndi
-00009ca0: 6d20 3d3d 2033 3a0a 2020 2020 2020 2020  m == 3:.        
-00009cb0: 2020 2020 6c61 7965 722c 2064 6174 6174      layer, datat
-00009cc0: 7970 6520 3d20 5f70 6172 7365 5f6c 6179  ype = _parse_lay
-00009cd0: 6572 286c 6179 6572 290a 0a20 2020 2020  er(layer)..     
-00009ce0: 2020 2020 2020 2070 6f6c 7967 6f6e 7320         polygons 
-00009cf0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-00009d00: 2066 6f72 2070 6f6c 7967 6f6e 5f70 6f69   for polygon_poi
-00009d10: 6e74 7320 696e 2070 6f69 6e74 733a 0a20  nts in points:. 
-00009d20: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00009d30: 6f6c 7967 6f6e 203d 2050 6f6c 7967 6f6e  olygon = Polygon
-00009d40: 2870 6f6c 7967 6f6e 5f70 6f69 6e74 732c  (polygon_points,
-00009d50: 2028 6c61 7965 722c 2064 6174 6174 7970   (layer, datatyp
-00009d60: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
-00009d70: 2020 2020 6966 2070 6f6c 7967 6f6e 2e61      if polygon.a
-00009d80: 7265 6128 2920 3e20 303a 0a20 2020 2020  rea() > 0:.     
-00009d90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00009da0: 6f6c 7967 6f6e 732e 6170 7065 6e64 2870  olygons.append(p
-00009db0: 6f6c 7967 6f6e 290a 0a20 2020 2020 2020  olygon)..       
-00009dc0: 2020 2020 2073 656c 662e 5f61 6464 5f70       self._add_p
-00009dd0: 6f6c 7967 6f6e 7328 2a70 6f6c 7967 6f6e  olygons(*polygon
-00009de0: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
-00009df0: 6574 7572 6e20 706f 6c79 676f 6e73 0a20  eturn polygons. 
-00009e00: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00009e10: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00009e20: 616c 7565 4572 726f 7228 6622 556e 6162  alueError(f"Unab
-00009e30: 6c65 2074 6f20 6164 6420 7b70 6f69 6e74  le to add {point
-00009e40: 732e 6e64 696d 7d2d 6469 6d65 6e73 696f  s.ndim}-dimensio
-00009e50: 6e61 6c20 706f 696e 7473 206f 626a 6563  nal points objec
-00009e60: 7422 290a 0a20 2020 2064 6566 205f 6164  t")..    def _ad
-00009e70: 645f 706f 6c79 676f 6e5f 7368 6170 656c  d_polygon_shapel
-00009e80: 7928 7365 6c66 2c20 6c61 7965 722c 2070  y(self, layer, p
-00009e90: 6f69 6e74 7329 3a0a 2020 2020 2020 2020  oints):.        
-00009ea0: 6c61 7965 722c 2064 6174 6174 7970 6520  layer, datatype 
-00009eb0: 3d20 5f70 6172 7365 5f6c 6179 6572 286c  = _parse_layer(l
-00009ec0: 6179 6572 290a 2020 2020 2020 2020 706f  ayer).        po
-00009ed0: 696e 7473 5f6f 6e5f 6772 6964 203d 2073  ints_on_grid = s
-00009ee0: 6e61 705f 746f 5f67 7269 6428 706f 696e  nap_to_grid(poin
-00009ef0: 7473 2e65 7874 6572 696f 722e 636f 6f72  ts.exterior.coor
-00009f00: 6473 290a 2020 2020 2020 2020 706f 6c79  ds).        poly
-00009f10: 676f 6e20 3d20 506f 6c79 676f 6e28 706f  gon = Polygon(po
-00009f20: 696e 7473 5f6f 6e5f 6772 6964 2c20 286c  ints_on_grid, (l
-00009f30: 6179 6572 2c20 6461 7461 7479 7065 2929  ayer, datatype))
-00009f40: 0a0a 2020 2020 2020 2020 6966 2070 6f69  ..        if poi
-00009f50: 6e74 732e 696e 7465 7269 6f72 733a 0a20  nts.interiors:. 
-00009f60: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00009f70: 6e20 7365 6c66 2e5f 6164 645f 706f 6c79  n self._add_poly
-00009f80: 676f 6e5f 7368 6170 656c 795f 7769 7468  gon_shapely_with
-00009f90: 5f68 6f6c 6573 280a 2020 2020 2020 2020  _holes(.        
-00009fa0: 2020 2020 2020 2020 706f 696e 7473 2c20          points, 
-00009fb0: 6c61 7965 722c 2064 6174 6174 7970 652c  layer, datatype,
-00009fc0: 2070 6f6c 7967 6f6e 0a20 2020 2020 2020   polygon.       
-00009fd0: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-00009fe0: 656c 662e 5f61 6464 5f70 6f6c 7967 6f6e  elf._add_polygon
-00009ff0: 7328 706f 6c79 676f 6e29 0a20 2020 2020  s(polygon).     
-0000a000: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
-0000a010: 6e0a 0a20 2020 2064 6566 205f 6164 645f  n..    def _add_
-0000a020: 706f 6c79 676f 6e5f 7368 6170 656c 795f  polygon_shapely_
-0000a030: 7769 7468 5f68 6f6c 6573 2873 656c 662c  with_holes(self,
-0000a040: 2070 6f69 6e74 732c 206c 6179 6572 2c20   points, layer, 
-0000a050: 6461 7461 7479 7065 2c20 706f 6c79 676f  datatype, polygo
-0000a060: 6e29 3a0a 2020 2020 2020 2020 6672 6f6d  n):.        from
-0000a070: 2073 6861 7065 6c79 2069 6d70 6f72 7420   shapely import 
-0000a080: 6765 745f 636f 6f72 6469 6e61 7465 730a  get_coordinates.
-0000a090: 0a20 2020 2020 2020 2070 6f69 6e74 735f  .        points_
-0000a0a0: 6f6e 5f67 7269 645f 696e 7465 7269 6f72  on_grid_interior
-0000a0b0: 203d 206e 702e 726f 756e 6428 6765 745f   = np.round(get_
-0000a0c0: 636f 6f72 6469 6e61 7465 7328 706f 696e  coordinates(poin
-0000a0d0: 7473 2e69 6e74 6572 696f 7273 292c 2033  ts.interiors), 3
-0000a0e0: 290a 2020 2020 2020 2020 706f 6c79 676f  ).        polygo
-0000a0f0: 6e5f 696e 7465 7269 6f72 203d 2050 6f6c  n_interior = Pol
-0000a100: 7967 6f6e 2870 6f69 6e74 735f 6f6e 5f67  ygon(points_on_g
-0000a110: 7269 645f 696e 7465 7269 6f72 2c20 286c  rid_interior, (l
-0000a120: 6179 6572 2c20 6461 7461 7479 7065 2929  ayer, datatype))
-0000a130: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
-0000a140: 7320 3d20 6764 7374 6b2e 626f 6f6c 6561  s = gdstk.boolea
-0000a150: 6e28 0a20 2020 2020 2020 2020 2020 2070  n(.            p
-0000a160: 6f6c 7967 6f6e 2c0a 2020 2020 2020 2020  olygon,.        
-0000a170: 2020 2020 706f 6c79 676f 6e5f 696e 7465      polygon_inte
-0000a180: 7269 6f72 2c0a 2020 2020 2020 2020 2020  rior,.          
-0000a190: 2020 6f70 6572 6174 696f 6e3d 226e 6f74    operation="not
-0000a1a0: 222c 0a20 2020 2020 2020 2020 2020 206c  ",.            l
-0000a1b0: 6179 6572 3d6c 6179 6572 2c0a 2020 2020  ayer=layer,.    
-0000a1c0: 2020 2020 2020 2020 6461 7461 7479 7065          datatype
-0000a1d0: 3d64 6174 6174 7970 652c 0a20 2020 2020  =datatype,.     
-0000a1e0: 2020 2029 0a20 2020 2020 2020 2066 6f72     ).        for
-0000a1f0: 2070 6f6c 7967 6f6e 2069 6e20 706f 6c79   polygon in poly
-0000a200: 676f 6e73 3a0a 2020 2020 2020 2020 2020  gons:.          
-0000a210: 2020 6966 2070 6f6c 7967 6f6e 2e61 7265    if polygon.are
-0000a220: 6128 2920 3e20 303a 0a20 2020 2020 2020  a() > 0:.       
-0000a230: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
-0000a240: 6464 5f70 6f6c 7967 6f6e 7328 706f 6c79  dd_polygons(poly
-0000a250: 676f 6e29 0a20 2020 2020 2020 2072 6574  gon).        ret
-0000a260: 7572 6e20 706f 6c79 676f 6e0a 0a20 2020  urn polygon..   
-0000a270: 2064 6566 205f 6164 645f 706f 6c79 676f   def _add_polygo
-0000a280: 6e73 2873 656c 662c 202a 706f 6c79 676f  ns(self, *polygo
-0000a290: 6e73 3a20 6c69 7374 5b50 6f6c 7967 6f6e  ns: list[Polygon
-0000a2a0: 5d29 202d 3e20 4e6f 6e65 3a0a 2020 2020  ]) -> None:.    
-0000a2b0: 2020 2020 7365 6c66 2e69 735f 756e 6c6f      self.is_unlo
-0000a2c0: 636b 6564 2829 0a20 2020 2020 2020 2073  cked().        s
-0000a2d0: 656c 662e 5f63 656c 6c2e 6164 6428 2a70  elf._cell.add(*p
-0000a2e0: 6f6c 7967 6f6e 7329 0a0a 2020 2020 6465  olygons)..    de
-0000a2f0: 6620 636f 7079 2873 656c 6629 202d 3e20  f copy(self) -> 
-0000a300: 436f 6d70 6f6e 656e 743a 0a20 2020 2020  Component:.     
-0000a310: 2020 2072 6574 7572 6e20 636f 7079 2873     return copy(s
-0000a320: 656c 6629 0a0a 2020 2020 6465 6620 6164  elf)..    def ad
-0000a330: 645f 7265 665f 636f 6e74 6169 6e65 7228  d_ref_container(
-0000a340: 7365 6c66 2c20 636f 6d70 6f6e 656e 743a  self, component:
-0000a350: 2043 6f6d 706f 6e65 6e74 2920 2d3e 2043   Component) -> C
-0000a360: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-0000a370: 653a 0a20 2020 2020 2020 2022 2222 4164  e:.        """Ad
-0000a380: 6420 7265 6665 7265 6e63 652c 2070 6f72  d reference, por
-0000a390: 7473 2061 6e64 2063 6f70 795f 6368 696c  ts and copy_chil
-0000a3a0: 645f 696e 666f 2e22 2222 0a20 2020 2020  d_info.""".     
-0000a3b0: 2020 2072 6566 203d 2073 656c 6620 3c3c     ref = self <<
-0000a3c0: 2063 6f6d 706f 6e65 6e74 0a20 2020 2020   component.     
-0000a3d0: 2020 2073 656c 662e 6164 645f 706f 7274     self.add_port
-0000a3e0: 7328 7265 662e 706f 7274 7329 0a20 2020  s(ref.ports).   
-0000a3f0: 2020 2020 2073 656c 662e 636f 7079 5f63       self.copy_c
-0000a400: 6869 6c64 5f69 6e66 6f28 636f 6d70 6f6e  hild_info(compon
-0000a410: 656e 7429 0a20 2020 2020 2020 2072 6574  ent).        ret
-0000a420: 7572 6e20 7265 660a 0a20 2020 2064 6566  urn ref..    def
-0000a430: 2063 6f70 795f 6368 696c 645f 696e 666f   copy_child_info
-0000a440: 2873 656c 662c 2063 6f6d 706f 6e65 6e74  (self, component
-0000a450: 3a20 436f 6d70 6f6e 656e 7429 202d 3e20  : Component) -> 
-0000a460: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-0000a470: 2243 6f70 7920 616e 6420 7365 7474 696e  "Copy and settin
-0000a480: 6773 2069 6e66 6f20 6672 6f6d 2063 6869  gs info from chi
-0000a490: 6c64 2063 6f6d 706f 6e65 6e74 2069 6e74  ld component int
-0000a4a0: 6f20 7061 7265 6e74 2e0a 0a20 2020 2020  o parent...     
-0000a4b0: 2020 2050 6172 656e 7420 636f 6d70 6f6e     Parent compon
-0000a4c0: 656e 7473 2063 616e 2061 6363 6573 7320  ents can access 
-0000a4d0: 6368 696c 6420 6365 6c6c 7320 7365 7474  child cells sett
-0000a4e0: 696e 6773 2e0a 2020 2020 2020 2020 2222  ings..        ""
-0000a4f0: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-0000a500: 2069 7369 6e73 7461 6e63 6528 636f 6d70   isinstance(comp
-0000a510: 6f6e 656e 742c 2043 6f6d 706f 6e65 6e74  onent, Component
-0000a520: 207c 2043 6f6d 706f 6e65 6e74 5265 6665   | ComponentRefe
-0000a530: 7265 6e63 6529 3a0a 2020 2020 2020 2020  rence):.        
-0000a540: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000a550: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0000a560: 2020 2020 2020 6622 7b74 7970 6528 636f        f"{type(co
-0000a570: 6d70 6f6e 656e 7429 7d22 2022 6973 206e  mponent)}" "is n
-0000a580: 6f74 2061 2043 6f6d 706f 6e65 6e74 206f  ot a Component o
-0000a590: 7220 436f 6d70 6f6e 656e 7452 6566 6572  r ComponentRefer
-0000a5a0: 656e 6365 220a 2020 2020 2020 2020 2020  ence".          
-0000a5b0: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-0000a5c0: 662e 5f67 6574 5f63 6869 6c64 5f6e 616d  f._get_child_nam
-0000a5d0: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
-0000a5e0: 2073 656c 662e 6368 696c 6420 3d20 636f   self.child = co
-0000a5f0: 6d70 6f6e 656e 740a 2020 2020 2020 2020  mponent.        
-0000a600: 7365 6c66 2e69 6e66 6f2e 7570 6461 7465  self.info.update
-0000a610: 2864 6565 7063 6f70 7928 636f 6d70 6f6e  (deepcopy(compon
-0000a620: 656e 742e 696e 666f 2929 0a20 2020 2020  ent.info)).     
-0000a630: 2020 2073 656c 662e 7365 7474 696e 6773     self.settings
-0000a640: 2e75 7064 6174 6528 6465 6570 636f 7079  .update(deepcopy
-0000a650: 2863 6f6d 706f 6e65 6e74 2e73 6574 7469  (component.setti
-0000a660: 6e67 7329 290a 0a20 2020 2040 7072 6f70  ngs))..    @prop
-0000a670: 6572 7479 0a20 2020 2064 6566 2073 697a  erty.    def siz
-0000a680: 655f 696e 666f 2873 656c 6629 202d 3e20  e_info(self) -> 
-0000a690: 5369 7a65 496e 666f 3a0a 2020 2020 2020  SizeInfo:.      
-0000a6a0: 2020 2222 2253 697a 6520 696e 666f 206f    """Size info o
-0000a6b0: 6620 7468 6520 636f 6d70 6f6e 656e 742e  f the component.
-0000a6c0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0000a6d0: 726e 2053 697a 6549 6e66 6f28 7365 6c66  rn SizeInfo(self
-0000a6e0: 2e62 626f 7829 0a0a 2020 2020 6465 6620  .bbox)..    def 
-0000a6f0: 6765 745f 7365 7474 696e 6728 7365 6c66  get_setting(self
-0000a700: 2c20 7365 7474 696e 673a 2073 7472 2920  , setting: str) 
-0000a710: 2d3e 2073 7472 207c 2069 6e74 207c 2066  -> str | int | f
-0000a720: 6c6f 6174 3a0a 2020 2020 2020 2020 7265  loat:.        re
-0000a730: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
-0000a740: 2020 2073 656c 662e 696e 666f 2e67 6574     self.info.get
-0000a750: 2873 6574 7469 6e67 290a 2020 2020 2020  (setting).      
-0000a760: 2020 2020 2020 6f72 2073 656c 662e 7365        or self.se
-0000a770: 7474 696e 6773 2e66 756c 6c2e 6765 7428  ttings.full.get(
-0000a780: 7365 7474 696e 6729 0a20 2020 2020 2020  setting).       
-0000a790: 2020 2020 206f 7220 7365 6c66 2e6d 6574       or self.met
-0000a7a0: 6164 6174 615f 6368 696c 642e 6765 7428  adata_child.get(
-0000a7b0: 7365 7474 696e 6729 0a20 2020 2020 2020  setting).       
-0000a7c0: 2029 0a0a 2020 2020 6465 6620 6973 5f75   )..    def is_u
-0000a7d0: 6e6c 6f63 6b65 6428 7365 6c66 2920 2d3e  nlocked(self) ->
-0000a7e0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-0000a7f0: 2222 5261 6973 6573 2077 6172 6e69 6e67  ""Raises warning
-0000a800: 2069 6620 436f 6d70 6f6e 656e 7420 6973   if Component is
-0000a810: 206c 6f63 6b65 642e 2222 220a 2020 2020   locked.""".    
-0000a820: 2020 2020 6966 2073 656c 662e 5f6c 6f63      if self._loc
-0000a830: 6b65 643a 0a20 2020 2020 2020 2020 2020  ked:.           
-0000a840: 206d 6573 7361 6765 203d 2028 0a20 2020   message = (.   
-0000a850: 2020 2020 2020 2020 2020 2020 2066 2243               f"C
-0000a860: 6f6d 706f 6e65 6e74 207b 7365 6c66 2e6e  omponent {self.n
-0000a870: 616d 6521 727d 2069 7320 6461 6e67 6572  ame!r} is danger
-0000a880: 6f75 7320 746f 206d 6f64 6966 7920 6173  ous to modify as
-0000a890: 2069 7427 7320 616c 7265 6164 7920 220a   it's already ".
-0000a8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a8b0: 226f 6e20 6361 6368 6520 616e 6420 7769  "on cache and wi
-0000a8c0: 6c6c 2063 6861 6e67 6520 616c 6c20 6f66  ll change all of
-0000a8d0: 2069 7473 2072 6566 6572 656e 6365 732e   its references.
-0000a8e0: 2022 0a20 2020 2020 2020 2020 2020 2029   ".            )
-0000a8f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000a900: 434f 4e46 2e72 6169 7365 5f65 7272 6f72  CONF.raise_error
-0000a910: 5f6f 6e5f 6d75 7461 7469 6f6e 3a0a 2020  _on_mutation:.  
-0000a920: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0000a930: 6973 6520 4d75 7461 6269 6c69 7479 4572  ise MutabilityEr
-0000a940: 726f 7228 6d65 7373 6167 6529 0a20 2020  ror(message).   
-0000a950: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000a960: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000a970: 6172 6e69 6e67 732e 7761 726e 286d 6573  arnings.warn(mes
-0000a980: 7361 6765 290a 0a20 2020 2064 6566 205f  sage)..    def _
-0000a990: 6164 6428 7365 6c66 2c20 656c 656d 656e  add(self, elemen
-0000a9a0: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
-0000a9b0: 2020 2020 2222 2241 6464 2061 206e 6577      """Add a new
-0000a9c0: 2065 6c65 6d65 6e74 206f 7220 6c69 7374   element or list
-0000a9d0: 206f 6620 656c 656d 656e 7473 2074 6f20   of elements to 
-0000a9e0: 7468 6973 2043 6f6d 706f 6e65 6e74 2e0a  this Component..
-0000a9f0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-0000aa00: 2020 2020 2020 2020 2020 2065 6c65 6d65             eleme
-0000aa10: 6e74 3a20 506f 6c79 676f 6e2c 2043 6f6d  nt: Polygon, Com
-0000aa20: 706f 6e65 6e74 5265 6665 7265 6e63 6520  ponentReference 
-0000aa30: 6f72 2069 7465 7261 626c 650a 2020 2020  or iterable.    
-0000aa40: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-0000aa50: 656c 656d 656e 7420 6f72 2069 7465 7261  element or itera
-0000aa60: 626c 6520 6f66 2065 6c65 6d65 6e74 7320  ble of elements 
-0000aa70: 746f 2062 6520 696e 7365 7274 6564 2069  to be inserted i
-0000aa80: 6e20 7468 6973 2063 656c 6c2e 0a0a 2020  n this cell...  
-0000aa90: 2020 2020 2020 5261 6973 6573 3a0a 2020        Raises:.  
-0000aaa0: 2020 2020 2020 2020 2020 4d75 7461 6269            Mutabi
-0000aab0: 6c69 7479 4572 726f 723a 2069 6620 636f  lityError: if co
-0000aac0: 6d70 6f6e 656e 7420 6973 206c 6f63 6b65  mponent is locke
-0000aad0: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-0000aae0: 2020 2020 2020 2073 656c 662e 6973 5f75         self.is_u
-0000aaf0: 6e6c 6f63 6b65 6428 290a 2020 2020 2020  nlocked().      
-0000ab00: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000ab10: 656c 656d 656e 742c 2043 6f6d 706f 6e65  element, Compone
-0000ab20: 6e74 5265 6665 7265 6e63 6529 3a0a 2020  ntReference):.  
-0000ab30: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000ab40: 6365 6c6c 2e61 6464 2865 6c65 6d65 6e74  cell.add(element
-0000ab50: 2e5f 7265 6665 7265 6e63 6529 0a20 2020  ._reference).   
-0000ab60: 2020 2020 2020 2020 2073 656c 662e 5f72           self._r
-0000ab70: 6566 6572 656e 6365 732e 6170 7065 6e64  eferences.append
-0000ab80: 2865 6c65 6d65 6e74 290a 2020 2020 2020  (element).      
-0000ab90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000aba0: 2020 2020 7365 6c66 2e5f 6365 6c6c 2e61      self._cell.a
-0000abb0: 6464 2865 6c65 6d65 6e74 290a 0a20 2020  dd(element)..   
-0000abc0: 2064 6566 2061 6464 2873 656c 662c 2065   def add(self, e
-0000abd0: 6c65 6d65 6e74 2920 2d3e 204e 6f6e 653a  lement) -> None:
-0000abe0: 0a20 2020 2020 2020 2022 2222 4164 6420  .        """Add 
-0000abf0: 6120 6e65 7720 656c 656d 656e 7420 6f72  a new element or
-0000ac00: 206c 6973 7420 6f66 2065 6c65 6d65 6e74   list of element
-0000ac10: 7320 746f 2074 6869 7320 436f 6d70 6f6e  s to this Compon
-0000ac20: 656e 742e 0a0a 2020 2020 2020 2020 4172  ent...        Ar
-0000ac30: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0000ac40: 656c 656d 656e 743a 2050 6f6c 7967 6f6e  element: Polygon
-0000ac50: 2c20 436f 6d70 6f6e 656e 7452 6566 6572  , ComponentRefer
-0000ac60: 656e 6365 206f 7220 6974 6572 6162 6c65  ence or iterable
-0000ac70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ac80: 2054 6865 2065 6c65 6d65 6e74 206f 7220   The element or 
-0000ac90: 6974 6572 6162 6c65 206f 6620 656c 656d  iterable of elem
-0000aca0: 656e 7473 2074 6f20 6265 2069 6e73 6572  ents to be inser
-0000acb0: 7465 6420 696e 2074 6869 7320 6365 6c6c  ted in this cell
-0000acc0: 2e0a 0a20 2020 2020 2020 2052 6169 7365  ...        Raise
-0000acd0: 733a 0a20 2020 2020 2020 2020 2020 204d  s:.            M
-0000ace0: 7574 6162 696c 6974 7945 7272 6f72 3a20  utabilityError: 
-0000acf0: 6966 2063 6f6d 706f 6e65 6e74 2069 7320  if component is 
-0000ad00: 6c6f 636b 6564 2e0a 2020 2020 2020 2020  locked..        
-0000ad10: 2222 220a 2020 2020 2020 2020 6966 2069  """.        if i
-0000ad20: 7369 6e73 7461 6e63 6528 656c 656d 656e  sinstance(elemen
-0000ad30: 742c 2043 6f6d 706f 6e65 6e74 5265 6665  t, ComponentRefe
-0000ad40: 7265 6e63 6529 3a0a 2020 2020 2020 2020  rence):.        
-0000ad50: 2020 2020 7365 6c66 2e5f 7265 6769 7374      self._regist
-0000ad60: 6572 5f72 6566 6572 656e 6365 2865 6c65  er_reference(ele
-0000ad70: 6d65 6e74 290a 2020 2020 2020 2020 2020  ment).          
-0000ad80: 2020 7365 6c66 2e5f 6164 6428 656c 656d    self._add(elem
-0000ad90: 656e 7429 0a20 2020 2020 2020 2065 6c69  ent).        eli
-0000ada0: 6620 6973 696e 7374 616e 6365 2865 6c65  f isinstance(ele
-0000adb0: 6d65 6e74 2c20 4974 6572 6162 6c65 293a  ment, Iterable):
-0000adc0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000add0: 2073 7562 656c 656d 656e 7420 696e 2065   subelement in e
-0000ade0: 6c65 6d65 6e74 3a0a 2020 2020 2020 2020  lement:.        
-0000adf0: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-0000ae00: 2873 7562 656c 656d 656e 7429 0a20 2020  (subelement).   
-0000ae10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000ae20: 2020 2020 2020 2073 656c 662e 5f61 6464         self._add
-0000ae30: 2865 6c65 6d65 6e74 290a 0a20 2020 2064  (element)..    d
-0000ae40: 6566 2061 6464 5f61 7272 6179 280a 2020  ef add_array(.  
-0000ae50: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0000ae60: 2020 2020 636f 6d70 6f6e 656e 743a 2043      component: C
-0000ae70: 6f6d 706f 6e65 6e74 2c0a 2020 2020 2020  omponent,.      
-0000ae80: 2020 636f 6c75 6d6e 733a 2069 6e74 203d    columns: int =
-0000ae90: 2032 2c0a 2020 2020 2020 2020 726f 7773   2,.        rows
-0000aea0: 3a20 696e 7420 3d20 322c 0a20 2020 2020  : int = 2,.     
-0000aeb0: 2020 2073 7061 6369 6e67 3a20 7475 706c     spacing: tupl
-0000aec0: 655b 666c 6f61 742c 2066 6c6f 6174 5d20  e[float, float] 
-0000aed0: 3d20 2831 3030 2c20 3130 3029 2c0a 2020  = (100, 100),.  
-0000aee0: 2020 2020 2020 616c 6961 733a 2073 7472        alias: str
-0000aef0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-0000af00: 2020 2020 2920 2d3e 2043 6f6d 706f 6e65      ) -> Compone
-0000af10: 6e74 5265 6665 7265 6e63 653a 0a20 2020  ntReference:.   
-0000af20: 2020 2020 2022 2222 4372 6561 7465 7320       """Creates 
-0000af30: 6120 436f 6d70 6f6e 656e 7452 6566 6572  a ComponentRefer
-0000af40: 656e 6365 2072 6566 6572 656e 6365 2074  ence reference t
-0000af50: 6f20 6120 436f 6d70 6f6e 656e 742e 0a0a  o a Component...
-0000af60: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-0000af70: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-0000af80: 656e 743a 2054 6865 2072 6566 6572 656e  ent: The referen
-0000af90: 6365 6420 636f 6d70 6f6e 656e 742e 0a20  ced component.. 
-0000afa0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-0000afb0: 6e73 3a20 4e75 6d62 6572 206f 6620 636f  ns: Number of co
-0000afc0: 6c75 6d6e 7320 696e 2074 6865 2061 7272  lumns in the arr
-0000afd0: 6179 2e0a 2020 2020 2020 2020 2020 2020  ay..            
-0000afe0: 726f 7773 3a20 4e75 6d62 6572 206f 6620  rows: Number of 
-0000aff0: 726f 7773 2069 6e20 7468 6520 6172 7261  rows in the arra
-0000b000: 792e 0a20 2020 2020 2020 2020 2020 2073  y..            s
-0000b010: 7061 6369 6e67 3a20 6172 7261 792d 6c69  pacing: array-li
-0000b020: 6b65 5b32 5d20 6f66 2069 6e74 206f 7220  ke[2] of int or 
-0000b030: 666c 6f61 742e 0a20 2020 2020 2020 2020  float..         
-0000b040: 2020 2020 2020 2044 6973 7461 6e63 6520         Distance 
-0000b050: 6265 7477 6565 6e20 6164 6a61 6365 6e74  between adjacent
-0000b060: 2063 6f6c 756d 6e73 2061 6e64 2061 646a   columns and adj
-0000b070: 6163 656e 7420 726f 7773 2e0a 2020 2020  acent rows..    
-0000b080: 2020 2020 2020 2020 616c 6961 733a 2073          alias: s
-0000b090: 7472 206f 7220 4e6f 6e65 2e20 416c 6961  tr or None. Alia
-0000b0a0: 7320 6f66 2074 6865 2072 6566 6572 656e  s of the referen
-0000b0b0: 6365 6420 436f 6d70 6f6e 656e 742e 0a0a  ced Component...
-0000b0c0: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-0000b0d0: 2020 2020 2020 2020 2020 2020 613a 2043              a: C
-0000b0e0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-0000b0f0: 6520 636f 6e74 6169 6e69 6e67 2072 6566  e containing ref
-0000b100: 6572 656e 6365 7320 746f 2074 6865 2043  erences to the C
-0000b110: 6f6d 706f 6e65 6e74 2e0a 2020 2020 2020  omponent..      
-0000b120: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-0000b130: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-0000b140: 636f 6d70 6f6e 656e 742c 2043 6f6d 706f  component, Compo
-0000b150: 6e65 6e74 293a 0a20 2020 2020 2020 2020  nent):.         
-0000b160: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-0000b170: 6f72 2822 6164 645f 6172 7261 7928 2920  or("add_array() 
-0000b180: 6e65 6564 7320 6120 436f 6d70 6f6e 656e  needs a Componen
-0000b190: 7420 6f62 6a65 6374 2e22 290a 2020 2020  t object.").    
-0000b1a0: 2020 2020 7265 6620 3d20 436f 6d70 6f6e      ref = Compon
-0000b1b0: 656e 7452 6566 6572 656e 6365 280a 2020  entReference(.  
-0000b1c0: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-0000b1d0: 656e 743d 636f 6d70 6f6e 656e 742c 0a20  ent=component,. 
-0000b1e0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-0000b1f0: 6e73 3d69 6e74 2872 6f75 6e64 2863 6f6c  ns=int(round(col
-0000b200: 756d 6e73 2929 2c0a 2020 2020 2020 2020  umns)),.        
-0000b210: 2020 2020 726f 7773 3d69 6e74 2872 6f75      rows=int(rou
-0000b220: 6e64 2872 6f77 7329 292c 0a20 2020 2020  nd(rows)),.     
-0000b230: 2020 2020 2020 2073 7061 6369 6e67 3d73         spacing=s
-0000b240: 7061 6369 6e67 2c0a 2020 2020 2020 2020  pacing,.        
-0000b250: 290a 2020 2020 2020 2020 7265 662e 6e61  ).        ref.na
-0000b260: 6d65 203d 204e 6f6e 650a 2020 2020 2020  me = None.      
-0000b270: 2020 7365 6c66 2e5f 6164 6428 7265 6629    self._add(ref)
-0000b280: 0a20 2020 2020 2020 2073 656c 662e 5f72  .        self._r
-0000b290: 6567 6973 7465 725f 7265 6665 7265 6e63  egister_referenc
-0000b2a0: 6528 7265 6665 7265 6e63 653d 7265 662c  e(reference=ref,
-0000b2b0: 2061 6c69 6173 3d61 6c69 6173 290a 2020   alias=alias).  
-0000b2c0: 2020 2020 2020 7265 7475 726e 2072 6566        return ref
-0000b2d0: 0a0a 2020 2020 6465 6620 6469 7374 7269  ..    def distri
-0000b2e0: 6275 7465 280a 2020 2020 2020 2020 7365  bute(.        se
-0000b2f0: 6c66 2c0a 2020 2020 2020 2020 656c 656d  lf,.        elem
-0000b300: 656e 7473 3a20 7374 7220 3d20 2261 6c6c  ents: str = "all
-0000b310: 222c 0a20 2020 2020 2020 2064 6972 6563  ",.        direc
-0000b320: 7469 6f6e 3a20 7374 7220 3d20 2278 222c  tion: str = "x",
-0000b330: 0a20 2020 2020 2020 2073 7061 6369 6e67  .        spacing
-0000b340: 3a20 666c 6f61 7420 3d20 3130 302e 302c  : float = 100.0,
-0000b350: 0a20 2020 2020 2020 2073 6570 6172 6174  .        separat
-0000b360: 696f 6e3a 2062 6f6f 6c20 3d20 5472 7565  ion: bool = True
-0000b370: 2c0a 2020 2020 2020 2020 6564 6765 3a20  ,.        edge: 
-0000b380: 7374 7220 3d20 2263 656e 7465 7222 2c0a  str = "center",.
-0000b390: 2020 2020 2920 2d3e 2043 6f6d 706f 6e65      ) -> Compone
-0000b3a0: 6e74 3a0a 2020 2020 2020 2020 2222 2244  nt:.        """D
-0000b3b0: 6973 7472 6962 7574 6573 2074 6865 2073  istributes the s
-0000b3c0: 7065 6369 6669 6564 2065 6c65 6d65 6e74  pecified element
-0000b3d0: 7320 696e 2074 6865 2043 6f6d 706f 6e65  s in the Compone
-0000b3e0: 6e74 2e0a 0a20 2020 2020 2020 2041 7267  nt...        Arg
-0000b3f0: 733a 0a20 2020 2020 2020 2020 2020 2065  s:.            e
-0000b400: 6c65 6d65 6e74 733a 2061 7272 6179 2d6c  lements: array-l
-0000b410: 696b 6520 6f66 206f 626a 6563 7473 206f  ike of objects o
-0000b420: 7220 2761 6c6c 272e 2045 6c65 6d65 6e74  r 'all'. Element
-0000b430: 7320 746f 2064 6973 7472 6962 7574 652e  s to distribute.
-0000b440: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
-0000b450: 6563 7469 6f6e 3a20 7b27 7827 2c20 2779  ection: {'x', 'y
-0000b460: 277d 2044 6972 6563 7469 6f6e 206f 6620  '} Direction of 
-0000b470: 6469 7374 7269 6275 7469 6f6e 3b20 6569  distribution; ei
-0000b480: 7468 6572 2061 206c 696e 6520 696e 2074  ther a line in t
-0000b490: 6865 2078 2d64 6972 6563 7469 6f6e 206f  he x-direction o
-0000b4a0: 7220 792d 6469 7265 6374 696f 6e2e 0a20  r y-direction.. 
-0000b4b0: 2020 2020 2020 2020 2020 2073 7061 6369             spaci
-0000b4c0: 6e67 2020 696e 7420 6f72 2066 6c6f 6174  ng  int or float
-0000b4d0: 2e20 4469 7374 616e 6365 2062 6574 7765  . Distance betwe
-0000b4e0: 656e 2065 6c65 6d65 6e74 732e 0a20 2020  en elements..   
-0000b4f0: 2020 2020 2020 2020 2073 6570 6172 6174           separat
-0000b500: 696f 6e3a 2062 6f6f 6c2e 2049 6620 5472  ion: bool. If Tr
-0000b510: 7565 2c20 6775 6172 616e 7465 6573 2065  ue, guarantees e
-0000b520: 6c65 6d65 6e74 7320 6172 6520 7365 7061  lements are sepa
-0000b530: 7261 7465 6420 7769 7468 2061 2066 6978  rated with a fix
-0000b540: 6564 2073 7061 6369 6e67 0a20 2020 2020  ed spacing.     
-0000b550: 2020 2020 2020 2020 2020 2062 6574 7765             betwe
-0000b560: 656e 3b20 6966 2020 4661 6c73 652c 2065  en; if  False, e
-0000b570: 6c65 6d65 6e74 7320 6172 6520 7370 6163  lements are spac
-0000b580: 6564 2065 7665 6e6c 7920 616c 6f6e 6720  ed evenly along 
-0000b590: 6120 6772 6964 2e0a 2020 2020 2020 2020  a grid..        
-0000b5a0: 2020 2020 6564 6765 3a20 7b27 7827 2c20      edge: {'x', 
-0000b5b0: 2778 6d69 6e27 2c20 2778 6d61 7827 2c20  'xmin', 'xmax', 
-0000b5c0: 2779 272c 2027 796d 696e 272c 2027 796d  'y', 'ymin', 'ym
-0000b5d0: 6178 277d 0a20 2020 2020 2020 2020 2020  ax'}.           
-0000b5e0: 2020 2020 2057 6869 6368 2065 6467 6520       Which edge 
-0000b5f0: 746f 2070 6572 666f 726d 2074 6865 2064  to perform the d
-0000b600: 6973 7472 6962 7574 696f 6e20 616c 6f6e  istribution alon
-0000b610: 6720 2875 6e75 7365 6420 6966 2073 6570  g (unused if sep
-0000b620: 6172 6174 696f 6e20 3d3d 2054 7275 6529  aration == True)
-0000b630: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000b640: 2020 2020 2020 6966 2065 6c65 6d65 6e74        if element
-0000b650: 7320 3d3d 2022 616c 6c22 3a0a 2020 2020  s == "all":.    
-0000b660: 2020 2020 2020 2020 656c 656d 656e 7473          elements
-0000b670: 203d 2073 656c 662e 706f 6c79 676f 6e73   = self.polygons
-0000b680: 202b 2073 656c 662e 7265 6665 7265 6e63   + self.referenc
-0000b690: 6573 0a20 2020 2020 2020 205f 6469 7374  es.        _dist
-0000b6a0: 7269 6275 7465 280a 2020 2020 2020 2020  ribute(.        
-0000b6b0: 2020 2020 656c 656d 656e 7473 3d65 6c65      elements=ele
-0000b6c0: 6d65 6e74 732c 0a20 2020 2020 2020 2020  ments,.         
-0000b6d0: 2020 2064 6972 6563 7469 6f6e 3d64 6972     direction=dir
-0000b6e0: 6563 7469 6f6e 2c0a 2020 2020 2020 2020  ection,.        
-0000b6f0: 2020 2020 7370 6163 696e 673d 7370 6163      spacing=spac
-0000b700: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
-0000b710: 2073 6570 6172 6174 696f 6e3d 7365 7061   separation=sepa
-0000b720: 7261 7469 6f6e 2c0a 2020 2020 2020 2020  ration,.        
-0000b730: 2020 2020 6564 6765 3d65 6467 652c 0a20      edge=edge,. 
-0000b740: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000b750: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
-0000b760: 2020 6465 6620 616c 6967 6e28 7365 6c66    def align(self
-0000b770: 2c20 656c 656d 656e 7473 3d22 616c 6c22  , elements="all"
-0000b780: 2c20 616c 6967 6e6d 656e 743a 2073 7472  , alignment: str
-0000b790: 203d 2022 796d 6178 2229 202d 3e20 436f   = "ymax") -> Co
-0000b7a0: 6d70 6f6e 656e 743a 0a20 2020 2020 2020  mponent:.       
-0000b7b0: 2022 2222 416c 6967 6e20 656c 656d 656e   """Align elemen
-0000b7c0: 7473 2069 6e20 7468 6520 436f 6d70 6f6e  ts in the Compon
-0000b7d0: 656e 742e 0a0a 2020 2020 2020 2020 4172  ent...        Ar
-0000b7e0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0000b7f0: 656c 656d 656e 7473 203a 2061 7272 6179  elements : array
-0000b800: 2d6c 696b 6520 6f66 206f 626a 6563 7473  -like of objects
-0000b810: 2c20 6f72 2027 616c 6c27 0a20 2020 2020  , or 'all'.     
-0000b820: 2020 2020 2020 2020 2020 2045 6c65 6d65             Eleme
-0000b830: 6e74 7320 696e 2074 6865 2043 6f6d 706f  nts in the Compo
-0000b840: 6e65 6e74 2074 6f20 616c 6967 6e2e 0a20  nent to align.. 
-0000b850: 2020 2020 2020 2020 2020 2061 6c69 676e             align
-0000b860: 6d65 6e74 203a 207b 2778 272c 2027 7927  ment : {'x', 'y'
-0000b870: 2c20 2778 6d69 6e27 2c20 2778 6d61 7827  , 'xmin', 'xmax'
-0000b880: 2c20 2779 6d69 6e27 2c20 2779 6d61 7827  , 'ymin', 'ymax'
-0000b890: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0000b8a0: 2020 5768 6963 6820 6564 6765 2074 6f20    Which edge to 
-0000b8b0: 616c 6967 6e20 616c 6f6e 6720 2865 2e67  align along (e.g
-0000b8c0: 2e20 2779 6d61 7827 2077 696c 6c20 6d6f  . 'ymax' will mo
-0000b8d0: 7665 2074 6865 2065 6c65 6d65 6e74 7320  ve the elements 
-0000b8e0: 7375 6368 0a20 2020 2020 2020 2020 2020  such.           
-0000b8f0: 2020 2020 2074 6861 7420 616c 6c20 6f66       that all of
-0000b900: 2074 6865 6972 2074 6f70 6d6f 7374 2070   their topmost p
-0000b910: 6f69 6e74 7320 6172 6520 616c 6967 6e65  oints are aligne
-0000b920: 6429 2e0a 2020 2020 2020 2020 2222 220a  d)..        """.
-0000b930: 2020 2020 2020 2020 6966 2065 6c65 6d65          if eleme
-0000b940: 6e74 7320 3d3d 2022 616c 6c22 3a0a 2020  nts == "all":.  
-0000b950: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-0000b960: 7473 203d 2073 656c 662e 706f 6c79 676f  ts = self.polygo
-0000b970: 6e73 202b 2073 656c 662e 7265 6665 7265  ns + self.refere
-0000b980: 6e63 6573 0a20 2020 2020 2020 205f 616c  nces.        _al
-0000b990: 6967 6e28 656c 656d 656e 7473 2c20 616c  ign(elements, al
-0000b9a0: 6967 6e6d 656e 743d 616c 6967 6e6d 656e  ignment=alignmen
-0000b9b0: 7429 0a20 2020 2020 2020 2072 6574 7572  t).        retur
-0000b9c0: 6e20 7365 6c66 0a0a 2020 2020 6465 6620  n self..    def 
-0000b9d0: 666c 6174 7465 6e28 7365 6c66 2c20 7369  flatten(self, si
-0000b9e0: 6e67 6c65 5f6c 6179 6572 3a20 4c61 7965  ngle_layer: Laye
-0000b9f0: 7253 7065 6320 7c20 4e6f 6e65 203d 204e  rSpec | None = N
-0000ba00: 6f6e 6529 202d 3e20 436f 6d70 6f6e 656e  one) -> Componen
-0000ba10: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
-0000ba20: 7475 726e 7320 6120 666c 6174 7465 6e65  turns a flattene
-0000ba30: 6420 636f 7079 206f 6620 7468 6520 636f  d copy of the co
-0000ba40: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
-0000ba50: 2020 466c 6174 7465 6e73 2074 6865 2068    Flattens the h
-0000ba60: 6965 7261 7263 6879 206f 6620 7468 6520  ierarchy of the 
-0000ba70: 436f 6d70 6f6e 656e 7420 7375 6368 2074  Component such t
-0000ba80: 6861 7420 7468 6572 6520 6172 6520 6e6f  hat there are no
-0000ba90: 206c 6f6e 6765 720a 2020 2020 2020 2020   longer.        
-0000baa0: 616e 7920 7265 6665 7265 6e63 6573 2074  any references t
-0000bab0: 6f20 6f74 6865 7220 436f 6d70 6f6e 656e  o other Componen
-0000bac0: 7473 2e20 416c 6c20 706f 6c79 676f 6e73  ts. All polygons
-0000bad0: 2061 6e64 206c 6162 656c 7320 6672 6f6d   and labels from
-0000bae0: 0a20 2020 2020 2020 2075 6e64 6572 6c79  .        underly
-0000baf0: 696e 6720 7265 6665 7265 6e63 6573 2061  ing references a
-0000bb00: 7265 2063 6f70 6965 6420 616e 6420 706c  re copied and pl
-0000bb10: 6163 6564 2069 6e20 7468 6520 746f 702d  aced in the top-
-0000bb20: 6c65 7665 6c20 436f 6d70 6f6e 656e 742e  level Component.
-0000bb30: 0a20 2020 2020 2020 2049 6620 7369 6e67  .        If sing
-0000bb40: 6c65 5f6c 6179 6572 2069 7320 7370 6563  le_layer is spec
-0000bb50: 6966 6965 642c 2061 6c6c 2070 6f6c 7967  ified, all polyg
-0000bb60: 6f6e 7320 6172 6520 6d6f 7665 6420 746f  ons are moved to
-0000bb70: 2074 6861 7420 6c61 7965 722e 0a0a 2020   that layer...  
-0000bb80: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-0000bb90: 2020 2020 2020 2020 7369 6e67 6c65 5f6c          single_l
-0000bba0: 6179 6572 3a20 6d6f 7665 2061 6c6c 2070  ayer: move all p
-0000bbb0: 6f6c 7967 6f6e 7320 6172 6520 6d6f 7665  olygons are move
-0000bbc0: 6420 746f 2074 6865 2073 7065 6369 6669  d to the specifi
-0000bbd0: 6564 2028 6f70 7469 6f6e 616c 292e 0a20  ed (optional).. 
-0000bbe0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000bbf0: 2020 2063 6f6d 706f 6e65 6e74 5f66 6c61     component_fla
-0000bc00: 7420 3d20 436f 6d70 6f6e 656e 7428 290a  t = Component().
-0000bc10: 0a20 2020 2020 2020 205f 6365 6c6c 203d  .        _cell =
-0000bc20: 2073 656c 662e 5f63 656c 6c2e 636f 7079   self._cell.copy
-0000bc30: 286e 616d 653d 636f 6d70 6f6e 656e 745f  (name=component_
-0000bc40: 666c 6174 2e6e 616d 6529 0a20 2020 2020  flat.name).     
-0000bc50: 2020 205f 6365 6c6c 203d 205f 6365 6c6c     _cell = _cell
-0000bc60: 2e66 6c61 7474 656e 2829 0a20 2020 2020  .flatten().     
-0000bc70: 2020 2063 6f6d 706f 6e65 6e74 5f66 6c61     component_fla
-0000bc80: 742e 5f63 656c 6c20 3d20 5f63 656c 6c0a  t._cell = _cell.
-0000bc90: 2020 2020 2020 2020 6966 2073 696e 676c          if singl
-0000bca0: 655f 6c61 7965 7220 6973 206e 6f74 204e  e_layer is not N
-0000bcb0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000bcc0: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
-0000bcd0: 2069 6d70 6f72 7420 6765 745f 6c61 7965   import get_laye
-0000bce0: 720a 0a20 2020 2020 2020 2020 2020 206c  r..            l
-0000bcf0: 6179 6572 2c20 6461 7461 7479 7065 203d  ayer, datatype =
-0000bd00: 2067 6574 5f6c 6179 6572 2873 696e 676c   get_layer(singl
-0000bd10: 655f 6c61 7965 7229 0a20 2020 2020 2020  e_layer).       
-0000bd20: 2020 2020 2066 6f72 2070 6f6c 7967 6f6e       for polygon
-0000bd30: 2069 6e20 5f63 656c 6c2e 706f 6c79 676f   in _cell.polygo
-0000bd40: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0000bd50: 2020 2020 706f 6c79 676f 6e2e 6c61 7965      polygon.laye
-0000bd60: 7220 3d20 6c61 7965 720a 2020 2020 2020  r = layer.      
-0000bd70: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
-0000bd80: 6e2e 6461 7461 7479 7065 203d 2064 6174  n.datatype = dat
-0000bd90: 6174 7970 650a 2020 2020 2020 2020 2020  atype.          
-0000bda0: 2020 666f 7220 7061 7468 2069 6e20 5f63    for path in _c
-0000bdb0: 656c 6c2e 7061 7468 733a 0a20 2020 2020  ell.paths:.     
-0000bdc0: 2020 2020 2020 2020 2020 2070 6174 682e             path.
-0000bdd0: 7365 745f 6c61 7965 7273 286c 6179 6572  set_layers(layer
-0000bde0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000bdf0: 2020 7061 7468 2e73 6574 5f64 6174 6174    path.set_datat
-0000be00: 7970 6573 2864 6174 6174 7970 6529 0a0a  ypes(datatype)..
-0000be10: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-0000be20: 745f 666c 6174 2e63 6f70 795f 6368 696c  t_flat.copy_chil
-0000be30: 645f 696e 666f 2873 656c 6629 0a20 2020  d_info(self).   
-0000be40: 2020 2020 2063 6f6d 706f 6e65 6e74 5f66       component_f
-0000be50: 6c61 742e 6164 645f 706f 7274 7328 7365  lat.add_ports(se
-0000be60: 6c66 2e70 6f72 7473 290a 2020 2020 2020  lf.ports).      
-0000be70: 2020 636f 6d70 6f6e 656e 745f 666c 6174    component_flat
-0000be80: 2e63 6869 6c64 203d 2073 656c 662e 6368  .child = self.ch
-0000be90: 696c 640a 2020 2020 2020 2020 7265 7475  ild.        retu
-0000bea0: 726e 2063 6f6d 706f 6e65 6e74 5f66 6c61  rn component_fla
-0000beb0: 740a 0a20 2020 2064 6566 2066 6c61 7474  t..    def flatt
-0000bec0: 656e 5f72 6566 6572 656e 6365 2873 656c  en_reference(sel
-0000bed0: 662c 2072 6566 3a20 436f 6d70 6f6e 656e  f, ref: Componen
-0000bee0: 7452 6566 6572 656e 6365 2920 2d3e 204e  tReference) -> N
-0000bef0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-0000bf00: 4672 6f6d 2065 7869 7374 696e 6720 6365  From existing ce
-0000bf10: 6c6c 2072 6570 6c61 6365 7320 7265 6665  ll replaces refe
-0000bf20: 7265 6e63 6520 7769 7468 2061 2066 6c61  rence with a fla
-0000bf30: 7474 656e 2072 6566 6572 656e 6365 205c  tten reference \
-0000bf40: 0a20 2020 2020 2020 2077 6869 6368 2068  .        which h
-0000bf50: 6173 2074 6865 2074 7261 6e73 666f 726d  as the transform
-0000bf60: 6174 696f 6e73 2061 6c72 6561 6479 2061  ations already a
-0000bf70: 7070 6c69 6564 2e0a 0a20 2020 2020 2020  pplied...       
-0000bf80: 2054 7261 6e73 666f 726d 6564 2072 6566   Transformed ref
-0000bf90: 6572 656e 6365 206b 6565 7073 2074 6865  erence keeps the
-0000bfa0: 206f 7269 6769 6e61 6c20 6e61 6d65 2e0a   original name..
-0000bfb0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-0000bfc0: 2020 2020 2020 2020 2020 2072 6566 3a20             ref: 
-0000bfd0: 7468 6520 7265 6665 7265 6e63 6520 746f  the reference to
-0000bfe0: 2066 6c61 7474 656e 2069 6e74 6f20 6120   flatten into a 
-0000bff0: 6e65 7720 6365 6c6c 2e0a 0a20 2020 2020  new cell...     
-0000c000: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-0000c010: 726f 6d20 6764 7366 6163 746f 7279 2e66  rom gdsfactory.f
-0000c020: 756e 6374 696f 6e73 2069 6d70 6f72 7420  unctions import 
-0000c030: 7472 616e 7366 6f72 6d65 640a 0a20 2020  transformed..   
-0000c040: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
-0000c050: 2872 6566 290a 2020 2020 2020 2020 6e65  (ref).        ne
-0000c060: 775f 636f 6d70 6f6e 656e 7420 3d20 7472  w_component = tr
-0000c070: 616e 7366 6f72 6d65 6428 7265 662c 2064  ansformed(ref, d
-0000c080: 6563 6f72 6174 6f72 3d4e 6f6e 6529 0a20  ecorator=None). 
-0000c090: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0000c0a0: 7265 6628 6e65 775f 636f 6d70 6f6e 656e  ref(new_componen
-0000c0b0: 742c 2061 6c69 6173 3d72 6566 2e6e 616d  t, alias=ref.nam
-0000c0c0: 6529 0a0a 2020 2020 6465 6620 666c 6174  e)..    def flat
-0000c0d0: 7465 6e5f 696e 7661 6c69 645f 7265 6673  ten_invalid_refs
-0000c0e0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-0000c0f0: 2020 2020 2020 2020 6772 6964 5f73 697a          grid_siz
-0000c100: 653a 2066 6c6f 6174 207c 204e 6f6e 6520  e: float | None 
-0000c110: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0000c120: 7570 6461 7465 645f 636f 6d70 6f6e 656e  updated_componen
-0000c130: 7473 3d4e 6f6e 652c 0a20 2020 2020 2020  ts=None,.       
-0000c140: 2074 7261 7665 7273 6564 5f63 6f6d 706f   traversed_compo
-0000c150: 6e65 6e74 733d 4e6f 6e65 2c0a 2020 2020  nents=None,.    
-0000c160: 2920 2d3e 2043 6f6d 706f 6e65 6e74 3a0a  ) -> Component:.
-0000c170: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-0000c180: 6e73 206e 6577 2063 6f6d 706f 6e65 6e74  ns new component
-0000c190: 2077 6974 6820 666c 6174 7465 6e65 6420   with flattened 
-0000c1a0: 7265 6665 7265 6e63 6573 2e0a 0a20 2020  references...   
-0000c1b0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-0000c1c0: 2020 2020 2020 2067 7269 645f 7369 7a65         grid_size
-0000c1d0: 3a20 736e 6170 2074 6f20 6772 6964 2073  : snap to grid s
-0000c1e0: 697a 652e 0a20 2020 2020 2020 2020 2020  ize..           
-0000c1f0: 2075 7064 6174 6564 5f63 6f6d 706f 6e65   updated_compone
-0000c200: 6e74 733a 2073 6574 206f 6620 7570 6461  nts: set of upda
-0000c210: 7465 6420 636f 6d70 6f6e 656e 7473 2e0a  ted components..
-0000c220: 2020 2020 2020 2020 2020 2020 7472 6176              trav
-0000c230: 6572 7365 645f 636f 6d70 6f6e 656e 7473  ersed_components
-0000c240: 3a20 7365 7420 6f66 2074 7261 7665 7273  : set of travers
-0000c250: 6564 2063 6f6d 706f 6e65 6e74 732e 0a20  ed components.. 
-0000c260: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000c270: 2020 2072 6574 7572 6e20 666c 6174 7465     return flatte
-0000c280: 6e5f 696e 7661 6c69 645f 7265 6673 5f72  n_invalid_refs_r
-0000c290: 6563 7572 7369 7665 280a 2020 2020 2020  ecursive(.      
-0000c2a0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0000c2b0: 2020 2020 2020 2020 6772 6964 5f73 697a          grid_siz
-0000c2c0: 653d 6772 6964 5f73 697a 652c 0a20 2020  e=grid_size,.   
-0000c2d0: 2020 2020 2020 2020 2075 7064 6174 6564           updated
-0000c2e0: 5f63 6f6d 706f 6e65 6e74 733d 7570 6461  _components=upda
-0000c2f0: 7465 645f 636f 6d70 6f6e 656e 7473 2c0a  ted_components,.
-0000c300: 2020 2020 2020 2020 2020 2020 7472 6176              trav
-0000c310: 6572 7365 645f 636f 6d70 6f6e 656e 7473  ersed_components
-0000c320: 3d74 7261 7665 7273 6564 5f63 6f6d 706f  =traversed_compo
-0000c330: 6e65 6e74 732c 0a20 2020 2020 2020 2029  nents,.        )
-0000c340: 0a0a 2020 2020 6465 6620 6164 645f 7265  ..    def add_re
-0000c350: 6628 0a20 2020 2020 2020 2073 656c 662c  f(.        self,
-0000c360: 2063 6f6d 706f 6e65 6e74 3a20 436f 6d70   component: Comp
-0000c370: 6f6e 656e 742c 2061 6c69 6173 3a20 7374  onent, alias: st
-0000c380: 7220 7c20 4e6f 6e65 203d 204e 6f6e 652c  r | None = None,
-0000c390: 202a 2a6b 7761 7267 730a 2020 2020 2920   **kwargs.    ) 
-0000c3a0: 2d3e 2043 6f6d 706f 6e65 6e74 5265 6665  -> ComponentRefe
-0000c3b0: 7265 6e63 653a 0a20 2020 2020 2020 2022  rence:.        "
-0000c3c0: 2222 4164 6420 436f 6d70 6f6e 656e 7452  ""Add ComponentR
-0000c3d0: 6566 6572 656e 6365 2074 6f20 7468 6520  eference to the 
-0000c3e0: 6375 7272 656e 7420 436f 6d70 6f6e 656e  current Componen
-0000c3f0: 742e 0a0a 2020 2020 2020 2020 4172 6773  t...        Args
-0000c400: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0000c410: 6d70 6f6e 656e 743a 2043 6f6d 706f 6e65  mponent: Compone
-0000c420: 6e74 2e0a 2020 2020 2020 2020 2020 2020  nt..            
-0000c430: 616c 6961 733a 206e 616d 6564 5f72 6566  alias: named_ref
-0000c440: 6572 656e 6365 732e 0a0a 2020 2020 2020  erences...      
-0000c450: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
-0000c460: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-0000c470: 6d6e 733a 204e 756d 6265 7220 6f66 2063  mns: Number of c
-0000c480: 6f6c 756d 6e73 2069 6e20 7468 6520 6172  olumns in the ar
-0000c490: 7261 792e 0a20 2020 2020 2020 2020 2020  ray..           
-0000c4a0: 2072 6f77 733a 204e 756d 6265 7220 6f66   rows: Number of
-0000c4b0: 2072 6f77 7320 696e 2074 6865 2061 7272   rows in the arr
-0000c4c0: 6179 2e0a 2020 2020 2020 2020 2020 2020  ay..            
-0000c4d0: 7370 6163 696e 673a 2044 6973 7461 6e63  spacing: Distanc
-0000c4e0: 6573 2062 6574 7765 656e 2061 646a 6163  es between adjac
-0000c4f0: 656e 7420 636f 6c75 6d6e 7320 616e 6420  ent columns and 
-0000c500: 6164 6a61 6365 6e74 2072 6f77 732e 0a20  adjacent rows.. 
-0000c510: 2020 2020 2020 2020 2020 206f 7269 6769             origi
-0000c520: 6e3a 2061 7272 6179 2d6c 696b 655b 325d  n: array-like[2]
-0000c530: 206f 6620 696e 7420 6f72 2066 6c6f 6174   of int or float
-0000c540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c550: 2050 6f73 6974 696f 6e20 7768 6572 6520   Position where 
-0000c560: 7468 6520 6365 6c6c 2069 7320 696e 7365  the cell is inse
-0000c570: 7274 6564 2e0a 2020 2020 2020 2020 2020  rted..          
-0000c580: 2020 726f 7461 7469 6f6e 203a 2069 6e74    rotation : int
-0000c590: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
-0000c5a0: 2020 2020 2020 2020 2020 416e 676c 6520            Angle 
-0000c5b0: 6f66 2072 6f74 6174 696f 6e20 6f66 2074  of rotation of t
-0000c5c0: 6865 2072 6566 6572 656e 6365 2028 696e  he reference (in
-0000c5d0: 2060 6465 6772 6565 7360 292e 0a20 2020   `degrees`)..   
-0000c5e0: 2020 2020 2020 2020 206d 6167 6e69 6669           magnifi
-0000c5f0: 6361 7469 6f6e 203a 2069 6e74 206f 7220  cation : int or 
-0000c600: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-0000c610: 2020 2020 2020 4d61 676e 6966 6963 6174        Magnificat
-0000c620: 696f 6e20 6661 6374 6f72 2066 6f72 2074  ion factor for t
-0000c630: 6865 2072 6566 6572 656e 6365 2e0a 2020  he reference..  
-0000c640: 2020 2020 2020 2020 2020 785f 7265 666c            x_refl
-0000c650: 6563 7469 6f6e 203a 2062 6f6f 6c0a 2020  ection : bool.  
-0000c660: 2020 2020 2020 2020 2020 2020 2020 4966                If
-0000c670: 2054 7275 652c 2074 6865 2072 6566 6572   True, the refer
-0000c680: 656e 6365 2069 7320 7265 666c 6563 7465  ence is reflecte
-0000c690: 6420 7061 7261 6c6c 656c 2074 6f20 7468  d parallel to th
-0000c6a0: 6520 7820 6469 7265 6374 696f 6e0a 2020  e x direction.  
-0000c6b0: 2020 2020 2020 2020 2020 2020 2020 6265                be
-0000c6c0: 666f 7265 2062 6569 6e67 2072 6f74 6174  fore being rotat
-0000c6d0: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-0000c6e0: 6e61 6d65 203a 2073 7472 2028 6f70 7469  name : str (opti
-0000c6f0: 6f6e 616c 290a 2020 2020 2020 2020 2020  onal).          
-0000c700: 2020 2020 2020 4120 6e61 6d65 2066 6f72        A name for
-0000c710: 2074 6865 2072 6566 6572 656e 6365 2028   the reference (
-0000c720: 6966 2070 726f 7669 6465 6429 2e0a 0a20  if provided)... 
-0000c730: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000c740: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-0000c750: 616e 6365 2863 6f6d 706f 6e65 6e74 2c20  ance(component, 
-0000c760: 436f 6d70 6f6e 656e 7429 3a0a 2020 2020  Component):.    
-0000c770: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-0000c780: 7065 4572 726f 7228 6622 7479 7065 203d  peError(f"type =
-0000c790: 207b 7479 7065 2843 6f6d 706f 6e65 6e74   {type(Component
-0000c7a0: 297d 206e 6565 6473 2074 6f20 6265 2061  )} needs to be a
-0000c7b0: 2043 6f6d 706f 6e65 6e74 2e22 290a 2020   Component.").  
-0000c7c0: 2020 2020 2020 7265 6620 3d20 436f 6d70        ref = Comp
-0000c7d0: 6f6e 656e 7452 6566 6572 656e 6365 2863  onentReference(c
-0000c7e0: 6f6d 706f 6e65 6e74 2c20 2a2a 6b77 6172  omponent, **kwar
-0000c7f0: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
-0000c800: 2e5f 6164 6428 7265 6629 0a20 2020 2020  ._add(ref).     
-0000c810: 2020 2073 656c 662e 5f72 6567 6973 7465     self._registe
-0000c820: 725f 7265 6665 7265 6e63 6528 7265 6665  r_reference(refe
-0000c830: 7265 6e63 653d 7265 662c 2061 6c69 6173  rence=ref, alias
-0000c840: 3d61 6c69 6173 290a 2020 2020 2020 2020  =alias).        
-0000c850: 7265 7475 726e 2072 6566 0a0a 2020 2020  return ref..    
-0000c860: 6465 6620 5f72 6567 6973 7465 725f 7265  def _register_re
-0000c870: 6665 7265 6e63 6528 0a20 2020 2020 2020  ference(.       
-0000c880: 2073 656c 662c 2072 6566 6572 656e 6365   self, reference
-0000c890: 3a20 436f 6d70 6f6e 656e 7452 6566 6572  : ComponentRefer
-0000c8a0: 656e 6365 2c20 616c 6961 733a 2073 7472  ence, alias: str
-0000c8b0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 0a20   | None = None. 
-0000c8c0: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-0000c8d0: 2020 2020 2020 636f 6d70 6f6e 656e 7420        component 
-0000c8e0: 3d20 7265 6665 7265 6e63 652e 7061 7265  = reference.pare
-0000c8f0: 6e74 0a20 2020 2020 2020 2072 6566 6572  nt.        refer
-0000c900: 656e 6365 2e6f 776e 6572 203d 2073 656c  ence.owner = sel
-0000c910: 660a 0a20 2020 2020 2020 2069 6620 616c  f..        if al
-0000c920: 6961 7320 6973 204e 6f6e 653a 0a20 2020  ias is None:.   
-0000c930: 2020 2020 2020 2020 2069 6620 7265 6665           if refe
-0000c940: 7265 6e63 652e 6e61 6d65 2069 7320 6e6f  rence.name is no
-0000c950: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000c960: 2020 2020 2020 2020 616c 6961 7320 3d20          alias = 
-0000c970: 7265 6665 7265 6e63 652e 6e61 6d65 0a20  reference.name. 
-0000c980: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000c990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c9a0: 2070 7265 6669 7820 3d20 280a 2020 2020   prefix = (.    
-0000c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9c0: 636f 6d70 6f6e 656e 742e 7365 7474 696e  component.settin
-0000c9d0: 6773 2e66 756e 6374 696f 6e5f 6e61 6d65  gs.function_name
-0000c9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c9f0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
-0000ca00: 636f 6d70 6f6e 656e 742c 2022 7365 7474  component, "sett
-0000ca10: 696e 6773 2229 0a20 2020 2020 2020 2020  ings").         
-0000ca20: 2020 2020 2020 2020 2020 2061 6e64 2068             and h
-0000ca30: 6173 6174 7472 2863 6f6d 706f 6e65 6e74  asattr(component
-0000ca40: 2e73 6574 7469 6e67 732c 2022 6675 6e63  .settings, "func
-0000ca50: 7469 6f6e 5f6e 616d 6522 290a 2020 2020  tion_name").    
-0000ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca70: 656c 7365 2063 6f6d 706f 6e65 6e74 2e6e  else component.n
-0000ca80: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-0000ca90: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000caa0: 2020 2020 2020 7365 6c66 2e5f 7265 6665        self._refe
-0000cab0: 7265 6e63 655f 6e61 6d65 735f 636f 756e  rence_names_coun
-0000cac0: 7465 722e 7570 6461 7465 287b 7072 6566  ter.update({pref
-0000cad0: 6978 3a20 317d 290a 2020 2020 2020 2020  ix: 1}).        
-0000cae0: 2020 2020 2020 2020 616c 6961 7320 3d20          alias = 
-0000caf0: 6622 7b70 7265 6669 787d 5f7b 7365 6c66  f"{prefix}_{self
-0000cb00: 2e5f 7265 6665 7265 6e63 655f 6e61 6d65  ._reference_name
-0000cb10: 735f 636f 756e 7465 725b 7072 6566 6978  s_counter[prefix
-0000cb20: 5d7d 220a 0a20 2020 2020 2020 2020 2020  ]}"..           
-0000cb30: 2020 2020 2077 6869 6c65 2061 6c69 6173       while alias
-0000cb40: 2069 6e20 7365 6c66 2e5f 6e61 6d65 645f   in self._named_
-0000cb50: 7265 6665 7265 6e63 6573 3a0a 2020 2020  references:.    
-0000cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb70: 7365 6c66 2e5f 7265 6665 7265 6e63 655f  self._reference_
-0000cb80: 6e61 6d65 735f 636f 756e 7465 722e 7570  names_counter.up
-0000cb90: 6461 7465 287b 7072 6566 6978 3a20 317d  date({prefix: 1}
-0000cba0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000cbb0: 2020 2020 2020 616c 6961 7320 3d20 6622        alias = f"
-0000cbc0: 7b70 7265 6669 787d 5f7b 7365 6c66 2e5f  {prefix}_{self._
-0000cbd0: 7265 6665 7265 6e63 655f 6e61 6d65 735f  reference_names_
-0000cbe0: 636f 756e 7465 725b 7072 6566 6978 5d7d  counter[prefix]}
-0000cbf0: 220a 0a20 2020 2020 2020 2072 6566 6572  "..        refer
-0000cc00: 656e 6365 2e6e 616d 6520 3d20 616c 6961  ence.name = alia
-0000cc10: 730a 2020 2020 2020 2020 7365 6c66 2e5f  s.        self._
-0000cc20: 6e61 6d65 645f 7265 6665 7265 6e63 6573  named_references
-0000cc30: 5b61 6c69 6173 5d20 3d20 7265 6665 7265  [alias] = refere
-0000cc40: 6e63 650a 0a20 2020 2040 7072 6f70 6572  nce..    @proper
-0000cc50: 7479 0a20 2020 2064 6566 206c 6179 6572  ty.    def layer
-0000cc60: 7328 7365 6c66 2920 2d3e 2073 6574 5b74  s(self) -> set[t
-0000cc70: 7570 6c65 5b69 6e74 2c20 696e 745d 5d3a  uple[int, int]]:
-0000cc80: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-0000cc90: 726e 7320 6120 7365 7420 6f66 2074 6865  rns a set of the
-0000cca0: 204c 6179 6572 7320 696e 2074 6865 2043   Layers in the C
-0000ccb0: 6f6d 706f 6e65 6e74 2e22 2222 0a20 2020  omponent.""".   
-0000ccc0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000ccd0: 2e67 6574 5f6c 6179 6572 7328 290a 0a20  .get_layers().. 
-0000cce0: 2020 2064 6566 2067 6574 5f6c 6179 6572     def get_layer
-0000ccf0: 7328 7365 6c66 2920 2d3e 2073 6574 5b74  s(self) -> set[t
-0000cd00: 7570 6c65 5b69 6e74 2c20 696e 745d 5d3a  uple[int, int]]:
-0000cd10: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-0000cd20: 726e 2061 2073 6574 206f 6620 286c 6179  rn a set of (lay
-0000cd30: 6572 2c20 6461 7461 7479 7065 292e 0a0a  er, datatype)...
-0000cd40: 2020 2020 2020 2020 2e2e 2063 6f64 6520          .. code 
-0000cd50: 3a3a 0a0a 2020 2020 2020 2020 2020 2020  ::..            
-0000cd60: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
-0000cd70: 7920 6173 2067 660a 2020 2020 2020 2020  y as gf.        
-0000cd80: 2020 2020 6766 2e63 6f6d 706f 6e65 6e74      gf.component
-0000cd90: 732e 7374 7261 6967 6874 2829 2e67 6574  s.straight().get
-0000cda0: 5f6c 6179 6572 7328 2920 3d3d 207b 2831  _layers() == {(1
-0000cdb0: 2c20 3029 2c20 2831 3131 2c20 3029 7d0a  , 0), (111, 0)}.
-0000cdc0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000cdd0: 2020 2020 706f 6c79 676f 6e73 203d 2073      polygons = s
-0000cde0: 656c 662e 5f63 656c 6c2e 6765 745f 706f  elf._cell.get_po
-0000cdf0: 6c79 676f 6e73 2864 6570 7468 3d4e 6f6e  lygons(depth=Non
-0000ce00: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-0000ce10: 6e20 7b28 706f 6c79 676f 6e2e 6c61 7965  n {(polygon.laye
-0000ce20: 722c 2070 6f6c 7967 6f6e 2e64 6174 6174  r, polygon.datat
-0000ce30: 7970 6529 2066 6f72 2070 6f6c 7967 6f6e  ype) for polygon
-0000ce40: 2069 6e20 706f 6c79 676f 6e73 7d0a 0a20   in polygons}.. 
-0000ce50: 2020 2064 6566 2067 6574 5f6c 6179 6572     def get_layer
-0000ce60: 5f6e 616d 6573 2873 656c 6629 202d 3e20  _names(self) -> 
-0000ce70: 6c69 7374 5b74 7570 6c65 5b69 6e74 2c20  list[tuple[int, 
-0000ce80: 696e 745d 5d3a 0a20 2020 2020 2020 2022  int]]:.        "
-0000ce90: 2222 5265 7475 726e 206c 6179 6572 206e  ""Return layer n
-0000cea0: 616d 6573 2075 7365 6420 696e 2074 6865  ames used in the
-0000ceb0: 2064 6573 6967 6e2e 0a0a 2020 2020 2020   design...      
-0000cec0: 2020 2e2e 2063 6f64 6520 3a3a 0a0a 2020    .. code ::..  
-0000ced0: 2020 2020 2020 2020 2020 696d 706f 7274            import
-0000cee0: 2067 6473 6661 6374 6f72 7920 6173 2067   gdsfactory as g
-0000cef0: 660a 2020 2020 2020 2020 2020 2020 6766  f.            gf
-0000cf00: 2e63 6f6d 706f 6e65 6e74 732e 7374 7261  .components.stra
-0000cf10: 6967 6874 2829 2e67 6574 5f6e 616d 6573  ight().get_names
-0000cf20: 2829 203d 3d20 5b27 5747 275d 0a20 2020  () == ['WG'].   
-0000cf30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000cf40: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
-0000cf50: 7279 2061 7320 6766 0a0a 2020 2020 2020  ry as gf..      
-0000cf60: 2020 5044 4b20 3d20 6766 2e67 6574 5f61    PDK = gf.get_a
-0000cf70: 6374 6976 655f 7064 6b28 290a 2020 2020  ctive_pdk().    
-0000cf80: 2020 2020 4c41 5945 5253 203d 2050 444b      LAYERS = PDK
-0000cf90: 2e6c 6179 6572 730a 2020 2020 2020 2020  .layers.        
-0000cfa0: 6e61 6d65 5f74 6f5f 6c61 7965 7220 3d20  name_to_layer = 
-0000cfb0: 6469 6374 284c 4159 4552 5329 0a20 2020  dict(LAYERS).   
-0000cfc0: 2020 2020 206c 6179 6572 5f74 6f5f 6e61       layer_to_na
-0000cfd0: 6d65 203d 207b 763a 206b 2066 6f72 206b  me = {v: k for k
-0000cfe0: 2c20 7620 696e 206e 616d 655f 746f 5f6c  , v in name_to_l
-0000cff0: 6179 6572 2e69 7465 6d73 2829 7d0a 2020  ayer.items()}.  
-0000d000: 2020 2020 2020 6c61 7965 725f 6e61 6d65        layer_name
-0000d010: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
-0000d020: 666f 7220 6c61 7965 7220 696e 2073 656c  for layer in sel
-0000d030: 662e 6c61 7965 7273 3a0a 2020 2020 2020  f.layers:.      
-0000d040: 2020 2020 2020 6966 206c 6179 6572 206e        if layer n
-0000d050: 6f74 2069 6e20 6c61 7965 725f 746f 5f6e  ot in layer_to_n
-0000d060: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
-0000d070: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-0000d080: 726e 2866 227b 6c61 7965 727d 206e 6f74  rn(f"{layer} not
-0000d090: 2069 6e20 4c61 7965 724d 6170 2e22 2c20   in LayerMap.", 
-0000d0a0: 7374 6163 6b6c 6576 656c 3d33 290a 2020  stacklevel=3).  
-0000d0b0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0d0: 6c61 7965 725f 6e61 6d65 732e 6170 7065  layer_names.appe
-0000d0e0: 6e64 286c 6179 6572 5f74 6f5f 6e61 6d65  nd(layer_to_name
-0000d0f0: 5b6c 6179 6572 5d29 0a20 2020 2020 2020  [layer]).       
-0000d100: 2072 6574 7572 6e20 6c61 7965 725f 6e61   return layer_na
-0000d110: 6d65 730a 0a20 2020 2064 6566 205f 7265  mes..    def _re
-0000d120: 7072 5f68 746d 6c5f 2873 656c 6629 3a0a  pr_html_(self):.
-0000d130: 2020 2020 2020 2020 2222 2253 686f 7720          """Show 
-0000d140: 6765 6f6d 6574 7279 2069 6e20 4b4c 6179  geometry in KLay
-0000d150: 6f75 7420 616e 6420 696e 206d 6174 706c  out and in matpl
-0000d160: 6f74 6c69 6220 666f 7220 4a75 7079 7465  otlib for Jupyte
-0000d170: 7220 4e6f 7465 626f 6f6b 732e 2222 220a  r Notebooks.""".
-0000d180: 2020 2020 2020 2020 7365 6c66 2e73 686f          self.sho
-0000d190: 7728 290a 2020 2020 2020 2020 6669 6720  w().        fig 
-0000d1a0: 3d20 7365 6c66 2e70 6c6f 7428 290a 2020  = self.plot().  
-0000d1b0: 2020 2020 2020 6966 2066 6967 2061 6e64        if fig and
-0000d1c0: 2068 6173 6174 7472 2866 6967 2c20 225f   hasattr(fig, "_
-0000d1d0: 7265 7072 5f68 746d 6c5f 2229 3a0a 2020  repr_html_"):.  
-0000d1e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000d1f0: 2066 6967 2e5f 7265 7072 5f68 746d 6c5f   fig._repr_html_
-0000d200: 2829 0a0a 2020 2020 6465 6620 6164 645f  ()..    def add_
-0000d210: 7069 6e73 5f74 7269 616e 676c 6528 0a20  pins_triangle(. 
-0000d220: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0000d230: 2020 2020 2070 6f72 745f 6d61 726b 6572       port_marker
-0000d240: 5f6c 6179 6572 3a20 4c61 7965 7220 3d20  _layer: Layer = 
-0000d250: 2831 2c20 3130 292c 0a20 2020 2020 2020  (1, 10),.       
-0000d260: 206c 6179 6572 5f6c 6162 656c 3a20 4c61   layer_label: La
-0000d270: 7965 7220 3d20 2831 2c20 3130 292c 0a20  yer = (1, 10),. 
-0000d280: 2020 2020 2020 206d 616b 655f 636f 7079         make_copy
-0000d290: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-0000d2a0: 2020 2029 202d 3e20 436f 6d70 6f6e 656e     ) -> Componen
-0000d2b0: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
-0000d2c0: 7475 726e 7320 636f 6d70 6f6e 656e 7420  turns component 
-0000d2d0: 7769 7468 2074 7269 616e 6775 6c61 7220  with triangular 
-0000d2e0: 7069 6e73 2e22 2222 0a20 2020 2020 2020  pins.""".       
-0000d2f0: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
-0000d300: 2e61 6464 5f70 696e 7320 696d 706f 7274  .add_pins import
-0000d310: 2061 6464 5f70 696e 735f 7472 6961 6e67   add_pins_triang
-0000d320: 6c65 0a0a 2020 2020 2020 2020 6966 206d  le..        if m
-0000d330: 616b 655f 636f 7079 3a0a 2020 2020 2020  ake_copy:.      
-0000d340: 2020 2020 2020 636f 6d70 6f6e 656e 7420        component 
-0000d350: 3d20 7365 6c66 2e63 6f70 7928 290a 2020  = self.copy().  
-0000d360: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000d370: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-0000d380: 7420 3d20 7365 6c66 0a20 2020 2020 2020  t = self.       
-0000d390: 2061 6464 5f70 696e 735f 7472 6961 6e67   add_pins_triang
-0000d3a0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-0000d3b0: 636f 6d70 6f6e 656e 743d 636f 6d70 6f6e  component=compon
-0000d3c0: 656e 742c 206c 6179 6572 3d70 6f72 745f  ent, layer=port_
-0000d3d0: 6d61 726b 6572 5f6c 6179 6572 2c20 6c61  marker_layer, la
-0000d3e0: 7965 725f 6c61 6265 6c3d 6c61 7965 725f  yer_label=layer_
-0000d3f0: 6c61 6265 6c0a 2020 2020 2020 2020 290a  label.        ).
-0000d400: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-0000d410: 6f6d 706f 6e65 6e74 0a0a 2020 2020 6465  omponent..    de
-0000d420: 6620 706c 6f74 5f6b 6c61 796f 7574 280a  f plot_klayout(.
-0000d430: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000d440: 2020 2020 2020 7368 6f77 5f70 6f72 7473        show_ports
-0000d450: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-0000d460: 2020 2020 2020 2070 6f72 745f 6d61 726b         port_mark
-0000d470: 6572 5f6c 6179 6572 3a20 4c61 7965 7220  er_layer: Layer 
-0000d480: 3d20 2831 2c20 3130 292c 0a20 2020 2020  = (1, 10),.     
-0000d490: 2020 2073 686f 775f 6c61 6265 6c73 3a20     show_labels: 
-0000d4a0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0000d4b0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-0000d4c0: 5265 7475 726e 7320 6b6c 6179 6f75 7420  Returns klayout 
-0000d4d0: 696d 6167 652e 0a0a 2020 2020 2020 2020  image...        
-0000d4e0: 4966 2069 7420 6661 696c 7320 746f 2069  If it fails to i
-0000d4f0: 6d70 6f72 7420 6b6c 6179 6f75 7420 6465  mport klayout de
-0000d500: 6661 756c 7473 2074 6f20 6d61 7470 6c6f  faults to matplo
-0000d510: 746c 6962 2e0a 0a20 2020 2020 2020 2041  tlib...        A
-0000d520: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-0000d530: 2073 686f 775f 706f 7274 733a 2073 686f   show_ports: sho
-0000d540: 7773 2063 6f6d 706f 6e65 6e74 2077 6974  ws component wit
-0000d550: 6820 706f 7274 206d 6172 6b65 7273 2061  h port markers a
-0000d560: 6e64 206c 6162 656c 732e 0a20 2020 2020  nd labels..     
-0000d570: 2020 2020 2020 2070 6f72 745f 6d61 726b         port_mark
-0000d580: 6572 5f6c 6179 6572 3a20 666f 7220 7468  er_layer: for th
-0000d590: 6520 706f 7274 732e 0a20 2020 2020 2020  e ports..       
-0000d5a0: 2020 2020 2073 686f 775f 6c61 6265 6c73       show_labels
-0000d5b0: 3a20 7368 6f77 7320 6c61 6265 6c73 2e0a  : shows labels..
-0000d5c0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0000d5d0: 2020 2020 2069 6620 7368 6f77 5f70 6f72       if show_por
-0000d5e0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-0000d5f0: 6e61 6d65 203d 2073 656c 662e 6e61 6d65  name = self.name
-0000d600: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-0000d610: 706f 6e65 6e74 203d 2073 656c 662e 6164  ponent = self.ad
-0000d620: 645f 7069 6e73 5f74 7269 616e 676c 6528  d_pins_triangle(
-0000d630: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
-0000d640: 723d 706f 7274 5f6d 6172 6b65 725f 6c61  r=port_marker_la
-0000d650: 7965 7229 0a20 2020 2020 2020 2020 2020  yer).           
-0000d660: 2063 6f6d 706f 6e65 6e74 2e72 656e 616d   component.renam
-0000d670: 6528 6e61 6d65 2c20 6361 6368 653d 4661  e(name, cache=Fa
-0000d680: 6c73 6529 0a0a 2020 2020 2020 2020 656c  lse)..        el
-0000d690: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000d6a0: 636f 6d70 6f6e 656e 7420 3d20 7365 6c66  component = self
-0000d6b0: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
-0000d6c0: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-0000d6d0: 696f 2069 6d70 6f72 7420 4279 7465 7349  io import BytesI
-0000d6e0: 4f0a 0a20 2020 2020 2020 2020 2020 2069  O..            i
-0000d6f0: 6d70 6f72 7420 6b6c 6179 6f75 742e 6462  mport klayout.db
-0000d700: 2061 7320 6462 2020 2320 6e6f 7161 3a20   as db  # noqa: 
-0000d710: 4634 3031 0a20 2020 2020 2020 2020 2020  F401.           
-0000d720: 2069 6d70 6f72 7420 6b6c 6179 6f75 742e   import klayout.
-0000d730: 6c61 7920 6173 206c 6179 0a20 2020 2020  lay as lay.     
-0000d740: 2020 2020 2020 2069 6d70 6f72 7420 6d61         import ma
-0000d750: 7470 6c6f 746c 6962 2e70 7970 6c6f 7420  tplotlib.pyplot 
-0000d760: 6173 2070 6c74 0a0a 2020 2020 2020 2020  as plt..        
-0000d770: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
-0000d780: 6f72 792e 7064 6b20 696d 706f 7274 2067  ory.pdk import g
-0000d790: 6574 5f6c 6179 6572 5f76 6965 7773 0a0a  et_layer_views..
-0000d7a0: 2020 2020 2020 2020 2020 2020 6764 7370              gdsp
-0000d7b0: 6174 6820 3d20 636f 6d70 6f6e 656e 742e  ath = component.
-0000d7c0: 7772 6974 655f 6764 7328 6c6f 6767 696e  write_gds(loggin
-0000d7d0: 673d 4661 6c73 6529 0a20 2020 2020 2020  g=False).       
-0000d7e0: 2020 2020 206c 7970 5f70 6174 6820 3d20       lyp_path = 
-0000d7f0: 6764 7370 6174 682e 7769 7468 5f73 7566  gdspath.with_suf
-0000d800: 6669 7828 222e 6c79 7022 290a 0a20 2020  fix(".lyp")..   
-0000d810: 2020 2020 2020 2020 206c 6179 6572 5f76           layer_v
-0000d820: 6965 7773 203d 2067 6574 5f6c 6179 6572  iews = get_layer
-0000d830: 5f76 6965 7773 2829 0a20 2020 2020 2020  _views().       
-0000d840: 2020 2020 206c 6179 6572 5f76 6965 7773       layer_views
-0000d850: 2e74 6f5f 6c79 7028 6669 6c65 7061 7468  .to_lyp(filepath
-0000d860: 3d6c 7970 5f70 6174 6829 0a0a 2020 2020  =lyp_path)..    
-0000d870: 2020 2020 2020 2020 6c61 796f 7574 5f76          layout_v
-0000d880: 6965 7720 3d20 6c61 792e 4c61 796f 7574  iew = lay.Layout
-0000d890: 5669 6577 2829 0a20 2020 2020 2020 2020  View().         
-0000d8a0: 2020 206c 6179 6f75 745f 7669 6577 2e6c     layout_view.l
-0000d8b0: 6f61 645f 6c61 796f 7574 2873 7472 2867  oad_layout(str(g
-0000d8c0: 6473 7061 7468 2e61 6273 6f6c 7574 6528  dspath.absolute(
-0000d8d0: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
-0000d8e0: 6c61 796f 7574 5f76 6965 772e 6d61 785f  layout_view.max_
-0000d8f0: 6869 6572 2829 0a20 2020 2020 2020 2020  hier().         
-0000d900: 2020 206c 6179 6f75 745f 7669 6577 2e6c     layout_view.l
-0000d910: 6f61 645f 6c61 7965 725f 7072 6f70 7328  oad_layer_props(
-0000d920: 7374 7228 6c79 705f 7061 7468 2929 0a0a  str(lyp_path))..
-0000d930: 2020 2020 2020 2020 2020 2020 6c61 796f              layo
-0000d940: 7574 5f76 6965 772e 7365 745f 636f 6e66  ut_view.set_conf
-0000d950: 6967 2822 7465 7874 2d76 6973 6962 6c65  ig("text-visible
-0000d960: 222c 2022 7472 7565 2220 6966 2073 686f  ", "true" if sho
-0000d970: 775f 6c61 6265 6c73 2065 6c73 6520 2266  w_labels else "f
-0000d980: 616c 7365 2229 0a0a 2020 2020 2020 2020  alse")..        
-0000d990: 2020 2020 7069 7865 6c5f 6275 6666 6572      pixel_buffer
-0000d9a0: 203d 206c 6179 6f75 745f 7669 6577 2e67   = layout_view.g
-0000d9b0: 6574 5f70 6978 656c 735f 7769 7468 5f6f  et_pixels_with_o
-0000d9c0: 7074 696f 6e73 2838 3030 2c20 3630 3029  ptions(800, 600)
-0000d9d0: 0a20 2020 2020 2020 2020 2020 2070 6e67  .            png
-0000d9e0: 5f64 6174 6120 3d20 7069 7865 6c5f 6275  _data = pixel_bu
-0000d9f0: 6666 6572 2e74 6f5f 706e 675f 6461 7461  ffer.to_png_data
-0000da00: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-0000da10: 2320 436f 6e76 6572 7420 504e 4720 6461  # Convert PNG da
-0000da20: 7461 2074 6f20 4e75 6d50 7920 6172 7261  ta to NumPy arra
-0000da30: 7920 616e 6420 6469 7370 6c61 7920 7769  y and display wi
-0000da40: 7468 206d 6174 706c 6f74 6c69 620a 2020  th matplotlib.  
-0000da50: 2020 2020 2020 2020 2020 7769 7468 2042            with B
-0000da60: 7974 6573 494f 2870 6e67 5f64 6174 6129  ytesIO(png_data)
-0000da70: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
-0000da80: 2020 2020 2020 2069 6d67 5f61 7272 6179         img_array
-0000da90: 203d 2070 6c74 2e69 6d72 6561 6428 6629   = plt.imread(f)
-0000daa0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000dab0: 436f 6d70 7574 6520 7468 6520 6669 6775  Compute the figu
-0000dac0: 7265 2064 696d 656e 7369 6f6e 7320 6261  re dimensions ba
-0000dad0: 7365 6420 6f6e 2074 6865 2069 6d61 6765  sed on the image
-0000dae0: 2073 697a 6520 616e 6420 6465 7369 7265   size and desire
-0000daf0: 6420 4450 490a 2020 2020 2020 2020 2020  d DPI.          
-0000db00: 2020 6470 6920 3d20 3830 0a20 2020 2020    dpi = 80.     
-0000db10: 2020 2020 2020 2066 6967 5f77 6964 7468         fig_width
-0000db20: 203d 2069 6d67 5f61 7272 6179 2e73 6861   = img_array.sha
-0000db30: 7065 5b31 5d20 2f20 6470 690a 2020 2020  pe[1] / dpi.    
-0000db40: 2020 2020 2020 2020 6669 675f 6865 6967          fig_heig
-0000db50: 6874 203d 2069 6d67 5f61 7272 6179 2e73  ht = img_array.s
-0000db60: 6861 7065 5b30 5d20 2f20 6470 690a 0a20  hape[0] / dpi.. 
-0000db70: 2020 2020 2020 2020 2020 2066 6967 2c20             fig, 
-0000db80: 6178 203d 2070 6c74 2e73 7562 706c 6f74  ax = plt.subplot
-0000db90: 7328 6669 6773 697a 653d 2866 6967 5f77  s(figsize=(fig_w
-0000dba0: 6964 7468 2c20 6669 675f 6865 6967 6874  idth, fig_height
-0000dbb0: 292c 2064 7069 3d64 7069 290a 0a20 2020  ), dpi=dpi)..   
-0000dbc0: 2020 2020 2020 2020 2023 2052 656d 6f76           # Remov
-0000dbd0: 6520 6d61 7267 696e 7320 616e 6420 6469  e margins and di
-0000dbe0: 7370 6c61 7920 7468 6520 696d 6167 650a  splay the image.
-0000dbf0: 2020 2020 2020 2020 2020 2020 6178 2e69              ax.i
-0000dc00: 6d73 686f 7728 696d 675f 6172 7261 7929  mshow(img_array)
-0000dc10: 0a20 2020 2020 2020 2020 2020 2061 782e  .            ax.
-0000dc20: 6178 6973 2822 6f66 6622 2920 2023 2048  axis("off")  # H
-0000dc30: 6964 6520 6178 6573 0a20 2020 2020 2020  ide axes.       
-0000dc40: 2020 2020 2061 782e 7365 745f 706f 7369       ax.set_posi
-0000dc50: 7469 6f6e 285b 302c 2030 2c20 312c 2031  tion([0, 0, 1, 1
-0000dc60: 5d29 2020 2320 5365 7420 6178 6573 2074  ])  # Set axes t
-0000dc70: 6f20 6f63 6375 7079 2074 6865 2066 756c  o occupy the ful
-0000dc80: 6c20 6669 6775 7265 2073 7061 6365 0a0a  l figure space..
-0000dc90: 2020 2020 2020 2020 2020 2020 706c 742e              plt.
-0000dca0: 7375 6270 6c6f 7473 5f61 646a 7573 7428  subplots_adjust(
-0000dcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dcc0: 206c 6566 743d 302c 2072 6967 6874 3d31   left=0, right=1
-0000dcd0: 2c20 746f 703d 312c 2062 6f74 746f 6d3d  , top=1, bottom=
-0000dce0: 302c 2077 7370 6163 653d 302c 2068 7370  0, wspace=0, hsp
-0000dcf0: 6163 653d 300a 2020 2020 2020 2020 2020  ace=0.          
-0000dd00: 2020 2920 2023 2052 656d 6f76 6520 616e    )  # Remove an
-0000dd10: 7920 7061 6464 696e 670a 2020 2020 2020  y padding.      
-0000dd20: 2020 2020 2020 706c 742e 7469 6768 745f        plt.tight_
-0000dd30: 6c61 796f 7574 2870 6164 3d30 2920 2023  layout(pad=0)  #
-0000dd40: 2045 6e73 7572 6520 6e6f 2073 7061 6365   Ensure no space
-0000dd50: 2069 7320 7761 7374 6564 0a20 2020 2020   is wasted.     
-0000dd60: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
-0000dd70: 670a 0a20 2020 2020 2020 2065 7863 6570  g..        excep
-0000dd80: 7420 496d 706f 7274 4572 726f 723a 0a20  t ImportError:. 
-0000dd90: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000dda0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000ddb0: 2020 2259 6f75 2063 616e 2069 6e73 7461    "You can insta
-0000ddc0: 6c6c 2060 7069 7020 696e 7374 616c 6c20  ll `pip install 
-0000ddd0: 6764 7366 6163 746f 7279 5b63 6164 5d60  gdsfactory[cad]`
-0000dde0: 2066 6f72 2062 6574 7465 7220 7669 7375   for better visu
-0000ddf0: 616c 697a 6174 696f 6e22 0a20 2020 2020  alization".     
-0000de00: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000de10: 2020 2020 2063 6f6d 706f 6e65 6e74 2e70       component.p
-0000de20: 6c6f 7428 706c 6f74 7465 723d 226d 6174  lot(plotter="mat
-0000de30: 706c 6f74 6c69 6222 290a 0a20 2020 2064  plotlib")..    d
-0000de40: 6566 2070 6c6f 745f 6b77 6562 2873 656c  ef plot_kweb(sel
-0000de50: 6629 3a0a 2020 2020 2020 2020 2222 2253  f):.        """S
-0000de60: 686f 7773 2063 7572 7265 6e74 2067 6473  hows current gds
-0000de70: 2069 6e20 6b77 6562 2e22 2222 0a0a 2020   in kweb."""..  
-0000de80: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000de90: 2020 2020 2020 2069 6d70 6f72 7420 6b77         import kw
-0000dea0: 6562 2e73 6572 7665 725f 6a75 7079 7465  eb.server_jupyte
-0000deb0: 7220 6173 206b 6a0a 2020 2020 2020 2020  r as kj.        
-0000dec0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0000ded0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0000dee0: 696e 7428 2259 6f75 206e 6565 6420 746f  int("You need to
-0000def0: 2069 6e73 7461 6c6c 206b 7765 6220 7769   install kweb wi
-0000df00: 7468 2060 7069 7020 696e 7374 616c 6c20  th `pip install 
-0000df10: 6764 7366 6163 746f 7279 5b63 6164 5d60  gdsfactory[cad]`
-0000df20: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-0000df30: 6574 7572 6e20 7365 6c66 2e70 6c6f 745f  eturn self.plot_
-0000df40: 6b6c 6179 6f75 7428 290a 0a20 2020 2020  klayout()..     
-0000df50: 2020 2066 726f 6d20 6874 6d6c 2069 6d70     from html imp
-0000df60: 6f72 7420 6573 6361 7065 0a0a 2020 2020  ort escape..    
-0000df70: 2020 2020 6672 6f6d 2049 5079 7468 6f6e      from IPython
-0000df80: 2e64 6973 706c 6179 2069 6d70 6f72 7420  .display import 
-0000df90: 4946 7261 6d65 0a0a 2020 2020 2020 2020  IFrame..        
-0000dfa0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-0000dfb0: 7064 6b20 696d 706f 7274 2067 6574 5f6c  pdk import get_l
-0000dfc0: 6179 6572 5f76 6965 7773 0a0a 2020 2020  ayer_views..    
-0000dfd0: 2020 2020 6764 7370 6174 6820 3d20 7365      gdspath = se
-0000dfe0: 6c66 2e77 7269 7465 5f67 6473 2867 6473  lf.write_gds(gds
-0000dff0: 6469 723d 4744 5344 4952 5f54 454d 502c  dir=GDSDIR_TEMP,
-0000e000: 206c 6f67 6769 6e67 3d46 616c 7365 290a   logging=False).
-0000e010: 2020 2020 2020 2020 6c79 705f 7061 7468          lyp_path
-0000e020: 203d 2047 4453 4449 525f 5445 4d50 202f   = GDSDIR_TEMP /
-0000e030: 2022 6c61 7965 7273 2e6c 7970 220a 0a20   "layers.lyp".. 
-0000e040: 2020 2020 2020 206c 6179 6572 5f70 726f         layer_pro
-0000e050: 7073 203d 2067 6574 5f6c 6179 6572 5f76  ps = get_layer_v
-0000e060: 6965 7773 2829 0a20 2020 2020 2020 206c  iews().        l
-0000e070: 6179 6572 5f70 726f 7073 2e74 6f5f 6c79  ayer_props.to_ly
-0000e080: 7028 6669 6c65 7061 7468 3d6c 7970 5f70  p(filepath=lyp_p
-0000e090: 6174 6829 0a20 2020 2020 2020 2068 6f73  ath).        hos
-0000e0a0: 7420 3d20 6f73 2e67 6574 656e 7628 224b  t = os.getenv("K
-0000e0b0: 5745 425f 484f 5354 222c 2022 6c6f 6361  WEB_HOST", "loca
-0000e0c0: 6c68 6f73 7422 290a 0a20 2020 2020 2020  lhost")..       
-0000e0d0: 2070 6f72 7420 3d20 280a 2020 2020 2020   port = (.      
-0000e0e0: 2020 2020 2020 6b6a 2e70 6f72 740a 2020        kj.port.  
-0000e0f0: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-0000e100: 6174 7472 286b 6a2c 2022 706f 7274 2229  attr(kj, "port")
-0000e110: 2061 6e64 206b 6a2e 706f 7274 0a20 2020   and kj.port.   
-0000e120: 2020 2020 2020 2020 2065 6c73 6520 696e           else in
-0000e130: 7428 6f73 2e67 6574 656e 7628 224b 5745  t(os.getenv("KWE
-0000e140: 425f 504f 5254 222c 2038 3030 3029 290a  B_PORT", 8000)).
-0000e150: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000e160: 2020 7372 6320 3d20 6622 6874 7470 3a2f    src = f"http:/
-0000e170: 2f7b 686f 7374 7d3a 7b70 6f72 747d 2f67  /{host}:{port}/g
-0000e180: 6473 2f7b 6573 6361 7065 2867 6473 7061  ds/{escape(gdspa
-0000e190: 7468 2e73 7465 6d2b 6764 7370 6174 682e  th.stem+gdspath.
-0000e1a0: 7375 6666 6978 297d 3f6c 6179 6572 5f70  suffix)}?layer_p
-0000e1b0: 726f 7073 3d7b 6573 6361 7065 2873 7472  rops={escape(str
-0000e1c0: 286c 7970 5f70 6174 6829 297d 220a 0a20  (lyp_path))}".. 
-0000e1d0: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
-0000e1e0: 6e5b 224b 5745 425f 504f 5254 225d 203d  n["KWEB_PORT"] =
-0000e1f0: 2073 7472 286f 732e 6765 7465 6e76 2822   str(os.getenv("
-0000e200: 4b57 4542 5f50 4f52 5422 2c20 706f 7274  KWEB_PORT", port
-0000e210: 2929 0a0a 2020 2020 2020 2020 6966 206e  ))..        if n
-0000e220: 6f74 206b 6a2e 6a75 7079 7465 725f 7365  ot kj.jupyter_se
-0000e230: 7276 6572 3a0a 2020 2020 2020 2020 2020  rver:.          
-0000e240: 2020 706f 7274 203d 2070 6f72 740a 2020    port = port.  
-0000e250: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-0000e260: 6b6a 2e69 735f 706f 7274 5f69 6e5f 7573  kj.is_port_in_us
-0000e270: 6528 706f 7274 3d70 6f72 742c 2068 6f73  e(port=port, hos
-0000e280: 743d 686f 7374 293a 0a20 2020 2020 2020  t=host):.       
-0000e290: 2020 2020 2020 2020 2070 6f72 7420 2b3d           port +=
-0000e2a0: 2031 0a0a 2020 2020 2020 2020 2020 2020   1..            
-0000e2b0: 6f73 2e65 6e76 6972 6f6e 5b22 4b57 4542  os.environ["KWEB
-0000e2c0: 5f50 4f52 5422 5d20 3d20 7374 7228 706f  _PORT"] = str(po
-0000e2d0: 7274 290a 2020 2020 2020 2020 2020 2020  rt).            
-0000e2e0: 6c6f 6767 6572 2e64 6562 7567 2873 7263  logger.debug(src
-0000e2f0: 290a 2020 2020 2020 2020 2020 2020 6b6a  ).            kj
-0000e300: 2e73 7461 7274 2829 0a0a 2020 2020 2020  .start()..      
-0000e310: 2020 6966 206b 6a2e 6a75 7079 7465 725f    if kj.jupyter_
-0000e320: 7365 7276 6572 3a0a 2020 2020 2020 2020  server:.        
-0000e330: 2020 2020 7265 7475 726e 2049 4672 616d      return IFram
-0000e340: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0000e350: 2020 2073 7263 3d73 7263 2c0a 2020 2020     src=src,.    
-0000e360: 2020 2020 2020 2020 2020 2020 7769 6474              widt
-0000e370: 683d 3134 3030 2c0a 2020 2020 2020 2020  h=1400,.        
-0000e380: 2020 2020 2020 2020 6865 6967 6874 3d36          height=6
-0000e390: 3030 2c0a 2020 2020 2020 2020 2020 2020  00,.            
-0000e3a0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000e3b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000e3c0: 726e 2073 656c 662e 706c 6f74 5f6b 6c61  rn self.plot_kla
-0000e3d0: 796f 7574 2829 0a0a 2020 2020 6465 6620  yout()..    def 
-0000e3e0: 706c 6f74 5f6d 6174 706c 6f74 6c69 6228  plot_matplotlib(
-0000e3f0: 7365 6c66 2c20 2a2a 6b77 6172 6773 2920  self, **kwargs) 
-0000e400: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000e410: 2022 2222 506c 6f74 2063 6f6d 706f 6e65   """Plot compone
-0000e420: 6e74 2075 7369 6e67 206d 6174 706c 6f74  nt using matplot
-0000e430: 6c69 622e 0a0a 2020 2020 2020 2020 4b65  lib...        Ke
-0000e440: 7977 6f72 6420 4172 6773 3a0a 2020 2020  yword Args:.    
-0000e450: 2020 2020 2020 2020 7368 6f77 5f70 6f72          show_por
-0000e460: 7473 3a20 5365 7473 2077 6865 7468 6572  ts: Sets whether
-0000e470: 2070 6f72 7473 2061 7265 2064 7261 776e   ports are drawn
-0000e480: 2e0a 2020 2020 2020 2020 2020 2020 7368  ..            sh
-0000e490: 6f77 5f73 7562 706f 7274 733a 2053 6574  ow_subports: Set
-0000e4a0: 7320 7768 6574 6865 7220 7375 6270 6f72  s whether subpor
-0000e4b0: 7473 2028 706f 7274 7320 7468 6174 2062  ts (ports that b
-0000e4c0: 656c 6f6e 6720 746f 2072 6566 6572 656e  elong to referen
-0000e4d0: 6365 7329 2061 7265 2064 7261 776e 2e0a  ces) are drawn..
-0000e4e0: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-0000e4f0: 6c5f 616c 6961 7365 733a 2053 6574 7320  l_aliases: Sets 
-0000e500: 7768 6574 6865 7220 616c 6961 7365 7320  whether aliases 
-0000e510: 6172 6520 6c61 6265 6c65 6420 7769 7468  are labeled with
-0000e520: 2061 2074 6578 7420 6e61 6d65 2e0a 2020   a text name..  
-0000e530: 2020 2020 2020 2020 2020 6e65 775f 7769            new_wi
-0000e540: 6e64 6f77 3a20 4966 2054 7275 652c 2065  ndow: If True, e
-0000e550: 6163 6820 6361 6c6c 2074 6f20 7175 6963  ach call to quic
-0000e560: 6b70 6c6f 7428 2920 7769 6c6c 2067 656e  kplot() will gen
-0000e570: 6572 6174 6520 6120 7365 7061 7261 7465  erate a separate
-0000e580: 2077 696e 646f 772e 0a20 2020 2020 2020   window..       
-0000e590: 2020 2020 2062 6c6f 636b 696e 673a 2049       blocking: I
-0000e5a0: 6620 5472 7565 2c20 6361 6c6c 696e 6720  f True, calling 
-0000e5b0: 7175 6963 6b70 6c6f 7428 2920 7769 6c6c  quickplot() will
-0000e5c0: 2070 6175 7365 2065 7865 6375 7469 6f6e   pause execution
-0000e5d0: 206f 6620 2822 626c 6f63 6b22 2920 7468   of ("block") th
-0000e5e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000e5f0: 2020 7265 6d61 696e 6465 7220 6f66 2074    remainder of t
-0000e600: 6865 2070 7974 686f 6e20 636f 6465 2075  he python code u
-0000e610: 6e74 696c 2074 6865 2071 7569 636b 706c  ntil the quickpl
-0000e620: 6f74 2829 2077 696e 646f 7720 6973 2063  ot() window is c
-0000e630: 6c6f 7365 642e 0a20 2020 2020 2020 2020  losed..         
-0000e640: 2020 2020 2020 2049 6620 4661 6c73 652c         If False,
-0000e650: 2074 6865 2077 696e 646f 7720 7769 6c6c   the window will
-0000e660: 2062 6520 6f70 656e 6564 2061 6e64 2063   be opened and c
-0000e670: 6f64 6520 7769 6c6c 2063 6f6e 7469 6e75  ode will continu
-0000e680: 6520 746f 2072 756e 2e0a 2020 2020 2020  e to run..      
-0000e690: 2020 2020 2020 7a6f 6f6d 5f66 6163 746f        zoom_facto
-0000e6a0: 723a 2053 6574 7320 7468 6520 7363 616c  r: Sets the scal
-0000e6b0: 696e 6720 6661 6374 6f72 2077 6865 6e20  ing factor when 
-0000e6c0: 7a6f 6f6d 696e 6720 7468 6520 7175 6963  zooming the quic
-0000e6d0: 6b70 6c6f 7420 7769 6e64 6f77 2077 6974  kplot window wit
-0000e6e0: 6820 7468 650a 2020 2020 2020 2020 2020  h the.          
-0000e6f0: 2020 2020 2020 6d6f 7573 6577 6865 656c        mousewheel
-0000e700: 2f74 7261 636b 7061 642e 0a20 2020 2020  /trackpad..     
-0000e710: 2020 2020 2020 2069 6e74 6572 6163 7469         interacti
-0000e720: 7665 5f7a 6f6f 6d3a 2045 6e61 626c 6573  ve_zoom: Enables
-0000e730: 2075 7369 6e67 206d 6f75 7365 7768 6565   using mousewhee
-0000e740: 6c2f 7472 6163 6b70 6164 2074 6f20 7a6f  l/trackpad to zo
-0000e750: 6f6d 2e0a 2020 2020 2020 2020 2020 2020  om..            
-0000e760: 666f 6e74 7369 7a65 3a20 666f 7220 6c61  fontsize: for la
-0000e770: 6265 6c73 2e0a 2020 2020 2020 2020 2020  bels..          
-0000e780: 2020 6c61 7965 7273 5f65 7863 6c75 6465    layers_exclude
-0000e790: 643a 206c 6973 7420 6f66 206c 6179 6572  d: list of layer
-0000e7a0: 7320 746f 2065 7863 6c75 6465 2e0a 2020  s to exclude..  
-0000e7b0: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
-0000e7c0: 7669 6577 733a 206c 6179 6572 5f76 6965  views: layer_vie
-0000e7d0: 7773 2063 6f6c 6f72 7320 6c6f 6164 6564  ws colors loaded
-0000e7e0: 2066 726f 6d20 4b6c 6179 6f75 742e 0a20   from Klayout.. 
-0000e7f0: 2020 2020 2020 2020 2020 206d 696e 5f61             min_a
-0000e800: 7370 6563 743a 206d 696e 696d 756d 2061  spect: minimum a
-0000e810: 7370 6563 7420 7261 7469 6f2e 0a20 2020  spect ratio..   
-0000e820: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000e830: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
-0000e840: 2e71 7569 636b 706c 6f74 7465 7220 696d  .quickplotter im
-0000e850: 706f 7274 2071 7569 636b 706c 6f74 0a0a  port quickplot..
-0000e860: 2020 2020 2020 2020 7175 6963 6b70 6c6f          quickplo
-0000e870: 7428 7365 6c66 2c20 2a2a 6b77 6172 6773  t(self, **kwargs
-0000e880: 290a 0a20 2020 2064 6566 2070 6c6f 7428  )..    def plot(
-0000e890: 7365 6c66 2c20 706c 6f74 7465 723a 2073  self, plotter: s
-0000e8a0: 7472 207c 204e 6f6e 6520 3d20 4e6f 6e65  tr | None = None
-0000e8b0: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-0000e8c0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-0000e8d0: 636f 6d70 6f6e 656e 7420 706c 6f74 2075  component plot u
-0000e8e0: 7369 6e67 206b 6c61 796f 7574 2c20 6d61  sing klayout, ma
-0000e8f0: 7470 6c6f 746c 6962 2c20 6f72 206b 7765  tplotlib, or kwe
-0000e900: 622e 0a0a 2020 2020 2020 2020 5765 2072  b...        We r
-0000e910: 6563 6f6d 6d65 6e64 2075 7369 6e67 206b  ecommend using k
-0000e920: 6c61 796f 7574 206f 7220 6b77 6562 2e0a  layout or kweb..
-0000e930: 2020 2020 2020 2020 4b6c 6179 6f75 7420          Klayout 
-0000e940: 6973 2067 6f6f 6420 666f 7220 696d 6167  is good for imag
-0000e950: 6573 2061 6e64 206b 7765 6220 666f 7220  es and kweb for 
-0000e960: 7265 7370 6f6e 7369 7665 2069 6e74 6572  responsive inter
-0000e970: 6163 7469 7665 2070 6c6f 7473 2e0a 2020  active plots..  
-0000e980: 2020 2020 2020 4d61 7470 6c6f 746c 6962        Matplotlib
-0000e990: 2069 7320 736c 6f77 2066 6f72 2072 656e   is slow for ren
-0000e9a0: 6465 7269 6e67 2062 6967 206c 6179 6f75  dering big layou
-0000e9b0: 7473 2061 6e64 2069 7320 616c 6d6f 7374  ts and is almost
-0000e9c0: 2044 6570 7265 6361 7465 642e 0a0a 2020   Deprecated...  
-0000e9d0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-0000e9e0: 2020 2020 2020 2020 706c 6f74 7465 723a          plotter:
-0000e9f0: 2070 6c6f 7420 6261 636b 656e 6473 2028   plot backends (
-0000ea00: 2777 6964 6765 7427 2c20 276b 6c61 796f  'widget', 'klayo
-0000ea10: 7574 272c 2027 6b77 6562 2729 2e0a 2020  ut', 'kweb')..  
-0000ea20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000ea30: 2020 706c 6f74 7465 7220 3d20 706c 6f74    plotter = plot
-0000ea40: 7465 7220 6f72 2043 4f4e 462e 6469 7370  ter or CONF.disp
-0000ea50: 6c61 795f 7479 7065 0a0a 2020 2020 2020  lay_type..      
-0000ea60: 2020 6966 2070 6c6f 7474 6572 206e 6f74    if plotter not
-0000ea70: 2069 6e20 7661 6c69 645f 706c 6f74 7465   in valid_plotte
-0000ea80: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-0000ea90: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000eaa0: 2866 227b 706c 6f74 7465 7221 727d 206e  (f"{plotter!r} n
-0000eab0: 6f74 2069 6e20 7b76 616c 6964 5f70 6c6f  ot in {valid_plo
-0000eac0: 7474 6572 737d 2229 0a0a 2020 2020 2020  tters}")..      
-0000ead0: 2020 6966 2070 6c6f 7474 6572 203d 3d20    if plotter == 
-0000eae0: 226b 6c61 796f 7574 223a 0a20 2020 2020  "klayout":.     
-0000eaf0: 2020 2020 2020 2073 656c 662e 706c 6f74         self.plot
-0000eb00: 5f6b 6c61 796f 7574 2829 0a20 2020 2020  _klayout().     
-0000eb10: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-0000eb20: 2020 2020 2020 656c 6966 2070 6c6f 7474        elif plott
-0000eb30: 6572 203d 3d20 226b 7765 6222 3a0a 2020  er == "kweb":.  
-0000eb40: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000eb50: 2073 656c 662e 706c 6f74 5f6b 7765 6228   self.plot_kweb(
-0000eb60: 290a 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-0000eb70: 706c 6f74 7465 7220 3d3d 2022 6d61 7470  plotter == "matp
-0000eb80: 6c6f 746c 6962 223a 0a20 2020 2020 2020  lotlib":.       
-0000eb90: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-0000eba0: 746f 7279 2e71 7569 636b 706c 6f74 7465  tory.quickplotte
-0000ebb0: 7220 696d 706f 7274 2071 7569 636b 706c  r import quickpl
-0000ebc0: 6f74 0a0a 2020 2020 2020 2020 2020 2020  ot..            
-0000ebd0: 7175 6963 6b70 6c6f 7428 7365 6c66 2c20  quickplot(self, 
-0000ebe0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-0000ebf0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-0000ec00: 2020 6465 6620 7368 6f77 280a 2020 2020    def show(.    
-0000ec10: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0000ec20: 2020 7368 6f77 5f70 6f72 7473 3a20 626f    show_ports: bo
-0000ec30: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0000ec40: 2020 2020 7368 6f77 5f73 7562 706f 7274      show_subport
-0000ec50: 733a 2062 6f6f 6c20 3d20 4661 6c73 652c  s: bool = False,
-0000ec60: 0a20 2020 2020 2020 2070 6f72 745f 6d61  .        port_ma
-0000ec70: 726b 6572 5f6c 6179 6572 3a20 4c61 7965  rker_layer: Laye
-0000ec80: 7220 3d20 2831 2c20 3130 292c 0a20 2020  r = (1, 10),.   
-0000ec90: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-0000eca0: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-0000ecb0: 2020 2020 2020 2222 2253 686f 7720 636f        """Show co
-0000ecc0: 6d70 6f6e 656e 7420 696e 204b 4c61 796f  mponent in KLayo
-0000ecd0: 7574 2e0a 0a20 2020 2020 2020 2072 6574  ut...        ret
-0000ece0: 7572 6e73 2061 2063 6f70 7920 6f66 2074  urns a copy of t
-0000ecf0: 6865 2043 6f6d 706f 6e65 6e74 2c20 736f  he Component, so
-0000ed00: 2074 6865 206f 7269 6769 6e61 6c20 636f   the original co
-0000ed10: 6d70 6f6e 656e 7420 7265 6d61 696e 7320  mponent remains 
-0000ed20: 696e 7461 6374 2e0a 2020 2020 2020 2020  intact..        
-0000ed30: 7769 7468 2070 696e 7320 6d61 726b 6572  with pins marker
-0000ed40: 7320 6f6e 2065 6163 6820 706f 7274 2073  s on each port s
-0000ed50: 686f 775f 706f 7274 7320 3d20 5472 7565  how_ports = True
-0000ed60: 2c20 616e 6420 6f70 7469 6f6e 616c 6c79  , and optionally
-0000ed70: 2061 6c73 6f0a 2020 2020 2020 2020 7468   also.        th
-0000ed80: 6520 706f 7274 7320 6672 6f6d 2074 6865  e ports from the
-0000ed90: 2072 6566 6572 656e 6365 7320 2873 686f   references (sho
-0000eda0: 775f 7375 6270 6f72 7473 3d54 7275 6529  w_subports=True)
-0000edb0: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-0000edc0: 2020 2020 2020 2020 2020 2020 7368 6f77              show
-0000edd0: 5f70 6f72 7473 3a20 7368 6f77 7320 636f  _ports: shows co
-0000ede0: 6d70 6f6e 656e 7420 7769 7468 2070 6f72  mponent with por
-0000edf0: 7420 6d61 726b 6572 7320 616e 6420 6c61  t markers and la
-0000ee00: 6265 6c73 2e0a 2020 2020 2020 2020 2020  bels..          
-0000ee10: 2020 7368 6f77 5f73 7562 706f 7274 733a    show_subports:
-0000ee20: 2061 6464 2070 6f72 7473 206d 6172 6b65   add ports marke
-0000ee30: 7273 2061 6e64 206c 6162 656c 7320 746f  rs and labels to
-0000ee40: 2072 6566 6572 656e 6365 732e 0a20 2020   references..   
-0000ee50: 2020 2020 2020 2020 2070 6f72 745f 6d61           port_ma
-0000ee60: 726b 6572 5f6c 6179 6572 3a20 666f 7220  rker_layer: for 
-0000ee70: 7468 6520 706f 7274 732e 0a0a 2020 2020  the ports...    
-0000ee80: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
-0000ee90: 3a0a 2020 2020 2020 2020 2020 2020 6764  :.            gd
-0000eea0: 7370 6174 683a 2047 4453 2066 696c 6520  spath: GDS file 
-0000eeb0: 7061 7468 2074 6f20 7772 6974 6520 746f  path to write to
-0000eec0: 2e0a 2020 2020 2020 2020 2020 2020 6764  ..            gd
-0000eed0: 7364 6972 3a20 6469 7265 6374 6f72 7920  sdir: directory 
-0000eee0: 666f 7220 7468 6520 4744 5320 6669 6c65  for the GDS file
-0000eef0: 2e20 4465 6661 756c 7473 2074 6f20 2f74  . Defaults to /t
-0000ef00: 6d70 2f2e 0a20 2020 2020 2020 2020 2020  mp/..           
-0000ef10: 2075 6e69 743a 2075 6e69 7420 7369 7a65   unit: unit size
-0000ef20: 2066 6f72 206f 626a 6563 7473 2069 6e20   for objects in 
-0000ef30: 6c69 6272 6172 792e 2031 756d 2062 7920  library. 1um by 
-0000ef40: 6465 6661 756c 742e 0a20 2020 2020 2020  default..       
-0000ef50: 2020 2020 2070 7265 6369 7369 6f6e 3a20       precision: 
-0000ef60: 666f 7220 6f62 6a65 6374 2064 696d 656e  for object dimen
-0000ef70: 7369 6f6e 7320 696e 2074 6865 206c 6962  sions in the lib
-0000ef80: 7261 7279 2028 6d29 2e20 316e 6d20 6279  rary (m). 1nm by
-0000ef90: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
-0000efa0: 2020 2020 2020 7469 6d65 7374 616d 703a        timestamp:
-0000efb0: 2044 6566 6175 6c74 7320 746f 2032 3031   Defaults to 201
-0000efc0: 392d 3130 2d32 352e 2049 6620 4e6f 6e65  9-10-25. If None
-0000efd0: 2075 7365 7320 6375 7272 656e 7420 7469   uses current ti
-0000efe0: 6d65 2e0a 2020 2020 2020 2020 2222 220a  me..        """.
-0000eff0: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-0000f000: 6661 6374 6f72 792e 6164 645f 7069 6e73  factory.add_pins
-0000f010: 2069 6d70 6f72 7420 6164 645f 7069 6e73   import add_pins
-0000f020: 5f74 7269 616e 676c 650a 2020 2020 2020  _triangle.      
-0000f030: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
-0000f040: 792e 7368 6f77 2069 6d70 6f72 7420 7368  y.show import sh
-0000f050: 6f77 0a0a 2020 2020 2020 2020 636f 6d70  ow..        comp
-0000f060: 6f6e 656e 7420 3d20 280a 2020 2020 2020  onent = (.      
-0000f070: 2020 2020 2020 7365 6c66 2e61 6464 5f70        self.add_p
-0000f080: 696e 735f 7472 6961 6e67 6c65 280a 2020  ins_triangle(.  
-0000f090: 2020 2020 2020 2020 2020 2020 2020 706f                po
-0000f0a0: 7274 5f6d 6172 6b65 725f 6c61 7965 723d  rt_marker_layer=
-0000f0b0: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
-0000f0c0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-0000f0d0: 2020 206c 6179 6572 5f6c 6162 656c 3d70     layer_label=p
-0000f0e0: 6f72 745f 6d61 726b 6572 5f6c 6179 6572  ort_marker_layer
-0000f0f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f100: 2020 6d61 6b65 5f63 6f70 793d 5472 7565    make_copy=True
-0000f110: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0000f120: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000f130: 686f 775f 706f 7274 730a 2020 2020 2020  how_ports.      
-0000f140: 2020 2020 2020 656c 7365 2073 656c 660a        else self.
-0000f150: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0000f160: 2020 2069 6620 7368 6f77 5f73 7562 706f     if show_subpo
-0000f170: 7274 733a 0a20 2020 2020 2020 2020 2020  rts:.           
-0000f180: 2063 6f6d 706f 6e65 6e74 203d 2063 6f6d   component = com
-0000f190: 706f 6e65 6e74 2e63 6f70 7928 290a 2020  ponent.copy().  
-0000f1a0: 2020 2020 2020 2020 2020 666f 7220 7265            for re
-0000f1b0: 6665 7265 6e63 6520 696e 2063 6f6d 706f  ference in compo
-0000f1c0: 6e65 6e74 2e72 6566 6572 656e 6365 733a  nent.references:
-0000f1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f1e0: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
-0000f1f0: 6f6d 706f 6e65 6e74 2c20 436f 6d70 6f6e  omponent, Compon
-0000f200: 656e 7452 6566 6572 656e 6365 293a 0a20  entReference):. 
-0000f210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f220: 2020 2061 6464 5f70 696e 735f 7472 6961     add_pins_tria
-0000f230: 6e67 6c65 280a 2020 2020 2020 2020 2020  ngle(.          
-0000f240: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000f250: 6d70 6f6e 656e 743d 636f 6d70 6f6e 656e  mponent=componen
-0000f260: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-0000f270: 2020 2020 2020 2020 2020 2072 6566 6572             refer
-0000f280: 656e 6365 3d72 6566 6572 656e 6365 2c0a  ence=reference,.
-0000f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2a0: 2020 2020 2020 2020 6c61 7965 723d 706f          layer=po
-0000f2b0: 7274 5f6d 6172 6b65 725f 6c61 7965 722c  rt_marker_layer,
-0000f2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f2d0: 2020 2020 2020 2020 206c 6179 6572 5f6c           layer_l
-0000f2e0: 6162 656c 3d70 6f72 745f 6d61 726b 6572  abel=port_marker
-0000f2f0: 5f6c 6179 6572 2c0a 2020 2020 2020 2020  _layer,.        
-0000f300: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0000f310: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-0000f320: 2e72 656e 616d 6528 7365 6c66 2e6e 616d  .rename(self.nam
-0000f330: 652c 2063 6163 6865 3d46 616c 7365 290a  e, cache=False).
-0000f340: 2020 2020 2020 2020 7368 6f77 2863 6f6d          show(com
-0000f350: 706f 6e65 6e74 2c20 2a2a 6b77 6172 6773  ponent, **kwargs
-0000f360: 290a 0a20 2020 2064 6566 205f 7772 6974  )..    def _writ
-0000f370: 655f 6c69 6272 6172 7928 0a20 2020 2020  e_library(.     
-0000f380: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0000f390: 2067 6473 7061 7468 3a20 5061 7468 5479   gdspath: PathTy
-0000f3a0: 7065 207c 204e 6f6e 6520 3d20 4e6f 6e65  pe | None = None
-0000f3b0: 2c0a 2020 2020 2020 2020 6764 7364 6972  ,.        gdsdir
-0000f3c0: 3a20 5061 7468 5479 7065 207c 204e 6f6e  : PathType | Non
-0000f3d0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-0000f3e0: 2020 7469 6d65 7374 616d 703a 2064 6174    timestamp: dat
-0000f3f0: 6574 696d 652e 6461 7465 7469 6d65 207c  etime.datetime |
-0000f400: 204e 6f6e 6520 3d20 5f74 696d 6573 7461   None = _timesta
-0000f410: 6d70 3230 3139 2c0a 2020 2020 2020 2020  mp2019,.        
-0000f420: 6c6f 6767 696e 673a 2062 6f6f 6c20 3d20  logging: bool = 
-0000f430: 5472 7565 2c0a 2020 2020 2020 2020 7769  True,.        wi
-0000f440: 7468 5f6f 6173 6973 3a20 626f 6f6c 203d  th_oasis: bool =
-0000f450: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-0000f460: 7769 7468 5f6d 6574 6164 6174 613a 2062  with_metadata: b
-0000f470: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0000f480: 2020 2020 2077 6974 685f 6e65 746c 6973       with_netlis
-0000f490: 743a 2062 6f6f 6c20 3d20 4661 6c73 652c  t: bool = False,
-0000f4a0: 0a20 2020 2020 2020 206e 6574 6c69 7374  .        netlist
-0000f4b0: 5f66 756e 6374 696f 6e3a 2043 616c 6c61  _function: Calla
-0000f4c0: 626c 6520 7c20 4e6f 6e65 203d 204e 6f6e  ble | None = Non
-0000f4d0: 652c 0a20 2020 2020 2020 202a 2a6b 7761  e,.        **kwa
-0000f4e0: 7267 732c 0a20 2020 2029 202d 3e20 5061  rgs,.    ) -> Pa
-0000f4f0: 7468 3a0a 2020 2020 2020 2020 2222 2257  th:.        """W
-0000f500: 7269 7465 2063 6f6d 706f 6e65 6e74 2074  rite component t
-0000f510: 6f20 4744 5320 6f72 204f 4153 4953 2061  o GDS or OASIS a
-0000f520: 6e64 2072 6574 7572 6e73 2067 6473 7061  nd returns gdspa
-0000f530: 7468 2e0a 0a20 2020 2020 2020 2041 7267  th...        Arg
-0000f540: 733a 0a20 2020 2020 2020 2020 2020 2067  s:.            g
-0000f550: 6473 7061 7468 3a20 4744 5320 6669 6c65  dspath: GDS file
-0000f560: 2070 6174 6820 746f 2077 7269 7465 2074   path to write t
-0000f570: 6f2e 0a20 2020 2020 2020 2020 2020 2067  o..            g
-0000f580: 6473 6469 723a 2064 6972 6563 746f 7279  dsdir: directory
-0000f590: 2066 6f72 2074 6865 2047 4453 2066 696c   for the GDS fil
-0000f5a0: 652e 2044 6566 6175 6c74 7320 746f 202f  e. Defaults to /
-0000f5b0: 746d 702f 7261 6e64 6f6d 4669 6c65 2f67  tmp/randomFile/g
-0000f5c0: 6473 6661 6374 6f72 792e 0a20 2020 2020  dsfactory..     
-0000f5d0: 2020 2020 2020 2074 696d 6573 7461 6d70         timestamp
-0000f5e0: 3a20 4465 6661 756c 7473 2074 6f20 3230  : Defaults to 20
-0000f5f0: 3139 2d31 302d 3235 2066 6f72 2063 6f6e  19-10-25 for con
-0000f600: 7369 7374 656e 7420 6861 7368 2e0a 2020  sistent hash..  
-0000f610: 2020 2020 2020 2020 2020 2020 2020 4966                If
-0000f620: 204e 6f6e 6520 7573 6573 2063 7572 7265   None uses curre
-0000f630: 6e74 2074 696d 652e 0a20 2020 2020 2020  nt time..       
-0000f640: 2020 2020 206c 6f67 6769 6e67 3a20 6469       logging: di
-0000f650: 7361 626c 6520 4744 5320 7061 7468 206c  sable GDS path l
-0000f660: 6f67 6769 6e67 2c20 666f 7220 6578 616d  ogging, for exam
-0000f670: 706c 6520 666f 7220 7368 6f77 696e 6720  ple for showing 
-0000f680: 6974 2069 6e20 4b4c 6179 6f75 742e 0a20  it in KLayout.. 
-0000f690: 2020 2020 2020 2020 2020 2077 6974 685f             with_
-0000f6a0: 6f61 7369 733a 2049 6620 5472 7565 2c20  oasis: If True, 
-0000f6b0: 6669 6c65 2077 696c 6c20 6265 2077 7269  file will be wri
-0000f6c0: 7474 656e 2074 6f20 4f41 5349 532e 204f  tten to OASIS. O
-0000f6d0: 7468 6572 7769 7365 2c20 6669 6c65 2077  therwise, file w
-0000f6e0: 696c 6c20 6265 2077 7269 7474 656e 2074  ill be written t
-0000f6f0: 6f20 4744 532e 0a20 2020 2020 2020 2020  o GDS..         
-0000f700: 2020 2077 6974 685f 6d65 7461 6461 7461     with_metadata
-0000f710: 3a20 7772 6974 6573 206d 6574 6164 6174  : writes metadat
-0000f720: 6120 696e 2059 414d 4c20 666f 726d 6174  a in YAML format
-0000f730: 2e0a 2020 2020 2020 2020 2020 2020 7769  ..            wi
-0000f740: 7468 5f6e 6574 6c69 7374 3a20 7772 6974  th_netlist: writ
-0000f750: 6573 206e 6574 6c69 7374 2069 6e20 4a53  es netlist in JS
-0000f760: 4f4e 2066 6f72 6d61 742e 0a20 2020 2020  ON format..     
-0000f770: 2020 2020 2020 206e 6574 6c69 7374 5f66         netlist_f
-0000f780: 756e 6374 696f 6e3a 2054 6865 206e 6574  unction: The net
-0000f790: 6c69 7374 2066 756e 6374 696f 6e20 746f  list function to
-0000f7a0: 2075 7365 2e20 596f 7520 6361 6e20 636f   use. You can co
-0000f7b0: 6d70 6f73 6520 6120 7061 7274 6961 6c20  mpose a partial 
-0000f7c0: 6675 6e63 7469 6f6e 2077 6974 6820 7468  function with th
-0000f7d0: 6520 6067 6574 5f6e 6574 6c69 7374 6020  e `get_netlist` 
-0000f7e0: 6675 6e63 7469 6f6e 2066 6f72 2065 7861  function for exa
-0000f7f0: 6d70 6c65 2077 6974 6820 796f 7572 2070  mple with your p
-0000f800: 6172 616d 6574 6572 732e 0a0a 2020 2020  arameters...    
-0000f810: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
-0000f820: 3a0a 2020 2020 2020 2020 2020 2020 4b65  :.            Ke
-0000f830: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-0000f840: 7769 6c6c 206f 7665 7272 6964 6520 7468  will override th
-0000f850: 6520 6163 7469 7665 2050 444b 2773 2064  e active PDK's d
-0000f860: 6566 6175 6c74 2047 6473 5772 6974 6553  efault GdsWriteS
-0000f870: 6574 7469 6e67 7320 616e 6420 4f61 7369  ettings and Oasi
-0000f880: 7357 7269 7465 5365 7474 696e 6773 2e0a  sWriteSettings..
-0000f890: 0a20 2020 2020 2020 2020 2020 2047 6473  .            Gds
-0000f8a0: 2073 6574 7469 6e67 733a 0a20 2020 2020   settings:.     
-0000f8b0: 2020 2020 2020 2020 2020 2075 6e69 743a             unit:
-0000f8c0: 2075 6e69 7420 7369 7a65 2066 6f72 206f   unit size for o
-0000f8d0: 626a 6563 7473 2069 6e20 6c69 6272 6172  bjects in librar
-0000f8e0: 792e 2031 756d 2062 7920 6465 6661 756c  y. 1um by defaul
-0000f8f0: 742e 0a20 2020 2020 2020 2020 2020 2020  t..             
-0000f900: 2020 2070 7265 6369 7369 6f6e 3a20 666f     precision: fo
-0000f910: 7220 6469 6d65 6e73 696f 6e73 2069 6e20  r dimensions in 
-0000f920: 7468 6520 6c69 6272 6172 7920 286d 292e  the library (m).
-0000f930: 2031 6e6d 2062 7920 6465 6661 756c 742e   1nm by default.
-0000f940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f950: 206f 6e5f 6475 706c 6963 6174 655f 6365   on_duplicate_ce
-0000f960: 6c6c 3a20 7370 6563 6966 7920 686f 7720  ll: specify how 
-0000f970: 746f 2072 6573 6f6c 7665 2064 7570 6c69  to resolve dupli
-0000f980: 6361 7465 2d6e 616d 6564 2063 656c 6c73  cate-named cells
-0000f990: 2e20 4368 6f6f 7365 206f 6e65 206f 6620  . Choose one of 
-0000f9a0: 7468 6520 666f 6c6c 6f77 696e 673a 0a20  the following:. 
-0000f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9c0: 2020 2022 7761 726e 2220 2864 6566 6175     "warn" (defau
-0000f9d0: 6c74 293a 206f 7665 7277 7269 7465 2061  lt): overwrite a
-0000f9e0: 6c6c 2064 7570 6c69 6361 7465 2063 656c  ll duplicate cel
-0000f9f0: 6c73 2077 6974 6820 6f6e 6520 6f66 2074  ls with one of t
-0000fa00: 6865 2064 7570 6c69 6361 7465 7320 2861  he duplicates (a
-0000fa10: 7262 6974 7261 7269 6c79 292e 0a20 2020  rbitrarily)..   
-0000fa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa30: 2022 6572 726f 7222 3a20 7468 726f 7720   "error": throw 
-0000fa40: 6120 5661 6c75 6545 7272 6f72 2077 6865  a ValueError whe
-0000fa50: 6e20 6174 7465 6d70 7469 6e67 2074 6f20  n attempting to 
-0000fa60: 7772 6974 6520 6120 6764 7320 7769 7468  write a gds with
-0000fa70: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
-0000fa80: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000fa90: 2020 2020 2020 226f 7665 7277 7269 7465        "overwrite
-0000faa0: 223a 206f 7665 7277 7269 7465 2061 6c6c  ": overwrite all
-0000fab0: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
-0000fac0: 2077 6974 6820 6f6e 6520 6f66 2074 6865   with one of the
-0000fad0: 2064 7570 6c69 6361 7465 732c 2077 6974   duplicates, wit
-0000fae0: 686f 7574 2077 6172 6e69 6e67 2e0a 2020  hout warning..  
-0000faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb00: 2020 4e6f 6e65 3a20 646f 206e 6f74 2074    None: do not t
-0000fb10: 7279 2074 6f20 7265 736f 6c76 6520 2861  ry to resolve (a
-0000fb20: 7420 796f 7572 206f 776e 2072 6973 6b21  t your own risk!
-0000fb30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000fb40: 2020 666c 6174 7465 6e5f 696e 7661 6c69    flatten_invali
-0000fb50: 645f 7265 6673 3a20 666c 6174 7465 6e73  d_refs: flattens
-0000fb60: 2063 6f6d 706f 6e65 6e74 2072 6566 6572   component refer
-0000fb70: 656e 6365 7320 7768 6963 6820 6861 7665  ences which have
-0000fb80: 2069 6e76 616c 6964 2074 7261 6e73 666f   invalid transfo
-0000fb90: 726d 6174 696f 6e73 2e0a 2020 2020 2020  rmations..      
-0000fba0: 2020 2020 2020 2020 2020 6d61 785f 706f            max_po
-0000fbb0: 696e 7473 3a20 4d61 7869 6d61 6c20 6e75  ints: Maximal nu
-0000fbc0: 6d62 6572 206f 6620 7665 7274 6963 6573  mber of vertices
-0000fbd0: 2070 6572 2070 6f6c 7967 6f6e 2e20 506f   per polygon. Po
-0000fbe0: 6c79 676f 6e73 2077 6974 6820 6d6f 7265  lygons with more
-0000fbf0: 2076 6572 7469 6365 7320 7468 6174 2074   vertices that t
-0000fc00: 6869 7320 6172 6520 6175 746f 6d61 7469  his are automati
-0000fc10: 6361 6c6c 7920 6672 6163 7475 7265 642e  cally fractured.
-0000fc20: 0a0a 2020 2020 2020 2020 2020 2020 4f61  ..            Oa
-0000fc30: 7369 7320 7365 7474 696e 6773 3a0a 2020  sis settings:.  
-0000fc40: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000fc50: 6d70 7265 7373 696f 6e5f 6c65 7665 6c3a  mpression_level:
-0000fc60: 204c 6576 656c 206f 6620 636f 6d70 7265   Level of compre
-0000fc70: 7373 696f 6e20 666f 7220 6365 6c6c 7320  ssion for cells 
-0000fc80: 2862 6574 7765 656e 2030 2061 6e64 2039  (between 0 and 9
-0000fc90: 292e 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000fca0: 2020 2020 2020 2053 6574 7469 6e67 2074         Setting t
-0000fcb0: 6f20 3020 7769 6c6c 2064 6973 6162 6c65  o 0 will disable
-0000fcc0: 2063 656c 6c20 636f 6d70 7265 7373 696f   cell compressio
-0000fcd0: 6e2c 2031 2067 6976 6573 2074 6865 2062  n, 1 gives the b
-0000fce0: 6573 7420 7370 6565 6420 616e 6420 392c  est speed and 9,
-0000fcf0: 2074 6865 2062 6573 7420 636f 6d70 7265   the best compre
-0000fd00: 7373 696f 6e2e 0a20 2020 2020 2020 2020  ssion..         
-0000fd10: 2020 2020 2020 2064 6574 6563 745f 7265         detect_re
-0000fd20: 6374 616e 676c 6573 3a20 5374 6f72 6520  ctangles: Store 
-0000fd30: 7265 6374 616e 676c 6573 2069 6e20 636f  rectangles in co
-0000fd40: 6d70 7265 7373 6564 2066 6f72 6d61 742e  mpressed format.
-0000fd50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fd60: 2064 6574 6563 745f 7472 6170 657a 6f69   detect_trapezoi
-0000fd70: 6473 3a20 5374 6f72 6520 7472 6170 657a  ds: Store trapez
-0000fd80: 6f69 6473 2069 6e20 636f 6d70 7265 7373  oids in compress
-0000fd90: 6564 2066 6f72 6d61 742e 0a20 2020 2020  ed format..     
-0000fda0: 2020 2020 2020 2020 2020 2063 6972 636c             circl
-0000fdb0: 655f 746f 6c65 7261 6e63 653a 2054 6f6c  e_tolerance: Tol
-0000fdc0: 6572 616e 6365 2066 6f72 2064 6574 6563  erance for detec
-0000fdd0: 7469 6e67 2063 6972 636c 6573 2e20 4966  ting circles. If
-0000fde0: 206c 6573 7320 6f72 2065 7175 616c 2074   less or equal t
-0000fdf0: 6f20 302c 206e 6f20 6465 7465 6374 696f  o 0, no detectio
-0000fe00: 6e20 6973 2070 6572 666f 726d 6564 2e20  n is performed. 
-0000fe10: 4369 7263 6c65 7320 6172 6520 7374 6f72  Circles are stor
-0000fe20: 6564 2069 6e20 636f 6d70 7265 7373 6564  ed in compressed
-0000fe30: 2066 6f72 6d61 742e 0a20 2020 2020 2020   format..       
-0000fe40: 2020 2020 2020 2020 2076 616c 6964 6174           validat
-0000fe50: 696f 6e20 2822 6372 6333 3222 2c20 2263  ion ("crc32", "c
-0000fe60: 6865 636b 7375 6d33 3222 2c20 4e6f 6e65  hecksum32", None
-0000fe70: 293a 2074 7970 6520 6f66 2076 616c 6964  ): type of valid
-0000fe80: 6174 696f 6e20 746f 2069 6e63 6c75 6465  ation to include
-0000fe90: 2069 6e20 7468 6520 7361 7665 6420 6669   in the saved fi
-0000fea0: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
-0000feb0: 2020 2020 7374 616e 6461 7264 5f70 726f      standard_pro
-0000fec0: 7065 7274 6965 733a 2053 746f 7265 2073  perties: Store s
-0000fed0: 7461 6e64 6172 6420 4f41 5349 5320 7072  tandard OASIS pr
-0000fee0: 6f70 6572 7469 6573 2069 6e20 7468 6520  operties in the 
-0000fef0: 6669 6c65 2e0a 0a20 2020 2020 2020 2022  file...        "
-0000ff00: 2222 0a0a 2020 2020 2020 2020 6672 6f6d  ""..        from
-0000ff10: 2067 6473 6661 6374 6f72 792e 7064 6b20   gdsfactory.pdk 
-0000ff20: 696d 706f 7274 2067 6574 5f61 6374 6976  import get_activ
-0000ff30: 655f 7064 6b0a 0a20 2020 2020 2020 2069  e_pdk..        i
-0000ff40: 6620 6764 7370 6174 6820 616e 6420 6764  f gdspath and gd
-0000ff50: 7364 6972 3a0a 2020 2020 2020 2020 2020  sdir:.          
-0000ff60: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
-0000ff70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ff80: 2022 6764 7370 6174 6820 616e 6420 6764   "gdspath and gd
-0000ff90: 7364 6972 2068 6176 6520 626f 7468 2062  sdir have both b
-0000ffa0: 6565 6e20 7370 6563 6966 6965 642e 2067  een specified. g
-0000ffb0: 6473 7061 7468 2077 696c 6c20 7461 6b65  dspath will take
-0000ffc0: 2070 7265 6365 6465 6e63 6520 616e 6420   precedence and 
-0000ffd0: 6764 7364 6972 2077 696c 6c20 6265 2069  gdsdir will be i
-0000ffe0: 676e 6f72 6564 2e22 2c0a 2020 2020 2020  gnored.",.      
-0000fff0: 2020 2020 2020 2020 2020 7374 6163 6b6c            stackl
-00010000: 6576 656c 3d33 2c0a 2020 2020 2020 2020  evel=3,.        
-00010010: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
-00010020: 6566 6175 6c74 5f73 6574 7469 6e67 7320  efault_settings 
-00010030: 3d20 6765 745f 6163 7469 7665 5f70 646b  = get_active_pdk
-00010040: 2829 2e67 6473 5f77 7269 7465 5f73 6574  ().gds_write_set
-00010050: 7469 6e67 730a 2020 2020 2020 2020 6465  tings.        de
-00010060: 6661 756c 745f 6f61 7369 735f 7365 7474  fault_oasis_sett
-00010070: 696e 6773 203d 2067 6574 5f61 6374 6976  ings = get_activ
-00010080: 655f 7064 6b28 292e 6f61 7369 735f 7365  e_pdk().oasis_se
-00010090: 7474 696e 6773 0a0a 2020 2020 2020 2020  ttings..        
-000100a0: 6578 706c 6963 6974 5f67 6473 5f73 6574  explicit_gds_set
-000100b0: 7469 6e67 7320 3d20 7b0a 2020 2020 2020  tings = {.      
-000100c0: 2020 2020 2020 6b3a 2076 0a20 2020 2020        k: v.     
-000100d0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-000100e0: 696e 206b 7761 7267 732e 6974 656d 7328  in kwargs.items(
-000100f0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00010100: 2076 2069 7320 6e6f 7420 4e6f 6e65 2061   v is not None a
-00010110: 6e64 206b 2069 6e20 6465 6661 756c 745f  nd k in default_
-00010120: 7365 7474 696e 6773 2e6d 6f64 656c 5f64  settings.model_d
-00010130: 756d 7028 290a 2020 2020 2020 2020 7d0a  ump().        }.
-00010140: 2020 2020 2020 2020 6578 706c 6963 6974          explicit
-00010150: 5f6f 6173 5f73 6574 7469 6e67 7320 3d20  _oas_settings = 
-00010160: 7b0a 2020 2020 2020 2020 2020 2020 6b3a  {.            k:
-00010170: 2076 0a20 2020 2020 2020 2020 2020 2066   v.            f
-00010180: 6f72 206b 2c20 7620 696e 206b 7761 7267  or k, v in kwarg
-00010190: 732e 6974 656d 7328 290a 2020 2020 2020  s.items().      
-000101a0: 2020 2020 2020 6966 2076 2069 7320 6e6f        if v is no
-000101b0: 7420 4e6f 6e65 2061 6e64 206b 2069 6e20  t None and k in 
-000101c0: 6465 6661 756c 745f 6f61 7369 735f 7365  default_oasis_se
-000101d0: 7474 696e 6773 2e6d 6f64 656c 5f64 756d  ttings.model_dum
-000101e0: 7028 290a 2020 2020 2020 2020 7d0a 2020  p().        }.  
-000101f0: 2020 2020 2020 2320 7570 6461 7465 2074        # update t
-00010200: 6865 2077 7269 7465 2073 6574 7469 6e67  he write setting
-00010210: 7320 7769 7468 2061 6e79 2073 6574 7469  s with any setti
-00010220: 6e67 7320 6578 706c 6963 6974 6c79 2070  ngs explicitly p
-00010230: 6173 7365 640a 2020 2020 2020 2020 7772  assed.        wr
-00010240: 6974 655f 7365 7474 696e 6773 203d 2064  ite_settings = d
-00010250: 6566 6175 6c74 5f73 6574 7469 6e67 732e  efault_settings.
-00010260: 6d6f 6465 6c5f 636f 7079 2875 7064 6174  model_copy(updat
-00010270: 653d 6578 706c 6963 6974 5f67 6473 5f73  e=explicit_gds_s
-00010280: 6574 7469 6e67 7329 0a20 2020 2020 2020  ettings).       
-00010290: 206f 6173 6973 5f73 6574 7469 6e67 7320   oasis_settings 
-000102a0: 3d20 6465 6661 756c 745f 6f61 7369 735f  = default_oasis_
-000102b0: 7365 7474 696e 6773 2e6d 6f64 656c 5f63  settings.model_c
-000102c0: 6f70 7928 7570 6461 7465 3d65 7870 6c69  opy(update=expli
-000102d0: 6369 745f 6f61 735f 7365 7474 696e 6773  cit_oas_settings
-000102e0: 290a 0a20 2020 2020 2020 205f 6368 6563  )..        _chec
-000102f0: 6b5f 756e 6361 6368 6564 5f63 6f6d 706f  k_uncached_compo
-00010300: 6e65 6e74 7328 0a20 2020 2020 2020 2020  nents(.         
-00010310: 2020 2063 6f6d 706f 6e65 6e74 3d73 656c     component=sel
-00010320: 662c 206d 6f64 653d 7772 6974 655f 7365  f, mode=write_se
-00010330: 7474 696e 6773 2e6f 6e5f 756e 6361 6368  ttings.on_uncach
-00010340: 6564 5f63 6f6d 706f 6e65 6e74 0a20 2020  ed_component.   
-00010350: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00010360: 6966 2077 7269 7465 5f73 6574 7469 6e67  if write_setting
-00010370: 732e 666c 6174 7465 6e5f 696e 7661 6c69  s.flatten_invali
-00010380: 645f 7265 6673 3a0a 2020 2020 2020 2020  d_refs:.        
-00010390: 2020 2020 746f 705f 6365 6c6c 203d 2066      top_cell = f
-000103a0: 6c61 7474 656e 5f69 6e76 616c 6964 5f72  latten_invalid_r
-000103b0: 6566 735f 7265 6375 7273 6976 6528 7365  efs_recursive(se
-000103c0: 6c66 290a 2020 2020 2020 2020 656c 7365  lf).        else
-000103d0: 3a0a 2020 2020 2020 2020 2020 2020 746f  :.            to
-000103e0: 705f 6365 6c6c 203d 2073 656c 660a 0a20  p_cell = self.. 
-000103f0: 2020 2020 2020 2067 6473 6469 7220 3d20         gdsdir = 
-00010400: 6764 7364 6972 206f 7220 4744 5344 4952  gdsdir or GDSDIR
-00010410: 5f54 454d 500a 2020 2020 2020 2020 6764  _TEMP.        gd
-00010420: 7364 6972 203d 2070 6174 686c 6962 2e50  sdir = pathlib.P
-00010430: 6174 6828 6764 7364 6972 290a 2020 2020  ath(gdsdir).    
-00010440: 2020 2020 6966 2077 6974 685f 6f61 7369      if with_oasi
-00010450: 733a 0a20 2020 2020 2020 2020 2020 2067  s:.            g
-00010460: 6473 7061 7468 203d 2067 6473 7061 7468  dspath = gdspath
-00010470: 206f 7220 6764 7364 6972 202f 2066 227b   or gdsdir / f"{
-00010480: 746f 705f 6365 6c6c 2e6e 616d 657d 2e6f  top_cell.name}.o
-00010490: 6173 220a 2020 2020 2020 2020 656c 7365  as".        else
-000104a0: 3a0a 2020 2020 2020 2020 2020 2020 6764  :.            gd
-000104b0: 7370 6174 6820 3d20 6764 7370 6174 6820  spath = gdspath 
-000104c0: 6f72 2067 6473 6469 7220 2f20 6622 7b74  or gdsdir / f"{t
-000104d0: 6f70 5f63 656c 6c2e 6e61 6d65 7d2e 6764  op_cell.name}.gd
-000104e0: 7322 0a20 2020 2020 2020 2067 6473 7061  s".        gdspa
-000104f0: 7468 203d 2070 6174 686c 6962 2e50 6174  th = pathlib.Pat
-00010500: 6828 6764 7370 6174 6829 0a20 2020 2020  h(gdspath).     
-00010510: 2020 2067 6473 6469 7220 3d20 6764 7370     gdsdir = gdsp
-00010520: 6174 682e 7061 7265 6e74 0a20 2020 2020  ath.parent.     
-00010530: 2020 2067 6473 6469 722e 6d6b 6469 7228     gdsdir.mkdir(
-00010540: 6578 6973 745f 6f6b 3d54 7275 652c 2070  exist_ok=True, p
-00010550: 6172 656e 7473 3d54 7275 6529 0a0a 2020  arents=True)..  
-00010560: 2020 2020 2020 6365 6c6c 7320 3d20 746f        cells = to
-00010570: 705f 6365 6c6c 2e67 6574 5f64 6570 656e  p_cell.get_depen
-00010580: 6465 6e63 6965 7328 7265 6375 7273 6976  dencies(recursiv
-00010590: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-000105a0: 6365 6c6c 5f6e 616d 6573 203d 205b 6365  cell_names = [ce
-000105b0: 6c6c 2e6e 616d 6520 666f 7220 6365 6c6c  ll.name for cell
-000105c0: 2069 6e20 6c69 7374 2863 656c 6c73 295d   in list(cells)]
-000105d0: 0a20 2020 2020 2020 2063 656c 6c5f 6e61  .        cell_na
-000105e0: 6d65 735f 756e 6971 7565 203d 2073 6574  mes_unique = set
-000105f0: 2863 656c 6c5f 6e61 6d65 7329 0a0a 2020  (cell_names)..  
-00010600: 2020 2020 2020 6966 206c 656e 2863 656c        if len(cel
-00010610: 6c5f 6e61 6d65 7329 2021 3d20 6c65 6e28  l_names) != len(
-00010620: 7365 7428 6365 6c6c 5f6e 616d 6573 2929  set(cell_names))
-00010630: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00010640: 7220 6365 6c6c 5f6e 616d 6520 696e 2063  r cell_name in c
-00010650: 656c 6c5f 6e61 6d65 735f 756e 6971 7565  ell_names_unique
-00010660: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010670: 2020 6365 6c6c 5f6e 616d 6573 2e72 656d    cell_names.rem
-00010680: 6f76 6528 6365 6c6c 5f6e 616d 6529 0a0a  ove(cell_name)..
-00010690: 2020 2020 2020 2020 2020 2020 6966 2077              if w
-000106a0: 7269 7465 5f73 6574 7469 6e67 732e 6f6e  rite_settings.on
-000106b0: 5f64 7570 6c69 6361 7465 5f63 656c 6c20  _duplicate_cell 
-000106c0: 3d3d 2022 6572 726f 7222 3a0a 2020 2020  == "error":.    
-000106d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000106e0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-000106f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010700: 2020 6622 4475 706c 6963 6174 6564 2063    f"Duplicated c
-00010710: 656c 6c20 6e61 6d65 7320 696e 207b 746f  ell names in {to
-00010720: 705f 6365 6c6c 2e6e 616d 6521 727d 3a20  p_cell.name!r}: 
-00010730: 7b63 656c 6c5f 6e61 6d65 7321 727d 220a  {cell_names!r}".
-00010740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010750: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00010760: 6966 2077 7269 7465 5f73 6574 7469 6e67  if write_setting
-00010770: 732e 6f6e 5f64 7570 6c69 6361 7465 5f63  s.on_duplicate_c
-00010780: 656c 6c20 696e 207b 2277 6172 6e22 2c20  ell in {"warn", 
-00010790: 226f 7665 7277 7269 7465 227d 3a0a 2020  "overwrite"}:.  
-000107a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000107b0: 2077 7269 7465 5f73 6574 7469 6e67 732e   write_settings.
-000107c0: 6f6e 5f64 7570 6c69 6361 7465 5f63 656c  on_duplicate_cel
-000107d0: 6c20 3d3d 2022 7761 726e 223a 0a20 2020  l == "warn":.   
-000107e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107f0: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
-00010800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010810: 2020 2020 2020 2020 6622 4475 706c 6963          f"Duplic
-00010820: 6174 6564 2063 656c 6c20 6e61 6d65 7320  ated cell names 
-00010830: 696e 207b 746f 705f 6365 6c6c 2e6e 616d  in {top_cell.nam
-00010840: 6521 727d 3a20 207b 6365 6c6c 5f6e 616d  e!r}:  {cell_nam
-00010850: 6573 7d22 2c0a 2020 2020 2020 2020 2020  es}",.          
-00010860: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00010870: 6163 6b6c 6576 656c 3d33 2c0a 2020 2020  acklevel=3,.    
-00010880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010890: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000108a0: 2020 6365 6c6c 735f 6469 6374 203d 207b    cells_dict = {
-000108b0: 6365 6c6c 2e6e 616d 653a 2063 656c 6c2e  cell.name: cell.
-000108c0: 5f63 656c 6c20 666f 7220 6365 6c6c 2069  _cell for cell i
-000108d0: 6e20 6365 6c6c 737d 0a20 2020 2020 2020  n cells}.       
-000108e0: 2020 2020 2020 2020 2063 656c 6c73 203d           cells =
-000108f0: 2063 656c 6c73 5f64 6963 742e 7661 6c75   cells_dict.valu
-00010900: 6573 2829 0a20 2020 2020 2020 2020 2020  es().           
-00010910: 2065 6c69 6620 7772 6974 655f 7365 7474   elif write_sett
-00010920: 696e 6773 2e6f 6e5f 6475 706c 6963 6174  ings.on_duplicat
-00010930: 655f 6365 6c6c 2069 7320 6e6f 7420 4e6f  e_cell is not No
-00010940: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00010950: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00010960: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00010970: 2020 2020 2020 2020 2020 6622 6f6e 5f64            f"on_d
-00010980: 7570 6c69 6361 7465 5f63 656c 6c3a 207b  uplicate_cell: {
-00010990: 7772 6974 655f 7365 7474 696e 6773 2e6f  write_settings.o
-000109a0: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
-000109b0: 2172 7d20 6e6f 7420 696e 2028 4e6f 6e65  !r} not in (None
-000109c0: 2c20 7761 726e 2c20 6572 726f 722c 206f  , warn, error, o
-000109d0: 7665 7277 7269 7465 2922 0a20 2020 2020  verwrite)".     
-000109e0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000109f0: 2020 2020 2020 616c 6c5f 6365 6c6c 7320        all_cells 
-00010a00: 3d20 5b74 6f70 5f63 656c 6c2e 5f63 656c  = [top_cell._cel
-00010a10: 6c5d 202b 2073 6f72 7465 6428 6365 6c6c  l] + sorted(cell
-00010a20: 732c 206b 6579 3d6c 616d 6264 6120 6363  s, key=lambda cc
-00010a30: 3a20 6363 2e6e 616d 6529 0a0a 2020 2020  : cc.name)..    
-00010a40: 2020 2020 6e6f 5f6e 616d 655f 6365 6c6c      no_name_cell
-00010a50: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-00010a60: 2020 6365 6c6c 2e6e 616d 6520 666f 7220    cell.name for 
-00010a70: 6365 6c6c 2069 6e20 616c 6c5f 6365 6c6c  cell in all_cell
-00010a80: 7320 6966 2063 656c 6c2e 6e61 6d65 2e73  s if cell.name.s
-00010a90: 7461 7274 7377 6974 6828 2255 6e6e 616d  tartswith("Unnam
-00010aa0: 6564 2229 0a20 2020 2020 2020 205d 0a0a  ed").        ]..
-00010ab0: 2020 2020 2020 2020 6966 206e 6f5f 6e61          if no_na
-00010ac0: 6d65 5f63 656c 6c73 3a0a 2020 2020 2020  me_cells:.      
-00010ad0: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
-00010ae0: 6172 6e28 0a20 2020 2020 2020 2020 2020  arn(.           
-00010af0: 2020 2020 2066 2255 6e6e 616d 6564 2063       f"Unnamed c
-00010b00: 656c 6c73 2c20 7b6c 656e 286e 6f5f 6e61  ells, {len(no_na
-00010b10: 6d65 5f63 656c 6c73 297d 2069 6e20 7b74  me_cells)} in {t
-00010b20: 6f70 5f63 656c 6c2e 6e61 6d65 2172 7d22  op_cell.name!r}"
-00010b30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010b40: 2020 7374 6163 6b6c 6576 656c 3d33 2c0a    stacklevel=3,.
-00010b50: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00010b60: 2020 2020 2020 2023 2066 6f72 2063 656c         # for cel
-00010b70: 6c20 696e 2061 6c6c 5f63 656c 6c73 3a0a  l in all_cells:.
-00010b80: 2020 2020 2020 2020 2320 2020 2020 7072          #     pr
-00010b90: 696e 7428 6365 6c6c 2e6e 616d 652c 2074  int(cell.name, t
-00010ba0: 7970 6528 6365 6c6c 2929 0a0a 2020 2020  ype(cell))..    
-00010bb0: 2020 2020 6c69 6220 3d20 6764 7374 6b2e      lib = gdstk.
-00010bc0: 4c69 6272 6172 7928 0a20 2020 2020 2020  Library(.       
-00010bd0: 2020 2020 206e 616d 653d 7772 6974 655f       name=write_
-00010be0: 7365 7474 696e 6773 2e6c 6962 5f6e 616d  settings.lib_nam
-00010bf0: 652c 0a20 2020 2020 2020 2020 2020 2075  e,.            u
-00010c00: 6e69 743d 7772 6974 655f 7365 7474 696e  nit=write_settin
-00010c10: 6773 2e75 6e69 742c 0a20 2020 2020 2020  gs.unit,.       
-00010c20: 2020 2020 2070 7265 6369 7369 6f6e 3d77       precision=w
-00010c30: 7269 7465 5f73 6574 7469 6e67 732e 7072  rite_settings.pr
-00010c40: 6563 6973 696f 6e2c 0a20 2020 2020 2020  ecision,.       
-00010c50: 2029 0a20 2020 2020 2020 206c 6962 2e61   ).        lib.a
-00010c60: 6464 2874 6f70 5f63 656c 6c2e 5f63 656c  dd(top_cell._cel
-00010c70: 6c29 0a20 2020 2020 2020 206c 6962 2e61  l).        lib.a
-00010c80: 6464 282a 746f 705f 6365 6c6c 2e5f 6365  dd(*top_cell._ce
-00010c90: 6c6c 2e64 6570 656e 6465 6e63 6965 7328  ll.dependencies(
-00010ca0: 5472 7565 2929 0a0a 2020 2020 2020 2020  True))..        
-00010cb0: 6966 2077 6974 685f 6f61 7369 733a 0a20  if with_oasis:. 
-00010cc0: 2020 2020 2020 2020 2020 206c 6962 2e77             lib.w
-00010cd0: 7269 7465 5f6f 6173 2867 6473 7061 7468  rite_oas(gdspath
-00010ce0: 2c20 2a2a 6f61 7369 735f 7365 7474 696e  , **oasis_settin
-00010cf0: 6773 2e64 6963 7428 2929 0a20 2020 2020  gs.dict()).     
-00010d00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00010d10: 2020 2020 206c 6962 2e77 7269 7465 5f67       lib.write_g
-00010d20: 6473 280a 2020 2020 2020 2020 2020 2020  ds(.            
-00010d30: 2020 2020 6764 7370 6174 682c 2074 696d      gdspath, tim
-00010d40: 6573 7461 6d70 3d74 696d 6573 7461 6d70  estamp=timestamp
-00010d50: 2c20 6d61 785f 706f 696e 7473 3d77 7269  , max_points=wri
-00010d60: 7465 5f73 6574 7469 6e67 732e 6d61 785f  te_settings.max_
-00010d70: 706f 696e 7473 0a20 2020 2020 2020 2020  points.         
-00010d80: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
-00010d90: 6c6f 6767 696e 673a 0a20 2020 2020 2020  logging:.       
-00010da0: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
-00010db0: 2866 2257 726f 7465 2074 6f20 7b73 7472  (f"Wrote to {str
-00010dc0: 2867 6473 7061 7468 2921 727d 2229 0a20  (gdspath)!r}"). 
-00010dd0: 2020 2020 2020 2069 6620 7769 7468 5f6d         if with_m
-00010de0: 6574 6164 6174 613a 0a20 2020 2020 2020  etadata:.       
-00010df0: 2020 2020 206d 6574 6164 6174 6120 3d20       metadata = 
-00010e00: 6764 7370 6174 682e 7769 7468 5f73 7566  gdspath.with_suf
-00010e10: 6669 7828 222e 796d 6c22 290a 2020 2020  fix(".yml").    
-00010e20: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
-00010e30: 2e77 7269 7465 5f74 6578 7428 7365 6c66  .write_text(self
-00010e40: 2e74 6f5f 7961 6d6c 2877 6974 685f 6365  .to_yaml(with_ce
-00010e50: 6c6c 733d 5472 7565 2c20 7769 7468 5f70  lls=True, with_p
-00010e60: 6f72 7473 3d54 7275 6529 290a 2020 2020  orts=True)).    
-00010e70: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-00010e80: 6e66 6f28 6622 5772 6974 6520 5941 4d4c  nfo(f"Write YAML
-00010e90: 206d 6574 6164 6174 6120 746f 207b 7374   metadata to {st
-00010ea0: 7228 6d65 7461 6461 7461 2921 727d 2229  r(metadata)!r}")
-00010eb0: 0a0a 2020 2020 2020 2020 6966 2077 6974  ..        if wit
-00010ec0: 685f 6e65 746c 6973 743a 0a20 2020 2020  h_netlist:.     
-00010ed0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00010ee0: 2020 2020 2020 2053 6176 6573 2074 6865         Saves the
-00010ef0: 206e 6574 6c69 7374 5f66 756e 6374 696f   netlist_functio
-00010f00: 6e20 6f75 7470 7574 2074 6f20 6120 6a73  n output to a js
-00010f10: 6f6e 2066 696c 652e 0a20 2020 2020 2020  on file..       
-00010f20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00010f30: 2020 2020 2069 6d70 6f72 7420 6a73 6f6e       import json
-00010f40: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00010f50: 206e 6574 6c69 7374 5f66 756e 6374 696f   netlist_functio
-00010f60: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
-00010f70: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-00010f80: 6764 7366 6163 746f 7279 2e67 6574 5f6e  gdsfactory.get_n
-00010f90: 6574 6c69 7374 2069 6d70 6f72 7420 6765  etlist import ge
-00010fa0: 745f 6e65 746c 6973 740a 0a20 2020 2020  t_netlist..     
-00010fb0: 2020 2020 2020 2020 2020 206e 6574 6c69             netli
-00010fc0: 7374 5f66 756e 6374 696f 6e20 3d20 6765  st_function = ge
-00010fd0: 745f 6e65 746c 6973 740a 0a20 2020 2020  t_netlist..     
-00010fe0: 2020 2020 2020 206e 6574 6c69 7374 5f70         netlist_p
-00010ff0: 6174 6820 3d20 6764 7370 6174 682e 7769  ath = gdspath.wi
-00011000: 7468 5f73 7566 6669 7828 222e 6a73 6f6e  th_suffix(".json
-00011010: 2229 0a20 2020 2020 2020 2020 2020 206e  ").            n
-00011020: 6574 6c69 7374 5f64 6963 7469 6f6e 6172  etlist_dictionar
-00011030: 7920 3d20 6e65 746c 6973 745f 6675 6e63  y = netlist_func
-00011040: 7469 6f6e 2863 6f6d 706f 6e65 6e74 3d73  tion(component=s
-00011050: 656c 662c 202a 2a6b 7761 7267 7329 0a20  elf, **kwargs). 
-00011060: 2020 2020 2020 2020 2020 206e 6574 6c69             netli
-00011070: 7374 5f70 6174 682e 7772 6974 655f 7465  st_path.write_te
-00011080: 7874 286a 736f 6e2e 6475 6d70 7328 6e65  xt(json.dumps(ne
-00011090: 746c 6973 745f 6469 6374 696f 6e61 7279  tlist_dictionary
-000110a0: 2c20 696e 6465 6e74 3d32 2929 0a0a 2020  , indent=2))..  
-000110b0: 2020 2020 2020 434f 4e46 2e6c 6173 745f        CONF.last_
-000110c0: 7361 7665 645f 6669 6c65 732e 6170 7065  saved_files.appe
-000110d0: 6e64 2867 6473 7061 7468 290a 2020 2020  nd(gdspath).    
-000110e0: 2020 2020 7265 7475 726e 2067 6473 7061      return gdspa
-000110f0: 7468 0a0a 2020 2020 6465 6620 7772 6974  th..    def writ
-00011100: 655f 6764 7328 0a20 2020 2020 2020 2073  e_gds(.        s
-00011110: 656c 662c 0a20 2020 2020 2020 2067 6473  elf,.        gds
-00011120: 7061 7468 3a20 5061 7468 5479 7065 207c  path: PathType |
-00011130: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00011140: 2020 2020 2020 6764 7364 6972 3a20 5061        gdsdir: Pa
-00011150: 7468 5479 7065 207c 204e 6f6e 6520 3d20  thType | None = 
-00011160: 4e6f 6e65 2c0a 2020 2020 2020 2020 2a2a  None,.        **
-00011170: 6b77 6172 6773 2c0a 2020 2020 2920 2d3e  kwargs,.    ) ->
-00011180: 2050 6174 683a 0a20 2020 2020 2020 2022   Path:.        "
-00011190: 2222 5772 6974 6520 636f 6d70 6f6e 656e  ""Write componen
-000111a0: 7420 746f 2047 4453 2061 6e64 2072 6574  t to GDS and ret
-000111b0: 7572 6e73 2067 6473 7061 7468 2e0a 0a20  urns gdspath... 
-000111c0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-000111d0: 2020 2020 2020 2020 2067 6473 7061 7468           gdspath
-000111e0: 3a20 4744 5320 6669 6c65 2070 6174 6820  : GDS file path 
-000111f0: 746f 2077 7269 7465 2074 6f2e 0a20 2020  to write to..   
-00011200: 2020 2020 2020 2020 2067 6473 6469 723a           gdsdir:
-00011210: 2064 6972 6563 746f 7279 2066 6f72 2074   directory for t
-00011220: 6865 2047 4453 2066 696c 652e 2044 6566  he GDS file. Def
-00011230: 6175 6c74 7320 746f 202f 746d 702f 7261  aults to /tmp/ra
-00011240: 6e64 6f6d 4669 6c65 2f67 6473 6661 6374  ndomFile/gdsfact
-00011250: 6f72 792e 0a0a 2020 2020 2020 2020 4b65  ory...        Ke
-00011260: 7977 6f72 6420 4172 6773 3a0a 2020 2020  yword Args:.    
-00011270: 2020 2020 2020 2020 756e 6974 3a20 756e          unit: un
-00011280: 6974 2073 697a 6520 666f 7220 6f62 6a65  it size for obje
-00011290: 6374 7320 696e 206c 6962 7261 7279 2e20  cts in library. 
-000112a0: 3175 6d20 6279 2064 6566 6175 6c74 2e0a  1um by default..
-000112b0: 2020 2020 2020 2020 2020 2020 7072 6563              prec
-000112c0: 6973 696f 6e3a 2066 6f72 2064 696d 656e  ision: for dimen
-000112d0: 7369 6f6e 7320 696e 2074 6865 206c 6962  sions in the lib
-000112e0: 7261 7279 2028 6d29 2e20 316e 6d20 6279  rary (m). 1nm by
-000112f0: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
-00011300: 2020 2020 2020 6c6f 6767 696e 673a 2064        logging: d
-00011310: 6973 6162 6c65 2047 4453 2070 6174 6820  isable GDS path 
-00011320: 6c6f 6767 696e 672c 2066 6f72 2065 7861  logging, for exa
-00011330: 6d70 6c65 2066 6f72 2073 686f 7769 6e67  mple for showing
-00011340: 2069 7420 696e 204b 4c61 796f 7574 2e0a   it in KLayout..
-00011350: 2020 2020 2020 2020 2020 2020 6f6e 5f64              on_d
-00011360: 7570 6c69 6361 7465 5f63 656c 6c3a 2073  uplicate_cell: s
-00011370: 7065 6369 6679 2068 6f77 2074 6f20 7265  pecify how to re
-00011380: 736f 6c76 6520 6475 706c 6963 6174 652d  solve duplicate-
-00011390: 6e61 6d65 6420 6365 6c6c 732e 2043 686f  named cells. Cho
-000113a0: 6f73 6520 6f6e 6520 6f66 2074 6865 2066  ose one of the f
-000113b0: 6f6c 6c6f 7769 6e67 3a0a 2020 2020 2020  ollowing:.      
-000113c0: 2020 2020 2020 2020 2020 2277 6172 6e22            "warn"
-000113d0: 2028 6465 6661 756c 7429 3a20 6f76 6572   (default): over
-000113e0: 7772 6974 6520 616c 6c20 6475 706c 6963  write all duplic
-000113f0: 6174 6520 6365 6c6c 7320 7769 7468 206f  ate cells with o
-00011400: 6e65 206f 6620 7468 6520 6475 706c 6963  ne of the duplic
-00011410: 6174 6573 2028 6172 6269 7472 6172 696c  ates (arbitraril
-00011420: 7929 2e0a 2020 2020 2020 2020 2020 2020  y)..            
-00011430: 2020 2020 2265 7272 6f72 223a 2074 6872      "error": thr
-00011440: 6f77 2061 2056 616c 7565 4572 726f 7220  ow a ValueError 
-00011450: 7768 656e 2061 7474 656d 7074 696e 6720  when attempting 
-00011460: 746f 2077 7269 7465 2061 2067 6473 2077  to write a gds w
-00011470: 6974 6820 6475 706c 6963 6174 6520 6365  ith duplicate ce
-00011480: 6c6c 732e 0a20 2020 2020 2020 2020 2020  lls..           
-00011490: 2020 2020 2022 6f76 6572 7772 6974 6522       "overwrite"
-000114a0: 3a20 6f76 6572 7772 6974 6520 616c 6c20  : overwrite all 
-000114b0: 6475 706c 6963 6174 6520 6365 6c6c 7320  duplicate cells 
-000114c0: 7769 7468 206f 6e65 206f 6620 7468 6520  with one of the 
-000114d0: 6475 706c 6963 6174 6573 2c20 7769 7468  duplicates, with
-000114e0: 6f75 7420 7761 726e 696e 672e 0a20 2020  out warning..   
-000114f0: 2020 2020 2020 2020 206f 6e5f 756e 6361           on_unca
-00011500: 6368 6564 5f63 6f6d 706f 6e65 6e74 3a20  ched_component: 
-00011510: 4c69 7465 7261 6c5b 2277 6172 6e22 2c20  Literal["warn", 
-00011520: 2265 7272 6f72 225d 203d 2022 7761 726e  "error"] = "warn
-00011530: 220a 2020 2020 2020 2020 2020 2020 666c  ".            fl
-00011540: 6174 7465 6e5f 696e 7661 6c69 645f 7265  atten_invalid_re
-00011550: 6673 3a20 666c 6174 7465 6e73 2063 6f6d  fs: flattens com
-00011560: 706f 6e65 6e74 2072 6566 6572 656e 6365  ponent reference
-00011570: 7320 7768 6963 6820 6861 7665 2069 6e76  s which have inv
-00011580: 616c 6964 2074 7261 6e73 666f 726d 6174  alid transformat
-00011590: 696f 6e73 2e0a 2020 2020 2020 2020 2020  ions..          
-000115a0: 2020 6d61 785f 706f 696e 7473 3a20 4d61    max_points: Ma
-000115b0: 7869 6d61 6c20 6e75 6d62 6572 206f 6620  ximal number of 
-000115c0: 7665 7274 6963 6573 2070 6572 2070 6f6c  vertices per pol
-000115d0: 7967 6f6e 2e0a 2020 2020 2020 2020 2020  ygon..          
-000115e0: 2020 2020 2020 506f 6c79 676f 6e73 2077        Polygons w
-000115f0: 6974 6820 6d6f 7265 2076 6572 7469 6365  ith more vertice
-00011600: 7320 7468 6174 2074 6869 7320 6172 6520  s that this are 
-00011610: 6175 746f 6d61 7469 6361 6c6c 7920 6672  automatically fr
-00011620: 6163 7475 7265 642e 0a20 2020 2020 2020  actured..       
-00011630: 2020 2020 2077 6974 685f 6d65 7461 6461       with_metada
-00011640: 7461 3a20 7772 6974 6573 206d 6574 6164  ta: writes metad
-00011650: 6174 6120 696e 2059 414d 4c20 666f 726d  ata in YAML form
-00011660: 6174 2e0a 2020 2020 2020 2020 2020 2020  at..            
-00011670: 7769 7468 5f6e 6574 6c69 7374 3a20 7772  with_netlist: wr
-00011680: 6974 6573 2061 206e 6574 6c69 7374 2069  ites a netlist i
-00011690: 6e20 4a53 4f4e 2066 6f72 6d61 742e 0a20  n JSON format.. 
-000116a0: 2020 2020 2020 2020 2020 206e 6574 6c69             netli
-000116b0: 7374 5f66 756e 6374 696f 6e3a 2066 756e  st_function: fun
-000116c0: 6374 696f 6e20 746f 2067 656e 6572 6174  ction to generat
-000116d0: 6520 7468 6520 6e65 746c 6973 742e 0a20  e the netlist.. 
-000116e0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-000116f0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00011700: 5f77 7269 7465 5f6c 6962 7261 7279 280a  _write_library(.
-00011710: 2020 2020 2020 2020 2020 2020 6764 7370              gdsp
-00011720: 6174 683d 6764 7370 6174 682c 2067 6473  ath=gdspath, gds
-00011730: 6469 723d 6764 7364 6972 2c20 7769 7468  dir=gdsdir, with
-00011740: 5f6f 6173 6973 3d46 616c 7365 2c20 2a2a  _oasis=False, **
-00011750: 6b77 6172 6773 0a20 2020 2020 2020 2029  kwargs.        )
-00011760: 0a0a 2020 2020 6465 6620 7772 6974 655f  ..    def write_
-00011770: 6f61 7328 0a20 2020 2020 2020 2073 656c  oas(.        sel
-00011780: 662c 0a20 2020 2020 2020 2067 6473 7061  f,.        gdspa
-00011790: 7468 3a20 5061 7468 5479 7065 207c 204e  th: PathType | N
-000117a0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-000117b0: 2020 2020 6764 7364 6972 3a20 5061 7468      gdsdir: Path
-000117c0: 5479 7065 207c 204e 6f6e 6520 3d20 4e6f  Type | None = No
-000117d0: 6e65 2c0a 2020 2020 2020 2020 2a2a 6b77  ne,.        **kw
-000117e0: 6172 6773 2c0a 2020 2020 2920 2d3e 2050  args,.    ) -> P
-000117f0: 6174 683a 0a20 2020 2020 2020 2022 2222  ath:.        """
-00011800: 5772 6974 6520 636f 6d70 6f6e 656e 7420  Write component 
-00011810: 746f 2047 4453 2061 6e64 2072 6574 7572  to GDS and retur
-00011820: 6e73 2067 6473 7061 7468 2e0a 0a20 2020  ns gdspath...   
-00011830: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00011840: 2020 2020 2020 2067 6473 7061 7468 3a20         gdspath: 
-00011850: 4744 5320 6669 6c65 2070 6174 6820 746f  GDS file path to
-00011860: 2077 7269 7465 2074 6f2e 0a20 2020 2020   write to..     
-00011870: 2020 2020 2020 2067 6473 6469 723a 2064         gdsdir: d
-00011880: 6972 6563 746f 7279 2066 6f72 2074 6865  irectory for the
-00011890: 2047 4453 2066 696c 652e 2044 6566 6175   GDS file. Defau
-000118a0: 6c74 7320 746f 202f 746d 702f 7261 6e64  lts to /tmp/rand
-000118b0: 6f6d 4669 6c65 2f67 6473 6661 6374 6f72  omFile/gdsfactor
-000118c0: 792e 0a0a 2020 2020 2020 2020 4b65 7977  y...        Keyw
-000118d0: 6f72 6420 4172 6773 3a0a 2020 2020 2020  ord Args:.      
-000118e0: 2020 2020 2020 756e 6974 3a20 756e 6974        unit: unit
-000118f0: 2073 697a 6520 666f 7220 6f62 6a65 6374   size for object
-00011900: 7320 696e 206c 6962 7261 7279 2e20 3175  s in library. 1u
-00011910: 6d20 6279 2064 6566 6175 6c74 2e0a 2020  m by default..  
-00011920: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-00011930: 696f 6e3a 2066 6f72 2064 696d 656e 7369  ion: for dimensi
-00011940: 6f6e 7320 696e 2074 6865 206c 6962 7261  ons in the libra
-00011950: 7279 2028 6d29 2e20 316e 6d20 6279 2064  ry (m). 1nm by d
-00011960: 6566 6175 6c74 2e0a 2020 2020 2020 2020  efault..        
-00011970: 2020 2020 6c6f 6767 696e 673a 2064 6973      logging: dis
-00011980: 6162 6c65 2047 4453 2070 6174 6820 6c6f  able GDS path lo
-00011990: 6767 696e 672c 2066 6f72 2065 7861 6d70  gging, for examp
-000119a0: 6c65 2066 6f72 2073 686f 7769 6e67 2069  le for showing i
-000119b0: 7420 696e 204b 4c61 796f 7574 2e0a 2020  t in KLayout..  
-000119c0: 2020 2020 2020 2020 2020 6f6e 5f64 7570            on_dup
-000119d0: 6c69 6361 7465 5f63 656c 6c3a 2073 7065  licate_cell: spe
-000119e0: 6369 6679 2068 6f77 2074 6f20 7265 736f  cify how to reso
-000119f0: 6c76 6520 6475 706c 6963 6174 652d 6e61  lve duplicate-na
-00011a00: 6d65 6420 6365 6c6c 732e 2043 686f 6f73  med cells. Choos
-00011a10: 6520 6f6e 6520 6f66 2074 6865 2066 6f6c  e one of the fol
-00011a20: 6c6f 7769 6e67 3a0a 2020 2020 2020 2020  lowing:.        
-00011a30: 2020 2020 2020 2020 2277 6172 6e22 2028          "warn" (
-00011a40: 6465 6661 756c 7429 3a20 6f76 6572 7772  default): overwr
-00011a50: 6974 6520 616c 6c20 6475 706c 6963 6174  ite all duplicat
-00011a60: 6520 6365 6c6c 7320 7769 7468 206f 6e65  e cells with one
-00011a70: 206f 6620 7468 6520 6475 706c 6963 6174   of the duplicat
-00011a80: 6573 2028 6172 6269 7472 6172 696c 7929  es (arbitrarily)
-00011a90: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011aa0: 2020 2265 7272 6f72 223a 2074 6872 6f77    "error": throw
-00011ab0: 2061 2056 616c 7565 4572 726f 7220 7768   a ValueError wh
-00011ac0: 656e 2061 7474 656d 7074 696e 6720 746f  en attempting to
-00011ad0: 2077 7269 7465 2061 2067 6473 2077 6974   write a gds wit
-00011ae0: 6820 6475 706c 6963 6174 6520 6365 6c6c  h duplicate cell
-00011af0: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
-00011b00: 2020 2022 6f76 6572 7772 6974 6522 3a20     "overwrite": 
-00011b10: 6f76 6572 7772 6974 6520 616c 6c20 6475  overwrite all du
-00011b20: 706c 6963 6174 6520 6365 6c6c 7320 7769  plicate cells wi
-00011b30: 7468 206f 6e65 206f 6620 7468 6520 6475  th one of the du
-00011b40: 706c 6963 6174 6573 2c20 7769 7468 6f75  plicates, withou
-00011b50: 7420 7761 726e 696e 672e 0a20 2020 2020  t warning..     
-00011b60: 2020 2020 2020 2020 2020 204e 6f6e 653a             None:
-00011b70: 2064 6f20 6e6f 7420 7472 7920 746f 2072   do not try to r
-00011b80: 6573 6f6c 7665 2028 6174 2079 6f75 7220  esolve (at your 
-00011b90: 6f77 6e20 7269 736b 2129 0a20 2020 2020  own risk!).     
-00011ba0: 2020 2020 2020 206f 6e5f 756e 6361 6368         on_uncach
-00011bb0: 6564 5f63 6f6d 706f 6e65 6e74 3a20 4c69  ed_component: Li
-00011bc0: 7465 7261 6c5b 2277 6172 6e22 2c20 2265  teral["warn", "e
-00011bd0: 7272 6f72 225d 203d 2022 7761 726e 220a  rror"] = "warn".
-00011be0: 2020 2020 2020 2020 2020 2020 666c 6174              flat
-00011bf0: 7465 6e5f 696e 7661 6c69 645f 7265 6673  ten_invalid_refs
-00011c00: 3a20 666c 6174 7465 6e73 2063 6f6d 706f  : flattens compo
-00011c10: 6e65 6e74 2072 6566 6572 656e 6365 7320  nent references 
-00011c20: 7768 6963 6820 6861 7665 2069 6e76 616c  which have inval
-00011c30: 6964 2074 7261 6e73 666f 726d 6174 696f  id transformatio
-00011c40: 6e73 2e0a 2020 2020 2020 2020 2020 2020  ns..            
-00011c50: 636f 6d70 7265 7373 696f 6e5f 6c65 7665  compression_leve
-00011c60: 6c3a 204c 6576 656c 206f 6620 636f 6d70  l: Level of comp
-00011c70: 7265 7373 696f 6e20 666f 7220 6365 6c6c  ression for cell
-00011c80: 7320 2862 6574 7765 656e 2030 2061 6e64  s (between 0 and
-00011c90: 2039 292e 0a20 2020 2020 2020 2020 2020   9)..           
-00011ca0: 2020 2020 2053 6574 7469 6e67 2074 6f20       Setting to 
-00011cb0: 3020 7769 6c6c 2064 6973 6162 6c65 2063  0 will disable c
-00011cc0: 656c 6c20 636f 6d70 7265 7373 696f 6e2c  ell compression,
-00011cd0: 2031 2067 6976 6573 2074 6865 2062 6573   1 gives the bes
-00011ce0: 7420 7370 6565 6420 616e 6420 392c 2074  t speed and 9, t
-00011cf0: 6865 2062 6573 7420 636f 6d70 7265 7373  he best compress
-00011d00: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
-00011d10: 2064 6574 6563 745f 7265 6374 616e 676c   detect_rectangl
-00011d20: 6573 3a20 5374 6f72 6520 7265 6374 616e  es: Store rectan
-00011d30: 676c 6573 2069 6e20 636f 6d70 7265 7373  gles in compress
-00011d40: 6564 2066 6f72 6d61 742e 0a20 2020 2020  ed format..     
-00011d50: 2020 2020 2020 2064 6574 6563 745f 7472         detect_tr
-00011d60: 6170 657a 6f69 6473 3a20 5374 6f72 6520  apezoids: Store 
-00011d70: 7472 6170 657a 6f69 6473 2069 6e20 636f  trapezoids in co
-00011d80: 6d70 7265 7373 6564 2066 6f72 6d61 742e  mpressed format.
-00011d90: 0a20 2020 2020 2020 2020 2020 2063 6972  .            cir
-00011da0: 636c 655f 746f 6c65 7261 6e63 653a 2054  cle_tolerance: T
-00011db0: 6f6c 6572 616e 6365 2066 6f72 2064 6574  olerance for det
-00011dc0: 6563 7469 6e67 2063 6972 636c 6573 2e20  ecting circles. 
-00011dd0: 4966 206c 6573 7320 6f72 2065 7175 616c  If less or equal
-00011de0: 2074 6f20 302c 206e 6f20 6465 7465 6374   to 0, no detect
-00011df0: 696f 6e20 6973 2070 6572 666f 726d 6564  ion is performed
-00011e00: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011e10: 2020 4369 7263 6c65 7320 6172 6520 7374    Circles are st
-00011e20: 6f72 6564 2069 6e20 636f 6d70 7265 7373  ored in compress
-00011e30: 6564 2066 6f72 6d61 742e 0a20 2020 2020  ed format..     
-00011e40: 2020 2020 2020 2076 616c 6964 6174 696f         validatio
-00011e50: 6e20 2822 6372 6333 3222 2c20 2263 6865  n ("crc32", "che
-00011e60: 636b 7375 6d33 3222 2c20 4e6f 6e65 2920  cksum32", None) 
-00011e70: e280 9320 7479 7065 206f 6620 7661 6c69  ... type of vali
-00011e80: 6461 7469 6f6e 2074 6f20 696e 636c 7564  dation to includ
-00011e90: 6520 696e 2074 6865 2073 6176 6564 2066  e in the saved f
-00011ea0: 696c 652e 0a20 2020 2020 2020 2020 2020  ile..           
-00011eb0: 2073 7461 6e64 6172 645f 7072 6f70 6572   standard_proper
-00011ec0: 7469 6573 3a20 5374 6f72 6520 7374 616e  ties: Store stan
-00011ed0: 6461 7264 204f 4153 4953 2070 726f 7065  dard OASIS prope
-00011ee0: 7274 6965 7320 696e 2074 6865 2066 696c  rties in the fil
-00011ef0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-00011f00: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00011f10: 6c66 2e5f 7772 6974 655f 6c69 6272 6172  lf._write_librar
-00011f20: 7928 0a20 2020 2020 2020 2020 2020 2067  y(.            g
-00011f30: 6473 7061 7468 3d67 6473 7061 7468 2c0a  dspath=gdspath,.
-00011f40: 2020 2020 2020 2020 2020 2020 6764 7364              gdsd
-00011f50: 6972 3d67 6473 6469 722c 0a20 2020 2020  ir=gdsdir,.     
-00011f60: 2020 2020 2020 2077 6974 685f 6f61 7369         with_oasi
-00011f70: 733d 5472 7565 2c0a 2020 2020 2020 2020  s=True,.        
-00011f80: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
-00011f90: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-00011fa0: 2074 6f5f 6469 6374 280a 2020 2020 2020   to_dict(.      
-00011fb0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00011fc0: 6967 6e6f 7265 5f63 6f6d 706f 6e65 6e74  ignore_component
-00011fd0: 735f 7072 6566 6978 3a20 6c69 7374 5b73  s_prefix: list[s
-00011fe0: 7472 5d20 7c20 4e6f 6e65 203d 204e 6f6e  tr] | None = Non
-00011ff0: 652c 0a20 2020 2020 2020 2069 676e 6f72  e,.        ignor
-00012000: 655f 6675 6e63 7469 6f6e 735f 7072 6566  e_functions_pref
-00012010: 6978 3a20 6c69 7374 5b73 7472 5d20 7c20  ix: list[str] | 
-00012020: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00012030: 2020 2020 2077 6974 685f 6365 6c6c 733a       with_cells:
-00012040: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-00012050: 2020 2020 2020 2077 6974 685f 706f 7274         with_port
-00012060: 733a 2062 6f6f 6c20 3d20 5472 7565 2c0a  s: bool = True,.
-00012070: 2020 2020 2920 2d3e 2064 6963 745b 7374      ) -> dict[st
-00012080: 722c 2041 6e79 5d3a 0a20 2020 2020 2020  r, Any]:.       
-00012090: 2022 2222 5265 7475 726e 7320 4469 6374   """Returns Dict
-000120a0: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
-000120b0: 6f66 2061 2063 6f6d 706f 6e65 6e74 2e0a  of a component..
-000120c0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-000120d0: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
-000120e0: 655f 636f 6d70 6f6e 656e 7473 5f70 7265  e_components_pre
-000120f0: 6669 783a 2066 6f72 2063 6f6d 706f 6e65  fix: for compone
-00012100: 6e74 7320 746f 2069 676e 6f72 6520 7768  nts to ignore wh
-00012110: 656e 2065 7870 6f72 7469 6e67 2e0a 2020  en exporting..  
-00012120: 2020 2020 2020 2020 2020 6967 6e6f 7265            ignore
-00012130: 5f66 756e 6374 696f 6e73 5f70 7265 6669  _functions_prefi
-00012140: 783a 2066 6f72 2066 756e 6374 696f 6e73  x: for functions
-00012150: 2074 6f20 6967 6e6f 7265 2077 6865 6e20   to ignore when 
-00012160: 6578 706f 7274 696e 672e 0a20 2020 2020  exporting..     
-00012170: 2020 2020 2020 2077 6974 685f 6365 6c6c         with_cell
-00012180: 733a 2077 7269 7465 2063 656c 6c73 2072  s: write cells r
-00012190: 6563 7572 7369 7665 6c79 2e0a 2020 2020  ecursively..    
-000121a0: 2020 2020 2020 2020 7769 7468 5f70 6f72          with_por
-000121b0: 7473 3a20 7772 6974 6520 706f 7274 2069  ts: write port i
-000121c0: 6e66 6f72 6d61 7469 6f6e 2064 6963 742e  nformation dict.
-000121d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000121e0: 2020 2020 2064 203d 207b 7d0a 2020 2020       d = {}.    
-000121f0: 2020 2020 6966 2077 6974 685f 706f 7274      if with_port
-00012200: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-00012210: 6f72 7473 203d 207b 706f 7274 2e6e 616d  orts = {port.nam
-00012220: 653a 2070 6f72 742e 746f 5f64 6963 7428  e: port.to_dict(
-00012230: 2920 666f 7220 706f 7274 2069 6e20 7365  ) for port in se
-00012240: 6c66 2e67 6574 5f70 6f72 7473 5f6c 6973  lf.get_ports_lis
-00012250: 7428 297d 0a20 2020 2020 2020 2020 2020  t()}.           
-00012260: 2064 5b22 706f 7274 7322 5d20 3d20 706f   d["ports"] = po
-00012270: 7274 730a 0a20 2020 2020 2020 2069 6620  rts..        if 
-00012280: 7769 7468 5f63 656c 6c73 3a0a 2020 2020  with_cells:.    
-00012290: 2020 2020 2020 2020 6365 6c6c 7320 3d20          cells = 
-000122a0: 7265 6375 7273 655f 7374 7275 6374 7572  recurse_structur
-000122b0: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
-000122c0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-000122d0: 2020 2020 2020 2020 2020 6967 6e6f 7265            ignore
-000122e0: 5f66 756e 6374 696f 6e73 5f70 7265 6669  _functions_prefi
-000122f0: 783d 6967 6e6f 7265 5f66 756e 6374 696f  x=ignore_functio
-00012300: 6e73 5f70 7265 6669 782c 0a20 2020 2020  ns_prefix,.     
-00012310: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
-00012320: 655f 636f 6d70 6f6e 656e 7473 5f70 7265  e_components_pre
-00012330: 6669 783d 6967 6e6f 7265 5f63 6f6d 706f  fix=ignore_compo
-00012340: 6e65 6e74 735f 7072 6566 6978 2c0a 2020  nents_prefix,.  
-00012350: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00012360: 2020 2020 2020 2020 645b 2263 656c 6c73          d["cells
-00012370: 225d 203d 2063 6c65 616e 5f64 6963 7428  "] = clean_dict(
-00012380: 6365 6c6c 7329 0a0a 2020 2020 2020 2020  cells)..        
-00012390: 645b 226e 616d 6522 5d20 3d20 7365 6c66  d["name"] = self
-000123a0: 2e6e 616d 650a 2020 2020 2020 2020 645b  .name.        d[
-000123b0: 2273 6574 7469 6e67 7322 5d20 3d20 636c  "settings"] = cl
-000123c0: 6561 6e5f 6469 6374 2864 6963 7428 7365  ean_dict(dict(se
-000123d0: 6c66 2e73 6574 7469 6e67 7329 290a 2020  lf.settings)).  
-000123e0: 2020 2020 2020 7265 7475 726e 2064 0a0a        return d..
-000123f0: 2020 2020 6465 6620 746f 5f79 616d 6c28      def to_yaml(
-00012400: 7365 6c66 2c20 2a2a 6b77 6172 6773 2920  self, **kwargs) 
-00012410: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
-00012420: 2222 2257 7269 7465 2044 6963 7420 7265  """Write Dict re
-00012430: 7072 6573 656e 7461 7469 6f6e 206f 6620  presentation of 
-00012440: 6120 636f 6d70 6f6e 656e 7420 696e 2059  a component in Y
-00012450: 414d 4c20 666f 726d 6174 2e0a 0a20 2020  AML format...   
-00012460: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00012470: 2020 2020 2020 2069 676e 6f72 655f 636f         ignore_co
-00012480: 6d70 6f6e 656e 7473 5f70 7265 6669 783a  mponents_prefix:
-00012490: 2066 6f72 2063 6f6d 706f 6e65 6e74 7320   for components 
-000124a0: 746f 2069 676e 6f72 6520 7768 656e 2065  to ignore when e
-000124b0: 7870 6f72 7469 6e67 2e0a 2020 2020 2020  xporting..      
-000124c0: 2020 2020 2020 6967 6e6f 7265 5f66 756e        ignore_fun
-000124d0: 6374 696f 6e73 5f70 7265 6669 783a 2066  ctions_prefix: f
-000124e0: 6f72 2066 756e 6374 696f 6e73 2074 6f20  or functions to 
-000124f0: 6967 6e6f 7265 2077 6865 6e20 6578 706f  ignore when expo
-00012500: 7274 696e 672e 0a20 2020 2020 2020 2020  rting..         
-00012510: 2020 2077 6974 685f 6365 6c6c 733a 2077     with_cells: w
-00012520: 7269 7465 2063 656c 6c73 2072 6563 7572  rite cells recur
-00012530: 7369 7665 6c79 2e0a 2020 2020 2020 2020  sively..        
-00012540: 2020 2020 7769 7468 5f70 6f72 7473 3a20      with_ports: 
-00012550: 7772 6974 6520 706f 7274 2069 6e66 6f72  write port infor
-00012560: 6d61 7469 6f6e 2e0a 2020 2020 2020 2020  mation..        
-00012570: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00012580: 726e 2079 616d 6c2e 6475 6d70 2863 6c65  rn yaml.dump(cle
-00012590: 616e 5f64 6963 7428 7365 6c66 2e74 6f5f  an_dict(self.to_
-000125a0: 6469 6374 282a 2a6b 7761 7267 7329 2929  dict(**kwargs)))
-000125b0: 0a0a 2020 2020 6465 6620 6175 746f 5f72  ..    def auto_r
-000125c0: 656e 616d 655f 706f 7274 7328 7365 6c66  ename_ports(self
-000125d0: 2c20 2a2a 6b77 6172 6773 2920 2d3e 204e  , **kwargs) -> N
-000125e0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-000125f0: 5265 6e61 6d65 2070 6f72 7473 2062 7920  Rename ports by 
-00012600: 6f72 6965 6e74 6174 696f 6e20 4e53 4557  orientation NSEW
-00012610: 2028 6e6f 7274 682c 2073 6f75 7468 2c20   (north, south, 
-00012620: 6561 7374 2c20 7765 7374 292e 0a0a 2020  east, west)...  
-00012630: 2020 2020 2020 4b65 7977 6f72 6420 4172        Keyword Ar
-00012640: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00012650: 6675 6e63 7469 6f6e 3a20 746f 2072 656e  function: to ren
-00012660: 616d 6520 706f 7274 732e 0a20 2020 2020  ame ports..     
-00012670: 2020 2020 2020 2073 656c 6563 745f 706f         select_po
-00012680: 7274 735f 6f70 7469 6361 6c3a 2074 6f20  rts_optical: to 
-00012690: 7365 6c65 6374 206f 7074 6963 616c 2070  select optical p
-000126a0: 6f72 7473 2e0a 2020 2020 2020 2020 2020  orts..          
-000126b0: 2020 7365 6c65 6374 5f70 6f72 7473 5f65    select_ports_e
-000126c0: 6c65 6374 7269 6361 6c3a 2074 6f20 7365  lectrical: to se
-000126d0: 6c65 6374 2065 6c65 6374 7269 6361 6c20  lect electrical 
-000126e0: 706f 7274 732e 0a20 2020 2020 2020 2020  ports..         
-000126f0: 2020 2070 7265 6669 785f 6f70 7469 6361     prefix_optica
-00012700: 6c3a 2070 7265 6669 782e 0a20 2020 2020  l: prefix..     
-00012710: 2020 2020 2020 2070 7265 6669 785f 656c         prefix_el
-00012720: 6563 7472 6963 616c 3a20 7072 6566 6978  ectrical: prefix
-00012730: 2e0a 0a20 2020 2020 2020 202e 2e20 636f  ...        .. co
-00012740: 6465 3a3a 0a0a 2020 2020 2020 2020 2020  de::..          
-00012750: 2020 2020 2020 2020 3320 2034 0a20 2020          3  4.   
-00012760: 2020 2020 2020 2020 2020 2020 2020 5f7c                _|
-00012770: 5f5f 7c5f 0a20 2020 2020 2020 2020 2020  __|_.           
-00012780: 2020 3220 2d7c 2020 2020 2020 7c2d 2035    2 -|      |- 5
-00012790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000127a0: 207c 2020 2020 2020 7c0a 2020 2020 2020   |      |.      
-000127b0: 2020 2020 2020 2031 202d 7c5f 5f5f 5f5f         1 -|_____
-000127c0: 5f7c 2d20 360a 2020 2020 2020 2020 2020  _|- 6.          
-000127d0: 2020 2020 2020 2020 7c20 207c 0a20 2020          |  |.   
-000127e0: 2020 2020 2020 2020 2020 2020 2020 2038                 8
-000127f0: 2020 370a 2020 2020 2020 2020 2222 220a    7.        """.
-00012800: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
-00012810: 756e 6c6f 636b 6564 2829 0a20 2020 2020  unlocked().     
-00012820: 2020 2061 7574 6f5f 7265 6e61 6d65 5f70     auto_rename_p
-00012830: 6f72 7473 2873 656c 662c 202a 2a6b 7761  orts(self, **kwa
-00012840: 7267 7329 0a0a 2020 2020 6465 6620 6175  rgs)..    def au
-00012850: 746f 5f72 656e 616d 655f 706f 7274 735f  to_rename_ports_
-00012860: 636f 756e 7465 725f 636c 6f63 6b77 6973  counter_clockwis
-00012870: 6528 7365 6c66 2c20 2a2a 6b77 6172 6773  e(self, **kwargs
-00012880: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00012890: 2020 2073 656c 662e 6973 5f75 6e6c 6f63     self.is_unloc
-000128a0: 6b65 6428 290a 2020 2020 2020 2020 6175  ked().        au
-000128b0: 746f 5f72 656e 616d 655f 706f 7274 735f  to_rename_ports_
-000128c0: 636f 756e 7465 725f 636c 6f63 6b77 6973  counter_clockwis
-000128d0: 6528 7365 6c66 2c20 2a2a 6b77 6172 6773  e(self, **kwargs
-000128e0: 290a 0a20 2020 2064 6566 2061 7574 6f5f  )..    def auto_
-000128f0: 7265 6e61 6d65 5f70 6f72 7473 5f6c 6179  rename_ports_lay
-00012900: 6572 5f6f 7269 656e 7461 7469 6f6e 2873  er_orientation(s
-00012910: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
-00012920: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00012930: 7365 6c66 2e69 735f 756e 6c6f 636b 6564  self.is_unlocked
-00012940: 2829 0a20 2020 2020 2020 2061 7574 6f5f  ().        auto_
-00012950: 7265 6e61 6d65 5f70 6f72 7473 5f6c 6179  rename_ports_lay
-00012960: 6572 5f6f 7269 656e 7461 7469 6f6e 2873  er_orientation(s
-00012970: 656c 662c 202a 2a6b 7761 7267 7329 0a0a  elf, **kwargs)..
-00012980: 2020 2020 6465 6620 6175 746f 5f72 656e      def auto_ren
-00012990: 616d 655f 706f 7274 735f 6f72 6965 6e74  ame_ports_orient
-000129a0: 6174 696f 6e28 7365 6c66 2c20 2a2a 6b77  ation(self, **kw
-000129b0: 6172 6773 2920 2d3e 204e 6f6e 653a 0a20  args) -> None:. 
-000129c0: 2020 2020 2020 2022 2222 5265 6e61 6d65         """Rename
-000129d0: 2070 6f72 7473 2062 7920 6f72 6965 6e74   ports by orient
-000129e0: 6174 696f 6e20 4e53 4557 2028 6e6f 7274  ation NSEW (nort
-000129f0: 682c 2073 6f75 7468 2c20 6561 7374 2c20  h, south, east, 
-00012a00: 7765 7374 292e 0a0a 2020 2020 2020 2020  west)...        
-00012a10: 4b65 7977 6f72 6420 4172 6773 3a0a 2020  Keyword Args:.  
-00012a20: 2020 2020 2020 2020 2020 6675 6e63 7469            functi
-00012a30: 6f6e 3a20 746f 2072 656e 616d 6520 706f  on: to rename po
-00012a40: 7274 732e 0a20 2020 2020 2020 2020 2020  rts..           
-00012a50: 2073 656c 6563 745f 706f 7274 735f 6f70   select_ports_op
-00012a60: 7469 6361 6c3a 2074 6f20 7365 6c65 6374  tical: to select
-00012a70: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
-00012a80: 2020 2020 7365 6c65 6374 5f70 6f72 7473      select_ports
-00012a90: 5f65 6c65 6374 7269 6361 6c3a 0a20 2020  _electrical:.   
-00012aa0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-00012ab0: 6f70 7469 6361 6c3a 0a20 2020 2020 2020  optical:.       
-00012ac0: 2020 2020 2070 7265 6669 785f 656c 6563       prefix_elec
-00012ad0: 7472 6963 616c 3a0a 0a20 2020 2020 2020  trical:..       
-00012ae0: 202e 2e20 636f 6465 3a3a 0a0a 2020 2020   .. code::..    
-00012af0: 2020 2020 2020 2020 2020 2020 204e 3020               N0 
-00012b00: 204e 310a 2020 2020 2020 2020 2020 2020   N1.            
-00012b10: 2020 2020 207c 5f5f 5f7c 5f0a 2020 2020       |___|_.    
-00012b20: 2020 2020 2020 2020 5731 202d 7c20 2020          W1 -|   
-00012b30: 2020 207c 2d20 4531 0a20 2020 2020 2020     |- E1.       
-00012b40: 2020 2020 2020 2020 207c 2020 2020 2020           |      
-00012b50: 7c0a 2020 2020 2020 2020 2020 2020 5730  |.            W0
-00012b60: 202d 7c5f 5f5f 5f5f 5f7c 2d20 4530 0a20   -|______|- E0. 
-00012b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b80: 7c20 2020 7c0a 2020 2020 2020 2020 2020  |   |.          
-00012b90: 2020 2020 2020 5330 2020 2053 310a 2020        S0   S1.  
-00012ba0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00012bb0: 2020 7365 6c66 2e69 735f 756e 6c6f 636b    self.is_unlock
-00012bc0: 6564 2829 0a20 2020 2020 2020 2061 7574  ed().        aut
-00012bd0: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f6f  o_rename_ports_o
-00012be0: 7269 656e 7461 7469 6f6e 2873 656c 662c  rientation(self,
-00012bf0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00012c00: 6465 6620 6d6f 7665 2873 656c 662c 202a  def move(self, *
-00012c10: 6172 6773 2c20 2a2a 6b77 6172 6773 2920  args, **kwargs) 
-00012c20: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
-00012c30: 2020 2020 2020 2222 224d 616b 6520 6120        """Make a 
-00012c40: 7265 6665 7265 6e63 6520 696e 7374 6561  reference instea
-00012c50: 6422 2222 0a20 2020 2020 2020 2072 6169  d""".        rai
-00012c60: 7365 2056 616c 7565 4572 726f 7228 6d6f  se ValueError(mo
-00012c70: 7665 5f65 7272 6f72 5f6d 6573 7361 6765  ve_error_message
-00012c80: 290a 0a20 2020 2064 6566 206d 6972 726f  )..    def mirro
-00012c90: 7228 7365 6c66 2c20 7031 3a20 466c 6f61  r(self, p1: Floa
-00012ca0: 7432 203d 2028 302c 2031 292c 2070 323a  t2 = (0, 1), p2:
-00012cb0: 2046 6c6f 6174 3220 3d20 2830 2c20 3029   Float2 = (0, 0)
-00012cc0: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2043  , **kwargs) -> C
-00012cd0: 6f6d 706f 6e65 6e74 3a0a 2020 2020 2020  omponent:.      
-00012ce0: 2020 2222 2252 6574 7572 6e73 206e 6577    """Returns new
-00012cf0: 2043 6f6d 706f 6e65 6e74 2077 6974 6820   Component with 
-00012d00: 6120 6d69 7272 6f72 6564 2072 6566 6572  a mirrored refer
-00012d10: 656e 6365 2e0a 0a20 2020 2020 2020 2041  ence...        A
-00012d20: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00012d30: 2070 313a 2066 6972 7374 2070 6f69 6e74   p1: first point
-00012d40: 2074 6f20 6465 6669 6e65 206d 6972 726f   to define mirro
-00012d50: 7220 6178 6973 2e0a 2020 2020 2020 2020  r axis..        
-00012d60: 2020 2020 7032 3a20 7365 636f 6e64 2070      p2: second p
-00012d70: 6f69 6e74 2074 6f20 6465 6669 6e65 206d  oint to define m
-00012d80: 6972 726f 7220 6178 6973 2e0a 2020 2020  irror axis..    
-00012d90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00012da0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-00012db0: 6675 6e63 7469 6f6e 7320 696d 706f 7274  functions import
-00012dc0: 206d 6972 726f 720a 0a20 2020 2020 2020   mirror..       
-00012dd0: 2072 6574 7572 6e20 6d69 7272 6f72 2863   return mirror(c
-00012de0: 6f6d 706f 6e65 6e74 3d73 656c 662c 2070  omponent=self, p
-00012df0: 313d 7031 2c20 7032 3d70 322c 202a 2a6b  1=p1, p2=p2, **k
-00012e00: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
-00012e10: 726f 7461 7465 2873 656c 662c 2061 6e67  rotate(self, ang
-00012e20: 6c65 3a20 666c 6f61 7420 3d20 3930 2c20  le: float = 90, 
-00012e30: 2a2a 6b77 6172 6773 2920 2d3e 2043 6f6d  **kwargs) -> Com
-00012e40: 706f 6e65 6e74 3a0a 2020 2020 2020 2020  ponent:.        
-00012e50: 2222 2252 6574 7572 6e73 206e 6577 2063  """Returns new c
-00012e60: 6f6d 706f 6e65 6e74 2077 6974 6820 6120  omponent with a 
-00012e70: 726f 7461 7465 6420 7265 6665 7265 6e63  rotated referenc
-00012e80: 6520 746f 2074 6865 206f 7269 6769 6e61  e to the origina
-00012e90: 6c2e 0a0a 2020 2020 2020 2020 4172 6773  l...        Args
-00012ea0: 3a0a 2020 2020 2020 2020 2020 2020 616e  :.            an
-00012eb0: 676c 653a 2069 6e20 6465 6772 6565 732e  gle: in degrees.
-00012ec0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00012ed0: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-00012ee0: 746f 7279 2e66 756e 6374 696f 6e73 2069  tory.functions i
-00012ef0: 6d70 6f72 7420 726f 7461 7465 0a0a 2020  mport rotate..  
-00012f00: 2020 2020 2020 7265 7475 726e 2072 6f74        return rot
-00012f10: 6174 6528 636f 6d70 6f6e 656e 743d 7365  ate(component=se
-00012f20: 6c66 2c20 616e 676c 653d 616e 676c 652c  lf, angle=angle,
-00012f30: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00012f40: 6465 6620 6164 645f 7061 6464 696e 6728  def add_padding(
-00012f50: 7365 6c66 2c20 2a2a 6b77 6172 6773 2920  self, **kwargs) 
-00012f60: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
-00012f70: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-00012f80: 2073 616d 6520 636f 6d70 6f6e 656e 7420   same component 
-00012f90: 7769 7468 2070 6164 6469 6e67 2e0a 0a20  with padding... 
-00012fa0: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
-00012fb0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00012fc0: 2063 6f6d 706f 6e65 6e74 3a20 666f 7220   component: for 
-00012fd0: 7061 6464 696e 672e 0a20 2020 2020 2020  padding..       
-00012fe0: 2020 2020 206c 6179 6572 733a 206c 6973       layers: lis
-00012ff0: 7420 6f66 206c 6179 6572 732e 0a20 2020  t of layers..   
-00013000: 2020 2020 2020 2020 2073 7566 6669 7820           suffix 
-00013010: 666f 7220 6e61 6d65 2e0a 2020 2020 2020  for name..      
-00013020: 2020 2020 2020 6465 6661 756c 743a 2064        default: d
-00013030: 6566 6175 6c74 2070 6164 6469 6e67 2028  efault padding (
-00013040: 3530 756d 292e 0a20 2020 2020 2020 2020  50um)..         
-00013050: 2020 2074 6f70 3a20 6e6f 7274 6820 7061     top: north pa
-00013060: 6464 696e 672e 0a20 2020 2020 2020 2020  dding..         
-00013070: 2020 2062 6f74 746f 6d3a 2073 6f75 7468     bottom: south
-00013080: 2070 6164 6469 6e67 2e0a 2020 2020 2020   padding..      
-00013090: 2020 2020 2020 7269 6768 743a 2065 6173        right: eas
-000130a0: 7420 7061 6464 696e 672e 0a20 2020 2020  t padding..     
-000130b0: 2020 2020 2020 206c 6566 743a 2077 6573         left: wes
-000130c0: 7420 7061 6464 696e 672e 0a20 2020 2020  t padding..     
-000130d0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-000130e0: 726f 6d20 6764 7366 6163 746f 7279 2e61  rom gdsfactory.a
-000130f0: 6464 5f70 6164 6469 6e67 2069 6d70 6f72  dd_padding impor
-00013100: 7420 6164 645f 7061 6464 696e 670a 0a20  t add_padding.. 
-00013110: 2020 2020 2020 2072 6574 7572 6e20 6164         return ad
-00013120: 645f 7061 6464 696e 6728 636f 6d70 6f6e  d_padding(compon
-00013130: 656e 743d 7365 6c66 2c20 2a2a 6b77 6172  ent=self, **kwar
-00013140: 6773 290a 0a20 2020 2064 6566 2061 6273  gs)..    def abs
-00013150: 6f72 6228 7365 6c66 2c20 7265 6665 7265  orb(self, refere
-00013160: 6e63 6529 202d 3e20 436f 6d70 6f6e 656e  nce) -> Componen
-00013170: 743a 0a20 2020 2020 2020 2022 2222 4162  t:.        """Ab
-00013180: 736f 7262 7320 706f 6c79 676f 6e73 2066  sorbs polygons f
-00013190: 726f 6d20 436f 6d70 6f6e 656e 7452 6566  rom ComponentRef
-000131a0: 6572 656e 6365 2069 6e74 6f20 436f 6d70  erence into Comp
-000131b0: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
-000131c0: 4465 7374 726f 7973 2074 6865 2072 6566  Destroys the ref
-000131d0: 6572 656e 6365 2069 6e20 7468 6520 7072  erence in the pr
-000131e0: 6f63 6573 7320 6275 7420 6b65 6570 696e  ocess but keepin
-000131f0: 6720 7468 6520 706f 6c79 676f 6e20 6765  g the polygon ge
-00013200: 6f6d 6574 7279 2e0a 0a20 2020 2020 2020  ometry...       
-00013210: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00013220: 2020 2072 6566 6572 656e 6365 3a20 436f     reference: Co
-00013230: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
-00013240: 2074 6f20 6265 2061 6273 6f72 6265 6420   to be absorbed 
-00013250: 696e 746f 2074 6865 2043 6f6d 706f 6e65  into the Compone
-00013260: 6e74 2e0a 2020 2020 2020 2020 2222 220a  nt..        """.
-00013270: 2020 2020 2020 2020 6966 2072 6566 6572          if refer
-00013280: 656e 6365 206e 6f74 2069 6e20 7365 6c66  ence not in self
-00013290: 2e72 6566 6572 656e 6365 733a 0a20 2020  .references:.   
-000132a0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000132b0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-000132c0: 2020 2020 2020 2020 2020 2022 5468 6520             "The 
-000132d0: 7265 6665 7265 6e63 6520 796f 7520 6173  reference you as
-000132e0: 6b65 6420 746f 2061 6273 6f72 6220 646f  ked to absorb do
-000132f0: 6573 206e 6f74 2065 7869 7374 2069 6e20  es not exist in 
-00013300: 7468 6973 2043 6f6d 706f 6e65 6e74 2e22  this Component."
-00013310: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00013320: 2020 2020 2020 2072 6566 5f70 6f6c 7967         ref_polyg
-00013330: 6f6e 7320 3d20 7265 6665 7265 6e63 652e  ons = reference.
-00013340: 6765 745f 706f 6c79 676f 6e73 280a 2020  get_polygons(.  
-00013350: 2020 2020 2020 2020 2020 6279 5f73 7065            by_spe
-00013360: 633d 4661 6c73 652c 2069 6e63 6c75 6465  c=False, include
-00013370: 5f70 6174 6873 3d46 616c 7365 2c20 6173  _paths=False, as
-00013380: 5f61 7272 6179 3d46 616c 7365 0a20 2020  _array=False.   
-00013390: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-000133a0: 656c 662e 5f61 6464 5f70 6f6c 7967 6f6e  elf._add_polygon
-000133b0: 7328 2a72 6566 5f70 6f6c 7967 6f6e 7329  s(*ref_polygons)
-000133c0: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-000133d0: 6464 2872 6566 6572 656e 6365 2e67 6574  dd(reference.get
-000133e0: 5f6c 6162 656c 7328 2929 0a20 2020 2020  _labels()).     
-000133f0: 2020 2073 656c 662e 6164 6428 7265 6665     self.add(refe
-00013400: 7265 6e63 652e 6765 745f 7061 7468 7328  rence.get_paths(
-00013410: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-00013420: 7265 6d6f 7665 2872 6566 6572 656e 6365  remove(reference
-00013430: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00013440: 2073 656c 660a 0a20 2020 2064 6566 2072   self..    def r
-00013450: 656d 6f76 6528 7365 6c66 2c20 6974 656d  emove(self, item
-00013460: 7329 3a0a 2020 2020 2020 2020 2222 2252  s):.        """R
-00013470: 656d 6f76 6573 2069 7465 6d73 2066 726f  emoves items fro
-00013480: 6d20 6120 436f 6d70 6f6e 656e 742c 2077  m a Component, w
-00013490: 6869 6368 2063 616e 2069 6e63 6c75 6465  hich can include
-000134a0: 2050 6f72 7473 2c20 506f 6c79 676f 6e53   Ports, PolygonS
-000134b0: 6574 7320 5c0a 2020 2020 2020 2020 4365  ets \.        Ce
-000134c0: 6c6c 5265 6665 7265 6e63 6573 2c20 436f  llReferences, Co
-000134d0: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
-000134e0: 7320 616e 6420 4c61 6265 6c73 2e0a 0a20  s and Labels... 
-000134f0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00013500: 2020 2020 2020 2020 2069 7465 6d73 3a20           items: 
-00013510: 6c69 7374 206f 6620 4974 656d 7320 746f  list of Items to
-00013520: 2062 6520 7265 6d6f 7665 6420 6672 6f6d   be removed from
-00013530: 2074 6865 2043 6f6d 706f 6e65 6e74 2e0a   the Component..
-00013540: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013550: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
-00013560: 7472 2869 7465 6d73 2c20 225f 5f69 7465  tr(items, "__ite
-00013570: 725f 5f22 293a 0a20 2020 2020 2020 2020  r__"):.         
-00013580: 2020 2069 7465 6d73 203d 205b 6974 656d     items = [item
-00013590: 735d 0a20 2020 2020 2020 2066 6f72 2069  s].        for i
-000135a0: 7465 6d20 696e 2069 7465 6d73 3a0a 2020  tem in items:.  
-000135b0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-000135c0: 6e73 7461 6e63 6528 6974 656d 2c20 506f  nstance(item, Po
-000135d0: 7274 293a 0a20 2020 2020 2020 2020 2020  rt):.           
-000135e0: 2020 2020 2073 656c 662e 706f 7274 7320       self.ports 
-000135f0: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
-00013600: 2069 6e20 7365 6c66 2e70 6f72 7473 2e69   in self.ports.i
-00013610: 7465 6d73 2829 2069 6620 7620 213d 2069  tems() if v != i
-00013620: 7465 6d7d 0a20 2020 2020 2020 2020 2020  tem}.           
-00013630: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00013640: 2869 7465 6d2c 2067 6473 746b 2e52 6566  (item, gdstk.Ref
-00013650: 6572 656e 6365 293a 0a20 2020 2020 2020  erence):.       
-00013660: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-00013670: 656c 6c2e 7265 6d6f 7665 2869 7465 6d29  ell.remove(item)
-00013680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013690: 2069 7465 6d2e 6f77 6e65 7220 3d20 4e6f   item.owner = No
-000136a0: 6e65 0a20 2020 2020 2020 2020 2020 2065  ne.            e
-000136b0: 6c69 6620 6973 696e 7374 616e 6365 2869  lif isinstance(i
-000136c0: 7465 6d2c 2043 6f6d 706f 6e65 6e74 5265  tem, ComponentRe
-000136d0: 6665 7265 6e63 6529 3a0a 2020 2020 2020  ference):.      
-000136e0: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-000136f0: 6566 6572 656e 6365 732e 7265 6d6f 7665  eferences.remove
-00013700: 2869 7465 6d29 0a20 2020 2020 2020 2020  (item).         
-00013710: 2020 2020 2020 2073 656c 662e 5f63 656c         self._cel
-00013720: 6c2e 7265 6d6f 7665 2869 7465 6d2e 5f72  l.remove(item._r
-00013730: 6566 6572 656e 6365 290a 2020 2020 2020  eference).      
-00013740: 2020 2020 2020 2020 2020 6974 656d 2e6f            item.o
-00013750: 776e 6572 203d 204e 6f6e 650a 2020 2020  wner = None.    
-00013760: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013770: 2e5f 6e61 6d65 645f 7265 6665 7265 6e63  ._named_referenc
-00013780: 6573 2e70 6f70 2869 7465 6d2e 6e61 6d65  es.pop(item.name
-00013790: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-000137a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000137b0: 2020 2020 7365 6c66 2e5f 6365 6c6c 2e72      self._cell.r
-000137c0: 656d 6f76 6528 6974 656d 290a 0a20 2020  emove(item)..   
-000137d0: 2020 2020 2073 656c 662e 5f62 625f 7661       self._bb_va
-000137e0: 6c69 6420 3d20 4661 6c73 650a 2020 2020  lid = False.    
-000137f0: 2020 2020 7265 7475 726e 2073 656c 660a      return self.
-00013800: 0a20 2020 2064 6566 2068 6173 685f 6765  .    def hash_ge
-00013810: 6f6d 6574 7279 2873 656c 662c 2070 7265  ometry(self, pre
-00013820: 6369 7369 6f6e 3a20 666c 6f61 7420 3d20  cision: float = 
-00013830: 3165 2d34 2920 2d3e 2073 7472 3a0a 2020  1e-4) -> str:.  
-00013840: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-00013850: 2061 6e20 5348 4131 2068 6173 6820 6f66   an SHA1 hash of
-00013860: 2074 6865 2067 656f 6d65 7472 7920 696e   the geometry in
-00013870: 2074 6865 2043 6f6d 706f 6e65 6e74 2e0a   the Component..
-00013880: 0a20 2020 2020 2020 2046 6f72 2065 6163  .        For eac
-00013890: 6820 6c61 7965 722c 2065 6163 6820 706f  h layer, each po
-000138a0: 6c79 676f 6e20 6973 2069 6e64 6976 6964  lygon is individ
-000138b0: 7561 6c6c 7920 6861 7368 6564 2061 6e64  ually hashed and
-000138c0: 2074 6865 6e20 7468 6520 706f 6c79 676f   then the polygo
-000138d0: 6e20 6861 7368 6573 0a20 2020 2020 2020  n hashes.       
-000138e0: 2061 7265 2073 6f72 7465 642c 2074 6f20   are sorted, to 
-000138f0: 656e 7375 7265 2074 6865 2068 6173 6820  ensure the hash 
-00013900: 7374 6179 7320 636f 6e73 7461 6e74 2072  stays constant r
-00013910: 6567 6172 646c 6573 7320 6f66 2074 6865  egardless of the
-00013920: 206f 7264 6572 696e 670a 2020 2020 2020   ordering.      
-00013930: 2020 7468 6520 706f 6c79 676f 6e73 2e20    the polygons. 
-00013940: 2053 696d 696c 6172 6c79 2c20 7468 6520   Similarly, the 
-00013950: 6c61 7965 7273 2061 7265 2073 6f72 7465  layers are sorte
-00013960: 6420 6279 2028 6c61 7965 722c 2064 6174  d by (layer, dat
-00013970: 6174 7970 6529 2e0a 0a20 2020 2020 2020  atype)...       
-00013980: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00013990: 2020 2070 7265 6369 7369 6f6e 3a20 526f     precision: Ro
-000139a0: 756e 6469 6e67 2070 7265 6369 7369 6f6e  unding precision
-000139b0: 2066 6f72 2074 6865 2074 6865 206f 626a   for the the obj
-000139c0: 6563 7473 2069 6e20 7468 6520 436f 6d70  ects in the Comp
-000139d0: 6f6e 656e 742e 0a20 2020 2020 2020 2020  onent..         
-000139e0: 2020 2020 2020 2046 6f72 2069 6e73 7461         For insta
-000139f0: 6e63 652c 2061 2070 7265 6369 7369 6f6e  nce, a precision
-00013a00: 206f 6620 3165 2d32 2077 696c 6c20 726f   of 1e-2 will ro
-00013a10: 756e 6420 6120 706f 696e 7420 6174 0a20  und a point at. 
-00013a20: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00013a30: 302e 3132 342c 2031 2e37 3438 2920 746f  0.124, 1.748) to
-00013a40: 2028 302e 3132 2c20 312e 3735 292e 0a0a   (0.12, 1.75)...
-00013a50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013a60: 2020 2020 706f 6c79 676f 6e73 5f62 795f      polygons_by_
-00013a70: 7370 6563 203d 2073 656c 662e 6765 745f  spec = self.get_
-00013a80: 706f 6c79 676f 6e73 2862 795f 7370 6563  polygons(by_spec
-00013a90: 3d54 7275 652c 2061 735f 6172 7261 793d  =True, as_array=
-00013aa0: 4661 6c73 6529 0a20 2020 2020 2020 206c  False).        l
-00013ab0: 6179 6572 7320 3d20 6e70 2e61 7272 6179  ayers = np.array
-00013ac0: 286c 6973 7428 706f 6c79 676f 6e73 5f62  (list(polygons_b
-00013ad0: 795f 7370 6563 2e6b 6579 7328 2929 290a  y_spec.keys())).
-00013ae0: 2020 2020 2020 2020 736f 7274 6564 5f6c          sorted_l
-00013af0: 6179 6572 7320 3d20 6c61 7965 7273 5b6e  ayers = layers[n
-00013b00: 702e 6c65 7873 6f72 7428 286c 6179 6572  p.lexsort((layer
-00013b10: 735b 3a2c 2030 5d2c 206c 6179 6572 735b  s[:, 0], layers[
-00013b20: 3a2c 2031 5d29 295d 0a0a 2020 2020 2020  :, 1]))]..      
-00013b30: 2020 6669 6e61 6c5f 6861 7368 203d 2068    final_hash = h
-00013b40: 6173 686c 6962 2e73 6861 3128 290a 2020  ashlib.sha1().  
-00013b50: 2020 2020 2020 666f 7220 6c61 7965 7220        for layer 
-00013b60: 696e 2073 6f72 7465 645f 6c61 7965 7273  in sorted_layers
-00013b70: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
-00013b80: 7965 725f 6861 7368 203d 2068 6173 686c  yer_hash = hashl
-00013b90: 6962 2e73 6861 3128 6c61 7965 722e 6173  ib.sha1(layer.as
-00013ba0: 7479 7065 286e 702e 696e 7436 3429 292e  type(np.int64)).
-00013bb0: 6469 6765 7374 2829 0a20 2020 2020 2020  digest().       
-00013bc0: 2020 2020 2070 6f6c 7967 6f6e 7320 3d20       polygons = 
-00013bd0: 706f 6c79 676f 6e73 5f62 795f 7370 6563  polygons_by_spec
-00013be0: 5b74 7570 6c65 286c 6179 6572 295d 0a20  [tuple(layer)]. 
-00013bf0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00013c00: 6f6e 7320 3d20 5b5f 726e 6428 702e 706f  ons = [_rnd(p.po
-00013c10: 696e 7473 2c20 7072 6563 6973 696f 6e29  ints, precision)
-00013c20: 2066 6f72 2070 2069 6e20 706f 6c79 676f   for p in polygo
-00013c30: 6e73 5d0a 2020 2020 2020 2020 2020 2020  ns].            
-00013c40: 706f 6c79 676f 6e5f 6861 7368 6573 203d  polygon_hashes =
-00013c50: 206e 702e 736f 7274 285b 6861 7368 6c69   np.sort([hashli
-00013c60: 622e 7368 6131 2870 292e 6469 6765 7374  b.sha1(p).digest
-00013c70: 2829 2066 6f72 2070 2069 6e20 706f 6c79  () for p in poly
-00013c80: 676f 6e73 5d29 0a20 2020 2020 2020 2020  gons]).         
-00013c90: 2020 2066 696e 616c 5f68 6173 682e 7570     final_hash.up
-00013ca0: 6461 7465 286c 6179 6572 5f68 6173 6829  date(layer_hash)
-00013cb0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00013cc0: 2070 6820 696e 2070 6f6c 7967 6f6e 5f68   ph in polygon_h
-00013cd0: 6173 6865 733a 0a20 2020 2020 2020 2020  ashes:.         
-00013ce0: 2020 2020 2020 2066 696e 616c 5f68 6173         final_has
-00013cf0: 682e 7570 6461 7465 2870 6829 0a0a 2020  h.update(ph)..  
-00013d00: 2020 2020 2020 7265 7475 726e 2066 696e        return fin
-00013d10: 616c 5f68 6173 682e 6865 7864 6967 6573  al_hash.hexdiges
-00013d20: 7428 290a 0a20 2020 2064 6566 2067 6574  t()..    def get
-00013d30: 5f6c 6162 656c 7328 0a20 2020 2020 2020  _labels(.       
-00013d40: 2073 656c 662c 2061 7070 6c79 5f72 6570   self, apply_rep
-00013d50: 6574 6974 696f 6e73 3d54 7275 652c 2064  etitions=True, d
-00013d60: 6570 7468 3a20 696e 7420 7c20 4e6f 6e65  epth: int | None
-00013d70: 203d 204e 6f6e 652c 206c 6179 6572 3d4e   = None, layer=N
-00013d80: 6f6e 650a 2020 2020 2920 2d3e 206c 6973  one.    ) -> lis
-00013d90: 745b 4c61 6265 6c5d 3a0a 2020 2020 2020  t[Label]:.      
-00013da0: 2020 2222 2252 6574 7572 6e20 6c61 6265    """Return labe
-00013db0: 6c73 2e0a 0a20 2020 2020 2020 2041 7267  ls...        Arg
-00013dc0: 733a 0a20 2020 2020 2020 2020 2020 2061  s:.            a
-00013dd0: 7070 6c79 5f72 6570 6574 6974 696f 6e73  pply_repetitions
-00013de0: 3a2e 0a20 2020 2020 2020 2020 2020 2064  :..            d
-00013df0: 6570 7468 3a20 4e6f 6e65 2072 6574 7572  epth: None retur
-00013e00: 6e73 2061 6c6c 206c 6162 656c 7320 616e  ns all labels an
-00013e10: 6420 3020 746f 7020 6c65 7665 6c2e 0a20  d 0 top level.. 
-00013e20: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-00013e30: 3a20 6c61 7965 7273 7065 632e 0a20 2020  : layerspec..   
-00013e40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00013e50: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
-00013e60: 2e70 646b 2069 6d70 6f72 7420 6765 745f  .pdk import get_
-00013e70: 6c61 7965 720a 0a20 2020 2020 2020 2069  layer..        i
-00013e80: 6620 6c61 7965 723a 0a20 2020 2020 2020  f layer:.       
-00013e90: 2020 2020 206c 6179 6572 2c20 7465 7874       layer, text
-00013ea0: 7479 7065 203d 2067 6574 5f6c 6179 6572  type = get_layer
-00013eb0: 286c 6179 6572 290a 2020 2020 2020 2020  (layer).        
-00013ec0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00013ed0: 2020 7465 7874 7479 7065 203d 204e 6f6e    texttype = Non
-00013ee0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00013ef0: 2073 656c 662e 5f63 656c 6c2e 6765 745f   self._cell.get_
-00013f00: 6c61 6265 6c73 280a 2020 2020 2020 2020  labels(.        
-00013f10: 2020 2020 6170 706c 795f 7265 7065 7469      apply_repeti
-00013f20: 7469 6f6e 733d 6170 706c 795f 7265 7065  tions=apply_repe
-00013f30: 7469 7469 6f6e 732c 0a20 2020 2020 2020  titions,.       
-00013f40: 2020 2020 2064 6570 7468 3d64 6570 7468       depth=depth
-00013f50: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
-00013f60: 7965 723d 6c61 7965 722c 0a20 2020 2020  yer=layer,.     
-00013f70: 2020 2020 2020 2074 6578 7474 7970 653d         texttype=
-00013f80: 7465 7874 7479 7065 2c0a 2020 2020 2020  texttype,.      
-00013f90: 2020 290a 0a20 2020 2064 6566 2072 656d    )..    def rem
-00013fa0: 6f76 655f 6c61 6265 6c73 2873 656c 6629  ove_labels(self)
-00013fb0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00013fc0: 2020 2222 2252 656d 6f76 6520 6c61 6265    """Remove labe
-00013fd0: 6c73 2e22 2222 0a20 2020 2020 2020 2073  ls.""".        s
-00013fe0: 656c 662e 5f63 656c 6c2e 7265 6d6f 7665  elf._cell.remove
-00013ff0: 282a 7365 6c66 2e6c 6162 656c 7329 0a0a  (*self.labels)..
-00014000: 2020 2020 2320 4465 7072 6563 6174 6564      # Deprecated
-00014010: 0a20 2020 2064 6566 2067 6574 5f69 6e66  .    def get_inf
-00014020: 6f28 7365 6c66 293a 0a20 2020 2020 2020  o(self):.       
-00014030: 2022 2222 4761 7468 6572 7320 7468 6520   """Gathers the 
-00014040: 2e69 6e66 6f20 6469 6374 696f 6e61 7269  .info dictionari
-00014050: 6573 2066 726f 6d20 6576 6572 7920 7375  es from every su
-00014060: 622d 436f 6d70 6f6e 656e 7420 616e 6420  b-Component and 
-00014070: 7265 7475 726e 7320 7468 656d 2069 6e20  returns them in 
-00014080: 6120 6c69 7374 2e0a 0a20 2020 2020 2020  a list...       
-00014090: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-000140a0: 2020 2064 6570 7468 3a20 696e 7420 6f72     depth: int or
-000140b0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-000140c0: 2020 2020 2020 4966 206e 6f74 204e 6f6e        If not Non
-000140d0: 652c 2064 6566 696e 6573 2066 726f 6d20  e, defines from 
-000140e0: 686f 7720 6d61 6e79 2072 6566 6572 656e  how many referen
-000140f0: 6365 206c 6576 656c 7320 746f 0a20 2020  ce levels to.   
-00014100: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00014110: 7269 6576 6520 506f 7274 7320 6672 6f6d  rieve Ports from
-00014120: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00014130: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-00014140: 6c69 7374 206f 6620 6469 6374 696f 6e61  list of dictiona
-00014150: 7269 6573 0a20 2020 2020 2020 2020 2020  ries.           
-00014160: 2020 2020 204c 6973 7420 6f66 2074 6865       List of the
-00014170: 2022 2e69 6e66 6f22 2070 726f 7065 7274   ".info" propert
-00014180: 7920 6469 6374 696f 6e61 7269 6573 2066  y dictionaries f
-00014190: 726f 6d20 616c 6c20 7375 622d 436f 6d70  rom all sub-Comp
-000141a0: 6f6e 656e 7473 0a20 2020 2020 2020 2022  onents.        "
-000141b0: 2222 0a20 2020 2020 2020 2044 5f6c 6973  "".        D_lis
-000141c0: 7420 3d20 7365 6c66 2e67 6574 5f64 6570  t = self.get_dep
-000141d0: 656e 6465 6e63 6965 7328 7265 6375 7273  endencies(recurs
-000141e0: 6976 653d 5472 7565 290a 2020 2020 2020  ive=True).      
-000141f0: 2020 7265 7475 726e 205b 442e 696e 666f    return [D.info
-00014200: 2e63 6f70 7928 2920 666f 7220 4420 696e  .copy() for D in
-00014210: 2044 5f6c 6973 745d 0a0a 2020 2020 6465   D_list]..    de
-00014220: 6620 7265 6d61 705f 6c61 7965 7273 2873  f remap_layers(s
-00014230: 656c 662c 206c 6179 6572 6d61 702c 202a  elf, layermap, *
-00014240: 2a6b 7761 7267 7329 202d 3e20 436f 6d70  *kwargs) -> Comp
-00014250: 6f6e 656e 743a 0a20 2020 2020 2020 2022  onent:.        "
-00014260: 2222 5265 7475 726e 7320 6120 636f 7079  ""Returns a copy
-00014270: 206f 6620 7468 6520 636f 6d70 6f6e 656e   of the componen
-00014280: 7420 7769 7468 2072 656d 6170 7065 6420  t with remapped 
-00014290: 6c61 7965 7273 2e0a 0a20 2020 2020 2020  layers...       
-000142a0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-000142b0: 2020 206c 6179 6572 6d61 703a 2044 6963     layermap: Dic
-000142c0: 7469 6f6e 6172 7920 6f66 2076 616c 7565  tionary of value
-000142d0: 7320 696e 2066 6f72 6d61 7420 7b6c 6179  s in format {lay
-000142e0: 6572 5f66 726f 6d3a 206c 6179 6572 5f74  er_from: layer_t
-000142f0: 6f7d 2e0a 2020 2020 2020 2020 2222 220a  o}..        """.
-00014300: 2020 2020 2020 2020 6966 206b 7761 7267          if kwarg
-00014310: 733a 0a20 2020 2020 2020 2020 2020 2077  s:.            w
-00014320: 6172 6e69 6e67 732e 7761 726e 2822 7b6b  arnings.warn("{k
-00014330: 7761 7267 732e 6b65 7973 7d20 6973 2064  wargs.keys} is d
-00014340: 6570 7265 6361 7465 642e 222c 2044 6570  eprecated.", Dep
-00014350: 7265 6361 7469 6f6e 5761 726e 696e 6729  recationWarning)
-00014360: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
-00014370: 656e 7420 3d20 7365 6c66 0a20 2020 2020  ent = self.     
-00014380: 2020 206c 6179 6572 6d61 7020 3d20 7b5f     layermap = {_
-00014390: 7061 7273 655f 6c61 7965 7228 6b29 3a20  parse_layer(k): 
-000143a0: 5f70 6172 7365 5f6c 6179 6572 2876 2920  _parse_layer(v) 
-000143b0: 666f 7220 6b2c 2076 2069 6e20 6c61 7965  for k, v in laye
-000143c0: 726d 6170 2e69 7465 6d73 2829 7d0a 0a20  rmap.items()}.. 
-000143d0: 2020 2020 2020 2063 656c 6c73 203d 206c         cells = l
-000143e0: 6973 7428 636f 6d70 6f6e 656e 742e 6765  ist(component.ge
-000143f0: 745f 6465 7065 6e64 656e 6369 6573 2854  t_dependencies(T
-00014400: 7275 6529 290a 2020 2020 2020 2020 6365  rue)).        ce
-00014410: 6c6c 732e 6170 7065 6e64 2863 6f6d 706f  lls.append(compo
-00014420: 6e65 6e74 290a 2020 2020 2020 2020 666f  nent).        fo
-00014430: 7220 6365 6c6c 2069 6e20 6365 6c6c 733a  r cell in cells:
-00014440: 0a20 2020 2020 2020 2020 2020 2063 656c  .            cel
-00014450: 6c2e 5f63 656c 6c2e 7265 6d61 7028 6c61  l._cell.remap(la
-00014460: 7965 726d 6170 290a 2020 2020 2020 2020  yermap).        
-00014470: 7265 7475 726e 2063 6f6d 706f 6e65 6e74  return component
-00014480: 0a0a 2020 2020 6465 6620 746f 5f33 6428  ..    def to_3d(
-00014490: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-000144a0: 2020 2020 2020 206c 6179 6572 5f76 6965         layer_vie
-000144b0: 7773 3a20 4c61 7965 7256 6965 7773 207c  ws: LayerViews |
-000144c0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-000144d0: 2020 2020 2020 6c61 7965 725f 7374 6163        layer_stac
-000144e0: 6b3a 204c 6179 6572 5374 6163 6b20 7c20  k: LayerStack | 
-000144f0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00014500: 2020 2020 2065 7863 6c75 6465 5f6c 6179       exclude_lay
-00014510: 6572 733a 2074 7570 6c65 5b4c 6179 6572  ers: tuple[Layer
-00014520: 2c20 2e2e 2e5d 207c 204e 6f6e 6520 3d20  , ...] | None = 
-00014530: 4e6f 6e65 2c0a 2020 2020 293a 0a20 2020  None,.    ):.   
-00014540: 2020 2020 2022 2222 5265 7475 726e 2043       """Return C
-00014550: 6f6d 706f 6e65 6e74 2033 4420 7472 696d  omponent 3D trim
-00014560: 6573 6820 5363 656e 652e 0a0a 2020 2020  esh Scene...    
-00014570: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00014580: 2020 2020 2020 636f 6d70 6f6e 656e 743a        component:
-00014590: 2074 6f20 6578 7472 7564 6520 696e 2033   to extrude in 3
-000145a0: 442e 0a20 2020 2020 2020 2020 2020 206c  D..            l
-000145b0: 6179 6572 5f76 6965 7773 3a20 6c61 7965  ayer_views: laye
-000145c0: 7220 636f 6c6f 7273 2066 726f 6d20 4b6c  r colors from Kl
-000145d0: 6179 6f75 7420 4c61 7965 7220 5072 6f70  ayout Layer Prop
-000145e0: 6572 7469 6573 2066 696c 652e 0a20 2020  erties file..   
-000145f0: 2020 2020 2020 2020 2020 2020 2044 6566               Def
-00014600: 6175 6c74 7320 746f 2061 6374 6976 6520  aults to active 
-00014610: 5044 4b2e 6c61 7965 725f 7669 6577 732e  PDK.layer_views.
-00014620: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00014630: 6572 5f73 7461 636b 3a20 636f 6e74 6169  er_stack: contai
-00014640: 6e73 2074 6869 636b 6e65 7373 2061 6e64  ns thickness and
-00014650: 207a 6d69 6e20 666f 7220 6561 6368 206c   zmin for each l
-00014660: 6179 6572 2e0a 2020 2020 2020 2020 2020  ayer..          
-00014670: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
-00014680: 6f20 6163 7469 7665 2050 444b 2e6c 6179  o active PDK.lay
-00014690: 6572 5f73 7461 636b 2e0a 2020 2020 2020  er_stack..      
-000146a0: 2020 2020 2020 6578 636c 7564 655f 6c61        exclude_la
-000146b0: 7965 7273 3a20 6c61 7965 7273 2074 6f20  yers: layers to 
-000146c0: 6578 636c 7564 652e 0a0a 2020 2020 2020  exclude...      
-000146d0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-000146e0: 6f6d 2067 6473 6661 6374 6f72 792e 6578  om gdsfactory.ex
-000146f0: 706f 7274 2e74 6f5f 3364 2069 6d70 6f72  port.to_3d impor
-00014700: 7420 746f 5f33 640a 0a20 2020 2020 2020  t to_3d..       
-00014710: 2072 6574 7572 6e20 746f 5f33 6428 0a20   return to_3d(. 
-00014720: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-00014730: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00014740: 6572 5f76 6965 7773 3d6c 6179 6572 5f76  er_views=layer_v
-00014750: 6965 7773 2c0a 2020 2020 2020 2020 2020  iews,.          
-00014760: 2020 6c61 7965 725f 7374 6163 6b3d 6c61    layer_stack=la
-00014770: 7965 725f 7374 6163 6b2c 0a20 2020 2020  yer_stack,.     
-00014780: 2020 2020 2020 2065 7863 6c75 6465 5f6c         exclude_l
-00014790: 6179 6572 733d 6578 636c 7564 655f 6c61  ayers=exclude_la
-000147a0: 7965 7273 2c0a 2020 2020 2020 2020 290a  yers,.        ).
-000147b0: 0a20 2020 2064 6566 2074 6f5f 6e70 280a  .    def to_np(.
-000147c0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-000147d0: 2020 2020 2020 6e6d 5f70 6572 5f70 6978        nm_per_pix
-000147e0: 656c 3a20 696e 7420 3d20 3230 2c0a 2020  el: int = 20,.  
-000147f0: 2020 2020 2020 6c61 7965 7273 3a20 4c61        layers: La
-00014800: 7965 7273 203d 2028 2831 2c20 3029 2c29  yers = ((1, 0),)
-00014810: 2c0a 2020 2020 2020 2020 7661 6c75 6573  ,.        values
-00014820: 3a20 7475 706c 655b 666c 6f61 742c 202e  : tuple[float, .
-00014830: 2e2e 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ..] | None = Non
-00014840: 652c 0a20 2020 2020 2020 2070 6164 5f77  e,.        pad_w
-00014850: 6964 7468 3a20 696e 7420 3d20 312c 0a20  idth: int = 1,. 
-00014860: 2020 2029 202d 3e20 6e70 2e6e 6461 7272     ) -> np.ndarr
-00014870: 6179 3a0a 2020 2020 2020 2020 2222 2252  ay:.        """R
-00014880: 6574 7572 6e73 2061 2070 6978 656c 6174  eturns a pixelat
-00014890: 6564 206e 756d 7079 2061 7272 6179 2066  ed numpy array f
-000148a0: 726f 6d20 436f 6d70 6f6e 656e 7420 706f  rom Component po
-000148b0: 6c79 676f 6e73 2e0a 0a20 2020 2020 2020  lygons...       
-000148c0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-000148d0: 2020 2063 6f6d 706f 6e65 6e74 3a20 436f     component: Co
-000148e0: 6d70 6f6e 656e 742e 0a20 2020 2020 2020  mponent..       
-000148f0: 2020 2020 206e 6d5f 7065 725f 7069 7865       nm_per_pixe
-00014900: 6c3a 2079 6f75 2063 616e 2067 6f20 6672  l: you can go fr
-00014910: 6f6d 2032 3020 2863 6f61 7273 6529 2074  om 20 (coarse) t
-00014920: 6f20 3420 2866 696e 6529 2e0a 2020 2020  o 4 (fine)..    
-00014930: 2020 2020 2020 2020 6c61 7965 7273 3a20          layers: 
-00014940: 746f 2063 6f6e 7665 7274 2e20 4f72 6465  to convert. Orde
-00014950: 7220 6d61 7474 6572 7320 286c 6174 7465  r matters (latte
-00014960: 7220 6f76 6572 7772 6974 6520 666f 726d  r overwrite form
-00014970: 6572 292e 0a20 2020 2020 2020 2020 2020  er)..           
-00014980: 2076 616c 7565 733a 2061 7373 6f63 6961   values: associa
-00014990: 7465 6420 746f 2065 6163 6820 6c61 7965  ted to each laye
-000149a0: 7220 2864 6566 6175 6c74 7320 746f 2031  r (defaults to 1
-000149b0: 292e 0a20 2020 2020 2020 2020 2020 2070  )..            p
-000149c0: 6164 5f77 6964 7468 3a20 7061 6464 696e  ad_width: paddin
-000149d0: 6720 7069 7865 6c73 2061 726f 756e 6420  g pixels around 
-000149e0: 7468 6520 696d 6167 652e 0a0a 2020 2020  the image...    
-000149f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00014a00: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-00014a10: 6578 706f 7274 2e74 6f5f 6e70 2069 6d70  export.to_np imp
-00014a20: 6f72 7420 746f 5f6e 700a 0a20 2020 2020  ort to_np..     
-00014a30: 2020 2072 6574 7572 6e20 746f 5f6e 7028     return to_np(
-00014a40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00014a50: 662c 0a20 2020 2020 2020 2020 2020 206e  f,.            n
-00014a60: 6d5f 7065 725f 7069 7865 6c3d 6e6d 5f70  m_per_pixel=nm_p
-00014a70: 6572 5f70 6978 656c 2c0a 2020 2020 2020  er_pixel,.      
-00014a80: 2020 2020 2020 6c61 7965 7273 3d6c 6179        layers=lay
-00014a90: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
-00014aa0: 2076 616c 7565 733d 7661 6c75 6573 2c0a   values=values,.
-00014ab0: 2020 2020 2020 2020 2020 2020 7061 645f              pad_
-00014ac0: 7769 6474 683d 7061 645f 7769 6474 682c  width=pad_width,
-00014ad0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00014ae0: 6465 6620 7772 6974 655f 7374 6c28 0a20  def write_stl(. 
-00014af0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00014b00: 2020 2020 2066 696c 6570 6174 683a 2073       filepath: s
-00014b10: 7472 2c0a 2020 2020 2020 2020 6c61 7965  tr,.        laye
-00014b20: 725f 7374 6163 6b3a 204c 6179 6572 5374  r_stack: LayerSt
-00014b30: 6163 6b20 7c20 4e6f 6e65 203d 204e 6f6e  ack | None = Non
-00014b40: 652c 0a20 2020 2020 2020 2065 7863 6c75  e,.        exclu
-00014b50: 6465 5f6c 6179 6572 733a 2074 7570 6c65  de_layers: tuple
-00014b60: 5b4c 6179 6572 2c20 2e2e 2e5d 207c 204e  [Layer, ...] | N
-00014b70: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00014b80: 2020 2020 7573 655f 6c61 7965 725f 6e61      use_layer_na
-00014b90: 6d65 3a20 626f 6f6c 203d 2046 616c 7365  me: bool = False
-00014ba0: 2c0a 2020 2020 2020 2020 6875 6c6c 5f69  ,.        hull_i
-00014bb0: 6e76 616c 6964 5f70 6f6c 7967 6f6e 733a  nvalid_polygons:
-00014bc0: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
-00014bd0: 2020 2020 2020 7363 616c 653a 2066 6c6f        scale: flo
-00014be0: 6174 207c 204e 6f6e 6520 3d20 4e6f 6e65  at | None = None
-00014bf0: 2c0a 2020 2020 2920 2d3e 204e 6f6e 653a  ,.    ) -> None:
-00014c00: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
-00014c10: 6520 6120 436f 6d70 6f6e 656e 7420 746f  e a Component to
-00014c20: 2053 544c 2066 6f72 2033 4420 7072 696e   STL for 3D prin
-00014c30: 7469 6e67 2e0a 0a20 2020 2020 2020 2041  ting...        A
-00014c40: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00014c50: 2066 696c 6570 6174 683a 2074 6f20 7772   filepath: to wr
-00014c60: 6974 6520 5354 4c20 746f 2e0a 2020 2020  ite STL to..    
-00014c70: 2020 2020 2020 2020 6c61 7965 725f 7374          layer_st
-00014c80: 6163 6b3a 2063 6f6e 7461 696e 7320 7468  ack: contains th
-00014c90: 6963 6b6e 6573 7320 616e 6420 7a6d 696e  ickness and zmin
-00014ca0: 2066 6f72 2065 6163 6820 6c61 7965 722e   for each layer.
-00014cb0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00014cc0: 6c75 6465 5f6c 6179 6572 733a 206c 6179  lude_layers: lay
-00014cd0: 6572 7320 746f 2065 7863 6c75 6465 2e0a  ers to exclude..
-00014ce0: 2020 2020 2020 2020 2020 2020 7573 655f              use_
-00014cf0: 6c61 7965 725f 6e61 6d65 3a20 4966 2054  layer_name: If T
-00014d00: 7275 652c 2075 7365 7320 4c61 7965 724c  rue, uses LayerL
-00014d10: 6576 656c 206e 616d 6573 2069 6e20 6f75  evel names in ou
-00014d20: 7470 7574 2066 696c 656e 616d 6573 2072  tput filenames r
-00014d30: 6174 6865 7220 7468 616e 2067 6473 5f6c  ather than gds_l
-00014d40: 6179 6572 2061 6e64 2067 6473 5f64 6174  ayer and gds_dat
-00014d50: 6174 7970 652e 0a20 2020 2020 2020 2020  atype..         
-00014d60: 2020 2068 756c 6c5f 696e 7661 6c69 645f     hull_invalid_
-00014d70: 706f 6c79 676f 6e73 3a20 4966 2054 7275  polygons: If Tru
-00014d80: 652c 2072 6570 6c61 6365 7320 696e 7661  e, replaces inva
-00014d90: 6c69 6420 706f 6c79 676f 6e73 2028 6465  lid polygons (de
-00014da0: 7465 726d 696e 6564 2062 7920 7368 6170  termined by shap
-00014db0: 656c 792e 506f 6c79 676f 6e2e 6973 5f76  ely.Polygon.is_v
-00014dc0: 616c 6964 2920 7769 7468 2069 7473 2063  alid) with its c
-00014dd0: 6f6e 7665 7820 6875 6c6c 2e0a 2020 2020  onvex hull..    
-00014de0: 2020 2020 2020 2020 7363 616c 653a 204f          scale: O
-00014df0: 7074 696f 6e61 6c20 6661 6374 6f72 2062  ptional factor b
-00014e00: 7920 7768 6963 6820 746f 2073 6361 6c65  y which to scale
-00014e10: 206d 6573 6865 7320 6265 666f 7265 2077   meshes before w
-00014e20: 7269 7469 6e67 2e0a 0a20 2020 2020 2020  riting...       
-00014e30: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00014e40: 6d20 6764 7366 6163 746f 7279 2e65 7870  m gdsfactory.exp
-00014e50: 6f72 742e 746f 5f73 746c 2069 6d70 6f72  ort.to_stl impor
-00014e60: 7420 746f 5f73 746c 0a0a 2020 2020 2020  t to_stl..      
-00014e70: 2020 746f 5f73 746c 280a 2020 2020 2020    to_stl(.      
-00014e80: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00014e90: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
-00014ea0: 3d66 696c 6570 6174 682c 0a20 2020 2020  =filepath,.     
-00014eb0: 2020 2020 2020 206c 6179 6572 5f73 7461         layer_sta
-00014ec0: 636b 3d6c 6179 6572 5f73 7461 636b 2c0a  ck=layer_stack,.
-00014ed0: 2020 2020 2020 2020 2020 2020 6578 636c              excl
-00014ee0: 7564 655f 6c61 7965 7273 3d65 7863 6c75  ude_layers=exclu
-00014ef0: 6465 5f6c 6179 6572 732c 0a20 2020 2020  de_layers,.     
-00014f00: 2020 2020 2020 2075 7365 5f6c 6179 6572         use_layer
-00014f10: 5f6e 616d 653d 7573 655f 6c61 7965 725f  _name=use_layer_
-00014f20: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00014f30: 2020 6875 6c6c 5f69 6e76 616c 6964 5f70    hull_invalid_p
-00014f40: 6f6c 7967 6f6e 733d 6875 6c6c 5f69 6e76  olygons=hull_inv
-00014f50: 616c 6964 5f70 6f6c 7967 6f6e 732c 0a20  alid_polygons,. 
-00014f60: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
-00014f70: 3d73 6361 6c65 2c0a 2020 2020 2020 2020  =scale,.        
-00014f80: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
-00014f90: 5f67 6572 6265 7228 7365 6c66 2c20 6469  _gerber(self, di
-00014fa0: 7270 6174 682c 206c 6179 6572 6d61 705f  rpath, layermap_
-00014fb0: 746f 5f67 6572 6265 725f 6c61 7965 722c  to_gerber_layer,
-00014fc0: 206f 7074 696f 6e73 2920 2d3e 204e 6f6e   options) -> Non
-00014fd0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-00014fe0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00014ff0: 2020 2020 2020 2020 2064 6972 7061 7468           dirpath
-00015000: 3a20 6469 7265 6374 6f72 7920 746f 2077  : directory to w
-00015010: 7269 7465 2067 6572 6265 7220 6669 6c65  rite gerber file
-00015020: 7320 746f 2e0a 2020 2020 2020 2020 2020  s to..          
-00015030: 2020 6c61 7965 726d 6170 5f74 6f5f 6765    layermap_to_ge
-00015040: 7262 6572 5f6c 6179 6572 3a20 6469 6374  rber_layer: dict
-00015050: 696f 6e61 7279 206f 6620 6c61 7965 726d  ionary of layerm
-00015060: 6170 2074 6f20 6765 7262 6572 206c 6179  ap to gerber lay
-00015070: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
-00015080: 6f70 7469 6f6e 733a 2064 6963 7469 6f6e  options: diction
-00015090: 6172 7920 6f66 206f 7074 696f 6e73 2066  ary of options f
-000150a0: 6f72 2067 6572 6265 7220 6578 706f 7274  or gerber export
-000150b0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000150c0: 2020 6865 6164 6572 3a20 4c69 7374 5b73    header: List[s
-000150d0: 7472 5d20 7c20 4e6f 6e65 203d 204e 6f6e  tr] | None = Non
-000150e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000150f0: 2020 6d6f 6465 3a20 4c69 7465 7261 6c5b    mode: Literal[
-00015100: 226d 6d22 2c20 2269 6e22 5d20 3d20 226d  "mm", "in"] = "m
-00015110: 6d22 0a20 2020 2020 2020 2020 2020 2020  m".             
-00015120: 2020 2072 6573 6f6c 7574 696f 6e3a 2066     resolution: f
-00015130: 6c6f 6174 203d 2031 652d 360a 2020 2020  loat = 1e-6.    
-00015140: 2020 2020 2020 2020 2020 2020 696e 745f              int_
-00015150: 7369 7a65 3a20 696e 7420 3d20 340a 2020  size: int = 4.  
-00015160: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00015170: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
-00015180: 792e 6578 706f 7274 2e74 6f5f 6765 7262  y.export.to_gerb
-00015190: 6572 2069 6d70 6f72 7420 746f 5f67 6572  er import to_ger
-000151a0: 6265 720a 0a20 2020 2020 2020 2074 6f5f  ber..        to_
-000151b0: 6765 7262 6572 280a 2020 2020 2020 2020  gerber(.        
-000151c0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-000151d0: 2020 2020 2020 6469 7270 6174 683d 6469        dirpath=di
-000151e0: 7270 6174 682c 0a20 2020 2020 2020 2020  rpath,.         
-000151f0: 2020 206c 6179 6572 6d61 705f 746f 5f67     layermap_to_g
-00015200: 6572 6265 725f 6c61 7965 723d 6c61 7965  erber_layer=laye
-00015210: 726d 6170 5f74 6f5f 6765 7262 6572 5f6c  rmap_to_gerber_l
-00015220: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
-00015230: 2020 6f70 7469 6f6e 733d 6f70 7469 6f6e    options=option
-00015240: 732c 0a20 2020 2020 2020 2029 0a0a 2020  s,.        )..  
-00015250: 2020 6465 6620 746f 5f67 6d73 6828 7365    def to_gmsh(se
-00015260: 6c66 2c20 2a61 7267 732c 202a 2a6b 7761  lf, *args, **kwa
-00015270: 7267 7329 202d 3e20 4e6f 6e65 3a0a 2020  rgs) -> None:.  
-00015280: 2020 2020 2020 2222 2244 6570 7265 6361        """Depreca
-00015290: 7465 642e 2069 6e73 7465 6164 206f 662e  ted. instead of.
-000152a0: 0a0a 2020 2020 2020 2020 6d65 7368 203d  ..        mesh =
-000152b0: 2063 6f6d 706f 6e65 6e74 2e74 6f5f 676d   component.to_gm
-000152c0: 7368 2861 7267 756d 656e 7473 290a 0a20  sh(arguments).. 
-000152d0: 2020 2020 2020 2055 7365 3a0a 0a20 2020         Use:..   
-000152e0: 2020 2020 2066 726f 6d20 6770 6c75 6769       from gplugi
-000152f0: 6e73 2e67 6d73 682e 6765 745f 6d65 7368  ns.gmsh.get_mesh
-00015300: 2069 6d70 6f72 7420 6765 745f 6d65 7368   import get_mesh
-00015310: 0a0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00015320: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00015330: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00015340: 2020 2020 2022 2222 636f 6d70 6f6e 656e       """componen
-00015350: 742e 746f 5f67 6d73 6828 2920 6861 7320  t.to_gmsh() has 
-00015360: 6265 656e 2064 6570 7265 6361 7465 642e  been deprecated.
-00015370: 2049 6e73 7465 6164 206f 663a 0a0a 2020   Instead of:..  
-00015380: 2020 2020 2020 6d65 7368 203d 2063 6f6d        mesh = com
-00015390: 706f 6e65 6e74 2e74 6f5f 676d 7368 2861  ponent.to_gmsh(a
-000153a0: 7267 756d 656e 7473 290a 0a20 2020 2020  rguments)..     
-000153b0: 2020 2055 7365 3a0a 0a20 2020 2020 2020     Use:..       
-000153c0: 2066 726f 6d20 6770 6c75 6769 6e73 2e67   from gplugins.g
-000153d0: 6d73 682e 6765 745f 6d65 7368 2069 6d70  msh.get_mesh imp
-000153e0: 6f72 7420 6765 745f 6d65 7368 0a0a 2020  ort get_mesh..  
-000153f0: 2020 2020 2020 6d65 7368 203d 2067 6574        mesh = get
-00015400: 5f6d 6573 6828 636f 6d70 6f6e 656e 742c  _mesh(component,
-00015410: 2061 7267 756d 656e 7473 290a 2020 2020   arguments).    
-00015420: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00015430: 290a 0a20 2020 2064 6566 206f 6666 7365  )..    def offse
-00015440: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
-00015450: 0a20 2020 2020 2020 2064 6973 7461 6e63  .        distanc
-00015460: 653a 2066 6c6f 6174 203d 2030 2e31 2c0a  e: float = 0.1,.
-00015470: 2020 2020 2020 2020 7573 655f 756e 696f          use_unio
-00015480: 6e3a 2062 6f6f 6c20 3d20 5472 7565 2c0a  n: bool = True,.
-00015490: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
-000154a0: 6e3a 2066 6c6f 6174 203d 2031 652d 342c  n: float = 1e-4,
-000154b0: 0a20 2020 2020 2020 206a 6f69 6e3a 2073  .        join: s
-000154c0: 7472 203d 2022 6d69 7465 7222 2c0a 2020  tr = "miter",.  
-000154d0: 2020 2020 2020 746f 6c65 7261 6e63 653a        tolerance:
-000154e0: 2069 6e74 203d 2032 2c0a 2020 2020 2020   int = 2,.      
-000154f0: 2020 6c61 7965 723a 204c 6179 6572 5370    layer: LayerSp
-00015500: 6563 203d 2022 5747 222c 0a20 2020 2029  ec = "WG",.    )
-00015510: 202d 3e20 436f 6d70 6f6e 656e 743a 0a20   -> Component:. 
-00015520: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00015530: 7320 6e65 7720 436f 6d70 6f6e 656e 7420  s new Component 
-00015540: 7769 7468 2070 6f6c 7967 6f6e 7320 6572  with polygons er
-00015550: 6f64 6564 206f 7220 6469 6c61 7465 6420  oded or dilated 
-00015560: 6279 2061 6e20 6f66 6673 6574 2e0a 0a20  by an offset... 
-00015570: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00015580: 2020 2020 2064 6973 7461 6e63 653a 2044       distance: D
-00015590: 6973 7461 6e63 6520 746f 206f 6666 7365  istance to offse
-000155a0: 7420 706f 6c79 676f 6e73 2e20 506f 7369  t polygons. Posi
-000155b0: 7469 7665 2076 616c 7565 7320 6578 7061  tive values expa
-000155c0: 6e64 2c20 6e65 6761 7469 7665 2073 6872  nd, negative shr
-000155d0: 696e 6b2e 0a20 2020 2020 2020 2075 7365  ink..        use
-000155e0: 5f75 6e69 6f6e 3a20 4966 2054 7275 652c  _union: If True,
-000155f0: 2075 7365 2075 6e69 6f6e 206f 6620 616c   use union of al
-00015600: 6c20 706f 6c79 676f 6e73 2074 6f20 6f66  l polygons to of
-00015610: 6673 6574 2e20 4966 2046 616c 7365 2c20  fset. If False, 
-00015620: 6f66 6673 6574 0a20 2020 2020 2020 2070  offset.        p
-00015630: 7265 6369 7369 6f6e 3a20 4465 7369 7265  recision: Desire
-00015640: 6420 7072 6563 6973 696f 6e20 666f 7220  d precision for 
-00015650: 726f 756e 6469 6e67 2076 6572 7465 7820  rounding vertex 
-00015660: 636f 6f72 6469 6e61 7465 732e 0a20 2020  coordinates..   
-00015670: 2020 2020 206a 6f69 6e3a 207b 276d 6974       join: {'mit
-00015680: 6572 272c 2027 6265 7665 6c27 2c20 2772  er', 'bevel', 'r
-00015690: 6f75 6e64 277d 2054 7970 6520 6f66 206a  ound'} Type of j
-000156a0: 6f69 6e20 7573 6564 2074 6f20 6372 6561  oin used to crea
-000156b0: 7465 2070 6f6c 7967 6f6e 206f 6666 7365  te polygon offse
-000156c0: 740a 2020 2020 2020 2020 746f 6c65 7261  t.        tolera
-000156d0: 6e63 653a 2046 6f72 206d 6974 6572 206a  nce: For miter j
-000156e0: 6f69 6e74 732c 2074 6869 7320 6e75 6d62  oints, this numb
-000156f0: 6572 206d 7573 7420 6265 2061 7420 6c65  er must be at le
-00015700: 6173 7420 3220 7265 7072 6573 656e 7473  ast 2 represents
-00015710: 2074 6865 0a20 2020 2020 2020 2020 206d   the.          m
-00015720: 6178 696d 616c 2064 6973 7461 6e63 6520  aximal distance 
-00015730: 696e 206d 756c 7469 706c 6573 206f 6620  in multiples of 
-00015740: 6f66 6673 6574 2062 6574 7765 656e 206e  offset between n
-00015750: 6577 2076 6572 7469 6365 7320 616e 6420  ew vertices and 
-00015760: 7468 6569 720a 2020 2020 2020 2020 2020  their.          
-00015770: 6f72 6967 696e 616c 2070 6f73 6974 696f  original positio
-00015780: 6e20 6265 666f 7265 2062 6576 656c 696e  n before bevelin
-00015790: 6720 746f 2061 766f 6964 2073 7069 6b65  g to avoid spike
-000157a0: 7320 6174 2061 6375 7465 206a 6f69 6e74  s at acute joint
-000157b0: 732e 2046 6f72 0a20 2020 2020 2020 2020  s. For.         
-000157c0: 2072 6f75 6e64 206a 6f69 6e74 732c 2069   round joints, i
-000157d0: 7420 696e 6469 6361 7465 7320 7468 6520  t indicates the 
-000157e0: 6375 7276 6174 7572 6520 7265 736f 6c75  curvature resolu
-000157f0: 7469 6f6e 2069 6e20 6e75 6d62 6572 206f  tion in number o
-00015800: 660a 2020 2020 2020 2020 2020 706f 696e  f.          poin
-00015810: 7473 2070 6572 2066 756c 6c20 6369 7263  ts per full circ
-00015820: 6c65 2e0a 2020 2020 2020 2020 6c61 7965  le..        laye
-00015830: 723a 2053 7065 6369 6669 6320 6c61 7965  r: Specific laye
-00015840: 7220 746f 2070 7574 2070 6f6c 7967 6f6e  r to put polygon
-00015850: 2067 656f 6d65 7472 7920 6f6e 2e0a 0a20   geometry on... 
-00015860: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00015870: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-00015880: 7279 2e67 656f 6d65 7472 792e 6f66 6673  ry.geometry.offs
-00015890: 6574 2069 6d70 6f72 7420 6f66 6673 6574  et import offset
-000158a0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000158b0: 206f 6666 7365 7428 0a20 2020 2020 2020   offset(.       
-000158c0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000158d0: 2020 2020 2020 2064 6973 7461 6e63 653d         distance=
-000158e0: 6469 7374 616e 6365 2c0a 2020 2020 2020  distance,.      
-000158f0: 2020 2020 2020 7573 655f 756e 696f 6e3d        use_union=
-00015900: 7573 655f 756e 696f 6e2c 0a20 2020 2020  use_union,.     
-00015910: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-00015920: 3d70 7265 6369 7369 6f6e 2c0a 2020 2020  =precision,.    
-00015930: 2020 2020 2020 2020 6a6f 696e 3d6a 6f69          join=joi
-00015940: 6e2c 0a20 2020 2020 2020 2020 2020 2074  n,.            t
-00015950: 6f6c 6572 616e 6365 3d74 6f6c 6572 616e  olerance=toleran
-00015960: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-00015970: 6c61 7965 723d 6c61 7965 722c 0a20 2020  layer=layer,.   
-00015980: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00015990: 6164 645f 726f 7574 655f 696e 666f 280a  add_route_info(.
-000159a0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-000159b0: 2020 2020 2020 6372 6f73 735f 7365 6374        cross_sect
-000159c0: 696f 6e3a 2043 726f 7373 5365 6374 696f  ion: CrossSectio
-000159d0: 6e20 7c20 7374 722c 0a20 2020 2020 2020  n | str,.       
-000159e0: 206c 656e 6774 683a 2066 6c6f 6174 2c0a   length: float,.
-000159f0: 2020 2020 2020 2020 6c65 6e67 7468 5f65          length_e
-00015a00: 6666 3a20 666c 6f61 7420 7c20 4e6f 6e65  ff: float | None
-00015a10: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00015a20: 2074 6170 6572 3a20 626f 6f6c 203d 2046   taper: bool = F
-00015a30: 616c 7365 2c0a 2020 2020 2020 2020 2a2a  alse,.        **
-00015a40: 6b77 6172 6773 2c0a 2020 2020 2920 2d3e  kwargs,.    ) ->
-00015a50: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00015a60: 2222 4164 6473 2072 6f75 7465 2069 6e66  ""Adds route inf
-00015a70: 6f72 6d61 7469 6f6e 2074 6f20 6120 636f  ormation to a co
-00015a80: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
-00015a90: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00015aa0: 2020 2020 6372 6f73 735f 7365 6374 696f      cross_sectio
-00015ab0: 6e3a 2043 726f 7373 5365 6374 696f 6e20  n: CrossSection 
-00015ac0: 6f72 206e 616d 6520 6f66 2074 6865 2063  or name of the c
-00015ad0: 726f 7373 5f73 6563 7469 6f6e 2e0a 2020  ross_section..  
-00015ae0: 2020 2020 2020 2020 2020 6c65 6e67 7468            length
-00015af0: 3a20 6c65 6e67 7468 206f 6620 7468 6520  : length of the 
-00015b00: 726f 7574 652e 0a20 2020 2020 2020 2020  route..         
-00015b10: 2020 206c 656e 6774 685f 6566 663a 2065     length_eff: e
-00015b20: 6666 6563 7469 7665 206c 656e 6774 6820  ffective length 
-00015b30: 6f66 2074 6865 2072 6f75 7465 2e0a 2020  of the route..  
-00015b40: 2020 2020 2020 2020 2020 7461 7065 723a            taper:
-00015b50: 2069 6620 5472 7565 2061 6464 7320 7461   if True adds ta
-00015b60: 7065 7220 696e 666f 726d 6174 696f 6e2e  per information.
-00015b70: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
-00015b80: 7761 7267 733a 2065 7874 7261 2069 6e66  wargs: extra inf
-00015b90: 6f72 6d61 7469 6f6e 2074 6f20 6164 6420  ormation to add 
-00015ba0: 746f 2074 6865 2063 6f6d 706f 6e65 6e74  to the component
-00015bb0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00015bc0: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-00015bd0: 6374 6f72 792e 7064 6b20 696d 706f 7274  ctory.pdk import
-00015be0: 2067 6574 5f61 6374 6976 655f 7064 6b0a   get_active_pdk.
-00015bf0: 0a20 2020 2020 2020 2070 646b 203d 2067  .        pdk = g
-00015c00: 6574 5f61 6374 6976 655f 7064 6b28 290a  et_active_pdk().
-00015c10: 0a20 2020 2020 2020 206c 656e 6774 685f  .        length_
-00015c20: 6566 6620 3d20 6c65 6e67 7468 5f65 6666  eff = length_eff
-00015c30: 206f 7220 6c65 6e67 7468 0a20 2020 2020   or length.     
-00015c40: 2020 2078 735f 6e61 6d65 203d 2028 0a20     xs_name = (. 
-00015c50: 2020 2020 2020 2020 2020 2063 726f 7373             cross
-00015c60: 5f73 6563 7469 6f6e 0a20 2020 2020 2020  _section.       
-00015c70: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00015c80: 6365 2863 726f 7373 5f73 6563 7469 6f6e  ce(cross_section
-00015c90: 2c20 7374 7229 0a20 2020 2020 2020 2020  , str).         
-00015ca0: 2020 2065 6c73 6520 7064 6b2e 6765 745f     else pdk.get_
-00015cb0: 6372 6f73 735f 7365 6374 696f 6e5f 6e61  cross_section_na
-00015cc0: 6d65 2863 726f 7373 5f73 6563 7469 6f6e  me(cross_section
-00015cd0: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
-00015ce0: 2020 2020 2064 203d 207b 0a20 2020 2020       d = {.     
-00015cf0: 2020 2020 2020 2022 7479 7065 223a 2078         "type": x
-00015d00: 735f 6e61 6d65 2c0a 2020 2020 2020 2020  s_name,.        
-00015d10: 2020 2020 226c 656e 6774 6822 3a20 6c65      "length": le
-00015d20: 6e67 7468 5f65 6666 2c0a 2020 2020 2020  ngth_eff,.      
-00015d30: 2020 2020 2020 6622 7b78 735f 6e61 6d65        f"{xs_name
-00015d40: 7d5f 6c65 6e67 7468 223a 206c 656e 6774  }_length": lengt
-00015d50: 685f 6566 662c 0a20 2020 2020 2020 2020  h_eff,.         
-00015d60: 2020 2022 7765 6967 6874 223a 206c 656e     "weight": len
-00015d70: 6774 685f 6566 662c 0a20 2020 2020 2020  gth_eff,.       
-00015d80: 207d 0a20 2020 2020 2020 2069 6620 7461   }.        if ta
-00015d90: 7065 723a 0a20 2020 2020 2020 2020 2020  per:.           
-00015da0: 2064 5b66 227b 7873 5f6e 616d 657d 5f74   d[f"{xs_name}_t
-00015db0: 6170 6572 5f6c 656e 6774 6822 5d20 3d20  aper_length"] = 
-00015dc0: 6c65 6e67 7468 0a20 2020 2020 2020 2064  length.        d
-00015dd0: 207c 3d20 6b77 6172 6773 0a20 2020 2020   |= kwargs.     
-00015de0: 2020 2073 656c 662e 696e 666f 5b22 726f     self.info["ro
-00015df0: 7574 655f 696e 666f 225d 203d 2064 0a0a  ute_info"] = d..
-00015e00: 0a23 2043 6f6d 706f 6e65 6e74 206d 6574  .# Component met
-00015e10: 686f 6473 0a0a 0a64 6566 2063 6f70 7928  hods...def copy(
-00015e20: 0a20 2020 2044 3a20 436f 6d70 6f6e 656e  .    D: Componen
-00015e30: 742c 0a20 2020 2072 6566 6572 656e 6365  t,.    reference
-00015e40: 733d 4e6f 6e65 2c0a 2020 2020 706f 7274  s=None,.    port
-00015e50: 733d 4e6f 6e65 2c0a 2020 2020 706f 6c79  s=None,.    poly
-00015e60: 676f 6e73 3d4e 6f6e 652c 0a20 2020 2070  gons=None,.    p
-00015e70: 6174 6873 3d4e 6f6e 652c 0a20 2020 206e  aths=None,.    n
-00015e80: 616d 653d 4e6f 6e65 2c0a 2020 2020 6c61  ame=None,.    la
-00015e90: 6265 6c73 3d4e 6f6e 652c 0a29 202d 3e20  bels=None,.) -> 
-00015ea0: 436f 6d70 6f6e 656e 743a 0a20 2020 2022  Component:.    "
-00015eb0: 2222 5265 7475 726e 7320 6120 436f 6d70  ""Returns a Comp
-00015ec0: 6f6e 656e 7420 636f 7079 2e0a 0a20 2020  onent copy...   
-00015ed0: 2041 7267 733a 0a20 2020 2020 2020 2044   Args:.        D
-00015ee0: 3a20 636f 6d70 6f6e 656e 7420 746f 2063  : component to c
-00015ef0: 6f70 792e 0a20 2020 2020 2020 2072 6566  opy..        ref
-00015f00: 6572 656e 6365 733a 2072 6566 6572 656e  erences: referen
-00015f10: 6365 7320 746f 2063 6f70 792e 0a20 2020  ces to copy..   
-00015f20: 2020 2020 2070 6f72 7473 3a20 706f 7274       ports: port
-00015f30: 7320 746f 2063 6f70 792e 0a20 2020 2020  s to copy..     
-00015f40: 2020 2070 6f6c 7967 6f6e 733a 2070 6f6c     polygons: pol
-00015f50: 7967 6f6e 7320 746f 2063 6f70 792e 0a20  ygons to copy.. 
-00015f60: 2020 2020 2020 2070 6174 6873 3a20 7061         paths: pa
-00015f70: 7468 7320 746f 2063 6f70 792e 0a20 2020  ths to copy..   
-00015f80: 2020 2020 206e 616d 653a 206e 616d 6520       name: name 
-00015f90: 6f66 2074 6865 206e 6577 2063 6f6d 706f  of the new compo
-00015fa0: 6e65 6e74 2e0a 2020 2020 2020 2020 6c61  nent..        la
-00015fb0: 6265 6c73 3a20 6c61 6265 6c73 2074 6f20  bels: labels to 
-00015fc0: 636f 7079 2e0a 2020 2020 2222 220a 2020  copy..    """.  
-00015fd0: 2020 6320 3d20 436f 6d70 6f6e 656e 7428    c = Component(
-00015fe0: 290a 2020 2020 632e 696e 666f 203d 2044  ).    c.info = D
-00015ff0: 2e69 6e66 6f0a 2020 2020 632e 6368 696c  .info.    c.chil
-00016000: 6420 3d20 442e 6368 696c 640a 0a20 2020  d = D.child..   
-00016010: 2066 6f72 2072 6566 2069 6e20 7265 6665   for ref in refe
-00016020: 7265 6e63 6573 2069 6620 7265 6665 7265  rences if refere
-00016030: 6e63 6573 2069 7320 6e6f 7420 4e6f 6e65  nces is not None
-00016040: 2065 6c73 6520 442e 7265 6665 7265 6e63   else D.referenc
-00016050: 6573 3a0a 2020 2020 2020 2020 632e 6164  es:.        c.ad
-00016060: 6428 636f 7079 5f72 6566 6572 656e 6365  d(copy_reference
-00016070: 2872 6566 2929 0a20 2020 2066 6f72 2070  (ref)).    for p
-00016080: 6f72 7420 696e 2028 706f 7274 7320 6966  ort in (ports if
-00016090: 2070 6f72 7473 2069 7320 6e6f 7420 4e6f   ports is not No
-000160a0: 6e65 2065 6c73 6520 442e 706f 7274 7329  ne else D.ports)
-000160b0: 2e76 616c 7565 7328 293a 0a20 2020 2020  .values():.     
-000160c0: 2020 2063 2e61 6464 5f70 6f72 7428 706f     c.add_port(po
-000160d0: 7274 3d70 6f72 7429 0a20 2020 2066 6f72  rt=port).    for
-000160e0: 2070 6f6c 7920 696e 2070 6f6c 7967 6f6e   poly in polygon
-000160f0: 7320 6966 2070 6f6c 7967 6f6e 7320 6973  s if polygons is
-00016100: 206e 6f74 204e 6f6e 6520 656c 7365 2044   not None else D
-00016110: 2e70 6f6c 7967 6f6e 733a 0a20 2020 2020  .polygons:.     
-00016120: 2020 2063 2e61 6464 5f70 6f6c 7967 6f6e     c.add_polygon
-00016130: 2870 6f6c 7929 0a20 2020 2066 6f72 2070  (poly).    for p
-00016140: 6174 6820 696e 2070 6174 6873 2069 6620  ath in paths if 
-00016150: 7061 7468 7320 6973 206e 6f74 204e 6f6e  paths is not Non
-00016160: 6520 656c 7365 2044 2e70 6174 6873 3a0a  e else D.paths:.
-00016170: 2020 2020 2020 2020 632e 6164 6428 7061          c.add(pa
-00016180: 7468 290a 2020 2020 666f 7220 6c61 6265  th).    for labe
-00016190: 6c20 696e 206c 6162 656c 7320 6966 206c  l in labels if l
-000161a0: 6162 656c 7320 6973 206e 6f74 204e 6f6e  abels is not Non
-000161b0: 6520 656c 7365 2044 2e6c 6162 656c 733a  e else D.labels:
-000161c0: 0a20 2020 2020 2020 2063 2e61 6464 5f6c  .        c.add_l
-000161d0: 6162 656c 280a 2020 2020 2020 2020 2020  abel(.          
-000161e0: 2020 7465 7874 3d6c 6162 656c 2e74 6578    text=label.tex
-000161f0: 742c 0a20 2020 2020 2020 2020 2020 2070  t,.            p
-00016200: 6f73 6974 696f 6e3d 6c61 6265 6c2e 6f72  osition=label.or
-00016210: 6967 696e 2c0a 2020 2020 2020 2020 2020  igin,.          
-00016220: 2020 6c61 7965 723d 286c 6162 656c 2e6c    layer=(label.l
-00016230: 6179 6572 2c20 6c61 6265 6c2e 7465 7874  ayer, label.text
-00016240: 7479 7065 292c 0a20 2020 2020 2020 2029  type),.        )
-00016250: 0a0a 2020 2020 6966 206e 616d 6520 6973  ..    if name is
-00016260: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00016270: 2020 2063 2e6e 616d 6520 3d20 6e61 6d65     c.name = name
-00016280: 0a0a 2020 2020 7265 7475 726e 2063 0a0a  ..    return c..
-00016290: 0a64 6566 2063 6f70 795f 7265 6665 7265  .def copy_refere
-000162a0: 6e63 6528 0a20 2020 2072 6566 2c0a 2020  nce(.    ref,.  
-000162b0: 2020 7061 7265 6e74 3d4e 6f6e 652c 0a20    parent=None,. 
-000162c0: 2020 2063 6f6c 756d 6e73 3d4e 6f6e 652c     columns=None,
-000162d0: 0a20 2020 2072 6f77 733d 4e6f 6e65 2c0a  .    rows=None,.
-000162e0: 2020 2020 7370 6163 696e 673d 4e6f 6e65      spacing=None
-000162f0: 2c0a 2020 2020 6f72 6967 696e 3d4e 6f6e  ,.    origin=Non
-00016300: 652c 0a20 2020 2072 6f74 6174 696f 6e3d  e,.    rotation=
-00016310: 4e6f 6e65 2c0a 2020 2020 6d61 676e 6966  None,.    magnif
-00016320: 6963 6174 696f 6e3d 4e6f 6e65 2c0a 2020  ication=None,.  
-00016330: 2020 785f 7265 666c 6563 7469 6f6e 3d4e    x_reflection=N
-00016340: 6f6e 652c 0a20 2020 206e 616d 653d 4e6f  one,.    name=No
-00016350: 6e65 2c0a 2020 2020 7631 3d4e 6f6e 652c  ne,.    v1=None,
-00016360: 0a20 2020 2076 323d 4e6f 6e65 2c0a 2920  .    v2=None,.) 
-00016370: 2d3e 2043 6f6d 706f 6e65 6e74 5265 6665  -> ComponentRefe
-00016380: 7265 6e63 653a 0a20 2020 2072 6574 7572  rence:.    retur
-00016390: 6e20 436f 6d70 6f6e 656e 7452 6566 6572  n ComponentRefer
-000163a0: 656e 6365 280a 2020 2020 2020 2020 636f  ence(.        co
-000163b0: 6d70 6f6e 656e 743d 7061 7265 6e74 206f  mponent=parent o
-000163c0: 7220 7265 662e 7061 7265 6e74 2c0a 2020  r ref.parent,.  
-000163d0: 2020 2020 2020 636f 6c75 6d6e 733d 636f        columns=co
-000163e0: 6c75 6d6e 7320 6f72 2072 6566 2e63 6f6c  lumns or ref.col
-000163f0: 756d 6e73 2c0a 2020 2020 2020 2020 726f  umns,.        ro
-00016400: 7773 3d72 6f77 7320 6f72 2072 6566 2e72  ws=rows or ref.r
-00016410: 6f77 732c 0a20 2020 2020 2020 2073 7061  ows,.        spa
-00016420: 6369 6e67 3d73 7061 6369 6e67 206f 7220  cing=spacing or 
-00016430: 7265 662e 7370 6163 696e 672c 0a20 2020  ref.spacing,.   
-00016440: 2020 2020 206f 7269 6769 6e3d 6f72 6967       origin=orig
-00016450: 696e 206f 7220 7265 662e 6f72 6967 696e  in or ref.origin
-00016460: 2c0a 2020 2020 2020 2020 726f 7461 7469  ,.        rotati
-00016470: 6f6e 3d72 6f74 6174 696f 6e20 6f72 2072  on=rotation or r
-00016480: 6566 2e72 6f74 6174 696f 6e2c 0a20 2020  ef.rotation,.   
-00016490: 2020 2020 206d 6167 6e69 6669 6361 7469       magnificati
-000164a0: 6f6e 3d6d 6167 6e69 6669 6361 7469 6f6e  on=magnification
-000164b0: 206f 7220 7265 662e 6d61 676e 6966 6963   or ref.magnific
-000164c0: 6174 696f 6e2c 0a20 2020 2020 2020 2078  ation,.        x
-000164d0: 5f72 6566 6c65 6374 696f 6e3d 785f 7265  _reflection=x_re
-000164e0: 666c 6563 7469 6f6e 206f 7220 7265 662e  flection or ref.
-000164f0: 785f 7265 666c 6563 7469 6f6e 2c0a 2020  x_reflection,.  
-00016500: 2020 2020 2020 6e61 6d65 3d6e 616d 6520        name=name 
-00016510: 6f72 2072 6566 2e6e 616d 652c 0a20 2020  or ref.name,.   
-00016520: 2020 2020 2076 313d 7631 206f 7220 7265       v1=v1 or re
-00016530: 662e 7631 2c0a 2020 2020 2020 2020 7632  f.v1,.        v2
-00016540: 3d76 3220 6f72 2072 6566 2e76 322c 0a20  =v2 or ref.v2,. 
-00016550: 2020 2029 0a0a 0a64 6566 205f 6669 6c74     )...def _filt
-00016560: 6572 5f70 6f6c 7973 2870 6f6c 7967 6f6e  er_polys(polygon
-00016570: 732c 206c 6179 6572 735f 6578 636c 293a  s, layers_excl):
-00016580: 0a20 2020 2072 6574 7572 6e20 5b0a 2020  .    return [.  
-00016590: 2020 2020 2020 706f 6c79 676f 6e0a 2020        polygon.  
-000165a0: 2020 2020 2020 666f 7220 706f 6c79 676f        for polygo
-000165b0: 6e2c 206c 6179 6572 2c20 6461 7461 7479  n, layer, dataty
-000165c0: 7065 2069 6e20 7a69 7028 0a20 2020 2020  pe in zip(.     
-000165d0: 2020 2020 2020 2070 6f6c 7967 6f6e 732e         polygons.
-000165e0: 706f 6c79 676f 6e73 2c20 706f 6c79 676f  polygons, polygo
-000165f0: 6e73 2e6c 6179 6572 732c 2070 6f6c 7967  ns.layers, polyg
-00016600: 6f6e 732e 6461 7461 7479 7065 730a 2020  ons.datatypes.  
-00016610: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00016620: 6966 2028 6c61 7965 722c 2064 6174 6174  if (layer, datat
-00016630: 7970 6529 206e 6f74 2069 6e20 6c61 7965  ype) not in laye
-00016640: 7273 5f65 7863 6c0a 2020 2020 5d0a 0a0a  rs_excl.    ]...
-00016650: 6465 6620 7265 6375 7273 655f 7374 7275  def recurse_stru
-00016660: 6374 7572 6573 280a 2020 2020 636f 6d70  ctures(.    comp
-00016670: 6f6e 656e 743a 2043 6f6d 706f 6e65 6e74  onent: Component
-00016680: 2c0a 2020 2020 6967 6e6f 7265 5f63 6f6d  ,.    ignore_com
-00016690: 706f 6e65 6e74 735f 7072 6566 6978 3a20  ponents_prefix: 
-000166a0: 6c69 7374 5b73 7472 5d20 7c20 4e6f 6e65  list[str] | None
-000166b0: 203d 204e 6f6e 652c 0a20 2020 2069 676e   = None,.    ign
-000166c0: 6f72 655f 6675 6e63 7469 6f6e 735f 7072  ore_functions_pr
-000166d0: 6566 6978 3a20 6c69 7374 5b73 7472 5d20  efix: list[str] 
-000166e0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a29  | None = None,.)
-000166f0: 202d 3e20 6469 6374 5b73 7472 2c20 416e   -> dict[str, An
-00016700: 795d 3a0a 2020 2020 2222 2252 6563 7572  y]:.    """Recur
-00016710: 7365 2063 6f6d 706f 6e65 6e74 2061 6e64  se component and
-00016720: 2063 6f6d 706f 6e65 6e74 7320 7265 6665   components refe
-00016730: 7265 6e63 6573 2072 6563 7572 7369 7665  rences recursive
-00016740: 6c79 2e0a 0a20 2020 2041 7267 733a 0a20  ly...    Args:. 
-00016750: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-00016760: 3a20 636f 6d70 6f6e 656e 7420 746f 2072  : component to r
-00016770: 6563 7572 7365 2e0a 2020 2020 2020 2020  ecurse..        
-00016780: 6967 6e6f 7265 5f63 6f6d 706f 6e65 6e74  ignore_component
-00016790: 735f 7072 6566 6978 3a20 6c69 7374 206f  s_prefix: list o
-000167a0: 6620 7072 6566 6978 2074 6f20 6967 6e6f  f prefix to igno
-000167b0: 7265 2e0a 2020 2020 2020 2020 6967 6e6f  re..        igno
-000167c0: 7265 5f66 756e 6374 696f 6e73 5f70 7265  re_functions_pre
-000167d0: 6669 783a 206c 6973 7420 6f66 2070 7265  fix: list of pre
-000167e0: 6669 7820 746f 2069 676e 6f72 652e 0a20  fix to ignore.. 
-000167f0: 2020 2022 2222 0a20 2020 2069 676e 6f72     """.    ignor
-00016800: 655f 6675 6e63 7469 6f6e 735f 7072 6566  e_functions_pref
-00016810: 6978 203d 2069 676e 6f72 655f 6675 6e63  ix = ignore_func
-00016820: 7469 6f6e 735f 7072 6566 6978 206f 7220  tions_prefix or 
-00016830: 5b5d 0a20 2020 2069 676e 6f72 655f 636f  [].    ignore_co
-00016840: 6d70 6f6e 656e 7473 5f70 7265 6669 7820  mponents_prefix 
-00016850: 3d20 6967 6e6f 7265 5f63 6f6d 706f 6e65  = ignore_compone
-00016860: 6e74 735f 7072 6566 6978 206f 7220 5b5d  nts_prefix or []
-00016870: 0a0a 2020 2020 6966 2028 0a20 2020 2020  ..    if (.     
-00016880: 2020 2068 6173 6174 7472 2863 6f6d 706f     hasattr(compo
-00016890: 6e65 6e74 2c20 2266 756e 6374 696f 6e5f  nent, "function_
-000168a0: 6e61 6d65 2229 0a20 2020 2020 2020 2061  name").        a
-000168b0: 6e64 2063 6f6d 706f 6e65 6e74 2e66 756e  nd component.fun
-000168c0: 6374 696f 6e5f 6e61 6d65 2069 6e20 6967  ction_name in ig
-000168d0: 6e6f 7265 5f66 756e 6374 696f 6e73 5f70  nore_functions_p
-000168e0: 7265 6669 780a 2020 2020 293a 0a20 2020  refix.    ):.   
-000168f0: 2020 2020 2072 6574 7572 6e20 7b7d 0a0a       return {}..
-00016900: 2020 2020 6966 2068 6173 6174 7472 2863      if hasattr(c
-00016910: 6f6d 706f 6e65 6e74 2c20 226e 616d 6522  omponent, "name"
-00016920: 2920 616e 6420 616e 7928 0a20 2020 2020  ) and any(.     
-00016930: 2020 2063 6f6d 706f 6e65 6e74 2e6e 616d     component.nam
-00016940: 652e 7374 6172 7473 7769 7468 2869 2920  e.startswith(i) 
-00016950: 666f 7220 6920 696e 2069 676e 6f72 655f  for i in ignore_
-00016960: 636f 6d70 6f6e 656e 7473 5f70 7265 6669  components_prefi
-00016970: 780a 2020 2020 293a 0a20 2020 2020 2020  x.    ):.       
-00016980: 2072 6574 7572 6e20 7b7d 0a0a 2020 2020   return {}..    
-00016990: 6f75 7470 7574 203d 207b 636f 6d70 6f6e  output = {compon
-000169a0: 656e 742e 6e61 6d65 3a20 6469 6374 2863  ent.name: dict(c
-000169b0: 6f6d 706f 6e65 6e74 2e73 6574 7469 6e67  omponent.setting
-000169c0: 7329 7d0a 2020 2020 666f 7220 7265 6665  s)}.    for refe
-000169d0: 7265 6e63 6520 696e 2063 6f6d 706f 6e65  rence in compone
-000169e0: 6e74 2e72 6566 6572 656e 6365 733a 0a20  nt.references:. 
-000169f0: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
-00016a00: 2020 2020 2020 2020 6973 696e 7374 616e          isinstan
-00016a10: 6365 2872 6566 6572 656e 6365 2c20 436f  ce(reference, Co
-00016a20: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
-00016a30: 290a 2020 2020 2020 2020 2020 2020 616e  ).            an
-00016a40: 6420 7265 6665 7265 6e63 652e 7265 665f  d reference.ref_
-00016a50: 6365 6c6c 2e6e 616d 6520 6e6f 7420 696e  cell.name not in
-00016a60: 206f 7574 7075 740a 2020 2020 2020 2020   output.        
-00016a70: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
-00016a80: 7574 7075 742e 7570 6461 7465 2872 6563  utput.update(rec
-00016a90: 7572 7365 5f73 7472 7563 7475 7265 7328  urse_structures(
-00016aa0: 7265 6665 7265 6e63 652e 7265 665f 6365  reference.ref_ce
-00016ab0: 6c6c 2929 0a0a 2020 2020 7265 7475 726e  ll))..    return
-00016ac0: 206f 7574 7075 740a 0a0a 6465 6620 6765   output...def ge
-00016ad0: 745f 6261 7365 5f63 6f6d 706f 6e65 6e74  t_base_component
-00016ae0: 7328 0a20 2020 2063 6f6d 706f 6e65 6e74  s(.    component
-00016af0: 3a20 6766 2e43 6f6d 706f 6e65 6e74 2c20  : gf.Component, 
-00016b00: 616c 6c6f 775f 656d 7074 793a 2062 6f6f  allow_empty: boo
-00016b10: 6c20 3d20 5472 7565 0a29 202d 3e20 4974  l = True.) -> It
-00016b20: 6572 6174 6f72 5b67 662e 436f 6d70 6f6e  erator[gf.Compon
-00016b30: 656e 745d 3a0a 2020 2020 2222 2247 656e  ent]:.    """Gen
-00016b40: 6572 6174 6f72 2066 756e 6374 696f 6e20  erator function 
-00016b50: 7468 6174 2079 6965 6c64 7320 6261 7365  that yields base
-00016b60: 2063 6f6d 706f 6e65 6e74 7320 6f66 2061   components of a
-00016b70: 2067 6976 656e 2063 6f6d 706f 6e65 6e74   given component
-00016b80: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-00016b90: 733a 0a20 2020 2020 2020 2063 6f6d 706f  s:.        compo
-00016ba0: 6e65 6e74 2028 6766 2e43 6f6d 706f 6e65  nent (gf.Compone
-00016bb0: 6e74 293a 2054 6865 2063 6f6d 706f 6e65  nt): The compone
-00016bc0: 6e74 2077 686f 7365 2062 6173 6520 636f  nt whose base co
-00016bd0: 6d70 6f6e 656e 7473 2061 7265 2074 6f20  mponents are to 
-00016be0: 6265 2066 6f75 6e64 2e0a 2020 2020 2020  be found..      
-00016bf0: 2020 616c 6c6f 775f 656d 7074 7920 2862    allow_empty (b
-00016c00: 6f6f 6c29 3a20 4966 2054 7275 652c 2061  ool): If True, a
-00016c10: 6c6c 6f77 7320 7969 656c 6469 6e67 206f  llows yielding o
-00016c20: 6620 636f 6d70 6f6e 656e 7473 2077 6974  f components wit
-00016c30: 686f 7574 2070 6f6c 7967 6f6e 732e 0a0a  hout polygons...
-00016c40: 2020 2020 5969 656c 6473 3a0a 2020 2020      Yields:.    
-00016c50: 2020 2020 6766 2e43 6f6d 706f 6e65 6e74      gf.Component
-00016c60: 3a20 5468 6520 6261 7365 2063 6f6d 706f  : The base compo
-00016c70: 6e65 6e74 7320 6f66 2074 6865 2067 6976  nents of the giv
-00016c80: 656e 2063 6f6d 706f 6e65 6e74 2e0a 2020  en component..  
-00016c90: 2020 2222 220a 2020 2020 6966 206e 6f74    """.    if not
-00016ca0: 2063 6f6d 706f 6e65 6e74 2e72 6566 6572   component.refer
-00016cb0: 656e 6365 7320 616e 6420 2863 6f6d 706f  ences and (compo
-00016cc0: 6e65 6e74 2e70 6f6c 7967 6f6e 7320 6f72  nent.polygons or
-00016cd0: 2061 6c6c 6f77 5f65 6d70 7479 293a 0a20   allow_empty):. 
-00016ce0: 2020 2020 2020 2079 6965 6c64 2063 6f6d         yield com
-00016cf0: 706f 6e65 6e74 0a20 2020 2066 6f72 2072  ponent.    for r
-00016d00: 6566 2069 6e20 636f 6d70 6f6e 656e 742e  ef in component.
-00016d10: 7265 6665 7265 6e63 6573 3a0a 2020 2020  references:.    
-00016d20: 2020 2020 7969 656c 6420 6672 6f6d 2067      yield from g
-00016d30: 6574 5f62 6173 655f 636f 6d70 6f6e 656e  et_base_componen
-00016d40: 7473 2872 6566 2e70 6172 656e 742c 2061  ts(ref.parent, a
-00016d50: 6c6c 6f77 5f65 6d70 7479 290a 0a0a 6465  llow_empty)...de
-00016d60: 6620 666c 6174 7465 6e5f 696e 7661 6c69  f flatten_invali
-00016d70: 645f 7265 6673 5f72 6563 7572 7369 7665  d_refs_recursive
-00016d80: 280a 2020 2020 636f 6d70 6f6e 656e 743a  (.    component:
-00016d90: 2043 6f6d 706f 6e65 6e74 2c0a 2020 2020   Component,.    
-00016da0: 6772 6964 5f73 697a 653a 2066 6c6f 6174  grid_size: float
-00016db0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00016dc0: 2020 2020 7570 6461 7465 645f 636f 6d70      updated_comp
-00016dd0: 6f6e 656e 7473 3d4e 6f6e 652c 0a20 2020  onents=None,.   
-00016de0: 2074 7261 7665 7273 6564 5f63 6f6d 706f   traversed_compo
-00016df0: 6e65 6e74 733d 4e6f 6e65 2c0a 2920 2d3e  nents=None,.) ->
-00016e00: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
-00016e10: 2222 2252 6563 7572 7369 7665 6c79 2066  """Recursively f
-00016e20: 6c61 7474 656e 7320 636f 6d70 6f6e 656e  lattens componen
-00016e30: 7420 7265 6665 7265 6e63 6573 2077 6869  t references whi
-00016e40: 6368 2068 6176 6520 696e 7661 6c69 6420  ch have invalid 
-00016e50: 7472 616e 7366 6f72 6d61 7469 6f6e 730a  transformations.
-00016e60: 2020 2020 2869 2e65 2e20 6e6f 6e2d 3930      (i.e. non-90
-00016e70: 2064 6567 2072 6f74 6174 696f 6e73 206f   deg rotations o
-00016e80: 7220 7375 622d 6772 6964 2074 7261 6e73  r sub-grid trans
-00016e90: 6c61 7469 6f6e 7329 0a20 2020 2072 6574  lations).    ret
-00016ea0: 7572 6e73 2061 2063 6f70 7920 6966 2061  urns a copy if a
-00016eb0: 6e79 2073 7562 6365 6c6c 7320 6861 7665  ny subcells have
-00016ec0: 2062 6565 6e20 6d6f 6469 6669 6564 2e0a   been modified..
-00016ed0: 0a20 2020 2057 4152 4e49 4e47 3a20 7468  .    WARNING: th
-00016ee0: 6973 2066 756e 6374 696f 6e20 7769 6c6c  is function will
-00016ef0: 2070 726f 6475 6365 2073 616d 652d 6e61   produce same-na
-00016f00: 6d65 2063 6f70 6965 7320 6f66 2063 656c  me copies of cel
-00016f10: 6c73 2e0a 2020 2020 4974 2069 7320 7374  ls..    It is st
-00016f20: 7269 6374 6c79 206d 6561 6e74 2074 6f20  rictly meant to 
-00016f30: 6265 2075 7365 6420 6f6e 2077 7269 7465  be used on write
-00016f40: 206f 6620 7468 6520 4744 5320 6669 6c65   of the GDS file
-00016f50: 2061 6e64 0a20 2020 2073 686f 756c 6420   and.    should 
-00016f60: 6e6f 7420 6265 206d 6978 6564 2077 6974  not be mixed wit
-00016f70: 6820 6f74 6865 7220 6365 6c6c 732c 0a20  h other cells,. 
-00016f80: 2020 206f 7220 796f 7520 7769 6c6c 206c     or you will l
-00016f90: 696b 656c 7920 6578 7065 7269 656e 6365  ikely experience
-00016fa0: 2069 7373 7565 7320 7769 7468 2064 7570   issues with dup
-00016fb0: 6c69 6361 7465 2063 656c 6c73 0a0a 2020  licate cells..  
-00016fc0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00016fd0: 636f 6d70 6f6e 656e 743a 2074 6865 2063  component: the c
-00016fe0: 6f6d 706f 6e65 6e74 2074 6f20 6669 7820  omponent to fix 
-00016ff0: 2869 6e20 706c 6163 6529 2e0a 2020 2020  (in place)..    
-00017000: 2020 2020 6772 6964 5f73 697a 653a 2074      grid_size: t
-00017010: 6865 2047 4453 2067 7269 6420 7369 7a65  he GDS grid size
-00017020: 2c20 696e 2075 6d2c 2064 6566 6175 6c74  , in um, default
-00017030: 7320 746f 2061 6374 6976 6520 5044 4b2e  s to active PDK.
-00017040: 6765 745f 6772 6964 5f73 697a 6528 290a  get_grid_size().
-00017050: 2020 2020 2020 2020 2020 2020 616e 7920              any 
-00017060: 7472 616e 736c 6174 696f 6e73 2077 6974  translations wit
-00017070: 6820 6869 6768 6572 2072 6573 6f6c 7574  h higher resolut
-00017080: 696f 6e20 7468 616e 2074 6869 7320 6172  ion than this ar
-00017090: 6520 636f 6e73 6964 6572 6564 2069 6e76  e considered inv
-000170a0: 616c 6964 2e0a 2020 2020 2020 2020 7570  alid..        up
-000170b0: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
-000170c0: 3a20 6469 6374 206f 6620 636f 6d70 6f6e  : dict of compon
-000170d0: 656e 7473 2074 7261 6e73 666f 726d 6564  ents transformed
-000170e0: 2e0a 2020 2020 2020 2020 2020 2020 5368  ..            Sh
-000170f0: 6f75 6c64 2061 6c77 6179 7320 6265 204e  ould always be N
-00017100: 6f6e 652c 2065 7863 6570 7420 666f 7220  one, except for 
-00017110: 7265 6375 7273 6976 652e 0a20 2020 2020  recursive..     
-00017120: 2020 2074 7261 7665 7273 6564 5f63 6f6d     traversed_com
-00017130: 706f 6e65 6e74 733a 2074 6865 2073 6574  ponents: the set
-00017140: 206f 6620 636f 6d70 6f6e 656e 7420 6e61   of component na
-00017150: 6d65 7320 7768 6963 6820 6861 7665 2062  mes which have b
-00017160: 6565 6e20 7472 6176 6572 7365 642e 0a20  een traversed.. 
-00017170: 2020 2020 2020 2020 2020 2053 686f 756c             Shoul
-00017180: 6420 616c 7761 7973 2062 6520 4e6f 6e65  d always be None
-00017190: 2c20 6578 6365 7074 2066 6f72 2072 6563  , except for rec
-000171a0: 7572 7369 7665 2069 6e76 6f63 6174 696f  ursive invocatio
-000171b0: 6e73 2e0a 2020 2020 2222 220a 2020 2020  ns..    """.    
-000171c0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-000171d0: 6465 636f 7261 746f 7273 2069 6d70 6f72  decorators impor
-000171e0: 7420 6973 5f69 6e76 616c 6964 5f72 6566  t is_invalid_ref
-000171f0: 0a0a 2020 2020 696e 7661 6c69 645f 7265  ..    invalid_re
-00017200: 6673 203d 205b 5d0a 2020 2020 7265 6673  fs = [].    refs
-00017210: 203d 2063 6f6d 706f 6e65 6e74 2e72 6566   = component.ref
-00017220: 6572 656e 6365 730a 2020 2020 7375 6263  erences.    subc
-00017230: 656c 6c5f 6d6f 6469 6669 6564 203d 2046  ell_modified = F
-00017240: 616c 7365 0a20 2020 2075 7064 6174 6564  alse.    updated
-00017250: 5f63 6f6d 706f 6e65 6e74 7320 3d20 7570  _components = up
-00017260: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
-00017270: 206f 7220 7b7d 0a20 2020 2074 7261 7665   or {}.    trave
-00017280: 7273 6564 5f63 6f6d 706f 6e65 6e74 7320  rsed_components 
-00017290: 3d20 7472 6176 6572 7365 645f 636f 6d70  = traversed_comp
-000172a0: 6f6e 656e 7473 206f 7220 7365 7428 290a  onents or set().
-000172b0: 0a20 2020 2066 6f72 2072 6566 2069 6e20  .    for ref in 
-000172c0: 7265 6673 3a0a 2020 2020 2020 2020 2320  refs:.        # 
-000172d0: 6d61 726b 2061 6e79 2069 6e76 616c 6964  mark any invalid
-000172e0: 2072 6566 7320 666f 7220 666c 6174 7465   refs for flatte
-000172f0: 6e69 6e67 0a20 2020 2020 2020 2023 206f  ning.        # o
-00017300: 7468 6572 7769 7365 2c20 6368 6563 6b20  therwise, check 
-00017310: 6966 2074 6865 7265 2061 7265 2061 6e79  if there are any
-00017320: 206d 6f64 6966 6965 6420 6365 6c6c 7320   modified cells 
-00017330: 6265 6e65 6174 6820 2877 6520 6e65 6564  beneath (we need
-00017340: 206e 6f74 2064 6f20 7468 6973 2069 6620   not do this if 
-00017350: 7468 6520 7265 6620 7769 6c6c 2062 6520  the ref will be 
-00017360: 666c 6174 7465 6e65 6420 616e 7977 6179  flattened anyway
-00017370: 7329 0a20 2020 2020 2020 2069 6620 6973  s).        if is
-00017380: 5f69 6e76 616c 6964 5f72 6566 2872 6566  _invalid_ref(ref
-00017390: 2c20 6772 6964 5f73 697a 6529 3a0a 2020  , grid_size):.  
-000173a0: 2020 2020 2020 2020 2020 696e 7661 6c69            invali
-000173b0: 645f 7265 6673 2e61 7070 656e 6428 7265  d_refs.append(re
-000173c0: 662e 6e61 6d65 290a 2020 2020 2020 2020  f.name).        
-000173d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000173e0: 2020 2320 6f74 6865 7277 6973 652c 2072    # otherwise, r
-000173f0: 6563 7572 7369 7665 6c79 2066 6c61 7474  ecursively flatt
-00017400: 656e 2072 6566 7320 6966 2074 6865 2073  en refs if the s
-00017410: 7562 6365 6c6c 2068 6173 206e 6f74 2061  ubcell has not a
-00017420: 6c72 6561 6479 2062 6565 6e20 7472 6176  lready been trav
-00017430: 6572 7365 640a 2020 2020 2020 2020 2020  ersed.          
-00017440: 2020 6966 2072 6566 2e70 6172 656e 742e    if ref.parent.
-00017450: 6e61 6d65 206e 6f74 2069 6e20 7472 6176  name not in trav
-00017460: 6572 7365 645f 636f 6d70 6f6e 656e 7473  ersed_components
-00017470: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017480: 2020 666c 6174 7465 6e5f 696e 7661 6c69    flatten_invali
-00017490: 645f 7265 6673 5f72 6563 7572 7369 7665  d_refs_recursive
-000174a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000174b0: 2020 2020 2020 7265 662e 7061 7265 6e74        ref.parent
-000174c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000174d0: 2020 2020 2020 6772 6964 5f73 697a 653d        grid_size=
-000174e0: 6772 6964 5f73 697a 652c 0a20 2020 2020  grid_size,.     
-000174f0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00017500: 7064 6174 6564 5f63 6f6d 706f 6e65 6e74  pdated_component
-00017510: 733d 7570 6461 7465 645f 636f 6d70 6f6e  s=updated_compon
-00017520: 656e 7473 2c0a 2020 2020 2020 2020 2020  ents,.          
-00017530: 2020 2020 2020 2020 2020 7472 6176 6572            traver
-00017540: 7365 645f 636f 6d70 6f6e 656e 7473 3d74  sed_components=t
-00017550: 7261 7665 7273 6564 5f63 6f6d 706f 6e65  raversed_compone
-00017560: 6e74 732c 0a20 2020 2020 2020 2020 2020  nts,.           
-00017570: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00017580: 2020 2023 206e 6f77 2c20 6966 2074 6865     # now, if the
-00017590: 2072 6566 2773 2063 656c 6c20 6265 656e   ref's cell been
-000175a0: 206d 6f64 6966 6965 642c 206d 6172 6b20   modified, mark 
-000175b0: 6974 2061 7320 7375 6368 0a20 2020 2020  it as such.     
-000175c0: 2020 2020 2020 2069 6620 7265 662e 7061         if ref.pa
-000175d0: 7265 6e74 2e6e 616d 6520 696e 2075 7064  rent.name in upd
-000175e0: 6174 6564 5f63 6f6d 706f 6e65 6e74 733a  ated_components:
-000175f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017600: 2073 7562 6365 6c6c 5f6d 6f64 6966 6965   subcell_modifie
-00017610: 6420 3d20 5472 7565 0a20 2020 2069 6620  d = True.    if 
-00017620: 696e 7661 6c69 645f 7265 6673 206f 7220  invalid_refs or 
-00017630: 7375 6263 656c 6c5f 6d6f 6469 6669 6564  subcell_modified
-00017640: 3a0a 2020 2020 2020 2020 2320 6966 2074  :.        # if t
-00017650: 6865 2063 656c 6c20 6f72 2073 7562 6365  he cell or subce
-00017660: 6c6c 7320 6e65 6564 2074 6f20 6861 7665  lls need to have
-00017670: 2072 6566 6572 656e 6365 7320 666c 6174   references flat
-00017680: 7465 6e65 642c 2063 7265 6174 6520 616e  tened, create an
-00017690: 2075 6e63 6163 6865 6420 636f 7079 206f   uncached copy o
-000176a0: 6620 7468 6973 2063 656c 6c20 666f 7220  f this cell for 
-000176b0: 6578 706f 7274 0a20 2020 2020 2020 206e  export.        n
-000176c0: 6577 5f63 6f6d 706f 6e65 6e74 203d 2063  ew_component = c
-000176d0: 6f6d 706f 6e65 6e74 2e63 6f70 7928 290a  omponent.copy().
-000176e0: 2020 2020 2020 2020 6e65 775f 636f 6d70          new_comp
-000176f0: 6f6e 656e 742e 7265 6e61 6d65 2863 6f6d  onent.rename(com
-00017700: 706f 6e65 6e74 2e6e 616d 652c 2063 6163  ponent.name, cac
-00017710: 6865 3d46 616c 7365 290a 0a20 2020 2020  he=False)..     
-00017720: 2020 2023 206d 616b 6520 7375 7265 2061     # make sure a
-00017730: 6c6c 206d 6f64 6966 6965 6420 6365 6c6c  ll modified cell
-00017740: 7320 6861 7665 2074 6865 6972 2072 6566  s have their ref
-00017750: 6572 656e 6365 7320 7570 6461 7465 640a  erences updated.
-00017760: 2020 2020 2020 2020 6e65 775f 7265 6673          new_refs
-00017770: 203d 206e 6577 5f63 6f6d 706f 6e65 6e74   = new_component
-00017780: 2e72 6566 6572 656e 6365 732e 636f 7079  .references.copy
-00017790: 2829 0a20 2020 2020 2020 2066 6f72 2072  ().        for r
-000177a0: 6566 2069 6e20 6e65 775f 7265 6673 3a0a  ef in new_refs:.
-000177b0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-000177c0: 6566 2e6e 616d 6520 696e 2069 6e76 616c  ef.name in inval
-000177d0: 6964 5f72 6566 733a 0a20 2020 2020 2020  id_refs:.       
-000177e0: 2020 2020 2020 2020 206e 6577 5f63 6f6d           new_com
-000177f0: 706f 6e65 6e74 2e66 6c61 7474 656e 5f72  ponent.flatten_r
-00017800: 6566 6572 656e 6365 2872 6566 290a 2020  eference(ref).  
-00017810: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
-00017820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017830: 2072 6566 2e70 6172 656e 742e 6e61 6d65   ref.parent.name
-00017840: 2069 6e20 7570 6461 7465 645f 636f 6d70   in updated_comp
-00017850: 6f6e 656e 7473 0a20 2020 2020 2020 2020  onents.         
-00017860: 2020 2020 2020 2061 6e64 2072 6566 2e70         and ref.p
-00017870: 6172 656e 7420 6973 206e 6f74 2075 7064  arent is not upd
-00017880: 6174 6564 5f63 6f6d 706f 6e65 6e74 735b  ated_components[
-00017890: 7265 662e 7061 7265 6e74 2e6e 616d 655d  ref.parent.name]
-000178a0: 0a20 2020 2020 2020 2020 2020 2029 3a0a  .            ):.
-000178b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178c0: 7265 662e 7061 7265 6e74 203d 2075 7064  ref.parent = upd
-000178d0: 6174 6564 5f63 6f6d 706f 6e65 6e74 735b  ated_components[
-000178e0: 7265 662e 7061 7265 6e74 2e6e 616d 655d  ref.parent.name]
-000178f0: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
-00017900: 6e74 203d 206e 6577 5f63 6f6d 706f 6e65  nt = new_compone
-00017910: 6e74 0a20 2020 2020 2020 2075 7064 6174  nt.        updat
-00017920: 6564 5f63 6f6d 706f 6e65 6e74 735b 636f  ed_components[co
-00017930: 6d70 6f6e 656e 742e 6e61 6d65 5d20 3d20  mponent.name] = 
-00017940: 6e65 775f 636f 6d70 6f6e 656e 740a 2020  new_component.  
-00017950: 2020 7472 6176 6572 7365 645f 636f 6d70    traversed_comp
-00017960: 6f6e 656e 7473 2e61 6464 2863 6f6d 706f  onents.add(compo
-00017970: 6e65 6e74 2e6e 616d 6529 0a20 2020 2072  nent.name).    r
-00017980: 6574 7572 6e20 636f 6d70 6f6e 656e 740a  eturn component.
-00017990: 0a0a 6465 6620 5f63 6865 636b 5f75 6e63  ..def _check_unc
-000179a0: 6163 6865 645f 636f 6d70 6f6e 656e 7473  ached_components
-000179b0: 2863 6f6d 706f 6e65 6e74 2c20 6d6f 6465  (component, mode
-000179c0: 293a 0a20 2020 2076 616c 6964 5f6d 6f64  ):.    valid_mod
-000179d0: 6573 203d 205b 2277 6172 6e22 2c20 2265  es = ["warn", "e
-000179e0: 7272 6f72 222c 2022 6967 6e6f 7265 225d  rror", "ignore"]
-000179f0: 0a0a 2020 2020 6966 206d 6f64 6520 3d3d  ..    if mode ==
-00017a00: 2022 6967 6e6f 7265 223a 0a20 2020 2020   "ignore":.     
-00017a10: 2020 2072 6574 7572 6e0a 2020 2020 656c     return.    el
-00017a20: 6966 206d 6f64 6520 6e6f 7420 696e 2076  if mode not in v
-00017a30: 616c 6964 5f6d 6f64 6573 3a0a 2020 2020  alid_modes:.    
-00017a40: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00017a50: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00017a60: 2020 6622 7b6d 6f64 657d 2069 7320 6e6f    f"{mode} is no
-00017a70: 7420 6120 7661 6c69 6420 7661 6c75 6520  t a valid value 
-00017a80: 666f 7220 6f6e 5f75 6e63 6163 6865 645f  for on_uncached_
-00017a90: 636f 6d70 6f6e 656e 742e 2054 7279 206f  component. Try o
-00017aa0: 6e65 206f 6620 7468 6573 653a 207b 7661  ne of these: {va
-00017ab0: 6c69 645f 6d6f 6465 737d 2e22 0a20 2020  lid_modes}.".   
-00017ac0: 2020 2020 2029 0a0a 2020 2020 666f 7220       )..    for 
-00017ad0: 7375 625f 636f 6d70 6f6e 656e 7420 696e  sub_component in
-00017ae0: 2063 6f6d 706f 6e65 6e74 2e67 6574 5f64   component.get_d
-00017af0: 6570 656e 6465 6e63 6965 7328 7265 6375  ependencies(recu
-00017b00: 7273 6976 653d 5472 7565 293a 0a20 2020  rsive=True):.   
-00017b10: 2020 2020 2069 6620 6e6f 7420 7375 625f       if not sub_
-00017b20: 636f 6d70 6f6e 656e 742e 5f6c 6f63 6b65  component._locke
-00017b30: 643a 0a20 2020 2020 2020 2020 2020 206d  d:.            m
-00017b40: 6573 7361 6765 203d 2028 0a20 2020 2020  essage = (.     
-00017b50: 2020 2020 2020 2020 2020 2066 2243 6f6d             f"Com
-00017b60: 706f 6e65 6e74 207b 7375 625f 636f 6d70  ponent {sub_comp
-00017b70: 6f6e 656e 742e 6e61 6d65 2172 7d20 7761  onent.name!r} wa
-00017b80: 7320 4e4f 5420 7072 6f70 6572 6c79 206c  s NOT properly l
-00017b90: 6f63 6b65 642e 2022 0a20 2020 2020 2020  ocked. ".       
-00017ba0: 2020 2020 2020 2020 2022 596f 7520 6e65           "You ne
-00017bb0: 6564 2074 6f20 7772 6974 6520 6974 2069  ed to write it i
-00017bc0: 6e74 6f20 6120 6675 6e63 7469 6f6e 2074  nto a function t
-00017bd0: 6861 7420 6861 7320 7468 6520 4063 656c  hat has the @cel
-00017be0: 6c20 6465 636f 7261 746f 722e 220a 2020  l decorator.".  
-00017bf0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00017c00: 2020 2020 2020 2020 6966 206d 6f64 6520          if mode 
-00017c10: 3d3d 2022 7761 726e 223a 0a20 2020 2020  == "warn":.     
-00017c20: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-00017c30: 6e67 732e 7761 726e 286d 6573 7361 6765  ngs.warn(message
-00017c40: 2c20 556e 6361 6368 6564 436f 6d70 6f6e  , UncachedCompon
-00017c50: 656e 7457 6172 6e69 6e67 2c20 7374 6163  entWarning, stac
-00017c60: 6b6c 6576 656c 3d33 290a 0a20 2020 2020  klevel=3)..     
-00017c70: 2020 2020 2020 2065 6c69 6620 6d6f 6465         elif mode
-00017c80: 203d 3d20 2265 7272 6f72 223a 0a20 2020   == "error":.   
-00017c90: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00017ca0: 7365 2055 6e63 6163 6865 6443 6f6d 706f  se UncachedCompo
-00017cb0: 6e65 6e74 4572 726f 7228 6d65 7373 6167  nentError(messag
-00017cc0: 6529 0a0a 0a69 6620 5f5f 6e61 6d65 5f5f  e)...if __name__
-00017cd0: 203d 3d20 225f 5f6d 6169 6e5f 5f22 3a0a   == "__main__":.
-00017ce0: 2020 2020 2320 6672 6f6d 2066 756e 6374      # from funct
-00017cf0: 6f6f 6c73 2069 6d70 6f72 7420 7061 7274  ools import part
-00017d00: 6961 6c0a 2020 2020 696d 706f 7274 2067  ial.    import g
-00017d10: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
-00017d20: 0a20 2020 2063 203d 2067 662e 436f 6d70  .    c = gf.Comp
-00017d30: 6f6e 656e 7428 290a 2020 2020 7767 3120  onent().    wg1 
-00017d40: 3d20 6320 3c3c 2067 662e 636f 6d70 6f6e  = c << gf.compon
-00017d50: 656e 7473 2e73 7472 6169 6768 7428 7769  ents.straight(wi
-00017d60: 6474 683d 302e 352c 206c 6179 6572 3d28  dth=0.5, layer=(
-00017d70: 312c 2030 2929 0a20 2020 2077 6732 203d  1, 0)).    wg2 =
-00017d80: 2063 203c 3c20 6766 2e63 6f6d 706f 6e65   c << gf.compone
-00017d90: 6e74 732e 7374 7261 6967 6874 2877 6964  nts.straight(wid
-00017da0: 7468 3d30 2e35 2c20 6c61 7965 723d 2832  th=0.5, layer=(2
-00017db0: 2c20 3029 290a 2020 2020 7767 322e 636f  , 0)).    wg2.co
-00017dc0: 6e6e 6563 7428 226f 3122 2c20 7767 312e  nnect("o1", wg1.
-00017dd0: 706f 7274 735b 226f 3222 5d29 0a20 2020  ports["o2"]).   
-00017de0: 2063 2e73 686f 7728 290a 2020 2020 2320   c.show().    # 
-00017df0: 6375 7374 6f6d 5f70 6164 6469 6e67 203d  custom_padding =
-00017e00: 2070 6172 7469 616c 2867 662e 6164 645f   partial(gf.add_
-00017e10: 7061 6464 696e 672c 206c 6179 6572 733d  padding, layers=
-00017e20: 2822 5747 222c 2929 0a20 2020 2023 2063  ("WG",)).    # c
-00017e30: 203d 2067 662e 632e 6d7a 6928 6465 636f   = gf.c.mzi(deco
-00017e40: 7261 746f 723d 6375 7374 6f6d 5f70 6164  rator=custom_pad
-00017e50: 6469 6e67 290a 0a20 2020 2023 2063 203d  ding)..    # c =
-00017e60: 2063 2e63 6f70 7928 290a 2020 2020 2320   c.copy().    # 
-00017e70: 6320 3d20 632e 7265 6d61 705f 6c61 7965  c = c.remap_laye
-00017e80: 7273 287b 2831 2c20 3029 3a20 2833 2c20  rs({(1, 0): (3, 
-00017e90: 3029 7d29 0a0a 2020 2020 2320 632e 5f63  0)})..    # c._c
-00017ea0: 656c 6c2e 7265 6d61 7028 7b28 312c 2030  ell.remap({(1, 0
-00017eb0: 293a 2028 332c 2030 297d 290a 2020 2020  ): (3, 0)}).    
-00017ec0: 2320 6c69 6220 3d20 6764 7374 6b2e 4c69  # lib = gdstk.Li
-00017ed0: 6272 6172 7928 290a 2020 2020 2320 6c69  brary().    # li
-00017ee0: 622e 6164 6428 632e 5f63 656c 6c29 0a20  b.add(c._cell). 
-00017ef0: 2020 2023 206c 6962 2e72 656d 6170 287b     # lib.remap({
-00017f00: 2831 2c20 3029 3a20 2832 2c20 3029 7d29  (1, 0): (2, 0)})
-00017f10: 0a20 2020 2023 2063 3220 3d20 6c69 625b  .    # c2 = lib[
-00017f20: 632e 6e61 6d65 5d0a 2020 2020 2320 632e  c.name].    # c.
-00017f30: 5f63 656c 6c20 3d20 6332 0a20 2020 2023  _cell = c2.    #
-00017f40: 2063 2e73 686f 7728 290a 0a20 2020 2023   c.show()..    #
-00017f50: 2067 662e 636f 6e66 6967 2e65 6e61 626c   gf.config.enabl
-00017f60: 655f 6f66 665f 6772 6964 5f70 6f72 7473  e_off_grid_ports
-00017f70: 2829 0a0a 2020 2020 2320 6320 3d20 6766  ()..    # c = gf
-00017f80: 2e43 6f6d 706f 6e65 6e74 2822 6265 6e64  .Component("bend
-00017f90: 2229 0a20 2020 2023 2062 203d 2063 203c  ").    # b = c <
-00017fa0: 3c20 6766 2e63 6f6d 706f 6e65 6e74 732e  < gf.components.
-00017fb0: 6265 6e64 5f63 6972 6375 6c61 7228 616e  bend_circular(an
-00017fc0: 676c 653d 3330 290a 2020 2020 2320 7320  gle=30).    # s 
-00017fd0: 3d20 6320 3c3c 2067 662e 636f 6d70 6f6e  = c << gf.compon
-00017fe0: 656e 7473 2e73 7472 6169 6768 7428 6c65  ents.straight(le
-00017ff0: 6e67 7468 3d35 290a 2020 2020 2320 732e  ngth=5).    # s.
-00018000: 636f 6e6e 6563 7428 226f 3122 2c20 622e  connect("o1", b.
-00018010: 706f 7274 735b 226f 3222 5d29 0a20 2020  ports["o2"]).   
-00018020: 2023 2070 5f73 6861 7065 6c79 203d 2063   # p_shapely = c
-00018030: 2e67 6574 5f70 6f6c 7967 6f6e 7328 6173  .get_polygons(as
-00018040: 5f73 6861 7065 6c79 5f6d 6572 6765 643d  _shapely_merged=
-00018050: 5472 7565 290a 2020 2020 2320 6332 203d  True).    # c2 =
-00018060: 2067 662e 436f 6d70 6f6e 656e 7428 2262   gf.Component("b
-00018070: 656e 645f 6669 7865 6422 290a 2020 2020  end_fixed").    
-00018080: 2320 6332 2e61 6464 5f70 6f6c 7967 6f6e  # c2.add_polygon
-00018090: 2870 5f73 6861 7065 6c79 2c20 6c61 7965  (p_shapely, laye
-000180a0: 723d 2831 2c20 3029 290a 2020 2020 2320  r=(1, 0)).    # 
-000180b0: 6332 2e70 6c6f 7428 290a 0a20 2020 2023  c2.plot()..    #
-000180c0: 2063 203d 2067 662e 632e 6d7a 6928 666c   c = gf.c.mzi(fl
-000180d0: 6174 7465 6e3d 5472 7565 2c20 6465 636f  atten=True, deco
-000180e0: 7261 746f 723d 6766 2e72 6f75 7469 6e67  rator=gf.routing
-000180f0: 2e61 6464 5f66 6962 6572 5f73 696e 676c  .add_fiber_singl
-00018100: 6529 0a20 2020 2023 2023 2070 7269 6e74  e).    # # print
-00018110: 2863 2e6e 616d 6529 0a20 2020 2023 2063  (c.name).    # c
-00018120: 2e73 686f 7728 290a 0a20 2020 2023 2063  .show()..    # c
-00018130: 203d 2067 662e 632e 6d7a 6928 290a 2020   = gf.c.mzi().  
-00018140: 2020 2320 6669 6720 3d20 632e 706c 6f74    # fig = c.plot
-00018150: 5f6b 6c61 796f 7574 2829 0a20 2020 2023  _klayout().    #
-00018160: 2066 6967 2e73 6176 6566 6967 2822 6d7a   fig.savefig("mz
-00018170: 692e 706e 6722 290a 2020 2020 2320 632e  i.png").    # c.
-00018180: 7070 7269 6e74 5f70 6f72 7473 2829 0a0a  pprint_ports()..
-00018190: 2020 2020 2320 6320 3d20 6766 2e43 6f6d      # c = gf.Com
-000181a0: 706f 6e65 6e74 2822 6869 2220 2a20 3230  ponent("hi" * 20
-000181b0: 3029 0a20 2020 2023 2070 7269 6e74 2863  0).    # print(c
-000181c0: 2e6e 616d 6529 0a0a 2020 2020 2320 6320  .name)..    # c 
-000181d0: 3d20 6766 2e43 6f6d 706f 6e65 6e74 2822  = gf.Component("
-000181e0: 6869 2220 2a20 3230 3029 0a20 2020 2023  hi" * 200).    #
-000181f0: 2070 7269 6e74 2863 2e6e 616d 6529 0a20   print(c.name). 
-00018200: 2020 2023 2070 203d 2063 2e61 6464 5f70     # p = c.add_p
-00018210: 6f6c 7967 6f6e 280a 2020 2020 2320 2020  olygon(.    #   
-00018220: 2020 5b28 2d38 2c20 362c 2037 2c20 3929    [(-8, 6, 7, 9)
-00018230: 2c20 282d 362c 2038 2c20 3137 2c20 3529  , (-6, 8, 17, 5)
-00018240: 5d2c 206c 6179 6572 3d28 312c 2030 290a  ], layer=(1, 0).
-00018250: 2020 2020 2320 2920 2023 2047 4453 206c      # )  # GDS l
-00018260: 6179 6572 7320 6172 6520 7475 706c 6573  ayers are tuples
-00018270: 206f 6620 696e 7473 2028 6275 7420 6966   of ints (but if
-00018280: 2077 6520 7573 6520 6f6e 6c79 206f 6e65   we use only one
-00018290: 206e 756d 6265 7220 6974 2061 7373 756d   number it assum
-000182a0: 6573 2074 6865 206f 7468 6572 206e 756d  es the other num
-000182b0: 6265 7220 6973 2030 290a 2020 2020 2320  ber is 0).    # 
-000182c0: 632e 7772 6974 655f 6764 7328 2268 692e  c.write_gds("hi.
-000182d0: 6764 7322 290a 2020 2020 2320 632e 7368  gds").    # c.sh
-000182e0: 6f77 2829 0a20 2020 2023 2070 7269 6e74  ow().    # print
-000182f0: 2843 4f4e 462e 6c61 7374 5f73 6176 6564  (CONF.last_saved
-00018300: 5f66 696c 6573 290a                      _files).
+00000250: 696d 706f 7274 2028 0a20 2020 2043 656c  import (.    Cel
+00000260: 6c53 6574 7469 6e67 732c 0a20 2020 2043  lSettings,.    C
+00000270: 6f6d 706f 6e65 6e74 5370 6563 2c0a 2020  omponentSpec,.  
+00000280: 2020 496e 666f 2c0a 2020 2020 4c61 6265    Info,.    Labe
+00000290: 6c2c 0a20 2020 205f 616c 6967 6e2c 0a20  l,.    _align,. 
+000002a0: 2020 205f 6469 7374 7269 6275 7465 2c0a     _distribute,.
+000002b0: 2020 2020 5f47 656f 6d65 7472 7948 656c      _GeometryHel
+000002c0: 7065 722c 0a20 2020 205f 7061 7273 655f  per,.    _parse_
+000002d0: 6c61 7965 722c 0a20 2020 2067 6574 5f70  layer,.    get_p
+000002e0: 6f6c 7967 6f6e 732c 0a20 2020 2070 7072  olygons,.    ppr
+000002f0: 696e 745f 706f 7274 732c 0a29 0a66 726f  int_ports,.).fro
+00000300: 6d20 6764 7366 6163 746f 7279 2e63 6f6d  m gdsfactory.com
+00000310: 706f 6e65 6e74 5f72 6566 6572 656e 6365  ponent_reference
+00000320: 2069 6d70 6f72 7420 436f 6d70 6f6e 656e   import Componen
+00000330: 7452 6566 6572 656e 6365 2c20 5369 7a65  tReference, Size
+00000340: 496e 666f 0a66 726f 6d20 6764 7366 6163  Info.from gdsfac
+00000350: 746f 7279 2e63 6f6e 6669 6720 696d 706f  tory.config impo
+00000360: 7274 2043 4f4e 462c 2047 4453 4449 525f  rt CONF, GDSDIR_
+00000370: 5445 4d50 2c20 6c6f 6767 6572 0a66 726f  TEMP, logger.fro
+00000380: 6d20 6764 7366 6163 746f 7279 2e6e 616d  m gdsfactory.nam
+00000390: 6520 696d 706f 7274 2067 6574 5f6e 616d  e import get_nam
+000003a0: 655f 7368 6f72 740a 6672 6f6d 2067 6473  e_short.from gds
+000003b0: 6661 6374 6f72 792e 706f 6c79 676f 6e20  factory.polygon 
+000003c0: 696d 706f 7274 2050 6f6c 7967 6f6e 0a66  import Polygon.f
+000003d0: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
+000003e0: 6f72 7420 696d 706f 7274 2028 0a20 2020  ort import (.   
+000003f0: 2050 6f72 742c 0a20 2020 2061 7574 6f5f   Port,.    auto_
+00000400: 7265 6e61 6d65 5f70 6f72 7473 2c0a 2020  rename_ports,.  
+00000410: 2020 6175 746f 5f72 656e 616d 655f 706f    auto_rename_po
+00000420: 7274 735f 636f 756e 7465 725f 636c 6f63  rts_counter_cloc
+00000430: 6b77 6973 652c 0a20 2020 2061 7574 6f5f  kwise,.    auto_
+00000440: 7265 6e61 6d65 5f70 6f72 7473 5f6c 6179  rename_ports_lay
+00000450: 6572 5f6f 7269 656e 7461 7469 6f6e 2c0a  er_orientation,.
+00000460: 2020 2020 6175 746f 5f72 656e 616d 655f      auto_rename_
+00000470: 706f 7274 735f 6f72 6965 6e74 6174 696f  ports_orientatio
+00000480: 6e2c 0a20 2020 206d 6170 5f70 6f72 7473  n,.    map_ports
+00000490: 5f6c 6179 6572 5f74 6f5f 6f72 6965 6e74  _layer_to_orient
+000004a0: 6174 696f 6e2c 0a20 2020 206d 6170 5f70  ation,.    map_p
+000004b0: 6f72 7473 5f74 6f5f 6f72 6965 6e74 6174  orts_to_orientat
+000004c0: 696f 6e5f 6363 772c 0a20 2020 206d 6170  ion_ccw,.    map
+000004d0: 5f70 6f72 7473 5f74 6f5f 6f72 6965 6e74  _ports_to_orient
+000004e0: 6174 696f 6e5f 6377 2c0a 2020 2020 7365  ation_cw,.    se
+000004f0: 6c65 6374 5f70 6f72 7473 2c0a 290a 6672  lect_ports,.).fr
+00000500: 6f6d 2067 6473 6661 6374 6f72 792e 7365  om gdsfactory.se
+00000510: 7269 616c 697a 6174 696f 6e20 696d 706f  rialization impo
+00000520: 7274 2063 6c65 616e 5f64 6963 740a 6672  rt clean_dict.fr
+00000530: 6f6d 2067 6473 6661 6374 6f72 792e 736e  om gdsfactory.sn
+00000540: 6170 2069 6d70 6f72 7420 736e 6170 5f74  ap import snap_t
+00000550: 6f5f 6772 6964 0a0a 6966 2054 5950 455f  o_grid..if TYPE_
+00000560: 4348 4543 4b49 4e47 3a0a 2020 2020 6672  CHECKING:.    fr
+00000570: 6f6d 2067 6473 6661 6374 6f72 792e 7465  om gdsfactory.te
+00000580: 6368 6e6f 6c6f 6779 2069 6d70 6f72 7420  chnology import 
+00000590: 4c61 7965 7253 7461 636b 2c20 4c61 7965  LayerStack, Laye
+000005a0: 7256 6965 7773 0a20 2020 2066 726f 6d20  rViews.    from 
+000005b0: 6764 7366 6163 746f 7279 2e74 7970 696e  gdsfactory.typin
+000005c0: 6773 2069 6d70 6f72 7420 280a 2020 2020  gs import (.    
+000005d0: 2020 2020 436f 6f72 6469 6e61 7465 2c0a      Coordinate,.
+000005e0: 2020 2020 2020 2020 4372 6f73 7353 6563          CrossSec
+000005f0: 7469 6f6e 2c0a 2020 2020 2020 2020 4372  tion,.        Cr
+00000600: 6f73 7353 6563 7469 6f6e 5370 6563 2c0a  ossSectionSpec,.
+00000610: 2020 2020 2020 2020 466c 6f61 7432 2c0a          Float2,.
+00000620: 2020 2020 2020 2020 4c61 7965 722c 0a20          Layer,. 
+00000630: 2020 2020 2020 204c 6179 6572 732c 0a20         Layers,. 
+00000640: 2020 2020 2020 204c 6179 6572 5370 6563         LayerSpec
+00000650: 2c0a 2020 2020 2020 2020 5061 7468 5479  ,.        PathTy
+00000660: 7065 2c0a 2020 2020 290a 0a76 616c 6964  pe,.    )..valid
+00000670: 5f70 6c6f 7474 6572 7320 3d20 5b22 6d61  _plotters = ["ma
+00000680: 7470 6c6f 746c 6962 222c 2022 6b6c 6179  tplotlib", "klay
+00000690: 6f75 7422 2c20 226b 7765 6222 5d0a 4178  out", "kweb"].Ax
+000006a0: 6973 203d 204c 6974 6572 616c 5b22 7822  is = Literal["x"
+000006b0: 2c20 2279 225d 0a6f 732e 656e 7669 726f  , "y"].os.enviro
+000006c0: 6e5b 224b 5745 425f 4649 4c45 534c 4f43  n["KWEB_FILESLOC
+000006d0: 4154 494f 4e22 5d20 3d20 7374 7228 4744  ATION"] = str(GD
+000006e0: 5344 4952 5f54 454d 5029 0a0a 0a63 6c61  SDIR_TEMP)...cla
+000006f0: 7373 2055 6e63 6163 6865 6443 6f6d 706f  ss UncachedCompo
+00000700: 6e65 6e74 5761 726e 696e 6728 5573 6572  nentWarning(User
+00000710: 5761 726e 696e 6729 3a0a 2020 2020 7061  Warning):.    pa
+00000720: 7373 0a0a 0a63 6c61 7373 2055 6e63 6163  ss...class Uncac
+00000730: 6865 6443 6f6d 706f 6e65 6e74 4572 726f  hedComponentErro
+00000740: 7228 5661 6c75 6545 7272 6f72 293a 0a20  r(ValueError):. 
+00000750: 2020 2070 6173 730a 0a0a 636c 6173 7320     pass...class 
+00000760: 4d75 7461 6269 6c69 7479 4572 726f 7228  MutabilityError(
+00000770: 5661 6c75 6545 7272 6f72 293a 0a20 2020  ValueError):.   
+00000780: 2070 6173 730a 0a0a 6465 6620 5f67 6574   pass...def _get
+00000790: 5f64 6570 656e 6465 6e63 6965 7328 636f  _dependencies(co
+000007a0: 6d70 6f6e 656e 742c 2072 6566 6572 656e  mponent, referen
+000007b0: 6365 735f 7365 7429 202d 3e20 4e6f 6e65  ces_set) -> None
+000007c0: 3a0a 2020 2020 666f 7220 7265 6620 696e  :.    for ref in
+000007d0: 2063 6f6d 706f 6e65 6e74 2e72 6566 6572   component.refer
+000007e0: 656e 6365 733a 0a20 2020 2020 2020 2072  ences:.        r
+000007f0: 6566 6572 656e 6365 735f 7365 742e 6164  eferences_set.ad
+00000800: 6428 7265 662e 7265 665f 6365 6c6c 290a  d(ref.ref_cell).
+00000810: 2020 2020 2020 2020 5f67 6574 5f64 6570          _get_dep
+00000820: 656e 6465 6e63 6965 7328 7265 662e 7265  endencies(ref.re
+00000830: 665f 6365 6c6c 2c20 7265 6665 7265 6e63  f_cell, referenc
+00000840: 6573 5f73 6574 290a 0a0a 6d75 7461 6269  es_set)...mutabi
+00000850: 6c69 7479 5f65 7272 6f72 5f6d 6573 7361  lity_error_messa
+00000860: 6765 203d 2022 2222 0a59 6f75 2063 616e  ge = """.You can
+00000870: 6e6f 7420 6d6f 6469 6679 2061 2043 6f6d  not modify a Com
+00000880: 706f 6e65 6e74 2061 6674 6572 2063 7265  ponent after cre
+00000890: 6174 696f 6e20 6173 2069 7420 7769 6c6c  ation as it will
+000008a0: 2061 6666 6563 7420 616c 6c20 6f66 2069   affect all of i
+000008b0: 7473 2069 6e73 7461 6e63 6573 2e0a 0a43  ts instances...C
+000008c0: 7265 6174 6520 6120 6e65 7720 436f 6d70  reate a new Comp
+000008d0: 6f6e 656e 7420 616e 6420 6164 6420 6120  onent and add a 
+000008e0: 7265 6665 7265 6e63 6520 746f 2069 742e  reference to it.
+000008f0: 0a0a 466f 7220 6578 616d 706c 653a 0a0a  ..For example:..
+00000900: 2320 4241 440a 6320 3d20 6766 2e63 6f6d  # BAD.c = gf.com
+00000910: 706f 6e65 6e74 732e 6265 6e64 5f65 756c  ponents.bend_eul
+00000920: 6572 2829 0a63 2e61 6464 5f72 6566 2867  er().c.add_ref(g
+00000930: 662e 636f 6d70 6f6e 656e 7473 2e6d 7a69  f.components.mzi
+00000940: 2829 290a 0a23 2047 4f4f 440a 6320 3d20  ())..# GOOD.c = 
+00000950: 6766 2e43 6f6d 706f 6e65 6e74 2829 0a63  gf.Component().c
+00000960: 2e61 6464 5f72 6566 2867 662e 636f 6d70  .add_ref(gf.comp
+00000970: 6f6e 656e 7473 2e62 656e 645f 6575 6c65  onents.bend_eule
+00000980: 7228 2929 0a63 2e61 6464 5f72 6566 2867  r()).c.add_ref(g
+00000990: 662e 636f 6d70 6f6e 656e 7473 2e6d 7a69  f.components.mzi
+000009a0: 2829 290a 2222 220a 0a6d 6f76 655f 6572  ())."""..move_er
+000009b0: 726f 725f 6d65 7373 6167 6520 3d20 2222  ror_message = ""
+000009c0: 220a 596f 7520 6361 6e6e 6f74 206d 6f76  ".You cannot mov
+000009d0: 6520 6120 436f 6d70 6f6e 656e 742e 2059  e a Component. Y
+000009e0: 6f75 2063 616e 2063 7265 6174 6520 6120  ou can create a 
+000009f0: 6e65 7720 436f 6d70 6f6e 656e 742c 2061  new Component, a
+00000a00: 6464 2061 2072 6566 6572 656e 6365 2074  dd a reference t
+00000a10: 6f20 7468 6520 6f74 6865 7220 436f 6d70  o the other Comp
+00000a20: 6f6e 656e 7420 616e 6420 7468 656e 206d  onent and then m
+00000a30: 6f76 6520 7468 6520 7265 6665 7265 6e63  ove the referenc
+00000a40: 652e 0a0a 466f 7220 6578 616d 706c 653a  e...For example:
+00000a50: 0a0a 2320 4241 440a 6320 3d20 6766 2e63  ..# BAD.c = gf.c
+00000a60: 6f6d 706f 6e65 6e74 732e 7374 7261 6967  omponents.straig
+00000a70: 6874 2829 0a63 2e78 6d69 6e20 3d20 3130  ht().c.xmin = 10
+00000a80: 0a0a 2320 474f 4f44 0a63 203d 2067 662e  ..# GOOD.c = gf.
+00000a90: 436f 6d70 6f6e 656e 7428 290a 7265 6620  Component().ref 
+00000aa0: 3d20 632e 6164 645f 7265 6628 6766 2e63  = c.add_ref(gf.c
+00000ab0: 6f6d 706f 6e65 6e74 732e 7374 7261 6967  omponents.straig
+00000ac0: 6874 2829 2920 2320 6f72 2072 6566 203d  ht()) # or ref =
+00000ad0: 2063 203c 3c20 6766 2e63 6f6d 706f 6e65   c << gf.compone
+00000ae0: 6e74 732e 7374 7261 6967 6874 2829 0a72  nts.straight().r
+00000af0: 6566 2e78 6d69 6e20 3d20 3130 0a22 2222  ef.xmin = 10."""
+00000b00: 0a0a 5f74 696d 6573 7461 6d70 3230 3139  .._timestamp2019
+00000b10: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
+00000b20: 7469 6d65 2e66 726f 6d74 696d 6573 7461  time.fromtimesta
+00000b30: 6d70 2831 3537 3230 3134 3139 322e 3832  mp(1572014192.82
+00000b40: 3733 290a 0a23 2047 6c6f 6261 6c20 6469  73)..# Global di
+00000b50: 6374 696f 6e61 7279 2074 6f20 686f 6c64  ctionary to hold
+00000b60: 2063 6f75 6e74 6572 7320 666f 7220 6561   counters for ea
+00000b70: 6368 206e 616d 650a 6e61 6d65 5f63 6f75  ch name.name_cou
+00000b80: 6e74 6572 7320 3d20 436f 756e 7465 7228  nters = Counter(
+00000b90: 290a 0a0a 7661 6c69 645f 616e 6368 6f72  )...valid_anchor
+00000ba0: 5f70 6f69 6e74 5f6b 6579 776f 7264 7320  _point_keywords 
+00000bb0: 3d20 5b0a 2020 2020 2263 6522 2c0a 2020  = [.    "ce",.  
+00000bc0: 2020 2263 7722 2c0a 2020 2020 226e 6322    "cw",.    "nc"
+00000bd0: 2c0a 2020 2020 226e 6522 2c0a 2020 2020  ,.    "ne",.    
+00000be0: 226e 7722 2c0a 2020 2020 2273 6322 2c0a  "nw",.    "sc",.
+00000bf0: 2020 2020 2273 6522 2c0a 2020 2020 2273      "se",.    "s
+00000c00: 7722 2c0a 2020 2020 2263 656e 7465 7222  w",.    "center"
+00000c10: 2c0a 2020 2020 2263 6322 2c0a 5d0a 7661  ,.    "cc",.].va
+00000c20: 6c69 645f 616e 6368 6f72 5f76 616c 7565  lid_anchor_value
+00000c30: 5f6b 6579 776f 7264 7320 3d20 5b0a 2020  _keywords = [.  
+00000c40: 2020 2273 6f75 7468 222c 0a20 2020 2022    "south",.    "
+00000c50: 7765 7374 222c 0a20 2020 2022 6561 7374  west",.    "east
+00000c60: 222c 0a20 2020 2022 6e6f 7274 6822 2c0a  ",.    "north",.
+00000c70: 5d0a 2320 7265 6665 7220 746f 2061 2073  ].# refer to a s
+00000c80: 696e 6775 6c61 7220 2878 206f 7220 7929  ingular (x or y)
+00000c90: 2076 616c 7565 0a0a 7661 6c69 645f 616e   value..valid_an
+00000ca0: 6368 6f72 7320 3d20 7661 6c69 645f 616e  chors = valid_an
+00000cb0: 6368 6f72 5f70 6f69 6e74 5f6b 6579 776f  chor_point_keywo
+00000cc0: 7264 7320 2b20 7661 6c69 645f 616e 6368  rds + valid_anch
+00000cd0: 6f72 5f76 616c 7565 5f6b 6579 776f 7264  or_value_keyword
+00000ce0: 730a 2320 6675 6c6c 2073 6574 206f 6620  s.# full set of 
+00000cf0: 7661 6c69 6420 616e 6368 6f72 206b 6579  valid anchor key
+00000d00: 776f 7264 7320 2865 6974 6865 7220 7265  words (either re
+00000d10: 6665 7272 696e 6720 746f 2070 6f69 6e74  ferring to point
+00000d20: 7320 6f72 2076 616c 7565 7329 0a0a 0a64  s or values)...d
+00000d30: 6566 205f 726e 6428 6172 722c 2070 7265  ef _rnd(arr, pre
+00000d40: 6369 7369 6f6e 3d31 652d 3429 3a0a 2020  cision=1e-4):.  
+00000d50: 2020 6172 7220 3d20 6e70 2e61 7363 6f6e    arr = np.ascon
+00000d60: 7469 6775 6f75 7361 7272 6179 2861 7272  tiguousarray(arr
+00000d70: 290a 2020 2020 6e64 6967 6974 7320 3d20  ).    ndigits = 
+00000d80: 726f 756e 6428 2d6d 6174 682e 6c6f 6731  round(-math.log1
+00000d90: 3028 7072 6563 6973 696f 6e29 290a 2020  0(precision)).  
+00000da0: 2020 7265 7475 726e 206e 702e 6173 636f    return np.asco
+00000db0: 6e74 6967 756f 7573 6172 7261 7928 6172  ntiguousarray(ar
+00000dc0: 722e 726f 756e 6428 6e64 6967 6974 7329  r.round(ndigits)
+00000dd0: 202f 2070 7265 6369 7369 6f6e 2c20 6474   / precision, dt
+00000de0: 7970 653d 6e70 2e69 6e74 3634 290a 0a0a  ype=np.int64)...
+00000df0: 636c 6173 7320 436f 6d70 6f6e 656e 7428  class Component(
+00000e00: 5f47 656f 6d65 7472 7948 656c 7065 7229  _GeometryHelper)
+00000e10: 3a0a 2020 2020 2222 2241 2043 6f6d 706f  :.    """A Compo
+00000e20: 6e65 6e74 2069 7320 616e 2065 6d70 7479  nent is an empty
+00000e30: 2063 616e 7661 7320 7768 6572 6520 796f   canvas where yo
+00000e40: 7520 6164 6420 706f 6c79 676f 6e73 2c20  u add polygons, 
+00000e50: 7265 6665 7265 6e63 6573 2061 6e64 2070  references and p
+00000e60: 6f72 7473 205c 0a20 2020 2020 2020 2020  orts \.         
+00000e70: 2020 2028 746f 2063 6f6e 6e65 6374 2074     (to connect t
+00000e80: 6f20 6f74 6865 7220 636f 6d70 6f6e 656e  o other componen
+00000e90: 7473 292e 0a0a 2020 2020 2d20 7374 6f72  ts)...    - stor
+00000ea0: 6573 2073 6574 7469 6e67 7320 7468 6174  es settings that
+00000eb0: 2079 6f75 2075 7365 2074 6f20 6275 696c   you use to buil
+00000ec0: 6420 7468 6520 636f 6d70 6f6e 656e 740a  d the component.
+00000ed0: 2020 2020 2d20 7374 6f72 6573 2069 6e66      - stores inf
+00000ee0: 6f20 7468 6174 2079 6f75 2077 616e 7420  o that you want 
+00000ef0: 746f 2075 7365 0a20 2020 202d 2063 616e  to use.    - can
+00000f00: 2072 6574 7572 6e20 706f 7274 7320 6279   return ports by
+00000f10: 2074 7970 6520 286f 7074 6963 616c 2c20   type (optical, 
+00000f20: 656c 6563 7472 6963 616c 202e 2e2e 290a  electrical ...).
+00000f30: 2020 2020 2d20 6361 6e20 7265 7475 726e      - can return
+00000f40: 206e 6574 6c69 7374 2066 6f72 2063 6972   netlist for cir
+00000f50: 6375 6974 2073 696d 756c 6174 696f 6e0a  cuit simulation.
+00000f60: 2020 2020 2d20 6361 6e20 7772 6974 6520      - can write 
+00000f70: 746f 2047 4453 2c20 4f41 5349 530a 2020  to GDS, OASIS.  
+00000f80: 2020 2d20 6361 6e20 7368 6f77 2069 6e20    - can show in 
+00000f90: 4b4c 6179 6f75 742c 206d 6174 706c 6f74  KLayout, matplot
+00000fa0: 6c69 622c 2033 440a 2020 2020 2d20 6361  lib, 3D.    - ca
+00000fb0: 6e20 7265 7475 726e 2063 6f70 792c 206d  n return copy, m
+00000fc0: 6972 726f 722c 2066 6c61 7474 656e 6564  irror, flattened
+00000fd0: 2028 6e6f 2072 6566 6572 656e 6365 7329   (no references)
+00000fe0: 0a0a 2020 2020 4172 6773 3a0a 2020 2020  ..    Args:.    
+00000ff0: 2020 2020 6e61 6d65 3a20 636f 6d70 6f6e      name: compon
+00001000: 656e 745f 6e61 6d65 2e20 5573 6520 4063  ent_name. Use @c
+00001010: 656c 6c20 6465 636f 7261 746f 7220 666f  ell decorator fo
+00001020: 7220 6175 746f 2d6e 616d 696e 672e 0a20  r auto-naming.. 
+00001030: 2020 2020 2020 2077 6974 685f 7575 6964         with_uuid
+00001040: 3a20 6164 6473 2075 6e69 7175 6520 6964  : adds unique id
+00001050: 656e 7469 6669 6572 2e0a 0a20 2020 2050  entifier...    P
+00001060: 726f 7065 7274 6965 733a 0a20 2020 2020  roperties:.     
+00001070: 2020 2069 6e66 6f3a 2064 6963 7469 6f6e     info: diction
+00001080: 6172 7920 7468 6174 2069 6e63 6c75 6465  ary that include
+00001090: 730a 2020 2020 2020 2020 2020 2020 2d20  s.            - 
+000010a0: 6465 7269 7665 6420 7072 6f70 6572 7469  derived properti
+000010b0: 6573 0a20 2020 2020 2020 2020 2020 202d  es.            -
+000010c0: 2065 7874 6572 6e61 6c20 6d65 7461 6461   external metada
+000010d0: 7461 2028 7465 7374 5f70 726f 746f 636f  ta (test_protoco
+000010e0: 6c2c 2064 6f63 732c 202e 2e2e 290a 2020  l, docs, ...).  
+000010f0: 2020 2020 2020 2020 2020 2d20 7369 6d75            - simu
+00001100: 6c61 7469 6f6e 5f73 6574 7469 6e67 730a  lation_settings.
+00001110: 2020 2020 2020 2020 2020 2020 2d20 6675              - fu
+00001120: 6e63 7469 6f6e 5f6e 616d 650a 2020 2020  nction_name.    
+00001130: 2020 2020 2020 2020 2d20 6e61 6d65 3a20          - name: 
+00001140: 666f 7220 7468 6520 636f 6d70 6f6e 656e  for the componen
+00001150: 740a 0a20 2020 2020 2020 2073 6574 7469  t..        setti
+00001160: 6e67 733a 0a20 2020 2020 2020 2020 2020  ngs:.           
+00001170: 2066 756c 6c3a 2066 756c 6c20 7365 7474   full: full sett
+00001180: 696e 6773 2070 6173 7365 6420 746f 2074  ings passed to t
+00001190: 6865 2066 756e 6374 696f 6e20 746f 2063  he function to c
+000011a0: 7265 6174 6520 636f 6d70 6f6e 656e 742e  reate component.
+000011b0: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
+000011c0: 6e67 6564 3a20 6368 616e 6765 6420 7365  nged: changed se
+000011d0: 7474 696e 6773 2e0a 2020 2020 2020 2020  ttings..        
+000011e0: 2020 2020 6465 6661 756c 743a 2064 6566      default: def
+000011f0: 6175 6c74 2063 6f6d 706f 6e65 6e74 2073  ault component s
+00001200: 6574 7469 6e67 732e 0a20 2020 2020 2020  ettings..       
+00001210: 2020 2020 2063 6869 6c64 3a20 6469 6374       child: dict
+00001220: 2069 6e66 6f20 6672 6f6d 2074 6865 2063   info from the c
+00001230: 6869 6c64 7265 6e2c 2069 6620 616e 792e  hildren, if any.
+00001240: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+00001250: 6620 5f5f 696e 6974 5f5f 280a 2020 2020  f __init__(.    
+00001260: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00001270: 2020 6e61 6d65 3a20 7374 7220 3d20 2255    name: str = "U
+00001280: 6e6e 616d 6564 222c 0a20 2020 2020 2020  nnamed",.       
+00001290: 2077 6974 685f 7575 6964 3a20 626f 6f6c   with_uuid: bool
+000012a0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+000012b0: 2020 6d61 785f 6e61 6d65 5f6c 656e 6774    max_name_lengt
+000012c0: 683a 2069 6e74 207c 204e 6f6e 6520 3d20  h: int | None = 
+000012d0: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 204e  None,.    ) -> N
+000012e0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+000012f0: 496e 6974 6961 6c69 7a65 2074 6865 2043  Initialize the C
+00001300: 6f6d 706f 6e65 6e74 206f 626a 6563 742e  omponent object.
+00001310: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
+00001320: 662e 7569 6420 3d20 7374 7228 7575 6964  f.uid = str(uuid
+00001330: 2e75 7569 6434 2829 295b 3a38 5d0a 2020  .uuid4())[:8].  
+00001340: 2020 2020 2020 6966 2077 6974 685f 7575        if with_uu
+00001350: 6964 206f 7220 6e61 6d65 203d 3d20 2255  id or name == "U
+00001360: 6e6e 616d 6564 223a 0a20 2020 2020 2020  nnamed":.       
+00001370: 2020 2020 206e 616d 6520 2b3d 2066 225f       name += f"_
+00001380: 7b73 656c 662e 7569 647d 220a 0a20 2020  {self.uid}"..   
+00001390: 2020 2020 2073 656c 662e 5f63 656c 6c20       self._cell 
+000013a0: 3d20 6764 7374 6b2e 4365 6c6c 2822 556e  = gdstk.Cell("Un
+000013b0: 6e61 6d65 6422 290a 2020 2020 2020 2020  named").        
+000013c0: 7365 6c66 2e72 656e 616d 6528 6e61 6d65  self.rename(name
+000013d0: 2c20 6d61 785f 6e61 6d65 5f6c 656e 6774  , max_name_lengt
+000013e0: 683d 6d61 785f 6e61 6d65 5f6c 656e 6774  h=max_name_lengt
+000013f0: 6829 0a20 2020 2020 2020 2073 656c 662e  h).        self.
+00001400: 696e 666f 3a20 496e 666f 203d 2049 6e66  info: Info = Inf
+00001410: 6f28 290a 0a20 2020 2020 2020 2073 656c  o()..        sel
+00001420: 662e 7365 7474 696e 6773 3a20 4365 6c6c  f.settings: Cell
+00001430: 5365 7474 696e 6773 203d 2043 656c 6c53  Settings = CellS
+00001440: 6574 7469 6e67 7328 290a 2020 2020 2020  ettings().      
+00001450: 2020 7365 6c66 2e5f 6c6f 636b 6564 203d    self._locked =
+00001460: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
+00001470: 656c 662e 5f67 6574 5f63 6869 6c64 5f6e  elf._get_child_n
+00001480: 616d 6520 3d20 4661 6c73 650a 2020 2020  ame = False.    
+00001490: 2020 2020 7365 6c66 2e5f 7265 6665 7265      self._refere
+000014a0: 6e63 655f 6e61 6d65 735f 636f 756e 7465  nce_names_counte
+000014b0: 7220 3d20 436f 756e 7465 7228 290a 2020  r = Counter().  
+000014c0: 2020 2020 2020 7365 6c66 2e5f 7265 6665        self._refe
+000014d0: 7265 6e63 655f 6e61 6d65 735f 7573 6564  rence_names_used
+000014e0: 203d 2073 6574 2829 0a20 2020 2020 2020   = set().       
+000014f0: 2073 656c 662e 5f6e 616d 6564 5f72 6566   self._named_ref
+00001500: 6572 656e 6365 7320 3d20 7b7d 0a20 2020  erences = {}.   
+00001510: 2020 2020 2073 656c 662e 5f72 6566 6572       self._refer
+00001520: 656e 6365 7320 3d20 5b5d 0a20 2020 2020  ences = [].     
+00001530: 2020 2073 656c 662e 6675 6e63 7469 6f6e     self.function
+00001540: 5f6e 616d 6520 3d20 2222 0a20 2020 2020  _name = "".     
+00001550: 2020 2073 656c 662e 6d6f 6475 6c65 203d     self.module =
+00001560: 2022 220a 0a20 2020 2020 2020 2073 656c   ""..        sel
+00001570: 662e 706f 7274 7320 3d20 7b7d 0a20 2020  f.ports = {}.   
+00001580: 2020 2020 2073 656c 662e 6368 696c 6420       self.child 
+00001590: 3d20 4e6f 6e65 0a0a 2020 2020 4070 726f  = None..    @pro
+000015a0: 7065 7274 790a 2020 2020 6465 6620 7265  perty.    def re
+000015b0: 6665 7265 6e63 6573 2873 656c 6629 3a0a  ferences(self):.
+000015c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000015d0: 656c 662e 5f72 6566 6572 656e 6365 730a  elf._references.
+000015e0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+000015f0: 2020 2064 6566 2070 6f6c 7967 6f6e 7328     def polygons(
+00001600: 7365 6c66 2920 2d3e 206c 6973 745b 506f  self) -> list[Po
+00001610: 6c79 676f 6e5d 3a0a 2020 2020 2020 2020  lygon]:.        
+00001620: 7265 7475 726e 2073 656c 662e 5f63 656c  return self._cel
+00001630: 6c2e 706f 6c79 676f 6e73 0a0a 2020 2020  l.polygons..    
+00001640: 6465 6620 6172 6561 2873 656c 662c 206c  def area(self, l
+00001650: 6179 6572 3a20 4c61 7965 7253 7065 6320  ayer: LayerSpec 
+00001660: 7c20 4e6f 6e65 203d 204e 6f6e 6529 202d  | None = None) -
+00001670: 3e20 666c 6f61 743a 0a20 2020 2020 2020  > float:.       
+00001680: 2022 2222 5265 7475 726e 7320 7468 6520   """Returns the 
+00001690: 6172 6561 206f 6620 7468 6520 636f 6d70  area of the comp
+000016a0: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
+000016b0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+000016c0: 2020 6c61 7965 723a 2069 6620 4e6f 6e65    layer: if None
+000016d0: 2072 6574 7572 6e73 2074 6865 2061 7265   returns the are
+000016e0: 6120 6f66 2074 6865 2063 6f6d 706f 6e65  a of the compone
+000016f0: 6e74 2e0a 2020 2020 2020 2020 2020 2020  nt..            
+00001700: 2020 2020 4966 206c 6179 6572 2069 7320      If layer is 
+00001710: 7370 6563 6966 6965 6420 7265 7475 726e  specified return
+00001720: 7320 7468 6520 6172 6561 206f 6620 7468  s the area of th
+00001730: 6520 636f 6d70 6f6e 656e 7420 696e 2074  e component in t
+00001740: 6861 7420 6c61 7965 722e 0a20 2020 2020  hat layer..     
+00001750: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00001760: 6620 6e6f 7420 6c61 7965 723a 0a20 2020  f not layer:.   
+00001770: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00001780: 7365 6c66 2e5f 6365 6c6c 2e61 7265 6128  self._cell.area(
+00001790: 4661 6c73 6529 0a20 2020 2020 2020 2066  False).        f
+000017a0: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
+000017b0: 646b 2069 6d70 6f72 7420 6765 745f 6c61  dk import get_la
+000017c0: 7965 720a 0a20 2020 2020 2020 206c 6179  yer..        lay
+000017d0: 6572 203d 2067 6574 5f6c 6179 6572 286c  er = get_layer(l
+000017e0: 6179 6572 290a 2020 2020 2020 2020 6c61  ayer).        la
+000017f0: 7965 725f 746f 5f61 7265 6120 3d20 7365  yer_to_area = se
+00001800: 6c66 2e5f 6365 6c6c 2e61 7265 6128 5472  lf._cell.area(Tr
+00001810: 7565 290a 2020 2020 2020 2020 7265 7475  ue).        retu
+00001820: 726e 206c 6179 6572 5f74 6f5f 6172 6561  rn layer_to_area
+00001830: 5b6c 6179 6572 5d0a 0a20 2020 2040 7072  [layer]..    @pr
+00001840: 6f70 6572 7479 0a20 2020 2064 6566 206c  operty.    def l
+00001850: 6162 656c 7328 7365 6c66 2920 2d3e 206c  abels(self) -> l
+00001860: 6973 745b 4c61 6265 6c5d 3a0a 2020 2020  ist[Label]:.    
+00001870: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00001880: 5f63 656c 6c2e 6c61 6265 6c73 0a0a 2020  _cell.labels..  
+00001890: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+000018a0: 6465 6620 7061 7468 7328 7365 6c66 293a  def paths(self):
+000018b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000018c0: 7365 6c66 2e5f 6365 6c6c 2e70 6174 6873  self._cell.paths
+000018d0: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+000018e0: 2020 2020 6465 6620 6e61 6d65 2873 656c      def name(sel
+000018f0: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
+00001900: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00001910: 6365 6c6c 2e6e 616d 650a 0a20 2020 2040  cell.name..    @
+00001920: 6e61 6d65 2e73 6574 7465 720a 2020 2020  name.setter.    
+00001930: 6465 6620 6e61 6d65 2873 656c 662c 206e  def name(self, n
+00001940: 616d 6529 202d 3e20 4e6f 6e65 3a0a 2020  ame) -> None:.  
+00001950: 2020 2020 2020 7365 6c66 2e72 656e 616d        self.renam
+00001960: 6528 6e61 6d65 290a 0a20 2020 2064 6566  e(name)..    def
+00001970: 2072 656e 616d 6528 7365 6c66 2c20 6e61   rename(self, na
+00001980: 6d65 3a20 7374 722c 2063 6163 6865 3a20  me: str, cache: 
+00001990: 626f 6f6c 203d 2054 7275 652c 206d 6178  bool = True, max
+000019a0: 5f6e 616d 655f 6c65 6e67 7468 3a20 696e  _name_length: in
+000019b0: 7420 7c20 4e6f 6e65 203d 204e 6f6e 6529  t | None = None)
+000019c0: 3a0a 2020 2020 2020 2020 6672 6f6d 2067  :.        from g
+000019d0: 6473 6661 6374 6f72 792e 6365 6c6c 2069  dsfactory.cell i
+000019e0: 6d70 6f72 7420 4341 4348 452c 2072 656d  mport CACHE, rem
+000019f0: 6f76 655f 6672 6f6d 5f63 6163 6865 0a0a  ove_from_cache..
+00001a00: 2020 2020 2020 2020 6966 206d 6178 5f6e          if max_n
+00001a10: 616d 655f 6c65 6e67 7468 2069 7320 4e6f  ame_length is No
+00001a20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00001a30: 6d61 785f 6e61 6d65 5f6c 656e 6774 6820  max_name_length 
+00001a40: 3d20 434f 4e46 2e6d 6178 5f6e 616d 655f  = CONF.max_name_
+00001a50: 6c65 6e67 7468 0a0a 2020 2020 2020 2020  length..        
+00001a60: 6966 206c 656e 286e 616d 6529 203e 206d  if len(name) > m
+00001a70: 6178 5f6e 616d 655f 6c65 6e67 7468 3a0a  ax_name_length:.
+00001a80: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00001a90: 5f73 686f 7274 203d 2067 6574 5f6e 616d  _short = get_nam
+00001aa0: 655f 7368 6f72 7428 6e61 6d65 2c20 6d61  e_short(name, ma
+00001ab0: 785f 6e61 6d65 5f6c 656e 6774 683d 6d61  x_name_length=ma
+00001ac0: 785f 6e61 6d65 5f6c 656e 6774 6829 0a20  x_name_length). 
+00001ad0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+00001ae0: 6e67 732e 7761 726e 280a 2020 2020 2020  ngs.warn(.      
+00001af0: 2020 2020 2020 2020 2020 6622 207b 6e61            f" {na
+00001b00: 6d65 7d20 6973 2074 6f6f 206c 6f6e 672e  me} is too long.
+00001b10: 204d 6178 206c 656e 6774 6820 6973 207b   Max length is {
+00001b20: 6d61 785f 6e61 6d65 5f6c 656e 6774 687d  max_name_length}
+00001b30: 2e20 5265 6e61 6d69 6e67 2074 6f20 7b6e  . Renaming to {n
+00001b40: 616d 655f 7368 6f72 747d 222c 0a20 2020  ame_short}",.   
+00001b50: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+00001b60: 636b 6c65 7665 6c3d 322c 0a20 2020 2020  cklevel=2,.     
+00001b70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00001b80: 2020 2020 206e 616d 6520 3d20 6e61 6d65       name = name
+00001b90: 5f73 686f 7274 0a0a 2020 2020 2020 2020  _short..        
+00001ba0: 6966 2073 656c 662e 6e61 6d65 2021 3d20  if self.name != 
+00001bb0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+00001bc0: 2020 2320 6966 2074 6869 7320 636f 6d70    # if this comp
+00001bd0: 6f6e 656e 7420 6973 2072 6567 6973 7465  onent is registe
+00001be0: 7265 6420 756e 6465 7220 6974 7320 6f6c  red under its ol
+00001bf0: 6420 6e61 6d65 2069 6e20 7468 6520 6361  d name in the ca
+00001c00: 6368 652c 2072 656d 6f76 6520 6974 0a20  che, remove it. 
+00001c10: 2020 2020 2020 2020 2020 206f 6c64 5f6e             old_n
+00001c20: 616d 6520 3d20 7365 6c66 2e6e 616d 650a  ame = self.name.
+00001c30: 2020 2020 2020 2020 2020 2020 6966 2043              if C
+00001c40: 4143 4845 2e67 6574 286f 6c64 5f6e 616d  ACHE.get(old_nam
+00001c50: 6529 2069 7320 7365 6c66 3a0a 2020 2020  e) is self:.    
+00001c60: 2020 2020 2020 2020 2020 2020 7265 6d6f              remo
+00001c70: 7665 5f66 726f 6d5f 6361 6368 6528 7365  ve_from_cache(se
+00001c80: 6c66 2e6e 616d 6529 0a0a 2020 2020 2020  lf.name)..      
+00001c90: 2020 2020 2020 2320 6361 6368 6520 7468        # cache th
+00001ca0: 6520 6e65 7720 6e61 6d65 2061 6e64 2061  e new name and a
+00001cb0: 6464 2074 6f20 636f 756e 7465 7220 6966  dd to counter if
+00001cc0: 2073 7065 6369 6669 6564 0a20 2020 2020   specified.     
+00001cd0: 2020 2020 2020 2069 6620 6361 6368 6520         if cache 
+00001ce0: 6973 2054 7275 653a 0a20 2020 2020 2020  is True:.       
+00001cf0: 2020 2020 2020 2020 206e 616d 655f 636f           name_co
+00001d00: 756e 7465 7273 5b6e 616d 655d 202b 3d20  unters[name] += 
+00001d10: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00001d20: 2020 6966 206e 616d 655f 636f 756e 7465    if name_counte
+00001d30: 7273 5b6e 616d 655d 203e 2031 3a0a 2020  rs[name] > 1:.  
+00001d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001d50: 2020 6e61 6d65 203d 2066 227b 6e61 6d65    name = f"{name
+00001d60: 7d24 7b6e 616d 655f 636f 756e 7465 7273  }${name_counters
+00001d70: 5b6e 616d 655d 2d31 7d22 0a20 2020 2020  [name]-1}".     
+00001d80: 2020 2020 2020 2020 2020 2043 4143 4845             CACHE
+00001d90: 5b6e 616d 655d 203d 2073 656c 660a 0a20  [name] = self.. 
+00001da0: 2020 2020 2020 2073 656c 662e 5f63 656c         self._cel
+00001db0: 6c2e 6e61 6d65 203d 206e 616d 650a 0a20  l.name = name.. 
+00001dc0: 2020 2064 6566 205f 5f69 7465 725f 5f28     def __iter__(
+00001dd0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00001de0: 2222 596f 7520 6361 6e20 6974 6572 6174  ""You can iterat
+00001df0: 6520 6f76 6572 2070 6f6c 7967 6f6e 732c  e over polygons,
+00001e00: 2070 6174 6873 2c20 6c61 6265 6c73 2061   paths, labels a
+00001e10: 6e64 2072 6566 6572 656e 6365 732e 2222  nd references.""
+00001e20: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00001e30: 2069 7465 7274 6f6f 6c73 2e63 6861 696e   itertools.chain
+00001e40: 2873 656c 662e 706f 6c79 676f 6e73 2c20  (self.polygons, 
+00001e50: 7365 6c66 2e70 6174 6873 2c20 7365 6c66  self.paths, self
+00001e60: 2e6c 6162 656c 732c 2073 656c 662e 7265  .labels, self.re
+00001e70: 6665 7265 6e63 6573 290a 0a20 2020 2064  ferences)..    d
+00001e80: 6566 2067 6574 5f70 6f6c 7967 6f6e 5f65  ef get_polygon_e
+00001e90: 6e63 6c6f 7375 7265 2873 656c 6629 202d  nclosure(self) -
+00001ea0: 3e20 506f 6c79 676f 6e3a 0a20 2020 2020  > Polygon:.     
+00001eb0: 2020 2022 2222 5265 7475 726e 7320 7368     """Returns sh
+00001ec0: 6170 656c 7920 506f 6c79 676f 6e20 7769  apely Polygon wi
+00001ed0: 7468 2065 6e63 6c6f 7375 7265 2e22 2222  th enclosure."""
+00001ee0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+00001ef0: 7368 6170 656c 790a 0a20 2020 2020 2020  shapely..       
+00001f00: 2072 6574 7572 6e20 7368 6170 656c 792e   return shapely.
+00001f10: 506f 6c79 676f 6e28 7365 6c66 2e5f 6365  Polygon(self._ce
+00001f20: 6c6c 2e63 6f6e 7665 785f 6875 6c6c 2829  ll.convex_hull()
+00001f30: 290a 0a20 2020 2064 6566 2067 6574 5f70  )..    def get_p
+00001f40: 6f6c 7967 6f6e 5f62 626f 7828 0a20 2020  olygon_bbox(.   
+00001f50: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00001f60: 2020 2064 6566 6175 6c74 3a20 666c 6f61     default: floa
+00001f70: 7420 3d20 302e 302c 0a20 2020 2020 2020  t = 0.0,.       
+00001f80: 2074 6f70 3a20 666c 6f61 7420 7c20 4e6f   top: float | No
+00001f90: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+00001fa0: 2020 2062 6f74 746f 6d3a 2066 6c6f 6174     bottom: float
+00001fb0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00001fc0: 2020 2020 2020 2020 7269 6768 743a 2066          right: f
+00001fd0: 6c6f 6174 207c 204e 6f6e 6520 3d20 4e6f  loat | None = No
+00001fe0: 6e65 2c0a 2020 2020 2020 2020 6c65 6674  ne,.        left
+00001ff0: 3a20 666c 6f61 7420 7c20 4e6f 6e65 203d  : float | None =
+00002000: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
+00002010: 506f 6c79 676f 6e3a 0a20 2020 2020 2020  Polygon:.       
+00002020: 2022 2222 5265 7475 726e 7320 7368 6170   """Returns shap
+00002030: 656c 7920 506f 6c79 676f 6e20 7769 7468  ely Polygon with
+00002040: 2062 6f75 6e64 696e 6720 626f 782e 0a0a   bounding box...
+00002050: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00002060: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00002070: 743a 2064 6566 6175 6c74 2070 6164 6469  t: default paddi
+00002080: 6e67 2069 6e20 756d 2e0a 2020 2020 2020  ng in um..      
+00002090: 2020 2020 2020 746f 703a 206e 6f72 7468        top: north
+000020a0: 2070 6164 6469 6e67 2069 6e20 756d 2e0a   padding in um..
+000020b0: 2020 2020 2020 2020 2020 2020 626f 7474              bott
+000020c0: 6f6d 3a20 736f 7574 6820 7061 6464 696e  om: south paddin
+000020d0: 6720 696e 2075 6d2e 0a20 2020 2020 2020  g in um..       
+000020e0: 2020 2020 2072 6967 6874 3a20 6561 7374       right: east
+000020f0: 2070 6164 6469 6e67 2069 6e20 756d 2e0a   padding in um..
+00002100: 2020 2020 2020 2020 2020 2020 6c65 6674              left
+00002110: 3a20 7765 7374 2070 6164 6469 6e67 2069  : west padding i
+00002120: 6e20 756d 2e0a 2020 2020 2020 2020 2222  n um..        ""
+00002130: 220a 2020 2020 2020 2020 696d 706f 7274  ".        import
+00002140: 2073 6861 7065 6c79 0a0a 2020 2020 2020   shapely..      
+00002150: 2020 2878 6d69 6e2c 2079 6d69 6e29 2c20    (xmin, ymin), 
+00002160: 2878 6d61 782c 2079 6d61 7829 203d 2073  (xmax, ymax) = s
+00002170: 656c 662e 6262 6f78 0a20 2020 2020 2020  elf.bbox.       
+00002180: 2074 6f70 203d 2074 6f70 2069 6620 746f   top = top if to
+00002190: 7020 6973 206e 6f74 204e 6f6e 6520 656c  p is not None el
+000021a0: 7365 2064 6566 6175 6c74 0a20 2020 2020  se default.     
+000021b0: 2020 2062 6f74 746f 6d20 3d20 626f 7474     bottom = bott
+000021c0: 6f6d 2069 6620 626f 7474 6f6d 2069 7320  om if bottom is 
+000021d0: 6e6f 7420 4e6f 6e65 2065 6c73 6520 6465  not None else de
+000021e0: 6661 756c 740a 2020 2020 2020 2020 7269  fault.        ri
+000021f0: 6768 7420 3d20 7269 6768 7420 6966 2072  ght = right if r
+00002200: 6967 6874 2069 7320 6e6f 7420 4e6f 6e65  ight is not None
+00002210: 2065 6c73 6520 6465 6661 756c 740a 2020   else default.  
+00002220: 2020 2020 2020 6c65 6674 203d 206c 6566        left = lef
+00002230: 7420 6966 206c 6566 7420 6973 206e 6f74  t if left is not
+00002240: 204e 6f6e 6520 656c 7365 2064 6566 6175   None else defau
+00002250: 6c74 0a20 2020 2020 2020 2070 6f69 6e74  lt.        point
+00002260: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+00002270: 2020 5b78 6d69 6e20 2d20 6c65 6674 2c20    [xmin - left, 
+00002280: 796d 696e 202d 2062 6f74 746f 6d5d 2c0a  ymin - bottom],.
+00002290: 2020 2020 2020 2020 2020 2020 5b78 6d61              [xma
+000022a0: 7820 2b20 7269 6768 742c 2079 6d69 6e20  x + right, ymin 
+000022b0: 2d20 626f 7474 6f6d 5d2c 0a20 2020 2020  - bottom],.     
+000022c0: 2020 2020 2020 205b 786d 6178 202b 2072         [xmax + r
+000022d0: 6967 6874 2c20 796d 6178 202b 2074 6f70  ight, ymax + top
+000022e0: 5d2c 0a20 2020 2020 2020 2020 2020 205b  ],.            [
+000022f0: 786d 696e 202d 206c 6566 742c 2079 6d61  xmin - left, yma
+00002300: 7820 2b20 746f 705d 2c0a 2020 2020 2020  x + top],.      
+00002310: 2020 5d0a 2020 2020 2020 2020 7265 7475    ].        retu
+00002320: 726e 2073 6861 7065 6c79 2e50 6f6c 7967  rn shapely.Polyg
+00002330: 6f6e 2870 6f69 6e74 7329 0a0a 2020 2020  on(points)..    
+00002340: 6465 6620 6765 745f 706f 6c79 676f 6e73  def get_polygons
+00002350: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00002360: 2020 2020 2020 2020 6279 5f73 7065 633a          by_spec:
+00002370: 2062 6f6f 6c20 7c20 7475 706c 655b 696e   bool | tuple[in
+00002380: 742c 2069 6e74 5d20 3d20 4661 6c73 652c  t, int] = False,
+00002390: 0a20 2020 2020 2020 2064 6570 7468 3a20  .        depth: 
+000023a0: 696e 7420 7c20 4e6f 6e65 203d 204e 6f6e  int | None = Non
+000023b0: 652c 0a20 2020 2020 2020 2069 6e63 6c75  e,.        inclu
+000023c0: 6465 5f70 6174 6873 3a20 626f 6f6c 203d  de_paths: bool =
+000023d0: 2054 7275 652c 0a20 2020 2020 2020 2061   True,.        a
+000023e0: 735f 6172 7261 793a 2062 6f6f 6c20 3d20  s_array: bool = 
+000023f0: 5472 7565 2c0a 2020 2020 2020 2020 6173  True,.        as
+00002400: 5f73 6861 7065 6c79 3a20 626f 6f6c 203d  _shapely: bool =
+00002410: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+00002420: 6173 5f73 6861 7065 6c79 5f6d 6572 6765  as_shapely_merge
+00002430: 643a 2062 6f6f 6c20 3d20 4661 6c73 652c  d: bool = False,
+00002440: 0a20 2020 2029 202d 3e20 6c69 7374 5b50  .    ) -> list[P
+00002450: 6f6c 7967 6f6e 5d20 7c20 6469 6374 5b74  olygon] | dict[t
+00002460: 7570 6c65 5b69 6e74 2c20 696e 745d 2c20  uple[int, int], 
+00002470: 6c69 7374 5b50 6f6c 7967 6f6e 5d5d 3a0a  list[Polygon]]:.
+00002480: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00002490: 6e20 6120 6c69 7374 206f 6620 706f 6c79  n a list of poly
+000024a0: 676f 6e73 2069 6e20 7468 6973 2063 656c  gons in this cel
+000024b0: 6c2e 0a0a 2020 2020 2020 2020 4172 6773  l...        Args
+000024c0: 3a0a 2020 2020 2020 2020 2020 2020 6279  :.            by
+000024d0: 5f73 7065 633a 2062 6f6f 6c20 6f72 206c  _spec: bool or l
+000024e0: 6179 6572 0a20 2020 2020 2020 2020 2020  ayer.           
+000024f0: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
+00002500: 6520 7265 7475 726e 2076 616c 7565 2069  e return value i
+00002510: 7320 6120 6469 6374 696f 6e61 7279 2077  s a dictionary w
+00002520: 6974 6820 7468 650a 2020 2020 2020 2020  ith the.        
+00002530: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
+00002540: 206f 6620 6561 6368 2069 6e64 6976 6964   of each individ
+00002550: 7561 6c20 7061 6972 2028 6c61 7965 722c  ual pair (layer,
+00002560: 2064 6174 6174 7970 6529 2c20 7768 6963   datatype), whic
+00002570: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
+00002580: 2020 6172 6520 7573 6564 2061 7320 6b65    are used as ke
+00002590: 7973 2e20 2049 6620 7365 7420 746f 2061  ys.  If set to a
+000025a0: 2074 7570 6c65 206f 6620 286c 6179 6572   tuple of (layer
+000025b0: 2c20 6461 7461 7479 7065 292c 0a20 2020  , datatype),.   
+000025c0: 2020 2020 2020 2020 2020 2020 206f 6e6c               onl
+000025d0: 7920 706f 6c79 676f 6e73 2077 6974 6820  y polygons with 
+000025e0: 7468 6174 2073 7065 6369 6669 6361 7469  that specificati
+000025f0: 6f6e 2061 7265 2072 6574 7572 6e65 642e  on are returned.
+00002600: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
+00002610: 7468 3a20 696e 7465 6765 7220 6f72 204e  th: integer or N
+00002620: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00002630: 2020 2020 4966 206e 6f74 204e 6f6e 652c      If not None,
+00002640: 2064 6566 696e 6573 2066 726f 6d20 686f   defines from ho
+00002650: 7720 6d61 6e79 2072 6566 6572 656e 6365  w many reference
+00002660: 206c 6576 656c 7320 746f 0a20 2020 2020   levels to.     
+00002670: 2020 2020 2020 2020 2020 2072 6574 7269             retri
+00002680: 6576 6520 706f 6c79 676f 6e73 2e20 2052  eve polygons.  R
+00002690: 6566 6572 656e 6365 7320 6265 6c6f 7720  eferences below 
+000026a0: 7468 6973 206c 6576 656c 2077 696c 6c20  this level will 
+000026b0: 7265 7375 6c74 0a20 2020 2020 2020 2020  result.         
+000026c0: 2020 2020 2020 2069 6e20 6120 626f 756e         in a boun
+000026d0: 6469 6e67 2062 6f78 2e20 2049 6620 6062  ding box.  If `b
+000026e0: 795f 7370 6563 6020 6973 2054 7275 6520  y_spec` is True 
+000026f0: 7468 6520 6b65 7920 7769 6c6c 2062 6520  the key will be 
+00002700: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00002710: 2020 2020 6e61 6d65 206f 6620 7468 6973      name of this
+00002720: 2063 656c 6c2e 0a20 2020 2020 2020 2020   cell..         
+00002730: 2020 2069 6e63 6c75 6465 5f70 6174 6873     include_paths
+00002740: 3a20 4966 2054 7275 652c 2070 6f6c 7967  : If True, polyg
+00002750: 6f6e 616c 2072 6570 7265 7365 6e74 6174  onal representat
+00002760: 696f 6e20 6f66 2070 6174 6873 2061 7265  ion of paths are
+00002770: 2061 6c73 6f20 696e 636c 7564 6564 2069   also included i
+00002780: 6e20 7468 6520 7265 7375 6c74 2e0a 2020  n the result..  
+00002790: 2020 2020 2020 2020 2020 6173 5f61 7272            as_arr
+000027a0: 6179 3a20 7768 656e 2061 735f 6172 7261  ay: when as_arra
+000027b0: 793d 6661 6c73 652c 2072 6574 7572 6e20  y=false, return 
+000027c0: 7468 6520 506f 6c79 676f 6e20 6f62 6a65  the Polygon obje
+000027d0: 6374 7320 696e 7374 6561 642e 0a20 2020  cts instead..   
+000027e0: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
+000027f0: 7967 6f6e 206f 626a 6563 7473 2068 6176  ygon objects hav
+00002800: 6520 6d6f 7265 2069 6e66 6f72 6d61 7469  e more informati
+00002810: 6f6e 2028 6573 7065 6369 616c 6c79 2077  on (especially w
+00002820: 6865 6e20 6279 5f73 7065 633d 4661 6c73  hen by_spec=Fals
+00002830: 6529 2061 6e64 2061 7265 2066 6173 7465  e) and are faste
+00002840: 7220 746f 2072 6574 7269 6576 652e 0a20  r to retrieve.. 
+00002850: 2020 2020 2020 2020 2020 2061 735f 7368             as_sh
+00002860: 6170 656c 793a 2072 6574 7572 6e73 2073  apely: returns s
+00002870: 6861 7065 6c79 2070 6f6c 7967 6f6e 732e  hapely polygons.
+00002880: 0a20 2020 2020 2020 2020 2020 2061 735f  .            as_
+00002890: 7368 6170 656c 795f 6d65 7267 6564 3a20  shapely_merged: 
+000028a0: 7265 7475 726e 7320 6120 7368 6170 656c  returns a shapel
+000028b0: 7920 706f 6c79 676f 6e69 7a65 2e0a 0a20  y polygonize... 
+000028c0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+000028d0: 2020 2020 2020 2020 2020 206f 7574 3a20             out: 
+000028e0: 6c69 7374 206f 6620 6172 7261 792d 6c69  list of array-li
+000028f0: 6b65 5b4e 5d5b 325d 206f 7220 6469 6374  ke[N][2] or dict
+00002900: 696f 6e61 7279 0a20 2020 2020 2020 2020  ionary.         
+00002910: 2020 2020 2020 204c 6973 7420 636f 6e74         List cont
+00002920: 6169 6e69 6e67 2074 6865 2063 6f6f 7264  aining the coord
+00002930: 696e 6174 6573 206f 6620 7468 6520 7665  inates of the ve
+00002940: 7274 6963 6573 206f 6620 6561 6368 0a20  rtices of each. 
+00002950: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00002960: 6f6c 7967 6f6e 2c20 6f72 2064 6963 7469  olygon, or dicti
+00002970: 6f6e 6172 7920 7769 7468 2077 6974 6820  onary with with 
+00002980: 7468 6520 6c69 7374 206f 6620 706f 6c79  the list of poly
+00002990: 676f 6e73 2028 6966 0a20 2020 2020 2020  gons (if.       
+000029a0: 2020 2020 2020 2020 2060 6279 5f73 7065           `by_spe
+000029b0: 6360 2069 7320 5472 7565 292e 0a0a 2020  c` is True)...  
+000029c0: 2020 2020 2020 4e6f 7465 3a0a 2020 2020        Note:.    
+000029d0: 2020 2020 2020 2020 496e 7374 616e 6365          Instance
+000029e0: 7320 6f66 2060 466c 6578 5061 7468 6020  s of `FlexPath` 
+000029f0: 616e 6420 6052 6f62 7573 7450 6174 6860  and `RobustPath`
+00002a00: 2061 7265 2061 6c73 6f20 696e 636c 7564   are also includ
+00002a10: 6564 2069 6e0a 2020 2020 2020 2020 2020  ed in.          
+00002a20: 2020 7468 6520 7265 7375 6c74 2062 7920    the result by 
+00002a30: 636f 6d70 7574 696e 6720 7468 6569 7220  computing their 
+00002a40: 706f 6c79 676f 6e61 6c20 626f 756e 6461  polygonal bounda
+00002a50: 7279 2e0a 2020 2020 2020 2020 2222 220a  ry..        """.
+00002a60: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+00002a70: 6574 5f70 6f6c 7967 6f6e 7328 0a20 2020  et_polygons(.   
+00002a80: 2020 2020 2020 2020 2069 6e73 7461 6e63           instanc
+00002a90: 653d 7365 6c66 2c0a 2020 2020 2020 2020  e=self,.        
+00002aa0: 2020 2020 6279 5f73 7065 633d 6279 5f73      by_spec=by_s
+00002ab0: 7065 632c 0a20 2020 2020 2020 2020 2020  pec,.           
+00002ac0: 2064 6570 7468 3d64 6570 7468 2c0a 2020   depth=depth,.  
+00002ad0: 2020 2020 2020 2020 2020 696e 636c 7564            includ
+00002ae0: 655f 7061 7468 733d 696e 636c 7564 655f  e_paths=include_
+00002af0: 7061 7468 732c 0a20 2020 2020 2020 2020  paths,.         
+00002b00: 2020 2061 735f 6172 7261 793d 6173 5f61     as_array=as_a
+00002b10: 7272 6179 2c0a 2020 2020 2020 2020 2020  rray,.          
+00002b20: 2020 6173 5f73 6861 7065 6c79 3d61 735f    as_shapely=as_
+00002b30: 7368 6170 656c 792c 0a20 2020 2020 2020  shapely,.       
+00002b40: 2020 2020 2061 735f 7368 6170 656c 795f       as_shapely_
+00002b50: 6d65 7267 6564 3d61 735f 7368 6170 656c  merged=as_shapel
+00002b60: 795f 6d65 7267 6564 2c0a 2020 2020 2020  y_merged,.      
+00002b70: 2020 290a 0a20 2020 2064 6566 2067 6574    )..    def get
+00002b80: 5f64 6570 656e 6465 6e63 6965 7328 7365  _dependencies(se
+00002b90: 6c66 2c20 7265 6375 7273 6976 653a 2062  lf, recursive: b
+00002ba0: 6f6f 6c20 3d20 4661 6c73 6529 202d 3e20  ool = False) -> 
+00002bb0: 6c69 7374 5b43 6f6d 706f 6e65 6e74 5d3a  list[Component]:
+00002bc0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00002bd0: 726e 2061 206c 6973 7420 6f66 2043 6f6d  rn a list of Com
+00002be0: 706f 6e65 6e74 7320 7265 6665 7265 6e63  ponents referenc
+00002bf0: 6564 2062 7920 7468 6973 2043 6f6d 706f  ed by this Compo
+00002c00: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
+00002c10: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00002c20: 2072 6563 7572 7369 7665 3a20 4966 2054   recursive: If T
+00002c30: 7275 6520 7265 7475 726e 7320 6465 7065  rue returns depe
+00002c40: 6e64 656e 6369 6573 2072 6563 7572 7369  ndencies recursi
+00002c50: 7665 6c79 2e0a 0a20 2020 2020 2020 2022  vely...        "
+00002c60: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+00002c70: 7420 7265 6375 7273 6976 653a 0a20 2020  t recursive:.   
+00002c80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00002c90: 6c69 7374 287b 7265 662e 7061 7265 6e74  list({ref.parent
+00002ca0: 2066 6f72 2072 6566 2069 6e20 7365 6c66   for ref in self
+00002cb0: 2e72 6566 6572 656e 6365 737d 290a 0a20  .references}).. 
+00002cc0: 2020 2020 2020 2072 6566 6572 656e 6365         reference
+00002cd0: 735f 7365 7420 3d20 7365 7428 290a 2020  s_set = set().  
+00002ce0: 2020 2020 2020 5f67 6574 5f64 6570 656e        _get_depen
+00002cf0: 6465 6e63 6965 7328 7365 6c66 2c20 7265  dencies(self, re
+00002d00: 6665 7265 6e63 6573 5f73 6574 3d72 6566  ferences_set=ref
+00002d10: 6572 656e 6365 735f 7365 7429 0a20 2020  erences_set).   
+00002d20: 2020 2020 2072 6574 7572 6e20 6c69 7374       return list
+00002d30: 2872 6566 6572 656e 6365 735f 7365 7429  (references_set)
+00002d40: 0a0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
+00002d50: 7465 6d5f 5f28 7365 6c66 2c20 6b65 793a  tem__(self, key:
+00002d60: 2073 7472 207c 2069 6e74 2920 2d3e 2050   str | int) -> P
+00002d70: 6f72 743a 0a20 2020 2020 2020 2022 2222  ort:.        """
+00002d80: 4163 6365 7373 2072 6566 6572 656e 6365  Access reference
+00002d90: 2070 6f72 7473 2e22 2222 0a20 2020 2020   ports.""".     
+00002da0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00002db0: 286b 6579 2c20 696e 7429 3a0a 2020 2020  (key, int):.    
+00002dc0: 2020 2020 2020 2020 6b65 7920 3d20 6c69          key = li
+00002dd0: 7374 2873 656c 662e 706f 7274 732e 6b65  st(self.ports.ke
+00002de0: 7973 2829 295b 6b65 795d 0a0a 2020 2020  ys())[key]..    
+00002df0: 2020 2020 6966 206b 6579 206e 6f74 2069      if key not i
+00002e00: 6e20 7365 6c66 2e70 6f72 7473 3a0a 2020  n self.ports:.  
+00002e10: 2020 2020 2020 2020 2020 706f 7274 7320            ports 
+00002e20: 3d20 6c69 7374 2873 656c 662e 706f 7274  = list(self.port
+00002e30: 732e 6b65 7973 2829 290a 2020 2020 2020  s.keys()).      
+00002e40: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00002e50: 6545 7272 6f72 2866 227b 6b65 7921 727d  eError(f"{key!r}
+00002e60: 206e 6f74 2069 6e20 7b70 6f72 7473 7d22   not in {ports}"
+00002e70: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00002e80: 6e20 7365 6c66 2e70 6f72 7473 5b6b 6579  n self.ports[key
+00002e90: 5d0a 0a20 2020 2064 6566 205f 5f6c 7368  ]..    def __lsh
+00002ea0: 6966 745f 5f28 7365 6c66 2c20 656c 656d  ift__(self, elem
+00002eb0: 656e 7429 202d 3e20 436f 6d70 6f6e 656e  ent) -> Componen
+00002ec0: 7452 6566 6572 656e 6365 3a0a 2020 2020  tReference:.    
+00002ed0: 2020 2020 2222 2243 6f6e 7665 6e69 656e      """Convenien
+00002ee0: 6365 206f 7065 7261 746f 7220 6571 7569  ce operator equi
+00002ef0: 7661 6c65 6e74 2074 6f20 6164 645f 7265  valent to add_re
+00002f00: 6628 292e 2222 220a 2020 2020 2020 2020  f().""".        
+00002f10: 7265 7475 726e 2073 656c 662e 6164 645f  return self.add_
+00002f20: 7265 6628 656c 656d 656e 7429 0a0a 2020  ref(element)..  
+00002f30: 2020 6465 6620 5f5f 7365 7469 7465 6d5f    def __setitem_
+00002f40: 5f28 7365 6c66 2c20 6b65 792c 2065 6c65  _(self, key, ele
+00002f50: 6d65 6e74 293a 0a20 2020 2020 2020 2022  ment):.        "
+00002f60: 2222 416c 6c6f 7720 6164 6469 6e67 2070  ""Allow adding p
+00002f70: 6f6c 7967 6f6e 7320 616e 6420 6365 6c6c  olygons and cell
+00002f80: 2072 6566 6572 656e 6365 732e 0a0a 2020   references...  
+00002f90: 2020 2020 2020 6c69 6b65 2044 5b27 6172        like D['ar
+00002fa0: 6333 275d 203d 2070 672e 6172 6328 290a  c3'] = pg.arc().
+00002fb0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00002fc0: 2020 2020 2020 2020 2020 206b 6579 3a20             key: 
+00002fd0: 416c 6961 7320 6e61 6d65 2e0a 2020 2020  Alias name..    
+00002fe0: 2020 2020 2020 2020 656c 656d 656e 743a          element:
+00002ff0: 204f 626a 6563 7420 7468 6174 2077 696c   Object that wil
+00003000: 6c20 6265 2061 6363 6573 7369 626c 6520  l be accessible 
+00003010: 6279 2061 6c69 6173 206e 616d 652e 0a0a  by alias name...
+00003020: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00003030: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00003040: 6528 656c 656d 656e 742c 2043 6f6d 706f  e(element, Compo
+00003050: 6e65 6e74 5265 6665 7265 6e63 6520 7c20  nentReference | 
+00003060: 506f 6c79 676f 6e29 3a0a 2020 2020 2020  Polygon):.      
+00003070: 2020 2020 2020 7365 6c66 2e6e 616d 6564        self.named
+00003080: 5f72 6566 6572 656e 6365 735b 6b65 795d  _references[key]
+00003090: 203d 2065 6c65 6d65 6e74 0a20 2020 2020   = element.     
+000030a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000030b0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000030c0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+000030d0: 2020 2020 2020 2066 2254 7269 6564 2074         f"Tried t
+000030e0: 6f20 6173 7369 676e 2061 6c69 6173 207b  o assign alias {
+000030f0: 6b65 7921 727d 2069 6e20 436f 6d70 6f6e  key!r} in Compon
+00003100: 656e 7420 7b73 656c 662e 6e61 6d65 2172  ent {self.name!r
+00003110: 7d2c 220a 2020 2020 2020 2020 2020 2020  },".            
+00003120: 2020 2020 2262 7574 2066 6169 6c65 6420      "but failed 
+00003130: 6265 6361 7573 6520 7468 6520 6974 656d  because the item
+00003140: 2077 6173 206e 6f74 2061 2043 6f6d 706f   was not a Compo
+00003150: 6e65 6e74 5265 6665 7265 6e63 6522 0a20  nentReference". 
+00003160: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00003170: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00003180: 2020 2064 6566 205f 5f67 6574 5f76 616c     def __get_val
+00003190: 6964 6174 6f72 735f 5f28 636c 7329 3a0a  idators__(cls):.
+000031a0: 2020 2020 2020 2020 2222 2247 6574 2076          """Get v
+000031b0: 616c 6964 6174 6f72 7320 666f 7220 7468  alidators for th
+000031c0: 6520 436f 6d70 6f6e 656e 7420 6f62 6a65  e Component obje
+000031d0: 6374 2e22 2222 0a20 2020 2020 2020 2079  ct.""".        y
+000031e0: 6965 6c64 2063 6c73 2e76 616c 6964 6174  ield cls.validat
+000031f0: 650a 0a20 2020 2040 636c 6173 736d 6574  e..    @classmet
+00003200: 686f 640a 2020 2020 6465 6620 7661 6c69  hod.    def vali
+00003210: 6461 7465 2863 6c73 2c20 762c 205f 696e  date(cls, v, _in
+00003220: 666f 293a 0a20 2020 2020 2020 2022 2222  fo):.        """
+00003230: 5079 6461 6e74 6963 2061 7373 756d 6573  Pydantic assumes
+00003240: 2063 6f6d 706f 6e65 6e74 2069 7320 7661   component is va
+00003250: 6c69 6420 6966 2074 6865 2066 6f6c 6c6f  lid if the follo
+00003260: 7769 6e67 2061 7265 2074 7275 652e 0a0a  wing are true...
+00003270: 2020 2020 2020 2020 2d20 6e61 6d65 2063          - name c
+00003280: 6861 7261 6374 6572 7320 3c20 7064 6b2e  haracters < pdk.
+00003290: 6365 6c6c 5f64 6563 6f72 6174 6f72 5f73  cell_decorator_s
+000032a0: 6574 7469 6e67 732e 6d61 785f 6e61 6d65  ettings.max_name
+000032b0: 5f6c 656e 6774 680a 2020 2020 2020 2020  _length.        
+000032c0: 2d20 6973 206e 6f74 2065 6d70 7479 2028  - is not empty (
+000032d0: 6861 7320 7265 6665 7265 6e63 6573 206f  has references o
+000032e0: 7220 706f 6c79 676f 6e73 290a 2020 2020  r polygons).    
+000032f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00003300: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+00003310: 7064 6b20 696d 706f 7274 2067 6574 5f61  pdk import get_a
+00003320: 6374 6976 655f 7064 6b0a 0a20 2020 2020  ctive_pdk..     
+00003330: 2020 2070 646b 203d 2067 6574 5f61 6374     pdk = get_act
+00003340: 6976 655f 7064 6b28 290a 0a20 2020 2020  ive_pdk()..     
+00003350: 2020 206d 6178 5f6e 616d 655f 6c65 6e67     max_name_leng
+00003360: 7468 203d 2070 646b 2e63 656c 6c5f 6465  th = pdk.cell_de
+00003370: 636f 7261 746f 725f 7365 7474 696e 6773  corator_settings
+00003380: 2e6d 6178 5f6e 616d 655f 6c65 6e67 7468  .max_name_length
+00003390: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+000033a0: 6973 696e 7374 616e 6365 280a 2020 2020  isinstance(.    
+000033b0: 2020 2020 2020 2020 762c 2043 6f6d 706f          v, Compo
+000033c0: 6e65 6e74 0a20 2020 2020 2020 2029 2c20  nent.        ), 
+000033d0: 6622 5479 7065 4572 726f 722c 2047 6f74  f"TypeError, Got
+000033e0: 207b 7479 7065 2876 297d 2c20 6578 7065   {type(v)}, expe
+000033f0: 6374 696e 6720 436f 6d70 6f6e 656e 7422  cting Component"
+00003400: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00003410: 280a 2020 2020 2020 2020 2020 2020 6c65  (.            le
+00003420: 6e28 762e 6e61 6d65 2920 3c3d 206d 6178  n(v.name) <= max
+00003430: 5f6e 616d 655f 6c65 6e67 7468 0a20 2020  _name_length.   
+00003440: 2020 2020 2029 2c20 6622 6e61 6d65 2060       ), f"name `
+00003450: 7b76 2e6e 616d 657d 6020 7b6c 656e 2876  {v.name}` {len(v
+00003460: 2e6e 616d 6529 7d20 3e20 7b6d 6178 5f6e  .name)} > {max_n
+00003470: 616d 655f 6c65 6e67 7468 7d20 220a 2020  ame_length} ".  
+00003480: 2020 2020 2020 7265 7475 726e 2076 0a0a        return v..
+00003490: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+000034a0: 2020 6465 6620 6e61 6d65 645f 7265 6665    def named_refe
+000034b0: 7265 6e63 6573 2873 656c 6629 3a0a 2020  rences(self):.  
+000034c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000034d0: 662e 5f6e 616d 6564 5f72 6566 6572 656e  f._named_referen
+000034e0: 6365 730a 0a20 2020 2064 6566 2061 6464  ces..    def add
+000034f0: 5f6c 6162 656c 280a 2020 2020 2020 2020  _label(.        
+00003500: 7365 6c66 2c0a 2020 2020 2020 2020 7465  self,.        te
+00003510: 7874 3a20 7374 7220 3d20 2268 656c 6c6f  xt: str = "hello
+00003520: 222c 0a20 2020 2020 2020 2070 6f73 6974  ",.        posit
+00003530: 696f 6e3a 2074 7570 6c65 5b66 6c6f 6174  ion: tuple[float
+00003540: 2c20 666c 6f61 745d 203d 2028 302e 302c  , float] = (0.0,
+00003550: 2030 2e30 292c 0a20 2020 2020 2020 206d   0.0),.        m
+00003560: 6167 6e69 6669 6361 7469 6f6e 3a20 666c  agnification: fl
+00003570: 6f61 7420 3d20 312e 302c 0a20 2020 2020  oat = 1.0,.     
+00003580: 2020 2072 6f74 6174 696f 6e3a 2066 6c6f     rotation: flo
+00003590: 6174 203d 2030 2c0a 2020 2020 2020 2020  at = 0,.        
+000035a0: 616e 6368 6f72 3a20 7374 7220 3d20 226f  anchor: str = "o
+000035b0: 222c 0a20 2020 2020 2020 206c 6179 6572  ",.        layer
+000035c0: 3a20 4c61 7965 7253 7065 6320 3d20 2254  : LayerSpec = "T
+000035d0: 4558 5422 2c0a 2020 2020 2020 2020 785f  EXT",.        x_
+000035e0: 7265 666c 6563 7469 6f6e 3a20 626f 6f6c  reflection: bool
+000035f0: 203d 2046 616c 7365 2c0a 2020 2020 2920   = False,.    ) 
+00003600: 2d3e 204c 6162 656c 3a0a 2020 2020 2020  -> Label:.      
+00003610: 2020 2222 2241 6464 7320 4c61 6265 6c20    """Adds Label 
+00003620: 746f 2074 6865 2043 6f6d 706f 6e65 6e74  to the Component
+00003630: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00003640: 0a20 2020 2020 2020 2020 2020 2074 6578  .            tex
+00003650: 743a 204c 6162 656c 2074 6578 742e 0a20  t: Label text.. 
+00003660: 2020 2020 2020 2020 2020 2070 6f73 6974             posit
+00003670: 696f 6e3a 2078 2d2c 2079 2d63 6f6f 7264  ion: x-, y-coord
+00003680: 696e 6174 6573 206f 6620 7468 6520 4c61  inates of the La
+00003690: 6265 6c20 6c6f 6361 7469 6f6e 2e0a 2020  bel location..  
+000036a0: 2020 2020 2020 2020 2020 6d61 676e 6966            magnif
+000036b0: 6963 6174 696f 6e3a 204d 6167 6e69 6669  ication: Magnifi
+000036c0: 6361 7469 6f6e 2066 6163 746f 7220 666f  cation factor fo
+000036d0: 7220 7468 6520 4c61 6265 6c20 7465 7874  r the Label text
+000036e0: 2e0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
+000036f0: 7461 7469 6f6e 3a20 416e 676c 6520 726f  tation: Angle ro
+00003700: 7461 7469 6f6e 206f 6620 7468 6520 4c61  tation of the La
+00003710: 6265 6c20 7465 7874 2e0a 2020 2020 2020  bel text..      
+00003720: 2020 2020 2020 616e 6368 6f72 3a20 7b27        anchor: {'
+00003730: 6e27 2c20 2765 272c 2027 7327 2c20 2777  n', 'e', 's', 'w
+00003740: 272c 2027 6f27 2c20 276e 6527 2c20 276e  ', 'o', 'ne', 'n
+00003750: 7727 2c20 2e2e 2e7d 0a20 2020 2020 2020  w', ...}.       
+00003760: 2020 2020 2020 2020 2050 6f73 6974 696f           Positio
+00003770: 6e20 6f66 2074 6865 2061 6e63 686f 7220  n of the anchor 
+00003780: 7265 6c61 7469 7665 2074 6f20 7468 6520  relative to the 
+00003790: 7465 7874 2e0a 2020 2020 2020 2020 2020  text..          
+000037a0: 2020 6c61 7965 723a 2053 7065 6369 6669    layer: Specifi
+000037b0: 6320 6c61 7965 7228 7329 2074 6f20 7075  c layer(s) to pu
+000037c0: 7420 4c61 6265 6c20 6f6e 2e0a 2020 2020  t Label on..    
+000037d0: 2020 2020 2020 2020 785f 7265 666c 6563          x_reflec
+000037e0: 7469 6f6e 3a20 5472 7565 2072 6566 6c65  tion: True refle
+000037f0: 6374 7320 6163 726f 7373 2074 6865 2068  cts across the h
+00003800: 6f72 697a 6f6e 7461 6c20 6178 6973 2062  orizontal axis b
+00003810: 6566 6f72 6520 726f 7461 7469 6f6e 2e0a  efore rotation..
+00003820: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00003830: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+00003840: 6f72 792e 7064 6b20 696d 706f 7274 2067  ory.pdk import g
+00003850: 6574 5f6c 6179 6572 0a0a 2020 2020 2020  et_layer..      
+00003860: 2020 6c61 7965 7220 3d20 6765 745f 6c61    layer = get_la
+00003870: 7965 7228 6c61 7965 7229 0a0a 2020 2020  yer(layer)..    
+00003880: 2020 2020 6764 735f 6c61 7965 722c 2067      gds_layer, g
+00003890: 6473 5f64 6174 6174 7970 6520 3d20 6c61  ds_datatype = la
+000038a0: 7965 720a 0a20 2020 2020 2020 2069 6620  yer..        if 
+000038b0: 6e6f 7420 6973 696e 7374 616e 6365 2874  not isinstance(t
+000038c0: 6578 742c 2073 7472 293a 0a20 2020 2020  ext, str):.     
+000038d0: 2020 2020 2020 2074 6578 7420 3d20 7465         text = te
+000038e0: 7874 0a20 2020 2020 2020 206c 6162 656c  xt.        label
+000038f0: 203d 204c 6162 656c 280a 2020 2020 2020   = Label(.      
+00003900: 2020 2020 2020 7465 7874 3d74 6578 742c        text=text,
+00003910: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
+00003920: 6769 6e3d 706f 7369 7469 6f6e 2c0a 2020  gin=position,.  
+00003930: 2020 2020 2020 2020 2020 616e 6368 6f72            anchor
+00003940: 3d61 6e63 686f 722c 0a20 2020 2020 2020  =anchor,.       
+00003950: 2020 2020 206d 6167 6e69 6669 6361 7469       magnificati
+00003960: 6f6e 3d6d 6167 6e69 6669 6361 7469 6f6e  on=magnification
+00003970: 2c0a 2020 2020 2020 2020 2020 2020 726f  ,.            ro
+00003980: 7461 7469 6f6e 3d72 6f74 6174 696f 6e2c  tation=rotation,
+00003990: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+000039a0: 6572 3d67 6473 5f6c 6179 6572 2c0a 2020  er=gds_layer,.  
+000039b0: 2020 2020 2020 2020 2020 7465 7874 7479            textty
+000039c0: 7065 3d67 6473 5f64 6174 6174 7970 652c  pe=gds_datatype,
+000039d0: 0a20 2020 2020 2020 2020 2020 2078 5f72  .            x_r
+000039e0: 6566 6c65 6374 696f 6e3d 785f 7265 666c  eflection=x_refl
+000039f0: 6563 7469 6f6e 2c0a 2020 2020 2020 2020  ection,.        
+00003a00: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00003a10: 6464 286c 6162 656c 290a 2020 2020 2020  dd(label).      
+00003a20: 2020 7265 7475 726e 206c 6162 656c 0a0a    return label..
+00003a30: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+00003a40: 2020 6465 6620 6262 6f78 2873 656c 6629    def bbox(self)
+00003a50: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00003a60: 7572 6e73 2074 6865 2062 6f75 6e64 696e  urns the boundin
+00003a70: 6720 626f 7820 6f66 2074 6865 2043 6f6d  g box of the Com
+00003a80: 706f 6e65 6e74 5265 6665 7265 6e63 652e  ponentReference.
+00003a90: 2222 220a 2020 2020 2020 2020 6262 6f78  """.        bbox
+00003aa0: 203d 2073 656c 662e 5f63 656c 6c2e 626f   = self._cell.bo
+00003ab0: 756e 6469 6e67 5f62 6f78 2829 0a20 2020  unding_box().   
+00003ac0: 2020 2020 2069 6620 6262 6f78 2069 7320       if bbox is 
+00003ad0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00003ae0: 2020 6262 6f78 203d 2028 2830 2c20 3029    bbox = ((0, 0)
+00003af0: 2c20 2830 2c20 3029 290a 2020 2020 2020  , (0, 0)).      
+00003b00: 2020 7265 7475 726e 2073 6e61 705f 746f    return snap_to
+00003b10: 5f67 7269 6428 6e70 2e61 7272 6179 2862  _grid(np.array(b
+00003b20: 626f 7829 290a 0a20 2020 2040 7072 6f70  box))..    @prop
+00003b30: 6572 7479 0a20 2020 2064 6566 2070 6f72  erty.    def por
+00003b40: 7473 5f6c 6179 6572 2873 656c 6629 202d  ts_layer(self) -
+00003b50: 3e20 6469 6374 5b73 7472 2c20 7374 725d  > dict[str, str]
+00003b60: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00003b70: 7572 6e73 2061 206d 6170 7069 6e67 2066  urns a mapping f
+00003b80: 726f 6d20 6c61 7965 7230 5f6c 6179 6572  rom layer0_layer
+00003b90: 315f 4530 3a20 706f 7274 4e61 6d65 2e22  1_E0: portName."
+00003ba0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00003bb0: 6e20 6d61 705f 706f 7274 735f 6c61 7965  n map_ports_laye
+00003bc0: 725f 746f 5f6f 7269 656e 7461 7469 6f6e  r_to_orientation
+00003bd0: 2873 656c 662e 706f 7274 7329 0a0a 2020  (self.ports)..  
+00003be0: 2020 6465 6620 706f 7274 5f62 795f 6f72    def port_by_or
+00003bf0: 6965 6e74 6174 696f 6e5f 6377 2873 656c  ientation_cw(sel
+00003c00: 662c 206b 6579 3a20 7374 722c 202a 2a6b  f, key: str, **k
+00003c10: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00003c20: 2222 2252 6574 7572 6e73 2070 6f72 7420  """Returns port 
+00003c30: 6279 2069 6e64 6578 696e 6720 7468 656d  by indexing them
+00003c40: 2063 6c6f 636b 7769 7365 2e22 2222 0a20   clockwise.""". 
+00003c50: 2020 2020 2020 206d 203d 206d 6170 5f70         m = map_p
+00003c60: 6f72 7473 5f74 6f5f 6f72 6965 6e74 6174  orts_to_orientat
+00003c70: 696f 6e5f 6377 2873 656c 662e 706f 7274  ion_cw(self.port
+00003c80: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
+00003c90: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
+00003ca0: 696e 206d 3a0a 2020 2020 2020 2020 2020  in m:.          
+00003cb0: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
+00003cc0: 2866 227b 6b65 797d 206e 6f74 2069 6e20  (f"{key} not in 
+00003cd0: 7b6c 6973 7428 6d2e 6b65 7973 2829 297d  {list(m.keys())}
+00003ce0: 2229 0a20 2020 2020 2020 206b 6579 3220  ").        key2 
+00003cf0: 3d20 6d5b 6b65 795d 0a20 2020 2020 2020  = m[key].       
+00003d00: 2072 6574 7572 6e20 7365 6c66 2e70 6f72   return self.por
+00003d10: 7473 5b6b 6579 325d 0a0a 2020 2020 6465  ts[key2]..    de
+00003d20: 6620 706f 7274 5f62 795f 6f72 6965 6e74  f port_by_orient
+00003d30: 6174 696f 6e5f 6363 7728 7365 6c66 2c20  ation_ccw(self, 
+00003d40: 6b65 793a 2073 7472 2c20 2a2a 6b77 6172  key: str, **kwar
+00003d50: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
+00003d60: 5265 7475 726e 7320 706f 7274 2062 7920  Returns port by 
+00003d70: 696e 6465 7869 6e67 2074 6865 6d20 636c  indexing them cl
+00003d80: 6f63 6b77 6973 652e 2222 220a 2020 2020  ockwise.""".    
+00003d90: 2020 2020 6d20 3d20 6d61 705f 706f 7274      m = map_port
+00003da0: 735f 746f 5f6f 7269 656e 7461 7469 6f6e  s_to_orientation
+00003db0: 5f63 6377 2873 656c 662e 706f 7274 732c  _ccw(self.ports,
+00003dc0: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
+00003dd0: 2020 2069 6620 6b65 7920 6e6f 7420 696e     if key not in
+00003de0: 206d 3a0a 2020 2020 2020 2020 2020 2020   m:.            
+00003df0: 7261 6973 6520 4b65 7945 7272 6f72 2866  raise KeyError(f
+00003e00: 227b 6b65 797d 206e 6f74 2069 6e20 7b6c  "{key} not in {l
+00003e10: 6973 7428 6d2e 6b65 7973 2829 297d 2229  ist(m.keys())}")
+00003e20: 0a20 2020 2020 2020 206b 6579 3220 3d20  .        key2 = 
+00003e30: 6d5b 6b65 795d 0a20 2020 2020 2020 2072  m[key].        r
+00003e40: 6574 7572 6e20 7365 6c66 2e70 6f72 7473  eturn self.ports
+00003e50: 5b6b 6579 325d 0a0a 2020 2020 6465 6620  [key2]..    def 
+00003e60: 6765 745f 706f 7274 735f 7873 697a 6528  get_ports_xsize(
+00003e70: 7365 6c66 2c20 2a2a 6b77 6172 6773 2920  self, **kwargs) 
+00003e80: 2d3e 2066 6c6f 6174 3a0a 2020 2020 2020  -> float:.      
+00003e90: 2020 2222 2252 6574 7572 6e73 2078 6469    """Returns xdi
+00003ea0: 7374 616e 6365 2066 726f 6d20 6561 7374  stance from east
+00003eb0: 2074 6f20 7765 7374 2070 6f72 7473 2e0a   to west ports..
+00003ec0: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
+00003ed0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00003ee0: 2020 206c 6179 6572 3a20 706f 7274 2047     layer: port G
+00003ef0: 4453 206c 6179 6572 2e0a 2020 2020 2020  DS layer..      
+00003f00: 2020 2020 2020 7072 6566 6978 3a20 7769        prefix: wi
+00003f10: 7468 2069 6e20 706f 7274 206e 616d 652e  th in port name.
+00003f20: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
+00003f30: 656e 7461 7469 6f6e 3a20 696e 2064 6567  entation: in deg
+00003f40: 7265 6573 2e0a 2020 2020 2020 2020 2020  rees..          
+00003f50: 2020 7769 6474 683a 2070 6f72 7420 7769    width: port wi
+00003f60: 6474 682e 0a20 2020 2020 2020 2020 2020  dth..           
+00003f70: 206c 6179 6572 735f 6578 636c 7564 6564   layers_excluded
+00003f80: 3a20 4c69 7374 206f 6620 6c61 7965 7273  : List of layers
+00003f90: 2074 6f20 6578 636c 7564 652e 0a20 2020   to exclude..   
+00003fa0: 2020 2020 2020 2020 2070 6f72 745f 7479           port_ty
+00003fb0: 7065 3a20 6f70 7469 6361 6c2c 2065 6c65  pe: optical, ele
+00003fc0: 6374 7269 6361 6c2c 202e 2e2e 0a20 2020  ctrical, ....   
+00003fd0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00003fe0: 2070 6f72 7473 5f63 7720 3d20 7365 6c66   ports_cw = self
+00003ff0: 2e67 6574 5f70 6f72 7473 5f6c 6973 7428  .get_ports_list(
+00004000: 636c 6f63 6b77 6973 653d 5472 7565 2c20  clockwise=True, 
+00004010: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+00004020: 2020 706f 7274 735f 6363 7720 3d20 7365    ports_ccw = se
+00004030: 6c66 2e67 6574 5f70 6f72 7473 5f6c 6973  lf.get_ports_lis
+00004040: 7428 636c 6f63 6b77 6973 653d 4661 6c73  t(clockwise=Fals
+00004050: 652c 202a 2a6b 7761 7267 7329 0a20 2020  e, **kwargs).   
+00004060: 2020 2020 2072 6574 7572 6e20 706f 7274       return port
+00004070: 735f 6363 775b 305d 2e78 202d 2070 6f72  s_ccw[0].x - por
+00004080: 7473 5f63 775b 305d 2e78 0a0a 2020 2020  ts_cw[0].x..    
+00004090: 6465 6620 6765 745f 706f 7274 735f 7973  def get_ports_ys
+000040a0: 697a 6528 7365 6c66 2c20 2a2a 6b77 6172  ize(self, **kwar
+000040b0: 6773 2920 2d3e 2066 6c6f 6174 3a0a 2020  gs) -> float:.  
+000040c0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+000040d0: 2079 6469 7374 616e 6365 2066 726f 6d20   ydistance from 
+000040e0: 6561 7374 2074 6f20 7765 7374 2070 6f72  east to west por
+000040f0: 7473 2e0a 0a20 2020 2020 2020 204b 6579  ts...        Key
+00004100: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+00004110: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
+00004120: 7274 2047 4453 206c 6179 6572 2e0a 2020  rt GDS layer..  
+00004130: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00004140: 3a20 7769 7468 2069 6e20 706f 7274 206e  : with in port n
+00004150: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
+00004160: 206f 7269 656e 7461 7469 6f6e 3a20 696e   orientation: in
+00004170: 2064 6567 7265 6573 2e0a 2020 2020 2020   degrees..      
+00004180: 2020 2020 2020 7769 6474 683a 2070 6f72        width: por
+00004190: 7420 7769 6474 6820 2875 6d29 2e0a 2020  t width (um)..  
+000041a0: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
+000041b0: 5f65 7863 6c75 6465 643a 204c 6973 7420  _excluded: List 
+000041c0: 6f66 206c 6179 6572 7320 746f 2065 7863  of layers to exc
+000041d0: 6c75 6465 2e0a 2020 2020 2020 2020 2020  lude..          
+000041e0: 2020 706f 7274 5f74 7970 653a 206f 7074    port_type: opt
+000041f0: 6963 616c 2c20 656c 6563 7472 6963 616c  ical, electrical
+00004200: 2c20 2e2e 2e0a 2020 2020 2020 2020 2222  , ....        ""
+00004210: 220a 2020 2020 2020 2020 706f 7274 735f  ".        ports_
+00004220: 6377 203d 2073 656c 662e 6765 745f 706f  cw = self.get_po
+00004230: 7274 735f 6c69 7374 2863 6c6f 636b 7769  rts_list(clockwi
+00004240: 7365 3d54 7275 652c 202a 2a6b 7761 7267  se=True, **kwarg
+00004250: 7329 0a20 2020 2020 2020 2070 6f72 7473  s).        ports
+00004260: 5f63 6377 203d 2073 656c 662e 6765 745f  _ccw = self.get_
+00004270: 706f 7274 735f 6c69 7374 2863 6c6f 636b  ports_list(clock
+00004280: 7769 7365 3d46 616c 7365 2c20 2a2a 6b77  wise=False, **kw
+00004290: 6172 6773 290a 2020 2020 2020 2020 7265  args).        re
+000042a0: 7475 726e 2070 6f72 7473 5f63 6377 5b30  turn ports_ccw[0
+000042b0: 5d2e 7920 2d20 706f 7274 735f 6377 5b30  ].y - ports_cw[0
+000042c0: 5d2e 790a 0a20 2020 2064 6566 2070 6c6f  ].y..    def plo
+000042d0: 745f 6e65 746c 6973 7428 0a20 2020 2020  t_netlist(.     
+000042e0: 2020 2073 656c 662c 2077 6974 685f 6c61     self, with_la
+000042f0: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
+00004300: 652c 2066 6f6e 745f 7765 6967 6874 3a20  e, font_weight: 
+00004310: 7374 7220 3d20 226e 6f72 6d61 6c22 2c20  str = "normal", 
+00004320: 2a2a 6b77 6172 6773 0a20 2020 2029 3a0a  **kwargs.    ):.
+00004330: 2020 2020 2020 2020 2222 2250 6c6f 7473          """Plots
+00004340: 2061 206e 6574 6c69 7374 2067 7261 7068   a netlist graph
+00004350: 2077 6974 6820 6e65 7477 6f72 6b78 2e0a   with networkx..
+00004360: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00004370: 2020 2020 2020 2020 2020 2077 6974 685f             with_
+00004380: 6c61 6265 6c73 3a20 6164 6420 6c61 6265  labels: add labe
+00004390: 6c20 746f 2065 6163 6820 6e6f 6465 2e0a  l to each node..
+000043a0: 2020 2020 2020 2020 2020 2020 666f 6e74              font
+000043b0: 5f77 6569 6768 743a 206e 6f72 6d61 6c2c  _weight: normal,
+000043c0: 2062 6f6c 642e 0a20 2020 2020 2020 2020   bold..         
+000043d0: 2020 202a 2a6b 7761 7267 733a 206b 6579     **kwargs: key
+000043e0: 776f 7264 2061 7267 756d 656e 7473 2066  word arguments f
+000043f0: 6f72 2074 6865 2067 6574 5f6e 6574 6c69  or the get_netli
+00004400: 7374 2066 756e 6374 696f 6e0a 2020 2020  st function.    
+00004410: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00004420: 696d 706f 7274 206d 6174 706c 6f74 6c69  import matplotli
+00004430: 622e 7079 706c 6f74 2061 7320 706c 740a  b.pyplot as plt.
+00004440: 2020 2020 2020 2020 696d 706f 7274 206e          import n
+00004450: 6574 776f 726b 7820 6173 206e 780a 0a20  etworkx as nx.. 
+00004460: 2020 2020 2020 2070 6c74 2e66 6967 7572         plt.figur
+00004470: 6528 290a 2020 2020 2020 2020 6e65 746c  e().        netl
+00004480: 6973 7420 3d20 7365 6c66 2e67 6574 5f6e  ist = self.get_n
+00004490: 6574 6c69 7374 282a 2a6b 7761 7267 7329  etlist(**kwargs)
+000044a0: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
+000044b0: 696f 6e73 203d 206e 6574 6c69 7374 5b22  ions = netlist["
+000044c0: 636f 6e6e 6563 7469 6f6e 7322 5d0a 2020  connections"].  
+000044d0: 2020 2020 2020 706c 6163 656d 656e 7473        placements
+000044e0: 203d 206e 6574 6c69 7374 5b22 706c 6163   = netlist["plac
+000044f0: 656d 656e 7473 225d 0a20 2020 2020 2020  ements"].       
+00004500: 2047 203d 206e 782e 4772 6170 6828 290a   G = nx.Graph().
+00004510: 2020 2020 2020 2020 472e 6164 645f 6564          G.add_ed
+00004520: 6765 735f 6672 6f6d 280a 2020 2020 2020  ges_from(.      
+00004530: 2020 2020 2020 5b0a 2020 2020 2020 2020        [.        
+00004540: 2020 2020 2020 2020 2822 2c22 2e6a 6f69          (",".joi
+00004550: 6e28 6b2e 7370 6c69 7428 222c 2229 5b3a  n(k.split(",")[:
+00004560: 2d31 5d29 2c20 222c 222e 6a6f 696e 2876  -1]), ",".join(v
+00004570: 2e73 706c 6974 2822 2c22 295b 3a2d 315d  .split(",")[:-1]
+00004580: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00004590: 2020 2066 6f72 206b 2c20 7620 696e 2063     for k, v in c
+000045a0: 6f6e 6e65 6374 696f 6e73 2e69 7465 6d73  onnections.items
+000045b0: 2829 0a20 2020 2020 2020 2020 2020 205d  ().            ]
+000045c0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+000045d0: 2020 2070 6f73 203d 207b 6b3a 2028 765b     pos = {k: (v[
+000045e0: 2278 225d 2c20 765b 2279 225d 2920 666f  "x"], v["y"]) fo
+000045f0: 7220 6b2c 2076 2069 6e20 706c 6163 656d  r k, v in placem
+00004600: 656e 7473 2e69 7465 6d73 2829 7d0a 2020  ents.items()}.  
+00004610: 2020 2020 2020 6c61 6265 6c73 203d 207b        labels = {
+00004620: 6b3a 2022 2c22 2e6a 6f69 6e28 6b2e 7370  k: ",".join(k.sp
+00004630: 6c69 7428 222c 2229 5b3a 315d 2920 666f  lit(",")[:1]) fo
+00004640: 7220 6b20 696e 2070 6c61 6365 6d65 6e74  r k in placement
+00004650: 732e 6b65 7973 2829 7d0a 2020 2020 2020  s.keys()}.      
+00004660: 2020 6e78 2e64 7261 7728 0a20 2020 2020    nx.draw(.     
+00004670: 2020 2020 2020 2047 2c0a 2020 2020 2020         G,.      
+00004680: 2020 2020 2020 7769 7468 5f6c 6162 656c        with_label
+00004690: 733d 7769 7468 5f6c 6162 656c 732c 0a20  s=with_labels,. 
+000046a0: 2020 2020 2020 2020 2020 2066 6f6e 745f             font_
+000046b0: 7765 6967 6874 3d66 6f6e 745f 7765 6967  weight=font_weig
+000046c0: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
+000046d0: 6c61 6265 6c73 3d6c 6162 656c 732c 0a20  labels=labels,. 
+000046e0: 2020 2020 2020 2020 2020 2070 6f73 3d70             pos=p
+000046f0: 6f73 2c0a 2020 2020 2020 2020 290a 2020  os,.        ).  
+00004700: 2020 2020 2020 7265 7475 726e 2047 0a0a        return G..
+00004710: 2020 2020 6465 6620 706c 6f74 5f6e 6574      def plot_net
+00004720: 6c69 7374 5f66 6c61 7428 0a20 2020 2020  list_flat(.     
+00004730: 2020 2073 656c 662c 2077 6974 685f 6c61     self, with_la
+00004740: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
+00004750: 652c 2066 6f6e 745f 7765 6967 6874 3a20  e, font_weight: 
+00004760: 7374 7220 3d20 226e 6f72 6d61 6c22 2c20  str = "normal", 
+00004770: 2a2a 6b77 6172 6773 0a20 2020 2029 3a0a  **kwargs.    ):.
+00004780: 2020 2020 2020 2020 2222 2250 6c6f 7473          """Plots
+00004790: 2061 206e 6574 6c69 7374 2067 7261 7068   a netlist graph
+000047a0: 2077 6974 6820 6e65 7477 6f72 6b78 2e0a   with networkx..
+000047b0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+000047c0: 2020 2020 2020 2020 2020 2066 6c61 743a             flat:
+000047d0: 2069 6620 7472 7565 2c20 7769 6c6c 2070   if true, will p
+000047e0: 6c6f 7420 7468 6520 666c 6174 206e 6574  lot the flat net
+000047f0: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
+00004800: 2077 6974 685f 6c61 6265 6c73 3a20 6164   with_labels: ad
+00004810: 6420 6c61 6265 6c20 746f 2065 6163 6820  d label to each 
+00004820: 6e6f 6465 2e0a 2020 2020 2020 2020 2020  node..          
+00004830: 2020 666f 6e74 5f77 6569 6768 743a 206e    font_weight: n
+00004840: 6f72 6d61 6c2c 2062 6f6c 642e 0a20 2020  ormal, bold..   
+00004850: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
+00004860: 733a 206b 6579 776f 7264 2061 7267 756d  s: keyword argum
+00004870: 656e 7473 2066 6f72 2074 6865 2067 6574  ents for the get
+00004880: 5f6e 6574 6c69 7374 2066 756e 6374 696f  _netlist functio
+00004890: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
+000048a0: 2020 2020 2020 696d 706f 7274 206d 6174        import mat
+000048b0: 706c 6f74 6c69 622e 7079 706c 6f74 2061  plotlib.pyplot a
+000048c0: 7320 706c 740a 2020 2020 2020 2020 696d  s plt.        im
+000048d0: 706f 7274 206e 6574 776f 726b 7820 6173  port networkx as
+000048e0: 206e 780a 0a20 2020 2020 2020 2070 6c74   nx..        plt
+000048f0: 2e66 6967 7572 6528 290a 2020 2020 2020  .figure().      
+00004900: 2020 6e65 746c 6973 7420 3d20 7365 6c66    netlist = self
+00004910: 2e67 6574 5f6e 6574 6c69 7374 5f66 6c61  .get_netlist_fla
+00004920: 7428 2a2a 6b77 6172 6773 290a 2020 2020  t(**kwargs).    
+00004930: 2020 2020 636f 6e6e 6563 7469 6f6e 7320      connections 
+00004940: 3d20 6e65 746c 6973 745b 2263 6f6e 6e65  = netlist["conne
+00004950: 6374 696f 6e73 225d 0a20 2020 2020 2020  ctions"].       
+00004960: 2070 6c61 6365 6d65 6e74 7320 3d20 6e65   placements = ne
+00004970: 746c 6973 745b 2270 6c61 6365 6d65 6e74  tlist["placement
+00004980: 7322 5d0a 2020 2020 2020 2020 636f 6e6e  s"].        conn
+00004990: 6563 7469 6f6e 735f 6c69 7374 203d 205b  ections_list = [
+000049a0: 5d0a 2020 2020 2020 2020 666f 7220 6b2c  ].        for k,
+000049b0: 2076 5f6c 6973 7420 696e 2063 6f6e 6e65   v_list in conne
+000049c0: 6374 696f 6e73 2e69 7465 6d73 2829 3a0a  ctions.items():.
+000049d0: 2020 2020 2020 2020 2020 2020 636f 6e6e              conn
+000049e0: 6563 7469 6f6e 735f 6c69 7374 2e65 7874  ections_list.ext
+000049f0: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+00004a00: 2020 2020 2028 222c 222e 6a6f 696e 286b       (",".join(k
+00004a10: 2e73 706c 6974 2822 2c22 295b 3a2d 315d  .split(",")[:-1]
+00004a20: 292c 2022 2c22 2e6a 6f69 6e28 762e 7370  ), ",".join(v.sp
+00004a30: 6c69 7428 222c 2229 5b3a 2d31 5d29 290a  lit(",")[:-1])).
+00004a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a50: 666f 7220 7620 696e 2076 5f6c 6973 740a  for v in v_list.
+00004a60: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00004a70: 2020 2020 2020 4720 3d20 6e78 2e47 7261        G = nx.Gra
+00004a80: 7068 2829 0a20 2020 2020 2020 2047 2e61  ph().        G.a
+00004a90: 6464 5f65 6467 6573 5f66 726f 6d28 636f  dd_edges_from(co
+00004aa0: 6e6e 6563 7469 6f6e 735f 6c69 7374 290a  nnections_list).
+00004ab0: 2020 2020 2020 2020 706f 7320 3d20 7b6b          pos = {k
+00004ac0: 3a20 2876 5b22 7822 5d2c 2076 5b22 7922  : (v["x"], v["y"
+00004ad0: 5d29 2066 6f72 206b 2c20 7620 696e 2070  ]) for k, v in p
+00004ae0: 6c61 6365 6d65 6e74 732e 6974 656d 7328  lacements.items(
+00004af0: 297d 0a20 2020 2020 2020 206c 6162 656c  )}.        label
+00004b00: 7320 3d20 7b6b 3a20 222c 222e 6a6f 696e  s = {k: ",".join
+00004b10: 286b 2e73 706c 6974 2822 2c22 295b 3a31  (k.split(",")[:1
+00004b20: 5d29 2066 6f72 206b 2069 6e20 706c 6163  ]) for k in plac
+00004b30: 656d 656e 7473 2e6b 6579 7328 297d 0a20  ements.keys()}. 
+00004b40: 2020 2020 2020 206e 782e 6472 6177 280a         nx.draw(.
+00004b50: 2020 2020 2020 2020 2020 2020 472c 0a20              G,. 
+00004b60: 2020 2020 2020 2020 2020 2077 6974 685f             with_
+00004b70: 6c61 6265 6c73 3d77 6974 685f 6c61 6265  labels=with_labe
+00004b80: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
+00004b90: 666f 6e74 5f77 6569 6768 743d 666f 6e74  font_weight=font
+00004ba0: 5f77 6569 6768 742c 0a20 2020 2020 2020  _weight,.       
+00004bb0: 2020 2020 206c 6162 656c 733d 6c61 6265       labels=labe
+00004bc0: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
+00004bd0: 706f 733d 706f 732c 0a20 2020 2020 2020  pos=pos,.       
+00004be0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+00004bf0: 6e20 470a 0a20 2020 2064 6566 2074 6f5f  n G..    def to_
+00004c00: 7961 6d6c 2873 656c 662c 202a 2a6b 7761  yaml(self, **kwa
+00004c10: 7267 7329 202d 3e20 6469 6374 5b73 7472  rgs) -> dict[str
+00004c20: 2c20 416e 795d 3a0a 2020 2020 2020 2020  , Any]:.        
+00004c30: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+00004c40: 6765 745f 6e65 746c 6973 7420 696d 706f  get_netlist impo
+00004c50: 7274 2067 6574 5f6e 6574 6c69 7374 5f79  rt get_netlist_y
+00004c60: 616d 6c0a 0a20 2020 2020 2020 2072 6574  aml..        ret
+00004c70: 7572 6e20 6765 745f 6e65 746c 6973 745f  urn get_netlist_
+00004c80: 7961 6d6c 2873 656c 662c 202a 2a6b 7761  yaml(self, **kwa
+00004c90: 7267 7329 0a0a 2020 2020 6465 6620 7772  rgs)..    def wr
+00004ca0: 6974 655f 6e65 746c 6973 7428 7365 6c66  ite_netlist(self
+00004cb0: 2c20 6669 6c65 7061 7468 3a20 7374 7229  , filepath: str)
+00004cc0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00004cd0: 2020 2222 2257 7269 7465 206e 6574 6c69    """Write netli
+00004ce0: 7374 2069 6e20 5941 4d4c 2e22 2222 0a20  st in YAML.""". 
+00004cf0: 2020 2020 2020 206e 6574 6c69 7374 203d         netlist =
+00004d00: 2073 656c 662e 6765 745f 6e65 746c 6973   self.get_netlis
+00004d10: 7428 290a 2020 2020 2020 2020 6e65 746c  t().        netl
+00004d20: 6973 7420 3d20 636c 6561 6e5f 6469 6374  ist = clean_dict
+00004d30: 286e 6574 6c69 7374 290a 2020 2020 2020  (netlist).      
+00004d40: 2020 6669 6c65 7061 7468 203d 2070 6174    filepath = pat
+00004d50: 686c 6962 2e50 6174 6828 6669 6c65 7061  hlib.Path(filepa
+00004d60: 7468 290a 2020 2020 2020 2020 6669 6c65  th).        file
+00004d70: 7061 7468 2e77 7269 7465 5f74 6578 7428  path.write_text(
+00004d80: 7961 6d6c 2e64 756d 7028 6e65 746c 6973  yaml.dump(netlis
+00004d90: 7429 290a 0a20 2020 2064 6566 2077 7269  t))..    def wri
+00004da0: 7465 5f6e 6574 6c69 7374 5f64 6f74 2873  te_netlist_dot(s
+00004db0: 656c 662c 2066 696c 6570 6174 683a 2073  elf, filepath: s
+00004dc0: 7472 207c 204e 6f6e 6520 3d20 4e6f 6e65  tr | None = None
+00004dd0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00004de0: 2020 2022 2222 5772 6974 6520 6e65 746c     """Write netl
+00004df0: 6973 7420 6772 6170 6820 696e 2044 4f54  ist graph in DOT
+00004e00: 2066 6f72 6d61 742e 2222 220a 2020 2020   format.""".    
+00004e10: 2020 2020 6672 6f6d 206e 6574 776f 726b      from network
+00004e20: 782e 6472 6177 696e 672e 6e78 5f61 6772  x.drawing.nx_agr
+00004e30: 6170 6820 696d 706f 7274 2077 7269 7465  aph import write
+00004e40: 5f64 6f74 0a0a 2020 2020 2020 2020 6669  _dot..        fi
+00004e50: 6c65 7061 7468 203d 2066 696c 6570 6174  lepath = filepat
+00004e60: 6820 6f72 2066 227b 7365 6c66 2e6e 616d  h or f"{self.nam
+00004e70: 657d 2e64 6f74 220a 0a20 2020 2020 2020  e}.dot"..       
+00004e80: 2047 203d 2073 656c 662e 706c 6f74 5f6e   G = self.plot_n
+00004e90: 6574 6c69 7374 2829 0a20 2020 2020 2020  etlist().       
+00004ea0: 2077 7269 7465 5f64 6f74 2847 2c20 6669   write_dot(G, fi
+00004eb0: 6c65 7061 7468 290a 0a20 2020 2064 6566  lepath)..    def
+00004ec0: 2067 6574 5f6e 6574 6c69 7374 2873 656c   get_netlist(sel
+00004ed0: 662c 202a 2a6b 7761 7267 7329 202d 3e20  f, **kwargs) -> 
+00004ee0: 6469 6374 5b73 7472 2c20 416e 795d 3a0a  dict[str, Any]:.
+00004ef0: 2020 2020 2020 2020 2222 2246 726f 6d20          """From 
+00004f00: 436f 6d70 6f6e 656e 7420 7265 7475 726e  Component return
+00004f10: 7320 696e 7374 616e 6365 732c 2063 6f6e  s instances, con
+00004f20: 6e65 6374 696f 6e73 2061 6e64 2070 6c61  nections and pla
+00004f30: 6365 6d65 6e74 7320 6469 6374 2e0a 0a20  cements dict... 
+00004f40: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
+00004f50: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00004f60: 2063 6f6d 706f 6e65 6e74 3a20 746f 2065   component: to e
+00004f70: 7874 7261 6374 206e 6574 6c69 7374 2e0a  xtract netlist..
+00004f80: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
+00004f90: 5f73 6574 7469 6e67 733a 2054 7275 6520  _settings: True 
+00004fa0: 7265 7475 726e 7320 616c 6c2c 2066 616c  returns all, fal
+00004fb0: 7365 2063 6861 6e67 6564 2073 6574 7469  se changed setti
+00004fc0: 6e67 732e 0a20 2020 2020 2020 2020 2020  ngs..           
+00004fd0: 2074 6f6c 6572 616e 6365 3a20 746f 6c65   tolerance: tole
+00004fe0: 7261 6e63 6520 696e 206e 6d20 746f 2063  rance in nm to c
+00004ff0: 6f6e 7369 6465 7220 7477 6f20 706f 7274  onsider two port
+00005000: 7320 636f 6e6e 6563 7465 642e 0a20 2020  s connected..   
+00005010: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
+00005020: 5f70 6f72 745f 7479 7065 733a 206f 7074  _port_types: opt
+00005030: 696f 6e61 6c20 6c69 7374 206f 6620 706f  ional list of po
+00005040: 7274 2074 7970 6573 2074 6f20 6578 636c  rt types to excl
+00005050: 7564 6520 6672 6f6d 206e 6574 6c69 7374  ude from netlist
+00005060: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
+00005070: 2067 6574 5f69 6e73 7461 6e63 655f 6e61   get_instance_na
+00005080: 6d65 3a20 6675 6e63 7469 6f6e 2074 6f20  me: function to 
+00005090: 6765 7420 696e 7374 616e 6365 206e 616d  get instance nam
+000050a0: 652e 0a20 2020 2020 2020 2020 2020 2061  e..            a
+000050b0: 6c6c 6f77 5f6d 756c 7469 706c 653a 2046  llow_multiple: F
+000050c0: 616c 7365 2074 6f20 7261 6973 6520 616e  alse to raise an
+000050d0: 2065 7272 6f72 2069 6620 6d6f 7265 2074   error if more t
+000050e0: 6861 6e20 7477 6f20 706f 7274 7320 7368  han two ports sh
+000050f0: 6172 6520 7468 6520 7361 6d65 2063 6f6e  are the same con
+00005100: 6e65 6374 696f 6e2e 0a20 2020 2020 2020  nection..       
+00005110: 2020 2020 2020 2020 2069 6620 5472 7565           if True
+00005120: 2c20 7769 6c6c 2072 6574 7572 6e20 6b65  , will return ke
+00005130: 793a 205b 7661 6c75 655d 2070 6169 7273  y: [value] pairs
+00005140: 2077 6974 6820 5b76 616c 7565 5d20 6120   with [value] a 
+00005150: 6c69 7374 206f 6620 616c 6c20 636f 6e6e  list of all conn
+00005160: 6563 7465 6420 696e 7374 616e 6365 732e  ected instances.
+00005170: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00005180: 733a 0a20 2020 2020 2020 2020 2020 204e  s:.            N
+00005190: 6574 6c69 7374 2064 6963 7420 2869 6e73  etlist dict (ins
+000051a0: 7461 6e63 6573 2c20 636f 6e6e 6563 7469  tances, connecti
+000051b0: 6f6e 732c 2070 6c61 6365 6d65 6e74 732c  ons, placements,
+000051c0: 2070 6f72 7473 290a 2020 2020 2020 2020   ports).        
+000051d0: 2020 2020 2020 2020 696e 7374 616e 6365          instance
+000051e0: 733a 2044 6963 7420 6f66 2069 6e73 7461  s: Dict of insta
+000051f0: 6e63 6520 6e61 6d65 2061 6e64 2073 6574  nce name and set
+00005200: 7469 6e67 732e 0a20 2020 2020 2020 2020  tings..         
+00005210: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
+00005220: 6e73 3a20 4469 6374 206f 6620 496e 7374  ns: Dict of Inst
+00005230: 616e 6365 314e 616d 652c 706f 7274 4e61  ance1Name,portNa
+00005240: 6d65 3a20 496e 7374 616e 6365 324e 616d  me: Instance2Nam
+00005250: 652c 706f 7274 4e61 6d65 2e0a 2020 2020  e,portName..    
+00005260: 2020 2020 2020 2020 2020 2020 706c 6163              plac
+00005270: 656d 656e 7473 3a20 4469 6374 206f 6620  ements: Dict of 
+00005280: 696e 7374 616e 6365 206e 616d 6573 2061  instance names a
+00005290: 6e64 2070 6c61 6365 6d65 6e74 7320 2878  nd placements (x
+000052a0: 2c20 792c 2072 6f74 6174 696f 6e29 2e0a  , y, rotation)..
+000052b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052c0: 706f 7274 733a 2044 6963 7420 706f 7274  ports: Dict port
+000052d0: 4e61 6d65 3a20 436f 6d70 6f6e 656e 744e  Name: ComponentN
+000052e0: 616d 652c 706f 7274 2e0a 2020 2020 2020  ame,port..      
+000052f0: 2020 2020 2020 2020 2020 6e61 6d65 3a20            name: 
+00005300: 6e61 6d65 206f 6620 636f 6d70 6f6e 656e  name of componen
+00005310: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
+00005320: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
+00005330: 6163 746f 7279 2e67 6574 5f6e 6574 6c69  actory.get_netli
+00005340: 7374 2069 6d70 6f72 7420 6765 745f 6e65  st import get_ne
+00005350: 746c 6973 740a 0a20 2020 2020 2020 2072  tlist..        r
+00005360: 6574 7572 6e20 6765 745f 6e65 746c 6973  eturn get_netlis
+00005370: 7428 636f 6d70 6f6e 656e 743d 7365 6c66  t(component=self
+00005380: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+00005390: 2064 6566 2067 6574 5f6e 6574 6c69 7374   def get_netlist
+000053a0: 5f72 6563 7572 7369 7665 2873 656c 662c  _recursive(self,
+000053b0: 202a 2a6b 7761 7267 7329 202d 3e20 6469   **kwargs) -> di
+000053c0: 6374 5b73 7472 2c20 4469 6374 436f 6e66  ct[str, DictConf
+000053d0: 6967 5d3a 0a20 2020 2020 2020 2022 2222  ig]:.        """
+000053e0: 5265 7475 726e 7320 7265 6375 7273 6976  Returns recursiv
+000053f0: 6520 6e65 746c 6973 7420 666f 7220 6120  e netlist for a 
+00005400: 636f 6d70 6f6e 656e 7420 616e 6420 7375  component and su
+00005410: 6263 6f6d 706f 6e65 6e74 732e 0a0a 2020  bcomponents...  
+00005420: 2020 2020 2020 4b65 7977 6f72 6420 4172        Keyword Ar
+00005430: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00005440: 636f 6d70 6f6e 656e 743a 2074 6f20 6578  component: to ex
+00005450: 7472 6163 7420 6e65 746c 6973 742e 0a20  tract netlist.. 
+00005460: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
+00005470: 6e65 6e74 5f73 7566 6669 783a 2073 7566  nent_suffix: suf
+00005480: 6669 7820 746f 2061 7070 656e 6420 746f  fix to append to
+00005490: 2065 6163 6820 636f 6d70 6f6e 656e 7420   each component 
+000054a0: 6e61 6d65 2e0a 2020 2020 2020 2020 2020  name..          
+000054b0: 2020 2020 2020 7573 6566 756c 2069 6620        useful if 
+000054c0: 746f 2073 6176 6520 616e 6420 7265 6c6f  to save and relo
+000054d0: 6164 2061 2062 6163 6b2d 616e 6e6f 7461  ad a back-annota
+000054e0: 7465 6420 6e65 746c 6973 742e 0a20 2020  ted netlist..   
+000054f0: 2020 2020 2020 2020 2067 6574 5f6e 6574           get_net
+00005500: 6c69 7374 5f66 756e 633a 2066 756e 6374  list_func: funct
+00005510: 696f 6e20 746f 2065 7874 7261 6374 2069  ion to extract i
+00005520: 6e64 6976 6964 7561 6c20 6e65 746c 6973  ndividual netlis
+00005530: 7473 2e0a 2020 2020 2020 2020 2020 2020  ts..            
+00005540: 6675 6c6c 5f73 6574 7469 6e67 733a 2054  full_settings: T
+00005550: 7275 6520 7265 7475 726e 7320 616c 6c2c  rue returns all,
+00005560: 2066 616c 7365 2063 6861 6e67 6564 2073   false changed s
+00005570: 6574 7469 6e67 732e 0a20 2020 2020 2020  ettings..       
+00005580: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
+00005590: 746f 6c65 7261 6e63 6520 696e 206e 6d20  tolerance in nm 
+000055a0: 746f 2063 6f6e 7369 6465 7220 7477 6f20  to consider two 
+000055b0: 706f 7274 7320 636f 6e6e 6563 7465 642e  ports connected.
+000055c0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+000055d0: 6c75 6465 5f70 6f72 745f 7479 7065 733a  lude_port_types:
+000055e0: 206f 7074 696f 6e61 6c20 6c69 7374 206f   optional list o
+000055f0: 6620 706f 7274 2074 7970 6573 2074 6f20  f port types to 
+00005600: 6578 636c 7564 6520 6672 6f6d 206e 6574  exclude from net
+00005610: 6c69 7374 696e 672e 0a20 2020 2020 2020  listing..       
+00005620: 2020 2020 2067 6574 5f69 6e73 7461 6e63       get_instanc
+00005630: 655f 6e61 6d65 3a20 6675 6e63 7469 6f6e  e_name: function
+00005640: 2074 6f20 6765 7420 696e 7374 616e 6365   to get instance
+00005650: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
+00005660: 2020 2061 6c6c 6f77 5f6d 756c 7469 706c     allow_multipl
+00005670: 653a 2046 616c 7365 2074 6f20 7261 6973  e: False to rais
+00005680: 6520 616e 2065 7272 6f72 2069 6620 6d6f  e an error if mo
+00005690: 7265 2074 6861 6e20 7477 6f20 706f 7274  re than two port
+000056a0: 7320 7368 6172 6520 7468 6520 7361 6d65  s share the same
+000056b0: 2063 6f6e 6e65 6374 696f 6e2e 0a20 2020   connection..   
+000056c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000056d0: 5472 7565 2c20 7769 6c6c 2072 6574 7572  True, will retur
+000056e0: 6e20 6b65 793a 205b 7661 6c75 655d 2070  n key: [value] p
+000056f0: 6169 7273 2077 6974 6820 5b76 616c 7565  airs with [value
+00005700: 5d20 6120 6c69 7374 206f 6620 616c 6c20  ] a list of all 
+00005710: 636f 6e6e 6563 7465 6420 696e 7374 616e  connected instan
+00005720: 6365 732e 0a0a 2020 2020 2020 2020 5265  ces...        Re
+00005730: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
+00005740: 2020 2044 6963 7469 6f6e 6172 7920 6f66     Dictionary of
+00005750: 206e 6574 6c69 7374 732c 206b 6579 6564   netlists, keyed
+00005760: 2062 7920 7468 6520 6e61 6d65 206f 6620   by the name of 
+00005770: 6561 6368 2063 6f6d 706f 6e65 6e74 2e0a  each component..
+00005780: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00005790: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+000057a0: 6f72 792e 6765 745f 6e65 746c 6973 7420  ory.get_netlist 
+000057b0: 696d 706f 7274 2067 6574 5f6e 6574 6c69  import get_netli
+000057c0: 7374 5f72 6563 7572 7369 7665 0a0a 2020  st_recursive..  
+000057d0: 2020 2020 2020 7265 7475 726e 2067 6574        return get
+000057e0: 5f6e 6574 6c69 7374 5f72 6563 7572 7369  _netlist_recursi
+000057f0: 7665 2863 6f6d 706f 6e65 6e74 3d73 656c  ve(component=sel
+00005800: 662c 202a 2a6b 7761 7267 7329 0a0a 2020  f, **kwargs)..  
+00005810: 2020 6465 6620 6765 745f 6e65 746c 6973    def get_netlis
+00005820: 745f 666c 6174 2873 656c 662c 202a 2a6b  t_flat(self, **k
+00005830: 7761 7267 7329 202d 3e20 6469 6374 5b73  wargs) -> dict[s
+00005840: 7472 2c20 4469 6374 436f 6e66 6967 5d3a  tr, DictConfig]:
+00005850: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00005860: 726e 7320 6120 6e65 746c 6973 7420 7768  rns a netlist wh
+00005870: 6572 6520 616c 6c20 7375 6269 6e73 7461  ere all subinsta
+00005880: 6e63 6573 2061 7265 2065 7870 6f73 6564  nces are exposed
+00005890: 2061 6e64 2069 6e64 6570 656e 6465 6e74   and independent
+000058a0: 6c79 206e 616d 6564 2e0a 0a20 2020 2020  ly named...     
+000058b0: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
+000058c0: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
+000058d0: 706f 6e65 6e74 3a20 746f 2065 7874 7261  ponent: to extra
+000058e0: 6374 206e 6574 6c69 7374 2e0a 2020 2020  ct netlist..    
+000058f0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+00005900: 745f 7375 6666 6978 3a20 7375 6666 6978  t_suffix: suffix
+00005910: 2074 6f20 6170 7065 6e64 2074 6f20 6561   to append to ea
+00005920: 6368 2063 6f6d 706f 6e65 6e74 206e 616d  ch component nam
+00005930: 652e 0a20 2020 2020 2020 2020 2020 2020  e..             
+00005940: 2020 2075 7365 6675 6c20 6966 2074 6f20     useful if to 
+00005950: 7361 7665 2061 6e64 2072 656c 6f61 6420  save and reload 
+00005960: 6120 6261 636b 2d61 6e6e 6f74 6174 6564  a back-annotated
+00005970: 206e 6574 6c69 7374 2e0a 2020 2020 2020   netlist..      
+00005980: 2020 2020 2020 6765 745f 6e65 746c 6973        get_netlis
+00005990: 745f 6675 6e63 3a20 6675 6e63 7469 6f6e  t_func: function
+000059a0: 2074 6f20 6578 7472 6163 7420 696e 6469   to extract indi
+000059b0: 7669 6475 616c 206e 6574 6c69 7374 732e  vidual netlists.
+000059c0: 0a20 2020 2020 2020 2020 2020 2066 756c  .            ful
+000059d0: 6c5f 7365 7474 696e 6773 3a20 5472 7565  l_settings: True
+000059e0: 2072 6574 7572 6e73 2061 6c6c 2c20 6661   returns all, fa
+000059f0: 6c73 6520 6368 616e 6765 6420 7365 7474  lse changed sett
+00005a00: 696e 6773 2e0a 2020 2020 2020 2020 2020  ings..          
+00005a10: 2020 746f 6c65 7261 6e63 653a 2074 6f6c    tolerance: tol
+00005a20: 6572 616e 6365 2069 6e20 6e6d 2074 6f20  erance in nm to 
+00005a30: 636f 6e73 6964 6572 2074 776f 2070 6f72  consider two por
+00005a40: 7473 2063 6f6e 6e65 6374 6564 2e0a 2020  ts connected..  
+00005a50: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00005a60: 655f 706f 7274 5f74 7970 6573 3a20 6f70  e_port_types: op
+00005a70: 7469 6f6e 616c 206c 6973 7420 6f66 2070  tional list of p
+00005a80: 6f72 7420 7479 7065 7320 746f 2065 7863  ort types to exc
+00005a90: 6c75 6465 2066 726f 6d20 6e65 746c 6973  lude from netlis
+00005aa0: 7469 6e67 2e0a 2020 2020 2020 2020 2020  ting..          
+00005ab0: 2020 6765 745f 696e 7374 616e 6365 5f6e    get_instance_n
+00005ac0: 616d 653a 2066 756e 6374 696f 6e20 746f  ame: function to
+00005ad0: 2067 6574 2069 6e73 7461 6e63 6520 6e61   get instance na
+00005ae0: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
+00005af0: 616c 6c6f 775f 6d75 6c74 6970 6c65 3a20  allow_multiple: 
+00005b00: 4661 6c73 6520 746f 2072 6169 7365 2061  False to raise a
+00005b10: 6e20 6572 726f 7220 6966 206d 6f72 6520  n error if more 
+00005b20: 7468 616e 2074 776f 2070 6f72 7473 2073  than two ports s
+00005b30: 6861 7265 2074 6865 2073 616d 6520 636f  hare the same co
+00005b40: 6e6e 6563 7469 6f6e 2e0a 2020 2020 2020  nnection..      
+00005b50: 2020 2020 2020 2020 2020 6966 2054 7275            if Tru
+00005b60: 652c 2077 696c 6c20 7265 7475 726e 206b  e, will return k
+00005b70: 6579 3a20 5b76 616c 7565 5d20 7061 6972  ey: [value] pair
+00005b80: 7320 7769 7468 205b 7661 6c75 655d 2061  s with [value] a
+00005b90: 206c 6973 7420 6f66 2061 6c6c 2063 6f6e   list of all con
+00005ba0: 6e65 6374 6564 2069 6e73 7461 6e63 6573  nected instances
+00005bb0: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00005bc0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00005bd0: 4469 6374 696f 6e61 7279 206f 6620 6e65  Dictionary of ne
+00005be0: 746c 6973 7473 2c20 6b65 7965 6420 6279  tlists, keyed by
+00005bf0: 2074 6865 206e 616d 6520 6f66 2065 6163   the name of eac
+00005c00: 6820 636f 6d70 6f6e 656e 742e 0a20 2020  h component..   
+00005c10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00005c20: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
+00005c30: 2e67 6574 5f6e 6574 6c69 7374 5f66 6c61  .get_netlist_fla
+00005c40: 7420 696d 706f 7274 2067 6574 5f6e 6574  t import get_net
+00005c50: 6c69 7374 5f66 6c61 740a 0a20 2020 2020  list_flat..     
+00005c60: 2020 2072 6574 7572 6e20 6765 745f 6e65     return get_ne
+00005c70: 746c 6973 745f 666c 6174 2863 6f6d 706f  tlist_flat(compo
+00005c80: 6e65 6e74 3d73 656c 662c 202a 2a6b 7761  nent=self, **kwa
+00005c90: 7267 7329 0a0a 2020 2020 6465 6620 6173  rgs)..    def as
+00005ca0: 7365 7274 5f70 6f72 7473 5f6f 6e5f 6772  sert_ports_on_gr
+00005cb0: 6964 280a 2020 2020 2020 2020 7365 6c66  id(.        self
+00005cc0: 2c20 6772 6964 5f66 6163 746f 723a 2069  , grid_factor: i
+00005cd0: 6e74 203d 2031 2c20 6572 726f 725f 7479  nt = 1, error_ty
+00005ce0: 7065 3a20 7374 7220 3d20 2265 7272 6f72  pe: str = "error
+00005cf0: 220a 2020 2020 2920 2d3e 204e 6f6e 653a  ".    ) -> None:
+00005d00: 0a20 2020 2020 2020 2022 2222 4173 7365  .        """Asse
+00005d10: 7274 7320 7468 6174 2061 6c6c 2070 6f72  rts that all por
+00005d20: 7473 2061 7265 206f 6e20 6772 6964 2e22  ts are on grid."
+00005d30: 2222 0a20 2020 2020 2020 2066 6f72 2070  "".        for p
+00005d40: 6f72 7420 696e 2073 656c 662e 706f 7274  ort in self.port
+00005d50: 732e 7661 6c75 6573 2829 3a0a 2020 2020  s.values():.    
+00005d60: 2020 2020 2020 2020 706f 7274 2e61 7373          port.ass
+00005d70: 6572 745f 6f6e 5f67 7269 6428 6772 6964  ert_on_grid(grid
+00005d80: 5f66 6163 746f 723d 6772 6964 5f66 6163  _factor=grid_fac
+00005d90: 746f 722c 2065 7272 6f72 5f74 7970 653d  tor, error_type=
+00005da0: 6572 726f 725f 7479 7065 290a 0a20 2020  error_type)..   
+00005db0: 2064 6566 2061 7373 6572 745f 706f 7274   def assert_port
+00005dc0: 735f 6d61 6e68 6174 7461 6e28 7365 6c66  s_manhattan(self
+00005dd0: 2c20 6572 726f 725f 7479 7065 3a20 7374  , error_type: st
+00005de0: 7220 3d20 2265 7272 6f72 2229 202d 3e20  r = "error") -> 
+00005df0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00005e00: 2241 7373 6572 7473 2074 6861 7420 616c  "Asserts that al
+00005e10: 6c20 706f 7274 7320 6172 6520 6f6e 206d  l ports are on m
+00005e20: 616e 6861 7474 616e 2061 6e67 6c65 7320  anhattan angles 
+00005e30: 2830 2c20 3930 2c20 3138 302c 2032 3730  (0, 90, 180, 270
+00005e40: 292e 2222 220a 2020 2020 2020 2020 666f  ).""".        fo
+00005e50: 7220 706f 7274 2069 6e20 7365 6c66 2e70  r port in self.p
+00005e60: 6f72 7473 2e76 616c 7565 7328 293a 0a20  orts.values():. 
+00005e70: 2020 2020 2020 2020 2020 2070 6f72 742e             port.
+00005e80: 6173 7365 7274 5f6d 616e 6861 7474 616e  assert_manhattan
+00005e90: 2865 7272 6f72 5f74 7970 653d 6572 726f  (error_type=erro
+00005ea0: 725f 7479 7065 290a 0a20 2020 2064 6566  r_type)..    def
+00005eb0: 2067 6574 5f70 6f72 7473 2873 656c 662c   get_ports(self,
+00005ec0: 2064 6570 7468 3a20 696e 7420 7c20 4e6f   depth: int | No
+00005ed0: 6e65 203d 2030 293a 0a20 2020 2020 2020  ne = 0):.       
+00005ee0: 2022 2222 5265 7475 726e 7320 636f 7069   """Returns copi
+00005ef0: 6573 206f 6620 616c 6c20 7468 6520 706f  es of all the po
+00005f00: 7274 7320 6f66 2074 6865 2043 6f6d 706f  rts of the Compo
+00005f10: 6e65 6e74 2c20 726f 7461 7465 6420 616e  nent, rotated an
+00005f20: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
+00005f30: 2020 2020 7472 616e 736c 6174 6564 2073      translated s
+00005f40: 6f20 7468 6174 2074 6865 7927 7265 2069  o that they're i
+00005f50: 6e20 7468 6569 7220 746f 702d 6c65 7665  n their top-leve
+00005f60: 6c20 706f 7369 7469 6f6e 2e0a 0a20 2020  l position...   
+00005f70: 2020 2020 2054 6865 2050 6f72 7473 2072       The Ports r
+00005f80: 6574 7572 6e65 6420 6172 6520 636f 7069  eturned are copi
+00005f90: 6573 206f 6620 7468 6520 6f72 6967 696e  es of the origin
+00005fa0: 616c 732c 2062 7574 2065 6163 6820 636f  als, but each co
+00005fb0: 7079 2068 6173 2074 6865 2073 616d 650a  py has the same.
+00005fc0: 2020 2020 2020 2020 6060 7569 6460 6020          ``uid`` 
+00005fd0: 6173 2074 6865 206f 7269 6769 6e61 6c20  as the original 
+00005fe0: 736f 2074 6861 7420 7468 6579 2063 616e  so that they can
+00005ff0: 2062 6520 7472 6163 6564 2062 6163 6b20   be traced back 
+00006000: 746f 2074 6865 206f 7269 6769 6e61 6c20  to the original 
+00006010: 6966 206e 6565 6465 642e 0a0a 2020 2020  if needed...    
+00006020: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00006030: 2020 2020 2020 6465 7074 683a 2049 6620        depth: If 
+00006040: 6e6f 7420 4e6f 6e65 2c20 6465 6669 6e65  not None, define
+00006050: 7320 6672 6f6d 2068 6f77 206d 616e 7920  s from how many 
+00006060: 7265 6665 7265 6e63 6520 6c65 7665 6c73  reference levels
+00006070: 2074 6f20 7265 7472 6965 7665 2050 6f72   to retrieve Por
+00006080: 7473 2066 726f 6d2e 0a0a 2020 2020 2020  ts from...      
+00006090: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+000060a0: 2020 2020 2020 2070 6f72 745f 6c69 7374         port_list
+000060b0: 203a 206c 6973 7420 6f66 2050 6f72 7420   : list of Port 
+000060c0: 4c69 7374 206f 6620 616c 6c20 506f 7274  List of all Port
+000060d0: 7320 696e 2074 6865 2043 6f6d 706f 6e65  s in the Compone
+000060e0: 6e74 2e0a 2020 2020 2020 2020 2222 220a  nt..        """.
+000060f0: 2020 2020 2020 2020 706f 7274 5f6c 6973          port_lis
+00006100: 7420 3d20 5b70 2e5f 636f 7079 2829 2066  t = [p._copy() f
+00006110: 6f72 2070 2069 6e20 7365 6c66 2e70 6f72  or p in self.por
+00006120: 7473 2e76 616c 7565 7328 295d 0a0a 2020  ts.values()]..  
+00006130: 2020 2020 2020 6966 2064 6570 7468 2069        if depth i
+00006140: 7320 4e6f 6e65 206f 7220 6465 7074 6820  s None or depth 
+00006150: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+00006160: 2066 6f72 2072 2069 6e20 7365 6c66 2e72   for r in self.r
+00006170: 6566 6572 656e 6365 733a 0a20 2020 2020  eferences:.     
+00006180: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+00006190: 6570 7468 203d 204e 6f6e 6520 6966 2064  epth = None if d
+000061a0: 6570 7468 2069 7320 4e6f 6e65 2065 6c73  epth is None els
+000061b0: 6520 6465 7074 6820 2d20 310a 2020 2020  e depth - 1.    
+000061c0: 2020 2020 2020 2020 2020 2020 7265 665f              ref_
+000061d0: 706f 7274 7320 3d20 722e 7061 7265 6e74  ports = r.parent
+000061e0: 2e67 6574 5f70 6f72 7473 2864 6570 7468  .get_ports(depth
+000061f0: 3d6e 6577 5f64 6570 7468 290a 0a20 2020  =new_depth)..   
+00006200: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+00006210: 7261 6e73 666f 726d 2070 6f72 7473 2074  ransform ports t
+00006220: 6861 7420 6361 6d65 2066 726f 6d20 6120  hat came from a 
+00006230: 7265 6665 7265 6e63 650a 2020 2020 2020  reference.      
+00006240: 2020 2020 2020 2020 2020 7265 665f 706f            ref_po
+00006250: 7274 735f 7472 616e 7366 6f72 6d65 6420  rts_transformed 
+00006260: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+00006270: 2020 2020 2066 6f72 2072 7020 696e 2072       for rp in r
+00006280: 6566 5f70 6f72 7473 3a0a 2020 2020 2020  ef_ports:.      
+00006290: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000062a0: 775f 706f 7274 203d 2072 702e 5f63 6f70  w_port = rp._cop
+000062b0: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+000062c0: 2020 2020 2020 2020 6e65 775f 6365 6e74          new_cent
+000062d0: 6572 2c20 6e65 775f 6f72 6965 6e74 6174  er, new_orientat
+000062e0: 696f 6e20 3d20 722e 5f74 7261 6e73 666f  ion = r._transfo
+000062f0: 726d 5f70 6f72 7428 0a20 2020 2020 2020  rm_port(.       
+00006300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006310: 2072 702e 6365 6e74 6572 2c0a 2020 2020   rp.center,.    
+00006320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006330: 2020 2020 7270 2e6f 7269 656e 7461 7469      rp.orientati
+00006340: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+00006350: 2020 2020 2020 2020 2020 2020 722e 6f72              r.or
+00006360: 6967 696e 2c0a 2020 2020 2020 2020 2020  igin,.          
+00006370: 2020 2020 2020 2020 2020 2020 2020 722e                r.
+00006380: 726f 7461 7469 6f6e 2c0a 2020 2020 2020  rotation,.      
+00006390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063a0: 2020 722e 785f 7265 666c 6563 7469 6f6e    r.x_reflection
+000063b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000063c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000063d0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+000063e0: 706f 7274 2e63 656e 7465 7220 3d20 6e65  port.center = ne
+000063f0: 775f 6365 6e74 6572 0a20 2020 2020 2020  w_center.       
+00006400: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00006410: 5f70 6f72 742e 6e65 775f 6f72 6965 6e74  _port.new_orient
+00006420: 6174 696f 6e20 3d20 6e65 775f 6f72 6965  ation = new_orie
+00006430: 6e74 6174 696f 6e0a 2020 2020 2020 2020  ntation.        
+00006440: 2020 2020 2020 2020 2020 2020 7265 665f              ref_
+00006450: 706f 7274 735f 7472 616e 7366 6f72 6d65  ports_transforme
+00006460: 642e 6170 7065 6e64 286e 6577 5f70 6f72  d.append(new_por
+00006470: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00006480: 2020 2070 6f72 745f 6c69 7374 202b 3d20     port_list += 
+00006490: 7265 665f 706f 7274 735f 7472 616e 7366  ref_ports_transf
+000064a0: 6f72 6d65 640a 0a20 2020 2020 2020 2072  ormed..        r
+000064b0: 6574 7572 6e20 706f 7274 5f6c 6973 740a  eturn port_list.
+000064c0: 0a20 2020 2064 6566 2067 6574 5f70 6f72  .    def get_por
+000064d0: 7473 5f64 6963 7428 7365 6c66 2c20 2a2a  ts_dict(self, **
+000064e0: 6b77 6172 6773 2920 2d3e 2064 6963 745b  kwargs) -> dict[
+000064f0: 7374 722c 2050 6f72 745d 3a0a 2020 2020  str, Port]:.    
+00006500: 2020 2020 2222 2252 6574 7572 6e73 2061      """Returns a
+00006510: 2064 6963 7420 6f66 2070 6f72 7473 2e0a   dict of ports..
+00006520: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
+00006530: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00006540: 2020 206c 6179 6572 3a20 706f 7274 2047     layer: port G
+00006550: 4453 206c 6179 6572 2e0a 2020 2020 2020  DS layer..      
+00006560: 2020 2020 2020 7072 6566 6978 3a20 7365        prefix: se
+00006570: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
+00006580: 7072 6566 6978 2069 6e20 706f 7274 206e  prefix in port n
+00006590: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
+000065a0: 2073 7566 6669 783a 2073 656c 6563 7420   suffix: select 
+000065b0: 706f 7274 7320 7769 7468 2070 6f72 7420  ports with port 
+000065c0: 6e61 6d65 2073 7566 6669 782e 0a20 2020  name suffix..   
+000065d0: 2020 2020 2020 2020 206f 7269 656e 7461           orienta
+000065e0: 7469 6f6e 3a20 7365 6c65 6374 2070 6f72  tion: select por
+000065f0: 7473 2077 6974 6820 6f72 6965 6e74 6174  ts with orientat
+00006600: 696f 6e20 696e 2064 6567 7265 6573 2e0a  ion in degrees..
+00006610: 2020 2020 2020 2020 2020 2020 7769 6474              widt
+00006620: 683a 2073 656c 6563 7420 706f 7274 7320  h: select ports 
+00006630: 7769 7468 2070 6f72 7420 7769 6474 682e  with port width.
+00006640: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+00006650: 6572 735f 6578 636c 7564 6564 3a20 4c69  ers_excluded: Li
+00006660: 7374 206f 6620 6c61 7965 7273 2074 6f20  st of layers to 
+00006670: 6578 636c 7564 652e 0a20 2020 2020 2020  exclude..       
+00006680: 2020 2020 2070 6f72 745f 7479 7065 3a20       port_type: 
+00006690: 7365 6c65 6374 2070 6f72 7473 2077 6974  select ports wit
+000066a0: 6820 706f 7274 5f74 7970 6520 286f 7074  h port_type (opt
+000066b0: 6963 616c 2c20 656c 6563 7472 6963 616c  ical, electrical
+000066c0: 2c20 7665 7274 6963 616c 5f74 6529 2e0a  , vertical_te)..
+000066d0: 2020 2020 2020 2020 2020 2020 636c 6f63              cloc
+000066e0: 6b77 6973 653a 2069 6620 5472 7565 2c20  kwise: if True, 
+000066f0: 736f 7274 2070 6f72 7473 2063 6c6f 636b  sort ports clock
+00006700: 7769 7365 2c20 4661 6c73 653a 2063 6f75  wise, False: cou
+00006710: 6e74 6572 2d63 6c6f 636b 7769 7365 2e0a  nter-clockwise..
+00006720: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00006730: 2020 2020 7265 7475 726e 2073 656c 6563      return selec
+00006740: 745f 706f 7274 7328 7365 6c66 2e70 6f72  t_ports(self.por
+00006750: 7473 2c20 2a2a 6b77 6172 6773 290a 0a20  ts, **kwargs).. 
+00006760: 2020 2064 6566 2067 6574 5f70 6f72 7473     def get_ports
+00006770: 5f6c 6973 7428 7365 6c66 2c20 2a2a 6b77  _list(self, **kw
+00006780: 6172 6773 2920 2d3e 206c 6973 745b 506f  args) -> list[Po
+00006790: 7274 5d3a 0a20 2020 2020 2020 2022 2222  rt]:.        """
+000067a0: 5265 7475 726e 7320 6c69 7374 206f 6620  Returns list of 
+000067b0: 706f 7274 732e 0a0a 2020 2020 2020 2020  ports...        
+000067c0: 4b65 7977 6f72 6420 4172 6773 3a0a 2020  Keyword Args:.  
+000067d0: 2020 2020 2020 2020 2020 6c61 7965 723a            layer:
+000067e0: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
+000067f0: 7468 2047 4453 206c 6179 6572 2e0a 2020  th GDS layer..  
+00006800: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00006810: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
+00006820: 6974 6820 7072 6566 6978 2069 6e20 706f  ith prefix in po
+00006830: 7274 206e 616d 652e 0a20 2020 2020 2020  rt name..       
+00006840: 2020 2020 2073 7566 6669 783a 2073 656c       suffix: sel
+00006850: 6563 7420 706f 7274 7320 7769 7468 2070  ect ports with p
+00006860: 6f72 7420 6e61 6d65 2073 7566 6669 782e  ort name suffix.
+00006870: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
+00006880: 656e 7461 7469 6f6e 3a20 7365 6c65 6374  entation: select
+00006890: 2070 6f72 7473 2077 6974 6820 6f72 6965   ports with orie
+000068a0: 6e74 6174 696f 6e20 696e 2064 6567 7265  ntation in degre
+000068b0: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
+000068c0: 6f72 6965 6e74 6174 696f 6e3a 2073 656c  orientation: sel
+000068d0: 6563 7420 706f 7274 7320 7769 7468 206f  ect ports with o
+000068e0: 7269 656e 7461 7469 6f6e 2069 6e20 6465  rientation in de
+000068f0: 6772 6565 732e 0a20 2020 2020 2020 2020  grees..         
+00006900: 2020 2077 6964 7468 3a20 7365 6c65 6374     width: select
+00006910: 2070 6f72 7473 2077 6974 6820 706f 7274   ports with port
+00006920: 2077 6964 7468 2e0a 2020 2020 2020 2020   width..        
+00006930: 2020 2020 6c61 7965 7273 5f65 7863 6c75      layers_exclu
+00006940: 6465 643a 204c 6973 7420 6f66 206c 6179  ded: List of lay
+00006950: 6572 7320 746f 2065 7863 6c75 6465 2e0a  ers to exclude..
+00006960: 2020 2020 2020 2020 2020 2020 706f 7274              port
+00006970: 5f74 7970 653a 2073 656c 6563 7420 706f  _type: select po
+00006980: 7274 7320 7769 7468 2070 6f72 745f 7479  rts with port_ty
+00006990: 7065 2028 6f70 7469 6361 6c2c 2065 6c65  pe (optical, ele
+000069a0: 6374 7269 6361 6c2c 2076 6572 7469 6361  ctrical, vertica
+000069b0: 6c5f 7465 292e 0a20 2020 2020 2020 2020  l_te)..         
+000069c0: 2020 2063 6c6f 636b 7769 7365 3a20 6966     clockwise: if
+000069d0: 2054 7275 652c 2073 6f72 7420 706f 7274   True, sort port
+000069e0: 7320 636c 6f63 6b77 6973 652c 2046 616c  s clockwise, Fal
+000069f0: 7365 3a20 636f 756e 7465 722d 636c 6f63  se: counter-cloc
+00006a00: 6b77 6973 652e 0a20 2020 2020 2020 2022  kwise..        "
+00006a10: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00006a20: 6e20 6c69 7374 2873 656c 6563 745f 706f  n list(select_po
+00006a30: 7274 7328 7365 6c66 2e70 6f72 7473 2c20  rts(self.ports, 
+00006a40: 2a2a 6b77 6172 6773 292e 7661 6c75 6573  **kwargs).values
+00006a50: 2829 290a 0a20 2020 2064 6566 2067 6574  ())..    def get
+00006a60: 5f70 6f72 7473 5f70 616e 6461 7328 7365  _ports_pandas(se
+00006a70: 6c66 293a 0a20 2020 2020 2020 2069 6d70  lf):.        imp
+00006a80: 6f72 7420 7061 6e64 6173 2061 7320 7064  ort pandas as pd
+00006a90: 0a0a 2020 2020 2020 2020 636f 6c5f 7370  ..        col_sp
+00006aa0: 6563 203d 205b 0a20 2020 2020 2020 2020  ec = [.         
+00006ab0: 2020 2022 6e61 6d65 222c 0a20 2020 2020     "name",.     
+00006ac0: 2020 2020 2020 2022 7769 6474 6822 2c0a         "width",.
+00006ad0: 2020 2020 2020 2020 2020 2020 2263 656e              "cen
+00006ae0: 7465 7222 2c0a 2020 2020 2020 2020 2020  ter",.          
+00006af0: 2020 226f 7269 656e 7461 7469 6f6e 222c    "orientation",
+00006b00: 0a20 2020 2020 2020 2020 2020 2022 6c61  .            "la
+00006b10: 7965 7222 2c0a 2020 2020 2020 2020 2020  yer",.          
+00006b20: 2020 2270 6f72 745f 7479 7065 222c 0a20    "port_type",. 
+00006b30: 2020 2020 2020 2020 2020 2022 7368 6561             "shea
+00006b40: 725f 616e 676c 6522 2c0a 2020 2020 2020  r_angle",.      
+00006b50: 2020 5d0a 0a20 2020 2020 2020 2072 6574    ]..        ret
+00006b60: 7572 6e20 7064 2e44 6174 6146 7261 6d65  urn pd.DataFrame
+00006b70: 280a 2020 2020 2020 2020 2020 2020 5b70  (.            [p
+00006b80: 6f72 742e 746f 5f64 6963 7428 2920 666f  ort.to_dict() fo
+00006b90: 7220 706f 7274 2069 6e20 7365 6c66 2e67  r port in self.g
+00006ba0: 6574 5f70 6f72 7473 5f6c 6973 7428 295d  et_ports_list()]
+00006bb0: 2c20 636f 6c75 6d6e 733d 636f 6c5f 7370  , columns=col_sp
+00006bc0: 6563 0a20 2020 2020 2020 2029 0a0a 2020  ec.        )..  
+00006bd0: 2020 6465 6620 6765 745f 706f 7274 735f    def get_ports_
+00006be0: 706f 6c61 7273 2873 656c 6629 3a0a 2020  polars(self):.  
+00006bf0: 2020 2020 2020 696d 706f 7274 2070 6f6c        import pol
+00006c00: 6172 7320 6173 2070 6c0a 0a20 2020 2020  ars as pl..     
+00006c10: 2020 2063 6f6c 5f73 7065 6320 3d20 7b0a     col_spec = {.
+00006c20: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
+00006c30: 6522 3a20 706c 2e55 7466 382c 0a20 2020  e": pl.Utf8,.   
+00006c40: 2020 2020 2020 2020 2022 7769 6474 6822           "width"
+00006c50: 3a20 706c 2e46 6c6f 6174 3634 2c0a 2020  : pl.Float64,.  
+00006c60: 2020 2020 2020 2020 2020 2263 656e 7465            "cente
+00006c70: 7222 3a20 706c 2e4c 6973 7428 706c 2e46  r": pl.List(pl.F
+00006c80: 6c6f 6174 3634 292c 0a20 2020 2020 2020  loat64),.       
+00006c90: 2020 2020 2022 6f72 6965 6e74 6174 696f       "orientatio
+00006ca0: 6e22 3a20 706c 2e46 6c6f 6174 3634 2c0a  n": pl.Float64,.
+00006cb0: 2020 2020 2020 2020 2020 2020 226c 6179              "lay
+00006cc0: 6572 223a 2070 6c2e 4c69 7374 2870 6c2e  er": pl.List(pl.
+00006cd0: 5549 6e74 3136 292c 0a20 2020 2020 2020  UInt16),.       
+00006ce0: 2020 2020 2022 706f 7274 5f74 7970 6522       "port_type"
+00006cf0: 3a20 706c 2e55 7466 382c 0a20 2020 2020  : pl.Utf8,.     
+00006d00: 2020 2020 2020 2022 7368 6561 725f 616e         "shear_an
+00006d10: 676c 6522 3a20 706c 2e46 6c6f 6174 3634  gle": pl.Float64
+00006d20: 2c0a 2020 2020 2020 2020 7d0a 0a20 2020  ,.        }..   
+00006d30: 2020 2020 2072 6574 7572 6e20 706c 2e44       return pl.D
+00006d40: 6174 6146 7261 6d65 280a 2020 2020 2020  ataFrame(.      
+00006d50: 2020 2020 2020 5b70 6f72 742e 746f 5f64        [port.to_d
+00006d60: 6963 7428 2920 666f 7220 706f 7274 2069  ict() for port i
+00006d70: 6e20 7365 6c66 2e67 6574 5f70 6f72 7473  n self.get_ports
+00006d80: 5f6c 6973 7428 295d 2c20 7363 6865 6d61  _list()], schema
+00006d90: 3d63 6f6c 5f73 7065 630a 2020 2020 2020  =col_spec.      
+00006da0: 2020 290a 0a20 2020 2064 6566 2072 6566    )..    def ref
+00006db0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00006dc0: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
+00006dd0: 3a20 436f 6f72 6469 6e61 7465 203d 2028  : Coordinate = (
+00006de0: 302c 2030 292c 0a20 2020 2020 2020 2070  0, 0),.        p
+00006df0: 6f72 745f 6964 3a20 7374 7220 7c20 4e6f  ort_id: str | No
+00006e00: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+00006e10: 2020 2072 6f74 6174 696f 6e3a 2066 6c6f     rotation: flo
+00006e20: 6174 203d 2030 2c0a 2020 2020 2020 2020  at = 0,.        
+00006e30: 685f 6d69 7272 6f72 3a20 626f 6f6c 203d  h_mirror: bool =
+00006e40: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+00006e50: 765f 6d69 7272 6f72 3a20 626f 6f6c 203d  v_mirror: bool =
+00006e60: 2046 616c 7365 2c0a 2020 2020 2920 2d3e   False,.    ) ->
+00006e70: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
+00006e80: 6e63 653a 0a20 2020 2020 2020 2022 2222  nce:.        """
+00006e90: 5265 7475 726e 7320 436f 6d70 6f6e 656e  Returns Componen
+00006ea0: 7420 7265 6665 7265 6e63 652e 0a0a 2020  t reference...  
+00006eb0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+00006ec0: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
+00006ed0: 3a20 782c 2079 2070 6f73 6974 696f 6e2e  : x, y position.
+00006ee0: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
+00006ef0: 745f 6964 3a20 6e61 6d65 206f 6620 7468  t_id: name of th
+00006f00: 6520 706f 7274 2e0a 2020 2020 2020 2020  e port..        
+00006f10: 2020 2020 726f 7461 7469 6f6e 3a20 696e      rotation: in
+00006f20: 2064 6567 7265 6573 2e0a 2020 2020 2020   degrees..      
+00006f30: 2020 2020 2020 685f 6d69 7272 6f72 3a20        h_mirror: 
+00006f40: 686f 7269 7a6f 6e74 616c 206d 6972 726f  horizontal mirro
+00006f50: 7220 7573 696e 6720 7920 6178 6973 2028  r using y axis (
+00006f60: 782c 2031 2920 2831 2c20 3029 2e0a 2020  x, 1) (1, 0)..  
+00006f70: 2020 2020 2020 2020 2020 2020 2020 5468                Th
+00006f80: 6973 2069 7320 7468 6520 6d6f 7374 2063  is is the most c
+00006f90: 6f6d 6d6f 6e20 6d69 7272 6f72 2e0a 2020  ommon mirror..  
+00006fa0: 2020 2020 2020 2020 2020 765f 6d69 7272            v_mirr
+00006fb0: 6f72 3a20 7665 7274 6963 616c 206d 6972  or: vertical mir
+00006fc0: 726f 7220 7573 696e 6720 7820 6178 6973  ror using x axis
+00006fd0: 2028 312c 2079 2920 2830 2c20 7929 2e0a   (1, y) (0, y)..
+00006fe0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00006ff0: 2020 2020 5f72 6566 203d 2043 6f6d 706f      _ref = Compo
+00007000: 6e65 6e74 5265 6665 7265 6e63 6528 7365  nentReference(se
+00007010: 6c66 290a 0a20 2020 2020 2020 2069 6620  lf)..        if 
+00007020: 706f 7274 5f69 6420 616e 6420 706f 7274  port_id and port
+00007030: 5f69 6420 6e6f 7420 696e 2073 656c 662e  _id not in self.
+00007040: 706f 7274 733a 0a20 2020 2020 2020 2020  ports:.         
+00007050: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00007060: 726f 7228 6622 706f 7274 207b 706f 7274  ror(f"port {port
+00007070: 5f69 647d 206e 6f74 2069 6e20 7b73 656c  _id} not in {sel
+00007080: 662e 706f 7274 732e 6b65 7973 2829 7d22  f.ports.keys()}"
+00007090: 290a 0a20 2020 2020 2020 206f 7269 6769  )..        origi
+000070a0: 6e20 3d20 7365 6c66 2e70 6f72 7473 5b70  n = self.ports[p
+000070b0: 6f72 745f 6964 5d2e 6365 6e74 6572 2069  ort_id].center i
+000070c0: 6620 706f 7274 5f69 6420 656c 7365 2028  f port_id else (
+000070d0: 302c 2030 290a 2020 2020 2020 2020 6966  0, 0).        if
+000070e0: 2068 5f6d 6972 726f 723a 0a20 2020 2020   h_mirror:.     
+000070f0: 2020 2020 2020 205f 7265 662e 6d69 7272         _ref.mirr
+00007100: 6f72 5f78 2870 6f72 745f 6964 290a 0a20  or_x(port_id).. 
+00007110: 2020 2020 2020 2069 6620 765f 6d69 7272         if v_mirr
+00007120: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+00007130: 5f72 6566 2e6d 6972 726f 725f 7928 706f  _ref.mirror_y(po
+00007140: 7274 5f69 6429 0a0a 2020 2020 2020 2020  rt_id)..        
+00007150: 6966 2072 6f74 6174 696f 6e20 213d 2030  if rotation != 0
+00007160: 3a0a 2020 2020 2020 2020 2020 2020 5f72  :.            _r
+00007170: 6566 2e72 6f74 6174 6528 726f 7461 7469  ef.rotate(rotati
+00007180: 6f6e 2c20 6f72 6967 696e 290a 2020 2020  on, origin).    
+00007190: 2020 2020 5f72 6566 2e6d 6f76 6528 6f72      _ref.move(or
+000071a0: 6967 696e 2c20 706f 7369 7469 6f6e 290a  igin, position).
+000071b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000071c0: 5f72 6566 0a0a 2020 2020 6465 6620 7265  _ref..    def re
+000071d0: 665f 6365 6e74 6572 2873 656c 662c 2070  f_center(self, p
+000071e0: 6f73 6974 696f 6e3d 2830 2c20 3029 293a  osition=(0, 0)):
+000071f0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00007200: 726e 7320 6120 7265 6665 7265 6e63 6520  rns a reference 
+00007210: 6f66 2074 6865 2063 6f6d 706f 6e65 6e74  of the component
+00007220: 2063 656e 7465 7265 6420 6174 2028 783d   centered at (x=
+00007230: 302c 2079 3d30 292e 2222 220a 2020 2020  0, y=0).""".    
+00007240: 2020 2020 7369 203d 2073 656c 662e 7369      si = self.si
+00007250: 7a65 5f69 6e66 6f0a 2020 2020 2020 2020  ze_info.        
+00007260: 7963 203d 2073 692e 736f 7574 6820 2b20  yc = si.south + 
+00007270: 7369 2e68 6569 6768 7420 2f20 320a 2020  si.height / 2.  
+00007280: 2020 2020 2020 7863 203d 2073 692e 7765        xc = si.we
+00007290: 7374 202b 2073 692e 7769 6474 6820 2f20  st + si.width / 
+000072a0: 320a 2020 2020 2020 2020 6365 6e74 6572  2.        center
+000072b0: 203d 2028 7863 2c20 7963 290a 2020 2020   = (xc, yc).    
+000072c0: 2020 2020 5f72 6566 203d 2043 6f6d 706f      _ref = Compo
+000072d0: 6e65 6e74 5265 6665 7265 6e63 6528 7365  nentReference(se
+000072e0: 6c66 290a 2020 2020 2020 2020 5f72 6566  lf).        _ref
+000072f0: 2e6d 6f76 6528 6365 6e74 6572 2c20 706f  .move(center, po
+00007300: 7369 7469 6f6e 290a 2020 2020 2020 2020  sition).        
+00007310: 7265 7475 726e 205f 7265 660a 0a20 2020  return _ref..   
+00007320: 2064 6566 205f 5f72 6570 725f 5f28 7365   def __repr__(se
+00007330: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
+00007340: 2020 2020 2222 2252 6574 7572 6e20 6120      """Return a 
+00007350: 7374 7269 6e67 2072 6570 7265 7365 6e74  string represent
+00007360: 6174 696f 6e20 6f66 2074 6865 206f 626a  ation of the obj
+00007370: 6563 742e 2222 220a 2020 2020 2020 2020  ect.""".        
+00007380: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
+00007390: 2020 2020 2066 227b 7365 6c66 2e6e 616d       f"{self.nam
+000073a0: 657d 3a20 7569 6420 7b73 656c 662e 7569  e}: uid {self.ui
+000073b0: 647d 2c20 220a 2020 2020 2020 2020 2020  d}, ".          
+000073c0: 2020 6622 706f 7274 7320 7b6c 6973 7428    f"ports {list(
+000073d0: 7365 6c66 2e70 6f72 7473 2e6b 6579 7328  self.ports.keys(
+000073e0: 2929 7d2c 2022 0a20 2020 2020 2020 2020  ))}, ".         
+000073f0: 2020 2066 2272 6566 6572 656e 6365 7320     f"references 
+00007400: 7b6c 6973 7428 7365 6c66 2e6e 616d 6564  {list(self.named
+00007410: 5f72 6566 6572 656e 6365 732e 6b65 7973  _references.keys
+00007420: 2829 297d 2c20 220a 2020 2020 2020 2020  ())}, ".        
+00007430: 2020 2020 6622 7b6c 656e 2873 656c 662e      f"{len(self.
+00007440: 706f 6c79 676f 6e73 297d 2070 6f6c 7967  polygons)} polyg
+00007450: 6f6e 7322 0a20 2020 2020 2020 2029 0a0a  ons".        )..
+00007460: 2020 2020 6465 6620 7070 7269 6e74 2873      def pprint(s
+00007470: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00007480: 2020 2020 2020 2222 2250 7269 6e74 7320        """Prints 
+00007490: 636f 6d70 6f6e 656e 7420 696e 666f 2e22  component info."
+000074a0: 2222 0a20 2020 2020 2020 2074 7279 3a0a  "".        try:.
+000074b0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+000074c0: 2072 6963 6820 696d 706f 7274 2070 7265   rich import pre
+000074d0: 7474 790a 0a20 2020 2020 2020 2020 2020  tty..           
+000074e0: 2070 7265 7474 792e 696e 7374 616c 6c28   pretty.install(
+000074f0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+00007500: 6574 7479 2e70 7072 696e 7428 7365 6c66  etty.pprint(self
+00007510: 2e74 6f5f 6469 6374 2829 290a 2020 2020  .to_dict()).    
+00007520: 2020 2020 6578 6365 7074 2049 6d70 6f72      except Impor
+00007530: 7445 7272 6f72 3a0a 2020 2020 2020 2020  tError:.        
+00007540: 2020 2020 7072 696e 7428 7961 6d6c 2e64      print(yaml.d
+00007550: 756d 7028 7365 6c66 2e74 6f5f 6469 6374  ump(self.to_dict
+00007560: 2829 2929 0a0a 2020 2020 6465 6620 7070  ()))..    def pp
+00007570: 7269 6e74 5f70 6f72 7473 2873 656c 662c  rint_ports(self,
+00007580: 2073 6f72 745f 6279 5f6e 616d 653a 2062   sort_by_name: b
+00007590: 6f6f 6c20 3d20 5472 7565 2c20 2a2a 6b77  ool = True, **kw
+000075a0: 6172 6773 2920 2d3e 204e 6f6e 653a 0a20  args) -> None:. 
+000075b0: 2020 2020 2020 2022 2222 5072 696e 7473         """Prints
+000075c0: 2070 6f72 7473 2069 6e20 6120 7269 6368   ports in a rich
+000075d0: 2074 6162 6c65 2e0a 0a20 2020 2020 2020   table...       
+000075e0: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
+000075f0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00007600: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
+00007610: 6974 6820 4744 5320 6c61 7965 722e 0a20  ith GDS layer.. 
+00007620: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00007630: 783a 2073 656c 6563 7420 706f 7274 7320  x: select ports 
+00007640: 7769 7468 2070 7265 6669 7820 696e 2070  with prefix in p
+00007650: 6f72 7420 6e61 6d65 2e0a 2020 2020 2020  ort name..      
+00007660: 2020 2020 2020 7375 6666 6978 3a20 7365        suffix: se
+00007670: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
+00007680: 706f 7274 206e 616d 6520 7375 6666 6978  port name suffix
+00007690: 2e0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
+000076a0: 6965 6e74 6174 696f 6e3a 2073 656c 6563  ientation: selec
+000076b0: 7420 706f 7274 7320 7769 7468 206f 7269  t ports with ori
+000076c0: 656e 7461 7469 6f6e 2069 6e20 6465 6772  entation in degr
+000076d0: 6565 732e 0a20 2020 2020 2020 2020 2020  ees..           
+000076e0: 206f 7269 656e 7461 7469 6f6e 3a20 7365   orientation: se
+000076f0: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
+00007700: 6f72 6965 6e74 6174 696f 6e20 696e 2064  orientation in d
+00007710: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
+00007720: 2020 2020 7769 6474 683a 2073 656c 6563      width: selec
+00007730: 7420 706f 7274 7320 7769 7468 2070 6f72  t ports with por
+00007740: 7420 7769 6474 682e 0a20 2020 2020 2020  t width..       
+00007750: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
+00007760: 7564 6564 3a20 4c69 7374 206f 6620 6c61  uded: List of la
+00007770: 7965 7273 2074 6f20 6578 636c 7564 652e  yers to exclude.
+00007780: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
+00007790: 745f 7479 7065 3a20 7365 6c65 6374 2070  t_type: select p
+000077a0: 6f72 7473 2077 6974 6820 706f 7274 5f74  orts with port_t
+000077b0: 7970 6520 286f 7074 6963 616c 2c20 656c  ype (optical, el
+000077c0: 6563 7472 6963 616c 2c20 7665 7274 6963  ectrical, vertic
+000077d0: 616c 5f74 6529 2e0a 2020 2020 2020 2020  al_te)..        
+000077e0: 2020 2020 636c 6f63 6b77 6973 653a 2069      clockwise: i
+000077f0: 6620 5472 7565 2c20 736f 7274 2070 6f72  f True, sort por
+00007800: 7473 2063 6c6f 636b 7769 7365 2c20 4661  ts clockwise, Fa
+00007810: 6c73 653a 2063 6f75 6e74 6572 2d63 6c6f  lse: counter-clo
+00007820: 636b 7769 7365 2e0a 2020 2020 2020 2020  ckwise..        
+00007830: 2222 220a 0a20 2020 2020 2020 2070 7072  """..        ppr
+00007840: 696e 745f 706f 7274 7328 7365 6c66 2e67  int_ports(self.g
+00007850: 6574 5f70 6f72 7473 5f6c 6973 7428 736f  et_ports_list(so
+00007860: 7274 5f62 795f 6e61 6d65 3d73 6f72 745f  rt_by_name=sort_
+00007870: 6279 5f6e 616d 652c 202a 2a6b 7761 7267  by_name, **kwarg
+00007880: 7329 290a 0a20 2020 2064 6566 2061 6464  s))..    def add
+00007890: 5f70 6f72 7428 0a20 2020 2020 2020 2073  _port(.        s
+000078a0: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
+000078b0: 653a 2073 7472 207c 206f 626a 6563 7420  e: str | object 
+000078c0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+000078d0: 2020 2020 2020 2063 656e 7465 723a 2074         center: t
+000078e0: 7570 6c65 5b66 6c6f 6174 2c20 666c 6f61  uple[float, floa
+000078f0: 745d 207c 204e 6f6e 6520 3d20 4e6f 6e65  t] | None = None
+00007900: 2c0a 2020 2020 2020 2020 7769 6474 683a  ,.        width:
+00007910: 2066 6c6f 6174 207c 204e 6f6e 6520 3d20   float | None = 
+00007920: 4e6f 6e65 2c0a 2020 2020 2020 2020 6f72  None,.        or
+00007930: 6965 6e74 6174 696f 6e3a 2066 6c6f 6174  ientation: float
+00007940: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00007950: 2020 2020 2020 2020 706f 7274 3a20 506f          port: Po
+00007960: 7274 207c 204e 6f6e 6520 3d20 4e6f 6e65  rt | None = None
+00007970: 2c0a 2020 2020 2020 2020 6c61 7965 723a  ,.        layer:
+00007980: 204c 6179 6572 5370 6563 207c 204e 6f6e   LayerSpec | Non
+00007990: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+000079a0: 2020 706f 7274 5f74 7970 653a 2073 7472    port_type: str
+000079b0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+000079c0: 2020 2020 2020 2020 6372 6f73 735f 7365          cross_se
+000079d0: 6374 696f 6e3a 2043 726f 7373 5365 6374  ction: CrossSect
+000079e0: 696f 6e53 7065 6320 7c20 4e6f 6e65 203d  ionSpec | None =
+000079f0: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
+00007a00: 6865 6172 5f61 6e67 6c65 3a20 666c 6f61  hear_angle: floa
+00007a10: 7420 7c20 4e6f 6e65 203d 204e 6f6e 652c  t | None = None,
+00007a20: 0a20 2020 2020 2020 2069 6e66 6f3a 2049  .        info: I
+00007a30: 6e66 6f20 7c20 4e6f 6e65 203d 204e 6f6e  nfo | None = Non
+00007a40: 652c 0a20 2020 2029 202d 3e20 506f 7274  e,.    ) -> Port
+00007a50: 3a0a 2020 2020 2020 2020 2222 2241 6464  :.        """Add
+00007a60: 2070 6f72 7420 746f 2063 6f6d 706f 6e65   port to compone
+00007a70: 6e74 2e0a 0a20 2020 2020 2020 2059 6f75  nt...        You
+00007a80: 2063 616e 2063 6f70 7920 616e 2065 7869   can copy an exi
+00007a90: 7374 696e 6720 706f 7274 206c 696b 6520  sting port like 
+00007aa0: 6164 645f 706f 7274 2870 6f72 7420 3d20  add_port(port = 
+00007ab0: 6578 6973 7469 6e67 5f70 6f72 7429 206f  existing_port) o
+00007ac0: 720a 2020 2020 2020 2020 6372 6561 7465  r.        create
+00007ad0: 2061 206e 6577 2070 6f72 7420 6164 645f   a new port add_
+00007ae0: 706f 7274 286d 796e 616d 652c 206d 7963  port(myname, myc
+00007af0: 656e 7465 722c 206d 7977 6964 7468 2c20  enter, mywidth, 
+00007b00: 6d79 6f72 6965 6e74 6174 696f 6e29 2e0a  myorientation)..
+00007b10: 2020 2020 2020 2020 596f 7520 6361 6e20          You can 
+00007b20: 616c 736f 2063 6f70 7920 616e 2065 7869  also copy an exi
+00007b30: 7374 696e 6720 706f 7274 0a20 2020 2020  sting port.     
+00007b40: 2020 2077 6974 6820 6120 6e65 7720 6e61     with a new na
+00007b50: 6d65 2061 6464 5f70 6f72 7428 706f 7274  me add_port(port
+00007b60: 203d 2065 7869 7374 696e 675f 706f 7274   = existing_port
+00007b70: 2c20 6e61 6d65 203d 206e 6577 5f6e 616d  , name = new_nam
+00007b80: 6529 0a0a 2020 2020 2020 2020 4172 6773  e)..        Args
+00007b90: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
+00007ba0: 6d65 3a20 706f 7274 206e 616d 652e 0a20  me: port name.. 
+00007bb0: 2020 2020 2020 2020 2020 2063 656e 7465             cente
+00007bc0: 723a 2078 2c20 792e 0a20 2020 2020 2020  r: x, y..       
+00007bd0: 2020 2020 2077 6964 7468 3a20 696e 2075       width: in u
+00007be0: 6d2e 0a20 2020 2020 2020 2020 2020 206f  m..            o
+00007bf0: 7269 656e 7461 7469 6f6e 3a20 696e 2064  rientation: in d
+00007c00: 6567 2e0a 2020 2020 2020 2020 2020 2020  eg..            
+00007c10: 706f 7274 3a20 6f70 7469 6f6e 616c 2070  port: optional p
+00007c20: 6f72 742e 0a20 2020 2020 2020 2020 2020  ort..           
+00007c30: 206c 6179 6572 3a20 706f 7274 206c 6179   layer: port lay
+00007c40: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
+00007c50: 706f 7274 5f74 7970 653a 206f 7074 6963  port_type: optic
+00007c60: 616c 2c20 656c 6563 7472 6963 616c 2c20  al, electrical, 
+00007c70: 7665 7274 6963 616c 5f64 632c 2076 6572  vertical_dc, ver
+00007c80: 7469 6361 6c5f 7465 2c20 7665 7274 6963  tical_te, vertic
+00007c90: 616c 5f74 6d2e 2044 6566 6175 6c74 7320  al_tm. Defaults 
+00007ca0: 746f 206f 7074 6963 616c 2e0a 2020 2020  to optical..    
+00007cb0: 2020 2020 2020 2020 6372 6f73 735f 7365          cross_se
+00007cc0: 6374 696f 6e3a 2070 6f72 7420 6372 6f73  ction: port cros
+00007cd0: 735f 7365 6374 696f 6e2e 0a20 2020 2020  s_section..     
+00007ce0: 2020 2020 2020 2073 6865 6172 5f61 6e67         shear_ang
+00007cf0: 6c65 3a20 616e 206f 7074 696f 6e61 6c20  le: an optional 
+00007d00: 616e 676c 6520 746f 2073 6865 6172 2070  angle to shear p
+00007d10: 6f72 7420 6661 6365 2069 6e20 6465 6772  ort face in degr
+00007d20: 6565 732e 0a20 2020 2020 2020 2020 2020  ees..           
+00007d30: 2069 6e66 6f3a 2063 6f6e 7461 696e 7320   info: contains 
+00007d40: 6172 6269 7472 6172 7920 696e 666f 726d  arbitrary inform
+00007d50: 6174 696f 6e20 6162 6f75 7420 7468 6520  ation about the 
+00007d60: 706f 7274 2e0a 2020 2020 2020 2020 2222  port..        ""
+00007d70: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+00007d80: 6473 6661 6374 6f72 792e 7064 6b20 696d  dsfactory.pdk im
+00007d90: 706f 7274 2067 6574 5f63 726f 7373 5f73  port get_cross_s
+00007da0: 6563 7469 6f6e 2c20 6765 745f 6c61 7965  ection, get_laye
+00007db0: 720a 0a20 2020 2020 2020 206c 6179 6572  r..        layer
+00007dc0: 203d 2067 6574 5f6c 6179 6572 286c 6179   = get_layer(lay
+00007dd0: 6572 290a 0a20 2020 2020 2020 2069 6620  er)..        if 
+00007de0: 706f 7274 3a0a 2020 2020 2020 2020 2020  port:.          
+00007df0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00007e00: 6e63 6528 706f 7274 2c20 506f 7274 293a  nce(port, Port):
+00007e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007e20: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00007e30: 7228 6622 6164 645f 706f 7274 2829 206e  r(f"add_port() n
+00007e40: 6565 6473 2061 2050 6f72 742c 2067 6f74  eeds a Port, got
+00007e50: 207b 7479 7065 2870 6f72 7429 7d22 290a   {type(port)}").
+00007e60: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
+00007e70: 706f 7274 2e63 6f70 7928 290a 2020 2020  port.copy().    
+00007e80: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
+00007e90: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00007ea0: 2020 2020 2020 2020 2020 2020 2070 2e6e               p.n
+00007eb0: 616d 6520 3d20 6e61 6d65 0a20 2020 2020  ame = name.     
+00007ec0: 2020 2020 2020 2069 6620 6365 6e74 6572         if center
+00007ed0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00007ee0: 2020 2020 2020 2020 2020 2020 2020 702e                p.
+00007ef0: 6365 6e74 6572 203d 2063 656e 7465 720a  center = center.
+00007f00: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+00007f10: 6964 7468 2069 7320 6e6f 7420 4e6f 6e65  idth is not None
+00007f20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007f30: 2020 702e 7769 6474 6820 3d20 7769 6474    p.width = widt
+00007f40: 680a 2020 2020 2020 2020 2020 2020 6966  h.            if
+00007f50: 206f 7269 656e 7461 7469 6f6e 2069 7320   orientation is 
+00007f60: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00007f70: 2020 2020 2020 2020 2020 702e 6f72 6965            p.orie
+00007f80: 6e74 6174 696f 6e20 3d20 6f72 6965 6e74  ntation = orient
+00007f90: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
+00007fa0: 2020 6966 2070 6f72 745f 7479 7065 2069    if port_type i
+00007fb0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00007fc0: 2020 2020 2020 2020 2020 2020 702e 706f              p.po
+00007fd0: 7274 5f74 7970 6520 3d20 706f 7274 5f74  rt_type = port_t
+00007fe0: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
+00007ff0: 6966 206c 6179 6572 2069 7320 6e6f 7420  if layer is not 
+00008000: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00008010: 2020 2020 2020 702e 6c61 7965 7220 3d20        p.layer = 
+00008020: 6c61 7965 720a 2020 2020 2020 2020 2020  layer.          
+00008030: 2020 6966 2073 6865 6172 5f61 6e67 6c65    if shear_angle
+00008040: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00008050: 2020 2020 2020 2020 2020 2020 2020 702e                p.
+00008060: 7368 6561 725f 616e 676c 6520 3d20 7368  shear_angle = sh
+00008070: 6561 725f 616e 676c 650a 2020 2020 2020  ear_angle.      
+00008080: 2020 2020 2020 6966 2063 726f 7373 5f73        if cross_s
+00008090: 6563 7469 6f6e 2069 7320 6e6f 7420 4e6f  ection is not No
+000080a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000080b0: 2020 2020 702e 6372 6f73 735f 7365 6374      p.cross_sect
+000080c0: 696f 6e20 3d20 6372 6f73 735f 7365 6374  ion = cross_sect
+000080d0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+000080e0: 6966 2069 6e66 6f3a 0a20 2020 2020 2020  if info:.       
+000080f0: 2020 2020 2020 2020 2066 6f72 206b 2c20           for k, 
+00008100: 7620 696e 2064 6963 7428 696e 666f 292e  v in dict(info).
+00008110: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+00008120: 2020 2020 2020 2020 2020 2020 2070 2e69               p.i
+00008130: 6e66 6f5b 6b5d 203d 2076 0a20 2020 2020  nfo[k] = v.     
+00008140: 2020 2020 2020 2070 2e70 6172 656e 7420         p.parent 
+00008150: 3d20 7365 6c66 0a0a 2020 2020 2020 2020  = self..        
+00008160: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00008170: 6e61 6d65 2c20 506f 7274 293a 0a20 2020  name, Port):.   
+00008180: 2020 2020 2020 2020 2070 203d 206e 616d           p = nam
+00008190: 652e 636f 7079 2829 0a20 2020 2020 2020  e.copy().       
+000081a0: 2020 2020 2070 2e70 6172 656e 7420 3d20       p.parent = 
+000081b0: 7365 6c66 0a20 2020 2020 2020 2020 2020  self.           
+000081c0: 206e 616d 6520 3d20 702e 6e61 6d65 0a20   name = p.name. 
+000081d0: 2020 2020 2020 2065 6c69 6620 6365 6e74         elif cent
+000081e0: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
+000081f0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00008200: 6c75 6545 7272 6f72 2822 506f 7274 206e  lueError("Port n
+00008210: 6565 6473 2063 656e 7465 7220 7061 7261  eeds center para
+00008220: 6d65 7465 7220 2878 2c20 7929 2075 6d2e  meter (x, y) um.
+00008230: 2229 0a0a 2020 2020 2020 2020 656c 7365  ")..        else
+00008240: 3a0a 2020 2020 2020 2020 2020 2020 7020  :.            p 
+00008250: 3d20 506f 7274 280a 2020 2020 2020 2020  = Port(.        
+00008260: 2020 2020 2020 2020 6e61 6d65 3d6e 616d          name=nam
+00008270: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00008280: 2020 2063 656e 7465 723d 6365 6e74 6572     center=center
+00008290: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000082a0: 2020 7769 6474 683d 7769 6474 682c 0a20    width=width,. 
+000082b0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000082c0: 7269 656e 7461 7469 6f6e 3d6f 7269 656e  rientation=orien
+000082d0: 7461 7469 6f6e 2c0a 2020 2020 2020 2020  tation,.        
+000082e0: 2020 2020 2020 2020 7061 7265 6e74 3d73          parent=s
+000082f0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+00008300: 2020 2020 206c 6179 6572 3d6c 6179 6572       layer=layer
+00008310: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00008320: 2020 706f 7274 5f74 7970 653d 706f 7274    port_type=port
+00008330: 5f74 7970 6520 6f72 2022 6f70 7469 6361  _type or "optica
+00008340: 6c22 2c0a 2020 2020 2020 2020 2020 2020  l",.            
+00008350: 2020 2020 6372 6f73 735f 7365 6374 696f      cross_sectio
+00008360: 6e3d 6765 745f 6372 6f73 735f 7365 6374  n=get_cross_sect
+00008370: 696f 6e28 6372 6f73 735f 7365 6374 696f  ion(cross_sectio
+00008380: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+00008390: 2020 2069 6620 6372 6f73 735f 7365 6374     if cross_sect
+000083a0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+000083b0: 2020 2020 656c 7365 204e 6f6e 652c 0a20      else None,. 
+000083c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000083d0: 6865 6172 5f61 6e67 6c65 3d73 6865 6172  hear_angle=shear
+000083e0: 5f61 6e67 6c65 2c0a 2020 2020 2020 2020  _angle,.        
+000083f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00008400: 2020 702e 7061 7265 6e74 203d 2073 656c    p.parent = sel
+00008410: 660a 2020 2020 2020 2020 2020 2020 6966  f.            if
+00008420: 2069 6e66 6f20 6973 206e 6f74 204e 6f6e   info is not Non
+00008430: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00008440: 2020 2066 6f72 206b 2c20 7620 696e 2064     for k, v in d
+00008450: 6963 7428 696e 666f 292e 6974 656d 7328  ict(info).items(
+00008460: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00008470: 2020 2020 2020 2070 2e69 6e66 6f5b 6b5d         p.info[k]
+00008480: 203d 2076 0a20 2020 2020 2020 2069 6620   = v.        if 
+00008490: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
+000084a0: 3a0a 2020 2020 2020 2020 2020 2020 702e  :.            p.
+000084b0: 6e61 6d65 203d 206e 616d 650a 2020 2020  name = name.    
+000084c0: 2020 2020 6966 2070 2e6e 616d 6520 696e      if p.name in
+000084d0: 2073 656c 662e 706f 7274 733a 0a20 2020   self.ports:.   
+000084e0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000084f0: 616c 7565 4572 726f 7228 6622 6164 645f  alueError(f"add_
+00008500: 706f 7274 2829 2050 6f72 7420 6e61 6d65  port() Port name
+00008510: 207b 702e 6e61 6d65 2172 7d20 6578 6973   {p.name!r} exis
+00008520: 7473 2069 6e20 7b73 656c 662e 6e61 6d65  ts in {self.name
+00008530: 2172 7d22 290a 0a20 2020 2020 2020 2073  !r}")..        s
+00008540: 656c 662e 706f 7274 735b 702e 6e61 6d65  elf.ports[p.name
+00008550: 5d20 3d20 700a 2020 2020 2020 2020 7265  ] = p.        re
+00008560: 7475 726e 2070 0a0a 2020 2020 6465 6620  turn p..    def 
+00008570: 6164 645f 706f 7274 7328 0a20 2020 2020  add_ports(.     
+00008580: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00008590: 2070 6f72 7473 3a20 4974 6572 6162 6c65   ports: Iterable
+000085a0: 5b50 6f72 745d 207c 2064 6963 745b 7374  [Port] | dict[st
+000085b0: 722c 2050 6f72 745d 2c0a 2020 2020 2020  r, Port],.      
+000085c0: 2020 7072 6566 6978 3a20 7374 7220 3d20    prefix: str = 
+000085d0: 2222 2c0a 2020 2020 2020 2020 7375 6666  "",.        suff
+000085e0: 6978 3a20 7374 7220 3d20 2222 2c0a 2020  ix: str = "",.  
+000085f0: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
+00008600: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
+00008610: 2020 2020 2020 2022 2222 4164 6420 6120         """Add a 
+00008620: 6c69 7374 206f 7220 6469 6374 206f 6620  list or dict of 
+00008630: 706f 7274 732e 0a0a 2020 2020 2020 2020  ports...        
+00008640: 796f 7520 6361 6e20 696e 636c 7564 6520  you can include 
+00008650: 6120 7072 6566 6978 2074 6f20 6164 6420  a prefix to add 
+00008660: 746f 2074 6865 206e 6577 2070 6f72 7420  to the new port 
+00008670: 6e61 6d65 7320 746f 2061 766f 6964 206e  names to avoid n
+00008680: 616d 6520 636f 6e66 6c69 6374 732e 0a0a  ame conflicts...
+00008690: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+000086a0: 2020 2020 2020 2020 2020 706f 7274 733a            ports:
+000086b0: 206c 6973 7420 6f72 2064 6963 7420 6f66   list or dict of
+000086c0: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
+000086d0: 2020 2020 7072 6566 6978 3a20 746f 2070      prefix: to p
+000086e0: 7265 7065 6e64 2074 6f20 6561 6368 2070  repend to each p
+000086f0: 6f72 7420 6e61 6d65 2e0a 2020 2020 2020  ort name..      
+00008700: 2020 2020 2020 7375 6666 6978 3a20 746f        suffix: to
+00008710: 2061 7070 656e 6420 746f 2065 6163 6820   append to each 
+00008720: 706f 7274 206e 616d 652e 0a20 2020 2020  port name..     
+00008730: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00008740: 6620 6861 7361 7474 7228 706f 7274 732c  f hasattr(ports,
+00008750: 2022 7661 6c75 6573 2229 3a0a 2020 2020   "values"):.    
+00008760: 2020 2020 2020 2020 666f 7220 706f 7274          for port
+00008770: 5f6e 616d 652c 2070 6f72 7420 696e 2070  _name, port in p
+00008780: 6f72 7473 2e69 7465 6d73 2829 3a0a 2020  orts.items():.  
+00008790: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+000087a0: 6d65 203d 2066 227b 7072 6566 6978 7d7b  me = f"{prefix}{
+000087b0: 706f 7274 5f6e 616d 657d 7b73 7566 6669  port_name}{suffi
+000087c0: 787d 220a 2020 2020 2020 2020 2020 2020  x}".            
+000087d0: 2020 2020 7365 6c66 2e61 6464 5f70 6f72      self.add_por
+000087e0: 7428 6e61 6d65 3d6e 616d 652c 2070 6f72  t(name=name, por
+000087f0: 743d 706f 7274 2c20 2a2a 6b77 6172 6773  t=port, **kwargs
+00008800: 290a 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+00008810: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00008820: 2070 6f72 7420 696e 2070 6f72 7473 3a0a   port in ports:.
+00008830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008840: 6e61 6d65 203d 2066 227b 7072 6566 6978  name = f"{prefix
+00008850: 7d7b 706f 7274 2e6e 616d 657d 7b73 7566  }{port.name}{suf
+00008860: 6669 787d 220a 2020 2020 2020 2020 2020  fix}".          
+00008870: 2020 2020 2020 7365 6c66 2e61 6464 5f70        self.add_p
+00008880: 6f72 7428 6e61 6d65 3d6e 616d 652c 2070  ort(name=name, p
+00008890: 6f72 743d 706f 7274 2c20 2a2a 6b77 6172  ort=port, **kwar
+000088a0: 6773 290a 0a20 2020 2064 6566 2073 6e61  gs)..    def sna
+000088b0: 705f 706f 7274 735f 746f 5f67 7269 6428  p_ports_to_grid(
+000088c0: 7365 6c66 2c20 6772 6964 5f66 6163 746f  self, grid_facto
+000088d0: 723a 2069 6e74 203d 2031 2920 2d3e 204e  r: int = 1) -> N
+000088e0: 6f6e 653a 0a20 2020 2020 2020 2066 6f72  one:.        for
+000088f0: 2070 6f72 7420 696e 2073 656c 662e 706f   port in self.po
+00008900: 7274 732e 7661 6c75 6573 2829 3a0a 2020  rts.values():.  
+00008910: 2020 2020 2020 2020 2020 706f 7274 2e73            port.s
+00008920: 6e61 705f 746f 5f67 7269 6428 6772 6964  nap_to_grid(grid
+00008930: 5f66 6163 746f 723d 6772 6964 5f66 6163  _factor=grid_fac
+00008940: 746f 7229 0a0a 2020 2020 6465 6620 7265  tor)..    def re
+00008950: 6d6f 7665 5f6c 6179 6572 7328 0a20 2020  move_layers(.   
+00008960: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00008970: 2020 206c 6179 6572 733a 206c 6973 745b     layers: list[
+00008980: 4c61 7965 7253 7065 635d 2c0a 2020 2020  LayerSpec],.    
+00008990: 2020 2020 696e 636c 7564 655f 6c61 6265      include_labe
+000089a0: 6c73 3a20 626f 6f6c 203d 2054 7275 652c  ls: bool = True,
+000089b0: 0a20 2020 2020 2020 2069 6e76 6572 745f  .        invert_
+000089c0: 7365 6c65 6374 696f 6e3a 2062 6f6f 6c20  selection: bool 
+000089d0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+000089e0: 2072 6563 7572 7369 7665 3a20 626f 6f6c   recursive: bool
+000089f0: 203d 2054 7275 652c 0a20 2020 2029 202d   = True,.    ) -
+00008a00: 3e20 436f 6d70 6f6e 656e 743a 0a20 2020  > Component:.   
+00008a10: 2020 2020 2022 2222 5265 6d6f 7665 2061       """Remove a
+00008a20: 206c 6973 7420 6f66 206c 6179 6572 7320   list of layers 
+00008a30: 616e 6420 7265 7475 726e 7320 7468 6520  and returns the 
+00008a40: 7361 6d65 2043 6f6d 706f 6e65 6e74 2e0a  same Component..
+00008a50: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00008a60: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00008a70: 733a 206c 6973 7420 6f66 206c 6179 6572  s: list of layer
+00008a80: 7320 746f 2072 656d 6f76 652e 0a20 2020  s to remove..   
+00008a90: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
+00008aa0: 5f6c 6162 656c 733a 2072 656d 6f76 6520  _labels: remove 
+00008ab0: 6c61 6265 6c73 206f 6e20 7468 6f73 6520  labels on those 
+00008ac0: 6c61 7965 7273 2e0a 2020 2020 2020 2020  layers..        
+00008ad0: 2020 2020 696e 7665 7274 5f73 656c 6563      invert_selec
+00008ae0: 7469 6f6e 3a20 7265 6d6f 7665 7320 616c  tion: removes al
+00008af0: 6c20 6c61 7965 7273 2065 7863 6570 7420  l layers except 
+00008b00: 6c61 7965 7273 2073 7065 6369 6669 6564  layers specified
+00008b10: 2e0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00008b20: 6375 7273 6976 653a 206f 7065 7261 7465  cursive: operate
+00008b30: 206f 6e20 7468 6520 6365 6c6c 7320 696e   on the cells in
+00008b40: 636c 7564 6564 2069 6e20 7468 6973 2063  cluded in this c
+00008b50: 656c 6c2e 0a20 2020 2020 2020 2022 2222  ell..        """
+00008b60: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
+00008b70: 7366 6163 746f 7279 2069 6d70 6f72 7420  sfactory import 
+00008b80: 6765 745f 6c61 7965 720a 0a20 2020 2020  get_layer..     
+00008b90: 2020 2063 6f6d 706f 6e65 6e74 203d 2073     component = s
+00008ba0: 656c 662e 666c 6174 7465 6e28 2920 6966  elf.flatten() if
+00008bb0: 2072 6563 7572 7369 7665 2061 6e64 2073   recursive and s
+00008bc0: 656c 662e 7265 6665 7265 6e63 6573 2065  elf.references e
+00008bd0: 6c73 6520 7365 6c66 0a20 2020 2020 2020  lse self.       
+00008be0: 206c 6179 6572 7320 3d20 5b67 6574 5f6c   layers = [get_l
+00008bf0: 6179 6572 286c 6179 6572 2920 666f 7220  ayer(layer) for 
+00008c00: 6c61 7965 7220 696e 206c 6179 6572 735d  layer in layers]
+00008c10: 0a0a 2020 2020 2020 2020 7368 6f75 6c64  ..        should
+00008c20: 5f72 656d 6f76 6520 3d20 6e6f 7420 696e  _remove = not in
+00008c30: 7665 7274 5f73 656c 6563 7469 6f6e 0a20  vert_selection. 
+00008c40: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+00008c50: 2e5f 6365 6c6c 2e66 696c 7465 7228 0a20  ._cell.filter(. 
+00008c60: 2020 2020 2020 2020 2020 2073 7065 633d             spec=
+00008c70: 6c61 7965 7273 2c0a 2020 2020 2020 2020  layers,.        
+00008c80: 2020 2020 7265 6d6f 7665 3d73 686f 756c      remove=shoul
+00008c90: 645f 7265 6d6f 7665 2c0a 2020 2020 2020  d_remove,.      
+00008ca0: 2020 2020 2020 706f 6c79 676f 6e73 3d54        polygons=T
+00008cb0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+00008cc0: 2070 6174 6873 3d54 7275 652c 0a20 2020   paths=True,.   
+00008cd0: 2020 2020 2020 2020 206c 6162 656c 733d           labels=
+00008ce0: 696e 636c 7564 655f 6c61 6265 6c73 2c0a  include_labels,.
+00008cf0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00008d00: 2020 7265 7475 726e 2063 6f6d 706f 6e65    return compone
+00008d10: 6e74 0a0a 2020 2020 6465 6620 6578 7472  nt..    def extr
+00008d20: 6163 7428 0a20 2020 2020 2020 2073 656c  act(.        sel
+00008d30: 662c 0a20 2020 2020 2020 206c 6179 6572  f,.        layer
+00008d40: 733a 206c 6973 745b 4c61 7965 7253 7065  s: list[LayerSpe
+00008d50: 635d 2c0a 2020 2020 2020 2020 696e 636c  c],.        incl
+00008d60: 7564 655f 6c61 6265 6c73 3a20 626f 6f6c  ude_labels: bool
+00008d70: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
+00008d80: 2072 6563 7572 7369 7665 3a20 626f 6f6c   recursive: bool
+00008d90: 203d 2054 7275 652c 0a20 2020 2029 202d   = True,.    ) -
+00008da0: 3e20 436f 6d70 6f6e 656e 743a 0a20 2020  > Component:.   
+00008db0: 2020 2020 2022 2222 4578 7472 6163 7420       """Extract 
+00008dc0: 706f 6c79 676f 6e73 2066 726f 6d20 6120  polygons from a 
+00008dd0: 436f 6d70 6f6e 656e 7420 616e 6420 7265  Component and re
+00008de0: 7475 726e 7320 6120 6e65 7720 436f 6d70  turns a new Comp
+00008df0: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
+00008e00: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00008e10: 2020 6c61 7965 7273 3a20 6c69 7374 206f    layers: list o
+00008e20: 6620 6c61 7965 7273 2074 6f20 6578 7472  f layers to extr
+00008e30: 6163 742e 0a20 2020 2020 2020 2020 2020  act..           
+00008e40: 2069 6e63 6c75 6465 5f6c 6162 656c 733a   include_labels:
+00008e50: 2065 7874 7261 6374 206c 6162 656c 7320   extract labels 
+00008e60: 6f6e 2074 686f 7365 206c 6179 6572 732e  on those layers.
+00008e70: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
+00008e80: 7572 7369 7665 3a20 6f70 6572 6174 6520  ursive: operate 
+00008e90: 6f6e 2074 6865 2063 656c 6c73 2069 6e63  on the cells inc
+00008ea0: 6c75 6465 6420 696e 2074 6869 7320 6365  luded in this ce
+00008eb0: 6c6c 2e0a 2020 2020 2020 2020 2222 220a  ll..        """.
+00008ec0: 2020 2020 2020 2020 6320 3d20 7365 6c66          c = self
+00008ed0: 2e63 6f70 7928 290a 0a20 2020 2020 2020  .copy()..       
+00008ee0: 2072 6574 7572 6e20 632e 7265 6d6f 7665   return c.remove
+00008ef0: 5f6c 6179 6572 7328 0a20 2020 2020 2020  _layers(.       
+00008f00: 2020 2020 206c 6179 6572 732c 0a20 2020       layers,.   
+00008f10: 2020 2020 2020 2020 2069 6e76 6572 745f           invert_
+00008f20: 7365 6c65 6374 696f 6e3d 5472 7565 2c0a  selection=True,.
+00008f30: 2020 2020 2020 2020 2020 2020 7265 6375              recu
+00008f40: 7273 6976 653d 7265 6375 7273 6976 652c  rsive=recursive,
+00008f50: 0a20 2020 2020 2020 2020 2020 2069 6e63  .            inc
+00008f60: 6c75 6465 5f6c 6162 656c 733d 696e 636c  lude_labels=incl
+00008f70: 7564 655f 6c61 6265 6c73 2c0a 2020 2020  ude_labels,.    
+00008f80: 2020 2020 290a 0a20 2020 2064 6566 2061      )..    def a
+00008f90: 6464 5f70 6f6c 7967 6f6e 280a 2020 2020  dd_polygon(.    
+00008fa0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00008fb0: 2020 706f 696e 7473 2c0a 2020 2020 2020    points,.      
+00008fc0: 2020 6c61 7965 723a 2073 7472 207c 2069    layer: str | i
+00008fd0: 6e74 207c 2074 7570 6c65 5b69 6e74 2c20  nt | tuple[int, 
+00008fe0: 696e 745d 207c 206e 702e 6e61 6e20 3d20  int] | np.nan = 
+00008ff0: 6e70 2e6e 616e 2c0a 2020 2020 2020 2020  np.nan,.        
+00009000: 736e 6170 5f74 6f5f 6772 6964 3a20 626f  snap_to_grid: bo
+00009010: 6f6c 203d 2054 7275 652c 0a20 2020 2029  ol = True,.    )
+00009020: 202d 3e20 506f 6c79 676f 6e3a 0a20 2020   -> Polygon:.   
+00009030: 2020 2020 2022 2222 4164 6473 2061 2050       """Adds a P
+00009040: 6f6c 7967 6f6e 2074 6f20 7468 6520 436f  olygon to the Co
+00009050: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
+00009060: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+00009070: 2020 2020 706f 696e 7473 3a20 436f 6f72      points: Coor
+00009080: 6469 6e61 7465 7320 6f66 2074 6865 2076  dinates of the v
+00009090: 6572 7469 6365 7320 6f66 2074 6865 2050  ertices of the P
+000090a0: 6f6c 7967 6f6e 2e0a 2020 2020 2020 2020  olygon..        
+000090b0: 2020 2020 6c61 7965 723a 206c 6179 6572      layer: layer
+000090c0: 2073 7065 6320 746f 2061 6464 2070 6f6c   spec to add pol
+000090d0: 7967 6f6e 206f 6e2e 0a20 2020 2020 2020  ygon on..       
+000090e0: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+000090f0: 6d20 6764 7366 6163 746f 7279 2e70 646b  m gdsfactory.pdk
+00009100: 2069 6d70 6f72 7420 6765 745f 6c61 7965   import get_laye
+00009110: 720a 0a20 2020 2020 2020 2069 6620 6c61  r..        if la
+00009120: 7965 7220 6973 204e 6f6e 653a 0a20 2020  yer is None:.   
+00009130: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00009140: 4e6f 6e65 0a20 2020 2020 2020 2065 6c69  None.        eli
+00009150: 6620 6973 696e 7374 616e 6365 286c 6179  f isinstance(lay
+00009160: 6572 2c20 7365 7429 3a0a 2020 2020 2020  er, set):.      
+00009170: 2020 2020 2020 706f 6c79 676f 6e73 203d        polygons =
+00009180: 205b 7365 6c66 2e61 6464 5f70 6f6c 7967   [self.add_polyg
+00009190: 6f6e 2870 6f69 6e74 732c 206c 7929 2066  on(points, ly) f
+000091a0: 6f72 206c 7920 696e 206c 6179 6572 5d0a  or ly in layer].
+000091b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000091c0: 726e 2070 6f6c 7967 6f6e 735b 305d 0a0a  rn polygons[0]..
+000091d0: 2020 2020 2020 2020 6c61 7965 7220 3d20          layer = 
+000091e0: 6765 745f 6c61 7965 7228 6c61 7965 7229  get_layer(layer)
+000091f0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00009200: 7374 616e 6365 2870 6f69 6e74 732c 2067  stance(points, g
+00009210: 6473 746b 2e50 6f6c 7967 6f6e 293a 0a20  dstk.Polygon):. 
+00009220: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+00009230: 6c61 7965 7220 6973 2075 6e73 7065 6369  layer is unspeci
+00009240: 6669 6564 206f 7220 6d61 7463 6865 7320  fied or matches 
+00009250: 6f72 6967 696e 616c 2070 6f6c 7967 6f6e  original polygon
+00009260: 2c20 6a75 7374 2061 6464 2069 7420 6173  , just add it as
+00009270: 2d69 730a 2020 2020 2020 2020 2020 2020  -is.            
+00009280: 706f 6c79 676f 6e20 3d20 706f 696e 7473  polygon = points
+00009290: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000092a0: 6c61 7965 7220 6973 206e 702e 6e61 6e20  layer is np.nan 
+000092b0: 6f72 2028 0a20 2020 2020 2020 2020 2020  or (.           
+000092c0: 2020 2020 2069 7369 6e73 7461 6e63 6528       isinstance(
+000092d0: 6c61 7965 722c 2074 7570 6c65 2920 616e  layer, tuple) an
+000092e0: 6420 2870 6f6c 7967 6f6e 2e6c 6179 6572  d (polygon.layer
+000092f0: 2c20 706f 6c79 676f 6e2e 6461 7461 7479  , polygon.dataty
+00009300: 7065 2920 3d3d 206c 6179 6572 0a20 2020  pe) == layer.   
+00009310: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+00009320: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
+00009330: 676f 6e20 3d20 506f 6c79 676f 6e28 706f  gon = Polygon(po
+00009340: 6c79 676f 6e2e 706f 696e 7473 2c20 2870  lygon.points, (p
+00009350: 6f6c 7967 6f6e 2e6c 6179 6572 2c20 706f  olygon.layer, po
+00009360: 6c79 676f 6e2e 6461 7461 7479 7065 2929  lygon.datatype))
+00009370: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00009380: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00009390: 2020 206c 6179 6572 2c20 6461 7461 7479     layer, dataty
+000093a0: 7065 203d 205f 7061 7273 655f 6c61 7965  pe = _parse_laye
+000093b0: 7228 6c61 7965 7229 0a20 2020 2020 2020  r(layer).       
+000093c0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+000093d0: 203d 2050 6f6c 7967 6f6e 2870 6f6c 7967   = Polygon(polyg
+000093e0: 6f6e 2e70 6f69 6e74 732c 2028 6c61 7965  on.points, (laye
+000093f0: 722c 2064 6174 6174 7970 6529 290a 0a20  r, datatype)).. 
+00009400: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
+00009410: 7361 7474 7228 706f 696e 7473 2c20 2270  sattr(points, "p
+00009420: 726f 7065 7274 6965 7322 293a 0a20 2020  roperties"):.   
+00009430: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
+00009440: 7967 6f6e 2e70 726f 7065 7274 6965 7320  ygon.properties 
+00009450: 3d20 6465 6570 636f 7079 2870 6f69 6e74  = deepcopy(point
+00009460: 732e 7072 6f70 6572 7469 6573 290a 0a20  s.properties).. 
+00009470: 2020 2020 2020 2020 2020 2069 6620 706f             if po
+00009480: 6c79 676f 6e2e 6172 6561 2829 203e 2030  lygon.area() > 0
+00009490: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000094a0: 2020 7365 6c66 2e5f 6164 645f 706f 6c79    self._add_poly
+000094b0: 676f 6e73 2870 6f6c 7967 6f6e 290a 2020  gons(polygon).  
+000094c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000094d0: 2070 6f6c 7967 6f6e 0a0a 2020 2020 2020   polygon..      
+000094e0: 2020 656c 6966 2068 6173 6174 7472 2870    elif hasattr(p
+000094f0: 6f69 6e74 732c 2022 6765 6f6d 7322 293a  oints, "geoms"):
+00009500: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00009510: 2067 656f 6d20 696e 2070 6f69 6e74 732e   geom in points.
+00009520: 6765 6f6d 733a 0a20 2020 2020 2020 2020  geoms:.         
+00009530: 2020 2020 2020 2070 6f6c 7967 6f6e 203d         polygon =
+00009540: 2073 656c 662e 6164 645f 706f 6c79 676f   self.add_polygo
+00009550: 6e28 6765 6f6d 2c20 6c61 7965 723d 6c61  n(geom, layer=la
+00009560: 7965 7229 0a20 2020 2020 2020 2020 2020  yer).           
+00009570: 2072 6574 7572 6e20 706f 6c79 676f 6e0a   return polygon.
+00009580: 2020 2020 2020 2020 656c 6966 2068 6173          elif has
+00009590: 6174 7472 2870 6f69 6e74 732c 2022 6578  attr(points, "ex
+000095a0: 7465 7269 6f72 2229 3a20 2023 2070 6f69  terior"):  # poi
+000095b0: 6e74 7320 6973 2061 2073 6861 7065 6c79  nts is a shapely
+000095c0: 2050 6f6c 7967 6f6e 0a20 2020 2020 2020   Polygon.       
+000095d0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000095e0: 2e5f 6164 645f 706f 6c79 676f 6e5f 7368  ._add_polygon_sh
+000095f0: 6170 656c 7928 6c61 7965 722c 2070 6f69  apely(layer, poi
+00009600: 6e74 7329 0a0a 2020 2020 2020 2020 706f  nts)..        po
+00009610: 696e 7473 203d 206e 702e 6173 6172 7261  ints = np.asarra
+00009620: 7928 706f 696e 7473 290a 2020 2020 2020  y(points).      
+00009630: 2020 6966 2070 6f69 6e74 732e 6e64 696d    if points.ndim
+00009640: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+00009650: 2020 2072 6574 7572 6e20 5b73 656c 662e     return [self.
+00009660: 6164 645f 706f 6c79 676f 6e28 706f 6c79  add_polygon(poly
+00009670: 2c20 6c61 7965 723d 6c61 7965 7229 2066  , layer=layer) f
+00009680: 6f72 2070 6f6c 7920 696e 2070 6f69 6e74  or poly in point
+00009690: 735d 0a20 2020 2020 2020 2069 6620 6c61  s].        if la
+000096a0: 7965 7220 6973 206e 702e 6e61 6e3a 0a20  yer is np.nan:. 
+000096b0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+000096c0: 203d 2030 0a0a 2020 2020 2020 2020 6966   = 0..        if
+000096d0: 2070 6f69 6e74 732e 6e64 696d 203d 3d20   points.ndim == 
+000096e0: 323a 0a20 2020 2020 2020 2020 2020 2023  2:.            #
+000096f0: 2061 6464 2073 696e 676c 6520 706f 6c79   add single poly
+00009700: 676f 6e20 6672 6f6d 2070 6f69 6e74 730a  gon from points.
+00009710: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00009720: 656e 2870 6f69 6e74 735b 305d 2920 3e20  en(points[0]) > 
+00009730: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
+00009740: 2020 2023 2043 6f6e 7665 7274 2074 6f20     # Convert to 
+00009750: 666f 726d 205b 5b31 2c32 5d2c 5b33 2c34  form [[1,2],[3,4
+00009760: 5d2c 5b35 2c36 5d5d 0a20 2020 2020 2020  ],[5,6]].       
+00009770: 2020 2020 2020 2020 2070 6f69 6e74 7320           points 
+00009780: 3d20 6e70 2e63 6f6c 756d 6e5f 7374 6163  = np.column_stac
+00009790: 6b28 706f 696e 7473 290a 2020 2020 2020  k(points).      
+000097a0: 2020 2020 2020 706f 696e 7473 203d 2073        points = s
+000097b0: 6e61 702e 736e 6170 5f74 6f5f 6772 6964  nap.snap_to_grid
+000097c0: 2870 6f69 6e74 7329 2069 6620 736e 6170  (points) if snap
+000097d0: 5f74 6f5f 6772 6964 2065 6c73 6520 706f  _to_grid else po
+000097e0: 696e 7473 0a20 2020 2020 2020 2020 2020  ints.           
+000097f0: 206c 6179 6572 2c20 6461 7461 7479 7065   layer, datatype
+00009800: 203d 205f 7061 7273 655f 6c61 7965 7228   = _parse_layer(
+00009810: 6c61 7965 7229 0a20 2020 2020 2020 2020  layer).         
+00009820: 2020 2070 6f6c 7967 6f6e 203d 2050 6f6c     polygon = Pol
+00009830: 7967 6f6e 2870 6f69 6e74 732c 2028 6c61  ygon(points, (la
+00009840: 7965 722c 2064 6174 6174 7970 6529 290a  yer, datatype)).
+00009850: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+00009860: 6f6c 7967 6f6e 2e61 7265 6128 2920 3e20  olygon.area() > 
+00009870: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00009880: 2020 2073 656c 662e 5f61 6464 5f70 6f6c     self._add_pol
+00009890: 7967 6f6e 7328 706f 6c79 676f 6e29 0a20  ygons(polygon). 
+000098a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000098b0: 6e20 706f 6c79 676f 6e0a 2020 2020 2020  n polygon.      
+000098c0: 2020 656c 6966 2070 6f69 6e74 732e 6e64    elif points.nd
+000098d0: 696d 203d 3d20 333a 0a20 2020 2020 2020  im == 3:.       
+000098e0: 2020 2020 206c 6179 6572 2c20 6461 7461       layer, data
+000098f0: 7479 7065 203d 205f 7061 7273 655f 6c61  type = _parse_la
+00009900: 7965 7228 6c61 7965 7229 0a0a 2020 2020  yer(layer)..    
+00009910: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
+00009920: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00009930: 2020 666f 7220 706f 6c79 676f 6e5f 706f    for polygon_po
+00009940: 696e 7473 2069 6e20 706f 696e 7473 3a0a  ints in points:.
+00009950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009960: 706f 6c79 676f 6e20 3d20 506f 6c79 676f  polygon = Polygo
+00009970: 6e28 706f 6c79 676f 6e5f 706f 696e 7473  n(polygon_points
+00009980: 2c20 286c 6179 6572 2c20 6461 7461 7479  , (layer, dataty
+00009990: 7065 2929 0a20 2020 2020 2020 2020 2020  pe)).           
+000099a0: 2020 2020 2069 6620 706f 6c79 676f 6e2e       if polygon.
+000099b0: 6172 6561 2829 203e 2030 3a0a 2020 2020  area() > 0:.    
+000099c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099d0: 706f 6c79 676f 6e73 2e61 7070 656e 6428  polygons.append(
+000099e0: 706f 6c79 676f 6e29 0a0a 2020 2020 2020  polygon)..      
+000099f0: 2020 2020 2020 7365 6c66 2e5f 6164 645f        self._add_
+00009a00: 706f 6c79 676f 6e73 282a 706f 6c79 676f  polygons(*polygo
+00009a10: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
+00009a20: 7265 7475 726e 2070 6f6c 7967 6f6e 730a  return polygons.
+00009a30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00009a40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00009a50: 5661 6c75 6545 7272 6f72 2866 2255 6e61  ValueError(f"Una
+00009a60: 626c 6520 746f 2061 6464 207b 706f 696e  ble to add {poin
+00009a70: 7473 2e6e 6469 6d7d 2d64 696d 656e 7369  ts.ndim}-dimensi
+00009a80: 6f6e 616c 2070 6f69 6e74 7320 6f62 6a65  onal points obje
+00009a90: 6374 2229 0a0a 2020 2020 6465 6620 5f61  ct")..    def _a
+00009aa0: 6464 5f70 6f6c 7967 6f6e 5f73 6861 7065  dd_polygon_shape
+00009ab0: 6c79 2873 656c 662c 206c 6179 6572 2c20  ly(self, layer, 
+00009ac0: 706f 696e 7473 293a 0a20 2020 2020 2020  points):.       
+00009ad0: 206c 6179 6572 2c20 6461 7461 7479 7065   layer, datatype
+00009ae0: 203d 205f 7061 7273 655f 6c61 7965 7228   = _parse_layer(
+00009af0: 6c61 7965 7229 0a20 2020 2020 2020 2070  layer).        p
+00009b00: 6f69 6e74 735f 6f6e 5f67 7269 6420 3d20  oints_on_grid = 
+00009b10: 736e 6170 5f74 6f5f 6772 6964 2870 6f69  snap_to_grid(poi
+00009b20: 6e74 732e 6578 7465 7269 6f72 2e63 6f6f  nts.exterior.coo
+00009b30: 7264 7329 0a20 2020 2020 2020 2070 6f6c  rds).        pol
+00009b40: 7967 6f6e 203d 2050 6f6c 7967 6f6e 2870  ygon = Polygon(p
+00009b50: 6f69 6e74 735f 6f6e 5f67 7269 642c 2028  oints_on_grid, (
+00009b60: 6c61 7965 722c 2064 6174 6174 7970 6529  layer, datatype)
+00009b70: 290a 0a20 2020 2020 2020 2069 6620 706f  )..        if po
+00009b80: 696e 7473 2e69 6e74 6572 696f 7273 3a0a  ints.interiors:.
+00009b90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00009ba0: 726e 2073 656c 662e 5f61 6464 5f70 6f6c  rn self._add_pol
+00009bb0: 7967 6f6e 5f73 6861 7065 6c79 5f77 6974  ygon_shapely_wit
+00009bc0: 685f 686f 6c65 7328 0a20 2020 2020 2020  h_holes(.       
+00009bd0: 2020 2020 2020 2020 2070 6f69 6e74 732c           points,
+00009be0: 206c 6179 6572 2c20 6461 7461 7479 7065   layer, datatype
+00009bf0: 2c20 706f 6c79 676f 6e0a 2020 2020 2020  , polygon.      
+00009c00: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00009c10: 7365 6c66 2e5f 6164 645f 706f 6c79 676f  self._add_polygo
+00009c20: 6e73 2870 6f6c 7967 6f6e 290a 2020 2020  ns(polygon).    
+00009c30: 2020 2020 7265 7475 726e 2070 6f6c 7967      return polyg
+00009c40: 6f6e 0a0a 2020 2020 6465 6620 5f61 6464  on..    def _add
+00009c50: 5f70 6f6c 7967 6f6e 5f73 6861 7065 6c79  _polygon_shapely
+00009c60: 5f77 6974 685f 686f 6c65 7328 7365 6c66  _with_holes(self
+00009c70: 2c20 706f 696e 7473 2c20 6c61 7965 722c  , points, layer,
+00009c80: 2064 6174 6174 7970 652c 2070 6f6c 7967   datatype, polyg
+00009c90: 6f6e 293a 0a20 2020 2020 2020 2066 726f  on):.        fro
+00009ca0: 6d20 7368 6170 656c 7920 696d 706f 7274  m shapely import
+00009cb0: 2067 6574 5f63 6f6f 7264 696e 6174 6573   get_coordinates
+00009cc0: 0a0a 2020 2020 2020 2020 706f 696e 7473  ..        points
+00009cd0: 5f6f 6e5f 6772 6964 5f69 6e74 6572 696f  _on_grid_interio
+00009ce0: 7220 3d20 6e70 2e72 6f75 6e64 2867 6574  r = np.round(get
+00009cf0: 5f63 6f6f 7264 696e 6174 6573 2870 6f69  _coordinates(poi
+00009d00: 6e74 732e 696e 7465 7269 6f72 7329 2c20  nts.interiors), 
+00009d10: 3329 0a20 2020 2020 2020 2070 6f6c 7967  3).        polyg
+00009d20: 6f6e 5f69 6e74 6572 696f 7220 3d20 506f  on_interior = Po
+00009d30: 6c79 676f 6e28 706f 696e 7473 5f6f 6e5f  lygon(points_on_
+00009d40: 6772 6964 5f69 6e74 6572 696f 722c 2028  grid_interior, (
+00009d50: 6c61 7965 722c 2064 6174 6174 7970 6529  layer, datatype)
+00009d60: 290a 2020 2020 2020 2020 706f 6c79 676f  ).        polygo
+00009d70: 6e73 203d 2067 6473 746b 2e62 6f6f 6c65  ns = gdstk.boole
+00009d80: 616e 280a 2020 2020 2020 2020 2020 2020  an(.            
+00009d90: 706f 6c79 676f 6e2c 0a20 2020 2020 2020  polygon,.       
+00009da0: 2020 2020 2070 6f6c 7967 6f6e 5f69 6e74       polygon_int
+00009db0: 6572 696f 722c 0a20 2020 2020 2020 2020  erior,.         
+00009dc0: 2020 206f 7065 7261 7469 6f6e 3d22 6e6f     operation="no
+00009dd0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+00009de0: 6c61 7965 723d 6c61 7965 722c 0a20 2020  layer=layer,.   
+00009df0: 2020 2020 2020 2020 2064 6174 6174 7970           datatyp
+00009e00: 653d 6461 7461 7479 7065 2c0a 2020 2020  e=datatype,.    
+00009e10: 2020 2020 290a 2020 2020 2020 2020 666f      ).        fo
+00009e20: 7220 706f 6c79 676f 6e20 696e 2070 6f6c  r polygon in pol
+00009e30: 7967 6f6e 733a 0a20 2020 2020 2020 2020  ygons:.         
+00009e40: 2020 2069 6620 706f 6c79 676f 6e2e 6172     if polygon.ar
+00009e50: 6561 2829 203e 2030 3a0a 2020 2020 2020  ea() > 0:.      
+00009e60: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00009e70: 6164 645f 706f 6c79 676f 6e73 2870 6f6c  add_polygons(pol
+00009e80: 7967 6f6e 290a 2020 2020 2020 2020 7265  ygon).        re
+00009e90: 7475 726e 2070 6f6c 7967 6f6e 0a0a 2020  turn polygon..  
+00009ea0: 2020 6465 6620 5f61 6464 5f70 6f6c 7967    def _add_polyg
+00009eb0: 6f6e 7328 7365 6c66 2c20 2a70 6f6c 7967  ons(self, *polyg
+00009ec0: 6f6e 733a 206c 6973 745b 506f 6c79 676f  ons: list[Polygo
+00009ed0: 6e5d 2920 2d3e 204e 6f6e 653a 0a20 2020  n]) -> None:.   
+00009ee0: 2020 2020 2073 656c 662e 6973 5f75 6e6c       self.is_unl
+00009ef0: 6f63 6b65 6428 290a 2020 2020 2020 2020  ocked().        
+00009f00: 7365 6c66 2e5f 6365 6c6c 2e61 6464 282a  self._cell.add(*
+00009f10: 706f 6c79 676f 6e73 290a 0a20 2020 2064  polygons)..    d
+00009f20: 6566 2063 6f70 7928 7365 6c66 2920 2d3e  ef copy(self) ->
+00009f30: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
+00009f40: 2020 2020 7265 7475 726e 2063 6f70 7928      return copy(
+00009f50: 7365 6c66 290a 0a20 2020 2064 6566 2061  self)..    def a
+00009f60: 6464 5f72 6566 5f63 6f6e 7461 696e 6572  dd_ref_container
+00009f70: 2873 656c 662c 2063 6f6d 706f 6e65 6e74  (self, component
+00009f80: 3a20 436f 6d70 6f6e 656e 7429 202d 3e20  : Component) -> 
+00009f90: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
+00009fa0: 6365 3a0a 2020 2020 2020 2020 2222 2241  ce:.        """A
+00009fb0: 6464 2072 6566 6572 656e 6365 2c20 706f  dd reference, po
+00009fc0: 7274 7320 616e 6420 636f 7079 5f63 6869  rts and copy_chi
+00009fd0: 6c64 5f69 6e66 6f2e 2222 220a 2020 2020  ld_info.""".    
+00009fe0: 2020 2020 7265 6620 3d20 7365 6c66 203c      ref = self <
+00009ff0: 3c20 636f 6d70 6f6e 656e 740a 2020 2020  < component.    
+0000a000: 2020 2020 7365 6c66 2e61 6464 5f70 6f72      self.add_por
+0000a010: 7473 2872 6566 2e70 6f72 7473 290a 2020  ts(ref.ports).  
+0000a020: 2020 2020 2020 7365 6c66 2e63 6f70 795f        self.copy_
+0000a030: 6368 696c 645f 696e 666f 2863 6f6d 706f  child_info(compo
+0000a040: 6e65 6e74 290a 2020 2020 2020 2020 7265  nent).        re
+0000a050: 7475 726e 2072 6566 0a0a 2020 2020 6465  turn ref..    de
+0000a060: 6620 636f 7079 5f63 6869 6c64 5f69 6e66  f copy_child_inf
+0000a070: 6f28 7365 6c66 2c20 636f 6d70 6f6e 656e  o(self, componen
+0000a080: 743a 2043 6f6d 706f 6e65 6e74 2920 2d3e  t: Component) ->
+0000a090: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+0000a0a0: 2222 436f 7079 2061 6e64 2073 6574 7469  ""Copy and setti
+0000a0b0: 6e67 7320 696e 666f 2066 726f 6d20 6368  ngs info from ch
+0000a0c0: 696c 6420 636f 6d70 6f6e 656e 7420 696e  ild component in
+0000a0d0: 746f 2070 6172 656e 742e 0a0a 2020 2020  to parent...    
+0000a0e0: 2020 2020 5061 7265 6e74 2063 6f6d 706f      Parent compo
+0000a0f0: 6e65 6e74 7320 6361 6e20 6163 6365 7373  nents can access
+0000a100: 2063 6869 6c64 2063 656c 6c73 2073 6574   child cells set
+0000a110: 7469 6e67 732e 0a20 2020 2020 2020 2022  tings..        "
+0000a120: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+0000a130: 7420 6973 696e 7374 616e 6365 2863 6f6d  t isinstance(com
+0000a140: 706f 6e65 6e74 2c20 436f 6d70 6f6e 656e  ponent, Componen
+0000a150: 7420 7c20 436f 6d70 6f6e 656e 7452 6566  t | ComponentRef
+0000a160: 6572 656e 6365 293a 0a20 2020 2020 2020  erence):.       
+0000a170: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000a180: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0000a190: 2020 2020 2020 2066 227b 7479 7065 2863         f"{type(c
+0000a1a0: 6f6d 706f 6e65 6e74 297d 2220 2269 7320  omponent)}" "is 
+0000a1b0: 6e6f 7420 6120 436f 6d70 6f6e 656e 7420  not a Component 
+0000a1c0: 6f72 2043 6f6d 706f 6e65 6e74 5265 6665  or ComponentRefe
+0000a1d0: 7265 6e63 6522 0a20 2020 2020 2020 2020  rence".         
+0000a1e0: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
+0000a1f0: 6c66 2e63 6869 6c64 203d 2063 6f6d 706f  lf.child = compo
+0000a200: 6e65 6e74 0a20 2020 2020 2020 2066 6f72  nent.        for
+0000a210: 206b 2c20 7620 696e 2064 6963 7428 636f   k, v in dict(co
+0000a220: 6d70 6f6e 656e 742e 696e 666f 292e 6974  mponent.info).it
+0000a230: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0000a240: 2020 2069 6620 6b20 6e6f 7420 696e 2073     if k not in s
+0000a250: 656c 662e 696e 666f 3a0a 2020 2020 2020  elf.info:.      
+0000a260: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0000a270: 6e66 6f5b 6b5d 203d 2076 0a0a 2020 2020  nfo[k] = v..    
+0000a280: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+0000a290: 6620 7369 7a65 5f69 6e66 6f28 7365 6c66  f size_info(self
+0000a2a0: 2920 2d3e 2053 697a 6549 6e66 6f3a 0a20  ) -> SizeInfo:. 
+0000a2b0: 2020 2020 2020 2022 2222 5369 7a65 2069         """Size i
+0000a2c0: 6e66 6f20 6f66 2074 6865 2063 6f6d 706f  nfo of the compo
+0000a2d0: 6e65 6e74 2e22 2222 0a20 2020 2020 2020  nent.""".       
+0000a2e0: 2072 6574 7572 6e20 5369 7a65 496e 666f   return SizeInfo
+0000a2f0: 2873 656c 662e 6262 6f78 290a 0a20 2020  (self.bbox)..   
+0000a300: 2064 6566 2069 735f 756e 6c6f 636b 6564   def is_unlocked
+0000a310: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000a320: 2020 2020 2020 2020 2222 2252 6169 7365          """Raise
+0000a330: 7320 7761 726e 696e 6720 6966 2043 6f6d  s warning if Com
+0000a340: 706f 6e65 6e74 2069 7320 6c6f 636b 6564  ponent is locked
+0000a350: 2e22 2222 0a20 2020 2020 2020 2069 6620  .""".        if 
+0000a360: 7365 6c66 2e5f 6c6f 636b 6564 3a0a 2020  self._locked:.  
+0000a370: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
+0000a380: 6520 3d20 280a 2020 2020 2020 2020 2020  e = (.          
+0000a390: 2020 2020 2020 6622 436f 6d70 6f6e 656e        f"Componen
+0000a3a0: 7420 7b73 656c 662e 6e61 6d65 2172 7d20  t {self.name!r} 
+0000a3b0: 6973 2064 616e 6765 726f 7573 2074 6f20  is dangerous to 
+0000a3c0: 6d6f 6469 6679 2061 7320 6974 2773 2061  modify as it's a
+0000a3d0: 6c72 6561 6479 2022 0a20 2020 2020 2020  lready ".       
+0000a3e0: 2020 2020 2020 2020 2022 6f6e 2063 6163           "on cac
+0000a3f0: 6865 2061 6e64 2077 696c 6c20 6368 616e  he and will chan
+0000a400: 6765 2061 6c6c 206f 6620 6974 7320 7265  ge all of its re
+0000a410: 6665 7265 6e63 6573 2e20 220a 2020 2020  ferences. ".    
+0000a420: 2020 2020 2020 2020 2020 2020 2b20 6d75              + mu
+0000a430: 7461 6269 6c69 7479 5f65 7272 6f72 5f6d  tability_error_m
+0000a440: 6573 7361 6765 0a20 2020 2020 2020 2020  essage.         
+0000a450: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000a460: 2069 6620 434f 4e46 2e72 6169 7365 5f65   if CONF.raise_e
+0000a470: 7272 6f72 5f6f 6e5f 6d75 7461 7469 6f6e  rror_on_mutation
+0000a480: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a490: 2020 7261 6973 6520 4d75 7461 6269 6c69    raise Mutabili
+0000a4a0: 7479 4572 726f 7228 6d65 7373 6167 6529  tyError(message)
+0000a4b0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000a4c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000a4d0: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
+0000a4e0: 286d 6573 7361 6765 290a 0a20 2020 2064  (message)..    d
+0000a4f0: 6566 205f 6164 6428 7365 6c66 2c20 656c  ef _add(self, el
+0000a500: 656d 656e 7429 202d 3e20 4e6f 6e65 3a0a  ement) -> None:.
+0000a510: 2020 2020 2020 2020 2222 2241 6464 2061          """Add a
+0000a520: 206e 6577 2065 6c65 6d65 6e74 206f 7220   new element or 
+0000a530: 6c69 7374 206f 6620 656c 656d 656e 7473  list of elements
+0000a540: 2074 6f20 7468 6973 2043 6f6d 706f 6e65   to this Compone
+0000a550: 6e74 2e0a 0a20 2020 2020 2020 2041 7267  nt...        Arg
+0000a560: 733a 0a20 2020 2020 2020 2020 2020 2065  s:.            e
+0000a570: 6c65 6d65 6e74 3a20 506f 6c79 676f 6e2c  lement: Polygon,
+0000a580: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
+0000a590: 6e63 6520 6f72 2069 7465 7261 626c 650a  nce or iterable.
+0000a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5b0: 5468 6520 656c 656d 656e 7420 6f72 2069  The element or i
+0000a5c0: 7465 7261 626c 6520 6f66 2065 6c65 6d65  terable of eleme
+0000a5d0: 6e74 7320 746f 2062 6520 696e 7365 7274  nts to be insert
+0000a5e0: 6564 2069 6e20 7468 6973 2063 656c 6c2e  ed in this cell.
+0000a5f0: 0a0a 2020 2020 2020 2020 5261 6973 6573  ..        Raises
+0000a600: 3a0a 2020 2020 2020 2020 2020 2020 4d75  :.            Mu
+0000a610: 7461 6269 6c69 7479 4572 726f 723a 2069  tabilityError: i
+0000a620: 6620 636f 6d70 6f6e 656e 7420 6973 206c  f component is l
+0000a630: 6f63 6b65 642e 0a20 2020 2020 2020 2022  ocked..        "
+0000a640: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+0000a650: 6973 5f75 6e6c 6f63 6b65 6428 290a 2020  is_unlocked().  
+0000a660: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000a670: 6e63 6528 656c 656d 656e 742c 2043 6f6d  nce(element, Com
+0000a680: 706f 6e65 6e74 5265 6665 7265 6e63 6529  ponentReference)
+0000a690: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000a6a0: 6c66 2e5f 6365 6c6c 2e61 6464 2865 6c65  lf._cell.add(ele
+0000a6b0: 6d65 6e74 2e5f 7265 6665 7265 6e63 6529  ment._reference)
+0000a6c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000a6d0: 662e 5f72 6566 6572 656e 6365 732e 6170  f._references.ap
+0000a6e0: 7065 6e64 2865 6c65 6d65 6e74 290a 2020  pend(element).  
+0000a6f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000a700: 2020 2020 2020 2020 7365 6c66 2e5f 6365          self._ce
+0000a710: 6c6c 2e61 6464 2865 6c65 6d65 6e74 290a  ll.add(element).
+0000a720: 0a20 2020 2064 6566 2061 6464 2873 656c  .    def add(sel
+0000a730: 662c 2065 6c65 6d65 6e74 2920 2d3e 204e  f, element) -> N
+0000a740: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000a750: 4164 6420 6120 6e65 7720 656c 656d 656e  Add a new elemen
+0000a760: 7420 6f72 206c 6973 7420 6f66 2065 6c65  t or list of ele
+0000a770: 6d65 6e74 7320 746f 2074 6869 7320 436f  ments to this Co
+0000a780: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
+0000a790: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+0000a7a0: 2020 2020 656c 656d 656e 743a 2050 6f6c      element: Pol
+0000a7b0: 7967 6f6e 2c20 436f 6d70 6f6e 656e 7452  ygon, ComponentR
+0000a7c0: 6566 6572 656e 6365 206f 7220 6974 6572  eference or iter
+0000a7d0: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
+0000a7e0: 2020 2020 2054 6865 2065 6c65 6d65 6e74       The element
+0000a7f0: 206f 7220 6974 6572 6162 6c65 206f 6620   or iterable of 
+0000a800: 656c 656d 656e 7473 2074 6f20 6265 2069  elements to be i
+0000a810: 6e73 6572 7465 6420 696e 2074 6869 7320  nserted in this 
+0000a820: 6365 6c6c 2e0a 0a20 2020 2020 2020 2052  cell...        R
+0000a830: 6169 7365 733a 0a20 2020 2020 2020 2020  aises:.         
+0000a840: 2020 204d 7574 6162 696c 6974 7945 7272     MutabilityErr
+0000a850: 6f72 3a20 6966 2063 6f6d 706f 6e65 6e74  or: if component
+0000a860: 2069 7320 6c6f 636b 6564 2e0a 2020 2020   is locked..    
+0000a870: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000a880: 6966 2069 7369 6e73 7461 6e63 6528 656c  if isinstance(el
+0000a890: 656d 656e 742c 2043 6f6d 706f 6e65 6e74  ement, Component
+0000a8a0: 5265 6665 7265 6e63 6529 3a0a 2020 2020  Reference):.    
+0000a8b0: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
+0000a8c0: 6769 7374 6572 5f72 6566 6572 656e 6365  gister_reference
+0000a8d0: 2865 6c65 6d65 6e74 290a 2020 2020 2020  (element).      
+0000a8e0: 2020 2020 2020 7365 6c66 2e5f 6164 6428        self._add(
+0000a8f0: 656c 656d 656e 7429 0a20 2020 2020 2020  element).       
+0000a900: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+0000a910: 2865 6c65 6d65 6e74 2c20 4974 6572 6162  (element, Iterab
+0000a920: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+0000a930: 2066 6f72 2073 7562 656c 656d 656e 7420   for subelement 
+0000a940: 696e 2065 6c65 6d65 6e74 3a0a 2020 2020  in element:.    
+0000a950: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000a960: 2e61 6464 2873 7562 656c 656d 656e 7429  .add(subelement)
+0000a970: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000a980: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000a990: 5f61 6464 2865 6c65 6d65 6e74 290a 0a20  _add(element).. 
+0000a9a0: 2020 2064 6566 2061 6464 5f61 7272 6179     def add_array
+0000a9b0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0000a9c0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+0000a9d0: 743a 2043 6f6d 706f 6e65 6e74 2c0a 2020  t: Component,.  
+0000a9e0: 2020 2020 2020 636f 6c75 6d6e 733a 2069        columns: i
+0000a9f0: 6e74 203d 2032 2c0a 2020 2020 2020 2020  nt = 2,.        
+0000aa00: 726f 7773 3a20 696e 7420 3d20 322c 0a20  rows: int = 2,. 
+0000aa10: 2020 2020 2020 2073 7061 6369 6e67 3a20         spacing: 
+0000aa20: 7475 706c 655b 666c 6f61 742c 2066 6c6f  tuple[float, flo
+0000aa30: 6174 5d20 3d20 2831 3030 2c20 3130 3029  at] = (100, 100)
+0000aa40: 2c0a 2020 2020 2020 2020 616c 6961 733a  ,.        alias:
+0000aa50: 2073 7472 207c 204e 6f6e 6520 3d20 4e6f   str | None = No
+0000aa60: 6e65 2c0a 2020 2020 2920 2d3e 2043 6f6d  ne,.    ) -> Com
+0000aa70: 706f 6e65 6e74 5265 6665 7265 6e63 653a  ponentReference:
+0000aa80: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
+0000aa90: 7465 7320 6120 436f 6d70 6f6e 656e 7452  tes a ComponentR
+0000aaa0: 6566 6572 656e 6365 2072 6566 6572 656e  eference referen
+0000aab0: 6365 2074 6f20 6120 436f 6d70 6f6e 656e  ce to a Componen
+0000aac0: 742e 0a0a 2020 2020 2020 2020 4172 6773  t...        Args
+0000aad0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+0000aae0: 6d70 6f6e 656e 743a 2054 6865 2072 6566  mponent: The ref
+0000aaf0: 6572 656e 6365 6420 636f 6d70 6f6e 656e  erenced componen
+0000ab00: 742e 0a20 2020 2020 2020 2020 2020 2063  t..            c
+0000ab10: 6f6c 756d 6e73 3a20 4e75 6d62 6572 206f  olumns: Number o
+0000ab20: 6620 636f 6c75 6d6e 7320 696e 2074 6865  f columns in the
+0000ab30: 2061 7272 6179 2e0a 2020 2020 2020 2020   array..        
+0000ab40: 2020 2020 726f 7773 3a20 4e75 6d62 6572      rows: Number
+0000ab50: 206f 6620 726f 7773 2069 6e20 7468 6520   of rows in the 
+0000ab60: 6172 7261 792e 0a20 2020 2020 2020 2020  array..         
+0000ab70: 2020 2073 7061 6369 6e67 3a20 6172 7261     spacing: arra
+0000ab80: 792d 6c69 6b65 5b32 5d20 6f66 2069 6e74  y-like[2] of int
+0000ab90: 206f 7220 666c 6f61 742e 0a20 2020 2020   or float..     
+0000aba0: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
+0000abb0: 6e63 6520 6265 7477 6565 6e20 6164 6a61  nce between adja
+0000abc0: 6365 6e74 2063 6f6c 756d 6e73 2061 6e64  cent columns and
+0000abd0: 2061 646a 6163 656e 7420 726f 7773 2e0a   adjacent rows..
+0000abe0: 2020 2020 2020 2020 2020 2020 616c 6961              alia
+0000abf0: 733a 2073 7472 206f 7220 4e6f 6e65 2e20  s: str or None. 
+0000ac00: 416c 6961 7320 6f66 2074 6865 2072 6566  Alias of the ref
+0000ac10: 6572 656e 6365 6420 436f 6d70 6f6e 656e  erenced Componen
+0000ac20: 742e 0a0a 2020 2020 2020 2020 5265 7475  t...        Retu
+0000ac30: 726e 730a 2020 2020 2020 2020 2020 2020  rns.            
+0000ac40: 613a 2043 6f6d 706f 6e65 6e74 5265 6665  a: ComponentRefe
+0000ac50: 7265 6e63 6520 636f 6e74 6169 6e69 6e67  rence containing
+0000ac60: 2072 6566 6572 656e 6365 7320 746f 2074   references to t
+0000ac70: 6865 2043 6f6d 706f 6e65 6e74 2e0a 2020  he Component..  
+0000ac80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000ac90: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0000aca0: 6e63 6528 636f 6d70 6f6e 656e 742c 2043  nce(component, C
+0000acb0: 6f6d 706f 6e65 6e74 293a 0a20 2020 2020  omponent):.     
+0000acc0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+0000acd0: 6545 7272 6f72 2822 6164 645f 6172 7261  eError("add_arra
+0000ace0: 7928 2920 6e65 6564 7320 6120 436f 6d70  y() needs a Comp
+0000acf0: 6f6e 656e 7420 6f62 6a65 6374 2e22 290a  onent object.").
+0000ad00: 2020 2020 2020 2020 7265 6620 3d20 436f          ref = Co
+0000ad10: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
+0000ad20: 280a 2020 2020 2020 2020 2020 2020 636f  (.            co
+0000ad30: 6d70 6f6e 656e 743d 636f 6d70 6f6e 656e  mponent=componen
+0000ad40: 742c 0a20 2020 2020 2020 2020 2020 2063  t,.            c
+0000ad50: 6f6c 756d 6e73 3d69 6e74 2872 6f75 6e64  olumns=int(round
+0000ad60: 2863 6f6c 756d 6e73 2929 2c0a 2020 2020  (columns)),.    
+0000ad70: 2020 2020 2020 2020 726f 7773 3d69 6e74          rows=int
+0000ad80: 2872 6f75 6e64 2872 6f77 7329 292c 0a20  (round(rows)),. 
+0000ad90: 2020 2020 2020 2020 2020 2073 7061 6369             spaci
+0000ada0: 6e67 3d73 7061 6369 6e67 2c0a 2020 2020  ng=spacing,.    
+0000adb0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+0000adc0: 662e 6e61 6d65 203d 204e 6f6e 650a 2020  f.name = None.  
+0000add0: 2020 2020 2020 7365 6c66 2e5f 6164 6428        self._add(
+0000ade0: 7265 6629 0a20 2020 2020 2020 2073 656c  ref).        sel
+0000adf0: 662e 5f72 6567 6973 7465 725f 7265 6665  f._register_refe
+0000ae00: 7265 6e63 6528 7265 6665 7265 6e63 653d  rence(reference=
+0000ae10: 7265 662c 2061 6c69 6173 3d61 6c69 6173  ref, alias=alias
+0000ae20: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000ae30: 2072 6566 0a0a 2020 2020 6465 6620 6469   ref..    def di
+0000ae40: 7374 7269 6275 7465 280a 2020 2020 2020  stribute(.      
+0000ae50: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0000ae60: 656c 656d 656e 7473 3a20 7374 7220 3d20  elements: str = 
+0000ae70: 2261 6c6c 222c 0a20 2020 2020 2020 2064  "all",.        d
+0000ae80: 6972 6563 7469 6f6e 3a20 7374 7220 3d20  irection: str = 
+0000ae90: 2278 222c 0a20 2020 2020 2020 2073 7061  "x",.        spa
+0000aea0: 6369 6e67 3a20 666c 6f61 7420 3d20 3130  cing: float = 10
+0000aeb0: 302e 302c 0a20 2020 2020 2020 2073 6570  0.0,.        sep
+0000aec0: 6172 6174 696f 6e3a 2062 6f6f 6c20 3d20  aration: bool = 
+0000aed0: 5472 7565 2c0a 2020 2020 2020 2020 6564  True,.        ed
+0000aee0: 6765 3a20 7374 7220 3d20 2263 656e 7465  ge: str = "cente
+0000aef0: 7222 2c0a 2020 2020 2920 2d3e 2043 6f6d  r",.    ) -> Com
+0000af00: 706f 6e65 6e74 3a0a 2020 2020 2020 2020  ponent:.        
+0000af10: 2222 2244 6973 7472 6962 7574 6573 2074  """Distributes t
+0000af20: 6865 2073 7065 6369 6669 6564 2065 6c65  he specified ele
+0000af30: 6d65 6e74 7320 696e 2074 6865 2043 6f6d  ments in the Com
+0000af40: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
+0000af50: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+0000af60: 2020 2065 6c65 6d65 6e74 733a 2061 7272     elements: arr
+0000af70: 6179 2d6c 696b 6520 6f66 206f 626a 6563  ay-like of objec
+0000af80: 7473 206f 7220 2761 6c6c 272e 2045 6c65  ts or 'all'. Ele
+0000af90: 6d65 6e74 7320 746f 2064 6973 7472 6962  ments to distrib
+0000afa0: 7574 652e 0a20 2020 2020 2020 2020 2020  ute..           
+0000afb0: 2064 6972 6563 7469 6f6e 3a20 7b27 7827   direction: {'x'
+0000afc0: 2c20 2779 277d 2044 6972 6563 7469 6f6e  , 'y'} Direction
+0000afd0: 206f 6620 6469 7374 7269 6275 7469 6f6e   of distribution
+0000afe0: 3b20 6569 7468 6572 2061 206c 696e 6520  ; either a line 
+0000aff0: 696e 2074 6865 2078 2d64 6972 6563 7469  in the x-directi
+0000b000: 6f6e 206f 7220 792d 6469 7265 6374 696f  on or y-directio
+0000b010: 6e2e 0a20 2020 2020 2020 2020 2020 2073  n..            s
+0000b020: 7061 6369 6e67 2020 696e 7420 6f72 2066  pacing  int or f
+0000b030: 6c6f 6174 2e20 4469 7374 616e 6365 2062  loat. Distance b
+0000b040: 6574 7765 656e 2065 6c65 6d65 6e74 732e  etween elements.
+0000b050: 0a20 2020 2020 2020 2020 2020 2073 6570  .            sep
+0000b060: 6172 6174 696f 6e3a 2062 6f6f 6c2e 2049  aration: bool. I
+0000b070: 6620 5472 7565 2c20 6775 6172 616e 7465  f True, guarante
+0000b080: 6573 2065 6c65 6d65 6e74 7320 6172 6520  es elements are 
+0000b090: 7365 7061 7261 7465 6420 7769 7468 2061  separated with a
+0000b0a0: 2066 6978 6564 2073 7061 6369 6e67 0a20   fixed spacing. 
+0000b0b0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000b0c0: 6574 7765 656e 3b20 6966 2020 4661 6c73  etween; if  Fals
+0000b0d0: 652c 2065 6c65 6d65 6e74 7320 6172 6520  e, elements are 
+0000b0e0: 7370 6163 6564 2065 7665 6e6c 7920 616c  spaced evenly al
+0000b0f0: 6f6e 6720 6120 6772 6964 2e0a 2020 2020  ong a grid..    
+0000b100: 2020 2020 2020 2020 6564 6765 3a20 7b27          edge: {'
+0000b110: 7827 2c20 2778 6d69 6e27 2c20 2778 6d61  x', 'xmin', 'xma
+0000b120: 7827 2c20 2779 272c 2027 796d 696e 272c  x', 'y', 'ymin',
+0000b130: 2027 796d 6178 277d 0a20 2020 2020 2020   'ymax'}.       
+0000b140: 2020 2020 2020 2020 2057 6869 6368 2065           Which e
+0000b150: 6467 6520 746f 2070 6572 666f 726d 2074  dge to perform t
+0000b160: 6865 2064 6973 7472 6962 7574 696f 6e20  he distribution 
+0000b170: 616c 6f6e 6720 2875 6e75 7365 6420 6966  along (unused if
+0000b180: 2073 6570 6172 6174 696f 6e20 3d3d 2054   separation == T
+0000b190: 7275 6529 0a0a 2020 2020 2020 2020 2222  rue)..        ""
+0000b1a0: 220a 2020 2020 2020 2020 6966 2065 6c65  ".        if ele
+0000b1b0: 6d65 6e74 7320 3d3d 2022 616c 6c22 3a0a  ments == "all":.
+0000b1c0: 2020 2020 2020 2020 2020 2020 656c 656d              elem
+0000b1d0: 656e 7473 203d 2073 656c 662e 706f 6c79  ents = self.poly
+0000b1e0: 676f 6e73 202b 2073 656c 662e 7265 6665  gons + self.refe
+0000b1f0: 7265 6e63 6573 0a20 2020 2020 2020 205f  rences.        _
+0000b200: 6469 7374 7269 6275 7465 280a 2020 2020  distribute(.    
+0000b210: 2020 2020 2020 2020 656c 656d 656e 7473          elements
+0000b220: 3d65 6c65 6d65 6e74 732c 0a20 2020 2020  =elements,.     
+0000b230: 2020 2020 2020 2064 6972 6563 7469 6f6e         direction
+0000b240: 3d64 6972 6563 7469 6f6e 2c0a 2020 2020  =direction,.    
+0000b250: 2020 2020 2020 2020 7370 6163 696e 673d          spacing=
+0000b260: 7370 6163 696e 672c 0a20 2020 2020 2020  spacing,.       
+0000b270: 2020 2020 2073 6570 6172 6174 696f 6e3d       separation=
+0000b280: 7365 7061 7261 7469 6f6e 2c0a 2020 2020  separation,.    
+0000b290: 2020 2020 2020 2020 6564 6765 3d65 6467          edge=edg
+0000b2a0: 652c 0a20 2020 2020 2020 2029 0a20 2020  e,.        ).   
+0000b2b0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000b2c0: 0a0a 2020 2020 6465 6620 616c 6967 6e28  ..    def align(
+0000b2d0: 7365 6c66 2c20 656c 656d 656e 7473 3d22  self, elements="
+0000b2e0: 616c 6c22 2c20 616c 6967 6e6d 656e 743a  all", alignment:
+0000b2f0: 2073 7472 203d 2022 796d 6178 2229 202d   str = "ymax") -
+0000b300: 3e20 436f 6d70 6f6e 656e 743a 0a20 2020  > Component:.   
+0000b310: 2020 2020 2022 2222 416c 6967 6e20 656c       """Align el
+0000b320: 656d 656e 7473 2069 6e20 7468 6520 436f  ements in the Co
+0000b330: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
+0000b340: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+0000b350: 2020 2020 656c 656d 656e 7473 203a 2061      elements : a
+0000b360: 7272 6179 2d6c 696b 6520 6f66 206f 626a  rray-like of obj
+0000b370: 6563 7473 2c20 6f72 2027 616c 6c27 0a20  ects, or 'all'. 
+0000b380: 2020 2020 2020 2020 2020 2020 2020 2045                 E
+0000b390: 6c65 6d65 6e74 7320 696e 2074 6865 2043  lements in the C
+0000b3a0: 6f6d 706f 6e65 6e74 2074 6f20 616c 6967  omponent to alig
+0000b3b0: 6e2e 0a20 2020 2020 2020 2020 2020 2061  n..            a
+0000b3c0: 6c69 676e 6d65 6e74 203a 207b 2778 272c  lignment : {'x',
+0000b3d0: 2027 7927 2c20 2778 6d69 6e27 2c20 2778   'y', 'xmin', 'x
+0000b3e0: 6d61 7827 2c20 2779 6d69 6e27 2c20 2779  max', 'ymin', 'y
+0000b3f0: 6d61 7827 7d0a 2020 2020 2020 2020 2020  max'}.          
+0000b400: 2020 2020 2020 5768 6963 6820 6564 6765        Which edge
+0000b410: 2074 6f20 616c 6967 6e20 616c 6f6e 6720   to align along 
+0000b420: 2865 2e67 2e20 2779 6d61 7827 2077 696c  (e.g. 'ymax' wil
+0000b430: 6c20 6d6f 7665 2074 6865 2065 6c65 6d65  l move the eleme
+0000b440: 6e74 7320 7375 6368 0a20 2020 2020 2020  nts such.       
+0000b450: 2020 2020 2020 2020 2074 6861 7420 616c           that al
+0000b460: 6c20 6f66 2074 6865 6972 2074 6f70 6d6f  l of their topmo
+0000b470: 7374 2070 6f69 6e74 7320 6172 6520 616c  st points are al
+0000b480: 6967 6e65 6429 2e0a 2020 2020 2020 2020  igned)..        
+0000b490: 2222 220a 2020 2020 2020 2020 6966 2065  """.        if e
+0000b4a0: 6c65 6d65 6e74 7320 3d3d 2022 616c 6c22  lements == "all"
+0000b4b0: 3a0a 2020 2020 2020 2020 2020 2020 656c  :.            el
+0000b4c0: 656d 656e 7473 203d 2073 656c 662e 706f  ements = self.po
+0000b4d0: 6c79 676f 6e73 202b 2073 656c 662e 7265  lygons + self.re
+0000b4e0: 6665 7265 6e63 6573 0a20 2020 2020 2020  ferences.       
+0000b4f0: 205f 616c 6967 6e28 656c 656d 656e 7473   _align(elements
+0000b500: 2c20 616c 6967 6e6d 656e 743d 616c 6967  , alignment=alig
+0000b510: 6e6d 656e 7429 0a20 2020 2020 2020 2072  nment).        r
+0000b520: 6574 7572 6e20 7365 6c66 0a0a 2020 2020  eturn self..    
+0000b530: 6465 6620 666c 6174 7465 6e28 7365 6c66  def flatten(self
+0000b540: 2c20 7369 6e67 6c65 5f6c 6179 6572 3a20  , single_layer: 
+0000b550: 4c61 7965 7253 7065 6320 7c20 4e6f 6e65  LayerSpec | None
+0000b560: 203d 204e 6f6e 6529 202d 3e20 436f 6d70   = None) -> Comp
+0000b570: 6f6e 656e 743a 0a20 2020 2020 2020 2022  onent:.        "
+0000b580: 2222 5265 7475 726e 7320 6120 666c 6174  ""Returns a flat
+0000b590: 7465 6e65 6420 636f 7079 206f 6620 7468  tened copy of th
+0000b5a0: 6520 636f 6d70 6f6e 656e 742e 0a0a 2020  e component...  
+0000b5b0: 2020 2020 2020 466c 6174 7465 6e73 2074        Flattens t
+0000b5c0: 6865 2068 6965 7261 7263 6879 206f 6620  he hierarchy of 
+0000b5d0: 7468 6520 436f 6d70 6f6e 656e 7420 7375  the Component su
+0000b5e0: 6368 2074 6861 7420 7468 6572 6520 6172  ch that there ar
+0000b5f0: 6520 6e6f 206c 6f6e 6765 720a 2020 2020  e no longer.    
+0000b600: 2020 2020 616e 7920 7265 6665 7265 6e63      any referenc
+0000b610: 6573 2074 6f20 6f74 6865 7220 436f 6d70  es to other Comp
+0000b620: 6f6e 656e 7473 2e20 416c 6c20 706f 6c79  onents. All poly
+0000b630: 676f 6e73 2061 6e64 206c 6162 656c 7320  gons and labels 
+0000b640: 6672 6f6d 0a20 2020 2020 2020 2075 6e64  from.        und
+0000b650: 6572 6c79 696e 6720 7265 6665 7265 6e63  erlying referenc
+0000b660: 6573 2061 7265 2063 6f70 6965 6420 616e  es are copied an
+0000b670: 6420 706c 6163 6564 2069 6e20 7468 6520  d placed in the 
+0000b680: 746f 702d 6c65 7665 6c20 436f 6d70 6f6e  top-level Compon
+0000b690: 656e 742e 0a20 2020 2020 2020 2049 6620  ent..        If 
+0000b6a0: 7369 6e67 6c65 5f6c 6179 6572 2069 7320  single_layer is 
+0000b6b0: 7370 6563 6966 6965 642c 2061 6c6c 2070  specified, all p
+0000b6c0: 6f6c 7967 6f6e 7320 6172 6520 6d6f 7665  olygons are move
+0000b6d0: 6420 746f 2074 6861 7420 6c61 7965 722e  d to that layer.
+0000b6e0: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+0000b6f0: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
+0000b700: 6c65 5f6c 6179 6572 3a20 6d6f 7665 2061  le_layer: move a
+0000b710: 6c6c 2070 6f6c 7967 6f6e 7320 6172 6520  ll polygons are 
+0000b720: 6d6f 7665 6420 746f 2074 6865 2073 7065  moved to the spe
+0000b730: 6369 6669 6564 2028 6f70 7469 6f6e 616c  cified (optional
+0000b740: 292e 0a20 2020 2020 2020 2022 2222 0a20  )..        """. 
+0000b750: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+0000b760: 5f66 6c61 7420 3d20 436f 6d70 6f6e 656e  _flat = Componen
+0000b770: 7428 290a 0a20 2020 2020 2020 205f 6365  t()..        _ce
+0000b780: 6c6c 203d 2073 656c 662e 5f63 656c 6c2e  ll = self._cell.
+0000b790: 636f 7079 286e 616d 653d 636f 6d70 6f6e  copy(name=compon
+0000b7a0: 656e 745f 666c 6174 2e6e 616d 6529 0a20  ent_flat.name). 
+0000b7b0: 2020 2020 2020 205f 6365 6c6c 203d 205f         _cell = _
+0000b7c0: 6365 6c6c 2e66 6c61 7474 656e 2829 0a20  cell.flatten(). 
+0000b7d0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+0000b7e0: 5f66 6c61 742e 5f63 656c 6c20 3d20 5f63  _flat._cell = _c
+0000b7f0: 656c 6c0a 2020 2020 2020 2020 6966 2073  ell.        if s
+0000b800: 696e 676c 655f 6c61 7965 7220 6973 206e  ingle_layer is n
+0000b810: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000b820: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
+0000b830: 746f 7279 2069 6d70 6f72 7420 6765 745f  tory import get_
+0000b840: 6c61 7965 720a 0a20 2020 2020 2020 2020  layer..         
+0000b850: 2020 206c 6179 6572 2c20 6461 7461 7479     layer, dataty
+0000b860: 7065 203d 2067 6574 5f6c 6179 6572 2873  pe = get_layer(s
+0000b870: 696e 676c 655f 6c61 7965 7229 0a20 2020  ingle_layer).   
+0000b880: 2020 2020 2020 2020 2066 6f72 2070 6f6c           for pol
+0000b890: 7967 6f6e 2069 6e20 5f63 656c 6c2e 706f  ygon in _cell.po
+0000b8a0: 6c79 676f 6e73 3a0a 2020 2020 2020 2020  lygons:.        
+0000b8b0: 2020 2020 2020 2020 706f 6c79 676f 6e2e          polygon.
+0000b8c0: 6c61 7965 7220 3d20 6c61 7965 720a 2020  layer = layer.  
+0000b8d0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0000b8e0: 6c79 676f 6e2e 6461 7461 7479 7065 203d  lygon.datatype =
+0000b8f0: 2064 6174 6174 7970 650a 2020 2020 2020   datatype.      
+0000b900: 2020 2020 2020 666f 7220 7061 7468 2069        for path i
+0000b910: 6e20 5f63 656c 6c2e 7061 7468 733a 0a20  n _cell.paths:. 
+0000b920: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000b930: 6174 682e 7365 745f 6c61 7965 7273 286c  ath.set_layers(l
+0000b940: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
+0000b950: 2020 2020 2020 7061 7468 2e73 6574 5f64        path.set_d
+0000b960: 6174 6174 7970 6573 2864 6174 6174 7970  atatypes(datatyp
+0000b970: 6529 0a0a 2020 2020 2020 2020 636f 6d70  e)..        comp
+0000b980: 6f6e 656e 745f 666c 6174 2e63 6f70 795f  onent_flat.copy_
+0000b990: 6368 696c 645f 696e 666f 2873 656c 6629  child_info(self)
+0000b9a0: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
+0000b9b0: 6e74 5f66 6c61 742e 6164 645f 706f 7274  nt_flat.add_port
+0000b9c0: 7328 7365 6c66 2e70 6f72 7473 290a 2020  s(self.ports).  
+0000b9d0: 2020 2020 2020 636f 6d70 6f6e 656e 745f        component_
+0000b9e0: 666c 6174 2e63 6869 6c64 203d 2073 656c  flat.child = sel
+0000b9f0: 662e 6368 696c 640a 2020 2020 2020 2020  f.child.        
+0000ba00: 7265 7475 726e 2063 6f6d 706f 6e65 6e74  return component
+0000ba10: 5f66 6c61 740a 0a20 2020 2064 6566 2066  _flat..    def f
+0000ba20: 6c61 7474 656e 5f72 6566 6572 656e 6365  latten_reference
+0000ba30: 2873 656c 662c 2072 6566 3a20 436f 6d70  (self, ref: Comp
+0000ba40: 6f6e 656e 7452 6566 6572 656e 6365 2920  onentReference) 
+0000ba50: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000ba60: 2022 2222 4672 6f6d 2065 7869 7374 696e   """From existin
+0000ba70: 6720 6365 6c6c 2072 6570 6c61 6365 7320  g cell replaces 
+0000ba80: 7265 6665 7265 6e63 6520 7769 7468 2061  reference with a
+0000ba90: 2066 6c61 7474 656e 2072 6566 6572 656e   flatten referen
+0000baa0: 6365 205c 0a20 2020 2020 2020 2077 6869  ce \.        whi
+0000bab0: 6368 2068 6173 2074 6865 2074 7261 6e73  ch has the trans
+0000bac0: 666f 726d 6174 696f 6e73 2061 6c72 6561  formations alrea
+0000bad0: 6479 2061 7070 6c69 6564 2e0a 0a20 2020  dy applied...   
+0000bae0: 2020 2020 2054 7261 6e73 666f 726d 6564       Transformed
+0000baf0: 2072 6566 6572 656e 6365 206b 6565 7073   reference keeps
+0000bb00: 2074 6865 206f 7269 6769 6e61 6c20 6e61   the original na
+0000bb10: 6d65 2e0a 0a20 2020 2020 2020 2041 7267  me...        Arg
+0000bb20: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+0000bb30: 6566 3a20 7468 6520 7265 6665 7265 6e63  ef: the referenc
+0000bb40: 6520 746f 2066 6c61 7474 656e 2069 6e74  e to flatten int
+0000bb50: 6f20 6120 6e65 7720 6365 6c6c 2e0a 0a20  o a new cell... 
+0000bb60: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000bb70: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000bb80: 7279 2e66 756e 6374 696f 6e73 2069 6d70  ry.functions imp
+0000bb90: 6f72 7420 7472 616e 7366 6f72 6d65 640a  ort transformed.
+0000bba0: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+0000bbb0: 6d6f 7665 2872 6566 290a 2020 2020 2020  move(ref).      
+0000bbc0: 2020 6e65 775f 636f 6d70 6f6e 656e 7420    new_component 
+0000bbd0: 3d20 7472 616e 7366 6f72 6d65 6428 7265  = transformed(re
+0000bbe0: 662c 2064 6563 6f72 6174 6f72 3d4e 6f6e  f, decorator=Non
+0000bbf0: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+0000bc00: 6164 645f 7265 6628 6e65 775f 636f 6d70  add_ref(new_comp
+0000bc10: 6f6e 656e 742c 2061 6c69 6173 3d72 6566  onent, alias=ref
+0000bc20: 2e6e 616d 6529 0a0a 2020 2020 6465 6620  .name)..    def 
+0000bc30: 666c 6174 7465 6e5f 696e 7661 6c69 645f  flatten_invalid_
+0000bc40: 7265 6673 280a 2020 2020 2020 2020 7365  refs(.        se
+0000bc50: 6c66 2c0a 2020 2020 2020 2020 6772 6964  lf,.        grid
+0000bc60: 5f73 697a 653a 2066 6c6f 6174 207c 204e  _size: float | N
+0000bc70: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+0000bc80: 2020 2020 7570 6461 7465 645f 636f 6d70      updated_comp
+0000bc90: 6f6e 656e 7473 3d4e 6f6e 652c 0a20 2020  onents=None,.   
+0000bca0: 2020 2020 2074 7261 7665 7273 6564 5f63       traversed_c
+0000bcb0: 6f6d 706f 6e65 6e74 733d 4e6f 6e65 2c0a  omponents=None,.
+0000bcc0: 2020 2020 2920 2d3e 2043 6f6d 706f 6e65      ) -> Compone
+0000bcd0: 6e74 3a0a 2020 2020 2020 2020 2222 2252  nt:.        """R
+0000bce0: 6574 7572 6e73 206e 6577 2063 6f6d 706f  eturns new compo
+0000bcf0: 6e65 6e74 2077 6974 6820 666c 6174 7465  nent with flatte
+0000bd00: 6e65 6420 7265 6665 7265 6e63 6573 2e0a  ned references..
+0000bd10: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+0000bd20: 2020 2020 2020 2020 2020 2067 7269 645f             grid_
+0000bd30: 7369 7a65 3a20 736e 6170 2074 6f20 6772  size: snap to gr
+0000bd40: 6964 2073 697a 652e 0a20 2020 2020 2020  id size..       
+0000bd50: 2020 2020 2075 7064 6174 6564 5f63 6f6d       updated_com
+0000bd60: 706f 6e65 6e74 733a 2073 6574 206f 6620  ponents: set of 
+0000bd70: 7570 6461 7465 6420 636f 6d70 6f6e 656e  updated componen
+0000bd80: 7473 2e0a 2020 2020 2020 2020 2020 2020  ts..            
+0000bd90: 7472 6176 6572 7365 645f 636f 6d70 6f6e  traversed_compon
+0000bda0: 656e 7473 3a20 7365 7420 6f66 2074 7261  ents: set of tra
+0000bdb0: 7665 7273 6564 2063 6f6d 706f 6e65 6e74  versed component
+0000bdc0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+0000bdd0: 2020 2020 2020 2072 6574 7572 6e20 666c         return fl
+0000bde0: 6174 7465 6e5f 696e 7661 6c69 645f 7265  atten_invalid_re
+0000bdf0: 6673 5f72 6563 7572 7369 7665 280a 2020  fs_recursive(.  
+0000be00: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
+0000be10: 2020 2020 2020 2020 2020 2020 6772 6964              grid
+0000be20: 5f73 697a 653d 6772 6964 5f73 697a 652c  _size=grid_size,
+0000be30: 0a20 2020 2020 2020 2020 2020 2075 7064  .            upd
+0000be40: 6174 6564 5f63 6f6d 706f 6e65 6e74 733d  ated_components=
+0000be50: 7570 6461 7465 645f 636f 6d70 6f6e 656e  updated_componen
+0000be60: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+0000be70: 7472 6176 6572 7365 645f 636f 6d70 6f6e  traversed_compon
+0000be80: 656e 7473 3d74 7261 7665 7273 6564 5f63  ents=traversed_c
+0000be90: 6f6d 706f 6e65 6e74 732c 0a20 2020 2020  omponents,.     
+0000bea0: 2020 2029 0a0a 2020 2020 6465 6620 6164     )..    def ad
+0000beb0: 645f 7265 6628 0a20 2020 2020 2020 2073  d_ref(.        s
+0000bec0: 656c 662c 2063 6f6d 706f 6e65 6e74 3a20  elf, component: 
+0000bed0: 436f 6d70 6f6e 656e 742c 2061 6c69 6173  Component, alias
+0000bee0: 3a20 7374 7220 7c20 4e6f 6e65 203d 204e  : str | None = N
+0000bef0: 6f6e 652c 202a 2a6b 7761 7267 730a 2020  one, **kwargs.  
+0000bf00: 2020 2920 2d3e 2043 6f6d 706f 6e65 6e74    ) -> Component
+0000bf10: 5265 6665 7265 6e63 653a 0a20 2020 2020  Reference:.     
+0000bf20: 2020 2022 2222 4164 6420 436f 6d70 6f6e     """Add Compon
+0000bf30: 656e 7452 6566 6572 656e 6365 2074 6f20  entReference to 
+0000bf40: 7468 6520 6375 7272 656e 7420 436f 6d70  the current Comp
+0000bf50: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
+0000bf60: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+0000bf70: 2020 636f 6d70 6f6e 656e 743a 2043 6f6d    component: Com
+0000bf80: 706f 6e65 6e74 2e0a 2020 2020 2020 2020  ponent..        
+0000bf90: 2020 2020 616c 6961 733a 206e 616d 6564      alias: named
+0000bfa0: 5f72 6566 6572 656e 6365 732e 0a0a 2020  _references...  
+0000bfb0: 2020 2020 2020 4b65 7977 6f72 6420 4172        Keyword Ar
+0000bfc0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+0000bfd0: 636f 6c75 6d6e 733a 204e 756d 6265 7220  columns: Number 
+0000bfe0: 6f66 2063 6f6c 756d 6e73 2069 6e20 7468  of columns in th
+0000bff0: 6520 6172 7261 792e 0a20 2020 2020 2020  e array..       
+0000c000: 2020 2020 2072 6f77 733a 204e 756d 6265       rows: Numbe
+0000c010: 7220 6f66 2072 6f77 7320 696e 2074 6865  r of rows in the
+0000c020: 2061 7272 6179 2e0a 2020 2020 2020 2020   array..        
+0000c030: 2020 2020 7370 6163 696e 673a 2044 6973      spacing: Dis
+0000c040: 7461 6e63 6573 2062 6574 7765 656e 2061  tances between a
+0000c050: 646a 6163 656e 7420 636f 6c75 6d6e 7320  djacent columns 
+0000c060: 616e 6420 6164 6a61 6365 6e74 2072 6f77  and adjacent row
+0000c070: 732e 0a20 2020 2020 2020 2020 2020 206f  s..            o
+0000c080: 7269 6769 6e3a 2061 7272 6179 2d6c 696b  rigin: array-lik
+0000c090: 655b 325d 206f 6620 696e 7420 6f72 2066  e[2] of int or f
+0000c0a0: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+0000c0b0: 2020 2020 2050 6f73 6974 696f 6e20 7768       Position wh
+0000c0c0: 6572 6520 7468 6520 6365 6c6c 2069 7320  ere the cell is 
+0000c0d0: 696e 7365 7274 6564 2e0a 2020 2020 2020  inserted..      
+0000c0e0: 2020 2020 2020 726f 7461 7469 6f6e 203a        rotation :
+0000c0f0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
+0000c100: 2020 2020 2020 2020 2020 2020 2020 416e                An
+0000c110: 676c 6520 6f66 2072 6f74 6174 696f 6e20  gle of rotation 
+0000c120: 6f66 2074 6865 2072 6566 6572 656e 6365  of the reference
+0000c130: 2028 696e 2060 6465 6772 6565 7360 292e   (in `degrees`).
+0000c140: 0a20 2020 2020 2020 2020 2020 206d 6167  .            mag
+0000c150: 6e69 6669 6361 7469 6f6e 203a 2069 6e74  nification : int
+0000c160: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+0000c170: 2020 2020 2020 2020 2020 4d61 676e 6966            Magnif
+0000c180: 6963 6174 696f 6e20 6661 6374 6f72 2066  ication factor f
+0000c190: 6f72 2074 6865 2072 6566 6572 656e 6365  or the reference
+0000c1a0: 2e0a 2020 2020 2020 2020 2020 2020 785f  ..            x_
+0000c1b0: 7265 666c 6563 7469 6f6e 203a 2062 6f6f  reflection : boo
+0000c1c0: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+0000c1d0: 2020 4966 2054 7275 652c 2074 6865 2072    If True, the r
+0000c1e0: 6566 6572 656e 6365 2069 7320 7265 666c  eference is refl
+0000c1f0: 6563 7465 6420 7061 7261 6c6c 656c 2074  ected parallel t
+0000c200: 6f20 7468 6520 7820 6469 7265 6374 696f  o the x directio
+0000c210: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0000c220: 2020 6265 666f 7265 2062 6569 6e67 2072    before being r
+0000c230: 6f74 6174 6564 2e0a 2020 2020 2020 2020  otated..        
+0000c240: 2020 2020 6e61 6d65 203a 2073 7472 2028      name : str (
+0000c250: 6f70 7469 6f6e 616c 290a 2020 2020 2020  optional).      
+0000c260: 2020 2020 2020 2020 2020 4120 6e61 6d65            A name
+0000c270: 2066 6f72 2074 6865 2072 6566 6572 656e   for the referen
+0000c280: 6365 2028 6966 2070 726f 7669 6465 6429  ce (if provided)
+0000c290: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
+0000c2a0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0000c2b0: 696e 7374 616e 6365 2863 6f6d 706f 6e65  instance(compone
+0000c2c0: 6e74 2c20 436f 6d70 6f6e 656e 7429 3a0a  nt, Component):.
+0000c2d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000c2e0: 6520 5479 7065 4572 726f 7228 6622 7479  e TypeError(f"ty
+0000c2f0: 7065 203d 207b 7479 7065 2843 6f6d 706f  pe = {type(Compo
+0000c300: 6e65 6e74 297d 206e 6565 6473 2074 6f20  nent)} needs to 
+0000c310: 6265 2061 2043 6f6d 706f 6e65 6e74 2e22  be a Component."
+0000c320: 290a 2020 2020 2020 2020 7265 6620 3d20  ).        ref = 
+0000c330: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
+0000c340: 6365 2863 6f6d 706f 6e65 6e74 2c20 2a2a  ce(component, **
+0000c350: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+0000c360: 7365 6c66 2e5f 6164 6428 7265 6629 0a20  self._add(ref). 
+0000c370: 2020 2020 2020 2073 656c 662e 5f72 6567         self._reg
+0000c380: 6973 7465 725f 7265 6665 7265 6e63 6528  ister_reference(
+0000c390: 7265 6665 7265 6e63 653d 7265 662c 2061  reference=ref, a
+0000c3a0: 6c69 6173 3d61 6c69 6173 290a 2020 2020  lias=alias).    
+0000c3b0: 2020 2020 7265 7475 726e 2072 6566 0a0a      return ref..
+0000c3c0: 2020 2020 6465 6620 5f72 6567 6973 7465      def _registe
+0000c3d0: 725f 7265 6665 7265 6e63 6528 0a20 2020  r_reference(.   
+0000c3e0: 2020 2020 2073 656c 662c 2072 6566 6572       self, refer
+0000c3f0: 656e 6365 3a20 436f 6d70 6f6e 656e 7452  ence: ComponentR
+0000c400: 6566 6572 656e 6365 2c20 616c 6961 733a  eference, alias:
+0000c410: 2073 7472 207c 204e 6f6e 6520 3d20 4e6f   str | None = No
+0000c420: 6e65 0a20 2020 2029 202d 3e20 4e6f 6e65  ne.    ) -> None
+0000c430: 3a0a 2020 2020 2020 2020 636f 6d70 6f6e  :.        compon
+0000c440: 656e 7420 3d20 7265 6665 7265 6e63 652e  ent = reference.
+0000c450: 7061 7265 6e74 0a20 2020 2020 2020 2072  parent.        r
+0000c460: 6566 6572 656e 6365 2e6f 776e 6572 203d  eference.owner =
+0000c470: 2073 656c 660a 0a20 2020 2020 2020 2069   self..        i
+0000c480: 6620 616c 6961 7320 6973 204e 6f6e 653a  f alias is None:
+0000c490: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000c4a0: 7265 6665 7265 6e63 652e 6e61 6d65 2069  reference.name i
+0000c4b0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000c4c0: 2020 2020 2020 2020 2020 2020 616c 6961              alia
+0000c4d0: 7320 3d20 7265 6665 7265 6e63 652e 6e61  s = reference.na
+0000c4e0: 6d65 0a20 2020 2020 2020 2020 2020 2065  me.            e
+0000c4f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000c500: 2020 2020 2070 7265 6669 7820 3d20 280a       prefix = (.
+0000c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c520: 2020 2020 636f 6d70 6f6e 656e 742e 6675      component.fu
+0000c530: 6e63 7469 6f6e 5f6e 616d 650a 2020 2020  nction_name.    
+0000c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c550: 6966 2063 6f6d 706f 6e65 6e74 2e66 756e  if component.fun
+0000c560: 6374 696f 6e5f 6e61 6d65 0a20 2020 2020  ction_name.     
+0000c570: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000c580: 6c73 6520 636f 6d70 6f6e 656e 742e 6e61  lse component.na
+0000c590: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+0000c5a0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000c5b0: 2020 2020 2073 656c 662e 5f72 6566 6572       self._refer
+0000c5c0: 656e 6365 5f6e 616d 6573 5f63 6f75 6e74  ence_names_count
+0000c5d0: 6572 2e75 7064 6174 6528 7b70 7265 6669  er.update({prefi
+0000c5e0: 783a 2031 7d29 0a20 2020 2020 2020 2020  x: 1}).         
+0000c5f0: 2020 2020 2020 2061 6c69 6173 203d 2066         alias = f
+0000c600: 227b 7072 6566 6978 7d5f 7b73 656c 662e  "{prefix}_{self.
+0000c610: 5f72 6566 6572 656e 6365 5f6e 616d 6573  _reference_names
+0000c620: 5f63 6f75 6e74 6572 5b70 7265 6669 785d  _counter[prefix]
+0000c630: 7d22 0a0a 2020 2020 2020 2020 2020 2020  }"..            
+0000c640: 2020 2020 7768 696c 6520 616c 6961 7320      while alias 
+0000c650: 696e 2073 656c 662e 5f6e 616d 6564 5f72  in self._named_r
+0000c660: 6566 6572 656e 6365 733a 0a20 2020 2020  eferences:.     
+0000c670: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000c680: 656c 662e 5f72 6566 6572 656e 6365 5f6e  elf._reference_n
+0000c690: 616d 6573 5f63 6f75 6e74 6572 2e75 7064  ames_counter.upd
+0000c6a0: 6174 6528 7b70 7265 6669 783a 2031 7d29  ate({prefix: 1})
+0000c6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c6c0: 2020 2020 2061 6c69 6173 203d 2066 227b       alias = f"{
+0000c6d0: 7072 6566 6978 7d5f 7b73 656c 662e 5f72  prefix}_{self._r
+0000c6e0: 6566 6572 656e 6365 5f6e 616d 6573 5f63  eference_names_c
+0000c6f0: 6f75 6e74 6572 5b70 7265 6669 785d 7d22  ounter[prefix]}"
+0000c700: 0a0a 2020 2020 2020 2020 7265 6665 7265  ..        refere
+0000c710: 6e63 652e 6e61 6d65 203d 2061 6c69 6173  nce.name = alias
+0000c720: 0a20 2020 2020 2020 2073 656c 662e 5f6e  .        self._n
+0000c730: 616d 6564 5f72 6566 6572 656e 6365 735b  amed_references[
+0000c740: 616c 6961 735d 203d 2072 6566 6572 656e  alias] = referen
+0000c750: 6365 0a0a 2020 2020 4070 726f 7065 7274  ce..    @propert
+0000c760: 790a 2020 2020 6465 6620 6c61 7965 7273  y.    def layers
+0000c770: 2873 656c 6629 202d 3e20 7365 745b 7475  (self) -> set[tu
+0000c780: 706c 655b 696e 742c 2069 6e74 5d5d 3a0a  ple[int, int]]:.
+0000c790: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+0000c7a0: 6e73 2061 2073 6574 206f 6620 7468 6520  ns a set of the 
+0000c7b0: 4c61 7965 7273 2069 6e20 7468 6520 436f  Layers in the Co
+0000c7c0: 6d70 6f6e 656e 742e 2222 220a 2020 2020  mponent.""".    
+0000c7d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000c7e0: 6765 745f 6c61 7965 7273 2829 0a0a 2020  get_layers()..  
+0000c7f0: 2020 6465 6620 6765 745f 6c61 7965 7273    def get_layers
+0000c800: 2873 656c 6629 202d 3e20 7365 745b 7475  (self) -> set[tu
+0000c810: 706c 655b 696e 742c 2069 6e74 5d5d 3a0a  ple[int, int]]:.
+0000c820: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+0000c830: 6e20 6120 7365 7420 6f66 2028 6c61 7965  n a set of (laye
+0000c840: 722c 2064 6174 6174 7970 6529 2e0a 0a20  r, datatype)... 
+0000c850: 2020 2020 2020 202e 2e20 636f 6465 203a         .. code :
+0000c860: 3a0a 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0000c870: 6d70 6f72 7420 6764 7366 6163 746f 7279  mport gdsfactory
+0000c880: 2061 7320 6766 0a20 2020 2020 2020 2020   as gf.         
+0000c890: 2020 2067 662e 636f 6d70 6f6e 656e 7473     gf.components
+0000c8a0: 2e73 7472 6169 6768 7428 292e 6765 745f  .straight().get_
+0000c8b0: 6c61 7965 7273 2829 203d 3d20 7b28 312c  layers() == {(1,
+0000c8c0: 2030 292c 2028 3131 312c 2030 297d 0a20   0), (111, 0)}. 
+0000c8d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000c8e0: 2020 2070 6f6c 7967 6f6e 7320 3d20 7365     polygons = se
+0000c8f0: 6c66 2e5f 6365 6c6c 2e67 6574 5f70 6f6c  lf._cell.get_pol
+0000c900: 7967 6f6e 7328 6465 7074 683d 4e6f 6e65  ygons(depth=None
+0000c910: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000c920: 207b 2870 6f6c 7967 6f6e 2e6c 6179 6572   {(polygon.layer
+0000c930: 2c20 706f 6c79 676f 6e2e 6461 7461 7479  , polygon.dataty
+0000c940: 7065 2920 666f 7220 706f 6c79 676f 6e20  pe) for polygon 
+0000c950: 696e 2070 6f6c 7967 6f6e 737d 0a0a 2020  in polygons}..  
+0000c960: 2020 6465 6620 6765 745f 6c61 7965 725f    def get_layer_
+0000c970: 6e61 6d65 7328 7365 6c66 2920 2d3e 206c  names(self) -> l
+0000c980: 6973 745b 7475 706c 655b 696e 742c 2069  ist[tuple[int, i
+0000c990: 6e74 5d5d 3a0a 2020 2020 2020 2020 2222  nt]]:.        ""
+0000c9a0: 2252 6574 7572 6e20 6c61 7965 7220 6e61  "Return layer na
+0000c9b0: 6d65 7320 7573 6564 2069 6e20 7468 6520  mes used in the 
+0000c9c0: 6465 7369 676e 2e0a 0a20 2020 2020 2020  design...       
+0000c9d0: 202e 2e20 636f 6465 203a 3a0a 0a20 2020   .. code ::..   
+0000c9e0: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
+0000c9f0: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
+0000ca00: 0a20 2020 2020 2020 2020 2020 2067 662e  .            gf.
+0000ca10: 636f 6d70 6f6e 656e 7473 2e73 7472 6169  components.strai
+0000ca20: 6768 7428 292e 6765 745f 6e61 6d65 7328  ght().get_names(
+0000ca30: 2920 3d3d 205b 2757 4727 5d0a 2020 2020  ) == ['WG'].    
+0000ca40: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000ca50: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
+0000ca60: 7920 6173 2067 660a 0a20 2020 2020 2020  y as gf..       
+0000ca70: 2050 444b 203d 2067 662e 6765 745f 6163   PDK = gf.get_ac
+0000ca80: 7469 7665 5f70 646b 2829 0a20 2020 2020  tive_pdk().     
+0000ca90: 2020 204c 4159 4552 5320 3d20 5044 4b2e     LAYERS = PDK.
+0000caa0: 6c61 7965 7273 0a20 2020 2020 2020 206e  layers.        n
+0000cab0: 616d 655f 746f 5f6c 6179 6572 203d 2064  ame_to_layer = d
+0000cac0: 6963 7428 4c41 5945 5253 290a 2020 2020  ict(LAYERS).    
+0000cad0: 2020 2020 6c61 7965 725f 746f 5f6e 616d      layer_to_nam
+0000cae0: 6520 3d20 7b76 3a20 6b20 666f 7220 6b2c  e = {v: k for k,
+0000caf0: 2076 2069 6e20 6e61 6d65 5f74 6f5f 6c61   v in name_to_la
+0000cb00: 7965 722e 6974 656d 7328 297d 0a20 2020  yer.items()}.   
+0000cb10: 2020 2020 206c 6179 6572 5f6e 616d 6573       layer_names
+0000cb20: 203d 205b 5d0a 0a20 2020 2020 2020 2066   = []..        f
+0000cb30: 6f72 206c 6179 6572 2069 6e20 7365 6c66  or layer in self
+0000cb40: 2e6c 6179 6572 733a 0a20 2020 2020 2020  .layers:.       
+0000cb50: 2020 2020 2069 6620 6c61 7965 7220 6e6f       if layer no
+0000cb60: 7420 696e 206c 6179 6572 5f74 6f5f 6e61  t in layer_to_na
+0000cb70: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+0000cb80: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
+0000cb90: 6e28 6622 7b6c 6179 6572 7d20 6e6f 7420  n(f"{layer} not 
+0000cba0: 696e 204c 6179 6572 4d61 702e 222c 2073  in LayerMap.", s
+0000cbb0: 7461 636b 6c65 7665 6c3d 3329 0a20 2020  tacklevel=3).   
+0000cbc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000cbd0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0000cbe0: 6179 6572 5f6e 616d 6573 2e61 7070 656e  ayer_names.appen
+0000cbf0: 6428 6c61 7965 725f 746f 5f6e 616d 655b  d(layer_to_name[
+0000cc00: 6c61 7965 725d 290a 2020 2020 2020 2020  layer]).        
+0000cc10: 7265 7475 726e 206c 6179 6572 5f6e 616d  return layer_nam
+0000cc20: 6573 0a0a 2020 2020 6465 6620 5f72 6570  es..    def _rep
+0000cc30: 725f 6874 6d6c 5f28 7365 6c66 293a 0a20  r_html_(self):. 
+0000cc40: 2020 2020 2020 2022 2222 5368 6f77 2067         """Show g
+0000cc50: 656f 6d65 7472 7920 696e 204b 4c61 796f  eometry in KLayo
+0000cc60: 7574 2061 6e64 2069 6e20 6d61 7470 6c6f  ut and in matplo
+0000cc70: 746c 6962 2066 6f72 204a 7570 7974 6572  tlib for Jupyter
+0000cc80: 204e 6f74 6562 6f6f 6b73 2e22 2222 0a20   Notebooks.""". 
+0000cc90: 2020 2020 2020 2073 656c 662e 7368 6f77         self.show
+0000cca0: 2829 0a20 2020 2020 2020 2066 6967 203d  ().        fig =
+0000ccb0: 2073 656c 662e 706c 6f74 2829 0a20 2020   self.plot().   
+0000ccc0: 2020 2020 2069 6620 6669 6720 616e 6420       if fig and 
+0000ccd0: 6861 7361 7474 7228 6669 672c 2022 5f72  hasattr(fig, "_r
+0000cce0: 6570 725f 6874 6d6c 5f22 293a 0a20 2020  epr_html_"):.   
+0000ccf0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000cd00: 6669 672e 5f72 6570 725f 6874 6d6c 5f28  fig._repr_html_(
+0000cd10: 290a 0a20 2020 2064 6566 2061 6464 5f70  )..    def add_p
+0000cd20: 696e 735f 7472 6961 6e67 6c65 280a 2020  ins_triangle(.  
+0000cd30: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0000cd40: 2020 2020 706f 7274 5f6d 6172 6b65 725f      port_marker_
+0000cd50: 6c61 7965 723a 204c 6179 6572 203d 2028  layer: Layer = (
+0000cd60: 312c 2031 3029 2c0a 2020 2020 2020 2020  1, 10),.        
+0000cd70: 6c61 7965 725f 6c61 6265 6c3a 204c 6179  layer_label: Lay
+0000cd80: 6572 203d 2028 312c 2031 3029 2c0a 2020  er = (1, 10),.  
+0000cd90: 2020 2020 2020 6d61 6b65 5f63 6f70 793a        make_copy:
+0000cda0: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
+0000cdb0: 2020 2920 2d3e 2043 6f6d 706f 6e65 6e74    ) -> Component
+0000cdc0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0000cdd0: 7572 6e73 2063 6f6d 706f 6e65 6e74 2077  urns component w
+0000cde0: 6974 6820 7472 6961 6e67 756c 6172 2070  ith triangular p
+0000cdf0: 696e 732e 2222 220a 2020 2020 2020 2020  ins.""".        
+0000ce00: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+0000ce10: 6164 645f 7069 6e73 2069 6d70 6f72 7420  add_pins import 
+0000ce20: 6164 645f 7069 6e73 5f74 7269 616e 676c  add_pins_triangl
+0000ce30: 650a 0a20 2020 2020 2020 2069 6620 6d61  e..        if ma
+0000ce40: 6b65 5f63 6f70 793a 0a20 2020 2020 2020  ke_copy:.       
+0000ce50: 2020 2020 2063 6f6d 706f 6e65 6e74 203d       component =
+0000ce60: 2073 656c 662e 636f 7079 2829 0a20 2020   self.copy().   
+0000ce70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000ce80: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+0000ce90: 203d 2073 656c 660a 2020 2020 2020 2020   = self.        
+0000cea0: 6164 645f 7069 6e73 5f74 7269 616e 676c  add_pins_triangl
+0000ceb0: 6528 0a20 2020 2020 2020 2020 2020 2063  e(.            c
+0000cec0: 6f6d 706f 6e65 6e74 3d63 6f6d 706f 6e65  omponent=compone
+0000ced0: 6e74 2c20 6c61 7965 723d 706f 7274 5f6d  nt, layer=port_m
+0000cee0: 6172 6b65 725f 6c61 7965 722c 206c 6179  arker_layer, lay
+0000cef0: 6572 5f6c 6162 656c 3d6c 6179 6572 5f6c  er_label=layer_l
+0000cf00: 6162 656c 0a20 2020 2020 2020 2029 0a20  abel.        ). 
+0000cf10: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+0000cf20: 6d70 6f6e 656e 740a 0a20 2020 2064 6566  mponent..    def
+0000cf30: 2070 6c6f 745f 6b6c 6179 6f75 7428 0a20   plot_klayout(. 
+0000cf40: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0000cf50: 2020 2020 2073 686f 775f 706f 7274 733a       show_ports:
+0000cf60: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
+0000cf70: 2020 2020 2020 706f 7274 5f6d 6172 6b65        port_marke
+0000cf80: 725f 6c61 7965 723a 204c 6179 6572 203d  r_layer: Layer =
+0000cf90: 2028 312c 2031 3029 2c0a 2020 2020 2020   (1, 10),.      
+0000cfa0: 2020 7368 6f77 5f6c 6162 656c 733a 2062    show_labels: b
+0000cfb0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0000cfc0: 2029 3a0a 2020 2020 2020 2020 2222 2252   ):.        """R
+0000cfd0: 6574 7572 6e73 206b 6c61 796f 7574 2069  eturns klayout i
+0000cfe0: 6d61 6765 2e0a 0a20 2020 2020 2020 2049  mage...        I
+0000cff0: 6620 6974 2066 6169 6c73 2074 6f20 696d  f it fails to im
+0000d000: 706f 7274 206b 6c61 796f 7574 2064 6566  port klayout def
+0000d010: 6175 6c74 7320 746f 206d 6174 706c 6f74  aults to matplot
+0000d020: 6c69 622e 0a0a 2020 2020 2020 2020 4172  lib...        Ar
+0000d030: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+0000d040: 7368 6f77 5f70 6f72 7473 3a20 7368 6f77  show_ports: show
+0000d050: 7320 636f 6d70 6f6e 656e 7420 7769 7468  s component with
+0000d060: 2070 6f72 7420 6d61 726b 6572 7320 616e   port markers an
+0000d070: 6420 6c61 6265 6c73 2e0a 2020 2020 2020  d labels..      
+0000d080: 2020 2020 2020 706f 7274 5f6d 6172 6b65        port_marke
+0000d090: 725f 6c61 7965 723a 2066 6f72 2074 6865  r_layer: for the
+0000d0a0: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
+0000d0b0: 2020 2020 7368 6f77 5f6c 6162 656c 733a      show_labels:
+0000d0c0: 2073 686f 7773 206c 6162 656c 732e 0a20   shows labels.. 
+0000d0d0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0000d0e0: 2020 2020 6966 2073 686f 775f 706f 7274      if show_port
+0000d0f0: 733a 0a20 2020 2020 2020 2020 2020 206e  s:.            n
+0000d100: 616d 6520 3d20 7365 6c66 2e6e 616d 650a  ame = self.name.
+0000d110: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+0000d120: 6f6e 656e 7420 3d20 7365 6c66 2e61 6464  onent = self.add
+0000d130: 5f70 696e 735f 7472 6961 6e67 6c65 2870  _pins_triangle(p
+0000d140: 6f72 745f 6d61 726b 6572 5f6c 6179 6572  ort_marker_layer
+0000d150: 3d70 6f72 745f 6d61 726b 6572 5f6c 6179  =port_marker_lay
+0000d160: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+0000d170: 636f 6d70 6f6e 656e 742e 7265 6e61 6d65  component.rename
+0000d180: 286e 616d 652c 2063 6163 6865 3d46 616c  (name, cache=Fal
+0000d190: 7365 290a 0a20 2020 2020 2020 2065 6c73  se)..        els
+0000d1a0: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+0000d1b0: 6f6d 706f 6e65 6e74 203d 2073 656c 660a  omponent = self.
+0000d1c0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0000d1d0: 2020 2020 2020 2020 2020 6672 6f6d 2069            from i
+0000d1e0: 6f20 696d 706f 7274 2042 7974 6573 494f  o import BytesIO
+0000d1f0: 0a0a 2020 2020 2020 2020 2020 2020 696d  ..            im
+0000d200: 706f 7274 206b 6c61 796f 7574 2e64 6220  port klayout.db 
+0000d210: 6173 2064 6220 2023 206e 6f71 613a 2046  as db  # noqa: F
+0000d220: 3430 310a 2020 2020 2020 2020 2020 2020  401.            
+0000d230: 696d 706f 7274 206b 6c61 796f 7574 2e6c  import klayout.l
+0000d240: 6179 2061 7320 6c61 790a 2020 2020 2020  ay as lay.      
+0000d250: 2020 2020 2020 696d 706f 7274 206d 6174        import mat
+0000d260: 706c 6f74 6c69 622e 7079 706c 6f74 2061  plotlib.pyplot a
+0000d270: 7320 706c 740a 0a20 2020 2020 2020 2020  s plt..         
+0000d280: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000d290: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
+0000d2a0: 745f 6c61 7965 725f 7669 6577 730a 0a20  t_layer_views.. 
+0000d2b0: 2020 2020 2020 2020 2020 2067 6473 7061             gdspa
+0000d2c0: 7468 203d 2063 6f6d 706f 6e65 6e74 2e77  th = component.w
+0000d2d0: 7269 7465 5f67 6473 286c 6f67 6769 6e67  rite_gds(logging
+0000d2e0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+0000d2f0: 2020 2020 6c79 705f 7061 7468 203d 2067      lyp_path = g
+0000d300: 6473 7061 7468 2e77 6974 685f 7375 6666  dspath.with_suff
+0000d310: 6978 2822 2e6c 7970 2229 0a0a 2020 2020  ix(".lyp")..    
+0000d320: 2020 2020 2020 2020 6c61 7965 725f 7669          layer_vi
+0000d330: 6577 7320 3d20 6765 745f 6c61 7965 725f  ews = get_layer_
+0000d340: 7669 6577 7328 290a 2020 2020 2020 2020  views().        
+0000d350: 2020 2020 6c61 7965 725f 7669 6577 732e      layer_views.
+0000d360: 746f 5f6c 7970 2866 696c 6570 6174 683d  to_lyp(filepath=
+0000d370: 6c79 705f 7061 7468 290a 0a20 2020 2020  lyp_path)..     
+0000d380: 2020 2020 2020 206c 6179 6f75 745f 7669         layout_vi
+0000d390: 6577 203d 206c 6179 2e4c 6179 6f75 7456  ew = lay.LayoutV
+0000d3a0: 6965 7728 290a 2020 2020 2020 2020 2020  iew().          
+0000d3b0: 2020 6c61 796f 7574 5f76 6965 772e 6c6f    layout_view.lo
+0000d3c0: 6164 5f6c 6179 6f75 7428 7374 7228 6764  ad_layout(str(gd
+0000d3d0: 7370 6174 682e 6162 736f 6c75 7465 2829  spath.absolute()
+0000d3e0: 2929 0a20 2020 2020 2020 2020 2020 206c  )).            l
+0000d3f0: 6179 6f75 745f 7669 6577 2e6d 6178 5f68  ayout_view.max_h
+0000d400: 6965 7228 290a 2020 2020 2020 2020 2020  ier().          
+0000d410: 2020 6c61 796f 7574 5f76 6965 772e 6c6f    layout_view.lo
+0000d420: 6164 5f6c 6179 6572 5f70 726f 7073 2873  ad_layer_props(s
+0000d430: 7472 286c 7970 5f70 6174 6829 290a 0a20  tr(lyp_path)).. 
+0000d440: 2020 2020 2020 2020 2020 206c 6179 6f75             layou
+0000d450: 745f 7669 6577 2e73 6574 5f63 6f6e 6669  t_view.set_confi
+0000d460: 6728 2274 6578 742d 7669 7369 626c 6522  g("text-visible"
+0000d470: 2c20 2274 7275 6522 2069 6620 7368 6f77  , "true" if show
+0000d480: 5f6c 6162 656c 7320 656c 7365 2022 6661  _labels else "fa
+0000d490: 6c73 6522 290a 0a20 2020 2020 2020 2020  lse")..         
+0000d4a0: 2020 2070 6978 656c 5f62 7566 6665 7220     pixel_buffer 
+0000d4b0: 3d20 6c61 796f 7574 5f76 6965 772e 6765  = layout_view.ge
+0000d4c0: 745f 7069 7865 6c73 5f77 6974 685f 6f70  t_pixels_with_op
+0000d4d0: 7469 6f6e 7328 3830 302c 2036 3030 290a  tions(800, 600).
+0000d4e0: 2020 2020 2020 2020 2020 2020 706e 675f              png_
+0000d4f0: 6461 7461 203d 2070 6978 656c 5f62 7566  data = pixel_buf
+0000d500: 6665 722e 746f 5f70 6e67 5f64 6174 6128  fer.to_png_data(
+0000d510: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0000d520: 2043 6f6e 7665 7274 2050 4e47 2064 6174   Convert PNG dat
+0000d530: 6120 746f 204e 756d 5079 2061 7272 6179  a to NumPy array
+0000d540: 2061 6e64 2064 6973 706c 6179 2077 6974   and display wit
+0000d550: 6820 6d61 7470 6c6f 746c 6962 0a20 2020  h matplotlib.   
+0000d560: 2020 2020 2020 2020 2077 6974 6820 4279           with By
+0000d570: 7465 7349 4f28 706e 675f 6461 7461 2920  tesIO(png_data) 
+0000d580: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+0000d590: 2020 2020 2020 696d 675f 6172 7261 7920        img_array 
+0000d5a0: 3d20 706c 742e 696d 7265 6164 2866 290a  = plt.imread(f).
+0000d5b0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+0000d5c0: 6f6d 7075 7465 2074 6865 2066 6967 7572  ompute the figur
+0000d5d0: 6520 6469 6d65 6e73 696f 6e73 2062 6173  e dimensions bas
+0000d5e0: 6564 206f 6e20 7468 6520 696d 6167 6520  ed on the image 
+0000d5f0: 7369 7a65 2061 6e64 2064 6573 6972 6564  size and desired
+0000d600: 2044 5049 0a20 2020 2020 2020 2020 2020   DPI.           
+0000d610: 2064 7069 203d 2038 300a 2020 2020 2020   dpi = 80.      
+0000d620: 2020 2020 2020 6669 675f 7769 6474 6820        fig_width 
+0000d630: 3d20 696d 675f 6172 7261 792e 7368 6170  = img_array.shap
+0000d640: 655b 315d 202f 2064 7069 0a20 2020 2020  e[1] / dpi.     
+0000d650: 2020 2020 2020 2066 6967 5f68 6569 6768         fig_heigh
+0000d660: 7420 3d20 696d 675f 6172 7261 792e 7368  t = img_array.sh
+0000d670: 6170 655b 305d 202f 2064 7069 0a0a 2020  ape[0] / dpi..  
+0000d680: 2020 2020 2020 2020 2020 6669 672c 2061            fig, a
+0000d690: 7820 3d20 706c 742e 7375 6270 6c6f 7473  x = plt.subplots
+0000d6a0: 2866 6967 7369 7a65 3d28 6669 675f 7769  (figsize=(fig_wi
+0000d6b0: 6474 682c 2066 6967 5f68 6569 6768 7429  dth, fig_height)
+0000d6c0: 2c20 6470 693d 6470 6929 0a0a 2020 2020  , dpi=dpi)..    
+0000d6d0: 2020 2020 2020 2020 2320 5265 6d6f 7665          # Remove
+0000d6e0: 206d 6172 6769 6e73 2061 6e64 2064 6973   margins and dis
+0000d6f0: 706c 6179 2074 6865 2069 6d61 6765 0a20  play the image. 
+0000d700: 2020 2020 2020 2020 2020 2061 782e 696d             ax.im
+0000d710: 7368 6f77 2869 6d67 5f61 7272 6179 290a  show(img_array).
+0000d720: 2020 2020 2020 2020 2020 2020 6178 2e61              ax.a
+0000d730: 7869 7328 226f 6666 2229 2020 2320 4869  xis("off")  # Hi
+0000d740: 6465 2061 7865 730a 2020 2020 2020 2020  de axes.        
+0000d750: 2020 2020 6178 2e73 6574 5f70 6f73 6974      ax.set_posit
+0000d760: 696f 6e28 5b30 2c20 302c 2031 2c20 315d  ion([0, 0, 1, 1]
+0000d770: 2920 2023 2053 6574 2061 7865 7320 746f  )  # Set axes to
+0000d780: 206f 6363 7570 7920 7468 6520 6675 6c6c   occupy the full
+0000d790: 2066 6967 7572 6520 7370 6163 650a 0a20   figure space.. 
+0000d7a0: 2020 2020 2020 2020 2020 2070 6c74 2e73             plt.s
+0000d7b0: 7562 706c 6f74 735f 6164 6a75 7374 280a  ubplots_adjust(.
+0000d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d7d0: 6c65 6674 3d30 2c20 7269 6768 743d 312c  left=0, right=1,
+0000d7e0: 2074 6f70 3d31 2c20 626f 7474 6f6d 3d30   top=1, bottom=0
+0000d7f0: 2c20 7773 7061 6365 3d30 2c20 6873 7061  , wspace=0, hspa
+0000d800: 6365 3d30 0a20 2020 2020 2020 2020 2020  ce=0.           
+0000d810: 2029 2020 2320 5265 6d6f 7665 2061 6e79   )  # Remove any
+0000d820: 2070 6164 6469 6e67 0a20 2020 2020 2020   padding.       
+0000d830: 2020 2020 2070 6c74 2e74 6967 6874 5f6c       plt.tight_l
+0000d840: 6179 6f75 7428 7061 643d 3029 2020 2320  ayout(pad=0)  # 
+0000d850: 456e 7375 7265 206e 6f20 7370 6163 6520  Ensure no space 
+0000d860: 6973 2077 6173 7465 640a 2020 2020 2020  is wasted.      
+0000d870: 2020 2020 2020 7265 7475 726e 2066 6967        return fig
+0000d880: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+0000d890: 2049 6d70 6f72 7445 7272 6f72 3a0a 2020   ImportError:.  
+0000d8a0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000d8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d8c0: 2022 596f 7520 6361 6e20 696e 7374 616c   "You can instal
+0000d8d0: 6c20 6070 6970 2069 6e73 7461 6c6c 2067  l `pip install g
+0000d8e0: 6473 6661 6374 6f72 795b 6361 645d 6020  dsfactory[cad]` 
+0000d8f0: 666f 7220 6265 7474 6572 2076 6973 7561  for better visua
+0000d900: 6c69 7a61 7469 6f6e 220a 2020 2020 2020  lization".      
+0000d910: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000d920: 2020 2020 636f 6d70 6f6e 656e 742e 706c      component.pl
+0000d930: 6f74 2870 6c6f 7474 6572 3d22 6d61 7470  ot(plotter="matp
+0000d940: 6c6f 746c 6962 2229 0a0a 2020 2020 6465  lotlib")..    de
+0000d950: 6620 706c 6f74 5f6b 7765 6228 7365 6c66  f plot_kweb(self
+0000d960: 293a 0a20 2020 2020 2020 2022 2222 5368  ):.        """Sh
+0000d970: 6f77 7320 6375 7272 656e 7420 6764 7320  ows current gds 
+0000d980: 696e 206b 7765 622e 2222 220a 0a20 2020  in kweb."""..   
+0000d990: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000d9a0: 2020 2020 2020 696d 706f 7274 206b 7765        import kwe
+0000d9b0: 622e 7365 7276 6572 5f6a 7570 7974 6572  b.server_jupyter
+0000d9c0: 2061 7320 6b6a 0a20 2020 2020 2020 2065   as kj.        e
+0000d9d0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+0000d9e0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0000d9f0: 6e74 2822 596f 7520 6e65 6564 2074 6f20  nt("You need to 
+0000da00: 696e 7374 616c 6c20 6b77 6562 2077 6974  install kweb wit
+0000da10: 6820 6070 6970 2069 6e73 7461 6c6c 2067  h `pip install g
+0000da20: 6473 6661 6374 6f72 795b 6361 645d 6022  dsfactory[cad]`"
+0000da30: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0000da40: 7475 726e 2073 656c 662e 706c 6f74 5f6b  turn self.plot_k
+0000da50: 6c61 796f 7574 2829 0a0a 2020 2020 2020  layout()..      
+0000da60: 2020 6672 6f6d 2068 746d 6c20 696d 706f    from html impo
+0000da70: 7274 2065 7363 6170 650a 0a20 2020 2020  rt escape..     
+0000da80: 2020 2066 726f 6d20 4950 7974 686f 6e2e     from IPython.
+0000da90: 6469 7370 6c61 7920 696d 706f 7274 2049  display import I
+0000daa0: 4672 616d 650a 0a20 2020 2020 2020 2066  Frame..        f
+0000dab0: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
+0000dac0: 646b 2069 6d70 6f72 7420 6765 745f 6c61  dk import get_la
+0000dad0: 7965 725f 7669 6577 730a 0a20 2020 2020  yer_views..     
+0000dae0: 2020 2067 6473 7061 7468 203d 2073 656c     gdspath = sel
+0000daf0: 662e 7772 6974 655f 6764 7328 6764 7364  f.write_gds(gdsd
+0000db00: 6972 3d47 4453 4449 525f 5445 4d50 2c20  ir=GDSDIR_TEMP, 
+0000db10: 6c6f 6767 696e 673d 4661 6c73 6529 0a20  logging=False). 
+0000db20: 2020 2020 2020 206c 7970 5f70 6174 6820         lyp_path 
+0000db30: 3d20 4744 5344 4952 5f54 454d 5020 2f20  = GDSDIR_TEMP / 
+0000db40: 226c 6179 6572 732e 6c79 7022 0a0a 2020  "layers.lyp"..  
+0000db50: 2020 2020 2020 6c61 7965 725f 7072 6f70        layer_prop
+0000db60: 7320 3d20 6765 745f 6c61 7965 725f 7669  s = get_layer_vi
+0000db70: 6577 7328 290a 2020 2020 2020 2020 6c61  ews().        la
+0000db80: 7965 725f 7072 6f70 732e 746f 5f6c 7970  yer_props.to_lyp
+0000db90: 2866 696c 6570 6174 683d 6c79 705f 7061  (filepath=lyp_pa
+0000dba0: 7468 290a 2020 2020 2020 2020 686f 7374  th).        host
+0000dbb0: 203d 206f 732e 6765 7465 6e76 2822 4b57   = os.getenv("KW
+0000dbc0: 4542 5f48 4f53 5422 2c20 226c 6f63 616c  EB_HOST", "local
+0000dbd0: 686f 7374 2229 0a0a 2020 2020 2020 2020  host")..        
+0000dbe0: 706f 7274 203d 2028 0a20 2020 2020 2020  port = (.       
+0000dbf0: 2020 2020 206b 6a2e 706f 7274 0a20 2020       kj.port.   
+0000dc00: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
+0000dc10: 7474 7228 6b6a 2c20 2270 6f72 7422 2920  ttr(kj, "port") 
+0000dc20: 616e 6420 6b6a 2e70 6f72 740a 2020 2020  and kj.port.    
+0000dc30: 2020 2020 2020 2020 656c 7365 2069 6e74          else int
+0000dc40: 286f 732e 6765 7465 6e76 2822 4b57 4542  (os.getenv("KWEB
+0000dc50: 5f50 4f52 5422 2c20 3830 3030 2929 0a20  _PORT", 8000)). 
+0000dc60: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000dc70: 2073 7263 203d 2066 2268 7474 703a 2f2f   src = f"http://
+0000dc80: 7b68 6f73 747d 3a7b 706f 7274 7d2f 6764  {host}:{port}/gd
+0000dc90: 732f 7b65 7363 6170 6528 6764 7370 6174  s/{escape(gdspat
+0000dca0: 682e 7374 656d 2b67 6473 7061 7468 2e73  h.stem+gdspath.s
+0000dcb0: 7566 6669 7829 7d3f 6c61 7965 725f 7072  uffix)}?layer_pr
+0000dcc0: 6f70 733d 7b65 7363 6170 6528 7374 7228  ops={escape(str(
+0000dcd0: 6c79 705f 7061 7468 2929 7d22 0a0a 2020  lyp_path))}"..  
+0000dce0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+0000dcf0: 5b22 4b57 4542 5f50 4f52 5422 5d20 3d20  ["KWEB_PORT"] = 
+0000dd00: 7374 7228 6f73 2e67 6574 656e 7628 224b  str(os.getenv("K
+0000dd10: 5745 425f 504f 5254 222c 2070 6f72 7429  WEB_PORT", port)
+0000dd20: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+0000dd30: 7420 6b6a 2e6a 7570 7974 6572 5f73 6572  t kj.jupyter_ser
+0000dd40: 7665 723a 0a20 2020 2020 2020 2020 2020  ver:.           
+0000dd50: 2070 6f72 7420 3d20 706f 7274 0a20 2020   port = port.   
+0000dd60: 2020 2020 2020 2020 2077 6869 6c65 206b           while k
+0000dd70: 6a2e 6973 5f70 6f72 745f 696e 5f75 7365  j.is_port_in_use
+0000dd80: 2870 6f72 743d 706f 7274 2c20 686f 7374  (port=port, host
+0000dd90: 3d68 6f73 7429 3a0a 2020 2020 2020 2020  =host):.        
+0000dda0: 2020 2020 2020 2020 706f 7274 202b 3d20          port += 
+0000ddb0: 310a 0a20 2020 2020 2020 2020 2020 206f  1..            o
+0000ddc0: 732e 656e 7669 726f 6e5b 224b 5745 425f  s.environ["KWEB_
+0000ddd0: 504f 5254 225d 203d 2073 7472 2870 6f72  PORT"] = str(por
+0000dde0: 7429 0a20 2020 2020 2020 2020 2020 206c  t).            l
+0000ddf0: 6f67 6765 722e 6465 6275 6728 7372 6329  ogger.debug(src)
+0000de00: 0a20 2020 2020 2020 2020 2020 206b 6a2e  .            kj.
+0000de10: 7374 6172 7428 290a 0a20 2020 2020 2020  start()..       
+0000de20: 2069 6620 6b6a 2e6a 7570 7974 6572 5f73   if kj.jupyter_s
+0000de30: 6572 7665 723a 0a20 2020 2020 2020 2020  erver:.         
+0000de40: 2020 2072 6574 7572 6e20 4946 7261 6d65     return IFrame
+0000de50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000de60: 2020 7372 633d 7372 632c 0a20 2020 2020    src=src,.     
+0000de70: 2020 2020 2020 2020 2020 2077 6964 7468             width
+0000de80: 3d31 3430 302c 0a20 2020 2020 2020 2020  =1400,.         
+0000de90: 2020 2020 2020 2068 6569 6768 743d 3630         height=60
+0000dea0: 302c 0a20 2020 2020 2020 2020 2020 2029  0,.            )
+0000deb0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000dec0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000ded0: 6e20 7365 6c66 2e70 6c6f 745f 6b6c 6179  n self.plot_klay
+0000dee0: 6f75 7428 290a 0a20 2020 2064 6566 2070  out()..    def p
+0000def0: 6c6f 745f 6d61 7470 6c6f 746c 6962 2873  lot_matplotlib(s
+0000df00: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
+0000df10: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000df20: 2222 2250 6c6f 7420 636f 6d70 6f6e 656e  """Plot componen
+0000df30: 7420 7573 696e 6720 6d61 7470 6c6f 746c  t using matplotl
+0000df40: 6962 2e0a 0a20 2020 2020 2020 204b 6579  ib...        Key
+0000df50: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+0000df60: 2020 2020 2020 2073 686f 775f 706f 7274         show_port
+0000df70: 733a 2053 6574 7320 7768 6574 6865 7220  s: Sets whether 
+0000df80: 706f 7274 7320 6172 6520 6472 6177 6e2e  ports are drawn.
+0000df90: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+0000dfa0: 775f 7375 6270 6f72 7473 3a20 5365 7473  w_subports: Sets
+0000dfb0: 2077 6865 7468 6572 2073 7562 706f 7274   whether subport
+0000dfc0: 7320 2870 6f72 7473 2074 6861 7420 6265  s (ports that be
+0000dfd0: 6c6f 6e67 2074 6f20 7265 6665 7265 6e63  long to referenc
+0000dfe0: 6573 2920 6172 6520 6472 6177 6e2e 0a20  es) are drawn.. 
+0000dff0: 2020 2020 2020 2020 2020 206c 6162 656c             label
+0000e000: 5f61 6c69 6173 6573 3a20 5365 7473 2077  _aliases: Sets w
+0000e010: 6865 7468 6572 2061 6c69 6173 6573 2061  hether aliases a
+0000e020: 7265 206c 6162 656c 6564 2077 6974 6820  re labeled with 
+0000e030: 6120 7465 7874 206e 616d 652e 0a20 2020  a text name..   
+0000e040: 2020 2020 2020 2020 206e 6577 5f77 696e           new_win
+0000e050: 646f 773a 2049 6620 5472 7565 2c20 6561  dow: If True, ea
+0000e060: 6368 2063 616c 6c20 746f 2071 7569 636b  ch call to quick
+0000e070: 706c 6f74 2829 2077 696c 6c20 6765 6e65  plot() will gene
+0000e080: 7261 7465 2061 2073 6570 6172 6174 6520  rate a separate 
+0000e090: 7769 6e64 6f77 2e0a 2020 2020 2020 2020  window..        
+0000e0a0: 2020 2020 626c 6f63 6b69 6e67 3a20 4966      blocking: If
+0000e0b0: 2054 7275 652c 2063 616c 6c69 6e67 2071   True, calling q
+0000e0c0: 7569 636b 706c 6f74 2829 2077 696c 6c20  uickplot() will 
+0000e0d0: 7061 7573 6520 6578 6563 7574 696f 6e20  pause execution 
+0000e0e0: 6f66 2028 2262 6c6f 636b 2229 2074 6865  of ("block") the
+0000e0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e100: 2072 656d 6169 6e64 6572 206f 6620 7468   remainder of th
+0000e110: 6520 7079 7468 6f6e 2063 6f64 6520 756e  e python code un
+0000e120: 7469 6c20 7468 6520 7175 6963 6b70 6c6f  til the quickplo
+0000e130: 7428 2920 7769 6e64 6f77 2069 7320 636c  t() window is cl
+0000e140: 6f73 6564 2e0a 2020 2020 2020 2020 2020  osed..          
+0000e150: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
+0000e160: 7468 6520 7769 6e64 6f77 2077 696c 6c20  the window will 
+0000e170: 6265 206f 7065 6e65 6420 616e 6420 636f  be opened and co
+0000e180: 6465 2077 696c 6c20 636f 6e74 696e 7565  de will continue
+0000e190: 2074 6f20 7275 6e2e 0a20 2020 2020 2020   to run..       
+0000e1a0: 2020 2020 207a 6f6f 6d5f 6661 6374 6f72       zoom_factor
+0000e1b0: 3a20 5365 7473 2074 6865 2073 6361 6c69  : Sets the scali
+0000e1c0: 6e67 2066 6163 746f 7220 7768 656e 207a  ng factor when z
+0000e1d0: 6f6f 6d69 6e67 2074 6865 2071 7569 636b  ooming the quick
+0000e1e0: 706c 6f74 2077 696e 646f 7720 7769 7468  plot window with
+0000e1f0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0000e200: 2020 2020 206d 6f75 7365 7768 6565 6c2f       mousewheel/
+0000e210: 7472 6163 6b70 6164 2e0a 2020 2020 2020  trackpad..      
+0000e220: 2020 2020 2020 696e 7465 7261 6374 6976        interactiv
+0000e230: 655f 7a6f 6f6d 3a20 456e 6162 6c65 7320  e_zoom: Enables 
+0000e240: 7573 696e 6720 6d6f 7573 6577 6865 656c  using mousewheel
+0000e250: 2f74 7261 636b 7061 6420 746f 207a 6f6f  /trackpad to zoo
+0000e260: 6d2e 0a20 2020 2020 2020 2020 2020 2066  m..            f
+0000e270: 6f6e 7473 697a 653a 2066 6f72 206c 6162  ontsize: for lab
+0000e280: 656c 732e 0a20 2020 2020 2020 2020 2020  els..           
+0000e290: 206c 6179 6572 735f 6578 636c 7564 6564   layers_excluded
+0000e2a0: 3a20 6c69 7374 206f 6620 6c61 7965 7273  : list of layers
+0000e2b0: 2074 6f20 6578 636c 7564 652e 0a20 2020   to exclude..   
+0000e2c0: 2020 2020 2020 2020 206c 6179 6572 5f76           layer_v
+0000e2d0: 6965 7773 3a20 6c61 7965 725f 7669 6577  iews: layer_view
+0000e2e0: 7320 636f 6c6f 7273 206c 6f61 6465 6420  s colors loaded 
+0000e2f0: 6672 6f6d 204b 6c61 796f 7574 2e0a 2020  from Klayout..  
+0000e300: 2020 2020 2020 2020 2020 6d69 6e5f 6173            min_as
+0000e310: 7065 6374 3a20 6d69 6e69 6d75 6d20 6173  pect: minimum as
+0000e320: 7065 6374 2072 6174 696f 2e0a 2020 2020  pect ratio..    
+0000e330: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000e340: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+0000e350: 7175 6963 6b70 6c6f 7474 6572 2069 6d70  quickplotter imp
+0000e360: 6f72 7420 7175 6963 6b70 6c6f 740a 0a20  ort quickplot.. 
+0000e370: 2020 2020 2020 2071 7569 636b 706c 6f74         quickplot
+0000e380: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+0000e390: 0a0a 2020 2020 6465 6620 706c 6f74 2873  ..    def plot(s
+0000e3a0: 656c 662c 2070 6c6f 7474 6572 3a20 7374  elf, plotter: st
+0000e3b0: 7220 7c20 4e6f 6e65 203d 204e 6f6e 652c  r | None = None,
+0000e3c0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+0000e3d0: 2020 2020 2222 2252 6574 7572 6e73 2063      """Returns c
+0000e3e0: 6f6d 706f 6e65 6e74 2070 6c6f 7420 7573  omponent plot us
+0000e3f0: 696e 6720 6b6c 6179 6f75 742c 206d 6174  ing klayout, mat
+0000e400: 706c 6f74 6c69 622c 206f 7220 6b77 6562  plotlib, or kweb
+0000e410: 2e0a 0a20 2020 2020 2020 2057 6520 7265  ...        We re
+0000e420: 636f 6d6d 656e 6420 7573 696e 6720 6b6c  commend using kl
+0000e430: 6179 6f75 7420 6f72 206b 7765 622e 0a20  ayout or kweb.. 
+0000e440: 2020 2020 2020 204b 6c61 796f 7574 2069         Klayout i
+0000e450: 7320 676f 6f64 2066 6f72 2069 6d61 6765  s good for image
+0000e460: 7320 616e 6420 6b77 6562 2066 6f72 2072  s and kweb for r
+0000e470: 6573 706f 6e73 6976 6520 696e 7465 7261  esponsive intera
+0000e480: 6374 6976 6520 706c 6f74 732e 0a20 2020  ctive plots..   
+0000e490: 2020 2020 204d 6174 706c 6f74 6c69 6220       Matplotlib 
+0000e4a0: 6973 2073 6c6f 7720 666f 7220 7265 6e64  is slow for rend
+0000e4b0: 6572 696e 6720 6269 6720 6c61 796f 7574  ering big layout
+0000e4c0: 7320 616e 6420 6973 2061 6c6d 6f73 7420  s and is almost 
+0000e4d0: 4465 7072 6563 6174 6564 2e0a 0a20 2020  Deprecated...   
+0000e4e0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+0000e4f0: 2020 2020 2020 2070 6c6f 7474 6572 3a20         plotter: 
+0000e500: 706c 6f74 2062 6163 6b65 6e64 7320 2827  plot backends ('
+0000e510: 7769 6467 6574 272c 2027 6b6c 6179 6f75  widget', 'klayou
+0000e520: 7427 2c20 276b 7765 6227 292e 0a20 2020  t', 'kweb')..   
+0000e530: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000e540: 2070 6c6f 7474 6572 203d 2070 6c6f 7474   plotter = plott
+0000e550: 6572 206f 7220 434f 4e46 2e64 6973 706c  er or CONF.displ
+0000e560: 6179 5f74 7970 650a 0a20 2020 2020 2020  ay_type..       
+0000e570: 2069 6620 706c 6f74 7465 7220 6e6f 7420   if plotter not 
+0000e580: 696e 2076 616c 6964 5f70 6c6f 7474 6572  in valid_plotter
+0000e590: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+0000e5a0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0000e5b0: 6622 7b70 6c6f 7474 6572 2172 7d20 6e6f  f"{plotter!r} no
+0000e5c0: 7420 696e 207b 7661 6c69 645f 706c 6f74  t in {valid_plot
+0000e5d0: 7465 7273 7d22 290a 0a20 2020 2020 2020  ters}")..       
+0000e5e0: 2069 6620 706c 6f74 7465 7220 3d3d 2022   if plotter == "
+0000e5f0: 6b6c 6179 6f75 7422 3a0a 2020 2020 2020  klayout":.      
+0000e600: 2020 2020 2020 7365 6c66 2e70 6c6f 745f        self.plot_
+0000e610: 6b6c 6179 6f75 7428 2a2a 6b77 6172 6773  klayout(**kwargs
+0000e620: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0000e630: 7475 726e 0a20 2020 2020 2020 2065 6c69  turn.        eli
+0000e640: 6620 706c 6f74 7465 7220 3d3d 2022 6b77  f plotter == "kw
+0000e650: 6562 223a 0a20 2020 2020 2020 2020 2020  eb":.           
+0000e660: 2072 6574 7572 6e20 7365 6c66 2e70 6c6f   return self.plo
+0000e670: 745f 6b77 6562 2829 0a0a 2020 2020 2020  t_kweb()..      
+0000e680: 2020 656c 6966 2070 6c6f 7474 6572 203d    elif plotter =
+0000e690: 3d20 226d 6174 706c 6f74 6c69 6222 3a0a  = "matplotlib":.
+0000e6a0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+0000e6b0: 2067 6473 6661 6374 6f72 792e 7175 6963   gdsfactory.quic
+0000e6c0: 6b70 6c6f 7474 6572 2069 6d70 6f72 7420  kplotter import 
+0000e6d0: 7175 6963 6b70 6c6f 740a 0a20 2020 2020  quickplot..     
+0000e6e0: 2020 2020 2020 2071 7569 636b 706c 6f74         quickplot
+0000e6f0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+0000e700: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000e710: 7572 6e0a 0a20 2020 2064 6566 2073 686f  urn..    def sho
+0000e720: 7728 0a20 2020 2020 2020 2073 656c 662c  w(.        self,
+0000e730: 0a20 2020 2020 2020 2073 686f 775f 706f  .        show_po
+0000e740: 7274 733a 2062 6f6f 6c20 3d20 4661 6c73  rts: bool = Fals
+0000e750: 652c 0a20 2020 2020 2020 2073 686f 775f  e,.        show_
+0000e760: 7375 6270 6f72 7473 3a20 626f 6f6c 203d  subports: bool =
+0000e770: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+0000e780: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
+0000e790: 723a 204c 6179 6572 203d 2028 312c 2031  r: Layer = (1, 1
+0000e7a0: 3029 2c0a 2020 2020 2020 2020 2a2a 6b77  0),.        **kw
+0000e7b0: 6172 6773 2c0a 2020 2020 2920 2d3e 204e  args,.    ) -> N
+0000e7c0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000e7d0: 5368 6f77 2063 6f6d 706f 6e65 6e74 2069  Show component i
+0000e7e0: 6e20 4b4c 6179 6f75 742e 0a0a 2020 2020  n KLayout...    
+0000e7f0: 2020 2020 7265 7475 726e 7320 6120 636f      returns a co
+0000e800: 7079 206f 6620 7468 6520 436f 6d70 6f6e  py of the Compon
+0000e810: 656e 742c 2073 6f20 7468 6520 6f72 6967  ent, so the orig
+0000e820: 696e 616c 2063 6f6d 706f 6e65 6e74 2072  inal component r
+0000e830: 656d 6169 6e73 2069 6e74 6163 742e 0a20  emains intact.. 
+0000e840: 2020 2020 2020 2077 6974 6820 7069 6e73         with pins
+0000e850: 206d 6172 6b65 7273 206f 6e20 6561 6368   markers on each
+0000e860: 2070 6f72 7420 7368 6f77 5f70 6f72 7473   port show_ports
+0000e870: 203d 2054 7275 652c 2061 6e64 206f 7074   = True, and opt
+0000e880: 696f 6e61 6c6c 7920 616c 736f 0a20 2020  ionally also.   
+0000e890: 2020 2020 2074 6865 2070 6f72 7473 2066       the ports f
+0000e8a0: 726f 6d20 7468 6520 7265 6665 7265 6e63  rom the referenc
+0000e8b0: 6573 2028 7368 6f77 5f73 7562 706f 7274  es (show_subport
+0000e8c0: 733d 5472 7565 290a 0a20 2020 2020 2020  s=True)..       
+0000e8d0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+0000e8e0: 2020 2073 686f 775f 706f 7274 733a 2073     show_ports: s
+0000e8f0: 686f 7773 2063 6f6d 706f 6e65 6e74 2077  hows component w
+0000e900: 6974 6820 706f 7274 206d 6172 6b65 7273  ith port markers
+0000e910: 2061 6e64 206c 6162 656c 732e 0a20 2020   and labels..   
+0000e920: 2020 2020 2020 2020 2073 686f 775f 7375           show_su
+0000e930: 6270 6f72 7473 3a20 6164 6420 706f 7274  bports: add port
+0000e940: 7320 6d61 726b 6572 7320 616e 6420 6c61  s markers and la
+0000e950: 6265 6c73 2074 6f20 7265 6665 7265 6e63  bels to referenc
+0000e960: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
+0000e970: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
+0000e980: 723a 2066 6f72 2074 6865 2070 6f72 7473  r: for the ports
+0000e990: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
+0000e9a0: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
+0000e9b0: 2020 2020 2067 6473 7061 7468 3a20 4744       gdspath: GD
+0000e9c0: 5320 6669 6c65 2070 6174 6820 746f 2077  S file path to w
+0000e9d0: 7269 7465 2074 6f2e 0a20 2020 2020 2020  rite to..       
+0000e9e0: 2020 2020 2067 6473 6469 723a 2064 6972       gdsdir: dir
+0000e9f0: 6563 746f 7279 2066 6f72 2074 6865 2047  ectory for the G
+0000ea00: 4453 2066 696c 652e 2044 6566 6175 6c74  DS file. Default
+0000ea10: 7320 746f 202f 746d 702f 2e0a 2020 2020  s to /tmp/..    
+0000ea20: 2020 2020 2020 2020 756e 6974 3a20 756e          unit: un
+0000ea30: 6974 2073 697a 6520 666f 7220 6f62 6a65  it size for obje
+0000ea40: 6374 7320 696e 206c 6962 7261 7279 2e20  cts in library. 
+0000ea50: 3175 6d20 6279 2064 6566 6175 6c74 2e0a  1um by default..
+0000ea60: 2020 2020 2020 2020 2020 2020 7072 6563              prec
+0000ea70: 6973 696f 6e3a 2066 6f72 206f 626a 6563  ision: for objec
+0000ea80: 7420 6469 6d65 6e73 696f 6e73 2069 6e20  t dimensions in 
+0000ea90: 7468 6520 6c69 6272 6172 7920 286d 292e  the library (m).
+0000eaa0: 2031 6e6d 2062 7920 6465 6661 756c 742e   1nm by default.
+0000eab0: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
+0000eac0: 6573 7461 6d70 3a20 4465 6661 756c 7473  estamp: Defaults
+0000ead0: 2074 6f20 3230 3139 2d31 302d 3235 2e20   to 2019-10-25. 
+0000eae0: 4966 204e 6f6e 6520 7573 6573 2063 7572  If None uses cur
+0000eaf0: 7265 6e74 2074 696d 652e 0a20 2020 2020  rent time..     
+0000eb00: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+0000eb10: 726f 6d20 6764 7366 6163 746f 7279 2e61  rom gdsfactory.a
+0000eb20: 6464 5f70 696e 7320 696d 706f 7274 2061  dd_pins import a
+0000eb30: 6464 5f70 696e 735f 7472 6961 6e67 6c65  dd_pins_triangle
+0000eb40: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
+0000eb50: 7366 6163 746f 7279 2e73 686f 7720 696d  sfactory.show im
+0000eb60: 706f 7274 2073 686f 770a 0a20 2020 2020  port show..     
+0000eb70: 2020 2063 6f6d 706f 6e65 6e74 203d 2028     component = (
+0000eb80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000eb90: 662e 6164 645f 7069 6e73 5f74 7269 616e  f.add_pins_trian
+0000eba0: 676c 6528 0a20 2020 2020 2020 2020 2020  gle(.           
+0000ebb0: 2020 2020 2070 6f72 745f 6d61 726b 6572       port_marker
+0000ebc0: 5f6c 6179 6572 3d70 6f72 745f 6d61 726b  _layer=port_mark
+0000ebd0: 6572 5f6c 6179 6572 2c0a 2020 2020 2020  er_layer,.      
+0000ebe0: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
+0000ebf0: 6c61 6265 6c3d 706f 7274 5f6d 6172 6b65  label=port_marke
+0000ec00: 725f 6c61 7965 722c 0a20 2020 2020 2020  r_layer,.       
+0000ec10: 2020 2020 2020 2020 206d 616b 655f 636f           make_co
+0000ec20: 7079 3d54 7275 652c 0a20 2020 2020 2020  py=True,.       
+0000ec30: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000ec40: 2020 2069 6620 7368 6f77 5f70 6f72 7473     if show_ports
+0000ec50: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000ec60: 6520 7365 6c66 0a20 2020 2020 2020 2029  e self.        )
+0000ec70: 0a0a 2020 2020 2020 2020 6966 2073 686f  ..        if sho
+0000ec80: 775f 7375 6270 6f72 7473 3a0a 2020 2020  w_subports:.    
+0000ec90: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+0000eca0: 7420 3d20 636f 6d70 6f6e 656e 742e 636f  t = component.co
+0000ecb0: 7079 2829 0a20 2020 2020 2020 2020 2020  py().           
+0000ecc0: 2066 6f72 2072 6566 6572 656e 6365 2069   for reference i
+0000ecd0: 6e20 636f 6d70 6f6e 656e 742e 7265 6665  n component.refe
+0000ece0: 7265 6e63 6573 3a0a 2020 2020 2020 2020  rences:.        
+0000ecf0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0000ed00: 7461 6e63 6528 636f 6d70 6f6e 656e 742c  tance(component,
+0000ed10: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
+0000ed20: 6e63 6529 3a0a 2020 2020 2020 2020 2020  nce):.          
+0000ed30: 2020 2020 2020 2020 2020 6164 645f 7069            add_pi
+0000ed40: 6e73 5f74 7269 616e 676c 6528 0a20 2020  ns_triangle(.   
+0000ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed60: 2020 2020 2063 6f6d 706f 6e65 6e74 3d63       component=c
+0000ed70: 6f6d 706f 6e65 6e74 2c0a 2020 2020 2020  omponent,.      
+0000ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed90: 2020 7265 6665 7265 6e63 653d 7265 6665    reference=refe
+0000eda0: 7265 6e63 652c 0a20 2020 2020 2020 2020  rence,.         
+0000edb0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0000edc0: 6179 6572 3d70 6f72 745f 6d61 726b 6572  ayer=port_marker
+0000edd0: 5f6c 6179 6572 2c0a 2020 2020 2020 2020  _layer,.        
+0000ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edf0: 6c61 7965 725f 6c61 6265 6c3d 706f 7274  layer_label=port
+0000ee00: 5f6d 6172 6b65 725f 6c61 7965 722c 0a20  _marker_layer,. 
+0000ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee20: 2020 2029 0a0a 2020 2020 2020 2020 636f     )..        co
+0000ee30: 6d70 6f6e 656e 742e 7265 6e61 6d65 2873  mponent.rename(s
+0000ee40: 656c 662e 6e61 6d65 2c20 6361 6368 653d  elf.name, cache=
+0000ee50: 4661 6c73 6529 0a20 2020 2020 2020 2073  False).        s
+0000ee60: 686f 7728 636f 6d70 6f6e 656e 742c 202a  how(component, *
+0000ee70: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
+0000ee80: 6620 5f77 7269 7465 5f6c 6962 7261 7279  f _write_library
+0000ee90: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0000eea0: 2020 2020 2020 2020 6764 7370 6174 683a          gdspath:
+0000eeb0: 2050 6174 6854 7970 6520 7c20 4e6f 6e65   PathType | None
+0000eec0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0000eed0: 2067 6473 6469 723a 2050 6174 6854 7970   gdsdir: PathTyp
+0000eee0: 6520 7c20 4e6f 6e65 203d 204e 6f6e 652c  e | None = None,
+0000eef0: 0a20 2020 2020 2020 2074 696d 6573 7461  .        timesta
+0000ef00: 6d70 3a20 6461 7465 7469 6d65 2e64 6174  mp: datetime.dat
+0000ef10: 6574 696d 6520 7c20 4e6f 6e65 203d 205f  etime | None = _
+0000ef20: 7469 6d65 7374 616d 7032 3031 392c 0a20  timestamp2019,. 
+0000ef30: 2020 2020 2020 206c 6f67 6769 6e67 3a20         logging: 
+0000ef40: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
+0000ef50: 2020 2020 2077 6974 685f 6f61 7369 733a       with_oasis:
+0000ef60: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+0000ef70: 2020 2020 2020 2077 6974 685f 6d65 7461         with_meta
+0000ef80: 6461 7461 3a20 626f 6f6c 203d 2046 616c  data: bool = Fal
+0000ef90: 7365 2c0a 2020 2020 2020 2020 7769 7468  se,.        with
+0000efa0: 5f6e 6574 6c69 7374 3a20 626f 6f6c 203d  _netlist: bool =
+0000efb0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+0000efc0: 6e65 746c 6973 745f 6675 6e63 7469 6f6e  netlist_function
+0000efd0: 3a20 4361 6c6c 6162 6c65 207c 204e 6f6e  : Callable | Non
+0000efe0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+0000eff0: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+0000f000: 2920 2d3e 2050 6174 683a 0a20 2020 2020  ) -> Path:.     
+0000f010: 2020 2022 2222 5772 6974 6520 636f 6d70     """Write comp
+0000f020: 6f6e 656e 7420 746f 2047 4453 206f 7220  onent to GDS or 
+0000f030: 4f41 5349 5320 616e 6420 7265 7475 726e  OASIS and return
+0000f040: 7320 6764 7370 6174 682e 0a0a 2020 2020  s gdspath...    
+0000f050: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+0000f060: 2020 2020 2020 6764 7370 6174 683a 2047        gdspath: G
+0000f070: 4453 2066 696c 6520 7061 7468 2074 6f20  DS file path to 
+0000f080: 7772 6974 6520 746f 2e0a 2020 2020 2020  write to..      
+0000f090: 2020 2020 2020 6764 7364 6972 3a20 6469        gdsdir: di
+0000f0a0: 7265 6374 6f72 7920 666f 7220 7468 6520  rectory for the 
+0000f0b0: 4744 5320 6669 6c65 2e20 4465 6661 756c  GDS file. Defaul
+0000f0c0: 7473 2074 6f20 2f74 6d70 2f72 616e 646f  ts to /tmp/rando
+0000f0d0: 6d46 696c 652f 6764 7366 6163 746f 7279  mFile/gdsfactory
+0000f0e0: 2e0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
+0000f0f0: 6d65 7374 616d 703a 2044 6566 6175 6c74  mestamp: Default
+0000f100: 7320 746f 2032 3031 392d 3130 2d32 3520  s to 2019-10-25 
+0000f110: 666f 7220 636f 6e73 6973 7465 6e74 2068  for consistent h
+0000f120: 6173 682e 0a20 2020 2020 2020 2020 2020  ash..           
+0000f130: 2020 2020 2049 6620 4e6f 6e65 2075 7365       If None use
+0000f140: 7320 6375 7272 656e 7420 7469 6d65 2e0a  s current time..
+0000f150: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0000f160: 696e 673a 2064 6973 6162 6c65 2047 4453  ing: disable GDS
+0000f170: 2070 6174 6820 6c6f 6767 696e 672c 2066   path logging, f
+0000f180: 6f72 2065 7861 6d70 6c65 2066 6f72 2073  or example for s
+0000f190: 686f 7769 6e67 2069 7420 696e 204b 4c61  howing it in KLa
+0000f1a0: 796f 7574 2e0a 2020 2020 2020 2020 2020  yout..          
+0000f1b0: 2020 7769 7468 5f6f 6173 6973 3a20 4966    with_oasis: If
+0000f1c0: 2054 7275 652c 2066 696c 6520 7769 6c6c   True, file will
+0000f1d0: 2062 6520 7772 6974 7465 6e20 746f 204f   be written to O
+0000f1e0: 4153 4953 2e20 4f74 6865 7277 6973 652c  ASIS. Otherwise,
+0000f1f0: 2066 696c 6520 7769 6c6c 2062 6520 7772   file will be wr
+0000f200: 6974 7465 6e20 746f 2047 4453 2e0a 2020  itten to GDS..  
+0000f210: 2020 2020 2020 2020 2020 7769 7468 5f6d            with_m
+0000f220: 6574 6164 6174 613a 2077 7269 7465 7320  etadata: writes 
+0000f230: 6d65 7461 6461 7461 2069 6e20 5941 4d4c  metadata in YAML
+0000f240: 2066 6f72 6d61 742e 0a20 2020 2020 2020   format..       
+0000f250: 2020 2020 2077 6974 685f 6e65 746c 6973       with_netlis
+0000f260: 743a 2077 7269 7465 7320 6e65 746c 6973  t: writes netlis
+0000f270: 7420 696e 204a 534f 4e20 666f 726d 6174  t in JSON format
+0000f280: 2e0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+0000f290: 746c 6973 745f 6675 6e63 7469 6f6e 3a20  tlist_function: 
+0000f2a0: 5468 6520 6e65 746c 6973 7420 6675 6e63  The netlist func
+0000f2b0: 7469 6f6e 2074 6f20 7573 652e 2059 6f75  tion to use. You
+0000f2c0: 2063 616e 2063 6f6d 706f 7365 2061 2070   can compose a p
+0000f2d0: 6172 7469 616c 2066 756e 6374 696f 6e20  artial function 
+0000f2e0: 7769 7468 2074 6865 2060 6765 745f 6e65  with the `get_ne
+0000f2f0: 746c 6973 7460 2066 756e 6374 696f 6e20  tlist` function 
+0000f300: 666f 7220 6578 616d 706c 6520 7769 7468  for example with
+0000f310: 2079 6f75 7220 7061 7261 6d65 7465 7273   your parameters
+0000f320: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
+0000f330: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
+0000f340: 2020 2020 204b 6579 776f 7264 2061 7267       Keyword arg
+0000f350: 756d 656e 7473 2077 696c 6c20 6f76 6572  uments will over
+0000f360: 7269 6465 2074 6865 2061 6374 6976 6520  ride the active 
+0000f370: 5044 4b27 7320 6465 6661 756c 7420 4764  PDK's default Gd
+0000f380: 7357 7269 7465 5365 7474 696e 6773 2061  sWriteSettings a
+0000f390: 6e64 204f 6173 6973 5772 6974 6553 6574  nd OasisWriteSet
+0000f3a0: 7469 6e67 732e 0a0a 2020 2020 2020 2020  tings...        
+0000f3b0: 2020 2020 4764 7320 7365 7474 696e 6773      Gds settings
+0000f3c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f3d0: 2020 756e 6974 3a20 756e 6974 2073 697a    unit: unit siz
+0000f3e0: 6520 666f 7220 6f62 6a65 6374 7320 696e  e for objects in
+0000f3f0: 206c 6962 7261 7279 2e20 3175 6d20 6279   library. 1um by
+0000f400: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
+0000f410: 2020 2020 2020 2020 2020 7072 6563 6973            precis
+0000f420: 696f 6e3a 2066 6f72 2064 696d 656e 7369  ion: for dimensi
+0000f430: 6f6e 7320 696e 2074 6865 206c 6962 7261  ons in the libra
+0000f440: 7279 2028 6d29 2e20 316e 6d20 6279 2064  ry (m). 1nm by d
+0000f450: 6566 6175 6c74 2e0a 2020 2020 2020 2020  efault..        
+0000f460: 2020 2020 2020 2020 6f6e 5f64 7570 6c69          on_dupli
+0000f470: 6361 7465 5f63 656c 6c3a 2073 7065 6369  cate_cell: speci
+0000f480: 6679 2068 6f77 2074 6f20 7265 736f 6c76  fy how to resolv
+0000f490: 6520 6475 706c 6963 6174 652d 6e61 6d65  e duplicate-name
+0000f4a0: 6420 6365 6c6c 732e 2043 686f 6f73 6520  d cells. Choose 
+0000f4b0: 6f6e 6520 6f66 2074 6865 2066 6f6c 6c6f  one of the follo
+0000f4c0: 7769 6e67 3a0a 2020 2020 2020 2020 2020  wing:.          
+0000f4d0: 2020 2020 2020 2020 2020 2277 6172 6e22            "warn"
+0000f4e0: 2028 6465 6661 756c 7429 3a20 6f76 6572   (default): over
+0000f4f0: 7772 6974 6520 616c 6c20 6475 706c 6963  write all duplic
+0000f500: 6174 6520 6365 6c6c 7320 7769 7468 206f  ate cells with o
+0000f510: 6e65 206f 6620 7468 6520 6475 706c 6963  ne of the duplic
+0000f520: 6174 6573 2028 6172 6269 7472 6172 696c  ates (arbitraril
+0000f530: 7929 2e0a 2020 2020 2020 2020 2020 2020  y)..            
+0000f540: 2020 2020 2020 2020 2265 7272 6f72 223a          "error":
+0000f550: 2074 6872 6f77 2061 2056 616c 7565 4572   throw a ValueEr
+0000f560: 726f 7220 7768 656e 2061 7474 656d 7074  ror when attempt
+0000f570: 696e 6720 746f 2077 7269 7465 2061 2067  ing to write a g
+0000f580: 6473 2077 6974 6820 6475 706c 6963 6174  ds with duplicat
+0000f590: 6520 6365 6c6c 732e 0a20 2020 2020 2020  e cells..       
+0000f5a0: 2020 2020 2020 2020 2020 2020 2022 6f76               "ov
+0000f5b0: 6572 7772 6974 6522 3a20 6f76 6572 7772  erwrite": overwr
+0000f5c0: 6974 6520 616c 6c20 6475 706c 6963 6174  ite all duplicat
+0000f5d0: 6520 6365 6c6c 7320 7769 7468 206f 6e65  e cells with one
+0000f5e0: 206f 6620 7468 6520 6475 706c 6963 6174   of the duplicat
+0000f5f0: 6573 2c20 7769 7468 6f75 7420 7761 726e  es, without warn
+0000f600: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
+0000f610: 2020 2020 2020 2020 204e 6f6e 653a 2064           None: d
+0000f620: 6f20 6e6f 7420 7472 7920 746f 2072 6573  o not try to res
+0000f630: 6f6c 7665 2028 6174 2079 6f75 7220 6f77  olve (at your ow
+0000f640: 6e20 7269 736b 2129 0a20 2020 2020 2020  n risk!).       
+0000f650: 2020 2020 2020 2020 2066 6c61 7474 656e           flatten
+0000f660: 5f69 6e76 616c 6964 5f72 6566 733a 2066  _invalid_refs: f
+0000f670: 6c61 7474 656e 7320 636f 6d70 6f6e 656e  lattens componen
+0000f680: 7420 7265 6665 7265 6e63 6573 2077 6869  t references whi
+0000f690: 6368 2068 6176 6520 696e 7661 6c69 6420  ch have invalid 
+0000f6a0: 7472 616e 7366 6f72 6d61 7469 6f6e 732e  transformations.
+0000f6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f6c0: 206d 6178 5f70 6f69 6e74 733a 204d 6178   max_points: Max
+0000f6d0: 696d 616c 206e 756d 6265 7220 6f66 2076  imal number of v
+0000f6e0: 6572 7469 6365 7320 7065 7220 706f 6c79  ertices per poly
+0000f6f0: 676f 6e2e 2050 6f6c 7967 6f6e 7320 7769  gon. Polygons wi
+0000f700: 7468 206d 6f72 6520 7665 7274 6963 6573  th more vertices
+0000f710: 2074 6861 7420 7468 6973 2061 7265 2061   that this are a
+0000f720: 7574 6f6d 6174 6963 616c 6c79 2066 7261  utomatically fra
+0000f730: 6374 7572 6564 2e0a 0a20 2020 2020 2020  ctured...       
+0000f740: 2020 2020 204f 6173 6973 2073 6574 7469       Oasis setti
+0000f750: 6e67 733a 0a20 2020 2020 2020 2020 2020  ngs:.           
+0000f760: 2020 2020 2063 6f6d 7072 6573 7369 6f6e       compression
+0000f770: 5f6c 6576 656c 3a20 4c65 7665 6c20 6f66  _level: Level of
+0000f780: 2063 6f6d 7072 6573 7369 6f6e 2066 6f72   compression for
+0000f790: 2063 656c 6c73 2028 6265 7477 6565 6e20   cells (between 
+0000f7a0: 3020 616e 6420 3929 2e0a 2020 2020 2020  0 and 9)..      
+0000f7b0: 2020 2020 2020 2020 2020 2020 2020 5365                Se
+0000f7c0: 7474 696e 6720 746f 2030 2077 696c 6c20  tting to 0 will 
+0000f7d0: 6469 7361 626c 6520 6365 6c6c 2063 6f6d  disable cell com
+0000f7e0: 7072 6573 7369 6f6e 2c20 3120 6769 7665  pression, 1 give
+0000f7f0: 7320 7468 6520 6265 7374 2073 7065 6564  s the best speed
+0000f800: 2061 6e64 2039 2c20 7468 6520 6265 7374   and 9, the best
+0000f810: 2063 6f6d 7072 6573 7369 6f6e 2e0a 2020   compression..  
+0000f820: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0000f830: 7465 6374 5f72 6563 7461 6e67 6c65 733a  tect_rectangles:
+0000f840: 2053 746f 7265 2072 6563 7461 6e67 6c65   Store rectangle
+0000f850: 7320 696e 2063 6f6d 7072 6573 7365 6420  s in compressed 
+0000f860: 666f 726d 6174 2e0a 2020 2020 2020 2020  format..        
+0000f870: 2020 2020 2020 2020 6465 7465 6374 5f74          detect_t
+0000f880: 7261 7065 7a6f 6964 733a 2053 746f 7265  rapezoids: Store
+0000f890: 2074 7261 7065 7a6f 6964 7320 696e 2063   trapezoids in c
+0000f8a0: 6f6d 7072 6573 7365 6420 666f 726d 6174  ompressed format
+0000f8b0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f8c0: 2020 6369 7263 6c65 5f74 6f6c 6572 616e    circle_toleran
+0000f8d0: 6365 3a20 546f 6c65 7261 6e63 6520 666f  ce: Tolerance fo
+0000f8e0: 7220 6465 7465 6374 696e 6720 6369 7263  r detecting circ
+0000f8f0: 6c65 732e 2049 6620 6c65 7373 206f 7220  les. If less or 
+0000f900: 6571 7561 6c20 746f 2030 2c20 6e6f 2064  equal to 0, no d
+0000f910: 6574 6563 7469 6f6e 2069 7320 7065 7266  etection is perf
+0000f920: 6f72 6d65 642e 2043 6972 636c 6573 2061  ormed. Circles a
+0000f930: 7265 2073 746f 7265 6420 696e 2063 6f6d  re stored in com
+0000f940: 7072 6573 7365 6420 666f 726d 6174 2e0a  pressed format..
+0000f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f960: 7661 6c69 6461 7469 6f6e 2028 2263 7263  validation ("crc
+0000f970: 3332 222c 2022 6368 6563 6b73 756d 3332  32", "checksum32
+0000f980: 222c 204e 6f6e 6529 3a20 7479 7065 206f  ", None): type o
+0000f990: 6620 7661 6c69 6461 7469 6f6e 2074 6f20  f validation to 
+0000f9a0: 696e 636c 7564 6520 696e 2074 6865 2073  include in the s
+0000f9b0: 6176 6564 2066 696c 652e 0a20 2020 2020  aved file..     
+0000f9c0: 2020 2020 2020 2020 2020 2073 7461 6e64             stand
+0000f9d0: 6172 645f 7072 6f70 6572 7469 6573 3a20  ard_properties: 
+0000f9e0: 5374 6f72 6520 7374 616e 6461 7264 204f  Store standard O
+0000f9f0: 4153 4953 2070 726f 7065 7274 6965 7320  ASIS properties 
+0000fa00: 696e 2074 6865 2066 696c 652e 0a0a 2020  in the file...  
+0000fa10: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0000fa20: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000fa30: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
+0000fa40: 745f 6163 7469 7665 5f70 646b 0a0a 2020  t_active_pdk..  
+0000fa50: 2020 2020 2020 6966 2067 6473 7061 7468        if gdspath
+0000fa60: 2061 6e64 2067 6473 6469 723a 0a20 2020   and gdsdir:.   
+0000fa70: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0000fa80: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
+0000fa90: 2020 2020 2020 2020 2267 6473 7061 7468          "gdspath
+0000faa0: 2061 6e64 2067 6473 6469 7220 6861 7665   and gdsdir have
+0000fab0: 2062 6f74 6820 6265 656e 2073 7065 6369   both been speci
+0000fac0: 6669 6564 2e20 6764 7370 6174 6820 7769  fied. gdspath wi
+0000fad0: 6c6c 2074 616b 6520 7072 6563 6564 656e  ll take preceden
+0000fae0: 6365 2061 6e64 2067 6473 6469 7220 7769  ce and gdsdir wi
+0000faf0: 6c6c 2062 6520 6967 6e6f 7265 642e 222c  ll be ignored.",
+0000fb00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fb10: 2073 7461 636b 6c65 7665 6c3d 332c 0a20   stacklevel=3,. 
+0000fb20: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000fb30: 2020 2020 2020 6465 6661 756c 745f 7365        default_se
+0000fb40: 7474 696e 6773 203d 2067 6574 5f61 6374  ttings = get_act
+0000fb50: 6976 655f 7064 6b28 292e 6764 735f 7772  ive_pdk().gds_wr
+0000fb60: 6974 655f 7365 7474 696e 6773 0a20 2020  ite_settings.   
+0000fb70: 2020 2020 2064 6566 6175 6c74 5f6f 6173       default_oas
+0000fb80: 6973 5f73 6574 7469 6e67 7320 3d20 6765  is_settings = ge
+0000fb90: 745f 6163 7469 7665 5f70 646b 2829 2e6f  t_active_pdk().o
+0000fba0: 6173 6973 5f73 6574 7469 6e67 730a 0a20  asis_settings.. 
+0000fbb0: 2020 2020 2020 2065 7870 6c69 6369 745f         explicit_
+0000fbc0: 6764 735f 7365 7474 696e 6773 203d 207b  gds_settings = {
+0000fbd0: 0a20 2020 2020 2020 2020 2020 206b 3a20  .            k: 
+0000fbe0: 760a 2020 2020 2020 2020 2020 2020 666f  v.            fo
+0000fbf0: 7220 6b2c 2076 2069 6e20 6b77 6172 6773  r k, v in kwargs
+0000fc00: 2e69 7465 6d73 2829 0a20 2020 2020 2020  .items().       
+0000fc10: 2020 2020 2069 6620 7620 6973 206e 6f74       if v is not
+0000fc20: 204e 6f6e 6520 616e 6420 6b20 696e 2064   None and k in d
+0000fc30: 6566 6175 6c74 5f73 6574 7469 6e67 732e  efault_settings.
+0000fc40: 6d6f 6465 6c5f 6475 6d70 2829 0a20 2020  model_dump().   
+0000fc50: 2020 2020 207d 0a20 2020 2020 2020 2065       }.        e
+0000fc60: 7870 6c69 6369 745f 6f61 735f 7365 7474  xplicit_oas_sett
+0000fc70: 696e 6773 203d 207b 0a20 2020 2020 2020  ings = {.       
+0000fc80: 2020 2020 206b 3a20 760a 2020 2020 2020       k: v.      
+0000fc90: 2020 2020 2020 666f 7220 6b2c 2076 2069        for k, v i
+0000fca0: 6e20 6b77 6172 6773 2e69 7465 6d73 2829  n kwargs.items()
+0000fcb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000fcc0: 7620 6973 206e 6f74 204e 6f6e 6520 616e  v is not None an
+0000fcd0: 6420 6b20 696e 2064 6566 6175 6c74 5f6f  d k in default_o
+0000fce0: 6173 6973 5f73 6574 7469 6e67 732e 6d6f  asis_settings.mo
+0000fcf0: 6465 6c5f 6475 6d70 2829 0a20 2020 2020  del_dump().     
+0000fd00: 2020 207d 0a20 2020 2020 2020 2023 2075     }.        # u
+0000fd10: 7064 6174 6520 7468 6520 7772 6974 6520  pdate the write 
+0000fd20: 7365 7474 696e 6773 2077 6974 6820 616e  settings with an
+0000fd30: 7920 7365 7474 696e 6773 2065 7870 6c69  y settings expli
+0000fd40: 6369 746c 7920 7061 7373 6564 0a20 2020  citly passed.   
+0000fd50: 2020 2020 2077 7269 7465 5f73 6574 7469       write_setti
+0000fd60: 6e67 7320 3d20 6465 6661 756c 745f 7365  ngs = default_se
+0000fd70: 7474 696e 6773 2e6d 6f64 656c 5f63 6f70  ttings.model_cop
+0000fd80: 7928 7570 6461 7465 3d65 7870 6c69 6369  y(update=explici
+0000fd90: 745f 6764 735f 7365 7474 696e 6773 290a  t_gds_settings).
+0000fda0: 2020 2020 2020 2020 6f61 7369 735f 7365          oasis_se
+0000fdb0: 7474 696e 6773 203d 2064 6566 6175 6c74  ttings = default
+0000fdc0: 5f6f 6173 6973 5f73 6574 7469 6e67 732e  _oasis_settings.
+0000fdd0: 6d6f 6465 6c5f 636f 7079 2875 7064 6174  model_copy(updat
+0000fde0: 653d 6578 706c 6963 6974 5f6f 6173 5f73  e=explicit_oas_s
+0000fdf0: 6574 7469 6e67 7329 0a0a 2020 2020 2020  ettings)..      
+0000fe00: 2020 5f63 6865 636b 5f75 6e63 6163 6865    _check_uncache
+0000fe10: 645f 636f 6d70 6f6e 656e 7473 280a 2020  d_components(.  
+0000fe20: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
+0000fe30: 656e 743d 7365 6c66 2c20 6d6f 6465 3d77  ent=self, mode=w
+0000fe40: 7269 7465 5f73 6574 7469 6e67 732e 6f6e  rite_settings.on
+0000fe50: 5f75 6e63 6163 6865 645f 636f 6d70 6f6e  _uncached_compon
+0000fe60: 656e 740a 2020 2020 2020 2020 290a 0a20  ent.        ).. 
+0000fe70: 2020 2020 2020 2069 6620 7772 6974 655f         if write_
+0000fe80: 7365 7474 696e 6773 2e66 6c61 7474 656e  settings.flatten
+0000fe90: 5f69 6e76 616c 6964 5f72 6566 733a 0a20  _invalid_refs:. 
+0000fea0: 2020 2020 2020 2020 2020 2074 6f70 5f63             top_c
+0000feb0: 656c 6c20 3d20 666c 6174 7465 6e5f 696e  ell = flatten_in
+0000fec0: 7661 6c69 645f 7265 6673 5f72 6563 7572  valid_refs_recur
+0000fed0: 7369 7665 2873 656c 6629 0a20 2020 2020  sive(self).     
+0000fee0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000fef0: 2020 2020 2074 6f70 5f63 656c 6c20 3d20       top_cell = 
+0000ff00: 7365 6c66 0a0a 2020 2020 2020 2020 6764  self..        gd
+0000ff10: 7364 6972 203d 2067 6473 6469 7220 6f72  sdir = gdsdir or
+0000ff20: 2047 4453 4449 525f 5445 4d50 0a20 2020   GDSDIR_TEMP.   
+0000ff30: 2020 2020 2067 6473 6469 7220 3d20 7061       gdsdir = pa
+0000ff40: 7468 6c69 622e 5061 7468 2867 6473 6469  thlib.Path(gdsdi
+0000ff50: 7229 0a20 2020 2020 2020 2069 6620 7769  r).        if wi
+0000ff60: 7468 5f6f 6173 6973 3a0a 2020 2020 2020  th_oasis:.      
+0000ff70: 2020 2020 2020 6764 7370 6174 6820 3d20        gdspath = 
+0000ff80: 6764 7370 6174 6820 6f72 2067 6473 6469  gdspath or gdsdi
+0000ff90: 7220 2f20 6622 7b74 6f70 5f63 656c 6c2e  r / f"{top_cell.
+0000ffa0: 6e61 6d65 7d2e 6f61 7322 0a20 2020 2020  name}.oas".     
+0000ffb0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000ffc0: 2020 2020 2067 6473 7061 7468 203d 2067       gdspath = g
+0000ffd0: 6473 7061 7468 206f 7220 6764 7364 6972  dspath or gdsdir
+0000ffe0: 202f 2066 227b 746f 705f 6365 6c6c 2e6e   / f"{top_cell.n
+0000fff0: 616d 657d 2e67 6473 220a 2020 2020 2020  ame}.gds".      
+00010000: 2020 6764 7370 6174 6820 3d20 7061 7468    gdspath = path
+00010010: 6c69 622e 5061 7468 2867 6473 7061 7468  lib.Path(gdspath
+00010020: 290a 2020 2020 2020 2020 6764 7364 6972  ).        gdsdir
+00010030: 203d 2067 6473 7061 7468 2e70 6172 656e   = gdspath.paren
+00010040: 740a 2020 2020 2020 2020 6764 7364 6972  t.        gdsdir
+00010050: 2e6d 6b64 6972 2865 7869 7374 5f6f 6b3d  .mkdir(exist_ok=
+00010060: 5472 7565 2c20 7061 7265 6e74 733d 5472  True, parents=Tr
+00010070: 7565 290a 0a20 2020 2020 2020 2063 656c  ue)..        cel
+00010080: 6c73 203d 2074 6f70 5f63 656c 6c2e 6765  ls = top_cell.ge
+00010090: 745f 6465 7065 6e64 656e 6369 6573 2872  t_dependencies(r
+000100a0: 6563 7572 7369 7665 3d54 7275 6529 0a20  ecursive=True). 
+000100b0: 2020 2020 2020 2063 656c 6c5f 6e61 6d65         cell_name
+000100c0: 7320 3d20 5b63 656c 6c2e 6e61 6d65 2066  s = [cell.name f
+000100d0: 6f72 2063 656c 6c20 696e 206c 6973 7428  or cell in list(
+000100e0: 6365 6c6c 7329 5d0a 2020 2020 2020 2020  cells)].        
+000100f0: 6365 6c6c 5f6e 616d 6573 5f75 6e69 7175  cell_names_uniqu
+00010100: 6520 3d20 7365 7428 6365 6c6c 5f6e 616d  e = set(cell_nam
+00010110: 6573 290a 0a20 2020 2020 2020 2069 6620  es)..        if 
+00010120: 6c65 6e28 6365 6c6c 5f6e 616d 6573 2920  len(cell_names) 
+00010130: 213d 206c 656e 2873 6574 2863 656c 6c5f  != len(set(cell_
+00010140: 6e61 6d65 7329 293a 0a20 2020 2020 2020  names)):.       
+00010150: 2020 2020 2066 6f72 2063 656c 6c5f 6e61       for cell_na
+00010160: 6d65 2069 6e20 6365 6c6c 5f6e 616d 6573  me in cell_names
+00010170: 5f75 6e69 7175 653a 0a20 2020 2020 2020  _unique:.       
+00010180: 2020 2020 2020 2020 2063 656c 6c5f 6e61           cell_na
+00010190: 6d65 732e 7265 6d6f 7665 2863 656c 6c5f  mes.remove(cell_
+000101a0: 6e61 6d65 290a 0a20 2020 2020 2020 2020  name)..         
+000101b0: 2020 2069 6620 7772 6974 655f 7365 7474     if write_sett
+000101c0: 696e 6773 2e6f 6e5f 6475 706c 6963 6174  ings.on_duplicat
+000101d0: 655f 6365 6c6c 203d 3d20 2265 7272 6f72  e_cell == "error
+000101e0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+000101f0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00010200: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00010210: 2020 2020 2020 2020 2066 2244 7570 6c69           f"Dupli
+00010220: 6361 7465 6420 6365 6c6c 206e 616d 6573  cated cell names
+00010230: 2069 6e20 7b74 6f70 5f63 656c 6c2e 6e61   in {top_cell.na
+00010240: 6d65 2172 7d3a 207b 6365 6c6c 5f6e 616d  me!r}: {cell_nam
+00010250: 6573 2172 7d22 0a20 2020 2020 2020 2020  es!r}".         
+00010260: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00010270: 2020 2020 2065 6c69 6620 7772 6974 655f       elif write_
+00010280: 7365 7474 696e 6773 2e6f 6e5f 6475 706c  settings.on_dupl
+00010290: 6963 6174 655f 6365 6c6c 2069 6e20 7b22  icate_cell in {"
+000102a0: 7761 726e 222c 2022 6f76 6572 7772 6974  warn", "overwrit
+000102b0: 6522 7d3a 0a20 2020 2020 2020 2020 2020  e"}:.           
+000102c0: 2020 2020 2069 6620 7772 6974 655f 7365       if write_se
+000102d0: 7474 696e 6773 2e6f 6e5f 6475 706c 6963  ttings.on_duplic
+000102e0: 6174 655f 6365 6c6c 203d 3d20 2277 6172  ate_cell == "war
+000102f0: 6e22 3a0a 2020 2020 2020 2020 2020 2020  n":.            
+00010300: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+00010310: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
+00010320: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00010330: 2244 7570 6c69 6361 7465 6420 6365 6c6c  "Duplicated cell
+00010340: 206e 616d 6573 2069 6e20 7b74 6f70 5f63   names in {top_c
+00010350: 656c 6c2e 6e61 6d65 2172 7d3a 2020 7b63  ell.name!r}:  {c
+00010360: 656c 6c5f 6e61 6d65 737d 222c 0a20 2020  ell_names}",.   
+00010370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010380: 2020 2020 2073 7461 636b 6c65 7665 6c3d       stacklevel=
+00010390: 332c 0a20 2020 2020 2020 2020 2020 2020  3,.             
+000103a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000103b0: 2020 2020 2020 2020 2063 656c 6c73 5f64           cells_d
+000103c0: 6963 7420 3d20 7b63 656c 6c2e 6e61 6d65  ict = {cell.name
+000103d0: 3a20 6365 6c6c 2e5f 6365 6c6c 2066 6f72  : cell._cell for
+000103e0: 2063 656c 6c20 696e 2063 656c 6c73 7d0a   cell in cells}.
+000103f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010400: 6365 6c6c 7320 3d20 6365 6c6c 735f 6469  cells = cells_di
+00010410: 6374 2e76 616c 7565 7328 290a 2020 2020  ct.values().    
+00010420: 2020 2020 2020 2020 656c 6966 2077 7269          elif wri
+00010430: 7465 5f73 6574 7469 6e67 732e 6f6e 5f64  te_settings.on_d
+00010440: 7570 6c69 6361 7465 5f63 656c 6c20 6973  uplicate_cell is
+00010450: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00010460: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00010470: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00010480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010490: 2066 226f 6e5f 6475 706c 6963 6174 655f   f"on_duplicate_
+000104a0: 6365 6c6c 3a20 7b77 7269 7465 5f73 6574  cell: {write_set
+000104b0: 7469 6e67 732e 6f6e 5f64 7570 6c69 6361  tings.on_duplica
+000104c0: 7465 5f63 656c 6c21 727d 206e 6f74 2069  te_cell!r} not i
+000104d0: 6e20 284e 6f6e 652c 2077 6172 6e2c 2065  n (None, warn, e
+000104e0: 7272 6f72 2c20 6f76 6572 7772 6974 6529  rror, overwrite)
+000104f0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00010500: 2020 290a 0a20 2020 2020 2020 2061 6c6c    )..        all
+00010510: 5f63 656c 6c73 203d 205b 746f 705f 6365  _cells = [top_ce
+00010520: 6c6c 2e5f 6365 6c6c 5d20 2b20 736f 7274  ll._cell] + sort
+00010530: 6564 2863 656c 6c73 2c20 6b65 793d 6c61  ed(cells, key=la
+00010540: 6d62 6461 2063 633a 2063 632e 6e61 6d65  mbda cc: cc.name
+00010550: 290a 0a20 2020 2020 2020 206e 6f5f 6e61  )..        no_na
+00010560: 6d65 5f63 656c 6c73 203d 205b 0a20 2020  me_cells = [.   
+00010570: 2020 2020 2020 2020 2063 656c 6c2e 6e61           cell.na
+00010580: 6d65 2066 6f72 2063 656c 6c20 696e 2061  me for cell in a
+00010590: 6c6c 5f63 656c 6c73 2069 6620 6365 6c6c  ll_cells if cell
+000105a0: 2e6e 616d 652e 7374 6172 7473 7769 7468  .name.startswith
+000105b0: 2822 556e 6e61 6d65 6422 290a 2020 2020  ("Unnamed").    
+000105c0: 2020 2020 5d0a 0a20 2020 2020 2020 2069      ]..        i
+000105d0: 6620 6e6f 5f6e 616d 655f 6365 6c6c 733a  f no_name_cells:
+000105e0: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
+000105f0: 6e69 6e67 732e 7761 726e 280a 2020 2020  nings.warn(.    
+00010600: 2020 2020 2020 2020 2020 2020 6622 556e              f"Un
+00010610: 6e61 6d65 6420 6365 6c6c 732c 207b 6c65  named cells, {le
+00010620: 6e28 6e6f 5f6e 616d 655f 6365 6c6c 7329  n(no_name_cells)
+00010630: 7d20 696e 207b 746f 705f 6365 6c6c 2e6e  } in {top_cell.n
+00010640: 616d 6521 727d 222c 0a20 2020 2020 2020  ame!r}",.       
+00010650: 2020 2020 2020 2020 2073 7461 636b 6c65           stackle
+00010660: 7665 6c3d 332c 0a20 2020 2020 2020 2020  vel=3,.         
+00010670: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+00010680: 666f 7220 6365 6c6c 2069 6e20 616c 6c5f  for cell in all_
+00010690: 6365 6c6c 733a 0a20 2020 2020 2020 2023  cells:.        #
+000106a0: 2020 2020 2070 7269 6e74 2863 656c 6c2e       print(cell.
+000106b0: 6e61 6d65 2c20 7479 7065 2863 656c 6c29  name, type(cell)
+000106c0: 290a 0a20 2020 2020 2020 206c 6962 203d  )..        lib =
+000106d0: 2067 6473 746b 2e4c 6962 7261 7279 280a   gdstk.Library(.
+000106e0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+000106f0: 3d77 7269 7465 5f73 6574 7469 6e67 732e  =write_settings.
+00010700: 6c69 625f 6e61 6d65 2c0a 2020 2020 2020  lib_name,.      
+00010710: 2020 2020 2020 756e 6974 3d77 7269 7465        unit=write
+00010720: 5f73 6574 7469 6e67 732e 756e 6974 2c0a  _settings.unit,.
+00010730: 2020 2020 2020 2020 2020 2020 7072 6563              prec
+00010740: 6973 696f 6e3d 7772 6974 655f 7365 7474  ision=write_sett
+00010750: 696e 6773 2e70 7265 6369 7369 6f6e 2c0a  ings.precision,.
+00010760: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00010770: 2020 6c69 622e 6164 6428 746f 705f 6365    lib.add(top_ce
+00010780: 6c6c 2e5f 6365 6c6c 290a 2020 2020 2020  ll._cell).      
+00010790: 2020 6c69 622e 6164 6428 2a74 6f70 5f63    lib.add(*top_c
+000107a0: 656c 6c2e 5f63 656c 6c2e 6465 7065 6e64  ell._cell.depend
+000107b0: 656e 6369 6573 2854 7275 6529 290a 0a20  encies(True)).. 
+000107c0: 2020 2020 2020 2069 6620 7769 7468 5f6f         if with_o
+000107d0: 6173 6973 3a0a 2020 2020 2020 2020 2020  asis:.          
+000107e0: 2020 6c69 622e 7772 6974 655f 6f61 7328    lib.write_oas(
+000107f0: 6764 7370 6174 682c 202a 2a6f 6173 6973  gdspath, **oasis
+00010800: 5f73 6574 7469 6e67 732e 6469 6374 2829  _settings.dict()
+00010810: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00010820: 2020 2020 2020 2020 2020 2020 6c69 622e              lib.
+00010830: 7772 6974 655f 6764 7328 0a20 2020 2020  write_gds(.     
+00010840: 2020 2020 2020 2020 2020 2067 6473 7061             gdspa
+00010850: 7468 2c20 7469 6d65 7374 616d 703d 7469  th, timestamp=ti
+00010860: 6d65 7374 616d 702c 206d 6178 5f70 6f69  mestamp, max_poi
+00010870: 6e74 733d 7772 6974 655f 7365 7474 696e  nts=write_settin
+00010880: 6773 2e6d 6178 5f70 6f69 6e74 730a 2020  gs.max_points.  
+00010890: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000108a0: 2020 2020 6966 206c 6f67 6769 6e67 3a0a      if logging:.
+000108b0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+000108c0: 6572 2e69 6e66 6f28 6622 5772 6f74 6520  er.info(f"Wrote 
+000108d0: 746f 207b 7374 7228 6764 7370 6174 6829  to {str(gdspath)
+000108e0: 2172 7d22 290a 2020 2020 2020 2020 6966  !r}").        if
+000108f0: 2077 6974 685f 6d65 7461 6461 7461 3a0a   with_metadata:.
+00010900: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
+00010910: 6461 7461 203d 2067 6473 7061 7468 2e77  data = gdspath.w
+00010920: 6974 685f 7375 6666 6978 2822 2e79 6d6c  ith_suffix(".yml
+00010930: 2229 0a20 2020 2020 2020 2020 2020 206d  ").            m
+00010940: 6574 6164 6174 612e 7772 6974 655f 7465  etadata.write_te
+00010950: 7874 2873 656c 662e 746f 5f64 6963 745f  xt(self.to_dict_
+00010960: 7961 6d6c 2877 6974 685f 6365 6c6c 733d  yaml(with_cells=
+00010970: 5472 7565 2c20 7769 7468 5f70 6f72 7473  True, with_ports
+00010980: 3d54 7275 6529 290a 2020 2020 2020 2020  =True)).        
+00010990: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+000109a0: 6622 5772 6974 6520 5941 4d4c 206d 6574  f"Write YAML met
+000109b0: 6164 6174 6120 746f 207b 7374 7228 6d65  adata to {str(me
+000109c0: 7461 6461 7461 2921 727d 2229 0a0a 2020  tadata)!r}")..  
+000109d0: 2020 2020 2020 6966 2077 6974 685f 6e65        if with_ne
+000109e0: 746c 6973 743a 0a20 2020 2020 2020 2020  tlist:.         
+000109f0: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
+00010a00: 2020 2053 6176 6573 2074 6865 206e 6574     Saves the net
+00010a10: 6c69 7374 5f66 756e 6374 696f 6e20 6f75  list_function ou
+00010a20: 7470 7574 2074 6f20 6120 6a73 6f6e 2066  tput to a json f
+00010a30: 696c 652e 0a20 2020 2020 2020 2020 2020  ile..           
+00010a40: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
+00010a50: 2069 6d70 6f72 7420 6a73 6f6e 0a0a 2020   import json..  
+00010a60: 2020 2020 2020 2020 2020 6966 206e 6574            if net
+00010a70: 6c69 7374 5f66 756e 6374 696f 6e20 6973  list_function is
+00010a80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00010a90: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
+00010aa0: 6163 746f 7279 2e67 6574 5f6e 6574 6c69  actory.get_netli
+00010ab0: 7374 2069 6d70 6f72 7420 6765 745f 6e65  st import get_ne
+00010ac0: 746c 6973 740a 0a20 2020 2020 2020 2020  tlist..         
+00010ad0: 2020 2020 2020 206e 6574 6c69 7374 5f66         netlist_f
+00010ae0: 756e 6374 696f 6e20 3d20 6765 745f 6e65  unction = get_ne
+00010af0: 746c 6973 740a 0a20 2020 2020 2020 2020  tlist..         
+00010b00: 2020 206e 6574 6c69 7374 5f70 6174 6820     netlist_path 
+00010b10: 3d20 6764 7370 6174 682e 7769 7468 5f73  = gdspath.with_s
+00010b20: 7566 6669 7828 222e 6a73 6f6e 2229 0a20  uffix(".json"). 
+00010b30: 2020 2020 2020 2020 2020 206e 6574 6c69             netli
+00010b40: 7374 5f64 6963 7469 6f6e 6172 7920 3d20  st_dictionary = 
+00010b50: 6e65 746c 6973 745f 6675 6e63 7469 6f6e  netlist_function
+00010b60: 2863 6f6d 706f 6e65 6e74 3d73 656c 662c  (component=self,
+00010b70: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
+00010b80: 2020 2020 2020 206e 6574 6c69 7374 5f70         netlist_p
+00010b90: 6174 682e 7772 6974 655f 7465 7874 286a  ath.write_text(j
+00010ba0: 736f 6e2e 6475 6d70 7328 6e65 746c 6973  son.dumps(netlis
+00010bb0: 745f 6469 6374 696f 6e61 7279 2c20 696e  t_dictionary, in
+00010bc0: 6465 6e74 3d32 2929 0a0a 2020 2020 2020  dent=2))..      
+00010bd0: 2020 434f 4e46 2e6c 6173 745f 7361 7665    CONF.last_save
+00010be0: 645f 6669 6c65 732e 6170 7065 6e64 2867  d_files.append(g
+00010bf0: 6473 7061 7468 290a 2020 2020 2020 2020  dspath).        
+00010c00: 7265 7475 726e 2067 6473 7061 7468 0a0a  return gdspath..
+00010c10: 2020 2020 6465 6620 7772 6974 655f 6764      def write_gd
+00010c20: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+00010c30: 0a20 2020 2020 2020 2067 6473 7061 7468  .        gdspath
+00010c40: 3a20 5061 7468 5479 7065 207c 204e 6f6e  : PathType | Non
+00010c50: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00010c60: 2020 6764 7364 6972 3a20 5061 7468 5479    gdsdir: PathTy
+00010c70: 7065 207c 204e 6f6e 6520 3d20 4e6f 6e65  pe | None = None
+00010c80: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
+00010c90: 6773 2c0a 2020 2020 2920 2d3e 2050 6174  gs,.    ) -> Pat
+00010ca0: 683a 0a20 2020 2020 2020 2022 2222 5772  h:.        """Wr
+00010cb0: 6974 6520 636f 6d70 6f6e 656e 7420 746f  ite component to
+00010cc0: 2047 4453 2061 6e64 2072 6574 7572 6e73   GDS and returns
+00010cd0: 2067 6473 7061 7468 2e0a 0a20 2020 2020   gdspath...     
+00010ce0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00010cf0: 2020 2020 2067 6473 7061 7468 3a20 4744       gdspath: GD
+00010d00: 5320 6669 6c65 2070 6174 6820 746f 2077  S file path to w
+00010d10: 7269 7465 2074 6f2e 0a20 2020 2020 2020  rite to..       
+00010d20: 2020 2020 2067 6473 6469 723a 2064 6972       gdsdir: dir
+00010d30: 6563 746f 7279 2066 6f72 2074 6865 2047  ectory for the G
+00010d40: 4453 2066 696c 652e 2044 6566 6175 6c74  DS file. Default
+00010d50: 7320 746f 202f 746d 702f 7261 6e64 6f6d  s to /tmp/random
+00010d60: 4669 6c65 2f67 6473 6661 6374 6f72 792e  File/gdsfactory.
+00010d70: 0a0a 2020 2020 2020 2020 4b65 7977 6f72  ..        Keywor
+00010d80: 6420 4172 6773 3a0a 2020 2020 2020 2020  d Args:.        
+00010d90: 2020 2020 756e 6974 3a20 756e 6974 2073      unit: unit s
+00010da0: 697a 6520 666f 7220 6f62 6a65 6374 7320  ize for objects 
+00010db0: 696e 206c 6962 7261 7279 2e20 3175 6d20  in library. 1um 
+00010dc0: 6279 2064 6566 6175 6c74 2e0a 2020 2020  by default..    
+00010dd0: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
+00010de0: 6e3a 2066 6f72 2064 696d 656e 7369 6f6e  n: for dimension
+00010df0: 7320 696e 2074 6865 206c 6962 7261 7279  s in the library
+00010e00: 2028 6d29 2e20 316e 6d20 6279 2064 6566   (m). 1nm by def
+00010e10: 6175 6c74 2e0a 2020 2020 2020 2020 2020  ault..          
+00010e20: 2020 6c6f 6767 696e 673a 2064 6973 6162    logging: disab
+00010e30: 6c65 2047 4453 2070 6174 6820 6c6f 6767  le GDS path logg
+00010e40: 696e 672c 2066 6f72 2065 7861 6d70 6c65  ing, for example
+00010e50: 2066 6f72 2073 686f 7769 6e67 2069 7420   for showing it 
+00010e60: 696e 204b 4c61 796f 7574 2e0a 2020 2020  in KLayout..    
+00010e70: 2020 2020 2020 2020 6f6e 5f64 7570 6c69          on_dupli
+00010e80: 6361 7465 5f63 656c 6c3a 2073 7065 6369  cate_cell: speci
+00010e90: 6679 2068 6f77 2074 6f20 7265 736f 6c76  fy how to resolv
+00010ea0: 6520 6475 706c 6963 6174 652d 6e61 6d65  e duplicate-name
+00010eb0: 6420 6365 6c6c 732e 2043 686f 6f73 6520  d cells. Choose 
+00010ec0: 6f6e 6520 6f66 2074 6865 2066 6f6c 6c6f  one of the follo
+00010ed0: 7769 6e67 3a0a 2020 2020 2020 2020 2020  wing:.          
+00010ee0: 2020 2020 2020 2277 6172 6e22 2028 6465        "warn" (de
+00010ef0: 6661 756c 7429 3a20 6f76 6572 7772 6974  fault): overwrit
+00010f00: 6520 616c 6c20 6475 706c 6963 6174 6520  e all duplicate 
+00010f10: 6365 6c6c 7320 7769 7468 206f 6e65 206f  cells with one o
+00010f20: 6620 7468 6520 6475 706c 6963 6174 6573  f the duplicates
+00010f30: 2028 6172 6269 7472 6172 696c 7929 2e0a   (arbitrarily)..
+00010f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f50: 2265 7272 6f72 223a 2074 6872 6f77 2061  "error": throw a
+00010f60: 2056 616c 7565 4572 726f 7220 7768 656e   ValueError when
+00010f70: 2061 7474 656d 7074 696e 6720 746f 2077   attempting to w
+00010f80: 7269 7465 2061 2067 6473 2077 6974 6820  rite a gds with 
+00010f90: 6475 706c 6963 6174 6520 6365 6c6c 732e  duplicate cells.
+00010fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010fb0: 2022 6f76 6572 7772 6974 6522 3a20 6f76   "overwrite": ov
+00010fc0: 6572 7772 6974 6520 616c 6c20 6475 706c  erwrite all dupl
+00010fd0: 6963 6174 6520 6365 6c6c 7320 7769 7468  icate cells with
+00010fe0: 206f 6e65 206f 6620 7468 6520 6475 706c   one of the dupl
+00010ff0: 6963 6174 6573 2c20 7769 7468 6f75 7420  icates, without 
+00011000: 7761 726e 696e 672e 0a20 2020 2020 2020  warning..       
+00011010: 2020 2020 206f 6e5f 756e 6361 6368 6564       on_uncached
+00011020: 5f63 6f6d 706f 6e65 6e74 3a20 4c69 7465  _component: Lite
+00011030: 7261 6c5b 2277 6172 6e22 2c20 2265 7272  ral["warn", "err
+00011040: 6f72 225d 203d 2022 7761 726e 220a 2020  or"] = "warn".  
+00011050: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
+00011060: 6e5f 696e 7661 6c69 645f 7265 6673 3a20  n_invalid_refs: 
+00011070: 666c 6174 7465 6e73 2063 6f6d 706f 6e65  flattens compone
+00011080: 6e74 2072 6566 6572 656e 6365 7320 7768  nt references wh
+00011090: 6963 6820 6861 7665 2069 6e76 616c 6964  ich have invalid
+000110a0: 2074 7261 6e73 666f 726d 6174 696f 6e73   transformations
+000110b0: 2e0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
+000110c0: 785f 706f 696e 7473 3a20 4d61 7869 6d61  x_points: Maxima
+000110d0: 6c20 6e75 6d62 6572 206f 6620 7665 7274  l number of vert
+000110e0: 6963 6573 2070 6572 2070 6f6c 7967 6f6e  ices per polygon
+000110f0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011100: 2020 506f 6c79 676f 6e73 2077 6974 6820    Polygons with 
+00011110: 6d6f 7265 2076 6572 7469 6365 7320 7468  more vertices th
+00011120: 6174 2074 6869 7320 6172 6520 6175 746f  at this are auto
+00011130: 6d61 7469 6361 6c6c 7920 6672 6163 7475  matically fractu
+00011140: 7265 642e 0a20 2020 2020 2020 2020 2020  red..           
+00011150: 2077 6974 685f 6d65 7461 6461 7461 3a20   with_metadata: 
+00011160: 7772 6974 6573 206d 6574 6164 6174 6120  writes metadata 
+00011170: 696e 2059 414d 4c20 666f 726d 6174 2e0a  in YAML format..
+00011180: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00011190: 5f6e 6574 6c69 7374 3a20 7772 6974 6573  _netlist: writes
+000111a0: 2061 206e 6574 6c69 7374 2069 6e20 4a53   a netlist in JS
+000111b0: 4f4e 2066 6f72 6d61 742e 0a20 2020 2020  ON format..     
+000111c0: 2020 2020 2020 206e 6574 6c69 7374 5f66         netlist_f
+000111d0: 756e 6374 696f 6e3a 2066 756e 6374 696f  unction: functio
+000111e0: 6e20 746f 2067 656e 6572 6174 6520 7468  n to generate th
+000111f0: 6520 6e65 746c 6973 742e 0a20 2020 2020  e netlist..     
+00011200: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00011210: 7265 7475 726e 2073 656c 662e 5f77 7269  return self._wri
+00011220: 7465 5f6c 6962 7261 7279 280a 2020 2020  te_library(.    
+00011230: 2020 2020 2020 2020 6764 7370 6174 683d          gdspath=
+00011240: 6764 7370 6174 682c 2067 6473 6469 723d  gdspath, gdsdir=
+00011250: 6764 7364 6972 2c20 7769 7468 5f6f 6173  gdsdir, with_oas
+00011260: 6973 3d46 616c 7365 2c20 2a2a 6b77 6172  is=False, **kwar
+00011270: 6773 0a20 2020 2020 2020 2029 0a0a 2020  gs.        )..  
+00011280: 2020 6465 6620 7772 6974 655f 6f61 7328    def write_oas(
+00011290: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+000112a0: 2020 2020 2020 2067 6473 7061 7468 3a20         gdspath: 
+000112b0: 5061 7468 5479 7065 207c 204e 6f6e 6520  PathType | None 
+000112c0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000112d0: 6764 7364 6972 3a20 5061 7468 5479 7065  gdsdir: PathType
+000112e0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+000112f0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+00011300: 2c0a 2020 2020 2920 2d3e 2050 6174 683a  ,.    ) -> Path:
+00011310: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
+00011320: 6520 636f 6d70 6f6e 656e 7420 746f 2047  e component to G
+00011330: 4453 2061 6e64 2072 6574 7572 6e73 2067  DS and returns g
+00011340: 6473 7061 7468 2e0a 0a20 2020 2020 2020  dspath...       
+00011350: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00011360: 2020 2067 6473 7061 7468 3a20 4744 5320     gdspath: GDS 
+00011370: 6669 6c65 2070 6174 6820 746f 2077 7269  file path to wri
+00011380: 7465 2074 6f2e 0a20 2020 2020 2020 2020  te to..         
+00011390: 2020 2067 6473 6469 723a 2064 6972 6563     gdsdir: direc
+000113a0: 746f 7279 2066 6f72 2074 6865 2047 4453  tory for the GDS
+000113b0: 2066 696c 652e 2044 6566 6175 6c74 7320   file. Defaults 
+000113c0: 746f 202f 746d 702f 7261 6e64 6f6d 4669  to /tmp/randomFi
+000113d0: 6c65 2f67 6473 6661 6374 6f72 792e 0a0a  le/gdsfactory...
+000113e0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+000113f0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00011400: 2020 756e 6974 3a20 756e 6974 2073 697a    unit: unit siz
+00011410: 6520 666f 7220 6f62 6a65 6374 7320 696e  e for objects in
+00011420: 206c 6962 7261 7279 2e20 3175 6d20 6279   library. 1um by
+00011430: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
+00011440: 2020 2020 2020 7072 6563 6973 696f 6e3a        precision:
+00011450: 2066 6f72 2064 696d 656e 7369 6f6e 7320   for dimensions 
+00011460: 696e 2074 6865 206c 6962 7261 7279 2028  in the library (
+00011470: 6d29 2e20 316e 6d20 6279 2064 6566 6175  m). 1nm by defau
+00011480: 6c74 2e0a 2020 2020 2020 2020 2020 2020  lt..            
+00011490: 6c6f 6767 696e 673a 2064 6973 6162 6c65  logging: disable
+000114a0: 2047 4453 2070 6174 6820 6c6f 6767 696e   GDS path loggin
+000114b0: 672c 2066 6f72 2065 7861 6d70 6c65 2066  g, for example f
+000114c0: 6f72 2073 686f 7769 6e67 2069 7420 696e  or showing it in
+000114d0: 204b 4c61 796f 7574 2e0a 2020 2020 2020   KLayout..      
+000114e0: 2020 2020 2020 6f6e 5f64 7570 6c69 6361        on_duplica
+000114f0: 7465 5f63 656c 6c3a 2073 7065 6369 6679  te_cell: specify
+00011500: 2068 6f77 2074 6f20 7265 736f 6c76 6520   how to resolve 
+00011510: 6475 706c 6963 6174 652d 6e61 6d65 6420  duplicate-named 
+00011520: 6365 6c6c 732e 2043 686f 6f73 6520 6f6e  cells. Choose on
+00011530: 6520 6f66 2074 6865 2066 6f6c 6c6f 7769  e of the followi
+00011540: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
+00011550: 2020 2020 2277 6172 6e22 2028 6465 6661      "warn" (defa
+00011560: 756c 7429 3a20 6f76 6572 7772 6974 6520  ult): overwrite 
+00011570: 616c 6c20 6475 706c 6963 6174 6520 6365  all duplicate ce
+00011580: 6c6c 7320 7769 7468 206f 6e65 206f 6620  lls with one of 
+00011590: 7468 6520 6475 706c 6963 6174 6573 2028  the duplicates (
+000115a0: 6172 6269 7472 6172 696c 7929 2e0a 2020  arbitrarily)..  
+000115b0: 2020 2020 2020 2020 2020 2020 2020 2265                "e
+000115c0: 7272 6f72 223a 2074 6872 6f77 2061 2056  rror": throw a V
+000115d0: 616c 7565 4572 726f 7220 7768 656e 2061  alueError when a
+000115e0: 7474 656d 7074 696e 6720 746f 2077 7269  ttempting to wri
+000115f0: 7465 2061 2067 6473 2077 6974 6820 6475  te a gds with du
+00011600: 706c 6963 6174 6520 6365 6c6c 732e 0a20  plicate cells.. 
+00011610: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00011620: 6f76 6572 7772 6974 6522 3a20 6f76 6572  overwrite": over
+00011630: 7772 6974 6520 616c 6c20 6475 706c 6963  write all duplic
+00011640: 6174 6520 6365 6c6c 7320 7769 7468 206f  ate cells with o
+00011650: 6e65 206f 6620 7468 6520 6475 706c 6963  ne of the duplic
+00011660: 6174 6573 2c20 7769 7468 6f75 7420 7761  ates, without wa
+00011670: 726e 696e 672e 0a20 2020 2020 2020 2020  rning..         
+00011680: 2020 2020 2020 204e 6f6e 653a 2064 6f20         None: do 
+00011690: 6e6f 7420 7472 7920 746f 2072 6573 6f6c  not try to resol
+000116a0: 7665 2028 6174 2079 6f75 7220 6f77 6e20  ve (at your own 
+000116b0: 7269 736b 2129 0a20 2020 2020 2020 2020  risk!).         
+000116c0: 2020 206f 6e5f 756e 6361 6368 6564 5f63     on_uncached_c
+000116d0: 6f6d 706f 6e65 6e74 3a20 4c69 7465 7261  omponent: Litera
+000116e0: 6c5b 2277 6172 6e22 2c20 2265 7272 6f72  l["warn", "error
+000116f0: 225d 203d 2022 7761 726e 220a 2020 2020  "] = "warn".    
+00011700: 2020 2020 2020 2020 666c 6174 7465 6e5f          flatten_
+00011710: 696e 7661 6c69 645f 7265 6673 3a20 666c  invalid_refs: fl
+00011720: 6174 7465 6e73 2063 6f6d 706f 6e65 6e74  attens component
+00011730: 2072 6566 6572 656e 6365 7320 7768 6963   references whic
+00011740: 6820 6861 7665 2069 6e76 616c 6964 2074  h have invalid t
+00011750: 7261 6e73 666f 726d 6174 696f 6e73 2e0a  ransformations..
+00011760: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00011770: 7265 7373 696f 6e5f 6c65 7665 6c3a 204c  ression_level: L
+00011780: 6576 656c 206f 6620 636f 6d70 7265 7373  evel of compress
+00011790: 696f 6e20 666f 7220 6365 6c6c 7320 2862  ion for cells (b
+000117a0: 6574 7765 656e 2030 2061 6e64 2039 292e  etween 0 and 9).
+000117b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000117c0: 2053 6574 7469 6e67 2074 6f20 3020 7769   Setting to 0 wi
+000117d0: 6c6c 2064 6973 6162 6c65 2063 656c 6c20  ll disable cell 
+000117e0: 636f 6d70 7265 7373 696f 6e2c 2031 2067  compression, 1 g
+000117f0: 6976 6573 2074 6865 2062 6573 7420 7370  ives the best sp
+00011800: 6565 6420 616e 6420 392c 2074 6865 2062  eed and 9, the b
+00011810: 6573 7420 636f 6d70 7265 7373 696f 6e2e  est compression.
+00011820: 0a20 2020 2020 2020 2020 2020 2064 6574  .            det
+00011830: 6563 745f 7265 6374 616e 676c 6573 3a20  ect_rectangles: 
+00011840: 5374 6f72 6520 7265 6374 616e 676c 6573  Store rectangles
+00011850: 2069 6e20 636f 6d70 7265 7373 6564 2066   in compressed f
+00011860: 6f72 6d61 742e 0a20 2020 2020 2020 2020  ormat..         
+00011870: 2020 2064 6574 6563 745f 7472 6170 657a     detect_trapez
+00011880: 6f69 6473 3a20 5374 6f72 6520 7472 6170  oids: Store trap
+00011890: 657a 6f69 6473 2069 6e20 636f 6d70 7265  ezoids in compre
+000118a0: 7373 6564 2066 6f72 6d61 742e 0a20 2020  ssed format..   
+000118b0: 2020 2020 2020 2020 2063 6972 636c 655f           circle_
+000118c0: 746f 6c65 7261 6e63 653a 2054 6f6c 6572  tolerance: Toler
+000118d0: 616e 6365 2066 6f72 2064 6574 6563 7469  ance for detecti
+000118e0: 6e67 2063 6972 636c 6573 2e20 4966 206c  ng circles. If l
+000118f0: 6573 7320 6f72 2065 7175 616c 2074 6f20  ess or equal to 
+00011900: 302c 206e 6f20 6465 7465 6374 696f 6e20  0, no detection 
+00011910: 6973 2070 6572 666f 726d 6564 2e0a 2020  is performed..  
+00011920: 2020 2020 2020 2020 2020 2020 2020 4369                Ci
+00011930: 7263 6c65 7320 6172 6520 7374 6f72 6564  rcles are stored
+00011940: 2069 6e20 636f 6d70 7265 7373 6564 2066   in compressed f
+00011950: 6f72 6d61 742e 0a20 2020 2020 2020 2020  ormat..         
+00011960: 2020 2076 616c 6964 6174 696f 6e20 2822     validation ("
+00011970: 6372 6333 3222 2c20 2263 6865 636b 7375  crc32", "checksu
+00011980: 6d33 3222 2c20 4e6f 6e65 2920 e280 9320  m32", None) ... 
+00011990: 7479 7065 206f 6620 7661 6c69 6461 7469  type of validati
+000119a0: 6f6e 2074 6f20 696e 636c 7564 6520 696e  on to include in
+000119b0: 2074 6865 2073 6176 6564 2066 696c 652e   the saved file.
+000119c0: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+000119d0: 6e64 6172 645f 7072 6f70 6572 7469 6573  ndard_properties
+000119e0: 3a20 5374 6f72 6520 7374 616e 6461 7264  : Store standard
+000119f0: 204f 4153 4953 2070 726f 7065 7274 6965   OASIS propertie
+00011a00: 7320 696e 2074 6865 2066 696c 652e 0a20  s in the file.. 
+00011a10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00011a20: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00011a30: 7772 6974 655f 6c69 6272 6172 7928 0a20  write_library(. 
+00011a40: 2020 2020 2020 2020 2020 2067 6473 7061             gdspa
+00011a50: 7468 3d67 6473 7061 7468 2c0a 2020 2020  th=gdspath,.    
+00011a60: 2020 2020 2020 2020 6764 7364 6972 3d67          gdsdir=g
+00011a70: 6473 6469 722c 0a20 2020 2020 2020 2020  dsdir,.         
+00011a80: 2020 2077 6974 685f 6f61 7369 733d 5472     with_oasis=Tr
+00011a90: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00011aa0: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
+00011ab0: 2020 290a 0a20 2020 2064 6566 2074 6f5f    )..    def to_
+00011ac0: 6469 6374 280a 2020 2020 2020 2020 7365  dict(.        se
+00011ad0: 6c66 2c0a 2020 2020 2020 2020 6967 6e6f  lf,.        igno
+00011ae0: 7265 5f63 6f6d 706f 6e65 6e74 735f 7072  re_components_pr
+00011af0: 6566 6978 3a20 6c69 7374 5b73 7472 5d20  efix: list[str] 
+00011b00: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00011b10: 2020 2020 2020 2069 676e 6f72 655f 6675         ignore_fu
+00011b20: 6e63 7469 6f6e 735f 7072 6566 6978 3a20  nctions_prefix: 
+00011b30: 6c69 7374 5b73 7472 5d20 7c20 4e6f 6e65  list[str] | None
+00011b40: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00011b50: 2077 6974 685f 6365 6c6c 733a 2062 6f6f   with_cells: boo
+00011b60: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+00011b70: 2020 2077 6974 685f 706f 7274 733a 2062     with_ports: b
+00011b80: 6f6f 6c20 3d20 5472 7565 2c0a 2020 2020  ool = True,.    
+00011b90: 2920 2d3e 2064 6963 745b 7374 722c 2041  ) -> dict[str, A
+00011ba0: 6e79 5d3a 0a20 2020 2020 2020 2022 2222  ny]:.        """
+00011bb0: 5265 7475 726e 7320 4469 6374 2072 6570  Returns Dict rep
+00011bc0: 7265 7365 6e74 6174 696f 6e20 6f66 2061  resentation of a
+00011bd0: 2063 6f6d 706f 6e65 6e74 2e0a 0a20 2020   component...   
+00011be0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+00011bf0: 2020 2020 2020 2069 676e 6f72 655f 636f         ignore_co
+00011c00: 6d70 6f6e 656e 7473 5f70 7265 6669 783a  mponents_prefix:
+00011c10: 2066 6f72 2063 6f6d 706f 6e65 6e74 7320   for components 
+00011c20: 746f 2069 676e 6f72 6520 7768 656e 2065  to ignore when e
+00011c30: 7870 6f72 7469 6e67 2e0a 2020 2020 2020  xporting..      
+00011c40: 2020 2020 2020 6967 6e6f 7265 5f66 756e        ignore_fun
+00011c50: 6374 696f 6e73 5f70 7265 6669 783a 2066  ctions_prefix: f
+00011c60: 6f72 2066 756e 6374 696f 6e73 2074 6f20  or functions to 
+00011c70: 6967 6e6f 7265 2077 6865 6e20 6578 706f  ignore when expo
+00011c80: 7274 696e 672e 0a20 2020 2020 2020 2020  rting..         
+00011c90: 2020 2077 6974 685f 6365 6c6c 733a 2077     with_cells: w
+00011ca0: 7269 7465 2063 656c 6c73 2072 6563 7572  rite cells recur
+00011cb0: 7369 7665 6c79 2e0a 2020 2020 2020 2020  sively..        
+00011cc0: 2020 2020 7769 7468 5f70 6f72 7473 3a20      with_ports: 
+00011cd0: 7772 6974 6520 706f 7274 2069 6e66 6f72  write port infor
+00011ce0: 6d61 7469 6f6e 2064 6963 742e 0a20 2020  mation dict..   
+00011cf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00011d00: 2064 203d 207b 7d0a 2020 2020 2020 2020   d = {}.        
+00011d10: 6966 2077 6974 685f 706f 7274 733a 0a20  if with_ports:. 
+00011d20: 2020 2020 2020 2020 2020 2070 6f72 7473             ports
+00011d30: 203d 207b 706f 7274 2e6e 616d 653a 2070   = {port.name: p
+00011d40: 6f72 742e 746f 5f64 6963 7428 2920 666f  ort.to_dict() fo
+00011d50: 7220 706f 7274 2069 6e20 7365 6c66 2e67  r port in self.g
+00011d60: 6574 5f70 6f72 7473 5f6c 6973 7428 297d  et_ports_list()}
+00011d70: 0a20 2020 2020 2020 2020 2020 2064 5b22  .            d["
+00011d80: 706f 7274 7322 5d20 3d20 706f 7274 730a  ports"] = ports.
+00011d90: 0a20 2020 2020 2020 2069 6620 7769 7468  .        if with
+00011da0: 5f63 656c 6c73 3a0a 2020 2020 2020 2020  _cells:.        
+00011db0: 2020 2020 6365 6c6c 7320 3d20 7265 6375      cells = recu
+00011dc0: 7273 655f 7374 7275 6374 7572 6573 280a  rse_structures(.
+00011dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011de0: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+00011df0: 2020 2020 2020 6967 6e6f 7265 5f66 756e        ignore_fun
+00011e00: 6374 696f 6e73 5f70 7265 6669 783d 6967  ctions_prefix=ig
+00011e10: 6e6f 7265 5f66 756e 6374 696f 6e73 5f70  nore_functions_p
+00011e20: 7265 6669 782c 0a20 2020 2020 2020 2020  refix,.         
+00011e30: 2020 2020 2020 2069 676e 6f72 655f 636f         ignore_co
+00011e40: 6d70 6f6e 656e 7473 5f70 7265 6669 783d  mponents_prefix=
+00011e50: 6967 6e6f 7265 5f63 6f6d 706f 6e65 6e74  ignore_component
+00011e60: 735f 7072 6566 6978 2c0a 2020 2020 2020  s_prefix,.      
+00011e70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00011e80: 2020 2020 645b 2263 656c 6c73 225d 203d      d["cells"] =
+00011e90: 2063 6c65 616e 5f64 6963 7428 6365 6c6c   clean_dict(cell
+00011ea0: 7329 0a0a 2020 2020 2020 2020 645b 226e  s)..        d["n
+00011eb0: 616d 6522 5d20 3d20 7365 6c66 2e6e 616d  ame"] = self.nam
+00011ec0: 650a 2020 2020 2020 2020 645b 2273 6574  e.        d["set
+00011ed0: 7469 6e67 7322 5d20 3d20 636c 6561 6e5f  tings"] = clean_
+00011ee0: 6469 6374 2864 6963 7428 7365 6c66 2e73  dict(dict(self.s
+00011ef0: 6574 7469 6e67 7329 290a 2020 2020 2020  ettings)).      
+00011f00: 2020 645b 2269 6e66 6f22 5d20 3d20 636c    d["info"] = cl
+00011f10: 6561 6e5f 6469 6374 2864 6963 7428 7365  ean_dict(dict(se
+00011f20: 6c66 2e69 6e66 6f29 290a 2020 2020 2020  lf.info)).      
+00011f30: 2020 645b 2266 756e 6374 696f 6e5f 6e61    d["function_na
+00011f40: 6d65 225d 203d 2073 656c 662e 6675 6e63  me"] = self.func
+00011f50: 7469 6f6e 5f6e 616d 650a 2020 2020 2020  tion_name.      
+00011f60: 2020 645b 226d 6f64 756c 6522 5d20 3d20    d["module"] = 
+00011f70: 7365 6c66 2e6d 6f64 756c 650a 2020 2020  self.module.    
+00011f80: 2020 2020 7265 7475 726e 2064 0a0a 2020      return d..  
+00011f90: 2020 6465 6620 746f 5f64 6963 745f 7961    def to_dict_ya
+00011fa0: 6d6c 2873 656c 662c 202a 2a6b 7761 7267  ml(self, **kwarg
+00011fb0: 7329 202d 3e20 7374 723a 0a20 2020 2020  s) -> str:.     
+00011fc0: 2020 2022 2222 5772 6974 6520 4469 6374     """Write Dict
+00011fd0: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
+00011fe0: 6f66 2061 2063 6f6d 706f 6e65 6e74 2069  of a component i
+00011ff0: 6e20 5941 4d4c 2066 6f72 6d61 742e 0a0a  n YAML format...
+00012000: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00012010: 2020 2020 2020 2020 2020 6967 6e6f 7265            ignore
+00012020: 5f63 6f6d 706f 6e65 6e74 735f 7072 6566  _components_pref
+00012030: 6978 3a20 666f 7220 636f 6d70 6f6e 656e  ix: for componen
+00012040: 7473 2074 6f20 6967 6e6f 7265 2077 6865  ts to ignore whe
+00012050: 6e20 6578 706f 7274 696e 672e 0a20 2020  n exporting..   
+00012060: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
+00012070: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
+00012080: 3a20 666f 7220 6675 6e63 7469 6f6e 7320  : for functions 
+00012090: 746f 2069 676e 6f72 6520 7768 656e 2065  to ignore when e
+000120a0: 7870 6f72 7469 6e67 2e0a 2020 2020 2020  xporting..      
+000120b0: 2020 2020 2020 7769 7468 5f63 656c 6c73        with_cells
+000120c0: 3a20 7772 6974 6520 6365 6c6c 7320 7265  : write cells re
+000120d0: 6375 7273 6976 656c 792e 0a20 2020 2020  cursively..     
+000120e0: 2020 2020 2020 2077 6974 685f 706f 7274         with_port
+000120f0: 733a 2077 7269 7465 2070 6f72 7420 696e  s: write port in
+00012100: 666f 726d 6174 696f 6e2e 0a20 2020 2020  formation..     
+00012110: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00012120: 6574 7572 6e20 7961 6d6c 2e64 756d 7028  eturn yaml.dump(
+00012130: 636c 6561 6e5f 6469 6374 2873 656c 662e  clean_dict(self.
+00012140: 746f 5f64 6963 7428 2a2a 6b77 6172 6773  to_dict(**kwargs
+00012150: 2929 290a 0a20 2020 2064 6566 2061 7574  )))..    def aut
+00012160: 6f5f 7265 6e61 6d65 5f70 6f72 7473 2873  o_rename_ports(s
+00012170: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
+00012180: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00012190: 2222 2252 656e 616d 6520 706f 7274 7320  """Rename ports 
+000121a0: 6279 206f 7269 656e 7461 7469 6f6e 204e  by orientation N
+000121b0: 5345 5720 286e 6f72 7468 2c20 736f 7574  SEW (north, sout
+000121c0: 682c 2065 6173 742c 2077 6573 7429 2e0a  h, east, west)..
+000121d0: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
+000121e0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+000121f0: 2020 2066 756e 6374 696f 6e3a 2074 6f20     function: to 
+00012200: 7265 6e61 6d65 2070 6f72 7473 2e0a 2020  rename ports..  
+00012210: 2020 2020 2020 2020 2020 7365 6c65 6374            select
+00012220: 5f70 6f72 7473 5f6f 7074 6963 616c 3a20  _ports_optical: 
+00012230: 746f 2073 656c 6563 7420 6f70 7469 6361  to select optica
+00012240: 6c20 706f 7274 732e 0a20 2020 2020 2020  l ports..       
+00012250: 2020 2020 2073 656c 6563 745f 706f 7274       select_port
+00012260: 735f 656c 6563 7472 6963 616c 3a20 746f  s_electrical: to
+00012270: 2073 656c 6563 7420 656c 6563 7472 6963   select electric
+00012280: 616c 2070 6f72 7473 2e0a 2020 2020 2020  al ports..      
+00012290: 2020 2020 2020 7072 6566 6978 5f6f 7074        prefix_opt
+000122a0: 6963 616c 3a20 7072 6566 6978 2e0a 2020  ical: prefix..  
+000122b0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+000122c0: 5f65 6c65 6374 7269 6361 6c3a 2070 7265  _electrical: pre
+000122d0: 6669 782e 0a0a 2020 2020 2020 2020 2e2e  fix...        ..
+000122e0: 2063 6f64 653a 3a0a 0a20 2020 2020 2020   code::..       
+000122f0: 2020 2020 2020 2020 2020 2033 2020 340a             3  4.
+00012300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012310: 205f 7c5f 5f7c 5f0a 2020 2020 2020 2020   _|__|_.        
+00012320: 2020 2020 2032 202d 7c20 2020 2020 207c       2 -|      |
+00012330: 2d20 350a 2020 2020 2020 2020 2020 2020  - 5.            
+00012340: 2020 2020 7c20 2020 2020 207c 0a20 2020      |      |.   
+00012350: 2020 2020 2020 2020 2020 3120 2d7c 5f5f            1 -|__
+00012360: 5f5f 5f5f 7c2d 2036 0a20 2020 2020 2020  ____|- 6.       
+00012370: 2020 2020 2020 2020 2020 207c 2020 7c0a             |  |.
+00012380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012390: 2020 3820 2037 0a20 2020 2020 2020 2022    8  7.        "
+000123a0: 2222 0a20 2020 2020 2020 2061 7574 6f5f  "".        auto_
+000123b0: 7265 6e61 6d65 5f70 6f72 7473 2873 656c  rename_ports(sel
+000123c0: 662c 202a 2a6b 7761 7267 7329 0a0a 2020  f, **kwargs)..  
+000123d0: 2020 6465 6620 6175 746f 5f72 656e 616d    def auto_renam
+000123e0: 655f 706f 7274 735f 636f 756e 7465 725f  e_ports_counter_
+000123f0: 636c 6f63 6b77 6973 6528 7365 6c66 2c20  clockwise(self, 
+00012400: 2a2a 6b77 6172 6773 2920 2d3e 204e 6f6e  **kwargs) -> Non
+00012410: 653a 0a20 2020 2020 2020 2061 7574 6f5f  e:.        auto_
+00012420: 7265 6e61 6d65 5f70 6f72 7473 5f63 6f75  rename_ports_cou
+00012430: 6e74 6572 5f63 6c6f 636b 7769 7365 2873  nter_clockwise(s
+00012440: 656c 662c 202a 2a6b 7761 7267 7329 0a0a  elf, **kwargs)..
+00012450: 2020 2020 6465 6620 6175 746f 5f72 656e      def auto_ren
+00012460: 616d 655f 706f 7274 735f 6c61 7965 725f  ame_ports_layer_
+00012470: 6f72 6965 6e74 6174 696f 6e28 7365 6c66  orientation(self
+00012480: 2c20 2a2a 6b77 6172 6773 2920 2d3e 204e  , **kwargs) -> N
+00012490: 6f6e 653a 0a20 2020 2020 2020 2061 7574  one:.        aut
+000124a0: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f6c  o_rename_ports_l
+000124b0: 6179 6572 5f6f 7269 656e 7461 7469 6f6e  ayer_orientation
+000124c0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+000124d0: 0a0a 2020 2020 6465 6620 6175 746f 5f72  ..    def auto_r
+000124e0: 656e 616d 655f 706f 7274 735f 6f72 6965  ename_ports_orie
+000124f0: 6e74 6174 696f 6e28 7365 6c66 2c20 2a2a  ntation(self, **
+00012500: 6b77 6172 6773 2920 2d3e 204e 6f6e 653a  kwargs) -> None:
+00012510: 0a20 2020 2020 2020 2022 2222 5265 6e61  .        """Rena
+00012520: 6d65 2070 6f72 7473 2062 7920 6f72 6965  me ports by orie
+00012530: 6e74 6174 696f 6e20 4e53 4557 2028 6e6f  ntation NSEW (no
+00012540: 7274 682c 2073 6f75 7468 2c20 6561 7374  rth, south, east
+00012550: 2c20 7765 7374 292e 0a0a 2020 2020 2020  , west)...      
+00012560: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
+00012570: 2020 2020 2020 2020 2020 2020 6675 6e63              func
+00012580: 7469 6f6e 3a20 746f 2072 656e 616d 6520  tion: to rename 
+00012590: 706f 7274 732e 0a20 2020 2020 2020 2020  ports..         
+000125a0: 2020 2073 656c 6563 745f 706f 7274 735f     select_ports_
+000125b0: 6f70 7469 6361 6c3a 2074 6f20 7365 6c65  optical: to sele
+000125c0: 6374 2070 6f72 7473 2e0a 2020 2020 2020  ct ports..      
+000125d0: 2020 2020 2020 7365 6c65 6374 5f70 6f72        select_por
+000125e0: 7473 5f65 6c65 6374 7269 6361 6c3a 0a20  ts_electrical:. 
+000125f0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00012600: 785f 6f70 7469 6361 6c3a 0a20 2020 2020  x_optical:.     
+00012610: 2020 2020 2020 2070 7265 6669 785f 656c         prefix_el
+00012620: 6563 7472 6963 616c 3a0a 0a20 2020 2020  ectrical:..     
+00012630: 2020 202e 2e20 636f 6465 3a3a 0a0a 2020     .. code::..  
+00012640: 2020 2020 2020 2020 2020 2020 2020 204e                 N
+00012650: 3020 204e 310a 2020 2020 2020 2020 2020  0  N1.          
+00012660: 2020 2020 2020 207c 5f5f 5f7c 5f0a 2020         |___|_.  
+00012670: 2020 2020 2020 2020 2020 5731 202d 7c20            W1 -| 
+00012680: 2020 2020 207c 2d20 4531 0a20 2020 2020       |- E1.     
+00012690: 2020 2020 2020 2020 2020 207c 2020 2020             |    
+000126a0: 2020 7c0a 2020 2020 2020 2020 2020 2020    |.            
+000126b0: 5730 202d 7c5f 5f5f 5f5f 5f7c 2d20 4530  W0 -|______|- E0
+000126c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000126d0: 2020 7c20 2020 7c0a 2020 2020 2020 2020    |   |.        
+000126e0: 2020 2020 2020 2020 5330 2020 2053 310a          S0   S1.
+000126f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012700: 2020 2020 6175 746f 5f72 656e 616d 655f      auto_rename_
+00012710: 706f 7274 735f 6f72 6965 6e74 6174 696f  ports_orientatio
+00012720: 6e28 7365 6c66 2c20 2a2a 6b77 6172 6773  n(self, **kwargs
+00012730: 290a 0a20 2020 2064 6566 206d 6f76 6528  )..    def move(
+00012740: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
+00012750: 7761 7267 7329 202d 3e20 436f 6d70 6f6e  wargs) -> Compon
+00012760: 656e 743a 0a20 2020 2020 2020 2022 2222  ent:.        """
+00012770: 4d61 6b65 2061 2072 6566 6572 656e 6365  Make a reference
+00012780: 2069 6e73 7465 6164 2222 220a 2020 2020   instead""".    
+00012790: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000127a0: 7272 6f72 286d 6f76 655f 6572 726f 725f  rror(move_error_
+000127b0: 6d65 7373 6167 6529 0a0a 2020 2020 6465  message)..    de
+000127c0: 6620 6d69 7272 6f72 2873 656c 662c 2070  f mirror(self, p
+000127d0: 313a 2046 6c6f 6174 3220 3d20 2830 2c20  1: Float2 = (0, 
+000127e0: 3129 2c20 7032 3a20 466c 6f61 7432 203d  1), p2: Float2 =
+000127f0: 2028 302c 2030 292c 202a 2a6b 7761 7267   (0, 0), **kwarg
+00012800: 7329 202d 3e20 436f 6d70 6f6e 656e 743a  s) -> Component:
+00012810: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00012820: 726e 7320 6e65 7720 436f 6d70 6f6e 656e  rns new Componen
+00012830: 7420 7769 7468 2061 206d 6972 726f 7265  t with a mirrore
+00012840: 6420 7265 6665 7265 6e63 652e 0a0a 2020  d reference...  
+00012850: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+00012860: 2020 2020 2020 2020 7031 3a20 6669 7273          p1: firs
+00012870: 7420 706f 696e 7420 746f 2064 6566 696e  t point to defin
+00012880: 6520 6d69 7272 6f72 2061 7869 732e 0a20  e mirror axis.. 
+00012890: 2020 2020 2020 2020 2020 2070 323a 2073             p2: s
+000128a0: 6563 6f6e 6420 706f 696e 7420 746f 2064  econd point to d
+000128b0: 6566 696e 6520 6d69 7272 6f72 2061 7869  efine mirror axi
+000128c0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+000128d0: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
+000128e0: 6163 746f 7279 2e66 756e 6374 696f 6e73  actory.functions
+000128f0: 2069 6d70 6f72 7420 6d69 7272 6f72 0a0a   import mirror..
+00012900: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+00012910: 6972 726f 7228 636f 6d70 6f6e 656e 743d  irror(component=
+00012920: 7365 6c66 2c20 7031 3d70 312c 2070 323d  self, p1=p1, p2=
+00012930: 7032 2c20 2a2a 6b77 6172 6773 290a 0a20  p2, **kwargs).. 
+00012940: 2020 2064 6566 2072 6f74 6174 6528 7365     def rotate(se
+00012950: 6c66 2c20 616e 676c 653a 2066 6c6f 6174  lf, angle: float
+00012960: 203d 2039 302c 202a 2a6b 7761 7267 7329   = 90, **kwargs)
+00012970: 202d 3e20 436f 6d70 6f6e 656e 743a 0a20   -> Component:. 
+00012980: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00012990: 7320 6e65 7720 636f 6d70 6f6e 656e 7420  s new component 
+000129a0: 7769 7468 2061 2072 6f74 6174 6564 2072  with a rotated r
+000129b0: 6566 6572 656e 6365 2074 6f20 7468 6520  eference to the 
+000129c0: 6f72 6967 696e 616c 2e0a 0a20 2020 2020  original...     
+000129d0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+000129e0: 2020 2020 2061 6e67 6c65 3a20 696e 2064       angle: in d
+000129f0: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
+00012a00: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+00012a10: 2067 6473 6661 6374 6f72 792e 6675 6e63   gdsfactory.func
+00012a20: 7469 6f6e 7320 696d 706f 7274 2072 6f74  tions import rot
+00012a30: 6174 650a 0a20 2020 2020 2020 2072 6574  ate..        ret
+00012a40: 7572 6e20 726f 7461 7465 2863 6f6d 706f  urn rotate(compo
+00012a50: 6e65 6e74 3d73 656c 662c 2061 6e67 6c65  nent=self, angle
+00012a60: 3d61 6e67 6c65 2c20 2a2a 6b77 6172 6773  =angle, **kwargs
+00012a70: 290a 0a20 2020 2064 6566 2061 6464 5f70  )..    def add_p
+00012a80: 6164 6469 6e67 2873 656c 662c 202a 2a6b  adding(self, **k
+00012a90: 7761 7267 7329 202d 3e20 436f 6d70 6f6e  wargs) -> Compon
+00012aa0: 656e 743a 0a20 2020 2020 2020 2022 2222  ent:.        """
+00012ab0: 5265 7475 726e 7320 7361 6d65 2063 6f6d  Returns same com
+00012ac0: 706f 6e65 6e74 2077 6974 6820 7061 6464  ponent with padd
+00012ad0: 696e 672e 0a0a 2020 2020 2020 2020 4b65  ing...        Ke
+00012ae0: 7977 6f72 6420 4172 6773 3a0a 2020 2020  yword Args:.    
+00012af0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+00012b00: 743a 2066 6f72 2070 6164 6469 6e67 2e0a  t: for padding..
+00012b10: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00012b20: 7273 3a20 6c69 7374 206f 6620 6c61 7965  rs: list of laye
+00012b30: 7273 2e0a 2020 2020 2020 2020 2020 2020  rs..            
+00012b40: 7375 6666 6978 2066 6f72 206e 616d 652e  suffix for name.
+00012b50: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00012b60: 6175 6c74 3a20 6465 6661 756c 7420 7061  ault: default pa
+00012b70: 6464 696e 6720 2835 3075 6d29 2e0a 2020  dding (50um)..  
+00012b80: 2020 2020 2020 2020 2020 746f 703a 206e            top: n
+00012b90: 6f72 7468 2070 6164 6469 6e67 2e0a 2020  orth padding..  
+00012ba0: 2020 2020 2020 2020 2020 626f 7474 6f6d            bottom
+00012bb0: 3a20 736f 7574 6820 7061 6464 696e 672e  : south padding.
+00012bc0: 0a20 2020 2020 2020 2020 2020 2072 6967  .            rig
+00012bd0: 6874 3a20 6561 7374 2070 6164 6469 6e67  ht: east padding
+00012be0: 2e0a 2020 2020 2020 2020 2020 2020 6c65  ..            le
+00012bf0: 6674 3a20 7765 7374 2070 6164 6469 6e67  ft: west padding
+00012c00: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00012c10: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
+00012c20: 6374 6f72 792e 6164 645f 7061 6464 696e  ctory.add_paddin
+00012c30: 6720 696d 706f 7274 2061 6464 5f70 6164  g import add_pad
+00012c40: 6469 6e67 0a0a 2020 2020 2020 2020 7265  ding..        re
+00012c50: 7475 726e 2061 6464 5f70 6164 6469 6e67  turn add_padding
+00012c60: 2863 6f6d 706f 6e65 6e74 3d73 656c 662c  (component=self,
+00012c70: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+00012c80: 6465 6620 6162 736f 7262 2873 656c 662c  def absorb(self,
+00012c90: 2072 6566 6572 656e 6365 2920 2d3e 2043   reference) -> C
+00012ca0: 6f6d 706f 6e65 6e74 3a0a 2020 2020 2020  omponent:.      
+00012cb0: 2020 2222 2241 6273 6f72 6273 2070 6f6c    """Absorbs pol
+00012cc0: 7967 6f6e 7320 6672 6f6d 2043 6f6d 706f  ygons from Compo
+00012cd0: 6e65 6e74 5265 6665 7265 6e63 6520 696e  nentReference in
+00012ce0: 746f 2043 6f6d 706f 6e65 6e74 2e0a 0a20  to Component... 
+00012cf0: 2020 2020 2020 2044 6573 7472 6f79 7320         Destroys 
+00012d00: 7468 6520 7265 6665 7265 6e63 6520 696e  the reference in
+00012d10: 2074 6865 2070 726f 6365 7373 2062 7574   the process but
+00012d20: 206b 6565 7069 6e67 2074 6865 2070 6f6c   keeping the pol
+00012d30: 7967 6f6e 2067 656f 6d65 7472 792e 0a0a  ygon geometry...
+00012d40: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00012d50: 2020 2020 2020 2020 2020 7265 6665 7265            refere
+00012d60: 6e63 653a 2043 6f6d 706f 6e65 6e74 5265  nce: ComponentRe
+00012d70: 6665 7265 6e63 6520 746f 2062 6520 6162  ference to be ab
+00012d80: 736f 7262 6564 2069 6e74 6f20 7468 6520  sorbed into the 
+00012d90: 436f 6d70 6f6e 656e 742e 0a20 2020 2020  Component..     
+00012da0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00012db0: 6620 7265 6665 7265 6e63 6520 6e6f 7420  f reference not 
+00012dc0: 696e 2073 656c 662e 7265 6665 7265 6e63  in self.referenc
+00012dd0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00012de0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00012df0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00012e00: 2020 2254 6865 2072 6566 6572 656e 6365    "The reference
+00012e10: 2079 6f75 2061 736b 6564 2074 6f20 6162   you asked to ab
+00012e20: 736f 7262 2064 6f65 7320 6e6f 7420 6578  sorb does not ex
+00012e30: 6973 7420 696e 2074 6869 7320 436f 6d70  ist in this Comp
+00012e40: 6f6e 656e 742e 220a 2020 2020 2020 2020  onent.".        
+00012e50: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+00012e60: 665f 706f 6c79 676f 6e73 203d 2072 6566  f_polygons = ref
+00012e70: 6572 656e 6365 2e67 6574 5f70 6f6c 7967  erence.get_polyg
+00012e80: 6f6e 7328 0a20 2020 2020 2020 2020 2020  ons(.           
+00012e90: 2062 795f 7370 6563 3d46 616c 7365 2c20   by_spec=False, 
+00012ea0: 696e 636c 7564 655f 7061 7468 733d 4661  include_paths=Fa
+00012eb0: 6c73 652c 2061 735f 6172 7261 793d 4661  lse, as_array=Fa
+00012ec0: 6c73 650a 2020 2020 2020 2020 290a 2020  lse.        ).  
+00012ed0: 2020 2020 2020 7365 6c66 2e5f 6164 645f        self._add_
+00012ee0: 706f 6c79 676f 6e73 282a 7265 665f 706f  polygons(*ref_po
+00012ef0: 6c79 676f 6e73 290a 0a20 2020 2020 2020  lygons)..       
+00012f00: 2073 656c 662e 6164 6428 7265 6665 7265   self.add(refere
+00012f10: 6e63 652e 6765 745f 6c61 6265 6c73 2829  nce.get_labels()
+00012f20: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00012f30: 6464 2872 6566 6572 656e 6365 2e67 6574  dd(reference.get
+00012f40: 5f70 6174 6873 2829 290a 2020 2020 2020  _paths()).      
+00012f50: 2020 7365 6c66 2e72 656d 6f76 6528 7265    self.remove(re
+00012f60: 6665 7265 6e63 6529 0a20 2020 2020 2020  ference).       
+00012f70: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
+00012f80: 2020 6465 6620 7265 6d6f 7665 2873 656c    def remove(sel
+00012f90: 662c 2069 7465 6d73 293a 0a20 2020 2020  f, items):.     
+00012fa0: 2020 2022 2222 5265 6d6f 7665 7320 6974     """Removes it
+00012fb0: 656d 7320 6672 6f6d 2061 2043 6f6d 706f  ems from a Compo
+00012fc0: 6e65 6e74 2c20 7768 6963 6820 6361 6e20  nent, which can 
+00012fd0: 696e 636c 7564 6520 506f 7274 732c 2050  include Ports, P
+00012fe0: 6f6c 7967 6f6e 5365 7473 205c 0a20 2020  olygonSets \.   
+00012ff0: 2020 2020 2043 656c 6c52 6566 6572 656e       CellReferen
+00013000: 6365 732c 2043 6f6d 706f 6e65 6e74 5265  ces, ComponentRe
+00013010: 6665 7265 6e63 6573 2061 6e64 204c 6162  ferences and Lab
+00013020: 656c 732e 0a0a 2020 2020 2020 2020 4172  els...        Ar
+00013030: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00013040: 6974 656d 733a 206c 6973 7420 6f66 2049  items: list of I
+00013050: 7465 6d73 2074 6f20 6265 2072 656d 6f76  tems to be remov
+00013060: 6564 2066 726f 6d20 7468 6520 436f 6d70  ed from the Comp
+00013070: 6f6e 656e 742e 0a20 2020 2020 2020 2022  onent..        "
+00013080: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+00013090: 7420 6861 7361 7474 7228 6974 656d 732c  t hasattr(items,
+000130a0: 2022 5f5f 6974 6572 5f5f 2229 3a0a 2020   "__iter__"):.  
+000130b0: 2020 2020 2020 2020 2020 6974 656d 7320            items 
+000130c0: 3d20 5b69 7465 6d73 5d0a 2020 2020 2020  = [items].      
+000130d0: 2020 666f 7220 6974 656d 2069 6e20 6974    for item in it
+000130e0: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
+000130f0: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
+00013100: 7465 6d2c 2050 6f72 7429 3a0a 2020 2020  tem, Port):.    
+00013110: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00013120: 2e70 6f72 7473 203d 207b 6b3a 2076 2066  .ports = {k: v f
+00013130: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
+00013140: 706f 7274 732e 6974 656d 7328 2920 6966  ports.items() if
+00013150: 2076 2021 3d20 6974 656d 7d0a 2020 2020   v != item}.    
+00013160: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+00013170: 6e73 7461 6e63 6528 6974 656d 2c20 6764  nstance(item, gd
+00013180: 7374 6b2e 5265 6665 7265 6e63 6529 3a0a  stk.Reference):.
+00013190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131a0: 7365 6c66 2e5f 6365 6c6c 2e72 656d 6f76  self._cell.remov
+000131b0: 6528 6974 656d 290a 2020 2020 2020 2020  e(item).        
+000131c0: 2020 2020 2020 2020 6974 656d 2e6f 776e          item.own
+000131d0: 6572 203d 204e 6f6e 650a 2020 2020 2020  er = None.      
+000131e0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+000131f0: 7461 6e63 6528 6974 656d 2c20 436f 6d70  tance(item, Comp
+00013200: 6f6e 656e 7452 6566 6572 656e 6365 293a  onentReference):
+00013210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013220: 2073 656c 662e 7265 6665 7265 6e63 6573   self.references
+00013230: 2e72 656d 6f76 6528 6974 656d 290a 2020  .remove(item).  
+00013240: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00013250: 6c66 2e5f 6365 6c6c 2e72 656d 6f76 6528  lf._cell.remove(
+00013260: 6974 656d 2e5f 7265 6665 7265 6e63 6529  item._reference)
+00013270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013280: 2069 7465 6d2e 6f77 6e65 7220 3d20 4e6f   item.owner = No
+00013290: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+000132a0: 2020 2073 656c 662e 5f6e 616d 6564 5f72     self._named_r
+000132b0: 6566 6572 656e 6365 732e 706f 7028 6974  eferences.pop(it
+000132c0: 656d 2e6e 616d 6529 0a20 2020 2020 2020  em.name).       
+000132d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000132e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000132f0: 5f63 656c 6c2e 7265 6d6f 7665 2869 7465  _cell.remove(ite
+00013300: 6d29 0a0a 2020 2020 2020 2020 7365 6c66  m)..        self
+00013310: 2e5f 6262 5f76 616c 6964 203d 2046 616c  ._bb_valid = Fal
+00013320: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
+00013330: 6e20 7365 6c66 0a0a 2020 2020 6465 6620  n self..    def 
+00013340: 6861 7368 5f67 656f 6d65 7472 7928 7365  hash_geometry(se
+00013350: 6c66 2c20 7072 6563 6973 696f 6e3a 2066  lf, precision: f
+00013360: 6c6f 6174 203d 2031 652d 3429 202d 3e20  loat = 1e-4) -> 
+00013370: 7374 723a 0a20 2020 2020 2020 2022 2222  str:.        """
+00013380: 5265 7475 726e 7320 616e 2053 4841 3120  Returns an SHA1 
+00013390: 6861 7368 206f 6620 7468 6520 6765 6f6d  hash of the geom
+000133a0: 6574 7279 2069 6e20 7468 6520 436f 6d70  etry in the Comp
+000133b0: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
+000133c0: 466f 7220 6561 6368 206c 6179 6572 2c20  For each layer, 
+000133d0: 6561 6368 2070 6f6c 7967 6f6e 2069 7320  each polygon is 
+000133e0: 696e 6469 7669 6475 616c 6c79 2068 6173  individually has
+000133f0: 6865 6420 616e 6420 7468 656e 2074 6865  hed and then the
+00013400: 2070 6f6c 7967 6f6e 2068 6173 6865 730a   polygon hashes.
+00013410: 2020 2020 2020 2020 6172 6520 736f 7274          are sort
+00013420: 6564 2c20 746f 2065 6e73 7572 6520 7468  ed, to ensure th
+00013430: 6520 6861 7368 2073 7461 7973 2063 6f6e  e hash stays con
+00013440: 7374 616e 7420 7265 6761 7264 6c65 7373  stant regardless
+00013450: 206f 6620 7468 6520 6f72 6465 7269 6e67   of the ordering
+00013460: 0a20 2020 2020 2020 2074 6865 2070 6f6c  .        the pol
+00013470: 7967 6f6e 732e 2020 5369 6d69 6c61 726c  ygons.  Similarl
+00013480: 792c 2074 6865 206c 6179 6572 7320 6172  y, the layers ar
+00013490: 6520 736f 7274 6564 2062 7920 286c 6179  e sorted by (lay
+000134a0: 6572 2c20 6461 7461 7479 7065 292e 0a0a  er, datatype)...
+000134b0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+000134c0: 2020 2020 2020 2020 2020 7072 6563 6973            precis
+000134d0: 696f 6e3a 2052 6f75 6e64 696e 6720 7072  ion: Rounding pr
+000134e0: 6563 6973 696f 6e20 666f 7220 7468 6520  ecision for the 
+000134f0: 7468 6520 6f62 6a65 6374 7320 696e 2074  the objects in t
+00013500: 6865 2043 6f6d 706f 6e65 6e74 2e0a 2020  he Component..  
+00013510: 2020 2020 2020 2020 2020 2020 2020 466f                Fo
+00013520: 7220 696e 7374 616e 6365 2c20 6120 7072  r instance, a pr
+00013530: 6563 6973 696f 6e20 6f66 2031 652d 3220  ecision of 1e-2 
+00013540: 7769 6c6c 2072 6f75 6e64 2061 2070 6f69  will round a poi
+00013550: 6e74 2061 740a 2020 2020 2020 2020 2020  nt at.          
+00013560: 2020 2020 2020 2830 2e31 3234 2c20 312e        (0.124, 1.
+00013570: 3734 3829 2074 6f20 2830 2e31 322c 2031  748) to (0.12, 1
+00013580: 2e37 3529 2e0a 0a20 2020 2020 2020 2022  .75)...        "
+00013590: 2222 0a20 2020 2020 2020 2070 6f6c 7967  "".        polyg
+000135a0: 6f6e 735f 6279 5f73 7065 6320 3d20 7365  ons_by_spec = se
+000135b0: 6c66 2e67 6574 5f70 6f6c 7967 6f6e 7328  lf.get_polygons(
+000135c0: 6279 5f73 7065 633d 5472 7565 2c20 6173  by_spec=True, as
+000135d0: 5f61 7272 6179 3d46 616c 7365 290a 2020  _array=False).  
+000135e0: 2020 2020 2020 6c61 7965 7273 203d 206e        layers = n
+000135f0: 702e 6172 7261 7928 6c69 7374 2870 6f6c  p.array(list(pol
+00013600: 7967 6f6e 735f 6279 5f73 7065 632e 6b65  ygons_by_spec.ke
+00013610: 7973 2829 2929 0a20 2020 2020 2020 2073  ys())).        s
+00013620: 6f72 7465 645f 6c61 7965 7273 203d 206c  orted_layers = l
+00013630: 6179 6572 735b 6e70 2e6c 6578 736f 7274  ayers[np.lexsort
+00013640: 2828 6c61 7965 7273 5b3a 2c20 305d 2c20  ((layers[:, 0], 
+00013650: 6c61 7965 7273 5b3a 2c20 315d 2929 5d0a  layers[:, 1]))].
+00013660: 0a20 2020 2020 2020 2066 696e 616c 5f68  .        final_h
+00013670: 6173 6820 3d20 6861 7368 6c69 622e 7368  ash = hashlib.sh
+00013680: 6131 2829 0a20 2020 2020 2020 2066 6f72  a1().        for
+00013690: 206c 6179 6572 2069 6e20 736f 7274 6564   layer in sorted
+000136a0: 5f6c 6179 6572 733a 0a20 2020 2020 2020  _layers:.       
+000136b0: 2020 2020 206c 6179 6572 5f68 6173 6820       layer_hash 
+000136c0: 3d20 6861 7368 6c69 622e 7368 6131 286c  = hashlib.sha1(l
+000136d0: 6179 6572 2e61 7374 7970 6528 6e70 2e69  ayer.astype(np.i
+000136e0: 6e74 3634 2929 2e64 6967 6573 7428 290a  nt64)).digest().
+000136f0: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
+00013700: 676f 6e73 203d 2070 6f6c 7967 6f6e 735f  gons = polygons_
+00013710: 6279 5f73 7065 635b 7475 706c 6528 6c61  by_spec[tuple(la
+00013720: 7965 7229 5d0a 2020 2020 2020 2020 2020  yer)].          
+00013730: 2020 706f 6c79 676f 6e73 203d 205b 5f72    polygons = [_r
+00013740: 6e64 2870 2e70 6f69 6e74 732c 2070 7265  nd(p.points, pre
+00013750: 6369 7369 6f6e 2920 666f 7220 7020 696e  cision) for p in
+00013760: 2070 6f6c 7967 6f6e 735d 0a20 2020 2020   polygons].     
+00013770: 2020 2020 2020 2070 6f6c 7967 6f6e 5f68         polygon_h
+00013780: 6173 6865 7320 3d20 6e70 2e73 6f72 7428  ashes = np.sort(
+00013790: 5b68 6173 686c 6962 2e73 6861 3128 7029  [hashlib.sha1(p)
+000137a0: 2e64 6967 6573 7428 2920 666f 7220 7020  .digest() for p 
+000137b0: 696e 2070 6f6c 7967 6f6e 735d 290a 2020  in polygons]).  
+000137c0: 2020 2020 2020 2020 2020 6669 6e61 6c5f            final_
+000137d0: 6861 7368 2e75 7064 6174 6528 6c61 7965  hash.update(laye
+000137e0: 725f 6861 7368 290a 2020 2020 2020 2020  r_hash).        
+000137f0: 2020 2020 666f 7220 7068 2069 6e20 706f      for ph in po
+00013800: 6c79 676f 6e5f 6861 7368 6573 3a0a 2020  lygon_hashes:.  
+00013810: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00013820: 6e61 6c5f 6861 7368 2e75 7064 6174 6528  nal_hash.update(
+00013830: 7068 290a 0a20 2020 2020 2020 2072 6574  ph)..        ret
+00013840: 7572 6e20 6669 6e61 6c5f 6861 7368 2e68  urn final_hash.h
+00013850: 6578 6469 6765 7374 2829 0a0a 2020 2020  exdigest()..    
+00013860: 6465 6620 6765 745f 6c61 6265 6c73 280a  def get_labels(.
+00013870: 2020 2020 2020 2020 7365 6c66 2c20 6170          self, ap
+00013880: 706c 795f 7265 7065 7469 7469 6f6e 733d  ply_repetitions=
+00013890: 5472 7565 2c20 6465 7074 683a 2069 6e74  True, depth: int
+000138a0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c20   | None = None, 
+000138b0: 6c61 7965 723d 4e6f 6e65 0a20 2020 2029  layer=None.    )
+000138c0: 202d 3e20 6c69 7374 5b4c 6162 656c 5d3a   -> list[Label]:
+000138d0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+000138e0: 726e 206c 6162 656c 732e 0a0a 2020 2020  rn labels...    
+000138f0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00013900: 2020 2020 2020 6170 706c 795f 7265 7065        apply_repe
+00013910: 7469 7469 6f6e 733a 2e0a 2020 2020 2020  titions:..      
+00013920: 2020 2020 2020 6465 7074 683a 204e 6f6e        depth: Non
+00013930: 6520 7265 7475 726e 7320 616c 6c20 6c61  e returns all la
+00013940: 6265 6c73 2061 6e64 2030 2074 6f70 206c  bels and 0 top l
+00013950: 6576 656c 2e0a 2020 2020 2020 2020 2020  evel..          
+00013960: 2020 6c61 7965 723a 206c 6179 6572 7370    layer: layersp
+00013970: 6563 2e0a 2020 2020 2020 2020 2222 220a  ec..        """.
+00013980: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
+00013990: 6661 6374 6f72 792e 7064 6b20 696d 706f  factory.pdk impo
+000139a0: 7274 2067 6574 5f6c 6179 6572 0a0a 2020  rt get_layer..  
+000139b0: 2020 2020 2020 6966 206c 6179 6572 3a0a        if layer:.
+000139c0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+000139d0: 722c 2074 6578 7474 7970 6520 3d20 6765  r, texttype = ge
+000139e0: 745f 6c61 7965 7228 6c61 7965 7229 0a20  t_layer(layer). 
+000139f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00013a00: 2020 2020 2020 2020 2074 6578 7474 7970           texttyp
+00013a10: 6520 3d20 4e6f 6e65 0a20 2020 2020 2020  e = None.       
+00013a20: 2072 6574 7572 6e20 7365 6c66 2e5f 6365   return self._ce
+00013a30: 6c6c 2e67 6574 5f6c 6162 656c 7328 0a20  ll.get_labels(. 
+00013a40: 2020 2020 2020 2020 2020 2061 7070 6c79             apply
+00013a50: 5f72 6570 6574 6974 696f 6e73 3d61 7070  _repetitions=app
+00013a60: 6c79 5f72 6570 6574 6974 696f 6e73 2c0a  ly_repetitions,.
+00013a70: 2020 2020 2020 2020 2020 2020 6465 7074              dept
+00013a80: 683d 6465 7074 682c 0a20 2020 2020 2020  h=depth,.       
+00013a90: 2020 2020 206c 6179 6572 3d6c 6179 6572       layer=layer
+00013aa0: 2c0a 2020 2020 2020 2020 2020 2020 7465  ,.            te
+00013ab0: 7874 7479 7065 3d74 6578 7474 7970 652c  xttype=texttype,
+00013ac0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00013ad0: 6465 6620 7265 6d6f 7665 5f6c 6162 656c  def remove_label
+00013ae0: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
+00013af0: 0a20 2020 2020 2020 2022 2222 5265 6d6f  .        """Remo
+00013b00: 7665 206c 6162 656c 732e 2222 220a 2020  ve labels.""".  
+00013b10: 2020 2020 2020 7365 6c66 2e5f 6365 6c6c        self._cell
+00013b20: 2e72 656d 6f76 6528 2a73 656c 662e 6c61  .remove(*self.la
+00013b30: 6265 6c73 290a 0a20 2020 2064 6566 2072  bels)..    def r
+00013b40: 656d 6170 5f6c 6179 6572 7328 7365 6c66  emap_layers(self
+00013b50: 2c20 6c61 7965 726d 6170 2c20 2a2a 6b77  , layermap, **kw
+00013b60: 6172 6773 2920 2d3e 2043 6f6d 706f 6e65  args) -> Compone
+00013b70: 6e74 3a0a 2020 2020 2020 2020 2222 2252  nt:.        """R
+00013b80: 6574 7572 6e73 2061 2063 6f70 7920 6f66  eturns a copy of
+00013b90: 2074 6865 2063 6f6d 706f 6e65 6e74 2077   the component w
+00013ba0: 6974 6820 7265 6d61 7070 6564 206c 6179  ith remapped lay
+00013bb0: 6572 732e 0a0a 2020 2020 2020 2020 4172  ers...        Ar
+00013bc0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00013bd0: 6c61 7965 726d 6170 3a20 4469 6374 696f  layermap: Dictio
+00013be0: 6e61 7279 206f 6620 7661 6c75 6573 2069  nary of values i
+00013bf0: 6e20 666f 726d 6174 207b 6c61 7965 725f  n format {layer_
+00013c00: 6672 6f6d 3a20 6c61 7965 725f 746f 7d2e  from: layer_to}.
+00013c10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013c20: 2020 2020 2069 6620 6b77 6172 6773 3a0a       if kwargs:.
+00013c30: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00013c40: 696e 6773 2e77 6172 6e28 227b 6b77 6172  ings.warn("{kwar
+00013c50: 6773 2e6b 6579 737d 2069 7320 6465 7072  gs.keys} is depr
+00013c60: 6563 6174 6564 2e22 2c20 4465 7072 6563  ecated.", Deprec
+00013c70: 6174 696f 6e57 6172 6e69 6e67 290a 0a20  ationWarning).. 
+00013c80: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+00013c90: 203d 2073 656c 660a 2020 2020 2020 2020   = self.        
+00013ca0: 6c61 7965 726d 6170 203d 207b 5f70 6172  layermap = {_par
+00013cb0: 7365 5f6c 6179 6572 286b 293a 205f 7061  se_layer(k): _pa
+00013cc0: 7273 655f 6c61 7965 7228 7629 2066 6f72  rse_layer(v) for
+00013cd0: 206b 2c20 7620 696e 206c 6179 6572 6d61   k, v in layerma
+00013ce0: 702e 6974 656d 7328 297d 0a0a 2020 2020  p.items()}..    
+00013cf0: 2020 2020 6365 6c6c 7320 3d20 6c69 7374      cells = list
+00013d00: 2863 6f6d 706f 6e65 6e74 2e67 6574 5f64  (component.get_d
+00013d10: 6570 656e 6465 6e63 6965 7328 5472 7565  ependencies(True
+00013d20: 2929 0a20 2020 2020 2020 2063 656c 6c73  )).        cells
+00013d30: 2e61 7070 656e 6428 636f 6d70 6f6e 656e  .append(componen
+00013d40: 7429 0a20 2020 2020 2020 2066 6f72 2063  t).        for c
+00013d50: 656c 6c20 696e 2063 656c 6c73 3a0a 2020  ell in cells:.  
+00013d60: 2020 2020 2020 2020 2020 6365 6c6c 2e5f            cell._
+00013d70: 6365 6c6c 2e72 656d 6170 286c 6179 6572  cell.remap(layer
+00013d80: 6d61 7029 0a20 2020 2020 2020 2072 6574  map).        ret
+00013d90: 7572 6e20 636f 6d70 6f6e 656e 740a 0a20  urn component.. 
+00013da0: 2020 2064 6566 2074 6f5f 3364 280a 2020     def to_3d(.  
+00013db0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00013dc0: 2020 2020 6c61 7965 725f 7669 6577 733a      layer_views:
+00013dd0: 204c 6179 6572 5669 6577 7320 7c20 4e6f   LayerViews | No
+00013de0: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+00013df0: 2020 206c 6179 6572 5f73 7461 636b 3a20     layer_stack: 
+00013e00: 4c61 7965 7253 7461 636b 207c 204e 6f6e  LayerStack | Non
+00013e10: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00013e20: 2020 6578 636c 7564 655f 6c61 7965 7273    exclude_layers
+00013e30: 3a20 7475 706c 655b 4c61 7965 722c 202e  : tuple[Layer, .
+00013e40: 2e2e 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ..] | None = Non
+00013e50: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
+00013e60: 2020 2222 2252 6574 7572 6e20 436f 6d70    """Return Comp
+00013e70: 6f6e 656e 7420 3344 2074 7269 6d65 7368  onent 3D trimesh
+00013e80: 2053 6365 6e65 2e0a 0a20 2020 2020 2020   Scene...       
+00013e90: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00013ea0: 2020 2063 6f6d 706f 6e65 6e74 3a20 746f     component: to
+00013eb0: 2065 7874 7275 6465 2069 6e20 3344 2e0a   extrude in 3D..
+00013ec0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00013ed0: 725f 7669 6577 733a 206c 6179 6572 2063  r_views: layer c
+00013ee0: 6f6c 6f72 7320 6672 6f6d 204b 6c61 796f  olors from Klayo
+00013ef0: 7574 204c 6179 6572 2050 726f 7065 7274  ut Layer Propert
+00013f00: 6965 7320 6669 6c65 2e0a 2020 2020 2020  ies file..      
+00013f10: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
+00013f20: 7473 2074 6f20 6163 7469 7665 2050 444b  ts to active PDK
+00013f30: 2e6c 6179 6572 5f76 6965 7773 2e0a 2020  .layer_views..  
+00013f40: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
+00013f50: 7374 6163 6b3a 2063 6f6e 7461 696e 7320  stack: contains 
+00013f60: 7468 6963 6b6e 6573 7320 616e 6420 7a6d  thickness and zm
+00013f70: 696e 2066 6f72 2065 6163 6820 6c61 7965  in for each laye
+00013f80: 722e 0a20 2020 2020 2020 2020 2020 2020  r..             
+00013f90: 2020 2044 6566 6175 6c74 7320 746f 2061     Defaults to a
+00013fa0: 6374 6976 6520 5044 4b2e 6c61 7965 725f  ctive PDK.layer_
+00013fb0: 7374 6163 6b2e 0a20 2020 2020 2020 2020  stack..         
+00013fc0: 2020 2065 7863 6c75 6465 5f6c 6179 6572     exclude_layer
+00013fd0: 733a 206c 6179 6572 7320 746f 2065 7863  s: layers to exc
+00013fe0: 6c75 6465 2e0a 0a20 2020 2020 2020 2022  lude...        "
+00013ff0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00014000: 6764 7366 6163 746f 7279 2e65 7870 6f72  gdsfactory.expor
+00014010: 742e 746f 5f33 6420 696d 706f 7274 2074  t.to_3d import t
+00014020: 6f5f 3364 0a0a 2020 2020 2020 2020 7265  o_3d..        re
+00014030: 7475 726e 2074 6f5f 3364 280a 2020 2020  turn to_3d(.    
+00014040: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00014050: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
+00014060: 7669 6577 733d 6c61 7965 725f 7669 6577  views=layer_view
+00014070: 732c 0a20 2020 2020 2020 2020 2020 206c  s,.            l
+00014080: 6179 6572 5f73 7461 636b 3d6c 6179 6572  ayer_stack=layer
+00014090: 5f73 7461 636b 2c0a 2020 2020 2020 2020  _stack,.        
+000140a0: 2020 2020 6578 636c 7564 655f 6c61 7965      exclude_laye
+000140b0: 7273 3d65 7863 6c75 6465 5f6c 6179 6572  rs=exclude_layer
+000140c0: 732c 0a20 2020 2020 2020 2029 0a0a 2020  s,.        )..  
+000140d0: 2020 6465 6620 746f 5f6e 7028 0a20 2020    def to_np(.   
+000140e0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+000140f0: 2020 206e 6d5f 7065 725f 7069 7865 6c3a     nm_per_pixel:
+00014100: 2069 6e74 203d 2032 302c 0a20 2020 2020   int = 20,.     
+00014110: 2020 206c 6179 6572 733a 204c 6179 6572     layers: Layer
+00014120: 7320 3d20 2828 312c 2030 292c 292c 0a20  s = ((1, 0),),. 
+00014130: 2020 2020 2020 2076 616c 7565 733a 2074         values: t
+00014140: 7570 6c65 5b66 6c6f 6174 2c20 2e2e 2e5d  uple[float, ...]
+00014150: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00014160: 2020 2020 2020 2020 7061 645f 7769 6474          pad_widt
+00014170: 683a 2069 6e74 203d 2031 2c0a 2020 2020  h: int = 1,.    
+00014180: 2920 2d3e 206e 702e 6e64 6172 7261 793a  ) -> np.ndarray:
+00014190: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+000141a0: 726e 7320 6120 7069 7865 6c61 7465 6420  rns a pixelated 
+000141b0: 6e75 6d70 7920 6172 7261 7920 6672 6f6d  numpy array from
+000141c0: 2043 6f6d 706f 6e65 6e74 2070 6f6c 7967   Component polyg
+000141d0: 6f6e 732e 0a0a 2020 2020 2020 2020 4172  ons...        Ar
+000141e0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+000141f0: 636f 6d70 6f6e 656e 743a 2043 6f6d 706f  component: Compo
+00014200: 6e65 6e74 2e0a 2020 2020 2020 2020 2020  nent..          
+00014210: 2020 6e6d 5f70 6572 5f70 6978 656c 3a20    nm_per_pixel: 
+00014220: 796f 7520 6361 6e20 676f 2066 726f 6d20  you can go from 
+00014230: 3230 2028 636f 6172 7365 2920 746f 2034  20 (coarse) to 4
+00014240: 2028 6669 6e65 292e 0a20 2020 2020 2020   (fine)..       
+00014250: 2020 2020 206c 6179 6572 733a 2074 6f20       layers: to 
+00014260: 636f 6e76 6572 742e 204f 7264 6572 206d  convert. Order m
+00014270: 6174 7465 7273 2028 6c61 7474 6572 206f  atters (latter o
+00014280: 7665 7277 7269 7465 2066 6f72 6d65 7229  verwrite former)
+00014290: 2e0a 2020 2020 2020 2020 2020 2020 7661  ..            va
+000142a0: 6c75 6573 3a20 6173 736f 6369 6174 6564  lues: associated
+000142b0: 2074 6f20 6561 6368 206c 6179 6572 2028   to each layer (
+000142c0: 6465 6661 756c 7473 2074 6f20 3129 2e0a  defaults to 1)..
+000142d0: 2020 2020 2020 2020 2020 2020 7061 645f              pad_
+000142e0: 7769 6474 683a 2070 6164 6469 6e67 2070  width: padding p
+000142f0: 6978 656c 7320 6172 6f75 6e64 2074 6865  ixels around the
+00014300: 2069 6d61 6765 2e0a 0a20 2020 2020 2020   image...       
+00014310: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+00014320: 6d20 6764 7366 6163 746f 7279 2e65 7870  m gdsfactory.exp
+00014330: 6f72 742e 746f 5f6e 7020 696d 706f 7274  ort.to_np import
+00014340: 2074 6f5f 6e70 0a0a 2020 2020 2020 2020   to_np..        
+00014350: 7265 7475 726e 2074 6f5f 6e70 280a 2020  return to_np(.  
+00014360: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
+00014370: 2020 2020 2020 2020 2020 2020 6e6d 5f70              nm_p
+00014380: 6572 5f70 6978 656c 3d6e 6d5f 7065 725f  er_pixel=nm_per_
+00014390: 7069 7865 6c2c 0a20 2020 2020 2020 2020  pixel,.         
+000143a0: 2020 206c 6179 6572 733d 6c61 7965 7273     layers=layers
+000143b0: 2c0a 2020 2020 2020 2020 2020 2020 7661  ,.            va
+000143c0: 6c75 6573 3d76 616c 7565 732c 0a20 2020  lues=values,.   
+000143d0: 2020 2020 2020 2020 2070 6164 5f77 6964           pad_wid
+000143e0: 7468 3d70 6164 5f77 6964 7468 2c0a 2020  th=pad_width,.  
+000143f0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00014400: 2077 7269 7465 5f73 746c 280a 2020 2020   write_stl(.    
+00014410: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00014420: 2020 6669 6c65 7061 7468 3a20 7374 722c    filepath: str,
+00014430: 0a20 2020 2020 2020 206c 6179 6572 5f73  .        layer_s
+00014440: 7461 636b 3a20 4c61 7965 7253 7461 636b  tack: LayerStack
+00014450: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00014460: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
+00014470: 6c61 7965 7273 3a20 7475 706c 655b 4c61  layers: tuple[La
+00014480: 7965 722c 202e 2e2e 5d20 7c20 4e6f 6e65  yer, ...] | None
+00014490: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000144a0: 2075 7365 5f6c 6179 6572 5f6e 616d 653a   use_layer_name:
+000144b0: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+000144c0: 2020 2020 2020 2068 756c 6c5f 696e 7661         hull_inva
+000144d0: 6c69 645f 706f 6c79 676f 6e73 3a20 626f  lid_polygons: bo
+000144e0: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
+000144f0: 2020 2073 6361 6c65 3a20 666c 6f61 7420     scale: float 
+00014500: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00014510: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
+00014520: 2020 2020 2020 2222 2257 7269 7465 2061        """Write a
+00014530: 2043 6f6d 706f 6e65 6e74 2074 6f20 5354   Component to ST
+00014540: 4c20 666f 7220 3344 2070 7269 6e74 696e  L for 3D printin
+00014550: 672e 0a0a 2020 2020 2020 2020 4172 6773  g...        Args
+00014560: 3a0a 2020 2020 2020 2020 2020 2020 6669  :.            fi
+00014570: 6c65 7061 7468 3a20 746f 2077 7269 7465  lepath: to write
+00014580: 2053 544c 2074 6f2e 0a20 2020 2020 2020   STL to..       
+00014590: 2020 2020 206c 6179 6572 5f73 7461 636b       layer_stack
+000145a0: 3a20 636f 6e74 6169 6e73 2074 6869 636b  : contains thick
+000145b0: 6e65 7373 2061 6e64 207a 6d69 6e20 666f  ness and zmin fo
+000145c0: 7220 6561 6368 206c 6179 6572 2e0a 2020  r each layer..  
+000145d0: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+000145e0: 655f 6c61 7965 7273 3a20 6c61 7965 7273  e_layers: layers
+000145f0: 2074 6f20 6578 636c 7564 652e 0a20 2020   to exclude..   
+00014600: 2020 2020 2020 2020 2075 7365 5f6c 6179           use_lay
+00014610: 6572 5f6e 616d 653a 2049 6620 5472 7565  er_name: If True
+00014620: 2c20 7573 6573 204c 6179 6572 4c65 7665  , uses LayerLeve
+00014630: 6c20 6e61 6d65 7320 696e 206f 7574 7075  l names in outpu
+00014640: 7420 6669 6c65 6e61 6d65 7320 7261 7468  t filenames rath
+00014650: 6572 2074 6861 6e20 6764 735f 6c61 7965  er than gds_laye
+00014660: 7220 616e 6420 6764 735f 6461 7461 7479  r and gds_dataty
+00014670: 7065 2e0a 2020 2020 2020 2020 2020 2020  pe..            
+00014680: 6875 6c6c 5f69 6e76 616c 6964 5f70 6f6c  hull_invalid_pol
+00014690: 7967 6f6e 733a 2049 6620 5472 7565 2c20  ygons: If True, 
+000146a0: 7265 706c 6163 6573 2069 6e76 616c 6964  replaces invalid
+000146b0: 2070 6f6c 7967 6f6e 7320 2864 6574 6572   polygons (deter
+000146c0: 6d69 6e65 6420 6279 2073 6861 7065 6c79  mined by shapely
+000146d0: 2e50 6f6c 7967 6f6e 2e69 735f 7661 6c69  .Polygon.is_vali
+000146e0: 6429 2077 6974 6820 6974 7320 636f 6e76  d) with its conv
+000146f0: 6578 2068 756c 6c2e 0a20 2020 2020 2020  ex hull..       
+00014700: 2020 2020 2073 6361 6c65 3a20 4f70 7469       scale: Opti
+00014710: 6f6e 616c 2066 6163 746f 7220 6279 2077  onal factor by w
+00014720: 6869 6368 2074 6f20 7363 616c 6520 6d65  hich to scale me
+00014730: 7368 6573 2062 6566 6f72 6520 7772 6974  shes before writ
+00014740: 696e 672e 0a0a 2020 2020 2020 2020 2222  ing...        ""
+00014750: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+00014760: 6473 6661 6374 6f72 792e 6578 706f 7274  dsfactory.export
+00014770: 2e74 6f5f 7374 6c20 696d 706f 7274 2074  .to_stl import t
+00014780: 6f5f 7374 6c0a 0a20 2020 2020 2020 2074  o_stl..        t
+00014790: 6f5f 7374 6c28 0a20 2020 2020 2020 2020  o_stl(.         
+000147a0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+000147b0: 2020 2020 2066 696c 6570 6174 683d 6669       filepath=fi
+000147c0: 6c65 7061 7468 2c0a 2020 2020 2020 2020  lepath,.        
+000147d0: 2020 2020 6c61 7965 725f 7374 6163 6b3d      layer_stack=
+000147e0: 6c61 7965 725f 7374 6163 6b2c 0a20 2020  layer_stack,.   
+000147f0: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
+00014800: 5f6c 6179 6572 733d 6578 636c 7564 655f  _layers=exclude_
+00014810: 6c61 7965 7273 2c0a 2020 2020 2020 2020  layers,.        
+00014820: 2020 2020 7573 655f 6c61 7965 725f 6e61      use_layer_na
+00014830: 6d65 3d75 7365 5f6c 6179 6572 5f6e 616d  me=use_layer_nam
+00014840: 652c 0a20 2020 2020 2020 2020 2020 2068  e,.            h
+00014850: 756c 6c5f 696e 7661 6c69 645f 706f 6c79  ull_invalid_poly
+00014860: 676f 6e73 3d68 756c 6c5f 696e 7661 6c69  gons=hull_invali
+00014870: 645f 706f 6c79 676f 6e73 2c0a 2020 2020  d_polygons,.    
+00014880: 2020 2020 2020 2020 7363 616c 653d 7363          scale=sc
+00014890: 616c 652c 0a20 2020 2020 2020 2029 0a0a  ale,.        )..
+000148a0: 2020 2020 6465 6620 7772 6974 655f 6765      def write_ge
+000148b0: 7262 6572 2873 656c 662c 2064 6972 7061  rber(self, dirpa
+000148c0: 7468 2c20 6c61 7965 726d 6170 5f74 6f5f  th, layermap_to_
+000148d0: 6765 7262 6572 5f6c 6179 6572 2c20 6f70  gerber_layer, op
+000148e0: 7469 6f6e 7329 202d 3e20 4e6f 6e65 3a0a  tions) -> None:.
+000148f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00014900: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00014910: 2020 2020 2020 6469 7270 6174 683a 2064        dirpath: d
+00014920: 6972 6563 746f 7279 2074 6f20 7772 6974  irectory to writ
+00014930: 6520 6765 7262 6572 2066 696c 6573 2074  e gerber files t
+00014940: 6f2e 0a20 2020 2020 2020 2020 2020 206c  o..            l
+00014950: 6179 6572 6d61 705f 746f 5f67 6572 6265  ayermap_to_gerbe
+00014960: 725f 6c61 7965 723a 2064 6963 7469 6f6e  r_layer: diction
+00014970: 6172 7920 6f66 206c 6179 6572 6d61 7020  ary of layermap 
+00014980: 746f 2067 6572 6265 7220 6c61 7965 722e  to gerber layer.
+00014990: 0a20 2020 2020 2020 2020 2020 206f 7074  .            opt
+000149a0: 696f 6e73 3a20 6469 6374 696f 6e61 7279  ions: dictionary
+000149b0: 206f 6620 6f70 7469 6f6e 7320 666f 7220   of options for 
+000149c0: 6765 7262 6572 2065 7870 6f72 742e 0a20  gerber export.. 
+000149d0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+000149e0: 6561 6465 723a 204c 6973 745b 7374 725d  eader: List[str]
+000149f0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 0a20   | None = None. 
+00014a00: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00014a10: 6f64 653a 204c 6974 6572 616c 5b22 6d6d  ode: Literal["mm
+00014a20: 222c 2022 696e 225d 203d 2022 6d6d 220a  ", "in"] = "mm".
+00014a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a40: 7265 736f 6c75 7469 6f6e 3a20 666c 6f61  resolution: floa
+00014a50: 7420 3d20 3165 2d36 0a20 2020 2020 2020  t = 1e-6.       
+00014a60: 2020 2020 2020 2020 2069 6e74 5f73 697a           int_siz
+00014a70: 653a 2069 6e74 203d 2034 0a20 2020 2020  e: int = 4.     
+00014a80: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00014a90: 726f 6d20 6764 7366 6163 746f 7279 2e65  rom gdsfactory.e
+00014aa0: 7870 6f72 742e 746f 5f67 6572 6265 7220  xport.to_gerber 
+00014ab0: 696d 706f 7274 2074 6f5f 6765 7262 6572  import to_gerber
+00014ac0: 0a0a 2020 2020 2020 2020 746f 5f67 6572  ..        to_ger
+00014ad0: 6265 7228 0a20 2020 2020 2020 2020 2020  ber(.           
+00014ae0: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
+00014af0: 2020 2064 6972 7061 7468 3d64 6972 7061     dirpath=dirpa
+00014b00: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+00014b10: 6c61 7965 726d 6170 5f74 6f5f 6765 7262  layermap_to_gerb
+00014b20: 6572 5f6c 6179 6572 3d6c 6179 6572 6d61  er_layer=layerma
+00014b30: 705f 746f 5f67 6572 6265 725f 6c61 7965  p_to_gerber_laye
+00014b40: 722c 0a20 2020 2020 2020 2020 2020 206f  r,.            o
+00014b50: 7074 696f 6e73 3d6f 7074 696f 6e73 2c0a  ptions=options,.
+00014b60: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00014b70: 6566 2074 6f5f 676d 7368 2873 656c 662c  ef to_gmsh(self,
+00014b80: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+00014b90: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00014ba0: 2020 2022 2222 4465 7072 6563 6174 6564     """Deprecated
+00014bb0: 2e20 696e 7374 6561 6420 6f66 2e0a 0a20  . instead of... 
+00014bc0: 2020 2020 2020 206d 6573 6820 3d20 636f         mesh = co
+00014bd0: 6d70 6f6e 656e 742e 746f 5f67 6d73 6828  mponent.to_gmsh(
+00014be0: 6172 6775 6d65 6e74 7329 0a0a 2020 2020  arguments)..    
+00014bf0: 2020 2020 5573 653a 0a0a 2020 2020 2020      Use:..      
+00014c00: 2020 6672 6f6d 2067 706c 7567 696e 732e    from gplugins.
+00014c10: 676d 7368 2e67 6574 5f6d 6573 6820 696d  gmsh.get_mesh im
+00014c20: 706f 7274 2067 6574 5f6d 6573 680a 0a20  port get_mesh.. 
+00014c30: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00014c40: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00014c50: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00014c60: 2020 2222 2263 6f6d 706f 6e65 6e74 2e74    """component.t
+00014c70: 6f5f 676d 7368 2829 2068 6173 2062 6565  o_gmsh() has bee
+00014c80: 6e20 6465 7072 6563 6174 6564 2e20 496e  n deprecated. In
+00014c90: 7374 6561 6420 6f66 3a0a 0a20 2020 2020  stead of:..     
+00014ca0: 2020 206d 6573 6820 3d20 636f 6d70 6f6e     mesh = compon
+00014cb0: 656e 742e 746f 5f67 6d73 6828 6172 6775  ent.to_gmsh(argu
+00014cc0: 6d65 6e74 7329 0a0a 2020 2020 2020 2020  ments)..        
+00014cd0: 5573 653a 0a0a 2020 2020 2020 2020 6672  Use:..        fr
+00014ce0: 6f6d 2067 706c 7567 696e 732e 676d 7368  om gplugins.gmsh
+00014cf0: 2e67 6574 5f6d 6573 6820 696d 706f 7274  .get_mesh import
+00014d00: 2067 6574 5f6d 6573 680a 0a20 2020 2020   get_mesh..     
+00014d10: 2020 206d 6573 6820 3d20 6765 745f 6d65     mesh = get_me
+00014d20: 7368 2863 6f6d 706f 6e65 6e74 2c20 6172  sh(component, ar
+00014d30: 6775 6d65 6e74 7329 0a20 2020 2020 2020  guments).       
+00014d40: 2022 2222 0a20 2020 2020 2020 2029 0a0a   """.        )..
+00014d50: 2020 2020 6465 6620 6f66 6673 6574 280a      def offset(.
+00014d60: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00014d70: 2020 2020 2020 6469 7374 616e 6365 3a20        distance: 
+00014d80: 666c 6f61 7420 3d20 302e 312c 0a20 2020  float = 0.1,.   
+00014d90: 2020 2020 2075 7365 5f75 6e69 6f6e 3a20       use_union: 
+00014da0: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
+00014db0: 2020 2020 2070 7265 6369 7369 6f6e 3a20       precision: 
+00014dc0: 666c 6f61 7420 3d20 3165 2d34 2c0a 2020  float = 1e-4,.  
+00014dd0: 2020 2020 2020 6a6f 696e 3a20 7374 7220        join: str 
+00014de0: 3d20 226d 6974 6572 222c 0a20 2020 2020  = "miter",.     
+00014df0: 2020 2074 6f6c 6572 616e 6365 3a20 696e     tolerance: in
+00014e00: 7420 3d20 322c 0a20 2020 2020 2020 206c  t = 2,.        l
+00014e10: 6179 6572 3a20 4c61 7965 7253 7065 6320  ayer: LayerSpec 
+00014e20: 3d20 2257 4722 2c0a 2020 2020 2920 2d3e  = "WG",.    ) ->
+00014e30: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
+00014e40: 2020 2020 2222 2252 6574 7572 6e73 206e      """Returns n
+00014e50: 6577 2043 6f6d 706f 6e65 6e74 2077 6974  ew Component wit
+00014e60: 6820 706f 6c79 676f 6e73 2065 726f 6465  h polygons erode
+00014e70: 6420 6f72 2064 696c 6174 6564 2062 7920  d or dilated by 
+00014e80: 616e 206f 6666 7365 742e 0a0a 2020 2020  an offset...    
+00014e90: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00014ea0: 2020 6469 7374 616e 6365 3a20 4469 7374    distance: Dist
+00014eb0: 616e 6365 2074 6f20 6f66 6673 6574 2070  ance to offset p
+00014ec0: 6f6c 7967 6f6e 732e 2050 6f73 6974 6976  olygons. Positiv
+00014ed0: 6520 7661 6c75 6573 2065 7870 616e 642c  e values expand,
+00014ee0: 206e 6567 6174 6976 6520 7368 7269 6e6b   negative shrink
+00014ef0: 2e0a 2020 2020 2020 2020 7573 655f 756e  ..        use_un
+00014f00: 696f 6e3a 2049 6620 5472 7565 2c20 7573  ion: If True, us
+00014f10: 6520 756e 696f 6e20 6f66 2061 6c6c 2070  e union of all p
+00014f20: 6f6c 7967 6f6e 7320 746f 206f 6666 7365  olygons to offse
+00014f30: 742e 2049 6620 4661 6c73 652c 206f 6666  t. If False, off
+00014f40: 7365 740a 2020 2020 2020 2020 7072 6563  set.        prec
+00014f50: 6973 696f 6e3a 2044 6573 6972 6564 2070  ision: Desired p
+00014f60: 7265 6369 7369 6f6e 2066 6f72 2072 6f75  recision for rou
+00014f70: 6e64 696e 6720 7665 7274 6578 2063 6f6f  nding vertex coo
+00014f80: 7264 696e 6174 6573 2e0a 2020 2020 2020  rdinates..      
+00014f90: 2020 6a6f 696e 3a20 7b27 6d69 7465 7227    join: {'miter'
+00014fa0: 2c20 2762 6576 656c 272c 2027 726f 756e  , 'bevel', 'roun
+00014fb0: 6427 7d20 5479 7065 206f 6620 6a6f 696e  d'} Type of join
+00014fc0: 2075 7365 6420 746f 2063 7265 6174 6520   used to create 
+00014fd0: 706f 6c79 676f 6e20 6f66 6673 6574 0a20  polygon offset. 
+00014fe0: 2020 2020 2020 2074 6f6c 6572 616e 6365         tolerance
+00014ff0: 3a20 466f 7220 6d69 7465 7220 6a6f 696e  : For miter join
+00015000: 7473 2c20 7468 6973 206e 756d 6265 7220  ts, this number 
+00015010: 6d75 7374 2062 6520 6174 206c 6561 7374  must be at least
+00015020: 2032 2072 6570 7265 7365 6e74 7320 7468   2 represents th
+00015030: 650a 2020 2020 2020 2020 2020 6d61 7869  e.          maxi
+00015040: 6d61 6c20 6469 7374 616e 6365 2069 6e20  mal distance in 
+00015050: 6d75 6c74 6970 6c65 7320 6f66 206f 6666  multiples of off
+00015060: 7365 7420 6265 7477 6565 6e20 6e65 7720  set between new 
+00015070: 7665 7274 6963 6573 2061 6e64 2074 6865  vertices and the
+00015080: 6972 0a20 2020 2020 2020 2020 206f 7269  ir.          ori
+00015090: 6769 6e61 6c20 706f 7369 7469 6f6e 2062  ginal position b
+000150a0: 6566 6f72 6520 6265 7665 6c69 6e67 2074  efore beveling t
+000150b0: 6f20 6176 6f69 6420 7370 696b 6573 2061  o avoid spikes a
+000150c0: 7420 6163 7574 6520 6a6f 696e 7473 2e20  t acute joints. 
+000150d0: 466f 720a 2020 2020 2020 2020 2020 726f  For.          ro
+000150e0: 756e 6420 6a6f 696e 7473 2c20 6974 2069  und joints, it i
+000150f0: 6e64 6963 6174 6573 2074 6865 2063 7572  ndicates the cur
+00015100: 7661 7475 7265 2072 6573 6f6c 7574 696f  vature resolutio
+00015110: 6e20 696e 206e 756d 6265 7220 6f66 0a20  n in number of. 
+00015120: 2020 2020 2020 2020 2070 6f69 6e74 7320           points 
+00015130: 7065 7220 6675 6c6c 2063 6972 636c 652e  per full circle.
+00015140: 0a20 2020 2020 2020 206c 6179 6572 3a20  .        layer: 
+00015150: 5370 6563 6966 6963 206c 6179 6572 2074  Specific layer t
+00015160: 6f20 7075 7420 706f 6c79 676f 6e20 6765  o put polygon ge
+00015170: 6f6d 6574 7279 206f 6e2e 0a0a 2020 2020  ometry on...    
+00015180: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00015190: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+000151a0: 6765 6f6d 6574 7279 2e6f 6666 7365 7420  geometry.offset 
+000151b0: 696d 706f 7274 206f 6666 7365 740a 0a20  import offset.. 
+000151c0: 2020 2020 2020 2072 6574 7572 6e20 6f66         return of
+000151d0: 6673 6574 280a 2020 2020 2020 2020 2020  fset(.          
+000151e0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+000151f0: 2020 2020 6469 7374 616e 6365 3d64 6973      distance=dis
+00015200: 7461 6e63 652c 0a20 2020 2020 2020 2020  tance,.         
+00015210: 2020 2075 7365 5f75 6e69 6f6e 3d75 7365     use_union=use
+00015220: 5f75 6e69 6f6e 2c0a 2020 2020 2020 2020  _union,.        
+00015230: 2020 2020 7072 6563 6973 696f 6e3d 7072      precision=pr
+00015240: 6563 6973 696f 6e2c 0a20 2020 2020 2020  ecision,.       
+00015250: 2020 2020 206a 6f69 6e3d 6a6f 696e 2c0a       join=join,.
+00015260: 2020 2020 2020 2020 2020 2020 746f 6c65              tole
+00015270: 7261 6e63 653d 746f 6c65 7261 6e63 652c  rance=tolerance,
+00015280: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+00015290: 6572 3d6c 6179 6572 2c0a 2020 2020 2020  er=layer,.      
+000152a0: 2020 290a 0a20 2020 2064 6566 2061 6464    )..    def add
+000152b0: 5f72 6f75 7465 5f69 6e66 6f28 0a20 2020  _route_info(.   
+000152c0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+000152d0: 2020 2063 726f 7373 5f73 6563 7469 6f6e     cross_section
+000152e0: 3a20 4372 6f73 7353 6563 7469 6f6e 207c  : CrossSection |
+000152f0: 2073 7472 2c0a 2020 2020 2020 2020 6c65   str,.        le
+00015300: 6e67 7468 3a20 666c 6f61 742c 0a20 2020  ngth: float,.   
+00015310: 2020 2020 206c 656e 6774 685f 6566 663a       length_eff:
+00015320: 2066 6c6f 6174 207c 204e 6f6e 6520 3d20   float | None = 
+00015330: 4e6f 6e65 2c0a 2020 2020 2020 2020 7461  None,.        ta
+00015340: 7065 723a 2062 6f6f 6c20 3d20 4661 6c73  per: bool = Fals
+00015350: 652c 0a20 2020 2020 2020 202a 2a6b 7761  e,.        **kwa
+00015360: 7267 732c 0a20 2020 2029 202d 3e20 4e6f  rgs,.    ) -> No
+00015370: 6e65 3a0a 2020 2020 2020 2020 2222 2241  ne:.        """A
+00015380: 6464 7320 726f 7574 6520 696e 666f 726d  dds route inform
+00015390: 6174 696f 6e20 746f 2061 2063 6f6d 706f  ation to a compo
+000153a0: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
+000153b0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+000153c0: 2063 726f 7373 5f73 6563 7469 6f6e 3a20   cross_section: 
+000153d0: 4372 6f73 7353 6563 7469 6f6e 206f 7220  CrossSection or 
+000153e0: 6e61 6d65 206f 6620 7468 6520 6372 6f73  name of the cros
+000153f0: 735f 7365 6374 696f 6e2e 0a20 2020 2020  s_section..     
+00015400: 2020 2020 2020 206c 656e 6774 683a 206c         length: l
+00015410: 656e 6774 6820 6f66 2074 6865 2072 6f75  ength of the rou
+00015420: 7465 2e0a 2020 2020 2020 2020 2020 2020  te..            
+00015430: 6c65 6e67 7468 5f65 6666 3a20 6566 6665  length_eff: effe
+00015440: 6374 6976 6520 6c65 6e67 7468 206f 6620  ctive length of 
+00015450: 7468 6520 726f 7574 652e 0a20 2020 2020  the route..     
+00015460: 2020 2020 2020 2074 6170 6572 3a20 6966         taper: if
+00015470: 2054 7275 6520 6164 6473 2074 6170 6572   True adds taper
+00015480: 2069 6e66 6f72 6d61 7469 6f6e 2e0a 2020   information..  
+00015490: 2020 2020 2020 2020 2020 2a2a 6b77 6172            **kwar
+000154a0: 6773 3a20 6578 7472 6120 696e 666f 726d  gs: extra inform
+000154b0: 6174 696f 6e20 746f 2061 6464 2074 6f20  ation to add to 
+000154c0: 7468 6520 636f 6d70 6f6e 656e 742e 0a20  the component.. 
+000154d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000154e0: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+000154f0: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
+00015500: 745f 6163 7469 7665 5f70 646b 0a0a 2020  t_active_pdk..  
+00015510: 2020 2020 2020 7064 6b20 3d20 6765 745f        pdk = get_
+00015520: 6163 7469 7665 5f70 646b 2829 0a0a 2020  active_pdk()..  
+00015530: 2020 2020 2020 6c65 6e67 7468 5f65 6666        length_eff
+00015540: 203d 206c 656e 6774 685f 6566 6620 6f72   = length_eff or
+00015550: 206c 656e 6774 680a 2020 2020 2020 2020   length.        
+00015560: 6c65 6e67 7468 5f65 6666 203d 2066 6c6f  length_eff = flo
+00015570: 6174 286c 656e 6774 685f 6566 6629 0a20  at(length_eff). 
+00015580: 2020 2020 2020 2078 735f 6e61 6d65 203d         xs_name =
+00015590: 2028 0a20 2020 2020 2020 2020 2020 2063   (.            c
+000155a0: 726f 7373 5f73 6563 7469 6f6e 0a20 2020  ross_section.   
+000155b0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+000155c0: 7374 616e 6365 2863 726f 7373 5f73 6563  stance(cross_sec
+000155d0: 7469 6f6e 2c20 7374 7229 0a20 2020 2020  tion, str).     
+000155e0: 2020 2020 2020 2065 6c73 6520 7064 6b2e         else pdk.
+000155f0: 6765 745f 6372 6f73 735f 7365 6374 696f  get_cross_sectio
+00015600: 6e5f 6e61 6d65 2863 726f 7373 5f73 6563  n_name(cross_sec
+00015610: 7469 6f6e 290a 2020 2020 2020 2020 290a  tion).        ).
+00015620: 0a20 2020 2020 2020 2069 6e66 6f20 3d20  .        info = 
+00015630: 7365 6c66 2e69 6e66 6f0a 2020 2020 2020  self.info.      
+00015640: 2020 6966 2074 6170 6572 3a0a 2020 2020    if taper:.    
+00015650: 2020 2020 2020 2020 696e 666f 5b66 2272          info[f"r
+00015660: 6f75 7465 5f69 6e66 6f5f 7b78 735f 6e61  oute_info_{xs_na
+00015670: 6d65 7d5f 7461 7065 725f 6c65 6e67 7468  me}_taper_length
+00015680: 225d 203d 206c 656e 6774 680a 0a20 2020  "] = length..   
+00015690: 2020 2020 2069 6e66 6f5b 2272 6f75 7465       info["route
+000156a0: 5f69 6e66 6f5f 7479 7065 225d 203d 2078  _info_type"] = x
+000156b0: 735f 6e61 6d65 0a20 2020 2020 2020 2069  s_name.        i
+000156c0: 6e66 6f5b 2272 6f75 7465 5f69 6e66 6f5f  nfo["route_info_
+000156d0: 6c65 6e67 7468 225d 203d 206c 656e 6774  length"] = lengt
+000156e0: 685f 6566 660a 2020 2020 2020 2020 696e  h_eff.        in
+000156f0: 666f 5b22 726f 7574 655f 696e 666f 5f77  fo["route_info_w
+00015700: 6569 6768 7422 5d20 3d20 6c65 6e67 7468  eight"] = length
+00015710: 5f65 6666 0a20 2020 2020 2020 2069 6e66  _eff.        inf
+00015720: 6f5b 6622 726f 7574 655f 696e 666f 5f7b  o[f"route_info_{
+00015730: 7873 5f6e 616d 657d 5f6c 656e 6774 6822  xs_name}_length"
+00015740: 5d20 3d20 6c65 6e67 7468 5f65 6666 0a20  ] = length_eff. 
+00015750: 2020 2020 2020 2066 6f72 206b 6579 2c20         for key, 
+00015760: 7661 6c75 6520 696e 206b 7761 7267 732e  value in kwargs.
+00015770: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+00015780: 2020 2020 2069 6e66 6f5b 6622 726f 7574       info[f"rout
+00015790: 655f 696e 666f 5f7b 6b65 797d 225d 203d  e_info_{key}"] =
+000157a0: 2076 616c 7565 0a0a 2020 2020 6465 6620   value..    def 
+000157b0: 6765 745f 636f 6d70 6f6e 656e 745f 7370  get_component_sp
+000157c0: 6563 2873 656c 6629 202d 3e20 436f 6d70  ec(self) -> Comp
+000157d0: 6f6e 656e 7453 7065 633a 0a20 2020 2020  onentSpec:.     
+000157e0: 2020 2072 6574 7572 6e20 436f 6d70 6f6e     return Compon
+000157f0: 656e 7453 7065 6328 0a20 2020 2020 2020  entSpec(.       
+00015800: 2020 2020 2066 756e 6374 696f 6e3d 7365       function=se
+00015810: 6c66 2e66 756e 6374 696f 6e5f 6e61 6d65  lf.function_name
+00015820: 2c0a 2020 2020 2020 2020 2020 2020 6d6f  ,.            mo
+00015830: 6475 6c65 3d73 656c 662e 6d6f 6475 6c65  dule=self.module
+00015840: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
+00015850: 7474 696e 6773 3d73 656c 662e 7365 7474  ttings=self.sett
+00015860: 696e 6773 2c0a 2020 2020 2020 2020 290a  ings,.        ).
+00015870: 0a20 2020 2023 2044 6570 7265 6361 7465  .    # Deprecate
+00015880: 640a 2020 2020 4070 726f 7065 7274 790a  d.    @property.
+00015890: 2020 2020 6465 6620 6d65 7461 6461 7461      def metadata
+000158a0: 5f63 6869 6c64 2873 656c 6629 202d 3e20  _child(self) -> 
+000158b0: 6469 6374 3a0a 2020 2020 2020 2020 2222  dict:.        ""
+000158c0: 2252 6574 7572 6e73 206d 6574 6164 6174  "Returns metadat
+000158d0: 6120 6672 6f6d 2063 6869 6c64 2069 6620  a from child if 
+000158e0: 616e 792c 204f 7468 6572 7769 7365 2072  any, Otherwise r
+000158f0: 6574 7572 6e73 2063 6f6d 706f 6e65 6e74  eturns component
+00015900: 206f 776e 2e0a 2020 2020 2020 2020 6d65   own..        me
+00015910: 7461 6461 7461 2063 616e 2061 6363 6573  tadata can acces
+00015920: 7320 7468 6520 6368 696c 6472 656e 206d  s the children m
+00015930: 6574 6164 6174 6120 6174 2074 6865 2062  etadata at the b
+00015940: 6f74 746f 6d20 6f66 2074 6865 2068 6965  ottom of the hie
+00015950: 7261 7263 6879 2e0a 2020 2020 2020 2020  rarchy..        
+00015960: 2222 220a 2020 2020 2020 2020 7761 726e  """.        warn
+00015970: 696e 6773 2e77 6172 6e28 0a20 2020 2020  ings.warn(.     
+00015980: 2020 2020 2020 2022 6d65 7461 6461 7461         "metadata
+00015990: 5f63 6869 6c64 2069 7320 6465 7072 6563  _child is deprec
+000159a0: 6174 6564 2061 6e64 2077 696c 6c20 6265  ated and will be
+000159b0: 2072 656d 6f76 6564 2069 6e20 6675 7475   removed in futu
+000159c0: 7265 2076 6572 7369 6f6e 7320 6f66 2067  re versions of g
+000159d0: 6473 6661 6374 6f72 7922 0a20 2020 2020  dsfactory".     
+000159e0: 2020 2029 0a20 2020 2020 2020 2073 6574     ).        set
+000159f0: 7469 6e67 7320 3d20 6469 6374 2873 656c  tings = dict(sel
+00015a00: 662e 7365 7474 696e 6773 290a 0a20 2020  f.settings)..   
+00015a10: 2020 2020 2077 6869 6c65 2073 6574 7469       while setti
+00015a20: 6e67 732e 6765 7428 2263 6869 6c64 2229  ngs.get("child")
+00015a30: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00015a40: 7474 696e 6773 203d 2073 6574 7469 6e67  ttings = setting
+00015a50: 732e 6765 7428 2263 6869 6c64 2229 0a0a  s.get("child")..
+00015a60: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00015a70: 6963 7428 7365 7474 696e 6773 290a 0a20  ict(settings).. 
+00015a80: 2020 2064 6566 2067 6574 5f69 6e66 6f28     def get_info(
+00015a90: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00015aa0: 2222 4761 7468 6572 7320 7468 6520 2e69  ""Gathers the .i
+00015ab0: 6e66 6f20 6469 6374 696f 6e61 7269 6573  nfo dictionaries
+00015ac0: 2066 726f 6d20 6576 6572 7920 7375 622d   from every sub-
+00015ad0: 436f 6d70 6f6e 656e 7420 616e 6420 7265  Component and re
+00015ae0: 7475 726e 7320 7468 656d 2069 6e20 6120  turns them in a 
+00015af0: 6c69 7374 2e0a 0a20 2020 2020 2020 2041  list...        A
+00015b00: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00015b10: 2064 6570 7468 3a20 696e 7420 6f72 204e   depth: int or N
+00015b20: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00015b30: 2020 2020 4966 206e 6f74 204e 6f6e 652c      If not None,
+00015b40: 2064 6566 696e 6573 2066 726f 6d20 686f   defines from ho
+00015b50: 7720 6d61 6e79 2072 6566 6572 656e 6365  w many reference
+00015b60: 206c 6576 656c 7320 746f 0a20 2020 2020   levels to.     
+00015b70: 2020 2020 2020 2020 2020 2072 6574 7269             retri
+00015b80: 6576 6520 506f 7274 7320 6672 6f6d 2e0a  eve Ports from..
+00015b90: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00015ba0: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
+00015bb0: 7374 206f 6620 6469 6374 696f 6e61 7269  st of dictionari
+00015bc0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00015bd0: 2020 204c 6973 7420 6f66 2074 6865 2022     List of the "
+00015be0: 2e69 6e66 6f22 2070 726f 7065 7274 7920  .info" property 
+00015bf0: 6469 6374 696f 6e61 7269 6573 2066 726f  dictionaries fro
+00015c00: 6d20 616c 6c20 7375 622d 436f 6d70 6f6e  m all sub-Compon
+00015c10: 656e 7473 0a20 2020 2020 2020 2022 2222  ents.        """
+00015c20: 0a20 2020 2020 2020 2077 6172 6e69 6e67  .        warning
+00015c30: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
+00015c40: 2020 2020 2267 6574 5f69 6e66 6f20 6973      "get_info is
+00015c50: 2064 6570 7265 6361 7465 6420 616e 6420   deprecated and 
+00015c60: 7769 6c6c 2062 6520 7265 6d6f 7665 6420  will be removed 
+00015c70: 696e 2066 7574 7572 6520 7665 7273 696f  in future versio
+00015c80: 6e73 206f 6620 6764 7366 6163 746f 7279  ns of gdsfactory
+00015c90: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+00015ca0: 2020 2020 445f 6c69 7374 203d 2073 656c      D_list = sel
+00015cb0: 662e 6765 745f 6465 7065 6e64 656e 6369  f.get_dependenci
+00015cc0: 6573 2872 6563 7572 7369 7665 3d54 7275  es(recursive=Tru
+00015cd0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+00015ce0: 6e20 5b44 2e69 6e66 6f2e 636f 7079 2829  n [D.info.copy()
+00015cf0: 2066 6f72 2044 2069 6e20 445f 6c69 7374   for D in D_list
+00015d00: 5d0a 0a20 2020 2064 6566 2067 6574 5f6e  ]..    def get_n
+00015d10: 6574 6c69 7374 5f79 616d 6c28 7365 6c66  etlist_yaml(self
+00015d20: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2064  , **kwargs) -> d
+00015d30: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
+00015d40: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
+00015d50: 6163 746f 7279 2e67 6574 5f6e 6574 6c69  actory.get_netli
+00015d60: 7374 2069 6d70 6f72 7420 6765 745f 6e65  st import get_ne
+00015d70: 746c 6973 745f 7961 6d6c 0a0a 2020 2020  tlist_yaml..    
+00015d80: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
+00015d90: 6e28 0a20 2020 2020 2020 2020 2020 2022  n(.            "
+00015da0: 6765 745f 6e65 746c 6973 745f 7961 6d6c  get_netlist_yaml
+00015db0: 2069 7320 6465 7072 6563 6174 6564 2061   is deprecated a
+00015dc0: 6e64 2077 696c 6c20 6265 2072 656d 6f76  nd will be remov
+00015dd0: 6564 2069 6e20 6675 7475 7265 2076 6572  ed in future ver
+00015de0: 7369 6f6e 7320 6f66 2067 6473 6661 6374  sions of gdsfact
+00015df0: 6f72 7922 0a20 2020 2020 2020 2020 2020  ory".           
+00015e00: 2022 5573 6520 746f 5f79 616d 6c20 696e   "Use to_yaml in
+00015e10: 7374 6561 6422 0a20 2020 2020 2020 2029  stead".        )
+00015e20: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00015e30: 2067 6574 5f6e 6574 6c69 7374 5f79 616d   get_netlist_yam
+00015e40: 6c28 7365 6c66 2c20 2a2a 6b77 6172 6773  l(self, **kwargs
+00015e50: 290a 0a20 2020 2064 6566 2067 6574 5f73  )..    def get_s
+00015e60: 6574 7469 6e67 2873 656c 662c 2073 6574  etting(self, set
+00015e70: 7469 6e67 3a20 7374 7229 202d 3e20 7374  ting: str) -> st
+00015e80: 7220 7c20 696e 7420 7c20 666c 6f61 743a  r | int | float:
+00015e90: 0a20 2020 2020 2020 2077 6172 6e69 6e67  .        warning
+00015ea0: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
+00015eb0: 2020 2020 2267 6574 5f73 6574 7469 6e67      "get_setting
+00015ec0: 2069 7320 6465 7072 6563 6174 6564 2061   is deprecated a
+00015ed0: 6e64 2077 696c 6c20 6265 2072 656d 6f76  nd will be remov
+00015ee0: 6564 2069 6e20 6675 7475 7265 2076 6572  ed in future ver
+00015ef0: 7369 6f6e 7320 6f66 2067 6473 6661 6374  sions of gdsfact
+00015f00: 6f72 7922 0a20 2020 2020 2020 2029 0a20  ory".        ). 
+00015f10: 2020 2020 2020 2072 6574 7572 6e20 280a         return (.
+00015f20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00015f30: 2e69 6e66 6f2e 6765 7428 7365 7474 696e  .info.get(settin
+00015f40: 6729 0a20 2020 2020 2020 2020 2020 206f  g).            o
+00015f50: 7220 7365 6c66 2e73 6574 7469 6e67 732e  r self.settings.
+00015f60: 6765 7428 7365 7474 696e 6729 0a20 2020  get(setting).   
+00015f70: 2020 2020 2020 2020 206f 7220 7365 6c66           or self
+00015f80: 2e6d 6574 6164 6174 615f 6368 696c 642e  .metadata_child.
+00015f90: 6765 7428 7365 7474 696e 6729 0a20 2020  get(setting).   
+00015fa0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00015fb0: 756e 6c6f 636b 2873 656c 6629 202d 3e20  unlock(self) -> 
+00015fc0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00015fd0: 224f 6e6c 7920 646f 2074 6869 7320 6966  "Only do this if
+00015fe0: 2079 6f75 206b 6e6f 7720 7768 6174 2079   you know what y
+00015ff0: 6f75 2061 7265 2064 6f69 6e67 2e22 2222  ou are doing."""
+00016000: 0a20 2020 2020 2020 2077 6172 6e69 6e67  .        warning
+00016010: 732e 7761 726e 2822 7765 2077 696c 6c20  s.warn("we will 
+00016020: 7265 6d6f 7665 2075 6e6c 6f63 6b20 746f  remove unlock to
+00016030: 2064 6973 636f 7572 6167 6520 7573 6522   discourage use"
+00016040: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00016050: 6c6f 636b 6564 203d 2046 616c 7365 0a0a  locked = False..
+00016060: 2020 2020 6465 6620 6c6f 636b 2873 656c      def lock(sel
+00016070: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00016080: 2020 2020 2222 224d 616b 6573 2073 7572      """Makes sur
+00016090: 6520 636f 6d70 6f6e 656e 7473 2063 616e  e components can
+000160a0: 2774 2061 6464 206e 6577 2065 6c65 6d65  't add new eleme
+000160b0: 6e74 7320 6f72 206d 6f76 6520 6578 6973  nts or move exis
+000160c0: 7469 6e67 206f 6e65 732e 0a0a 2020 2020  ting ones...    
+000160d0: 2020 2020 436f 6d70 6f6e 656e 7473 206c      Components l
+000160e0: 6f63 6b20 6175 746f 6d61 7469 6361 6c6c  ock automaticall
+000160f0: 7920 7768 656e 2067 6f69 6e67 2069 6e74  y when going int
+00016100: 6f20 7468 6520 4341 4348 4520 746f 0a20  o the CACHE to. 
+00016110: 2020 2020 2020 2065 6e73 7572 6520 6f6e         ensure on
+00016120: 6520 636f 6d70 6f6e 656e 7420 646f 6573  e component does
+00016130: 206e 6f74 2063 6861 6e67 6520 6f74 6865   not change othe
+00016140: 7273 0a20 2020 2020 2020 2022 2222 0a20  rs.        """. 
+00016150: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+00016160: 7761 726e 2822 7765 2077 696c 6c20 7265  warn("we will re
+00016170: 6d6f 7665 206c 6f63 6b20 746f 2064 6973  move lock to dis
+00016180: 636f 7572 6167 6520 7573 6522 290a 2020  courage use").  
+00016190: 2020 2020 2020 7365 6c66 2e5f 6c6f 636b        self._lock
+000161a0: 6564 203d 2054 7275 650a 0a20 2020 2040  ed = True..    @
+000161b0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+000161c0: 206d 6574 6164 6174 6128 7365 6c66 2920   metadata(self) 
+000161d0: 2d3e 2064 6963 743a 0a20 2020 2020 2020  -> dict:.       
+000161e0: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
+000161f0: 2020 2020 2020 2020 2020 2020 226d 6574              "met
+00016200: 6164 6174 6120 6973 2064 6570 7265 6361  adata is depreca
+00016210: 7465 6420 616e 6420 7769 6c6c 2062 6520  ted and will be 
+00016220: 7265 6d6f 7665 6420 696e 2066 7574 7572  removed in futur
+00016230: 6520 7665 7273 696f 6e73 206f 6620 6764  e versions of gd
+00016240: 7366 6163 746f 7279 2e20 220a 2020 2020  sfactory. ".    
+00016250: 2020 2020 2020 2020 2255 7365 2063 6f6d          "Use com
+00016260: 706f 6e65 6e74 2e73 6574 7469 6e67 7320  ponent.settings 
+00016270: 666f 7220 6163 6365 7373 696e 6720 636f  for accessing co
+00016280: 6d70 6f6e 656e 7420 7365 7474 696e 6773  mponent settings
+00016290: 206f 7220 636f 6d70 6f6e 656e 742e 696e   or component.in
+000162a0: 666f 2066 6f72 2063 6f6d 706f 6e65 6e74  fo for component
+000162b0: 2069 6e66 6f2e 220a 2020 2020 2020 2020   info.".        
+000162c0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000162d0: 2064 6963 7428 7365 6c66 2e73 6574 7469   dict(self.setti
+000162e0: 6e67 7329 0a0a 0a23 2043 6f6d 706f 6e65  ngs)...# Compone
+000162f0: 6e74 2066 756e 6374 696f 6e73 0a0a 0a64  nt functions...d
+00016300: 6566 2063 6f70 7928 0a20 2020 2044 3a20  ef copy(.    D: 
+00016310: 436f 6d70 6f6e 656e 742c 0a20 2020 2072  Component,.    r
+00016320: 6566 6572 656e 6365 733d 4e6f 6e65 2c0a  eferences=None,.
+00016330: 2020 2020 706f 7274 733d 4e6f 6e65 2c0a      ports=None,.
+00016340: 2020 2020 706f 6c79 676f 6e73 3d4e 6f6e      polygons=Non
+00016350: 652c 0a20 2020 2070 6174 6873 3d4e 6f6e  e,.    paths=Non
+00016360: 652c 0a20 2020 206e 616d 653d 4e6f 6e65  e,.    name=None
+00016370: 2c0a 2020 2020 6c61 6265 6c73 3d4e 6f6e  ,.    labels=Non
+00016380: 652c 0a29 202d 3e20 436f 6d70 6f6e 656e  e,.) -> Componen
+00016390: 743a 0a20 2020 2022 2222 5265 7475 726e  t:.    """Return
+000163a0: 7320 6120 436f 6d70 6f6e 656e 7420 636f  s a Component co
+000163b0: 7079 2e0a 0a20 2020 2041 7267 733a 0a20  py...    Args:. 
+000163c0: 2020 2020 2020 2044 3a20 636f 6d70 6f6e         D: compon
+000163d0: 656e 7420 746f 2063 6f70 792e 0a20 2020  ent to copy..   
+000163e0: 2020 2020 2072 6566 6572 656e 6365 733a       references:
+000163f0: 2072 6566 6572 656e 6365 7320 746f 2063   references to c
+00016400: 6f70 792e 0a20 2020 2020 2020 2070 6f72  opy..        por
+00016410: 7473 3a20 706f 7274 7320 746f 2063 6f70  ts: ports to cop
+00016420: 792e 0a20 2020 2020 2020 2070 6f6c 7967  y..        polyg
+00016430: 6f6e 733a 2070 6f6c 7967 6f6e 7320 746f  ons: polygons to
+00016440: 2063 6f70 792e 0a20 2020 2020 2020 2070   copy..        p
+00016450: 6174 6873 3a20 7061 7468 7320 746f 2063  aths: paths to c
+00016460: 6f70 792e 0a20 2020 2020 2020 206e 616d  opy..        nam
+00016470: 653a 206e 616d 6520 6f66 2074 6865 206e  e: name of the n
+00016480: 6577 2063 6f6d 706f 6e65 6e74 2e0a 2020  ew component..  
+00016490: 2020 2020 2020 6c61 6265 6c73 3a20 6c61        labels: la
+000164a0: 6265 6c73 2074 6f20 636f 7079 2e0a 2020  bels to copy..  
+000164b0: 2020 2222 220a 2020 2020 6320 3d20 436f    """.    c = Co
+000164c0: 6d70 6f6e 656e 7428 290a 2020 2020 632e  mponent().    c.
+000164d0: 7365 7474 696e 6773 203d 2044 2e73 6574  settings = D.set
+000164e0: 7469 6e67 732e 6d6f 6465 6c5f 636f 7079  tings.model_copy
+000164f0: 2829 0a20 2020 2063 2e69 6e66 6f20 3d20  ().    c.info = 
+00016500: 442e 696e 666f 2e6d 6f64 656c 5f63 6f70  D.info.model_cop
+00016510: 7928 290a 2020 2020 632e 6368 696c 6420  y().    c.child 
+00016520: 3d20 442e 6368 696c 640a 2020 2020 632e  = D.child.    c.
+00016530: 6675 6e63 7469 6f6e 5f6e 616d 6520 3d20  function_name = 
+00016540: 442e 6675 6e63 7469 6f6e 5f6e 616d 650a  D.function_name.
+00016550: 2020 2020 632e 6d6f 6475 6c65 203d 2044      c.module = D
+00016560: 2e6d 6f64 756c 650a 0a20 2020 2066 6f72  .module..    for
+00016570: 2072 6566 2069 6e20 7265 6665 7265 6e63   ref in referenc
+00016580: 6573 2069 6620 7265 6665 7265 6e63 6573  es if references
+00016590: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+000165a0: 6520 442e 7265 6665 7265 6e63 6573 3a0a  e D.references:.
+000165b0: 2020 2020 2020 2020 632e 6164 6428 636f          c.add(co
+000165c0: 7079 5f72 6566 6572 656e 6365 2872 6566  py_reference(ref
+000165d0: 2929 0a20 2020 2066 6f72 2070 6f72 7420  )).    for port 
+000165e0: 696e 2028 706f 7274 7320 6966 2070 6f72  in (ports if por
+000165f0: 7473 2069 7320 6e6f 7420 4e6f 6e65 2065  ts is not None e
+00016600: 6c73 6520 442e 706f 7274 7329 2e76 616c  lse D.ports).val
+00016610: 7565 7328 293a 0a20 2020 2020 2020 2063  ues():.        c
+00016620: 2e61 6464 5f70 6f72 7428 706f 7274 3d70  .add_port(port=p
+00016630: 6f72 7429 0a20 2020 2066 6f72 2070 6f6c  ort).    for pol
+00016640: 7920 696e 2070 6f6c 7967 6f6e 7320 6966  y in polygons if
+00016650: 2070 6f6c 7967 6f6e 7320 6973 206e 6f74   polygons is not
+00016660: 204e 6f6e 6520 656c 7365 2044 2e70 6f6c   None else D.pol
+00016670: 7967 6f6e 733a 0a20 2020 2020 2020 2063  ygons:.        c
+00016680: 2e61 6464 5f70 6f6c 7967 6f6e 2870 6f6c  .add_polygon(pol
+00016690: 7929 0a20 2020 2066 6f72 2070 6174 6820  y).    for path 
+000166a0: 696e 2070 6174 6873 2069 6620 7061 7468  in paths if path
+000166b0: 7320 6973 206e 6f74 204e 6f6e 6520 656c  s is not None el
+000166c0: 7365 2044 2e70 6174 6873 3a0a 2020 2020  se D.paths:.    
+000166d0: 2020 2020 632e 6164 6428 7061 7468 290a      c.add(path).
+000166e0: 2020 2020 666f 7220 6c61 6265 6c20 696e      for label in
+000166f0: 206c 6162 656c 7320 6966 206c 6162 656c   labels if label
+00016700: 7320 6973 206e 6f74 204e 6f6e 6520 656c  s is not None el
+00016710: 7365 2044 2e6c 6162 656c 733a 0a20 2020  se D.labels:.   
+00016720: 2020 2020 2063 2e61 6464 5f6c 6162 656c       c.add_label
+00016730: 280a 2020 2020 2020 2020 2020 2020 7465  (.            te
+00016740: 7874 3d6c 6162 656c 2e74 6578 742c 0a20  xt=label.text,. 
+00016750: 2020 2020 2020 2020 2020 2070 6f73 6974             posit
+00016760: 696f 6e3d 6c61 6265 6c2e 6f72 6967 696e  ion=label.origin
+00016770: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
+00016780: 7965 723d 286c 6162 656c 2e6c 6179 6572  yer=(label.layer
+00016790: 2c20 6c61 6265 6c2e 7465 7874 7479 7065  , label.texttype
+000167a0: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+000167b0: 2020 6966 206e 616d 6520 6973 206e 6f74    if name is not
+000167c0: 204e 6f6e 653a 0a20 2020 2020 2020 2063   None:.        c
+000167d0: 2e6e 616d 6520 3d20 6e61 6d65 0a0a 2020  .name = name..  
+000167e0: 2020 7265 7475 726e 2063 0a0a 0a64 6566    return c...def
+000167f0: 2063 6f70 795f 7265 6665 7265 6e63 6528   copy_reference(
+00016800: 0a20 2020 2072 6566 2c0a 2020 2020 7061  .    ref,.    pa
+00016810: 7265 6e74 3d4e 6f6e 652c 0a20 2020 2063  rent=None,.    c
+00016820: 6f6c 756d 6e73 3d4e 6f6e 652c 0a20 2020  olumns=None,.   
+00016830: 2072 6f77 733d 4e6f 6e65 2c0a 2020 2020   rows=None,.    
+00016840: 7370 6163 696e 673d 4e6f 6e65 2c0a 2020  spacing=None,.  
+00016850: 2020 6f72 6967 696e 3d4e 6f6e 652c 0a20    origin=None,. 
+00016860: 2020 2072 6f74 6174 696f 6e3d 4e6f 6e65     rotation=None
+00016870: 2c0a 2020 2020 6d61 676e 6966 6963 6174  ,.    magnificat
+00016880: 696f 6e3d 4e6f 6e65 2c0a 2020 2020 785f  ion=None,.    x_
+00016890: 7265 666c 6563 7469 6f6e 3d4e 6f6e 652c  reflection=None,
+000168a0: 0a20 2020 206e 616d 653d 4e6f 6e65 2c0a  .    name=None,.
+000168b0: 2020 2020 7631 3d4e 6f6e 652c 0a20 2020      v1=None,.   
+000168c0: 2076 323d 4e6f 6e65 2c0a 2920 2d3e 2043   v2=None,.) -> C
+000168d0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+000168e0: 653a 0a20 2020 2072 6574 7572 6e20 436f  e:.    return Co
+000168f0: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
+00016900: 280a 2020 2020 2020 2020 636f 6d70 6f6e  (.        compon
+00016910: 656e 743d 7061 7265 6e74 206f 7220 7265  ent=parent or re
+00016920: 662e 7061 7265 6e74 2c0a 2020 2020 2020  f.parent,.      
+00016930: 2020 636f 6c75 6d6e 733d 636f 6c75 6d6e    columns=column
+00016940: 7320 6f72 2072 6566 2e63 6f6c 756d 6e73  s or ref.columns
+00016950: 2c0a 2020 2020 2020 2020 726f 7773 3d72  ,.        rows=r
+00016960: 6f77 7320 6f72 2072 6566 2e72 6f77 732c  ows or ref.rows,
+00016970: 0a20 2020 2020 2020 2073 7061 6369 6e67  .        spacing
+00016980: 3d73 7061 6369 6e67 206f 7220 7265 662e  =spacing or ref.
+00016990: 7370 6163 696e 672c 0a20 2020 2020 2020  spacing,.       
+000169a0: 206f 7269 6769 6e3d 6f72 6967 696e 206f   origin=origin o
+000169b0: 7220 7265 662e 6f72 6967 696e 2c0a 2020  r ref.origin,.  
+000169c0: 2020 2020 2020 726f 7461 7469 6f6e 3d72        rotation=r
+000169d0: 6f74 6174 696f 6e20 6f72 2072 6566 2e72  otation or ref.r
+000169e0: 6f74 6174 696f 6e2c 0a20 2020 2020 2020  otation,.       
+000169f0: 206d 6167 6e69 6669 6361 7469 6f6e 3d6d   magnification=m
+00016a00: 6167 6e69 6669 6361 7469 6f6e 206f 7220  agnification or 
+00016a10: 7265 662e 6d61 676e 6966 6963 6174 696f  ref.magnificatio
+00016a20: 6e2c 0a20 2020 2020 2020 2078 5f72 6566  n,.        x_ref
+00016a30: 6c65 6374 696f 6e3d 785f 7265 666c 6563  lection=x_reflec
+00016a40: 7469 6f6e 206f 7220 7265 662e 785f 7265  tion or ref.x_re
+00016a50: 666c 6563 7469 6f6e 2c0a 2020 2020 2020  flection,.      
+00016a60: 2020 6e61 6d65 3d6e 616d 6520 6f72 2072    name=name or r
+00016a70: 6566 2e6e 616d 652c 0a20 2020 2020 2020  ef.name,.       
+00016a80: 2076 313d 7631 206f 7220 7265 662e 7631   v1=v1 or ref.v1
+00016a90: 2c0a 2020 2020 2020 2020 7632 3d76 3220  ,.        v2=v2 
+00016aa0: 6f72 2072 6566 2e76 322c 0a20 2020 2029  or ref.v2,.    )
+00016ab0: 0a0a 0a64 6566 205f 6669 6c74 6572 5f70  ...def _filter_p
+00016ac0: 6f6c 7973 2870 6f6c 7967 6f6e 732c 206c  olys(polygons, l
+00016ad0: 6179 6572 735f 6578 636c 293a 0a20 2020  ayers_excl):.   
+00016ae0: 2072 6574 7572 6e20 5b0a 2020 2020 2020   return [.      
+00016af0: 2020 706f 6c79 676f 6e0a 2020 2020 2020    polygon.      
+00016b00: 2020 666f 7220 706f 6c79 676f 6e2c 206c    for polygon, l
+00016b10: 6179 6572 2c20 6461 7461 7479 7065 2069  ayer, datatype i
+00016b20: 6e20 7a69 7028 0a20 2020 2020 2020 2020  n zip(.         
+00016b30: 2020 2070 6f6c 7967 6f6e 732e 706f 6c79     polygons.poly
+00016b40: 676f 6e73 2c20 706f 6c79 676f 6e73 2e6c  gons, polygons.l
+00016b50: 6179 6572 732c 2070 6f6c 7967 6f6e 732e  ayers, polygons.
+00016b60: 6461 7461 7479 7065 730a 2020 2020 2020  datatypes.      
+00016b70: 2020 290a 2020 2020 2020 2020 6966 2028    ).        if (
+00016b80: 6c61 7965 722c 2064 6174 6174 7970 6529  layer, datatype)
+00016b90: 206e 6f74 2069 6e20 6c61 7965 7273 5f65   not in layers_e
+00016ba0: 7863 6c0a 2020 2020 5d0a 0a0a 6465 6620  xcl.    ]...def 
+00016bb0: 7265 6375 7273 655f 7374 7275 6374 7572  recurse_structur
+00016bc0: 6573 280a 2020 2020 636f 6d70 6f6e 656e  es(.    componen
+00016bd0: 743a 2043 6f6d 706f 6e65 6e74 2c0a 2020  t: Component,.  
+00016be0: 2020 6967 6e6f 7265 5f63 6f6d 706f 6e65    ignore_compone
+00016bf0: 6e74 735f 7072 6566 6978 3a20 6c69 7374  nts_prefix: list
+00016c00: 5b73 7472 5d20 7c20 4e6f 6e65 203d 204e  [str] | None = N
+00016c10: 6f6e 652c 0a20 2020 2069 676e 6f72 655f  one,.    ignore_
+00016c20: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
+00016c30: 3a20 6c69 7374 5b73 7472 5d20 7c20 4e6f  : list[str] | No
+00016c40: 6e65 203d 204e 6f6e 652c 0a29 202d 3e20  ne = None,.) -> 
+00016c50: 6469 6374 5b73 7472 2c20 416e 795d 3a0a  dict[str, Any]:.
+00016c60: 2020 2020 2222 2252 6563 7572 7365 2063      """Recurse c
+00016c70: 6f6d 706f 6e65 6e74 2061 6e64 2063 6f6d  omponent and com
+00016c80: 706f 6e65 6e74 7320 7265 6665 7265 6e63  ponents referenc
+00016c90: 6573 2072 6563 7572 7369 7665 6c79 2e0a  es recursively..
+00016ca0: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
+00016cb0: 2020 2063 6f6d 706f 6e65 6e74 3a20 636f     component: co
+00016cc0: 6d70 6f6e 656e 7420 746f 2072 6563 7572  mponent to recur
+00016cd0: 7365 2e0a 2020 2020 2020 2020 6967 6e6f  se..        igno
+00016ce0: 7265 5f63 6f6d 706f 6e65 6e74 735f 7072  re_components_pr
+00016cf0: 6566 6978 3a20 6c69 7374 206f 6620 7072  efix: list of pr
+00016d00: 6566 6978 2074 6f20 6967 6e6f 7265 2e0a  efix to ignore..
+00016d10: 2020 2020 2020 2020 6967 6e6f 7265 5f66          ignore_f
+00016d20: 756e 6374 696f 6e73 5f70 7265 6669 783a  unctions_prefix:
+00016d30: 206c 6973 7420 6f66 2070 7265 6669 7820   list of prefix 
+00016d40: 746f 2069 676e 6f72 652e 0a20 2020 2022  to ignore..    "
+00016d50: 2222 0a20 2020 2069 676e 6f72 655f 6675  "".    ignore_fu
+00016d60: 6e63 7469 6f6e 735f 7072 6566 6978 203d  nctions_prefix =
+00016d70: 2069 676e 6f72 655f 6675 6e63 7469 6f6e   ignore_function
+00016d80: 735f 7072 6566 6978 206f 7220 5b5d 0a20  s_prefix or []. 
+00016d90: 2020 2069 676e 6f72 655f 636f 6d70 6f6e     ignore_compon
+00016da0: 656e 7473 5f70 7265 6669 7820 3d20 6967  ents_prefix = ig
+00016db0: 6e6f 7265 5f63 6f6d 706f 6e65 6e74 735f  nore_components_
+00016dc0: 7072 6566 6978 206f 7220 5b5d 0a0a 2020  prefix or []..  
+00016dd0: 2020 6966 2063 6f6d 706f 6e65 6e74 2e66    if component.f
+00016de0: 756e 6374 696f 6e5f 6e61 6d65 2061 6e64  unction_name and
+00016df0: 2063 6f6d 706f 6e65 6e74 2e66 756e 6374   component.funct
+00016e00: 696f 6e5f 6e61 6d65 2069 6e20 6967 6e6f  ion_name in igno
+00016e10: 7265 5f66 756e 6374 696f 6e73 5f70 7265  re_functions_pre
+00016e20: 6669 783a 0a20 2020 2020 2020 2072 6574  fix:.        ret
+00016e30: 7572 6e20 7b7d 0a0a 2020 2020 6966 2068  urn {}..    if h
+00016e40: 6173 6174 7472 2863 6f6d 706f 6e65 6e74  asattr(component
+00016e50: 2c20 226e 616d 6522 2920 616e 6420 616e  , "name") and an
+00016e60: 7928 0a20 2020 2020 2020 2063 6f6d 706f  y(.        compo
+00016e70: 6e65 6e74 2e6e 616d 652e 7374 6172 7473  nent.name.starts
+00016e80: 7769 7468 2869 2920 666f 7220 6920 696e  with(i) for i in
+00016e90: 2069 676e 6f72 655f 636f 6d70 6f6e 656e   ignore_componen
+00016ea0: 7473 5f70 7265 6669 780a 2020 2020 293a  ts_prefix.    ):
+00016eb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00016ec0: 7b7d 0a0a 2020 2020 6f75 7470 7574 203d  {}..    output =
+00016ed0: 207b 636f 6d70 6f6e 656e 742e 6e61 6d65   {component.name
+00016ee0: 3a20 6469 6374 2863 6f6d 706f 6e65 6e74  : dict(component
+00016ef0: 2e73 6574 7469 6e67 7329 7d0a 2020 2020  .settings)}.    
+00016f00: 666f 7220 7265 6665 7265 6e63 6520 696e  for reference in
+00016f10: 2063 6f6d 706f 6e65 6e74 2e72 6566 6572   component.refer
+00016f20: 656e 6365 733a 0a20 2020 2020 2020 2069  ences:.        i
+00016f30: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+00016f40: 6973 696e 7374 616e 6365 2872 6566 6572  isinstance(refer
+00016f50: 656e 6365 2c20 436f 6d70 6f6e 656e 7452  ence, ComponentR
+00016f60: 6566 6572 656e 6365 290a 2020 2020 2020  eference).      
+00016f70: 2020 2020 2020 616e 6420 7265 6665 7265        and refere
+00016f80: 6e63 652e 7265 665f 6365 6c6c 2e6e 616d  nce.ref_cell.nam
+00016f90: 6520 6e6f 7420 696e 206f 7574 7075 740a  e not in output.
+00016fa0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+00016fb0: 2020 2020 2020 206f 7574 7075 742e 7570         output.up
+00016fc0: 6461 7465 2872 6563 7572 7365 5f73 7472  date(recurse_str
+00016fd0: 7563 7475 7265 7328 7265 6665 7265 6e63  uctures(referenc
+00016fe0: 652e 7265 665f 6365 6c6c 2929 0a0a 2020  e.ref_cell))..  
+00016ff0: 2020 7265 7475 726e 206f 7574 7075 740a    return output.
+00017000: 0a0a 6465 6620 6765 745f 6261 7365 5f63  ..def get_base_c
+00017010: 6f6d 706f 6e65 6e74 7328 0a20 2020 2063  omponents(.    c
+00017020: 6f6d 706f 6e65 6e74 3a20 6766 2e43 6f6d  omponent: gf.Com
+00017030: 706f 6e65 6e74 2c20 616c 6c6f 775f 656d  ponent, allow_em
+00017040: 7074 793a 2062 6f6f 6c20 3d20 5472 7565  pty: bool = True
+00017050: 0a29 202d 3e20 4974 6572 6174 6f72 5b67  .) -> Iterator[g
+00017060: 662e 436f 6d70 6f6e 656e 745d 3a0a 2020  f.Component]:.  
+00017070: 2020 2222 2247 656e 6572 6174 6f72 2066    """Generator f
+00017080: 756e 6374 696f 6e20 7468 6174 2079 6965  unction that yie
+00017090: 6c64 7320 6261 7365 2063 6f6d 706f 6e65  lds base compone
+000170a0: 6e74 7320 6f66 2061 2067 6976 656e 2063  nts of a given c
+000170b0: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2050  omponent...    P
+000170c0: 6172 616d 6574 6572 733a 0a20 2020 2020  arameters:.     
+000170d0: 2020 2063 6f6d 706f 6e65 6e74 2028 6766     component (gf
+000170e0: 2e43 6f6d 706f 6e65 6e74 293a 2054 6865  .Component): The
+000170f0: 2063 6f6d 706f 6e65 6e74 2077 686f 7365   component whose
+00017100: 2062 6173 6520 636f 6d70 6f6e 656e 7473   base components
+00017110: 2061 7265 2074 6f20 6265 2066 6f75 6e64   are to be found
+00017120: 2e0a 2020 2020 2020 2020 616c 6c6f 775f  ..        allow_
+00017130: 656d 7074 7920 2862 6f6f 6c29 3a20 4966  empty (bool): If
+00017140: 2054 7275 652c 2061 6c6c 6f77 7320 7969   True, allows yi
+00017150: 656c 6469 6e67 206f 6620 636f 6d70 6f6e  elding of compon
+00017160: 656e 7473 2077 6974 686f 7574 2070 6f6c  ents without pol
+00017170: 7967 6f6e 732e 0a0a 2020 2020 5969 656c  ygons...    Yiel
+00017180: 6473 3a0a 2020 2020 2020 2020 6766 2e43  ds:.        gf.C
+00017190: 6f6d 706f 6e65 6e74 3a20 5468 6520 6261  omponent: The ba
+000171a0: 7365 2063 6f6d 706f 6e65 6e74 7320 6f66  se components of
+000171b0: 2074 6865 2067 6976 656e 2063 6f6d 706f   the given compo
+000171c0: 6e65 6e74 2e0a 2020 2020 2222 220a 2020  nent..    """.  
+000171d0: 2020 6966 206e 6f74 2063 6f6d 706f 6e65    if not compone
+000171e0: 6e74 2e72 6566 6572 656e 6365 7320 616e  nt.references an
+000171f0: 6420 2863 6f6d 706f 6e65 6e74 2e70 6f6c  d (component.pol
+00017200: 7967 6f6e 7320 6f72 2061 6c6c 6f77 5f65  ygons or allow_e
+00017210: 6d70 7479 293a 0a20 2020 2020 2020 2079  mpty):.        y
+00017220: 6965 6c64 2063 6f6d 706f 6e65 6e74 0a20  ield component. 
+00017230: 2020 2066 6f72 2072 6566 2069 6e20 636f     for ref in co
+00017240: 6d70 6f6e 656e 742e 7265 6665 7265 6e63  mponent.referenc
+00017250: 6573 3a0a 2020 2020 2020 2020 7969 656c  es:.        yiel
+00017260: 6420 6672 6f6d 2067 6574 5f62 6173 655f  d from get_base_
+00017270: 636f 6d70 6f6e 656e 7473 2872 6566 2e70  components(ref.p
+00017280: 6172 656e 742c 2061 6c6c 6f77 5f65 6d70  arent, allow_emp
+00017290: 7479 290a 0a0a 6465 6620 666c 6174 7465  ty)...def flatte
+000172a0: 6e5f 696e 7661 6c69 645f 7265 6673 5f72  n_invalid_refs_r
+000172b0: 6563 7572 7369 7665 280a 2020 2020 636f  ecursive(.    co
+000172c0: 6d70 6f6e 656e 743a 2043 6f6d 706f 6e65  mponent: Compone
+000172d0: 6e74 2c0a 2020 2020 6772 6964 5f73 697a  nt,.    grid_siz
+000172e0: 653a 2066 6c6f 6174 207c 204e 6f6e 6520  e: float | None 
+000172f0: 3d20 4e6f 6e65 2c0a 2020 2020 7570 6461  = None,.    upda
+00017300: 7465 645f 636f 6d70 6f6e 656e 7473 3d4e  ted_components=N
+00017310: 6f6e 652c 0a20 2020 2074 7261 7665 7273  one,.    travers
+00017320: 6564 5f63 6f6d 706f 6e65 6e74 733d 4e6f  ed_components=No
+00017330: 6e65 2c0a 2920 2d3e 2043 6f6d 706f 6e65  ne,.) -> Compone
+00017340: 6e74 3a0a 2020 2020 2222 2252 6563 7572  nt:.    """Recur
+00017350: 7369 7665 6c79 2066 6c61 7474 656e 7320  sively flattens 
+00017360: 636f 6d70 6f6e 656e 7420 7265 6665 7265  component refere
+00017370: 6e63 6573 2077 6869 6368 2068 6176 6520  nces which have 
+00017380: 696e 7661 6c69 6420 7472 616e 7366 6f72  invalid transfor
+00017390: 6d61 7469 6f6e 730a 2020 2020 2869 2e65  mations.    (i.e
+000173a0: 2e20 6e6f 6e2d 3930 2064 6567 2072 6f74  . non-90 deg rot
+000173b0: 6174 696f 6e73 206f 7220 7375 622d 6772  ations or sub-gr
+000173c0: 6964 2074 7261 6e73 6c61 7469 6f6e 7329  id translations)
+000173d0: 0a20 2020 2072 6574 7572 6e73 2061 2063  .    returns a c
+000173e0: 6f70 7920 6966 2061 6e79 2073 7562 6365  opy if any subce
+000173f0: 6c6c 7320 6861 7665 2062 6565 6e20 6d6f  lls have been mo
+00017400: 6469 6669 6564 2e0a 0a20 2020 2057 4152  dified...    WAR
+00017410: 4e49 4e47 3a20 7468 6973 2066 756e 6374  NING: this funct
+00017420: 696f 6e20 7769 6c6c 2070 726f 6475 6365  ion will produce
+00017430: 2073 616d 652d 6e61 6d65 2063 6f70 6965   same-name copie
+00017440: 7320 6f66 2063 656c 6c73 2e0a 2020 2020  s of cells..    
+00017450: 4974 2069 7320 7374 7269 6374 6c79 206d  It is strictly m
+00017460: 6561 6e74 2074 6f20 6265 2075 7365 6420  eant to be used 
+00017470: 6f6e 2077 7269 7465 206f 6620 7468 6520  on write of the 
+00017480: 4744 5320 6669 6c65 2061 6e64 0a20 2020  GDS file and.   
+00017490: 2073 686f 756c 6420 6e6f 7420 6265 206d   should not be m
+000174a0: 6978 6564 2077 6974 6820 6f74 6865 7220  ixed with other 
+000174b0: 6365 6c6c 732c 0a20 2020 206f 7220 796f  cells,.    or yo
+000174c0: 7520 7769 6c6c 206c 696b 656c 7920 6578  u will likely ex
+000174d0: 7065 7269 656e 6365 2069 7373 7565 7320  perience issues 
+000174e0: 7769 7468 2064 7570 6c69 6361 7465 2063  with duplicate c
+000174f0: 656c 6c73 0a0a 2020 2020 4172 6773 3a0a  ells..    Args:.
+00017500: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+00017510: 743a 2074 6865 2063 6f6d 706f 6e65 6e74  t: the component
+00017520: 2074 6f20 6669 7820 2869 6e20 706c 6163   to fix (in plac
+00017530: 6529 2e0a 2020 2020 2020 2020 6772 6964  e)..        grid
+00017540: 5f73 697a 653a 2074 6865 2047 4453 2067  _size: the GDS g
+00017550: 7269 6420 7369 7a65 2c20 696e 2075 6d2c  rid size, in um,
+00017560: 2064 6566 6175 6c74 7320 746f 2061 6374   defaults to act
+00017570: 6976 6520 5044 4b2e 6765 745f 6772 6964  ive PDK.get_grid
+00017580: 5f73 697a 6528 290a 2020 2020 2020 2020  _size().        
+00017590: 2020 2020 616e 7920 7472 616e 736c 6174      any translat
+000175a0: 696f 6e73 2077 6974 6820 6869 6768 6572  ions with higher
+000175b0: 2072 6573 6f6c 7574 696f 6e20 7468 616e   resolution than
+000175c0: 2074 6869 7320 6172 6520 636f 6e73 6964   this are consid
+000175d0: 6572 6564 2069 6e76 616c 6964 2e0a 2020  ered invalid..  
+000175e0: 2020 2020 2020 7570 6461 7465 645f 636f        updated_co
+000175f0: 6d70 6f6e 656e 7473 3a20 6469 6374 206f  mponents: dict o
+00017600: 6620 636f 6d70 6f6e 656e 7473 2074 7261  f components tra
+00017610: 6e73 666f 726d 6564 2e0a 2020 2020 2020  nsformed..      
+00017620: 2020 2020 2020 5368 6f75 6c64 2061 6c77        Should alw
+00017630: 6179 7320 6265 204e 6f6e 652c 2065 7863  ays be None, exc
+00017640: 6570 7420 666f 7220 7265 6375 7273 6976  ept for recursiv
+00017650: 652e 0a20 2020 2020 2020 2074 7261 7665  e..        trave
+00017660: 7273 6564 5f63 6f6d 706f 6e65 6e74 733a  rsed_components:
+00017670: 2074 6865 2073 6574 206f 6620 636f 6d70   the set of comp
+00017680: 6f6e 656e 7420 6e61 6d65 7320 7768 6963  onent names whic
+00017690: 6820 6861 7665 2062 6565 6e20 7472 6176  h have been trav
+000176a0: 6572 7365 642e 0a20 2020 2020 2020 2020  ersed..         
+000176b0: 2020 2053 686f 756c 6420 616c 7761 7973     Should always
+000176c0: 2062 6520 4e6f 6e65 2c20 6578 6365 7074   be None, except
+000176d0: 2066 6f72 2072 6563 7572 7369 7665 2069   for recursive i
+000176e0: 6e76 6f63 6174 696f 6e73 2e0a 2020 2020  nvocations..    
+000176f0: 2222 220a 2020 2020 6672 6f6d 2067 6473  """.    from gds
+00017700: 6661 6374 6f72 792e 6465 636f 7261 746f  factory.decorato
+00017710: 7273 2069 6d70 6f72 7420 6973 5f69 6e76  rs import is_inv
+00017720: 616c 6964 5f72 6566 0a0a 2020 2020 696e  alid_ref..    in
+00017730: 7661 6c69 645f 7265 6673 203d 205b 5d0a  valid_refs = [].
+00017740: 2020 2020 7265 6673 203d 2063 6f6d 706f      refs = compo
+00017750: 6e65 6e74 2e72 6566 6572 656e 6365 730a  nent.references.
+00017760: 2020 2020 7375 6263 656c 6c5f 6d6f 6469      subcell_modi
+00017770: 6669 6564 203d 2046 616c 7365 0a20 2020  fied = False.   
+00017780: 2075 7064 6174 6564 5f63 6f6d 706f 6e65   updated_compone
+00017790: 6e74 7320 3d20 7570 6461 7465 645f 636f  nts = updated_co
+000177a0: 6d70 6f6e 656e 7473 206f 7220 7b7d 0a20  mponents or {}. 
+000177b0: 2020 2074 7261 7665 7273 6564 5f63 6f6d     traversed_com
+000177c0: 706f 6e65 6e74 7320 3d20 7472 6176 6572  ponents = traver
+000177d0: 7365 645f 636f 6d70 6f6e 656e 7473 206f  sed_components o
+000177e0: 7220 7365 7428 290a 0a20 2020 2066 6f72  r set()..    for
+000177f0: 2072 6566 2069 6e20 7265 6673 3a0a 2020   ref in refs:.  
+00017800: 2020 2020 2020 2320 6d61 726b 2061 6e79        # mark any
+00017810: 2069 6e76 616c 6964 2072 6566 7320 666f   invalid refs fo
+00017820: 7220 666c 6174 7465 6e69 6e67 0a20 2020  r flattening.   
+00017830: 2020 2020 2023 206f 7468 6572 7769 7365       # otherwise
+00017840: 2c20 6368 6563 6b20 6966 2074 6865 7265  , check if there
+00017850: 2061 7265 2061 6e79 206d 6f64 6966 6965   are any modifie
+00017860: 6420 6365 6c6c 7320 6265 6e65 6174 6820  d cells beneath 
+00017870: 2877 6520 6e65 6564 206e 6f74 2064 6f20  (we need not do 
+00017880: 7468 6973 2069 6620 7468 6520 7265 6620  this if the ref 
+00017890: 7769 6c6c 2062 6520 666c 6174 7465 6e65  will be flattene
+000178a0: 6420 616e 7977 6179 7329 0a20 2020 2020  d anyways).     
+000178b0: 2020 2069 6620 6973 5f69 6e76 616c 6964     if is_invalid
+000178c0: 5f72 6566 2872 6566 2c20 6772 6964 5f73  _ref(ref, grid_s
+000178d0: 697a 6529 3a0a 2020 2020 2020 2020 2020  ize):.          
+000178e0: 2020 696e 7661 6c69 645f 7265 6673 2e61    invalid_refs.a
+000178f0: 7070 656e 6428 7265 662e 6e61 6d65 290a  ppend(ref.name).
+00017900: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00017910: 2020 2020 2020 2020 2020 2320 6f74 6865            # othe
+00017920: 7277 6973 652c 2072 6563 7572 7369 7665  rwise, recursive
+00017930: 6c79 2066 6c61 7474 656e 2072 6566 7320  ly flatten refs 
+00017940: 6966 2074 6865 2073 7562 6365 6c6c 2068  if the subcell h
+00017950: 6173 206e 6f74 2061 6c72 6561 6479 2062  as not already b
+00017960: 6565 6e20 7472 6176 6572 7365 640a 2020  een traversed.  
+00017970: 2020 2020 2020 2020 2020 6966 2072 6566            if ref
+00017980: 2e70 6172 656e 742e 6e61 6d65 206e 6f74  .parent.name not
+00017990: 2069 6e20 7472 6176 6572 7365 645f 636f   in traversed_co
+000179a0: 6d70 6f6e 656e 7473 3a0a 2020 2020 2020  mponents:.      
+000179b0: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
+000179c0: 6e5f 696e 7661 6c69 645f 7265 6673 5f72  n_invalid_refs_r
+000179d0: 6563 7572 7369 7665 280a 2020 2020 2020  ecursive(.      
+000179e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000179f0: 662e 7061 7265 6e74 2c0a 2020 2020 2020  f.parent,.      
+00017a00: 2020 2020 2020 2020 2020 2020 2020 6772                gr
+00017a10: 6964 5f73 697a 653d 6772 6964 5f73 697a  id_size=grid_siz
+00017a20: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00017a30: 2020 2020 2020 2075 7064 6174 6564 5f63         updated_c
+00017a40: 6f6d 706f 6e65 6e74 733d 7570 6461 7465  omponents=update
+00017a50: 645f 636f 6d70 6f6e 656e 7473 2c0a 2020  d_components,.  
+00017a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a70: 2020 7472 6176 6572 7365 645f 636f 6d70    traversed_comp
+00017a80: 6f6e 656e 7473 3d74 7261 7665 7273 6564  onents=traversed
+00017a90: 5f63 6f6d 706f 6e65 6e74 732c 0a20 2020  _components,.   
+00017aa0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00017ab0: 2020 2020 2020 2020 2020 2023 206e 6f77             # now
+00017ac0: 2c20 6966 2074 6865 2072 6566 2773 2063  , if the ref's c
+00017ad0: 656c 6c20 6265 656e 206d 6f64 6966 6965  ell been modifie
+00017ae0: 642c 206d 6172 6b20 6974 2061 7320 7375  d, mark it as su
+00017af0: 6368 0a20 2020 2020 2020 2020 2020 2069  ch.            i
+00017b00: 6620 7265 662e 7061 7265 6e74 2e6e 616d  f ref.parent.nam
+00017b10: 6520 696e 2075 7064 6174 6564 5f63 6f6d  e in updated_com
+00017b20: 706f 6e65 6e74 733a 0a20 2020 2020 2020  ponents:.       
+00017b30: 2020 2020 2020 2020 2073 7562 6365 6c6c           subcell
+00017b40: 5f6d 6f64 6966 6965 6420 3d20 5472 7565  _modified = True
+00017b50: 0a20 2020 2069 6620 696e 7661 6c69 645f  .    if invalid_
+00017b60: 7265 6673 206f 7220 7375 6263 656c 6c5f  refs or subcell_
+00017b70: 6d6f 6469 6669 6564 3a0a 2020 2020 2020  modified:.      
+00017b80: 2020 2320 6966 2074 6865 2063 656c 6c20    # if the cell 
+00017b90: 6f72 2073 7562 6365 6c6c 7320 6e65 6564  or subcells need
+00017ba0: 2074 6f20 6861 7665 2072 6566 6572 656e   to have referen
+00017bb0: 6365 7320 666c 6174 7465 6e65 642c 2063  ces flattened, c
+00017bc0: 7265 6174 6520 616e 2075 6e63 6163 6865  reate an uncache
+00017bd0: 6420 636f 7079 206f 6620 7468 6973 2063  d copy of this c
+00017be0: 656c 6c20 666f 7220 6578 706f 7274 0a20  ell for export. 
+00017bf0: 2020 2020 2020 206e 6577 5f63 6f6d 706f         new_compo
+00017c00: 6e65 6e74 203d 2063 6f6d 706f 6e65 6e74  nent = component
+00017c10: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+00017c20: 6e65 775f 636f 6d70 6f6e 656e 742e 7265  new_component.re
+00017c30: 6e61 6d65 2863 6f6d 706f 6e65 6e74 2e6e  name(component.n
+00017c40: 616d 652c 2063 6163 6865 3d46 616c 7365  ame, cache=False
+00017c50: 290a 0a20 2020 2020 2020 2023 206d 616b  )..        # mak
+00017c60: 6520 7375 7265 2061 6c6c 206d 6f64 6966  e sure all modif
+00017c70: 6965 6420 6365 6c6c 7320 6861 7665 2074  ied cells have t
+00017c80: 6865 6972 2072 6566 6572 656e 6365 7320  heir references 
+00017c90: 7570 6461 7465 640a 2020 2020 2020 2020  updated.        
+00017ca0: 6e65 775f 7265 6673 203d 206e 6577 5f63  new_refs = new_c
+00017cb0: 6f6d 706f 6e65 6e74 2e72 6566 6572 656e  omponent.referen
+00017cc0: 6365 732e 636f 7079 2829 0a20 2020 2020  ces.copy().     
+00017cd0: 2020 2066 6f72 2072 6566 2069 6e20 6e65     for ref in ne
+00017ce0: 775f 7265 6673 3a0a 2020 2020 2020 2020  w_refs:.        
+00017cf0: 2020 2020 6966 2072 6566 2e6e 616d 6520      if ref.name 
+00017d00: 696e 2069 6e76 616c 6964 5f72 6566 733a  in invalid_refs:
+00017d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017d20: 206e 6577 5f63 6f6d 706f 6e65 6e74 2e66   new_component.f
+00017d30: 6c61 7474 656e 5f72 6566 6572 656e 6365  latten_reference
+00017d40: 2872 6566 290a 2020 2020 2020 2020 2020  (ref).          
+00017d50: 2020 656c 6966 2028 0a20 2020 2020 2020    elif (.       
+00017d60: 2020 2020 2020 2020 2072 6566 2e70 6172           ref.par
+00017d70: 656e 742e 6e61 6d65 2069 6e20 7570 6461  ent.name in upda
+00017d80: 7465 645f 636f 6d70 6f6e 656e 7473 0a20  ted_components. 
+00017d90: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00017da0: 6e64 2072 6566 2e70 6172 656e 7420 6973  nd ref.parent is
+00017db0: 206e 6f74 2075 7064 6174 6564 5f63 6f6d   not updated_com
+00017dc0: 706f 6e65 6e74 735b 7265 662e 7061 7265  ponents[ref.pare
+00017dd0: 6e74 2e6e 616d 655d 0a20 2020 2020 2020  nt.name].       
+00017de0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00017df0: 2020 2020 2020 2020 7265 662e 7061 7265          ref.pare
+00017e00: 6e74 203d 2075 7064 6174 6564 5f63 6f6d  nt = updated_com
+00017e10: 706f 6e65 6e74 735b 7265 662e 7061 7265  ponents[ref.pare
+00017e20: 6e74 2e6e 616d 655d 0a20 2020 2020 2020  nt.name].       
+00017e30: 2063 6f6d 706f 6e65 6e74 203d 206e 6577   component = new
+00017e40: 5f63 6f6d 706f 6e65 6e74 0a20 2020 2020  _component.     
+00017e50: 2020 2075 7064 6174 6564 5f63 6f6d 706f     updated_compo
+00017e60: 6e65 6e74 735b 636f 6d70 6f6e 656e 742e  nents[component.
+00017e70: 6e61 6d65 5d20 3d20 6e65 775f 636f 6d70  name] = new_comp
+00017e80: 6f6e 656e 740a 2020 2020 7472 6176 6572  onent.    traver
+00017e90: 7365 645f 636f 6d70 6f6e 656e 7473 2e61  sed_components.a
+00017ea0: 6464 2863 6f6d 706f 6e65 6e74 2e6e 616d  dd(component.nam
+00017eb0: 6529 0a20 2020 2072 6574 7572 6e20 636f  e).    return co
+00017ec0: 6d70 6f6e 656e 740a 0a0a 6465 6620 5f63  mponent...def _c
+00017ed0: 6865 636b 5f75 6e63 6163 6865 645f 636f  heck_uncached_co
+00017ee0: 6d70 6f6e 656e 7473 2863 6f6d 706f 6e65  mponents(compone
+00017ef0: 6e74 2c20 6d6f 6465 293a 0a20 2020 2076  nt, mode):.    v
+00017f00: 616c 6964 5f6d 6f64 6573 203d 205b 2277  alid_modes = ["w
+00017f10: 6172 6e22 2c20 2265 7272 6f72 222c 2022  arn", "error", "
+00017f20: 6967 6e6f 7265 225d 0a0a 2020 2020 6966  ignore"]..    if
+00017f30: 206d 6f64 6520 3d3d 2022 6967 6e6f 7265   mode == "ignore
+00017f40: 223a 0a20 2020 2020 2020 2072 6574 7572  ":.        retur
+00017f50: 6e0a 2020 2020 656c 6966 206d 6f64 6520  n.    elif mode 
+00017f60: 6e6f 7420 696e 2076 616c 6964 5f6d 6f64  not in valid_mod
+00017f70: 6573 3a0a 2020 2020 2020 2020 7261 6973  es:.        rais
+00017f80: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00017f90: 2020 2020 2020 2020 2020 6622 7b6d 6f64            f"{mod
+00017fa0: 657d 2069 7320 6e6f 7420 6120 7661 6c69  e} is not a vali
+00017fb0: 6420 7661 6c75 6520 666f 7220 6f6e 5f75  d value for on_u
+00017fc0: 6e63 6163 6865 645f 636f 6d70 6f6e 656e  ncached_componen
+00017fd0: 742e 2054 7279 206f 6e65 206f 6620 7468  t. Try one of th
+00017fe0: 6573 653a 207b 7661 6c69 645f 6d6f 6465  ese: {valid_mode
+00017ff0: 737d 2e22 0a20 2020 2020 2020 2029 0a0a  s}.".        )..
+00018000: 2020 2020 666f 7220 7375 625f 636f 6d70      for sub_comp
+00018010: 6f6e 656e 7420 696e 2063 6f6d 706f 6e65  onent in compone
+00018020: 6e74 2e67 6574 5f64 6570 656e 6465 6e63  nt.get_dependenc
+00018030: 6965 7328 7265 6375 7273 6976 653d 5472  ies(recursive=Tr
+00018040: 7565 293a 0a20 2020 2020 2020 2069 6620  ue):.        if 
+00018050: 6e6f 7420 7375 625f 636f 6d70 6f6e 656e  not sub_componen
+00018060: 742e 5f6c 6f63 6b65 643a 0a20 2020 2020  t._locked:.     
+00018070: 2020 2020 2020 206d 6573 7361 6765 203d         message =
+00018080: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00018090: 2020 2066 2243 6f6d 706f 6e65 6e74 207b     f"Component {
+000180a0: 7375 625f 636f 6d70 6f6e 656e 742e 6e61  sub_component.na
+000180b0: 6d65 2172 7d20 7761 7320 4e4f 5420 7072  me!r} was NOT pr
+000180c0: 6f70 6572 6c79 206c 6f63 6b65 642e 2022  operly locked. "
+000180d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000180e0: 2022 596f 7520 6e65 6564 2074 6f20 7772   "You need to wr
+000180f0: 6974 6520 6974 2069 6e74 6f20 6120 6675  ite it into a fu
+00018100: 6e63 7469 6f6e 2074 6861 7420 6861 7320  nction that has 
+00018110: 7468 6520 4063 656c 6c20 6465 636f 7261  the @cell decora
+00018120: 746f 722e 220a 2020 2020 2020 2020 2020  tor.".          
+00018130: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00018140: 6966 206d 6f64 6520 3d3d 2022 7761 726e  if mode == "warn
+00018150: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00018160: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
+00018170: 286d 6573 7361 6765 2c20 556e 6361 6368  (message, Uncach
+00018180: 6564 436f 6d70 6f6e 656e 7457 6172 6e69  edComponentWarni
+00018190: 6e67 2c20 7374 6163 6b6c 6576 656c 3d33  ng, stacklevel=3
+000181a0: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+000181b0: 6c69 6620 6d6f 6465 203d 3d20 2265 7272  lif mode == "err
+000181c0: 6f72 223a 0a20 2020 2020 2020 2020 2020  or":.           
+000181d0: 2020 2020 2072 6169 7365 2055 6e63 6163       raise Uncac
+000181e0: 6865 6443 6f6d 706f 6e65 6e74 4572 726f  hedComponentErro
+000181f0: 7228 6d65 7373 6167 6529 0a0a 0a69 6620  r(message)...if 
+00018200: 5f5f 6e61 6d65 5f5f 203d 3d20 225f 5f6d  __name__ == "__m
+00018210: 6169 6e5f 5f22 3a0a 2020 2020 2320 6672  ain__":.    # fr
+00018220: 6f6d 2066 756e 6374 6f6f 6c73 2069 6d70  om functools imp
+00018230: 6f72 7420 7061 7274 6961 6c0a 2020 2020  ort partial.    
+00018240: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
+00018250: 7920 6173 2067 660a 0a20 2020 2063 203d  y as gf..    c =
+00018260: 2043 6f6d 706f 6e65 6e74 2829 0a0a 2020   Component()..  
+00018270: 2020 2320 6320 3d20 6766 2e63 6f6d 706f    # c = gf.compo
+00018280: 6e65 6e74 732e 7374 7261 6967 6874 2829  nents.straight()
+00018290: 0a20 2020 2023 2063 203d 2067 662e 726f  .    # c = gf.ro
+000182a0: 7574 696e 672e 6164 645f 6669 6265 725f  uting.add_fiber_
+000182b0: 7369 6e67 6c65 2863 290a 2020 2020 2320  single(c).    # 
+000182c0: 6320 3d20 6766 2e63 6f6d 706f 6e65 6e74  c = gf.component
+000182d0: 732e 6d7a 6928 696e 666f 3d64 6963 7428  s.mzi(info=dict(
+000182e0: 6869 3d33 2929 0a20 2020 2023 2070 7269  hi=3)).    # pri
+000182f0: 6e74 2874 7970 6528 632e 696e 666f 2929  nt(type(c.info))
+00018300: 0a20 2020 2023 2079 616d 6c5f 6e65 746c  .    # yaml_netl
+00018310: 6973 7420 3d20 632e 746f 5f79 616d 6c28  ist = c.to_yaml(
+00018320: 290a 2020 2020 2320 6332 203d 2067 662e  ).    # c2 = gf.
+00018330: 7265 6164 2e66 726f 6d5f 7961 6d6c 2879  read.from_yaml(y
+00018340: 616d 6c5f 6e65 746c 6973 7429 0a20 2020  aml_netlist).   
+00018350: 2023 2063 322e 7368 6f77 2829 0a0a 2020   # c2.show()..  
+00018360: 2020 2320 6320 3d20 6766 2e43 6f6d 706f    # c = gf.Compo
+00018370: 6e65 6e74 2829 0a20 2020 2023 2077 6731  nent().    # wg1
+00018380: 203d 2063 203c 3c20 6766 2e63 6f6d 706f   = c << gf.compo
+00018390: 6e65 6e74 732e 7374 7261 6967 6874 2877  nents.straight(w
+000183a0: 6964 7468 3d30 2e35 2c20 6c61 7965 723d  idth=0.5, layer=
+000183b0: 2831 2c20 3029 290a 2020 2020 2320 7767  (1, 0)).    # wg
+000183c0: 3220 3d20 6320 3c3c 2067 662e 636f 6d70  2 = c << gf.comp
+000183d0: 6f6e 656e 7473 2e73 7472 6169 6768 7428  onents.straight(
+000183e0: 7769 6474 683d 302e 352c 206c 6179 6572  width=0.5, layer
+000183f0: 3d28 322c 2030 2929 0a20 2020 2023 2077  =(2, 0)).    # w
+00018400: 6732 2e63 6f6e 6e65 6374 2822 6f31 222c  g2.connect("o1",
+00018410: 2077 6731 2e70 6f72 7473 5b22 6f32 225d   wg1.ports["o2"]
+00018420: 290a 2020 2020 2320 6375 7374 6f6d 5f70  ).    # custom_p
+00018430: 6164 6469 6e67 203d 2070 6172 7469 616c  adding = partial
+00018440: 2867 662e 6164 645f 7061 6464 696e 672c  (gf.add_padding,
+00018450: 206c 6179 6572 733d 2822 5747 222c 2929   layers=("WG",))
+00018460: 0a20 2020 2023 2063 203d 2067 662e 632e  .    # c = gf.c.
+00018470: 6d7a 6928 6465 636f 7261 746f 723d 6375  mzi(decorator=cu
+00018480: 7374 6f6d 5f70 6164 6469 6e67 290a 0a20  stom_padding).. 
+00018490: 2020 2023 2063 203d 2063 2e63 6f70 7928     # c = c.copy(
+000184a0: 290a 2020 2020 2320 6320 3d20 632e 7265  ).    # c = c.re
+000184b0: 6d61 705f 6c61 7965 7273 287b 2831 2c20  map_layers({(1, 
+000184c0: 3029 3a20 2833 2c20 3029 7d29 0a0a 2020  0): (3, 0)})..  
+000184d0: 2020 2320 632e 5f63 656c 6c2e 7265 6d61    # c._cell.rema
+000184e0: 7028 7b28 312c 2030 293a 2028 332c 2030  p({(1, 0): (3, 0
+000184f0: 297d 290a 2020 2020 2320 6c69 6220 3d20  )}).    # lib = 
+00018500: 6764 7374 6b2e 4c69 6272 6172 7928 290a  gdstk.Library().
+00018510: 2020 2020 2320 6c69 622e 6164 6428 632e      # lib.add(c.
+00018520: 5f63 656c 6c29 0a20 2020 2023 206c 6962  _cell).    # lib
+00018530: 2e72 656d 6170 287b 2831 2c20 3029 3a20  .remap({(1, 0): 
+00018540: 2832 2c20 3029 7d29 0a20 2020 2023 2063  (2, 0)}).    # c
+00018550: 3220 3d20 6c69 625b 632e 6e61 6d65 5d0a  2 = lib[c.name].
+00018560: 2020 2020 2320 632e 5f63 656c 6c20 3d20      # c._cell = 
+00018570: 6332 0a20 2020 2023 2063 2e73 686f 7728  c2.    # c.show(
+00018580: 290a 0a20 2020 2023 2067 662e 636f 6e66  )..    # gf.conf
+00018590: 6967 2e65 6e61 626c 655f 6f66 665f 6772  ig.enable_off_gr
+000185a0: 6964 5f70 6f72 7473 2829 0a0a 2020 2020  id_ports()..    
+000185b0: 2320 6320 3d20 6766 2e43 6f6d 706f 6e65  # c = gf.Compone
+000185c0: 6e74 2822 6265 6e64 2229 0a20 2020 2023  nt("bend").    #
+000185d0: 2062 203d 2063 203c 3c20 6766 2e63 6f6d   b = c << gf.com
+000185e0: 706f 6e65 6e74 732e 6265 6e64 5f63 6972  ponents.bend_cir
+000185f0: 6375 6c61 7228 616e 676c 653d 3330 290a  cular(angle=30).
+00018600: 2020 2020 2320 7320 3d20 6320 3c3c 2067      # s = c << g
+00018610: 662e 636f 6d70 6f6e 656e 7473 2e73 7472  f.components.str
+00018620: 6169 6768 7428 6c65 6e67 7468 3d35 290a  aight(length=5).
+00018630: 2020 2020 2320 732e 636f 6e6e 6563 7428      # s.connect(
+00018640: 226f 3122 2c20 622e 706f 7274 735b 226f  "o1", b.ports["o
+00018650: 3222 5d29 0a20 2020 2023 2070 5f73 6861  2"]).    # p_sha
+00018660: 7065 6c79 203d 2063 2e67 6574 5f70 6f6c  pely = c.get_pol
+00018670: 7967 6f6e 7328 6173 5f73 6861 7065 6c79  ygons(as_shapely
+00018680: 5f6d 6572 6765 643d 5472 7565 290a 2020  _merged=True).  
+00018690: 2020 2320 6332 203d 2067 662e 436f 6d70    # c2 = gf.Comp
+000186a0: 6f6e 656e 7428 2262 656e 645f 6669 7865  onent("bend_fixe
+000186b0: 6422 290a 2020 2020 2320 6332 2e61 6464  d").    # c2.add
+000186c0: 5f70 6f6c 7967 6f6e 2870 5f73 6861 7065  _polygon(p_shape
+000186d0: 6c79 2c20 6c61 7965 723d 2831 2c20 3029  ly, layer=(1, 0)
+000186e0: 290a 2020 2020 2320 6332 2e70 6c6f 7428  ).    # c2.plot(
+000186f0: 290a 0a20 2020 2023 2063 203d 2067 662e  )..    # c = gf.
+00018700: 632e 6d7a 6928 666c 6174 7465 6e3d 5472  c.mzi(flatten=Tr
+00018710: 7565 2c20 6465 636f 7261 746f 723d 6766  ue, decorator=gf
+00018720: 2e72 6f75 7469 6e67 2e61 6464 5f66 6962  .routing.add_fib
+00018730: 6572 5f73 696e 676c 6529 0a20 2020 2023  er_single).    #
+00018740: 2023 2070 7269 6e74 2863 2e6e 616d 6529   # print(c.name)
+00018750: 0a20 2020 2023 2063 2e73 686f 7728 290a  .    # c.show().
+00018760: 0a20 2020 2023 2063 203d 2067 662e 632e  .    # c = gf.c.
+00018770: 6d7a 6928 290a 2020 2020 2320 6669 6720  mzi().    # fig 
+00018780: 3d20 632e 706c 6f74 5f6b 6c61 796f 7574  = c.plot_klayout
+00018790: 2829 0a20 2020 2023 2066 6967 2e73 6176  ().    # fig.sav
+000187a0: 6566 6967 2822 6d7a 692e 706e 6722 290a  efig("mzi.png").
+000187b0: 2020 2020 2320 632e 7070 7269 6e74 5f70      # c.pprint_p
+000187c0: 6f72 7473 2829 0a0a 2020 2020 2320 6320  orts()..    # c 
+000187d0: 3d20 6766 2e43 6f6d 706f 6e65 6e74 2822  = gf.Component("
+000187e0: 6869 2220 2a20 3230 3029 0a20 2020 2023  hi" * 200).    #
+000187f0: 2070 7269 6e74 2863 2e6e 616d 6529 0a0a   print(c.name)..
+00018800: 2020 2020 2320 6320 3d20 6766 2e43 6f6d      # c = gf.Com
+00018810: 706f 6e65 6e74 2822 6869 2220 2a20 3230  ponent("hi" * 20
+00018820: 3029 0a20 2020 2023 2070 7269 6e74 2863  0).    # print(c
+00018830: 2e6e 616d 6529 0a20 2020 2023 2070 203d  .name).    # p =
+00018840: 2063 2e61 6464 5f70 6f6c 7967 6f6e 280a   c.add_polygon(.
+00018850: 2020 2020 2320 2020 2020 5b28 2d38 2c20      #     [(-8, 
+00018860: 362c 2037 2c20 3929 2c20 282d 362c 2038  6, 7, 9), (-6, 8
+00018870: 2c20 3137 2c20 3529 5d2c 206c 6179 6572  , 17, 5)], layer
+00018880: 3d28 312c 2030 290a 2020 2020 2320 2920  =(1, 0).    # ) 
+00018890: 2023 2047 4453 206c 6179 6572 7320 6172   # GDS layers ar
+000188a0: 6520 7475 706c 6573 206f 6620 696e 7473  e tuples of ints
+000188b0: 2028 6275 7420 6966 2077 6520 7573 6520   (but if we use 
+000188c0: 6f6e 6c79 206f 6e65 206e 756d 6265 7220  only one number 
+000188d0: 6974 2061 7373 756d 6573 2074 6865 206f  it assumes the o
+000188e0: 7468 6572 206e 756d 6265 7220 6973 2030  ther number is 0
+000188f0: 290a 2020 2020 2320 632e 7772 6974 655f  ).    # c.write_
+00018900: 6764 7328 2268 692e 6764 7322 290a 2020  gds("hi.gds").  
+00018910: 2020 2320 632e 7368 6f77 2829 0a20 2020    # c.show().   
+00018920: 2023 2070 7269 6e74 2843 4f4e 462e 6c61   # print(CONF.la
+00018930: 7374 5f73 6176 6564 5f66 696c 6573 290a  st_saved_files).
```

### Comparing `gdsfactory-7.9.3/gdsfactory/component_layout.py` & `gdsfactory-7.9.4/gdsfactory/component_layout.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,31 +1,108 @@
 """Helper functions for layout.
 
 Adapted from PHIDL https://github.com/amccaugh/phidl/ by Adam McCaughan
 """
 from __future__ import annotations
 
 import numbers
-import typing
 from collections import defaultdict
+from collections.abc import Iterable, Sequence
+from typing import TYPE_CHECKING, Any
 
 import numpy as np
 from gdstk import Label as _Label
 from gdstk import Polygon
 from numpy import cos, pi, sin
 from numpy.linalg import norm
+from pydantic import BaseModel, model_validator
 from rich.console import Console
 from rich.table import Table
 
+from gdsfactory.serialization import clean_value_json
 from gdsfactory.snap import snap_to_grid
 
-if typing.TYPE_CHECKING:
+if TYPE_CHECKING:
     from gdsfactory.port import Port
 
 
+class CellSettings(BaseModel, extra="allow", validate_assignment=True, frozen=True):
+    @model_validator(mode="before")
+    def restrict_types(cls, data: dict[str, Any]) -> dict[str, int | float | str]:
+        for name, value in data.items():
+            data[name] = clean_value_json(value)
+        return data
+
+    def __getitem__(self, key: str) -> Any:
+        return getattr(self, key)
+
+    def get(self, __key: str, default: Any = None) -> Any:
+        return getattr(self, __key) if hasattr(self, __key) else default
+
+
+class ComponentSpec(BaseModel, extra="allow", validate_assignment=True, frozen=True):
+    """ComponentSpec is a dataclass that stores the settings used to create a component."""
+
+    settings: CellSettings = CellSettings()
+    function: str
+    module: str
+
+    @model_validator(mode="before")
+    def restrict_types(cls, data: dict[str, Any]) -> dict[str, int | float | str]:
+        for name, value in data.items():
+            data[name] = clean_value_json(value)
+        return data
+
+    def __getitem__(self, key: str) -> Any:
+        return getattr(self, key)
+
+    def get(self, __key: str, default: Any = None) -> Any:
+        return getattr(self, __key) if hasattr(self, __key) else default
+
+
+class Info(BaseModel, extra="allow", validate_assignment=True):
+    @model_validator(mode="before")
+    def restrict_types(
+        cls, data: dict[str, int | float | Sequence | str]
+    ) -> dict[str, int | float | Sequence | str]:
+        for name, value in data.items():
+            if not isinstance(value, str | int | float | Sequence):
+                raise ValueError(
+                    "Values of the info dict only support int, float, string or tuple."
+                    f"{name}: {value}, {type(value)}"
+                )
+
+        return data
+
+    def __getitem__(self, __key: str) -> Any:
+        return getattr(self, __key)
+
+    def __setitem__(
+        self, __key: str, __val: str | int | float | Sequence | None
+    ) -> None:
+        if __val is not None:
+            setattr(self, __key, __val)
+
+    def get(self, __key: str, default: Any | None = None) -> Any:
+        return getattr(self, __key) if hasattr(self, __key) else default
+
+    def update(self, data: Info | dict | Iterable[tuple[str, Any]]) -> None:
+        if isinstance(data, dict):
+            for key, value in data.items():
+                self.__setitem__(key, value)
+        elif isinstance(data, Info):
+            for key, value in data.model_dump().items():
+                self.__setitem__(key, value)
+        elif isinstance(data, Iterable):
+            for key, value in data:
+                self.__setitem__(key, value)
+        else:
+            raise TypeError("Unsupported data type for update")
+
+
 def pprint_ports(ports: dict[str, Port] or list[Port]) -> None:
     """Prints ports in a rich table."""
     console = Console()
     table = Table(show_header=True, header_style="bold")
     ports_list = ports if isinstance(ports, list) else list(ports.values())
     if not ports_list:
         return
@@ -776,8 +853,9 @@
     c = gf.Component("bend")
     b = c << gf.components.bend_circular(angle=30)
     s = c << gf.components.straight(length=5)
     s.connect("o1", b.ports["o2"])
     p = c.get_polygons(as_shapely_merged=True)
     c2 = gf.Component()
     c2.add_polygon(p, layer=(1, 0))
+    c2.info["a"] = None
     c2.show()
```

### Comparing `gdsfactory-7.9.3/gdsfactory/component_reference.py` & `gdsfactory-7.9.4/gdsfactory/component_reference.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/C.py` & `gdsfactory-7.9.4/gdsfactory/components/C.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/L.py` & `gdsfactory-7.9.4/gdsfactory/components/L.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/__init__.py` & `gdsfactory-7.9.4/gdsfactory/components/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/add_fiber_array_optical_south_electrical_north.py` & `gdsfactory-7.9.4/gdsfactory/components/add_fiber_array_optical_south_electrical_north.py`

 * *Files 1% similar despite different names*

```diff
@@ -124,22 +124,22 @@
         cross_section=xs_metal,
         enforce_port_ordering=False,
     )
     for route in routes:
         c.add(route.references)
 
     c.add_ports(ports2)
-    c.copy_child_info(r)
+    c.copy_child_info(component)
     return c
 
 
 if __name__ == "__main__":
-    c = add_fiber_array_optical_south_electrical_north(
-        info=dict(measurement_settings={"wavelength_min": 1550}), name="my_mzi"
-    )
+    # c = add_fiber_array_optical_south_electrical_north(
+    #     info=dict(wavelength_min=1550), name="my_mzi"
+    # )
 
     # d = json.loads(c.labels[0].text)
     # print(d)
     # import gdsfactory as gf
     # from functools import partial
 
     # component = partial(mzi_phase_shifter, length_y=1)
@@ -150,9 +150,10 @@
     # )
     # component = partial(gf.c.ring_single_heater, length_x=10)
     # c = add_fiber_array_optical_south_electrical_north(
     #     component=component,
     #     electrical_port_names=["l_e2", "r_e2"],
     #     npads=5,
     # )
-    print(c.name)
+    # print(c.name)
+    c = add_fiber_array_optical_south_electrical_north()
     c.show(show_ports=False)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/add_fiducials.py` & `gdsfactory-7.9.4/gdsfactory/components/add_fiducials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/add_grating_couplers.py` & `gdsfactory-7.9.4/gdsfactory/components/add_grating_couplers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/add_trenches.py` & `gdsfactory-7.9.4/gdsfactory/components/add_trenches.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/align.py` & `gdsfactory-7.9.4/gdsfactory/components/align.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/array_component.py` & `gdsfactory-7.9.4/gdsfactory/components/array_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/array_with_fanout.py` & `gdsfactory-7.9.4/gdsfactory/components/array_with_fanout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/array_with_via.py` & `gdsfactory-7.9.4/gdsfactory/components/array_with_via.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/awg.py` & `gdsfactory-7.9.4/gdsfactory/components/awg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/bbox.py` & `gdsfactory-7.9.4/gdsfactory/components/bbox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/bend_circular.py` & `gdsfactory-7.9.4/gdsfactory/components/bend_circular.py`

 * *Files 14% similar despite different names*

```diff
@@ -37,18 +37,21 @@
                   o2
                   |
                  /
                 /
                /
        o1_____/
     """
-    x = gf.get_cross_section(cross_section)
+    kwargs = dict()
+    if layer:
+        kwargs["layer"] = layer
+    if width:
+        kwargs["width"] = width
+    x = gf.get_cross_section(cross_section, **kwargs)
     radius = radius or x.radius
-    if layer or width:
-        x = x.copy(layer=layer or x.layer, width=width or x.width)
 
     p = arc(radius=radius, angle=angle, npoints=npoints)
     c = Component()
     path = p.extrude(x)
     ref = c << path
     c.add_ports(ref.ports)
     c.absorb(ref)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/bend_circular_heater.py` & `gdsfactory-7.9.4/gdsfactory/components/bend_circular_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/bend_euler.py` & `gdsfactory-7.9.4/gdsfactory/components/bend_euler.py`

 * *Files 2% similar despite different names*

```diff
@@ -58,23 +58,25 @@
                   o2
                   |
                  /
                 /
                /
        o1_____/
     """
-    x = gf.get_cross_section(cross_section)
+    kwargs = dict()
+    if layer:
+        kwargs["layer"] = layer
+    if width:
+        kwargs["width"] = width
+    x = gf.get_cross_section(cross_section, **kwargs)
     radius = radius or x.radius
 
     if radius is None:
         return wire_corner(cross_section=x)
 
-    if layer or width:
-        x = x.copy(layer=layer or x.layer, width=width or x.width)
-
     c = Component()
     p = euler(
         radius=radius, angle=angle, p=p, use_eff=with_arc_floorplan, npoints=npoints
     )
     ref = c << p.extrude(x)
     c.add_ports(ref.ports)
     c.info["length"] = np.round(p.length(), 3)
@@ -206,15 +208,14 @@
     p2 = gf.path.euler(angle=180)
     x = gf.cross_section.strip()
 
     c1 = gf.path.extrude(p1, x)
     c1.name = "two_90_euler"
     c2 = gf.path.extrude(p2, x)
     c2.name = "one_180_euler"
-    c1.add_ref(c2)
     c1.show()
 
 
 def _compare_bend_euler90():
     """Compare bend euler with 90deg circular bend."""
     import gdsfactory as gf
 
@@ -228,9 +229,9 @@
 
     _ = c << b1
     _ = c << b2
     return c
 
 
 if __name__ == "__main__":
-    c = bend_straight_bend(direction="cw")
+    c = bend_euler()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/bend_s.py` & `gdsfactory-7.9.4/gdsfactory/components/bend_s.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/bezier.py` & `gdsfactory-7.9.4/gdsfactory/components/bezier.py`

 * *Files 1% similar despite different names*

```diff
@@ -71,15 +71,15 @@
     curv = curvature(path_points, t)
     length = gf.snap.snap_to_grid(path_length(path_points))
     if max(np.abs(curv)) == 0:
         min_bend_radius = np.inf
     else:
         min_bend_radius = gf.snap.snap_to_grid(1 / max(np.abs(curv)))
 
-    c.info["length"] = length
+    c.info["length"] = float(length)
     c.info["min_bend_radius"] = min_bend_radius
     c.info["start_angle"] = path.start_angle
     c.info["end_angle"] = path.end_angle
 
     xs.validate_radius(min_bend_radius, bend_radius_error_type)
 
     if with_bbox:
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cavity.py` & `gdsfactory-7.9.4/gdsfactory/components/cavity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cdc.py` & `gdsfactory-7.9.4/gdsfactory/components/cdc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cdsem_all.py` & `gdsfactory-7.9.4/gdsfactory/components/cdsem_all.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cdsem_bend180.py` & `gdsfactory-7.9.4/gdsfactory/components/cdsem_bend180.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cdsem_coupler.py` & `gdsfactory-7.9.4/gdsfactory/components/cdsem_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cdsem_straight.py` & `gdsfactory-7.9.4/gdsfactory/components/cdsem_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cdsem_straight_density.py` & `gdsfactory-7.9.4/gdsfactory/components/cdsem_straight_density.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/circle.py` & `gdsfactory-7.9.4/gdsfactory/components/circle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coh_rx_dual_pol.py` & `gdsfactory-7.9.4/gdsfactory/components/coh_rx_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coh_rx_single_pol.py` & `gdsfactory-7.9.4/gdsfactory/components/coh_rx_single_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coh_tx_dual_pol.py` & `gdsfactory-7.9.4/gdsfactory/components/coh_tx_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coh_tx_single_pol.py` & `gdsfactory-7.9.4/gdsfactory/components/coh_tx_single_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/compass.py` & `gdsfactory-7.9.4/gdsfactory/components/compass.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/component_lattice.py` & `gdsfactory-7.9.4/gdsfactory/components/component_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/component_lattice_generic.py` & `gdsfactory-7.9.4/gdsfactory/components/component_lattice_generic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/component_sequence.py` & `gdsfactory-7.9.4/gdsfactory/components/component_sequence.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/copy_layers.py` & `gdsfactory-7.9.4/gdsfactory/components/copy_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler90.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler90.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler90bend.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler90bend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler_adiabatic.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler_adiabatic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler_asymmetric.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler_asymmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler_bent.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler_bent.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler_broadband.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler_broadband.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler_full.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler_full.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler_ring.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler_straight.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler_straight_asymmetric.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler_straight_asymmetric.py`

 * *Files 14% similar despite different names*

```diff
@@ -20,17 +20,16 @@
         length: of straight.
         gap: between straights.
         width_top: of top straight.
         width_bot: of bottom straight.
     """
     component = Component()
 
-    xs = gf.get_cross_section(cross_section)
-    xs_top = xs.copy(width=width_top)
-    xs_bot = xs.copy(width=width_bot)
+    xs_top = gf.get_cross_section(cross_section, width=width_top)
+    xs_bot = gf.get_cross_section(cross_section, width=width_bot)
 
     top = component << straight(length=length, cross_section=xs_top)
     bot = component << straight(length=length, cross_section=xs_bot)
 
     dy = 0.5 * abs(width_top - width_bot) + gap + width_top
     dy = gf.snap.snap_to_grid(dy)
     top.movey(dy)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/coupler_symmetric.py` & `gdsfactory-7.9.4/gdsfactory/components/coupler_symmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cross.py` & `gdsfactory-7.9.4/gdsfactory/components/cross.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/crossing_waveguide.py` & `gdsfactory-7.9.4/gdsfactory/components/crossing_waveguide.py`

 * *Files 1% similar despite different names*

```diff
@@ -424,15 +424,14 @@
     c.add(sbend_left)
     c.add(sbend_right)
 
     c.add_port("o1", port=sbend_left.ports["o1"])
     c.add_port("o2", port=sbend_right.ports["o1"])
 
     c.info["min_bend_radius"] = sbend.info["min_bend_radius"]
-    c.info["sbend"] = sbend.info
 
     x.add_bbox(c)
     x.add_pins(c)
     return c
 
 
 def _demo() -> None:
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv` & `gdsfactory-7.9.4/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv` & `gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv` & `gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv` & `gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv` & `gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv` & `gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv` & `gdsfactory-7.9.4/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cutback_2x2.py` & `gdsfactory-7.9.4/gdsfactory/components/cutback_2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cutback_bend.py` & `gdsfactory-7.9.4/gdsfactory/components/cutback_bend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cutback_component.py` & `gdsfactory-7.9.4/gdsfactory/components/cutback_component.py`

 * *Files 2% similar despite different names*

```diff
@@ -8,15 +8,15 @@
 from gdsfactory.components.component_sequence import component_sequence
 from gdsfactory.components.straight import straight
 from gdsfactory.components.taper import taper
 from gdsfactory.components.taper_from_csv import taper_from_csv
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
-@gf.cell_with_child
+@gf.cell
 def cutback_component(
     component: ComponentSpec = taper_from_csv,
     cols: int = 4,
     rows: int = 5,
     port1: str = "o1",
     port2: str = "o2",
     bend180: ComponentSpec = bend_euler180,
@@ -94,15 +94,14 @@
     seq = component_sequence(sequence=s, symbol_to_component=symbol_to_component)
 
     c = gf.Component()
     ref = c << seq
     c.add_ports(ref.ports)
 
     n = s.count("A") + s.count("B")
-    c.copy_child_info(component)
     c.info["components"] = n
     return c
 
 
 # straight_wide = partial(straight, width=3, length=20)
 # bend180_wide = partial(bend_euler180, width=3)
 component_flipped = partial(taper, width2=0.5, width1=3)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cutback_loss.py` & `gdsfactory-7.9.4/gdsfactory/components/cutback_loss.py`

 * *Files 0% similar despite different names*

```diff
@@ -119,10 +119,10 @@
     #     )
     # )[0]
     # components = cutback_loss(
     #     component=gf.c.mmi2x2, decorator=gf.routing.add_fiber_array
     # )
     # components = cutback_loss_mmi1x2(decorator=gf.routing.add_fiber_array)
     components = cutback_loss_bend180()
-    # c = gf.pack(components)[0]
-    c = components[0]
+    c = gf.pack(components)[0]
+    # c = components[0]
     c.show()
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/cutback_splitter.py` & `gdsfactory-7.9.4/gdsfactory/components/cutback_splitter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/dbr.py` & `gdsfactory-7.9.4/gdsfactory/components/dbr.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/dbr_tapered.py` & `gdsfactory-7.9.4/gdsfactory/components/dbr_tapered.py`

 * *Files 6% similar despite different names*

```diff
@@ -93,31 +93,25 @@
           w1       w2       ...  n times
         _______
                |_________
     """
     c = gf.Component()
 
     xs = gf.get_cross_section(cross_section=cross_section, width=w2, **kwargs)
+    xs1 = gf.get_cross_section(cross_section=cross_section, width=xs.width, **kwargs)
+    xs2 = gf.get_cross_section(cross_section=cross_section, width=w1, **kwargs)
 
     input_taper = c << gf.components.taper(
-        length=taper_length,
-        width1=xs.width,
-        width2=w1,
-        cross_section=xs.copy(width=xs.width),
+        length=taper_length, width1=xs.width, width2=w1, cross_section=xs1
     )
 
-    straight = c << gf.components.straight(
-        length=length, cross_section=xs.copy(width=w1)
-    )
+    straight = c << gf.components.straight(length=length, cross_section=xs2)
 
     output_taper = c << gf.components.taper(
-        length=taper_length,
-        width1=w1,
-        width2=xs.width,
-        cross_section=xs.copy(width=xs.width),
+        length=taper_length, width1=w1, width2=xs.width, cross_section=xs1
     )
 
     input_taper.connect("o2", straight.ports["o1"])
 
     output_taper.connect("o1", straight.ports["o2"])
 
     num = (2 * taper_length + length) // period
@@ -146,9 +140,9 @@
     c.add_port("o2", port=output_taper.ports["o2"])
 
     return c
 
 
 if __name__ == "__main__":
     # c = dbr_tapered(length=10, period=0.85, dc=0.5, w2=1, w1=0.4, taper_length=20, fins=True)
-    c = dbr_tapered()
+    c = dbr_tapered(cross_section=gf.cross_section.rib)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/delay_snake.py` & `gdsfactory-7.9.4/gdsfactory/components/delay_snake.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/delay_snake2.py` & `gdsfactory-7.9.4/gdsfactory/components/delay_snake2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/delay_snake3.py` & `gdsfactory-7.9.4/gdsfactory/components/delay_snake3.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/delay_snake_sbend.py` & `gdsfactory-7.9.4/gdsfactory/components/delay_snake_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/dicing_lane.py` & `gdsfactory-7.9.4/gdsfactory/components/dicing_lane.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/die.py` & `gdsfactory-7.9.4/gdsfactory/components/die.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/die_bbox.py` & `gdsfactory-7.9.4/gdsfactory/components/die_bbox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/die_bbox_frame.py` & `gdsfactory-7.9.4/gdsfactory/components/die_bbox_frame.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/disk.py` & `gdsfactory-7.9.4/gdsfactory/components/disk.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/edge_coupler_array.py` & `gdsfactory-7.9.4/gdsfactory/components/edge_coupler_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ellipse.py` & `gdsfactory-7.9.4/gdsfactory/components/ellipse.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/extend_ports_list.py` & `gdsfactory-7.9.4/gdsfactory/components/extend_ports_list.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/extension.py` & `gdsfactory-7.9.4/gdsfactory/components/extension.py`

 * *Files 0% similar despite different names*

```diff
@@ -221,13 +221,14 @@
     return result
 
 
 __all__ = ["extend_ports", "extend_port"]
 
 
 if __name__ == "__main__":
-    test_extend_ports()
+    # test_extend_ports()
     c0 = gf.c.straight()
     # p0 = c0["o1"]
     # c = extend_port(p0, length=100)
     c = extend_ports(c0, length=100)
+    print(c.name)
     c.show()
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/fiber.py` & `gdsfactory-7.9.4/gdsfactory/components/fiber.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/fiber_array.py` & `gdsfactory-7.9.4/gdsfactory/components/fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/fiducial_squares.py` & `gdsfactory-7.9.4/gdsfactory/components/fiducial_squares.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/fonts/OCR-A.ttf` & `gdsfactory-7.9.4/gdsfactory/components/fonts/OCR-A.ttf`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ge_detector_straight_si_contacts.py` & `gdsfactory-7.9.4/gdsfactory/components/ge_detector_straight_si_contacts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_array.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_dual_pol.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_elliptical.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_elliptical.py`

 * *Files 10% similar despite different names*

```diff
@@ -68,14 +68,25 @@
     b: float,
     x0: float,
     taper_length: float,
     taper_angle: float,
     wg_width: float,
     angle_step: float = 1.0,
 ) -> ndarray:
+    """Returns an elliptical taper.
+
+    Args:
+        a: ellipse semi-major axis.
+        b: semi-minor axis.
+        x0: in um.
+        taper_length: in um.
+        taper_angle: in degrees.
+        wg_width: in um.
+        angle_step: in degrees.
+    """
     taper_arc = ellipse_arc(
         a=a,
         b=b,
         x0=taper_length,
         theta_min=-taper_angle / 2,
         theta_max=taper_angle / 2,
         angle_step=angle_step,
@@ -173,14 +184,25 @@
         x0=x_output,
         taper_length=x_taper,
         taper_angle=taper_angle,
         wg_width=wg_width,
     )
     c.add_polygon(pts, layer)
 
+    for section in xs.sections[1:]:
+        pts = grating_taper_points(
+            a=a_taper,
+            b=b_taper,
+            x0=x_output,
+            taper_length=x_taper,
+            taper_angle=taper_angle,
+            wg_width=section.width,
+        )
+        c.add_polygon(pts, section.layer)
+
     width = gf.snap.snap_to_grid(grating_line_width)
     gap = gf.snap.snap_to_grid(period - grating_line_width)
 
     xi = taper_length
     for p in range(n_periods):
         xi += gap + width / 2
         p = xi / period
@@ -227,17 +249,17 @@
                 (slab_length, -slab_width),
                 (slab_xmin, -slab_width),
             ],
             layer_slab,
         )
 
     if xs.add_bbox:
-        c = xs.add_bbox(c)
+        xs.add_bbox(c)
     if xs.add_pins:
-        c = xs.add_pins(c)
+        xs.add_pins(c)
 
     name = f"opt_{polarization.lower()}_{int(wavelength*1e3)}_{int(fiber_angle)}"
     c.add_port(
         name=name,
         center=(x, 0),
         width=10,
         orientation=0,
@@ -269,9 +291,9 @@
     # print(c.wavelength)
     # print(c.ports)
     # c.pprint()
     # c = gf.c.extend_ports(c)
     # c = gf.routing.add_fiber_array(grating_coupler=grating_coupler_elliptical, with_loopback=False)
 
     # c = gf.components.grating_coupler_elliptical_te()
-    c = gf.components.grating_coupler_elliptical_tm()
+    c = gf.components.grating_coupler_elliptical_tm(cross_section="xs_rc")
     c.show(show_ports=True)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_elliptical_arbitrary.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_elliptical_arbitrary.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_elliptical_lumerical.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_elliptical_lumerical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_elliptical_trenches.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_elliptical_trenches.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_functions.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_loss.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_loss.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_loss_fiber_single.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_loss_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_rectangular.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_rectangular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_rectangular_arbitrary.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_rectangular_arbitrary.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/grating_coupler_tree.py` & `gdsfactory-7.9.4/gdsfactory/components/grating_coupler_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/greek_cross.py` & `gdsfactory-7.9.4/gdsfactory/components/greek_cross.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/hline.py` & `gdsfactory-7.9.4/gdsfactory/components/hline.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/interdigital_capacitor.py` & `gdsfactory-7.9.4/gdsfactory/components/interdigital_capacitor.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/interdigital_capacitor_enclosed.py` & `gdsfactory-7.9.4/gdsfactory/components/interdigital_capacitor_enclosed.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/litho_calipers.py` & `gdsfactory-7.9.4/gdsfactory/components/litho_calipers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/litho_ruler.py` & `gdsfactory-7.9.4/gdsfactory/components/litho_ruler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/litho_steps.py` & `gdsfactory-7.9.4/gdsfactory/components/litho_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/logo.py` & `gdsfactory-7.9.4/gdsfactory/components/logo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/loop_mirror.py` & `gdsfactory-7.9.4/gdsfactory/components/loop_mirror.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mmi.py` & `gdsfactory-7.9.4/gdsfactory/components/mmi.py`

 * *Files 2% similar despite different names*

```diff
@@ -62,15 +62,15 @@
     """
     c = Component()
     gap_input_tapers = gf.snap.snap_to_grid(gap_input_tapers, grid_factor=2)
     gap_output_tapers = gf.snap.snap_to_grid(gap_output_tapers, grid_factor=2)
     w_mmi = width_mmi
     w_taper = width_taper
     x = gf.get_cross_section(cross_section)
-    xs_mmi = x.copy(width=w_mmi)
+    xs_mmi = gf.get_cross_section(cross_section, width=w_mmi)
     width = width or x.width
 
     _taper = taper(
         length=length_taper,
         width1=width,
         width2=w_taper,
         cross_section=cross_section,
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mmi1x2.py` & `gdsfactory-7.9.4/gdsfactory/components/mmi1x2.py`

 * *Files 5% similar despite different names*

```diff
@@ -56,15 +56,15 @@
              <->
         length_taper
 
     """
     c = Component()
     gap_mmi = gf.snap.snap_to_grid(gap_mmi, grid_factor=2)
     x = gf.get_cross_section(cross_section, **kwargs)
-    xs_mmi = x.copy(width=width_mmi)
+    xs_mmi = gf.get_cross_section(cross_section, width=width_mmi)
     width = width or x.width
 
     _taper = taper(
         length=length_taper,
         width1=width,
         width2=width_taper,
         cross_section=x,
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mmi1x2_with_sbend.py` & `gdsfactory-7.9.4/gdsfactory/components/mmi1x2_with_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mmi2x2.py` & `gdsfactory-7.9.4/gdsfactory/components/mmi2x2.py`

 * *Files 2% similar despite different names*

```diff
@@ -57,15 +57,15 @@
             length_taper
 
     """
     c = gf.Component()
     gap_mmi = gf.snap.snap_to_grid(gap_mmi, grid_factor=2)
     w_taper = width_taper
     x = gf.get_cross_section(cross_section, **kwargs)
-    xs_mmi = x.copy(width=width_mmi)
+    xs_mmi = gf.get_cross_section(cross_section, width=width_mmi)
     width = width or x.width
 
     _taper = taper(
         length=length_taper,
         width1=width,
         width2=w_taper,
         cross_section=x,
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mmi2x2_with_sbend.py` & `gdsfactory-7.9.4/gdsfactory/components/mmi2x2_with_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mmi_90degree_hybrid.py` & `gdsfactory-7.9.4/gdsfactory/components/mmi_90degree_hybrid.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mode_converter.py` & `gdsfactory-7.9.4/gdsfactory/components/mode_converter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mzi.py` & `gdsfactory-7.9.4/gdsfactory/components/mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mzi_arm.py` & `gdsfactory-7.9.4/gdsfactory/components/mzi_arm.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mzi_arms.py` & `gdsfactory-7.9.4/gdsfactory/components/mzi_arms.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mzi_lattice.py` & `gdsfactory-7.9.4/gdsfactory/components/mzi_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mzi_pads_center.py` & `gdsfactory-7.9.4/gdsfactory/components/mzi_pads_center.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mzit.py` & `gdsfactory-7.9.4/gdsfactory/components/mzit.py`

 * *Files 5% similar despite different names*

```diff
@@ -73,16 +73,16 @@
                            cp2
 
 
     """
     c = gf.Component()
 
     xs = gf.get_cross_section(cross_section)
-    xs1 = xs.copy(width=w1)
-    xs2 = xs.copy(width=w2)
+    xs1 = gf.get_cross_section(cross_section, width=w1)
+    xs2 = gf.get_cross_section(cross_section, width=w2)
 
     cp2 = c << coupler2(
         length=coupler_length2,
         gap=coupler_gap2,
         dy=dy,
         cross_section=cross_section,
     )
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mzit_lattice.py` & `gdsfactory-7.9.4/gdsfactory/components/mzit_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/mzm.py` & `gdsfactory-7.9.4/gdsfactory/components/mzm.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/nxn.py` & `gdsfactory-7.9.4/gdsfactory/components/nxn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/optimal_90deg.py` & `gdsfactory-7.9.4/gdsfactory/components/optimal_90deg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/optimal_hairpin.py` & `gdsfactory-7.9.4/gdsfactory/components/optimal_hairpin.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/optimal_step.py` & `gdsfactory-7.9.4/gdsfactory/components/optimal_step.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/pack_doe.py` & `gdsfactory-7.9.4/gdsfactory/components/pack_doe.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/pad.py` & `gdsfactory-7.9.4/gdsfactory/components/pad.py`

 * *Files 6% similar despite different names*

```diff
@@ -33,15 +33,17 @@
     layer = gf.get_layer(layer)
     size = gf.get_constant(size)
     rect = compass(
         size=size, layer=layer, port_inclusion=port_inclusion, port_type="electrical"
     )
     c_ref = c.add_ref(rect)
     c.add_ports(c_ref.ports)
-    c.info["size"] = (float(size[0]), float(size[1]))
+    c.info["size"] = size
+    c.info["xsize"] = size[0]
+    c.info["ysize"] = size[1]
     c.info["layer"] = layer
     c.absorb(c_ref)
 
     if bbox_layers and bbox_offsets:
         sizes = []
         for cladding_offset in bbox_offsets:
             size = (size[0] + 2 * cladding_offset, size[1] + 2 * cladding_offset)
@@ -88,19 +90,21 @@
         spacing: x, y pitch.
         columns: number of columns.
         rows: number of rows.
         orientation: port orientation in deg. None for low speed DC ports.
     """
     c = Component()
     pad = gf.get_component(pad)
-    size = pad.settings.full["size"]
-    c.info["size"] = size
+    xsize = pad.info["xsize"]
+    ysize = pad.info["ysize"]
+    c.info["xsize"] = xsize
+    c.info["ysize"] = ysize
 
     c.add_array(pad, columns=columns, rows=rows, spacing=spacing)
-    width = size[0] if orientation in [90, 270] else size[1]
+    width = xsize if orientation in [90, 270] else ysize
 
     for col in range(columns):
         for row in range(rows):
             c.add_port(
                 name=f"e{row+1}{col+1}",
                 center=(col * spacing[0], row * spacing[1]),
                 width=width,
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/pad_gsg.py` & `gdsfactory-7.9.4/gdsfactory/components/pad_gsg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/pads_shorted.py` & `gdsfactory-7.9.4/gdsfactory/components/pads_shorted.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/polarization_splitter_rotator.py` & `gdsfactory-7.9.4/gdsfactory/components/polarization_splitter_rotator.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ramp.py` & `gdsfactory-7.9.4/gdsfactory/components/ramp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/rectangle.py` & `gdsfactory-7.9.4/gdsfactory/components/rectangle.py`

 * *Files 1% similar despite different names*

```diff
@@ -64,14 +64,16 @@
         _circle = circle(radius=xsize / 2, layer=layer)
         ct = c << _circle
         cb = c << _circle
         ct.x = ref.x
         cb.x = ref.x
         cb.y = ref.ymin
         ct.y = ref.ymax
+
+    c.info["area"] = xsize * ysize
     return c
 
 
 fiber_size = 10.4
 marker_te = partial(rectangle, size=[fiber_size, fiber_size], layer="TE", centered=True)
 marker_tm = partial(rectangle, size=[fiber_size, fiber_size], layer="TM", centered=True)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/rectangle_with_slits.py` & `gdsfactory-7.9.4/gdsfactory/components/rectangle_with_slits.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/rectangular_ring.py` & `gdsfactory-7.9.4/gdsfactory/components/rectangular_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/regular_polygon.py` & `gdsfactory-7.9.4/gdsfactory/components/regular_polygon.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/resistance_meander.py` & `gdsfactory-7.9.4/gdsfactory/components/resistance_meander.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/resistance_sheet.py` & `gdsfactory-7.9.4/gdsfactory/components/resistance_sheet.py`

 * *Files 3% similar despite different names*

```diff
@@ -35,15 +35,15 @@
         ohms_per_square: optional sheet resistance to compute info.resistance.
         port_orientation1: in degrees.
         port_orientation2: in degrees.
     """
     c = Component()
 
     pad = pad()
-    length = pad_pitch - pad.get_setting("size")[0]
+    length = pad_pitch - pad.info.xsize
 
     pad1 = c << pad
     pad2 = c << pad
     r0 = c << compass(
         size=(length + layer_offsets[0], width + layer_offsets[0]), layer=layers[0]
     )
     c.absorb(r0)
@@ -51,15 +51,15 @@
     for layer, offset in zip(layers[1:], layer_offsets[1:]):
         r = c << compass(size=(length + 2 * offset, width + 2 * offset), layer=layer)
         c.absorb(r)
 
     pad1.connect("e3", r0.ports["e1"])
     pad2.connect("e1", r0.ports["e3"])
 
-    c.info["resistance"] = ohms_per_square * width * length if ohms_per_square else None
+    c.info["resistance"] = ohms_per_square * width * length if ohms_per_square else 0
 
     c.add_port(
         "pad1",
         port_type="vertical_dc",
         center=pad1.center,
         layer=list(layers)[-1],
         width=width,
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring.py` & `gdsfactory-7.9.4/gdsfactory/components/ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_crow.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_crow.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_crow_couplers.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_crow_couplers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_double.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_double_bend_coupler.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_double_bend_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_double_heater.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_double_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_double_pn.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_double_pn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_section_based.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_section_based.py`

 * *Files 3% similar despite different names*

```diff
@@ -218,26 +218,17 @@
 
     # Rotate so that the first section is centered at the add bus
     if start_cross_section is not None:
         ring = ring.rotate(
             -start_angle / 2
         )  # also change the component for later bound extraction
         r.rotate(-start_angle / 2)
-        ring_center = [
-            -radius * np.sin(np.radians(-start_angle / 2)),
-            radius * np.cos(np.radians(-start_angle / 2)),
-        ]
     else:
         ring = ring.rotate(-cross_sections_angles[sequence[0]] / 2)
         r.rotate(-cross_sections_angles[sequence[0]] / 2)
-        ring_center = [
-            -radius * np.sin(np.radians(-cross_sections_angles[sequence[0]] / 2)),
-            radius * np.cos(np.radians(-cross_sections_angles[sequence[0]] / 2)),
-        ]
-    c.info["ring_center"] = gf.snap.snap_to_grid(ring_center)
     c.info["ring_radius"] = radius
 
     # Add bus waveguides
 
     # Figure out main waveguiding layer of the ring at the ring-bus interface
     input_xs_layer = (
         gf.get_cross_section(start_cross_section).layer
@@ -299,9 +290,10 @@
         cross_sections_sequence=["AB", "BA"],
         cross_sections_angles={"A": 17, "B": 17},
         start_cross_section=partial(rib, width=0.65),
         start_angle=10.0,
         drop_cross_section=partial(rib, width=0.55),
         bus_cross_section="xs_sc",
     )
+    c = c.flatten_invalid_refs()
 
     c.show(show_ports=True)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_single.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_single_array.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_single_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_single_bend_coupler.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_single_bend_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_single_dut.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_single_dut.py`

 * *Files 2% similar despite different names*

```diff
@@ -83,14 +83,13 @@
 
     wt.connect(port="o1", destination=bl.ports["o1"])
     br.connect(port="o2", destination=wt.ports["o2"])
     dut.connect(port=port_name, destination=br.ports["o1"])
 
     c.add_port("o2", port=cb.ports["o4"])
     c.add_port("o1", port=cb.ports["o1"])
-    c.info["component"] = component.info
     return c
 
 
 if __name__ == "__main__":
     c = ring_single_dut()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_single_heater.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_single_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/ring_single_pn.py` & `gdsfactory-7.9.4/gdsfactory/components/ring_single_pn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/seal_ring.py` & `gdsfactory-7.9.4/gdsfactory/components/seal_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/snspd.py` & `gdsfactory-7.9.4/gdsfactory/components/snspd.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/spiral_double.py` & `gdsfactory-7.9.4/gdsfactory/components/spiral_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/spiral_external_io.py` & `gdsfactory-7.9.4/gdsfactory/components/spiral_external_io.py`

 * *Files 2% similar despite different names*

```diff
@@ -30,14 +30,15 @@
     yspacing: float = 3.0,
     bend: ComponentSpec = bend_euler,
     length: float | None = None,
     cross_section: CrossSectionSpec = "xs_sc",
     with_inner_ports: bool = False,
     y_straight_outer_offset: float = 0.0,
     inner_loop_spacing_offset: float = 0.0,
+    mirror_straight: bool = False,
     **kwargs,
 ) -> Component:
     """Returns spiral with input and output ports outside the spiral.
 
     Args:
         N: number of loops.
         x_inner_length_cutback: x inner length.
@@ -47,14 +48,15 @@
         yspacing: center to center y-spacing.
         bend: function.
         length: length in um, it is the approximates total length.
         cross_section: spec.
         with_inner_ports: if True, removes the internal S-bend and exposes new ports
         y_straight_outer_offset: amount to add/remove to the last points at the outer output of the spiral
         inner_loop_spacing_offset: extra difference between the inner ports
+        mirror_straight: if True, mirrors the straight cross section in round_corners (can help when xs is asymmetric)
         kwargs: cross_section settings.
     """
     if length:
         x_inner_length_cutback = length / (4 * (N - 1))
 
     y_straight_inner_top += 5
     x_inner_length_cutback += x_inner_offset
@@ -138,20 +140,22 @@
     else:
         pts_w[1][0] += bend_radius
         pts_e[1][0] += bend_radius
         route_west = round_corners(
             pts_w[1:],
             bend=bend,
             cross_section=cross_section,
+            mirror_straight=mirror_straight,
             **kwargs,
         )
         route_east = round_corners(
             pts_e[1:],
             bend=bend,
             cross_section=cross_section,
+            mirror_straight=mirror_straight,
             **kwargs,
         )
         component.add(route_west.references)
         component.add(route_east.references)
         component.add_port("o2", port=route_west.ports[0])
         component.add_port("o1", port=route_east.ports[1])
         component.add_port("o4", port=route_west.ports[1])
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/spiral_heater.py` & `gdsfactory-7.9.4/gdsfactory/components/spiral_heater.py`

 * *Files 1% similar despite different names*

```diff
@@ -183,15 +183,14 @@
         n_bend_points=n_bend_points,
         with_inner_ports=with_inner_ports,
         extra_90_deg_bend=True,
     )
 
     c.info["length"] = spiral.info["length"]
     c.info["straight_length"] = straight_length
-    c.info["spiral_center"] = spiral.center
 
     if spiral.ports["o1"].x > spiral.ports["o2"].x:
         spiral.mirror_x()
 
     # add a bit more to the spiral racetrack to make the in and out ports be aligned in y
     in_wg = c << straight_factory(
         spiral.ports["o1"].x - spiral.xmin, cross_section=cross_section
@@ -312,15 +311,15 @@
 
         c.info["length"] += np.sum([r.info["length"] for r in route.references])
 
         lens.append(c.info["length"])
 
     # get the required spacing to achieve the required length (interpolate)
     f = interp1d(lens, straight_lengths)
-    return f(length)
+    return float(f(length))
 
 
 @gf.cell
 def spiral_racetrack_heater_metal(
     min_radius: float | None = None,
     straight_length: float = 30,
     spacing: float = 2,
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/spiral_inner_io.py` & `gdsfactory-7.9.4/gdsfactory/components/spiral_inner_io.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/splitter_chain.py` & `gdsfactory-7.9.4/gdsfactory/components/splitter_chain.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/splitter_tree.py` & `gdsfactory-7.9.4/gdsfactory/components/splitter_tree.py`

 * *Files 2% similar despite different names*

```diff
@@ -57,15 +57,14 @@
         bend_s_ysize = dy / 4 - dy_coupler_ports / 2
         bend_s_xsize = bend_s_xsize or dx
         bend_s = gf.get_component(
             bend_s,
             cross_section=cross_section,
             size=(bend_s_xsize, bend_s_ysize),
         )
-        c.info["bend_s"] = bend_s.info
     cols = int(np.log2(noutputs))
     i = 0
 
     for col in range(cols):
         ncouplers = int(2**col)
         y0 = -0.5 * dy * 2 ** (cols - 1)
         for row in range(ncouplers):
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/straight.py` & `gdsfactory-7.9.4/gdsfactory/components/straight.py`

 * *Files 11% similar despite different names*

```diff
@@ -32,49 +32,50 @@
     .. code::
 
         o1 -------------- o2
                 length
     """
 
     p = gf.path.straight(length=length, npoints=npoints)
-    x = gf.get_cross_section(cross_section)
-
-    if layer or width:
-        x = x.copy(layer=layer or x.layer, width=width or x.width)
+    kwargs = dict()
+    if layer:
+        kwargs["layer"] = layer
+    if width:
+        kwargs["width"] = width
+    x = gf.get_cross_section(cross_section, **kwargs)
 
     c = Component()
     path = p.extrude(x)
     ref = c << path
     c.add_ports(ref.ports)
 
     if add_bbox:
         add_bbox(c)
     else:
         x.add_bbox(c, right=0, left=0)
     if add_pins:
         x.add_pins(c)
-    c.info["length"] = length
+    c.info["length"] = float(length)
     if len(x.sections) == 0:
         c.info["width"] = x.width
     else:
         c.info["width"] = x.sections[0].width
-    c.info["cross_section"] = cross_section
 
     c.add_route_info(cross_section=x, length=length)
     c.absorb(ref)
     return c
 
 
 if __name__ == "__main__":
     import gdsfactory as gf
 
     # xs = gf.cross_section.pn()
     # xs = xs.mirror()
     # c = straight(cross_section=xs, info=dict(simulation="eme"))
     # print(c.info["simulation"])
-    c = straight(length=0)
+    c = straight(width=3, cross_section=gf.cross_section.rib)
     c.show()
-    print(c.bbox)
+    # print(c.bbox)
     # c._repr_html_()
     # c.show()
-    c.show(show_ports=True)
-    print(c.bbox)
+    # c.show(show_ports=True)
+    # print(c.bbox)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/straight_array.py` & `gdsfactory-7.9.4/gdsfactory/components/straight_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/straight_heater_doped_rib.py` & `gdsfactory-7.9.4/gdsfactory/components/straight_heater_doped_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/straight_heater_doped_strip.py` & `gdsfactory-7.9.4/gdsfactory/components/straight_heater_doped_strip.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/straight_heater_meander.py` & `gdsfactory-7.9.4/gdsfactory/components/straight_heater_meander.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/straight_heater_meander_doped.py` & `gdsfactory-7.9.4/gdsfactory/components/straight_heater_meander_doped.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/straight_heater_metal.py` & `gdsfactory-7.9.4/gdsfactory/components/straight_heater_metal.py`

 * *Files 0% similar despite different names*

```diff
@@ -136,15 +136,15 @@
             )
             taper1 = c << taper
             taper2 = c << taper
             taper1.connect("o1", via_stack_west.ports["e3"])
             taper2.connect("o1", via_stack_east.ports["e1"])
 
     c.info["resistance"] = (
-        ohms_per_square * heater_width * length if ohms_per_square else None
+        ohms_per_square * heater_width * length if ohms_per_square else 0
     )
     return c
 
 
 @cell
 def straight_heater_metal_simple(
     length: float = 320.0,
@@ -222,15 +222,15 @@
             )
             taper1 = c << taper
             taper2 = c << taper
             taper1.connect("e1", via_stack_west.ports["e3"])
             taper2.connect("e1", via_stack_east.ports["e1"])
 
     c.info["resistance"] = (
-        ohms_per_square * heater_width * length if ohms_per_square else None
+        ohms_per_square * heater_width * length if ohms_per_square else 0
     )
     return c
 
 
 straight_heater_metal = partial(
     straight_heater_metal_undercut,
     with_undercut=False,
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/straight_pin.py` & `gdsfactory-7.9.4/gdsfactory/components/straight_pin.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/straight_pin_slot.py` & `gdsfactory-7.9.4/gdsfactory/components/straight_pin_slot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/straight_rib.py` & `gdsfactory-7.9.4/gdsfactory/components/straight_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/switch_tree.py` & `gdsfactory-7.9.4/gdsfactory/components/switch_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/taper.py` & `gdsfactory-7.9.4/gdsfactory/components/taper.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/taper_adiabatic.py` & `gdsfactory-7.9.4/gdsfactory/components/taper_adiabatic.py`

 * *Files 8% similar despite different names*

```diff
@@ -59,14 +59,16 @@
 
     References:
         [1] Burns, W. K., et al. "Optical waveguide parabolic coupling horns." Appl. Phys. Lett., vol. 30, no. 1, 1 Jan. 1977, pp. 28-30, doi:10.1063/1.89199.
         [2] Fu, Yunfei, et al. "Efficient adiabatic silicon-on-insulator waveguide taper." Photonics Res., vol. 2, no. 3, 1 June 2014, pp. A41-A44, doi:10.1364/PRJ.2.000A41.
         npoints: number of points for sampling
     """
     xs = gf.get_cross_section(cross_section)
+    xs1 = gf.get_cross_section(cross_section, width=width1)
+    xs2 = gf.get_cross_section(cross_section, width=width2)
     layer = xs.layer
 
     # Obtain optimal curve
     x_opt, w_opt = transition_adiabatic(
         width1, width2, neff_w=neff_w, wavelength=wavelength, alpha=alpha
     )
 
@@ -84,19 +86,14 @@
     x_array = np.linspace(0, length, npoints) * (1 + length - x_opt[-1])
     y_array = w / 2
 
     c = gf.Component()
     c.add_polygon(
         list(zip(x_array, y_array)) + list(zip(x_array, -y_array))[::-1], layer=layer
     )
-
-    # Define ports
-    xs1 = xs.copy(width=width1)
-    xs2 = xs.copy(width=width2)
-
     c.add_port(
         name="o1",
         center=(0, 0),
         width=width1,
         orientation=180,
         cross_section=xs1,
         layer=layer,
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/taper_cross_section.py` & `gdsfactory-7.9.4/gdsfactory/components/taper_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/taper_from_csv.py` & `gdsfactory-7.9.4/gdsfactory/components/taper_from_csv.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/taper_parabolic.py` & `gdsfactory-7.9.4/gdsfactory/components/taper_parabolic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/terminator.py` & `gdsfactory-7.9.4/gdsfactory/components/terminator.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/text.py` & `gdsfactory-7.9.4/gdsfactory/components/text.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/text_freetype.py` & `gdsfactory-7.9.4/gdsfactory/components/text_freetype.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/text_rectangular.py` & `gdsfactory-7.9.4/gdsfactory/components/text_rectangular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/text_rectangular_font.py` & `gdsfactory-7.9.4/gdsfactory/components/text_rectangular_font.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/triangles.py` & `gdsfactory-7.9.4/gdsfactory/components/triangles.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/verniers.py` & `gdsfactory-7.9.4/gdsfactory/components/verniers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/version_stamp.py` & `gdsfactory-7.9.4/gdsfactory/components/version_stamp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/via.py` & `gdsfactory-7.9.4/gdsfactory/components/via.py`

 * *Files 7% similar despite different names*

```diff
@@ -38,28 +38,30 @@
         |             gap[0]    size[0]         |
         |             <------> <----->          |
         |      ______          ______           |
         |     |      |        |      |          |
         |     |      |        |      |  size[1] |
         |     |______|        |______|          |
         |      <------------->                  |
-        |         spacing[0]                    |
+        |         xspacing                      |
         |_______________________________________|
     """
     if spacing is None and gap is None:
         raise ValueError("either spacing or gap should be defined")
     elif spacing is not None and gap is not None:
         raise ValueError("You can't define spacing and gap at the same time")
     if spacing is None:
         spacing = (size[0] + gap[0], size[1] + gap[1])
 
     c = Component()
-    c.info["spacing"] = spacing
+    c.info["xspacing"], c.info["yspacing"] = spacing
     c.info["enclosure"] = enclosure
-    c.info["size"] = size
+    c.info["xsize"], c.info["ysize"] = size
+    c.info["size"] = tuple(size)
+    c.info["spacing"] = tuple(spacing)
 
     width, height = size
     a = width / 2
     b = height / 2
     c.add_polygon([(-a, -b), (a, -b), (a, b), (-a, b)], layer=layer)
 
     bbox_layers = bbox_layers or []
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/via_corner.py` & `gdsfactory-7.9.4/gdsfactory/components/via_corner.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/via_cutback.py` & `gdsfactory-7.9.4/gdsfactory/components/via_cutback.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/via_stack.py` & `gdsfactory-7.9.4/gdsfactory/components/via_stack.py`

 * *Files 18% similar despite different names*

```diff
@@ -62,16 +62,19 @@
         )
 
     if layers:
         layer_port = layer_port or layers[-1]
 
     c = Component()
     c.height = height_m
-    c.info["size"] = (float(size[0]), float(size[1]))
-    c.info["layer"] = layer_port
+    c.info["size"] = tuple(size)
+    c.info["xsize"] = size[0]
+    c.info["ysize"] = size[1]
+    if layer_port:
+        c.info["layer"] = layer_port
 
     for layer, offset in zip(layers, layer_offsets):
         size_m = (width_m + 2 * offset, height_m + 2 * offset)
         if layer and layer == layer_port:
             ref = c << compass(size=size_m, layer=layer, port_type="electrical")
             c.add_ports(ref.ports)
         elif layer is not None:
@@ -80,17 +83,17 @@
     vias = vias or []
     for via, offset in zip(vias, layer_offsets):
         if via is not None:
             width, height = size
             width += 2 * offset
             height += 2 * offset
             _via = gf.get_component(via)
-            w, h = _via.info["size"]
+            w, h = _via.info["xsize"], _via.info["ysize"]
             enclosure = _via.info["enclosure"]
-            pitch_x, pitch_y = _via.info["spacing"]
+            pitch_x, pitch_y = _via.info["xspacing"], _via.info["yspacing"]
 
             if slot_horizontal:
                 width = size[0] - 2 * enclosure
                 via = gf.get_component(via, size=(width, h))
                 nb_vias_x = 1
                 nb_vias_y = abs(height - h - 2 * enclosure) / pitch_y + 1
 
@@ -142,39 +145,14 @@
             x0 = -a + cw + w / 2
             y0 = -b + ch + h / 2
             ref.move((x0, y0))
 
     return c
 
 
-def _smaller_angle(angle, angle1, angle2):
-    """Returns False if angle is outside the
-     bounds of the arc angle defined between
-     angle 1 and angle2.
-
-    But it does so assuming that angle1 and angle2 are between [-pi, pi]
-    and that we are trying to fill an arc
-    """
-
-    if angle2 >= 0 and angle1 >= 0:
-        if angle2 > angle1:
-            return angle < angle2
-        # Convert angle to 0, 2pi and see if out of bounds
-        angle = angle + 2 * np.pi * (angle < 0)
-        return not (angle2 < angle < angle1)
-
-    elif angle2 < 0 and angle1 < 0:
-        return angle < angle2 if angle2 > angle1 else not (angle2 < angle < angle1)
-    else:
-        if angle2 < 0 and angle > 0 or angle2 >= 0 and angle < 0:
-            return True
-        else:
-            return angle < angle2
-
-
 @gf.cell
 def via_stack_from_rules(
     size: Float2 = (1.2, 1.2),
     layers: LayerSpecs = ("M1", "M2", "MTOP"),
     layer_offsets: tuple[float, ...] | None = None,
     vias: tuple[ComponentSpec | None, ...] | None = (via1, via2),
     via_min_size: tuple[Float2, ...] = ((0.2, 0.2), (0.2, 0.2)),
@@ -205,38 +183,37 @@
     layers = layers or []
 
     if layers:
         layer_port = layer_port or layers[-1]
 
     c = Component()
     c.height = height
-    c.info["size"] = (float(size[0]), float(size[1]))
+    c.info["xsize"] = size[0]
+    c.info["ysize"] = size[1]
     c.info["layer"] = layer_port
 
     layer_offsets = layer_offsets or [0] * len(layers)
 
     for layer, offset in zip(layers, layer_offsets):
         size = (width + 2 * offset, height + 2 * offset)
         if layer and layer == layer_port:
             ref = c << compass(size=size, layer=layer, port_type="electrical")
             c.add_ports(ref.ports)
         elif layer:
             ref = c << compass(size=size, layer=layer, port_type="electrical")
 
     vias = vias or []
-    c.info["vias"] = []
     for current_via, min_size, min_gap, min_enclosure in zip(
         vias, via_min_size, via_min_gap, via_min_enclosure
     ):
         if current_via is not None:
             # Optimize via
             via = gf.get_component(
                 optimized_via(current_via, size, min_size, min_gap, min_enclosure)
             )
-            c.info["vias"].append(via.info)
 
             w, h = via.info["size"]
             g = via.info["enclosure"]
             pitch_x, pitch_y = via.info["spacing"]
 
             nb_vias_x = (width - w - 2 * g) / pitch_x + 1
             nb_vias_y = (height - h - 2 * g) / pitch_y + 1
@@ -290,42 +267,14 @@
         size=via_size,
         gap=min_via_gap,
         spacing=None,
         enclosure=min_via_enclosure,
     )
 
 
-def test_via_stack_from_rules() -> None:
-    # Check that vias are generated with larger than min dimensions if possible
-    size = (1.2, 1.2)
-    layers = ("M1", "M2", "MTOP")
-    vias = (via1, via2)
-    via_min_size = ((0.2, 0.2), (0.2, 0.2))
-    via_min_gap = ((0.1, 0.1), (0.15, 0.15))
-    via_min_enclosure = (0.1, 0.1)
-
-    c = gf.get_component(
-        via_stack_from_rules(
-            size=size,
-            layers=layers,
-            vias=vias,
-            via_min_size=via_min_size,
-            via_min_gap=via_min_gap,
-            via_min_enclosure=via_min_enclosure,
-        )
-    )
-
-    assert c.info["vias"][0]["size"][0] > via_min_size[0][0]
-    assert c.info["vias"][0]["size"][1] > via_min_size[0][1]
-    assert (
-        c.info["vias"][0]["spacing"][0]
-        == via_min_gap[0][0] + c.info["vias"][0]["size"][0]
-    )
-
-
 via_stack_m1_m3 = partial(
     via_stack,
     layers=("M1", "M2", "MTOP"),
     vias=(via1, via2, None),
 )
 
 via_stack_slab_m3 = partial(
@@ -351,11 +300,12 @@
 via_stack_heater_m2 = partial(via_stack, layers=("HEATER", "M2"), vias=(None, via1))
 via_stack_heater_mtop = via_stack_heater_m3 = partial(
     via_stack, layers=("HEATER", "M2", "MTOP"), vias=(None, via1, via2)
 )
 
 
 if __name__ == "__main__":
-    c = via_stack()
+    # c = via_stack()
     # c = gf.pack([via_stack_slab_m3, via_stack_heater_mtop])[0]
     # c = via_stack_slab_m3(size=(100, 10), slot_vertical=True)
+    c = via_stack_from_rules()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/components/via_stack_slot.py` & `gdsfactory-7.9.4/gdsfactory/components/via_stack_slot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/via_stack_with_offset.py` & `gdsfactory-7.9.4/gdsfactory/components/via_stack_with_offset.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/wafer.py` & `gdsfactory-7.9.4/gdsfactory/components/wafer.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/wire.py` & `gdsfactory-7.9.4/gdsfactory/components/wire.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/components/wire_sbend.py` & `gdsfactory-7.9.4/gdsfactory/components/wire_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/config.py` & `gdsfactory-7.9.4/gdsfactory/config.py`

 * *Files 3% similar despite different names*

```diff
@@ -5,46 +5,51 @@
 
 from __future__ import annotations
 
 import importlib
 import json
 import os
 import pathlib
+import re
 import subprocess
 import sys
 import tempfile
 import traceback
 from enum import Enum, auto
 from itertools import takewhile
 from pathlib import Path
 from pprint import pprint
-from typing import Any, Literal
+from typing import TYPE_CHECKING, Any, ClassVar, Literal
 
 import loguru
-import yaml
+from dotenv import find_dotenv
 from loguru import logger as logger
-from pydantic import Field
+from pydantic import BaseModel, Field
 from pydantic_settings import BaseSettings, SettingsConfigDict
 from rich.console import Console
 from rich.table import Table
 
-__version__ = "7.9.3"
+if TYPE_CHECKING:
+    from loguru import Logger
+
+__version__ = "7.9.4"
 PathType = str | pathlib.Path
 
 home = pathlib.Path.home()
 cwd = pathlib.Path.cwd()
 module_path = pathlib.Path(__file__).parent.absolute()
 repo_path = module_path.parent
 home_path = pathlib.Path.home() / ".gdsfactory"
 diff_path = repo_path / "gds_diff"
 logpath = home_path / "log.log"
 
 yamlpath_cwd = cwd / "config.yml"
 yamlpath_default = module_path / "config.yml"
 yamlpath_home = home_path / "config.yml"
+dotenv_path = find_dotenv(usecwd=True)
 
 GDSDIR_TEMP = pathlib.Path(tempfile.TemporaryDirectory().name).parent / "gdsfactory"
 
 plugins = [
     "gplugins",
     "ray",
     "femwell",
@@ -67,14 +72,44 @@
     "sph",
     "tj",
     "ubcpdk",
     "gvtt",
 ]
 
 
+class LogLevel(str, Enum):
+    TRACE = "TRACE"
+    DEBUG = "DEBUG"
+    INFO = "INFO"
+    SUCCESS = "SUCCESS"
+    WARNING = "WARNING"
+    ERROR = "ERROR"
+    CRITICAL = "CRITICAL"
+
+
+class LogFilter(BaseModel):
+    """Filter certain messages by log level or regex.
+
+    Filtered messages are not evaluated and discarded.
+    """
+
+    level: LogLevel = LogLevel.INFO
+    regex: str | None = None
+
+    def __call__(self, record: loguru.Record) -> bool:
+        """Loguru needs the filter to be callable."""
+        levelno = logger.level(self.level).no
+        if self.regex is None:
+            return record["level"].no >= levelno
+        else:
+            return record["level"].no >= levelno and not bool(
+                re.search(self.regex, record["message"])
+            )
+
+
 class ErrorType(Enum):
     ERROR = auto()
     WARNING = auto()
     IGNORE = auto()
 
 
 def print_version_plugins() -> None:
@@ -197,16 +232,17 @@
     last_saved_files: list[PathType] = []
     max_name_length: int = 99
     model_config = SettingsConfigDict(
         validation=True,
         arbitrary_types_allowed=True,
         env_prefix="gdsfactory_",
         env_nested_delimiter="_",
+        env_file=dotenv_path,
+        extra="ignore",
     )
-    loglevel: Literal["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"] = "INFO"
     pdk: str | None = None
     difftest_ignore_cell_name_differences: bool = True
     difftest_ignore_sliver_differences: bool = False
     difftest_ignore_label_differences: bool = False
     layer_error_path: tuple[int, int] = (1000, 0)
     ports_off_grid: Literal["warn", "error", "ignore"] = Field(
         default="warn", description="Ensures ports are on grid."
@@ -223,29 +259,23 @@
         default="ignore", description="When connecting ports with different layers."
     )
     on_type_missmatch: Literal["warn", "error", "ignore"] = Field(
         default="ignore", description="When connecting ports with different types."
     )
     default_show_suffix: Literal[".oas", ".gds"] = ".gds"
     raise_error_on_mutation: bool = True
+    logger: ClassVar[Logger] = logger
+    logfilter: LogFilter = Field(default_factory=LogFilter)
 
-    @classmethod
-    def from_config(cls) -> Settings:
-        """Load settings from YAML config file.
-        Recursively search for a `gfconfig.yml` file in the current working directory.
-        """
-        path = cwd
-
-        while path.parent != path:
-            path_config = path / "gfconfig.yml"
-            if path_config.is_file():
-                logger.info(f"Loading settings from {path_config}")
-                return Settings(**yaml.safe_load(path_config.read_text()))
-            path = path.parent
-        return Settings()
+    def __init__(self, **data: Any):
+        """Set log filter and run pydantic."""
+        super().__init__(**data)
+        self.logger.remove()
+        self.logger.add(sys.stdout, format=tracing_formatter, filter=self.logfilter)
+        self.logger.debug("LogLevel: {}", self.logfilter.level)
 
 
 class Paths:
     module = module_path
     repo = repo_path
     results_tidy3d = home / ".tidy3d"
     generic_tech = module / "generic_tech"
@@ -270,15 +300,15 @@
     gds_diff = GDSDIR_TEMP / "gds_diff"
     cwd = cwd
     sparameters_repo = test_data / "sp"  # repo with some demo sparameters
     fonts = module / "components" / "fonts"
     font_ocr = fonts / "OCR-A.ttf"
 
 
-CONF = Settings.from_config()
+CONF = Settings()
 PATH = Paths()
 sparameters_path = PATH.sparameters
 
 
 def rich_output() -> None:
     """Enables rich output."""
     try:
```

### Comparing `gdsfactory-7.9.3/gdsfactory/constants.py` & `gdsfactory-7.9.4/gdsfactory/constants.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/cross_section.py` & `gdsfactory-7.9.4/gdsfactory/cross_section.py`

 * *Files 0% similar despite different names*

```diff
@@ -280,14 +280,21 @@
                 update={
                     "width_function": width_function,
                     "offset_function": offset_function,
                     "width": width or self.width,
                     "layer": layer or self.layer,
                 }
             )
+            changed_width_layer_or_offset = (
+                width_function or offset_function or width or layer
+            )
+            if changed_width_layer_or_offset and len(sections) > 1:
+                warnings.warn(
+                    "CrossSection.copy() only modifies the attributes of the first section."
+                )
             return self.model_copy(update={"sections": tuple(sections), **kwargs})
         return self.model_copy(update=kwargs)
 
     def mirror(self) -> CrossSection:
         """Returns a mirrored copy of the cross_section."""
         sections = [s.model_copy(update=dict(offset=-s.offset)) for s in self.sections]
         return self.model_copy(update={"sections": tuple(sections)})
@@ -402,14 +409,15 @@
     bbox_offsets: Floats | None = None,
     cladding_layers: LayerSpecs | None = None,
     cladding_offsets: Floats | None = None,
     cladding_simplify: Floats | None = None,
     radius: float | None = 10.0,
     radius_min: float | None = None,
     add_pins_function_name: str | None = None,
+    main_section_name: str = "_default",
     **kwargs,
 ) -> CrossSection:
     """Return CrossSection.
 
     Args:
         width: main Section width (um).
         offset: main Section center offset (um).
@@ -423,14 +431,15 @@
         cladding_offsets: list of offset from main Section edge.
         cladding_simplify: Optional Tolerance value for the simplification algorithm. \
                 All points that can be removed without changing the resulting. \
                 polygon by more than the value listed here will be removed.
         radius: routing bend radius (um).
         radius_min: min acceptable bend radius.
         add_pins_function_name: name of the function to add pins to the component.
+        main_section_name: name of the main section. Defaults to _default
 
 
     Keyword Args:
         info: dictionary with extra information.
         add_pins_function_module: name of the module to add pins to the component.
         min_length: defaults to 1nm = 10e-3um for routing.
         start_straight_length: straight length at the beginning of the route.
@@ -499,15 +508,15 @@
     s = [
         Section(
             width=width,
             offset=offset,
             layer=layer,
             port_names=port_names,
             port_types=port_types,
-            name="_default",
+            name=main_section_name,
         )
     ] + sections
 
     if cladding_layers:
         s += [
             Section(width=width + 2 * offset, layer=layer, simplify=simplify)
             for layer, offset, simplify in zip(
@@ -2403,16 +2412,14 @@
 xs_pn_with_trenches = pn_with_trenches()
 xs_pn_with_trenches_asymmetric = pn_with_trenches_asymmetric()
 
 cross_sections = get_cross_sections(sys.modules[__name__])
 
 
 if __name__ == "__main__":
-    import gdsfactory as gf
-
     # xs = gf.cross_section.pn(
     #     # slab_offset=0
     #     # offset=1,
     #     # cladding_layers=[(2, 0)],
     #     # cladding_offsets=[3],
     #     # bbox_layers=[(3, 0)],
     #     # bbox_offsets=[2],
@@ -2420,9 +2427,9 @@
     # )
     # xs = xs.append_sections(sections=[gf.Section(width=1.0, layer=(2, 0), name="slab")])
     # p = gf.path.straight()
     # c = p.extrude(xs)
     # c = gf.c.straight(cross_section=xs)
     # xs = pn(slab_inset=0.2)
     xs = pn(width_slab=0)
-    c = gf.c.straight(cross_section=xs)
-    c.show()
+    # c = gf.c.straight(cross_section=xs)
+    # c.show()
```

### Comparing `gdsfactory-7.9.3/gdsfactory/decorators.py` & `gdsfactory-7.9.4/gdsfactory/decorators.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/difftest.py` & `gdsfactory-7.9.4/gdsfactory/difftest.py`

 * *Files 2% similar despite different names*

```diff
@@ -19,25 +19,27 @@
     ref_file: PathType,
     run_file: PathType,
     xor: bool = True,
     test_name: str = "",
     ignore_sliver_differences: bool | None = None,
     ignore_cell_name_differences: bool | None = None,
     ignore_label_differences: bool | None = None,
+    show: bool = True,
 ) -> bool:
     """Returns True if files are different, prints differences and shows them in klayout.
 
     Args:
         ref_file: reference (old) file.
         run_file: run (new) file.
         xor: runs xor on every layer between ref and run files.
         test_name: prefix for the new cell.
         ignore_sliver_differences: if True, ignores any sliver differences in the XOR result. If None (default), defers to the value set in CONF.difftest_ignore_sliver_differences
         ignore_cell_name_differences: if True, ignores any cell name differences. If None (default), defers to the value set in CONF.difftest_ignore_cell_name_differences
         ignore_label_differences: if True, ignores any label differences when run in XOR mode. If None (default) defers to the value set in CONF.difftest_ignore_label_differences
+        show: shows diff in klayout.
     """
     try:
         from kfactory import KCell, kdb
     except ImportError as e:
         print(
             "You can install `pip install gdsfactory[kfactory]` for using maskprep. "
             "And make sure you use python >= 3.10"
@@ -192,15 +194,16 @@
             _ = c << diff
             if equivalent:
                 print("No significant XOR differences between layouts!")
         else:
             # if no additional xor verificaiton, the two files are not equivalent
             equivalent = False
 
-        c.show()
+        if show:
+            c.show()
         if equivalent:
             return False
         else:
             return True
     return False
```

### Comparing `gdsfactory-7.9.3/gdsfactory/difftest_git.py` & `gdsfactory-7.9.4/gdsfactory/difftest_git.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/events.py` & `gdsfactory-7.9.4/gdsfactory/events.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/export/to_3d.py` & `gdsfactory-7.9.4/gdsfactory/export/to_3d.py`

 * *Files 1% similar despite different names*

```diff
@@ -40,16 +40,14 @@
     layer_to_thickness = layer_stack.get_layer_to_thickness()
     layer_to_zmin = layer_stack.get_layer_to_zmin()
     exclude_layers = exclude_layers or ()
     # layers = layer_views.layer_map.values()
 
     component_with_booleans = layer_stack.get_component_with_derived_layers(component)
     component_layers = component_with_booleans.get_layers()
-    component_with_booleans.show()
-
     has_polygons = False
 
     for layer, polygons in component_with_booleans.get_polygons(
         by_spec=True, as_array=False
     ).items():
         if (
             layer not in exclude_layers
```

### Comparing `gdsfactory-7.9.3/gdsfactory/export/to_gerber.py` & `gdsfactory-7.9.4/gdsfactory/export/to_gerber.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/export/to_np.py` & `gdsfactory-7.9.4/gdsfactory/export/to_np.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/export/to_stl.py` & `gdsfactory-7.9.4/gdsfactory/export/to_stl.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/fill.py` & `gdsfactory-7.9.4/gdsfactory/fill.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/font.py` & `gdsfactory-7.9.4/gdsfactory/font.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/functions.py` & `gdsfactory-7.9.4/gdsfactory/functions.py`

 * *Files 1% similar despite different names*

```diff
@@ -238,28 +238,29 @@
     with_yaml_format: bool = True,
 ) -> Component:
     """Add a settings label to a component. Use it as a decorator.
 
     Args:
         component: spec.
         layer_label: for label.
-        settings: list of settings to include. if None, adds all changed settings.
+        settings: list of settings to include. if None, adds all settings.
         ignore: list of settings to ignore.
         with_yaml_format: if True, uses yaml format, otherwise json.
 
     """
     from gdsfactory.pdk import get_component
 
     component = get_component(component)
 
     ignore = ignore or []
-    settings = settings or component.settings.changed.keys()
+    settings = settings or dict(component.settings).keys()
     settings = set(settings) - set(ignore)
 
-    d = {setting: component.get_setting(setting) for setting in settings}
+    d = dict(component.settings)
+    d = {setting: d[setting] for setting in settings}
     text = OmegaConf.to_yaml(d) if with_yaml_format else json.dumps(d)
     component.add_label(text=text, layer=layer_label)
     return component
 
 
 def add_marker_layer(
     component: ComponentSpec,
```

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/README.md` & `gdsfactory-7.9.4/gdsfactory/generic_tech/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/__init__.py` & `gdsfactory-7.9.4/gdsfactory/generic_tech/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/containers.py` & `gdsfactory-7.9.4/gdsfactory/generic_tech/containers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/get_klayout_pyxs.py` & `gdsfactory-7.9.4/gdsfactory/generic_tech/get_klayout_pyxs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/d25/generic_tech.lyd25` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/d25/generic_tech.lyd25`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/drc/errors.py` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/drc/errors.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/grain.xml`

 * *Files 2% similar despite different names*

#### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/grain.xml`

```diff
@@ -1,13 +1,13 @@
 <?xml version="1.0" encoding="utf-8"?>
 <salt-grain>
   <name>gdsfactory</name>
   <token/>
   <hidden>false</hidden>
-  <version>7.9.3</version>
+  <version>7.9.4</version>
   <api-version/>
   <title>gdsfactory</title>
   <doc>EDA tool to layout integrated circuits</doc>
   <doc-url>https://gdsfactory.github.io/gdsfactory/</doc-url>
   <url>https://github.com/gdsfactory/gdsfactory</url>
   <license>MIT</license>
   <author>Joaquin Matres</author>
```

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/icon_128x128.png` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/icon_128x128.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/icon_64x64.png` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/icon_64x64.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/layers.lyp` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/layers.lyp`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/README.md` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/run_lvs.py` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/run_lvs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

 * *Files 15% similar despite different names*

#### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

```diff
@@ -12,15 +12,15 @@
   <show-in-menu>false</show-in-menu>
   <group-name/>
   <menu-path>gdsfactory.begin</menu-path>
   <interpreter>python</interpreter>
   <dsl-interpreter-name/>
   <text>import pya
 
-__version__ = &quot;7.9.3&quot;
+__version__ = &quot;7.9.4&quot;
 
 
 def set_menu():
     menu = pya.Application.instance().main_window().menu()
 
     s0 = &quot;gdsfactory&quot;
     if not (menu.is_menu(s0)):
```

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/tech.lyt` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/tech.lyt`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/xsection/xsection_generic.pyxs` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/xsection/xsection_generic.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/xsection/xsection_generic.xs` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/xsection/xsection_generic.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/xsection/xsection_planarized.pyxs` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/xsection/xsection_planarized.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/klayout/xsection/xsection_planarized.xs` & `gdsfactory-7.9.4/gdsfactory/generic_tech/klayout/xsection/xsection_planarized.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/layer_map.py` & `gdsfactory-7.9.4/gdsfactory/generic_tech/layer_map.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/layer_stack.py` & `gdsfactory-7.9.4/gdsfactory/generic_tech/layer_stack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/layer_views.yaml` & `gdsfactory-7.9.4/gdsfactory/generic_tech/layer_views.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/generic_tech/simulation_settings.py` & `gdsfactory-7.9.4/gdsfactory/generic_tech/simulation_settings.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/__init__.py` & `gdsfactory-7.9.4/gdsfactory/geometry/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/boolean.py` & `gdsfactory-7.9.4/gdsfactory/geometry/boolean.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/boolean_klayout.py` & `gdsfactory-7.9.4/gdsfactory/geometry/boolean_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/boolean_polygons.py` & `gdsfactory-7.9.4/gdsfactory/geometry/boolean_polygons.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/fill_klayout.py` & `gdsfactory-7.9.4/gdsfactory/geometry/fill_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/fillet.py` & `gdsfactory-7.9.4/gdsfactory/geometry/fillet.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/functions.py` & `gdsfactory-7.9.4/gdsfactory/geometry/functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/invert.py` & `gdsfactory-7.9.4/gdsfactory/geometry/invert.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/layer_priority.py` & `gdsfactory-7.9.4/gdsfactory/geometry/layer_priority.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/manhattanize.py` & `gdsfactory-7.9.4/gdsfactory/geometry/manhattanize.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/maskprep.py` & `gdsfactory-7.9.4/gdsfactory/geometry/offset.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,134 +1,108 @@
-from functools import partial
+"""Based on phidl.geometry."""
+
+from __future__ import annotations
 
 import gdstk
 
 import gdsfactory as gf
-from gdsfactory.typings import (
-    Component,
-    ComponentOrReference,
-    ComponentSpec,
-    Floats,
-    LayerSpecs,
-)
+from gdsfactory.component_layout import Polygon
+from gdsfactory.typings import Component, ComponentReference, LayerSpec
 
 
-def get_polygons_over_under(
-    component: ComponentOrReference,
-    layers: LayerSpecs,
-    distances: Floats,
+@gf.cell
+def offset(
+    elements: Component,
+    distance: float = 0.1,
     use_union: bool = True,
     precision: float = 1e-4,
     join: str = "miter",
     tolerance: int = 2,
-) -> list[gdstk.Polygon]:
-    """Returns list polygons dilated and eroded by an offset.
-    Cleans min width gap and acute angle DRC errors equal to distances.
+    layer: LayerSpec = "WG",
+) -> Component:
+    """Returns new Component with polygons eroded or dilated by an offset.
 
     Args:
-        component: Component containing polygons to offset.
-        layers: list of layers to remove min gap errors.
-        distances: Distance to offset polygons.
-            By expanding and shrinking it merges polygons.
-            If you want to fix min gaps of 0.5 use 0.5.
+        elements: Component(/Reference), list of Component(/Reference), or Polygons \
+                to offset or Component containing polygons to offset.
+        distance: Distance to offset polygons. Positive values expand, negative shrink.
+        use_union: If True, use union of all polygons to offset. If False, offset
         precision: Desired precision for rounding vertex coordinates.
         join: {'miter', 'bevel', 'round'} Type of join used to create polygon offset
-        tolerance: For miter joints, this number must be at least 2 represents the
-          maximal distance in multiples of offset between new vertices and their
-          original position before beveling to avoid spikes at acute joints. For
-          round joints, it indicates the curvature resolution in number of
-          points per full circle.
+        tolerance: For miter joints, this number must be at least 2 represents the \
+                maximal distance in multiples of offset between new vertices and their \
+                original position before beveling to avoid spikes at acute joints. For \
+                round joints, it indicates the curvature resolution in number of \
+                points per full circle.
         layer: Specific layer to put polygon geometry on.
+
     Returns:
         Component containing a polygon(s) with the specified offset applied.
-    """
-    polygons = []
-
-    for layer, distance in zip(layers, distances):
-        layer = gf.get_layer(layer)
-        if layer in component.layers:
-            gds_layer, gds_datatype = layer
-            polygons_to_offset = component.get_polygons(layer)
-            p_dilated = gdstk.offset(
-                polygons_to_offset,
-                distance=+distance,
-                join=join,
-                tolerance=tolerance,
-                precision=precision,
-                use_union=use_union,
-                layer=gds_layer,
-                datatype=gds_datatype,
-            )
-            p = gdstk.offset(
-                p_dilated,
-                distance=-distance,
-                join=join,
-                tolerance=tolerance,
-                precision=precision,
-                use_union=use_union,
-                layer=gds_layer,
-                datatype=gds_datatype,
-            )
-            polygons.append(p)
-    return polygons
 
+    .. plot::
+      :include-source:
 
-@gf.cell
-def over_under(
-    component: ComponentSpec,
-    layers: LayerSpecs,
-    remove_original: bool = False,
-    **kwargs,
-) -> Component:
-    """Returns cleaned component.
+      import gdsfactory as gf
+      c = gf.Component()
+      layer_slab = (2, 0)
+      c1 = gf.components.coupler_ring(
+          cladding_layers=[layer_slab], cladding_offsets=[0.5]
+      )
+      d = 0.8
+      c2 = gf.geometry.offset(c1, distance=+d, layer=layer_slab)
+      c3 = gf.geometry.offset(c2, distance=-d, layer=layer_slab)
+
+      _ = c << c1.extract(layers=("WG",))
+      _ = c << c3
+      c.plot_matplotlib()
 
-    Args:
-        component:
-        layers: list of layers.
-        remove_original: remove original layers.
     """
-    c = Component()
-    _component = gf.get_component(component)
+    if not isinstance(elements, list):
+        elements = [elements]
+    polygons_to_offset = []
+    for e in elements:
+        if isinstance(e, Component | ComponentReference):
+            polygons_to_offset += e.get_polygons(by_spec=False)
+        elif isinstance(e, Polygon | gdstk.Polygon):
+            polygons_to_offset.append(e)
+    if len(polygons_to_offset) == 0:
+        return gf.Component("offset")
+
+    gds_layer, gds_datatype = gf.get_layer(layer)
+    p = gdstk.offset(
+        polygons_to_offset,
+        distance=distance,
+        join=join,
+        tolerance=tolerance,
+        precision=precision,
+        use_union=use_union,
+        layer=gds_layer,
+        datatype=gds_datatype,
+    )
 
-    ref = c << _component
-    if remove_original:
-        c = c.remove_layers(layers=layers)
-    p = get_polygons_over_under(component=_component, layers=layers, **kwargs)
-    c.add(p)
-    c.copy_child_info(_component)
-    c.add_ports(ref.ports)
-    return c
+    component = gf.Component()
+    component.add_polygon(p, layer=layer)
+    return component
 
 
-over_under_remove_original = partial(over_under, remove_original=True)
+def test_offset() -> None:
+    c = gf.components.ring()
+    co = offset(c, distance=0.5)
+    assert int(co.area()) == 94
 
 
 if __name__ == "__main__":
     import gdsfactory as gf
 
-    # over_under_slab = partial(over_under, layers=((2, 0)), distances=(0.5,))
-    # c = gf.components.coupler_ring(
-    #     cladding_layers=((2, 0)),
-    #     cladding_offsets=(0.2,),
-    #     decorator=over_under_slab,
-    # )
-    over_under_slab_remove_original = partial(
-        over_under_remove_original, layers=((2, 0)), distances=(0.5,)
-    )
-    c = gf.components.coupler_ring(
-        cladding_layers=((2, 0)),
-        cladding_offsets=(0.2,),
-        decorator=over_under_slab_remove_original,
+    c = gf.Component()
+    layer_slab = (2, 0)
+    c1 = gf.components.coupler_ring(
+        cladding_layers=[layer_slab], cladding_offsets=[0.5]
     )
-    # get_polygons_over_under_slab = partial(
-    #     get_polygons_over_under, layers=((2, 0)), distances=(0.5,)
-    # )
-
-    # c = gf.Component("component_clean")
-    # ref = c << gf.components.coupler_ring(
-    #     cladding_layers=((2, 0)),
-    #     cladding_offsets=(0.2,),  # decorator=over_under_slab_decorator
-    # )
-    # polygons = get_polygons_over_under_slab(ref)
-    # c.add(polygons)
-
-    c.show(show_ports=True)
+    d = 0.8
+    # d = 1
+    c2 = gf.geometry.offset(c1, distance=+d, layer=layer_slab)
+    c3 = gf.geometry.offset(c2, distance=-d, layer=layer_slab)
+
+    _ = c << c1.extract(layers=("WG",))
+    _ = c << c3
+    c.show()
```

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/maskprep_flat.py` & `gdsfactory-7.9.4/gdsfactory/geometry/maskprep_flat.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/offset.py` & `gdsfactory-7.9.4/gdsfactory/geometry/union.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,108 +1,103 @@
-"""Based on phidl.geometry."""
-
 from __future__ import annotations
 
 import gdstk
 
 import gdsfactory as gf
-from gdsfactory.component_layout import Polygon
-from gdsfactory.typings import Component, ComponentReference, LayerSpec
+from gdsfactory.component import Component
+from gdsfactory.typings import Layer
+
+
+def _union_polygons(polygons, precision: float = 1e-4) -> gdstk.Polygon:
+    """Performs union of polygons within PolygonSet or list of polygons.
+
+    Args:
+        polygons: PolygonSet or list of polygons. A set containing the input polygons.
+        precision: Desired precision for rounding vertex coordinates.
+        max_points: maximum number of vertices within the resulting polygon.
+
+    Returns:
+        unioned: polygon result of the union of all polygons within the input PolygonSet.
+    """
+    return gdstk.boolean(
+        polygons,
+        [],
+        operation="or",
+        precision=precision,
+    )
 
 
 @gf.cell
-def offset(
-    elements: Component,
-    distance: float = 0.1,
-    use_union: bool = True,
+def union(
+    component: Component,
+    by_layer: bool = False,
     precision: float = 1e-4,
-    join: str = "miter",
-    tolerance: int = 2,
-    layer: LayerSpec = "WG",
+    join_first: bool = True,
+    layer: Layer = (1, 0),
+    keep_ports: bool = False,
 ) -> Component:
-    """Returns new Component with polygons eroded or dilated by an offset.
+    """Returns new Component with inverted union of Component polygons.
+
+    based on phidl.geometry.union
 
     Args:
-        elements: Component(/Reference), list of Component(/Reference), or Polygons \
-                to offset or Component containing polygons to offset.
-        distance: Distance to offset polygons. Positive values expand, negative shrink.
-        use_union: If True, use union of all polygons to offset. If False, offset
+        component: Component(/Reference), list of Component(/Reference), or Polygon \
+                A containing the polygons to perform union and inversion on.
+        by_layer: performs the union operation layer-wise so each layer can be \
+                individually combined.
         precision: Desired precision for rounding vertex coordinates.
-        join: {'miter', 'bevel', 'round'} Type of join used to create polygon offset
-        tolerance: For miter joints, this number must be at least 2 represents the \
-                maximal distance in multiples of offset between new vertices and their \
-                original position before beveling to avoid spikes at acute joints. For \
-                round joints, it indicates the curvature resolution in number of \
-                points per full circle.
+        join_first: before offsetting to avoid unnecessary joins in adjacent polygons.
         layer: Specific layer to put polygon geometry on.
-
-    Returns:
-        Component containing a polygon(s) with the specified offset applied.
+        keep_ports: keep ports from component.
 
     .. plot::
       :include-source:
 
       import gdsfactory as gf
       c = gf.Component()
-      layer_slab = (2, 0)
-      c1 = gf.components.coupler_ring(
-          cladding_layers=[layer_slab], cladding_offsets=[0.5]
-      )
-      d = 0.8
-      c2 = gf.geometry.offset(c1, distance=+d, layer=layer_slab)
-      c3 = gf.geometry.offset(c2, distance=-d, layer=layer_slab)
-
-      _ = c << c1.extract(layers=("WG",))
-      _ = c << c3
-      c.plot_matplotlib()
-
+      c << gf.components.ellipse(radii=(6, 6))
+      c << gf.components.ellipse(radii=(10, 4))
+      c2 = gf.geometry.union(c, join_first=False)
+      c2.plot()
     """
-    if not isinstance(elements, list):
-        elements = [elements]
-    polygons_to_offset = []
-    for e in elements:
-        if isinstance(e, Component | ComponentReference):
-            polygons_to_offset += e.get_polygons(by_spec=False)
-        elif isinstance(e, Polygon | gdstk.Polygon):
-            polygons_to_offset.append(e)
-    if len(polygons_to_offset) == 0:
-        return gf.Component("offset")
-
-    gds_layer, gds_datatype = gf.get_layer(layer)
-    p = gdstk.offset(
-        polygons_to_offset,
-        distance=distance,
-        join=join,
-        tolerance=tolerance,
-        precision=precision,
-        use_union=use_union,
-        layer=gds_layer,
-        datatype=gds_datatype,
-    )
-
-    component = gf.Component()
-    component.add_polygon(p, layer=layer)
-    return component
-
+    U = Component()
 
-def test_offset() -> None:
-    c = gf.components.ring()
-    co = offset(c, distance=0.5)
-    assert int(co.area()) == 94
+    if by_layer:
+        all_polygons = component.get_polygons(by_spec=True)
+        for layer, polygons in all_polygons.items():
+            unioned_polygons = _union_polygons(
+                polygons,
+                precision=precision,
+            )
+            U.add_polygon(unioned_polygons, layer=layer)
+    else:
+        all_polygons = component.get_polygons(by_spec=False)
+        unioned_polygons = (
+            _union_polygons(
+                all_polygons,
+                precision=precision,
+            )
+            if join_first
+            else all_polygons
+        )
+        U.add_polygon(unioned_polygons, layer=layer)
+
+    if keep_ports:
+        U.add_ports(component.ports)
+    return U
+
+
+def test_union() -> None:
+    c = Component()
+    _ = c << gf.components.ellipse(radii=(6, 6))
+    _ = c << gf.components.ellipse(radii=(10, 4))
+    c2 = union(c)
+    assert int(c2.area()) == 153, c2.area()
 
 
 if __name__ == "__main__":
-    import gdsfactory as gf
-
-    c = gf.Component()
-    layer_slab = (2, 0)
-    c1 = gf.components.coupler_ring(
-        cladding_layers=[layer_slab], cladding_offsets=[0.5]
-    )
-    d = 0.8
-    # d = 1
-    c2 = gf.geometry.offset(c1, distance=+d, layer=layer_slab)
-    c3 = gf.geometry.offset(c2, distance=-d, layer=layer_slab)
-
-    _ = c << c1.extract(layers=("WG",))
-    _ = c << c3
-    c.show()
+    test_union()
+    c = Component()
+    _ = c << gf.components.ellipse(radii=(6, 6))
+    _ = c << gf.components.ellipse(radii=(10, 4))
+    c2 = union(c, join_first=False, keep_ports=True)
+    c2.show()
```

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/outline.py` & `gdsfactory-7.9.4/gdsfactory/geometry/outline.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/trim.py` & `gdsfactory-7.9.4/gdsfactory/geometry/trim.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/geometry/xor_diff.py` & `gdsfactory-7.9.4/gdsfactory/geometry/xor_diff.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/get_factories.py` & `gdsfactory-7.9.4/gdsfactory/get_factories.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/get_netlist.py` & `gdsfactory-7.9.4/gdsfactory/get_netlist.py`

 * *Files 7% similar despite different names*

```diff
@@ -86,34 +86,31 @@
             return label.text
 
     return text
 
 
 def get_netlist_yaml(
     component: Component,
-    full_settings: bool = False,
     tolerance: int = 5,
     exclude_port_types: list | None = None,
     **kwargs,
 ) -> str:
     """Returns instances, connections and placements yaml string content."""
     return omegaconf.OmegaConf.to_yaml(
         get_netlist(
             component=component,
-            full_settings=full_settings,
             tolerance=tolerance,
             exclude_port_types=exclude_port_types,
             **kwargs,
         )
     )
 
 
 def get_netlist(
     component: Component,
-    full_settings: bool = False,
     tolerance: int = 5,
     exclude_port_types: list[str] | tuple[str] | None = ("placement",),
     get_instance_name: Callable[..., str] = get_instance_name_from_alias,
     allow_multiple: bool = False,
 ) -> dict[str, Any]:
     """Returns instances, connections and placements from :class:`Component` as a dict.
 
@@ -136,15 +133,14 @@
     snap_to_grid() allows a value of 0, which will return the original value,
     is more efficient when the value is 1, and will throw a more descriptive error when the value is <0
     the default value of tolerance is 5nm because it should allow better performance with the two-grid-sweep approach.
 
 
     Args:
         component: to extract netlist.
-        full_settings: True returns all, false changed settings.
         tolerance: tolerance in grid_factor to consider two ports connected.
         exclude_port_types: optional list of port types to exclude from netlisting.
         get_instance_name: function to get instance name.
         allow_multiple: False to raise an error if more than two ports share the same connection. \
                 if True, will return key: [value] pairs with [value] a list of all connected instances.
 
     Returns:
@@ -195,18 +191,18 @@
         instance = {}
 
         if c.info:
             instance.update(component=c.name, info=clean_value_json(c.info))
 
         # Prefer name from settings over c.name
         if c.settings:
-            settings = c.settings.full if full_settings else c.settings.changed
+            settings = c.settings
 
             instance.update(
-                component=getattr(c.settings, "function_name", c.name),
+                component=c.function_name or c.name,
                 settings=clean_value_json(settings),
             )
 
         instances[reference_name] = instance
         placements[reference_name] = {
             "x": x,
             "y": y,
@@ -527,15 +523,15 @@
 
 def _get_references_to_netlist(component: Component) -> list[ComponentReference]:
     from gdsfactory.cell import CACHE
 
     references = component.references
     if not references and "transformed_cell" in component.info:
         # expand transformed, flattened cells
-        ref = component.settings.full["ref"]
+        ref = component.settings
         original_cell = CACHE[component.info["transformed_cell"]]
         references = [
             ComponentReference(
                 original_cell,
                 origin=ref["origin"],
                 rotation=ref["rotation"],
                 x_reflection=ref["x_reflection"],
@@ -556,15 +552,14 @@
     Args:
         component: to extract netlist.
         component_suffix: suffix to append to each component name.
             useful if to save and reload a back-annotated netlist.
         get_netlist_func: function to extract individual netlists.
 
     Keyword Args:
-        full_settings: True returns all, false changed settings.
         tolerance: tolerance in grid_factor to consider two ports connected.
         exclude_port_types: optional list of port types to exclude from netlisting.
         get_instance_name: function to get instance name.
 
     Returns:
         Dictionary of netlists, keyed by the name of each component.
 
@@ -590,17 +585,17 @@
             all_netlists |= grandchildren
 
             child_references = _get_references_to_netlist(ref.ref_cell)
 
             if child_references:
                 inst_name = get_instance_name(component, ref)
                 netlist_dict = {"component": f"{rcell.name}{component_suffix}"}
-                if hasattr(rcell, "settings") and hasattr(rcell.settings, "full"):
-                    netlist_dict.update(settings=rcell.settings.full)
-                if hasattr(rcell, "info"):
+                if rcell.settings:
+                    netlist_dict.update(settings=rcell.settings)
+                if rcell.info:
                     netlist_dict.update(info=rcell.info)
                 netlist["instances"][inst_name] = netlist_dict
 
     return all_netlists
 
 
 def _demo_ring_single_array() -> None:
@@ -643,29 +638,31 @@
     i1 = c.add_ref(gf.components.straight(), "i1")
     i2 = c.add_ref(gf.components.straight(), "i2")
     i1.rotate(rotation_value)
     i2.connect("o2", i1.ports["o1"])
 
     # flatten the oddly rotated refs
     c = flatten_invalid_refs(c)
+    print(c.get_dependencies())
+    c.show()
 
     # perform the initial sanity checks on the netlist
     netlist = c.get_netlist()
     connections = netlist["connections"]
     assert len(connections) == 1, len(connections)
     cpairs = list(connections.items())
     extracted_port_pair = set(cpairs[0])
     expected_port_pair = {"i2,o2", "i1,o1"}
     assert extracted_port_pair == expected_port_pair
 
     recursive_netlist = get_netlist_recursive(c)
     top_netlist = recursive_netlist[cname]
     # the recursive netlist should have 3 entries, for the top level and two
     # rotated straights
-    assert len(recursive_netlist) == 3
+    assert len(recursive_netlist) == 1, len(recursive_netlist)
     # confirm that the child netlists have reference attributes properly set
 
     i1_cell_name = top_netlist["instances"]["i1"]["component"]
     i1_netlist = recursive_netlist[i1_cell_name]
     # currently for transformed netlists, the instance name of the inner cell is None
     assert i1_netlist["placements"][None]["rotation"] == rotation_value
```

### Comparing `gdsfactory-7.9.3/gdsfactory/get_netlist_flat.py` & `gdsfactory-7.9.4/gdsfactory/get_netlist_flat.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/grid.py` & `gdsfactory-7.9.4/gdsfactory/grid.py`

 * *Files 2% similar despite different names*

```diff
@@ -108,21 +108,19 @@
                 ]
                 * remainder,
             )
     device_array = np.reshape(device_array, shape)
     prefix_to_ref = {}
 
     D = Component()
-    D.info["components"] = {}
     ref_array = np.empty(device_array.shape, dtype=object)
     dummy = Component()
     for idx, d in np.ndenumerate(device_array):
         if d is not None:
             d = get_component(d)
-            D.info["components"][d.name] = dict(d.settings)
             ref = D.add_ref(d, rotation=rotation, x_reflection=h_mirror)
             if v_mirror:
                 ref.mirror_y()
             ref_array[idx] = ref
             prefix = d.name if name_ports_with_component_name else str(idx)
             prefix = prefix.replace(" ", "")
             prefix = prefix.replace(",", "_")
@@ -148,19 +146,21 @@
         direction="x", spacing=spacing[0], separation=separation, edge=edge_x
     )
     Group(rows[::-1]).distribute(
         direction="y", spacing=spacing[1], separation=separation, edge=edge_y
     )
 
     for prefix, ref in prefix_to_ref.items():
+        component = ref.parent
+        info = dict(component.info)
+        info.update(parent=component.name)
         if add_ports_prefix:
-            D.add_ports(ref.ports, prefix=f"{prefix}-")
+            D.add_ports(ref.ports, prefix=f"{prefix}-", info=info)
         else:
-            D.add_ports(ref.ports, suffix=f"-{prefix}")
-
+            D.add_ports(ref.ports, suffix=f"-{prefix}", info=info)
     return D
 
 
 grid_with_component_name = partial(grid, name_ports_with_component_name=True)
 
 
 @cell
@@ -246,14 +246,15 @@
                     label = f"{text_prefix}{i}"
                 t = c << text(label)
                 if text_mirror:
                     t.mirror()
                 if text_rotation:
                     t.rotate(text_rotation)
                 t.move(np.array(text_offset) + getattr(ref.size_info, text_anchor))
+    c.add_ports(g.ports)
     return c
 
 
 def test_grid() -> None:
     import gdsfactory as gf
 
     c = [gf.components.straight(length=i) for i in [1, 1, 2]]
@@ -285,10 +286,10 @@
         c,
         shape=(2, 2),
         rotation=0,
         h_mirror=False,
         v_mirror=False,
         spacing=(10, 10),
         # text_offsets=((0, 100), (0, -100)),
-        text_anchors=("south",),
+        # text_anchors=("south",),
     )
     c.show(show_ports=True)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/install.py` & `gdsfactory-7.9.4/gdsfactory/install.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/klive.py` & `gdsfactory-7.9.4/gdsfactory/klive.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/labels/add_label_yaml.py` & `gdsfactory-7.9.4/gdsfactory/labels/add_label_yaml.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,35 +1,35 @@
 """Add label YAML."""
 from __future__ import annotations
 
 import json
 from functools import partial
 from typing import Any
 
-import pydantic
 from omegaconf import OmegaConf
 
 import gdsfactory as gf
+from gdsfactory.serialization import clean_dict
 from gdsfactory.typings import LayerSpec
 
 
-@pydantic.validate_call
+@gf.cell_with_child
 def add_label_yaml(
     component: gf.Component,
     layer: LayerSpec = "TEXT",
     measurement: str | None = None,
     measurement_settings: dict[str, Any] | None = None,
     analysis: str | None = None,
     analysis_settings: dict[str, Any] | None = None,
     doe: str | None = None,
     with_yaml_format: bool = True,
     port_index_optical: tuple[int, ...] | None = (0,),
     port_index_electrical: tuple[int, ...] | None = (0,),
 ) -> gf.Component:
-    """Returns Component with measurement label.
+    """Returns new Component with measurement label.
 
     Args:
         component: to add labels to.
         layer: text label layer.
         measurement: measurement config name. Defaults to component['info']['measurement'].
         measurement_settings: measurement settings. Defaults to component['info']['measurement_settings'].
         analysis: analysis name. Defaults to component['info']['analysis'].
@@ -37,27 +37,32 @@
         doe: Design of Experiment name. Defaults to component['info']['doe'].
         with_yaml_format: whether to use yaml or json format.
         port_index_optical: port index to add to the label. None adds it to all, 0 to first, -1 to last.
         port_index_electrical: port index to add to the label. None adds it to all, 0 to first, -1 to last.
     """
     from gdsfactory.pdk import get_layer
 
+    c = gf.Component()
+    ref = c << gf.get_component(component)
+    c.add_ports(ref.ports)
+
     measurement = measurement or component.info.get("measurement")
     measurement_settings = measurement_settings or component.info.get(
         "measurement_settings"
     )
     analysis = analysis or component.info.get("analysis")
     analysis_settings = analysis_settings or component.info.get("analysis_settings")
     doe = doe or component.info.get("doe")
 
     layer = get_layer(layer)
     analysis_settings = analysis_settings or {}
     measurement_settings = measurement_settings or {}
-    cell_settings = component.metadata.get("full", {})
-    cell_settings.update(component.metadata.get("info", {}))
+    cell_settings = dict(component.settings)
+    cell_settings.update(dict(component.info))
+    cell_settings = clean_dict(cell_settings)
 
     optical_ports = component.get_ports_list(port_type="optical")
     electrical_ports = component.get_ports_list(port_type="electrical")
 
     port_index_optical = port_index_optical if optical_ports else ()
     port_index_electrical = port_index_electrical if electrical_ports else ()
 
@@ -80,66 +85,68 @@
         label = gf.Label(
             text=text,
             origin=(x, y),
             anchor="o",
             layer=layer[0],
             texttype=layer[1],
         )
-        component.add(label)
+        c.add(label)
     for port_index in port_index_electrical:
         d = dict(port_type="electrical", port_names=port_names_electrical, **settings)
         text = OmegaConf.to_yaml(d) if with_yaml_format else json.dumps(d)
         x, y = electrical_ports[port_index].center
         label = gf.Label(
             text=text,
             origin=(x, y),
             anchor="o",
             layer=layer[0],
             texttype=layer[1],
         )
-        component.add(label)
-    return component
+        c.add(label)
+    c.copy_child_info(component)
+    return c
 
 
 add_label_json = partial(add_label_yaml, with_yaml_format=False)
 
 
 if __name__ == "__main__":
-    import yaml
-
     measurement_settings = dict(
         wavelenth_min=1550, wavelenth_max=1570, wavelength_steps=10
     )
     with_yaml_format = False
     with_yaml_format = True
 
-    decorator = add_label_yaml if with_yaml_format else add_label_json
-
     info = dict(
         measurement_settings=measurement_settings,
         with_yaml_format=with_yaml_format,
     )
 
     c = gf.c.straight(length=11)
     c = gf.c.mmi2x2(length_mmi=2.2)
     c = gf.routing.add_fiber_array(
         c,
         get_input_labels_function=None,
         grating_coupler=gf.components.grating_coupler_te,
-        decorator=decorator,
-        info=info,
     )
-
-    c = gf.components.spiral_inner_io_fiber_array(
-        length=20e3,
-        decorator=decorator,
-        info=dict(
-            measurement="optical_loopback2",
-            doe="spiral_sc",
-            measurement_settings=dict(wavelength_alignment=1560),
-        ),
-    )
-    print(len(c.labels[0].text))
-    print(c.labels[0].text)
-    d = yaml.safe_load(c.labels[0].text) if yaml else json.loads(c.labels[0].text)
-    print(d)
+    c = add_label_json(c)
+    info = dict(
+        measurement="optical_loopback2",
+        doe="spiral_sc",
+        wavelenth_min=1560,
+    )
+    c.info.update(info)
+
+    # c = gf.components.spiral_inner_io_fiber_array(
+    #     length=20e3,
+    #     decorator=decorator,
+    #     info=dict(
+    #         measurement="optical_loopback2",
+    #         doe="spiral_sc",
+    #         measurement_settings=dict(wavelength_alignment=1560),
+    #     ),
+    # )
+    # print(len(c.labels[0].text))
+    # print(c.labels[0].text)
+    # d = yaml.safe_load(c.labels[0].text) if yaml else json.loads(c.labels[0].text)
+    # print(d)
     c.show(show_ports=False)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/labels/ehva.py` & `gdsfactory-7.9.4/gdsfactory/labels/ehva.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,16 +1,14 @@
 from __future__ import annotations
 
 from functools import partial
 
 import flatdict
-import pydantic
 
 import gdsfactory as gf
-from gdsfactory.name import clean_name
 from gdsfactory.snap import snap_to_grid as snap
 from gdsfactory.typings import Layer
 
 ignore = (
     "cross_section",
     "decorator",
     "cross_section1",
@@ -23,65 +21,63 @@
     "pad": "ELECTRICALPORT",
     "vertical_dc": "ELECTRICALPORT",
     "optical": "OPTICALPORT",
     "loopback": "OPTICALPORT",
 }
 
 
-@pydantic.validate_call
+@gf.cell_with_child
 def add_label_ehva(
     component: gf.Component,
     die: str = "demo",
     prefix_to_type: dict[str, str] = prefix_to_type_default,
     layer: Layer = (66, 0),
     metadata_ignore: list[str] | None = None,
-    metadata_include_parent: list[str] | None = None,
-    metadata_include_child: list[str] | None = None,
+    metadata_include: list[str] | None = None,
 ) -> gf.Component:
-    """Returns Component with measurement labels.
+    """Returns new Component with measurement labels.
 
     Args:
         component: to add labels to.
         die: string.
         port_types: list of port types to label.
         layer: text label layer.
         metadata_ignore: list of settings keys to ignore.
             Works with flatdict setting:subsetting.
-        metadata_include_parent: includes parent metadata.
+        metadata_include: includes settings .
             Works with flatdict setting:subsetting.
 
     """
+    c = gf.Component()
+    component = gf.get_component(component)
+    ref = c << component
+    c.add_ports(ref.ports)
+    c.copy_child_info(component)
+
     metadata_ignore = metadata_ignore or []
-    metadata_include_parent = metadata_include_parent or []
-    metadata_include_child = metadata_include_child or []
+    metadata_include = metadata_include or []
 
     text = f"""DIE NAME:{die}
 CIRCUIT NAME:{component.name}
 """
     info = []
 
-    metadata = component.metadata_child["changed"]
+    metadata = dict(component.info)
+    metadata = flatdict.FlatDict(metadata)
     if metadata:
         info += [
             f"CIRCUITINFO NAME: {k}, VALUE: {v}"
             for k, v in metadata.items()
             if k not in metadata_ignore and isinstance(v, int | float | str)
         ]
 
-    metadata = flatdict.FlatDict(component.metadata["full"])
-    info += [
-        f"CIRCUITINFO NAME: {clean_name(k)}, VALUE: {metadata.get(k)}"
-        for k in metadata_include_parent
-        if metadata.get(k)
-    ]
-
-    metadata = flatdict.FlatDict(component.metadata_child["full"])
+    metadata = flatdict.FlatDict(dict(component.settings))
     info += [
         f"CIRCUITINFO NAME: {k}, VALUE: {metadata.get(k)}"
-        for k in metadata_include_child
+        for k in metadata
         if metadata.get(k)
     ]
 
     text += "\n".join(info)
     text += "\n"
 
     info = []
@@ -98,32 +94,32 @@
     label = gf.Label(
         text=text,
         origin=(0, 0),
         anchor="o",
         layer=layer[0],
         texttype=layer[1],
     )
-    component.add(label)
-    return component
+    c.add(label)
+    return c
 
 
 if __name__ == "__main__":
     add_label_ehva_demo = partial(
         add_label_ehva,
         die="demo_die",
-        metadata_include_parent=["grating_coupler:settings:polarization"],
+        metadata_include=["grating_coupler:settings:polarization"],
     )
 
     c = gf.c.straight(length=11)
     c = gf.c.mmi2x2(length_mmi=2.2)
     c = gf.routing.add_fiber_array(
         c,
         get_input_labels_function=None,
         grating_coupler=gf.c.grating_coupler_te,
-        decorator=add_label_ehva_demo,
     )
+    c = add_label_ehva_demo(c)
 
     # add_label_ehva(c, die="demo_die", metadata_include_child=["width_mmi"])
     # add_label_ehva(c, die="demo_die", metadata_include_child=[])
 
     print(c.labels[0])
     c.show(show_ports=True)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/labels/get_test_manifest.py` & `gdsfactory-7.9.4/gdsfactory/labels/get_test_manifest.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,73 +1,85 @@
 """Converts CSV of test site labels into a CSV test manifest."""
 
-
-from collections import defaultdict
-
 import pandas as pd
 
 import gdsfactory as gf
 from gdsfactory.samples.sample_reticle import sample_reticle
 
 
-def get_test_manifest(component: gf.Component) -> pd.DataFrame:
-    """Returns a pandas DataFrame with test manifest.
+def get_test_manifest(
+    component: gf.Component, one_setting_per_column: bool = True
+) -> pd.DataFrame:
+    """
+    Returns a pandas DataFrame with test manifest.
 
     Args:
-        component: component to extract test manifest from.
+        component: Component to extract test manifest from.
+        one_setting_per_column: If True, puts each cell setting in a separate column.
     """
     rows = []
-    columns = [
-        "cell",
-        "cell_settings",
-        "ports",
-        "measurement",
-        "measurement_settings",
-        "analysis",
-        "analysis_settings",
-        "doe",
-    ]
     ports = component.get_ports_list(sort_by_name=True)
-    name_to_ports = defaultdict(dict)
     name_to_settings = {}
 
     for port in ports:
-        port_settings = port.to_dict()
-
-        p = port.name.split("-")
-        port_name = p[-1]
-        instance_name = "-".join(p[:-1])
-
-        name_to_ports[instance_name][port_name] = {
-            key: port_settings[key] for key in ["center", "orientation", "port_type"]
-        }
-        name_to_settings[instance_name] = component.info.get("components", {}).get(
-            instance_name, {}
-        )
-
-    for name, d in name_to_settings.items():
-        row = [
-            name,
-            d,
-            name_to_ports[name],
-            d.get("info", {}).get("measurement", None),
-            d.get("info", {}).get("measurement_settings", None),
-            d.get("info", {}).get("analysis", None),
-            d.get("info", {}).get("analysis_settings", None),
-            d.get("info", {}).get("doe", None),
+        try:
+            instance_name = port.info.parent
+        except AttributeError:
+            raise AttributeError(f"port {port.name} has no `parent` in info dict.")
+        name_to_settings[instance_name] = port.info.model_dump()
+
+    if one_setting_per_column:
+        # Gather all unique settings keys
+        all_settings_keys = {key for d in name_to_settings.values() for key in d.keys()}
+        columns = [
+            "cell",
+            "measurement",
+            "measurement_settings",
+            "analysis",
+            "analysis_settings",
+            "doe",
+        ] + list(all_settings_keys)
+
+        for name, d in name_to_settings.items():
+            row = [
+                name,
+                d.get("measurement", None),
+                d.get("measurement_settings", None),
+                d.get("analysis", None),
+                d.get("analysis_settings", None),
+                d.get("doe", None),
+            ] + [d.get(setting, None) for setting in all_settings_keys]
+            rows.append(row)
+
+    else:
+        columns = [
+            "cell",
+            "measurement",
+            "measurement_settings",
+            "analysis",
+            "analysis_settings",
+            "doe",
+            "cell_settings",
         ]
-        rows.append(row)
 
-    return pd.DataFrame(
-        rows,
-        columns=columns,
-    )
+        for name, d in name_to_settings.items():
+            row = [
+                name,
+                d.get("measurement", None),
+                d.get("measurement_settings", None),
+                d.get("analysis", None),
+                d.get("analysis_settings", None),
+                d.get("doe", None),
+                d,
+            ]
+            rows.append(row)
+
+    return pd.DataFrame(rows, columns=columns)
 
 
 if __name__ == "__main__":
-    c = sample_reticle(grid=True)
-    # c = c.mirror()
+    c = sample_reticle(grid=False)
+    c = gf.pack([c])[0]
     c.show(show_ports=False)
-    df = get_test_manifest(c)
-    df.to_csv("test_manifest.csv")
-    print(df["ports"][0])
+    df = get_test_manifest(c, one_setting_per_column=False)
+    df.to_csv("test_manifest.csv", index=False)
     print(df)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/labels/siepic.py` & `gdsfactory-7.9.4/gdsfactory/labels/siepic.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 """SiEPIC labels one grating coupler from the fiber array using a GDS label."""
 
 from __future__ import annotations
 
 from collections.abc import Callable
 
 import gdsfactory as gf
-from gdsfactory.cell import cell
+from gdsfactory.cell import cell_with_child
 from gdsfactory.component import Component
 from gdsfactory.component_layout import Label
 from gdsfactory.components import grating_coupler_te
 from gdsfactory.components.straight import straight
 from gdsfactory.port import Port
 from gdsfactory.typings import (
     ComponentReference,
@@ -42,15 +42,15 @@
         "TE",
         "TM",
     ], f"Not valid polarization {polarization.upper()!r} in [TE, TM]"
     assert (
         isinstance(wavelength, int | float) and 1.0 < wavelength < 2.0
     ), f"{wavelength} is Not valid 1000 < wavelength < 2000"
 
-    name = component_name or port.parent.metadata_child.get("name")
+    name = component_name or port.parent.name
     return f"opt_in_{polarization.upper()}_{int(wavelength * 1000.0)}_device_{username}_({name})-{gc_index}-{port.name}"
 
 
 def get_input_labels(
     io_gratings: list[ComponentReference],
     ordered_ports: list[Port],
     component_name: str,
@@ -84,15 +84,15 @@
         anchor="o",
         layer=layer,
         texttype=texttype,
     )
     return [label]
 
 
-@cell
+@cell_with_child
 def add_fiber_array_siepic(
     component: ComponentSpec = straight,
     component_name: str | None = None,
     gc_port_name: str = "o1",
     get_input_labels_function: Callable = get_input_labels,
     with_loopback: bool = False,
     optical_routing_type: int = 0,
@@ -117,14 +117,15 @@
         fanout_length: None  # if None, automatic calculation of fanout length.
         grating_coupler: grating coupler instance, function or list of functions.
         cross_section: spec.
         layer_label: for label.
 
     """
     c = gf.Component()
+    _component = gf.get_component(component)
 
     component = gf.routing.add_fiber_array(
         component=component,
         component_name=component_name,
         grating_coupler=grating_coupler,
         gc_port_name=gc_port_name,
         get_input_labels_function=get_input_labels_function,
@@ -135,14 +136,14 @@
         fanout_length=fanout_length,
         cross_section=cross_section,
         **kwargs,
     )
     ref = c << component
     ref.rotate(-90)
     c.add_ports(ref.ports)
-    c.copy_child_info(component)
+    c.copy_child_info(_component)
     return c
 
 
 if __name__ == "__main__":
     c = add_fiber_array_siepic()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/labels/write_labels.py` & `gdsfactory-7.9.4/gdsfactory/labels/write_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/labels/write_test_manifest.py` & `gdsfactory-7.9.4/gdsfactory/labels/write_test_manifest.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/name.py` & `gdsfactory-7.9.4/gdsfactory/name.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/pack.py` & `gdsfactory-7.9.4/gdsfactory/pack.py`

 * *Files 3% similar despite different names*

```diff
@@ -200,41 +200,37 @@
 
     components_packed_list = []
     name_counter = Counter()
     index = 0
     for i, rect_dict in enumerate(packed_list):
         name = get_name_short(f"{name_prefix or 'pack'}_{i}")
         packed = Component(name, with_uuid=True)
-        packed.info["components"] = {}
         for n, rect in rect_dict.items():
             x, y, w, h = rect
             xcenter = x + w / 2 + spacing / 2
             ycenter = y + h / 2 + spacing / 2
             component = component_list[n]
             d = component.ref(rotation=rotation, h_mirror=h_mirror, v_mirror=v_mirror)
             packed.add(d)
 
-            if hasattr(component, "settings"):
-                packed.info["components"][component.name] = dict(component.settings)
             d.center = snap_to_grid((xcenter * precision, ycenter * precision))
-
             component_id = component.name if name_ports_with_component_name else index
-
             name_counter[component_id] += 1
 
             if name_counter[component_id] > 1:
                 component_id = f"{component_id}${name_counter[component_id]}"
 
+            info = component.info
+            info["parent"] = component.name
             if add_ports_prefix:
-                packed.add_ports(d.ports, prefix=f"{component_id}-")
+                packed.add_ports(d.ports, prefix=f"{component_id}-", info=info)
             else:
-                packed.add_ports(d.ports, suffix=f"-{component_id}")
+                packed.add_ports(d.ports, suffix=f"-{component_id}", info=info)
 
             index += 1
-
             if text:
                 for text_offset, text_anchor in zip(text_offsets, text_anchors):
                     if text_anchor not in valid_anchors:
                         raise ValueError(
                             f"Invalid anchor {text_anchor} not in {valid_anchors}"
                         )
                     label = packed << text(f"{text_prefix}{index}")
@@ -330,9 +326,10 @@
         text_prefix="R",
         name_prefix="demo",
         text_anchors=["nc"],
         text_offsets=[(-10, 0)],
         text_mirror=True,
         v_mirror=True,
     )
-    c = p[0]
+    # c = p[0]
+    c = pack(p)[0]
     c.show(show_ports=True)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/path.py` & `gdsfactory-7.9.4/gdsfactory/path.py`

 * *Files 0% similar despite different names*

```diff
@@ -907,49 +907,49 @@
         if port_names[0] is not None:
             port_width = width if np.isscalar(width) else width[0]
             port_orientation = (p_sec.start_angle + 180) % 360
             center = points[0]
             face = [points1[0], points2[0]]
             face = [_rotated_delta(point, center, port_orientation) for point in face]
 
-            port1 = c.add_port(
+            c.add_port(
                 port=Port(
                     name=port_names[0],
                     layer=get_layer(layers[0]),
                     port_type=port_types[0],
                     width=port_width,
                     orientation=port_orientation,
                     center=center,
                     cross_section=x,
                     shear_angle=shear_angle_start,
                     enforce_ports_on_grid=enforce_ports_on_grid,
                 )
             )
-            port1.info["face"] = face
+            # port1.info["face"] = face
         if port_names[1] is not None:
             port_width = width if np.isscalar(width) else width[-1]
             port_orientation = (p_sec.end_angle) % 360
             center = points[-1]
             face = [points1[-1], points2[-1]]
             face = [_rotated_delta(point, center, port_orientation) for point in face]
 
-            port2 = c.add_port(
+            c.add_port(
                 port=Port(
                     name=port_names[1],
                     layer=get_layer(layers[1]),
                     port_type=port_types[1],
                     width=port_width,
                     center=center,
                     orientation=port_orientation,
                     cross_section=x,
                     shear_angle=shear_angle_end,
                     enforce_ports_on_grid=enforce_ports_on_grid,
                 )
             )
-            port2.info["face"] = face
+            # port2.info["face"] = face
 
     c.info["length"] = float(np.round(p.length(), 3))
 
     for via in x.components_along_path:
         if via.offset:
             points_offset = p._centerpoint_offset_curve(
                 points,
@@ -1138,47 +1138,47 @@
         if port_names[0] is not None:
             port_width = width1
             port_orientation = (p_sec.start_angle + 180) % 360
             center = points[0]
             face = [points1[0], points2[0]]
             face = [_rotated_delta(point, center, port_orientation) for point in face]
 
-            port1 = c.add_port(
+            c.add_port(
                 port=Port(
                     name=port_names[0],
                     layer=get_layer(layers[0]),
                     port_type=port_types[0],
                     width=port_width,
                     orientation=port_orientation,
                     center=center,
                     cross_section=x1,
                     shear_angle=shear_angle_start,
                 )
             )
-            port1.info["face"] = face
+            # port1.info["face"] = face
         if port_names[1] is not None:
             port_width = width2
             port_orientation = (p_sec.end_angle) % 360
             center = points[-1]
             face = [points1[-1], points2[-1]]
             face = [_rotated_delta(point, center, port_orientation) for point in face]
 
-            port2 = c.add_port(
+            c.add_port(
                 port=Port(
                     name=port_names[1],
                     layer=get_layer(layers[1]),
                     port_type=port_types[1],
                     width=port_width,
                     center=center,
                     orientation=port_orientation,
                     cross_section=x2,
                     shear_angle=shear_angle_end,
                 )
             )
-            port2.info["face"] = face
+            # port2.info["face"] = face
 
     c.info["length"] = float(np.round(p.length(), 3))
     return c
 
 
 def _rotated_delta(
     point: np.ndarray, center: np.ndarray, orientation: float
```

### Comparing `gdsfactory-7.9.3/gdsfactory/pdk.py` & `gdsfactory-7.9.4/gdsfactory/pdk.py`

 * *Files 0% similar despite different names*

```diff
@@ -474,15 +474,18 @@
             kwargs: settings to override component settings.
 
         """
         cells = set(cells.keys())
 
         if isinstance(component, Component):
             if kwargs:
-                raise ValueError(f"Cannot apply kwargs {kwargs} to {component.name!r}")
+                warnings.warn(
+                    f"Cannot apply settings {kwargs} to already created component {component.name!r}."
+                    "Try passing a function instead of a Component."
+                )
             return component
         elif callable(component):
             if validate:
                 return validate_call(component)(**kwargs)
             else:
                 return component(**kwargs)
         elif isinstance(component, str):
@@ -621,15 +624,15 @@
                         "max": extract_args_from_docstring(c.__doc__)
                         .get(sname, {})
                         .get("max", 0),
                         "unit": extract_args_from_docstring(c.__doc__)
                         .get(sname, {})
                         .get("unit", None),
                     }
-                    for sname, svalue in c.settings.full.items()
+                    for sname, svalue in dict(c.settings).items()
                     if isinstance(svalue, str | float | int)
                 },
                 pins={
                     port_name: {
                         "width": port.width,
                         "xsection": port.cross_section.name
                         if port.cross_section
@@ -729,15 +732,15 @@
 
     if _ACTIVE_PDK is None:
         if name is not None or CONF.pdk:
             pdk_module = importlib.import_module(name or CONF.pdk)
             pdk_module.PDK.activate()
 
         else:
-            logger.warning("No active PDK. Activating generic PDK.\n")
+            logger.debug("No active PDK. Activating generic PDK.\n")
             from gdsfactory.generic_tech import get_generic_pdk
 
             PDK = get_generic_pdk()
             PDK.activate()
             _ACTIVE_PDK = PDK
     return _ACTIVE_PDK
```

### Comparing `gdsfactory-7.9.3/gdsfactory/picmodel.py` & `gdsfactory-7.9.4/gdsfactory/picmodel.py`

 * *Files 2% similar despite different names*

```diff
@@ -106,16 +106,16 @@
     placements: dict[str, Placement] | None = None
     routes: dict[str, Route] | None = None
     ports: dict[str, str] | None = None
 
     def add_instance(
         self, name: str, component: gf.Component, placement: Placement | None = None
     ) -> None:
-        component_name = component.settings.function_name
-        component_settings = component.settings.changed
+        component_name = component.function_name
+        component_settings = component.settings
         self.instances[name] = Instance(
             component=component_name, settings=component_settings
         )
         if not placement:
             placement = Placement()
         self.placements[name] = placement
 
@@ -155,16 +155,16 @@
         self,
         name: str,
         component: str | gf.Component,
         placement: Placement | None = None,
         settings: dict[str, Any] | None = None,
     ) -> None:
         if isinstance(component, gf.Component):
-            component_name = component.settings.function_name
-            component_settings = component.settings.changed
+            component_name = component.function_name
+            component_settings = component.settings
             if settings:
                 component_settings = component_settings | settings
             self.instances[name] = Instance(
                 component=component_name, settings=component_settings
             )
         else:
             if not settings:
```

### Comparing `gdsfactory-7.9.3/gdsfactory/pixelate.py` & `gdsfactory-7.9.4/gdsfactory/pixelate.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/polygon.py` & `gdsfactory-7.9.4/gdsfactory/polygon.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/port.py` & `gdsfactory-7.9.4/gdsfactory/port.py`

 * *Files 1% similar despite different names*

```diff
@@ -37,15 +37,15 @@
 from typing import Any, overload
 
 import numpy as np
 from numpy import ndarray
 from omegaconf import OmegaConf
 
 from gdsfactory import snap
-from gdsfactory.component_layout import _rotate_points
+from gdsfactory.component_layout import Info, _rotate_points
 from gdsfactory.config import CONF
 from gdsfactory.cross_section import CrossSectionSpec
 from gdsfactory.serialization import clean_value_json
 from gdsfactory.snap import snap_to_grid
 
 if typing.TYPE_CHECKING:
     from gdsfactory.component import Component
@@ -95,26 +95,27 @@
         width: float | None = None,
         layer: tuple[int, int] | None = None,
         port_type: str = "optical",
         parent: Component | None = None,
         cross_section: CrossSectionSpec | None = None,
         shear_angle: float | None = None,
         enforce_ports_on_grid: bool | None = None,
+        info: Info | None = None,
     ) -> None:
         from gdsfactory.pdk import get_cross_section, get_layer
 
         self.name = name
         if enforce_ports_on_grid is None:
             enforce_ports_on_grid = CONF.enforce_ports_on_grid
 
         center = snap.snap_to_grid(center) if enforce_ports_on_grid else center
         self.center = np.array(center, dtype="float64")
         self.orientation = np.mod(orientation, 360) if orientation else orientation
         self.parent = parent
-        self.info: dict[str, Any] = {}
+        self.info = info or Info()
         self.port_type = port_type
         self.cross_section = cross_section
         self.shear_angle = shear_angle
 
         if cross_section is None and layer is None:
             warnings.warn("You need to define Port cross_section or layer")
 
@@ -307,16 +308,16 @@
             width=self.width,
             orientation=self.orientation,
             parent=self.parent,
             layer=self.layer,
             port_type=self.port_type,
             cross_section=self.cross_section,
             shear_angle=self.shear_angle,
+            info=self.info.model_copy(),
         )
-        new_port.info = self.info
         return new_port
 
     def get_extended_center(self, length: float = 1.0) -> ndarray:
         """Returns an extended port center."""
         angle = np.deg2rad(self.orientation)
         c = np.cos(angle)
         s = np.sin(angle)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/quickplotter.py` & `gdsfactory-7.9.4/gdsfactory/quickplotter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/read/__init__.py` & `gdsfactory-7.9.4/gdsfactory/read/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/read/from_dphox.py` & `gdsfactory-7.9.4/gdsfactory/read/from_dphox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/read/from_gdspaths.py` & `gdsfactory-7.9.4/gdsfactory/read/from_gdspaths.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/read/from_np.py` & `gdsfactory-7.9.4/gdsfactory/read/from_np.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/read/from_phidl.py` & `gdsfactory-7.9.4/gdsfactory/read/from_phidl.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/read/from_updk.py` & `gdsfactory-7.9.4/gdsfactory/read/from_updk.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/read/from_yaml.py` & `gdsfactory-7.9.4/gdsfactory/read/from_yaml.py`

 * *Files 0% similar despite different names*

```diff
@@ -732,15 +732,15 @@
 
     placements_conf = conf.get("placements")
     routes_conf = conf.get("routes")
     ports_conf = conf.get("ports")
     connections_conf = conf.get("connections")
     instances_dict = conf["instances"]
     pdk = conf.get("pdk")
-    c.info = conf.get("info", {})
+    c.info.update(conf.get("info", {}))
 
     if pdk and pdk == "generic":
         GENERIC.activate()
 
     elif pdk:
         module = importlib.import_module(pdk)
         pdk = module.PDK
@@ -968,15 +968,14 @@
                         f" {instance_name!r} "
                     )
                 c.add_port(port_name, port=instance.ports[instance_port_name])
             else:
                 c.add_port(**instance_comma_port)
 
     c.routes = routes
-    c.info["instances"] = list(instances.keys())
     return c
 
 
 sample_pdk = """
 
 pdk: ubcpdk
```

### Comparing `gdsfactory-7.9.3/gdsfactory/read/from_yaml_template.py` & `gdsfactory-7.9.4/gdsfactory/read/from_yaml_template.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/read/import_gds.py` & `gdsfactory-7.9.4/gdsfactory/read/import_gds.py`

 * *Files 6% similar despite different names*

```diff
@@ -2,16 +2,16 @@
 
 from pathlib import Path
 
 import gdstk
 import numpy as np
 from omegaconf import OmegaConf
 
-from gdsfactory.cell import Settings, cell_import_gds
-from gdsfactory.component import Component
+from gdsfactory.cell import cell_import_gds
+from gdsfactory.component import CellSettings, Component, Info
 from gdsfactory.component_reference import ComponentReference
 from gdsfactory.config import logger
 
 
 @cell_import_gds
 def import_gds(
     gdspath: str | Path,
@@ -112,29 +112,38 @@
     if read_metadata and metadata_filepath.exists():
         logger.info(f"Read YAML metadata from {metadata_filepath}")
         metadata = OmegaConf.load(metadata_filepath)
 
         if "settings" in metadata:
             settings = OmegaConf.to_container(metadata.settings)
             if settings:
-                component.settings = Settings(**settings)
+                component.settings = CellSettings(**settings)
+        if "info" in metadata:
+            info = OmegaConf.to_container(metadata.info)
+            if info:
+                component.info = Info(**info)
+        if "function_name" in metadata:
+            component.function_name = metadata.function_name
+        if "module" in metadata:
+            component.module = metadata.module
 
         if "ports" in metadata:
             for port_name, port in metadata.ports.items():
                 if port_name not in component.ports:
                     component.add_port(
                         name=port_name,
                         center=np.array(port.center, dtype="float64"),
                         width=port.width,
                         orientation=port.orientation,
                         layer=tuple(port.layer),
                         port_type=port.port_type,
                     )
 
-    component.info.update(**kwargs)
+    for k, v in kwargs.items():
+        component.info[k] = v
     component.imported_gds = True
     return component
 
 
 def import_gds_raw(gdspath, top_cellname: str | None = None):
     if not top_cellname:
         if gdspath.suffix.lower() == ".gds":
@@ -150,20 +159,21 @@
     c._cell = cells.pop(top_cellname)
     return c
 
 
 if __name__ == "__main__":
     import gdsfactory as gf
 
-    c = gf.Component(name="a" * 250)
-    _ = c << gf.components.mzi()
-    gdspath = c.write_gds("a.gds")
+    # c = gf.Component(name="a" * 250)
+    # _ = c << gf.components.mzi()
+    c = gf.c.straight()
+    gdspath = c.write_gds("a.gds", with_metadata=True)
 
     # c = import_gds(gdspath)
-    c = import_gds("a.gds")
+    c = import_gds("a.gds", read_metadata=True)
     c.show(show_ports=False)
 
     # gdspath = PATH.gdsdir / "mzi2x2.gds"
     # c = import_gds(gdspath, flatten=True, name="TOP")
     # c.settings = {}
     # print(clean_value_name(c))
     # c = import_gds(gdspath, flatten=False, polarization="te")
```

### Comparing `gdsfactory-7.9.3/gdsfactory/read/labels.py` & `gdsfactory-7.9.4/gdsfactory/read/labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/__init__.py` & `gdsfactory-7.9.4/gdsfactory/routing/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/add_electrical_pads_shortest.py` & `gdsfactory-7.9.4/gdsfactory/routing/add_electrical_pads_shortest.py`

 * *Files 0% similar despite different names*

```diff
@@ -52,15 +52,15 @@
     ports = (
         [ref[port_name] for port_name in port_names]
         if port_names
         else select_ports(ref.ports)
     )
     ports = list(ports.values())
 
-    pad_port_spacing += pad.metadata_child["full"]["size"][0] / 2
+    pad_port_spacing += pad.info["xsize"] / 2
 
     for i, port in enumerate(ports):
         p = c << pad
 
         if port_orientation == 0:
             p.x = port.x + pad_port_spacing
             p.y = port.y
```

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/add_electrical_pads_top.py` & `gdsfactory-7.9.4/gdsfactory/routing/add_electrical_pads_top.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/add_electrical_pads_top_dc.py` & `gdsfactory-7.9.4/gdsfactory/routing/add_electrical_pads_top_dc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/add_fiber_array.py` & `gdsfactory-7.9.4/gdsfactory/routing/add_fiber_array.py`

 * *Files 1% similar despite different names*

```diff
@@ -112,17 +112,15 @@
             f"(orientation = 180). "
             f"Got orientation = {orientation} degrees for port {gc_port_name!r}"
         )
 
     if gc_port_name not in gc.ports:
         raise ValueError(f"gc_port_name={gc_port_name!r} not in {gc.ports.keys()}")
 
-    component_name = component_name or component.metadata_child.get(
-        "name", component.name
-    )
+    component_name = component_name or component.name
     component_new = Component()
     component_new.component = component
 
     optical_ports = select_ports(component.ports)
     optical_ports_names = list(optical_ports.keys())
     if not optical_ports:
         raise ValueError(f"No optical ports found in {component.name!r}")
@@ -176,15 +174,14 @@
         )
 
     if ports_loopback:
         component_new.add_port("loopback1", port=ports_loopback[0])
         component_new.add_port("loopback2", port=ports_loopback[1])
 
     component_new.copy_child_info(component)
-    component_new.info["grating_coupler"] = gc.info
     return component_new
 
 
 def demo_te_and_tm():
     c = gf.Component()
     w = gf.components.straight()
     wte = add_fiber_array(
```

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/add_fiber_single.py` & `gdsfactory-7.9.4/gdsfactory/routing/add_fiber_single.py`

 * *Files 2% similar despite different names*

```diff
@@ -108,21 +108,22 @@
             component=c,
             optical_routing_type=0,
             grating_coupler=gf.components.grating_coupler_elliptical_te,
         )
         cc.plot()
 
     """
-    component = gf.get_component(component)
+    component_original = component = gf.get_component(component)
 
     optical_ports = select_ports(component.ports)
     optical_ports = list(optical_ports.values())
     optical_port_names = [p.name for p in optical_ports]
 
     zero_port = zero_port or optical_port_names[0]
+    component_name = component_name or component.name
 
     if not optical_ports:
         raise ValueError(f"No optical ports found in {component.name!r}")
 
     if zero_port not in optical_port_names:
         raise ValueError(f"zero_port = {zero_port!r} not in {optical_port_names}")
 
@@ -131,18 +132,14 @@
     optical_ports = select_ports(component.ports)
     optical_ports = list(optical_ports.values())
     optical_port_names = [p.name for p in optical_ports]
 
     if not optical_ports:
         raise ValueError(f"No ports for {component.name}")
 
-    component_name = component_name or component.metadata_child.get(
-        "name", component.name
-    )
-
     gc = (
         grating_coupler[0]
         if isinstance(grating_coupler, list | tuple)
         else grating_coupler
     )
     gc = gf.get_component(gc)
 
@@ -271,27 +268,26 @@
             c.add_label(
                 text=text,
                 position=port.center,
                 anchor="o",
                 layer=layer_label,
             )
 
-    c.copy_child_info(component)
-    c.info["grating_coupler"] = gc.info
+    c.copy_child_info(component_original)
     return c
 
 
 if __name__ == "__main__":
     # from gdsfactory.samples.big_device import big_device
     # w = h = 18 * 50
     # c = big_device(spacing=50.0, size=(w, h))
     # gc = gf.functions.rotate90(gf.components.grating_coupler_elliptical_arbitrary)
 
     gc = gf.components.grating_coupler_elliptical_arbitrary
-    c = gf.c.mmi2x2()
+    c = gf.c.bend_euler()
     cc = gf.routing.add_fiber_single(
         component=c,
         grating_coupler=gc,
         # layer_label="TEXT"
         # layer_label=None,
     )
     cc.show(show_ports=False)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/add_pads.py` & `gdsfactory-7.9.4/gdsfactory/routing/add_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/all_angle.py` & `gdsfactory-7.9.4/gdsfactory/routing/all_angle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/auto_taper.py` & `gdsfactory-7.9.4/gdsfactory/routing/auto_taper.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/factories.py` & `gdsfactory-7.9.4/gdsfactory/routing/factories.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/fanout.py` & `gdsfactory-7.9.4/gdsfactory/routing/fanout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/fanout2x2.py` & `gdsfactory-7.9.4/gdsfactory/routing/fanout2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_bundle.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_bundle.py`

 * *Files 0% similar despite different names*

```diff
@@ -157,16 +157,15 @@
         else:
             separation = gf.get_component(straight).ysize * 2
 
     if isinstance(cross_section, list | tuple):
         xs_list = []
         for element in cross_section:
             xs, angles = element
-            xs = gf.get_cross_section(xs)
-            xs = xs.copy(**kwargs)  # Shallow copy
+            xs = gf.get_cross_section(xs, **kwargs)
             xs_list.append((xs, angles))
         cross_section = xs_list
 
     elif cross_section:
         cross_section = gf.get_cross_section(cross_section)
         cross_section = cross_section.copy(**kwargs)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_bundle_corner.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_bundle_corner.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_bundle_from_steps.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_bundle_from_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_bundle_from_waypoints.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_bundle_from_waypoints.py`

 * *Files 0% similar despite different names*

```diff
@@ -126,22 +126,20 @@
         Got {len(ports1)} {len(ports2)}"
         )
 
     if isinstance(cross_section, list | tuple):
         xs_list = []
         for element in cross_section:
             xs, angles = element
-            xs = gf.get_cross_section(xs)
-            xs = xs.copy(**kwargs)  # Shallow copy
+            xs = gf.get_cross_section(xs, **kwargs)
             xs_list.append((xs, angles))
         cross_section = xs_list
 
     else:
-        cross_section = gf.get_cross_section(cross_section)
-        xs = cross_section = cross_section.copy(**kwargs)
+        xs = cross_section = gf.get_cross_section(cross_section, **kwargs)
 
     waypoints = [ports1[0].center] + list(waypoints) + [ports2[0].center]
     for p in ports1:
         if np.subtract(waypoints[1], waypoints[0])[0] > 0:
             if p.orientation is None:
                 p.orientation = 0
         elif np.subtract(waypoints[1], waypoints[0])[0] < 0:
```

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_bundle_path_length_match.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_bundle_path_length_match.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_bundle_sbend.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_bundle_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_bundle_u.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_bundle_u.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_input_labels.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_input_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_route.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_route.py`

 * *Files 2% similar despite different names*

```diff
@@ -106,22 +106,20 @@
         c.plot()
 
     """
     if isinstance(cross_section, list | tuple):
         xs_list = []
         for element in cross_section:
             xs, angles = element
-            xs = gf.get_cross_section(xs)
-            xs = xs.copy(**kwargs)  # Shallow copy
+            xs = gf.get_cross_section(xs, **kwargs)
             xs_list.append((xs, angles))
         cross_section = xs_list
 
     elif cross_section:
-        cross_section = gf.get_cross_section(cross_section)
-        x = cross_section = cross_section.copy(**kwargs)
+        x = cross_section = gf.get_cross_section(cross_section, **kwargs)
 
     else:
         x = cross_section = None
 
     if cross_section:
         bend90 = (
             bend
```

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_route_astar.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_route_astar.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_route_from_steps.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_route_from_steps.py`

 * *Files 2% similar despite different names*

```diff
@@ -103,29 +103,28 @@
     waypoints = np.array(waypoints)
 
     if isinstance(cross_section, list | tuple):
         xs_list = []
         for element in cross_section:
             xs, angles = element
             xs = gf.get_cross_section(xs)
-            xs = xs.copy(**kwargs)  # Shallow copy
+            xs = gf.get_cross_section(xs, **kwargs)
             xs_list.append((xs, angles))
         cross_section = xs_list
 
     else:
-        cross_section = gf.get_cross_section(cross_section)
-        x = cross_section = cross_section.copy(**kwargs)
-        auto_widen = x.auto_widen
+        xs = cross_section = gf.get_cross_section(cross_section, **kwargs)
+        auto_widen = cross_section.auto_widen
 
         if auto_widen:
             taper = gf.get_component(
                 taper,
-                length=x.taper_length,
-                width1=x.width,
-                width2=x.width_wide,
+                length=xs.taper_length,
+                width1=xs.width,
+                width2=xs.width_wide,
                 cross_section=cross_section,
                 **kwargs,
             )
         else:
             taper = None
 
     return round_corners(
```

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_route_sbend.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_route_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_routes_bend180.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_routes_bend180.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/get_routes_straight.py` & `gdsfactory-7.9.4/gdsfactory/routing/get_routes_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/manhattan.py` & `gdsfactory-7.9.4/gdsfactory/routing/manhattan.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/path_length_matching.py` & `gdsfactory-7.9.4/gdsfactory/routing/path_length_matching.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/route_fiber_array.py` & `gdsfactory-7.9.4/gdsfactory/routing/route_fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/route_fiber_single.py` & `gdsfactory-7.9.4/gdsfactory/routing/route_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/route_ports_to_side.py` & `gdsfactory-7.9.4/gdsfactory/routing/route_ports_to_side.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/route_quad.py` & `gdsfactory-7.9.4/gdsfactory/routing/route_quad.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/route_sharp.py` & `gdsfactory-7.9.4/gdsfactory/routing/route_sharp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/route_south.py` & `gdsfactory-7.9.4/gdsfactory/routing/route_south.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/sort_ports.py` & `gdsfactory-7.9.4/gdsfactory/routing/sort_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/utils.py` & `gdsfactory-7.9.4/gdsfactory/routing/utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/routing/validation.py` & `gdsfactory-7.9.4/gdsfactory/routing/validation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/01_component_pcell.py` & `gdsfactory-7.9.4/gdsfactory/samples/01_component_pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/01_component_pcell_with_pins.py` & `gdsfactory-7.9.4/gdsfactory/samples/01_component_pcell_with_pins.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/03_move.py` & `gdsfactory-7.9.4/gdsfactory/samples/03_move.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/04_connect.py` & `gdsfactory-7.9.4/gdsfactory/samples/04_connect.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/05_remove_layers.py` & `gdsfactory-7.9.4/gdsfactory/samples/05_remove_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/06_remapping_layers.py` & `gdsfactory-7.9.4/gdsfactory/samples/06_remapping_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/07_flattening_device.py` & `gdsfactory-7.9.4/gdsfactory/samples/07_flattening_device.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/11_component_layout.py` & `gdsfactory-7.9.4/gdsfactory/samples/11_component_layout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/12_component_refs.py` & `gdsfactory-7.9.4/gdsfactory/samples/12_component_refs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/13_component_netlist.py` & `gdsfactory-7.9.4/gdsfactory/samples/13_component_netlist.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/14_component_connectivity.py` & `gdsfactory-7.9.4/gdsfactory/samples/14_component_connectivity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/15_component_sequence1.py` & `gdsfactory-7.9.4/gdsfactory/samples/15_component_sequence1.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/16_component_sequence2.py` & `gdsfactory-7.9.4/gdsfactory/samples/16_component_sequence2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/17_ports.py` & `gdsfactory-7.9.4/gdsfactory/samples/17_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/20_components.py` & `gdsfactory-7.9.4/gdsfactory/samples/20_components.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/21_add_fiber_array.py` & `gdsfactory-7.9.4/gdsfactory/samples/21_add_fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/22_add_fiber_single.py` & `gdsfactory-7.9.4/gdsfactory/samples/22_add_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/22_add_pads.py` & `gdsfactory-7.9.4/gdsfactory/samples/22_add_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/24_doe_2.py` & `gdsfactory-7.9.4/gdsfactory/samples/24_doe_2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/24_doe_3.py` & `gdsfactory-7.9.4/gdsfactory/samples/24_doe_3.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/30_lidar.py` & `gdsfactory-7.9.4/gdsfactory/samples/30_lidar.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/30_lidar_pcell.py` & `gdsfactory-7.9.4/gdsfactory/samples/30_lidar_pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/30_lidar_with_pads.py` & `gdsfactory-7.9.4/gdsfactory/samples/30_lidar_with_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/40_routing_add_pads.py` & `gdsfactory-7.9.4/gdsfactory/samples/40_routing_add_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing.py` & `gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/big_device.py` & `gdsfactory-7.9.4/gdsfactory/samples/big_device.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/demo/benchmark/fill_demo.py` & `gdsfactory-7.9.4/gdsfactory/samples/demo/benchmark/fill_demo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/demo/circuits/mask.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/demo/circuits/mask.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/demo/circuits/pads.pic.yml` & `gdsfactory-7.9.4/gdsfactory/samples/demo/circuits/pads.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/demo/drc_errors.py` & `gdsfactory-7.9.4/gdsfactory/samples/demo/drc_errors.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/demo/lvs.py` & `gdsfactory-7.9.4/gdsfactory/samples/demo/lvs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/demo/pcell.py` & `gdsfactory-7.9.4/gdsfactory/samples/demo/pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/fixme/manhattan.py` & `gdsfactory-7.9.4/gdsfactory/samples/fixme/manhattan.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/images/logo.png` & `gdsfactory-7.9.4/gdsfactory/samples/images/logo.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/netlists/mzi.yml` & `gdsfactory-7.9.4/gdsfactory/samples/netlists/mzi.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/netlists/mzi_full.yml` & `gdsfactory-7.9.4/gdsfactory/samples/netlists/mzi_full.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/fab_c.py` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/fab_c.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/fab_d/phase_shifters.py` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/fab_d/phase_shifters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c.py` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml`

 * *Files 14% similar despite different names*

```diff
@@ -1,7 +1,20 @@
+function_name: bend_euler
+info:
+  dy: 10.0
+  length: 16.637
+  radius: 10.0
+  radius_min: 7.061
+  route_info_length: 16.637
+  route_info_n_bend_90: 1.0
+  route_info_type: xs_7c0f28d3
+  route_info_weight: 16.637
+  route_info_xs_7c0f28d3_length: 16.637
+  width: 1.0
+module: gdsfactory.components.bend_euler
 name: bend_euler_1da7fd5c
 ports:
   o1:
     center:
     - 0.0
     - 0.0
     layer:
@@ -21,124 +34,55 @@
     - 0
     name: o2
     orientation: 90.0
     port_type: optical
     shear_angle: null
     width: 1.0
 settings:
-  changed:
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 1.0
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-  child: null
-  default:
-    add_bbox: null
-    add_pins: true
-    angle: 90.0
-    cross_section: xs_sc
-    direction: ccw
-    layer: null
-    npoints: null
-    p: 0.5
-    radius: null
-    width: null
-    with_arc_floorplan: true
-  full:
-    add_bbox: null
-    add_pins: true
-    angle: 90.0
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 1.0
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-    direction: ccw
-    layer: null
-    npoints: null
-    p: 0.5
-    radius: null
-    width: null
-    with_arc_floorplan: true
-  function_name: bend_euler
-  info:
-    dy: 10.0
-    length: 16.637
+  add_bbox: null
+  add_pins: true
+  angle: 90.0
+  cross_section:
+    add_pins_function_module: gdsfactory.samples.pdk.fab_c
+    add_pins_function_name: add_pins
+    auto_widen: false
+    auto_widen_minimum_length: 200.0
+    bbox_layers:
+    - - 36
+      - 0
+    bbox_offsets:
+    - 3.0
+    components_along_path: []
+    end_straight_length: 0.01
+    gap: 3.0
+    info: {}
+    min_length: 0.01
     radius: 10.0
-    radius_min: 7.061
-    route_info:
-      length: 16.637
-      n_bend_90: 1.0
-      type: xs_7c0f28d3
-      weight: 16.637
-      xs_7c0f28d3_length: 16.637
-    width: 1.0
-  info_version: 2
-  module: gdsfactory.components.bend_euler
-  name: bend_euler_1da7fd5c
+    radius_min: 5.0
+    sections:
+    - hidden: false
+      insets: null
+      layer:
+      - 34
+      - 0
+      name: _default
+      offset: 0.0
+      offset_function: null
+      port_names:
+      - o1
+      - o2
+      port_types:
+      - optical
+      - optical
+      simplify: null
+      width: 1.0
+      width_function: null
+    start_straight_length: 0.01
+    taper_length: 10.0
+    width_wide: null
+  direction: ccw
+  layer: null
+  npoints: null
+  p: 0.5
+  radius: null
+  width: null
+  with_arc_floorplan: true
```

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml`

 * *Files 25% similar despite different names*

```diff
@@ -1,145 +1,215 @@
-name: grating_coupler_elliptical_9bc42286
+function_name: mzi
+info: {}
+module: gdsfactory.components.mzi
+name: mzi_949cd0a2
 ports:
   o1:
     center:
-    - 0.0
+    - -10.0
     - 0.0
     layer:
     - 34
     - 0
     name: o1
-    orientation: 180
+    orientation: 180.0
     port_type: optical
     shear_angle: null
     width: 1.0
-  opt_te_1554_15:
+  o2:
     center:
-    - 16.6
+    - 87.12
     - 0.0
     layer:
     - 34
     - 0
-    name: opt_te_1554_15
-    orientation: 0
+    name: o2
+    orientation: 0.0
     port_type: optical
     shear_angle: null
-    width: 10
+    width: 1.0
 settings:
-  changed:
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 1.0
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-    grating_line_width: 0.6
-    layer_slab: null
-  child: null
-  default:
-    big_last_tooth: false
-    cross_section: xs_sc
-    fiber_angle: 15.0
-    grating_line_width: 0.343
-    layer_slab: SLAB150
-    n_periods: 30
-    nclad: 1.443
-    neff: 2.638
-    polarization: te
-    slab_offset: 2.0
-    slab_xmin: -1.0
-    spiked: true
-    taper_angle: 40.0
-    taper_length: 16.6
-    wavelength: 1.554
-  full:
-    big_last_tooth: false
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 1.0
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-    fiber_angle: 15.0
-    grating_line_width: 0.6
-    layer_slab: null
-    n_periods: 30
-    nclad: 1.443
-    neff: 2.638
-    polarization: te
-    slab_offset: 2.0
-    slab_xmin: -1.0
-    spiked: true
-    taper_angle: 40.0
-    taper_length: 16.6
-    wavelength: 1.554
-  function_name: grating_coupler_elliptical
-  info:
-    polarization: te
-    wavelength: 1.554
-  info_version: 2
-  module: gdsfactory.components.grating_coupler_elliptical
-  name: grating_coupler_elliptical_9bc42286
+  add_electrical_ports_bot: true
+  add_optical_ports_arms: false
+  bend:
+    function: bend_euler
+    module: gdsfactory.components.bend_euler
+    settings:
+      cross_section:
+        add_pins_function_module: gdsfactory.samples.pdk.fab_c
+        add_pins_function_name: add_pins
+        auto_widen: false
+        auto_widen_minimum_length: 200.0
+        bbox_layers:
+        - - 36
+          - 0
+        bbox_offsets:
+        - 3.0
+        components_along_path: []
+        end_straight_length: 0.01
+        gap: 3.0
+        info: {}
+        min_length: 0.01
+        radius: 10.0
+        radius_min: 5.0
+        sections:
+        - hidden: false
+          insets: null
+          layer:
+          - 34
+          - 0
+          name: _default
+          offset: 0.0
+          offset_function: null
+          port_names:
+          - o1
+          - o2
+          port_types:
+          - optical
+          - optical
+          simplify: null
+          width: 1.0
+          width_function: null
+        start_straight_length: 0.01
+        taper_length: 10.0
+        width_wide: null
+  combiner: null
+  cross_section:
+    add_pins_function_module: gdsfactory.samples.pdk.fab_c
+    add_pins_function_name: add_pins
+    auto_widen: false
+    auto_widen_minimum_length: 200.0
+    bbox_layers:
+    - - 36
+      - 0
+    bbox_offsets:
+    - 3.0
+    components_along_path: []
+    end_straight_length: 0.01
+    gap: 3.0
+    info: {}
+    min_length: 0.01
+    radius: 10.0
+    radius_min: 5.0
+    sections:
+    - hidden: false
+      insets: null
+      layer:
+      - 34
+      - 0
+      name: _default
+      offset: 0.0
+      offset_function: null
+      port_names:
+      - o1
+      - o2
+      port_types:
+      - optical
+      - optical
+      simplify: null
+      width: 1.0
+      width_function: null
+    start_straight_length: 0.01
+    taper_length: 10.0
+    width_wide: null
+  cross_section_x_bot: null
+  cross_section_x_top: null
+  delta_length: 10.0
+  extend_ports_straight_x: null
+  length_x: 0.1
+  length_y: 2.0
+  mirror_bot: false
+  nbends: 2
+  port_e0_combiner: o3
+  port_e0_splitter: o3
+  port_e1_combiner: o2
+  port_e1_splitter: o2
+  splitter:
+    function: mmi1x2
+    module: gdsfactory.components.mmi1x2
+    settings:
+      cross_section:
+        add_pins_function_module: gdsfactory.samples.pdk.fab_c
+        add_pins_function_name: add_pins
+        auto_widen: false
+        auto_widen_minimum_length: 200.0
+        bbox_layers:
+        - - 36
+          - 0
+        bbox_offsets:
+        - 3.0
+        components_along_path: []
+        end_straight_length: 0.01
+        gap: 3.0
+        info: {}
+        min_length: 0.01
+        radius: 10.0
+        radius_min: 5.0
+        sections:
+        - hidden: false
+          insets: null
+          layer:
+          - 34
+          - 0
+          name: _default
+          offset: 0.0
+          offset_function: null
+          port_names:
+          - o1
+          - o2
+          port_types:
+          - optical
+          - optical
+          simplify: null
+          width: 1.0
+          width_function: null
+        start_straight_length: 0.01
+        taper_length: 10.0
+        width_wide: null
+      width: 1.0
+      width_mmi: 3
+  straight:
+    function: straight
+    module: gdsfactory.components.straight
+    settings:
+      cross_section:
+        add_pins_function_module: gdsfactory.samples.pdk.fab_c
+        add_pins_function_name: add_pins
+        auto_widen: false
+        auto_widen_minimum_length: 200.0
+        bbox_layers:
+        - - 36
+          - 0
+        bbox_offsets:
+        - 3.0
+        components_along_path: []
+        end_straight_length: 0.01
+        gap: 3.0
+        info: {}
+        min_length: 0.01
+        radius: 10.0
+        radius_min: 5.0
+        sections:
+        - hidden: false
+          insets: null
+          layer:
+          - 34
+          - 0
+          name: _default
+          offset: 0.0
+          offset_function: null
+          port_names:
+          - o1
+          - o2
+          port_types:
+          - optical
+          - optical
+          simplify: null
+          width: 1.0
+          width_function: null
+        start_straight_length: 0.01
+        taper_length: 10.0
+        width_wide: null
+  straight_x_bot: null
+  straight_x_top: null
+  straight_y: null
+  with_splitter: true
```

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml`

 * *Files 15% similar despite different names*

```diff
@@ -1,7 +1,10 @@
+function_name: mmi1x2
+info: {}
+module: gdsfactory.components.mmi1x2
 name: mmi1x2_44e6dc12
 ports:
   o1:
     center:
     - -10.0
     - 0.0
     layer:
@@ -33,117 +36,56 @@
     - 0
     name: o3
     orientation: 0.0
     port_type: optical
     shear_angle: null
     width: 1.0
 settings:
-  changed:
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 1.0
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-    width: 1.0
-    width_mmi: 3
-  child: null
-  default:
-    cross_section: xs_sc
-    gap_mmi: 0.25
-    length_mmi: 5.5
-    length_taper: 10.0
-    straight:
-      function: straight
-    taper:
-      function: taper
-    width: null
-    width_mmi: 2.5
-    width_taper: 1.0
-    with_bbox: true
-  full:
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 1.0
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-    gap_mmi: 0.25
-    length_mmi: 5.5
-    length_taper: 10.0
-    straight:
-      function: straight
-    taper:
-      function: taper
-    width: 1.0
-    width_mmi: 3
-    width_taper: 1.0
-    with_bbox: true
-  function_name: mmi1x2
-  info: {}
-  info_version: 2
-  module: gdsfactory.components.mmi1x2
-  name: mmi1x2_44e6dc12
+  cross_section:
+    add_pins_function_module: gdsfactory.samples.pdk.fab_c
+    add_pins_function_name: add_pins
+    auto_widen: false
+    auto_widen_minimum_length: 200.0
+    bbox_layers:
+    - - 36
+      - 0
+    bbox_offsets:
+    - 3.0
+    components_along_path: []
+    end_straight_length: 0.01
+    gap: 3.0
+    info: {}
+    min_length: 0.01
+    radius: 10.0
+    radius_min: 5.0
+    sections:
+    - hidden: false
+      insets: null
+      layer:
+      - 34
+      - 0
+      name: _default
+      offset: 0.0
+      offset_function: null
+      port_names:
+      - o1
+      - o2
+      port_types:
+      - optical
+      - optical
+      simplify: null
+      width: 1.0
+      width_function: null
+    start_straight_length: 0.01
+    taper_length: 10.0
+    width_wide: null
+  gap_mmi: 0.25
+  length_mmi: 5.5
+  length_taper: 10.0
+  straight:
+    function: straight
+  taper:
+    function: taper
+  width: 1.0
+  width_mmi: 3
+  width_taper: 1.0
+  with_bbox: true
```

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml`

 * *Files 21% similar despite different names*

```diff
@@ -1,7 +1,10 @@
+function_name: mmi1x2
+info: {}
+module: gdsfactory.components.mmi1x2
 name: mmi1x2_294813a8
 ports:
   o1:
     center:
     - -10.0
     - 0.0
     layer:
@@ -33,116 +36,56 @@
     - 0
     name: o3
     orientation: 0.0
     port_type: optical
     shear_angle: null
     width: 0.9
 settings:
-  changed:
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 0.9
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-    width: 0.9
-  child: null
-  default:
-    cross_section: xs_sc
-    gap_mmi: 0.25
-    length_mmi: 5.5
-    length_taper: 10.0
-    straight:
-      function: straight
-    taper:
-      function: taper
-    width: null
-    width_mmi: 2.5
-    width_taper: 1.0
-    with_bbox: true
-  full:
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 0.9
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-    gap_mmi: 0.25
-    length_mmi: 5.5
-    length_taper: 10.0
-    straight:
-      function: straight
-    taper:
-      function: taper
-    width: 0.9
-    width_mmi: 2.5
-    width_taper: 1.0
-    with_bbox: true
-  function_name: mmi1x2
-  info: {}
-  info_version: 2
-  module: gdsfactory.components.mmi1x2
-  name: mmi1x2_294813a8
+  cross_section:
+    add_pins_function_module: gdsfactory.samples.pdk.fab_c
+    add_pins_function_name: add_pins
+    auto_widen: false
+    auto_widen_minimum_length: 200.0
+    bbox_layers:
+    - - 36
+      - 0
+    bbox_offsets:
+    - 3.0
+    components_along_path: []
+    end_straight_length: 0.01
+    gap: 3.0
+    info: {}
+    min_length: 0.01
+    radius: 10.0
+    radius_min: 5.0
+    sections:
+    - hidden: false
+      insets: null
+      layer:
+      - 34
+      - 0
+      name: _default
+      offset: 0.0
+      offset_function: null
+      port_names:
+      - o1
+      - o2
+      port_types:
+      - optical
+      - optical
+      simplify: null
+      width: 0.9
+      width_function: null
+    start_straight_length: 0.01
+    taper_length: 10.0
+    width_wide: null
+  gap_mmi: 0.25
+  length_mmi: 5.5
+  length_taper: 10.0
+  straight:
+    function: straight
+  taper:
+    function: taper
+  width: 0.9
+  width_mmi: 2.5
+  width_taper: 1.0
+  with_bbox: true
```

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml`

 * *Files 24% similar despite different names*

```diff
@@ -1,8 +1,11 @@
-name: mzi_3bf7917f
+function_name: mzi
+info: {}
+module: gdsfactory.components.mzi
+name: mzi_3936406a
 ports:
   o1:
     center:
     - -10.0
     - 0.0
     layer:
     - 34
@@ -21,384 +24,191 @@
     - 0
     name: o2
     orientation: 0.0
     port_type: optical
     shear_angle: null
     width: 0.9
 settings:
-  changed:
-    bend:
-      function: bend_euler
-      settings:
-        cross_section:
-          add_pins_function_module: gdsfactory.samples.pdk.fab_c
-          add_pins_function_name: add_pins
-          auto_widen: false
-          auto_widen_minimum_length: 200.0
-          bbox_layers:
-          - - 36
-            - 0
-          bbox_offsets:
-          - 3.0
-          components_along_path: []
-          end_straight_length: 0.01
-          gap: 3.0
-          info: {}
-          min_length: 0.01
-          radius: 10.0
-          radius_min: 5.0
-          sections:
-          - hidden: false
-            insets: null
-            layer:
-            - 34
-            - 0
-            name: _default
-            offset: 0.0
-            offset_function: null
-            port_names:
-            - o1
-            - o2
-            port_types:
-            - optical
-            - optical
-            simplify: null
-            width: 0.9
-            width_function: null
-          start_straight_length: 0.01
-          taper_length: 10.0
-          width_wide: null
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 0.9
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-    splitter:
-      function: mmi1x2
-      settings:
-        cross_section:
-          add_pins_function_module: gdsfactory.samples.pdk.fab_c
-          add_pins_function_name: add_pins
-          auto_widen: false
-          auto_widen_minimum_length: 200.0
-          bbox_layers:
-          - - 36
-            - 0
-          bbox_offsets:
-          - 3.0
-          components_along_path: []
-          end_straight_length: 0.01
-          gap: 3.0
-          info: {}
-          min_length: 0.01
-          radius: 10.0
-          radius_min: 5.0
-          sections:
-          - hidden: false
-            insets: null
-            layer:
-            - 34
-            - 0
-            name: _default
-            offset: 0.0
-            offset_function: null
-            port_names:
-            - o1
-            - o2
-            port_types:
-            - optical
-            - optical
-            simplify: null
-            width: 0.9
-            width_function: null
-          start_straight_length: 0.01
-          taper_length: 10.0
-          width_wide: null
-        width: 0.9
-    straight:
-      function: straight
-      settings:
-        cross_section:
-          add_pins_function_module: gdsfactory.samples.pdk.fab_c
-          add_pins_function_name: add_pins
-          auto_widen: false
-          auto_widen_minimum_length: 200.0
-          bbox_layers:
-          - - 36
-            - 0
-          bbox_offsets:
-          - 3.0
-          components_along_path: []
-          end_straight_length: 0.01
-          gap: 3.0
-          info: {}
-          min_length: 0.01
-          radius: 10.0
-          radius_min: 5.0
-          sections:
-          - hidden: false
-            insets: null
-            layer:
-            - 34
-            - 0
-            name: _default
-            offset: 0.0
-            offset_function: null
-            port_names:
-            - o1
-            - o2
-            port_types:
-            - optical
-            - optical
-            simplify: null
-            width: 0.9
-            width_function: null
-          start_straight_length: 0.01
-          taper_length: 10.0
-          width_wide: null
-  child: null
-  default:
-    add_electrical_ports_bot: true
-    add_optical_ports_arms: false
-    bend:
-      function: bend_euler
-    combiner: null
-    cross_section: xs_sc
-    cross_section_x_bot: null
-    cross_section_x_top: null
-    delta_length: 10.0
-    extend_ports_straight_x: null
-    length_x: 0.1
-    length_y: 2.0
-    mirror_bot: false
-    nbends: 2
-    port_e0_combiner: o3
-    port_e0_splitter: o3
-    port_e1_combiner: o2
-    port_e1_splitter: o2
-    splitter: mmi1x2
-    straight:
-      function: straight
-    straight_x_bot: null
-    straight_x_top: null
-    straight_y: null
-    with_splitter: true
-  full:
-    add_electrical_ports_bot: true
-    add_optical_ports_arms: false
-    bend:
-      function: bend_euler
-      settings:
-        cross_section:
-          add_pins_function_module: gdsfactory.samples.pdk.fab_c
-          add_pins_function_name: add_pins
-          auto_widen: false
-          auto_widen_minimum_length: 200.0
-          bbox_layers:
-          - - 36
-            - 0
-          bbox_offsets:
-          - 3.0
-          components_along_path: []
-          end_straight_length: 0.01
-          gap: 3.0
-          info: {}
-          min_length: 0.01
-          radius: 10.0
-          radius_min: 5.0
-          sections:
-          - hidden: false
-            insets: null
-            layer:
-            - 34
-            - 0
-            name: _default
-            offset: 0.0
-            offset_function: null
-            port_names:
-            - o1
-            - o2
-            port_types:
-            - optical
-            - optical
-            simplify: null
-            width: 0.9
-            width_function: null
-          start_straight_length: 0.01
-          taper_length: 10.0
-          width_wide: null
-    combiner: null
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 0.9
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-    cross_section_x_bot: null
-    cross_section_x_top: null
-    delta_length: 10.0
-    extend_ports_straight_x: null
-    length_x: 0.1
-    length_y: 2.0
-    mirror_bot: false
-    nbends: 2
-    port_e0_combiner: o3
-    port_e0_splitter: o3
-    port_e1_combiner: o2
-    port_e1_splitter: o2
-    splitter:
-      function: mmi1x2
-      settings:
-        cross_section:
-          add_pins_function_module: gdsfactory.samples.pdk.fab_c
-          add_pins_function_name: add_pins
-          auto_widen: false
-          auto_widen_minimum_length: 200.0
-          bbox_layers:
-          - - 36
-            - 0
-          bbox_offsets:
-          - 3.0
-          components_along_path: []
-          end_straight_length: 0.01
-          gap: 3.0
-          info: {}
-          min_length: 0.01
-          radius: 10.0
-          radius_min: 5.0
-          sections:
-          - hidden: false
-            insets: null
-            layer:
-            - 34
-            - 0
-            name: _default
-            offset: 0.0
-            offset_function: null
-            port_names:
-            - o1
-            - o2
-            port_types:
-            - optical
-            - optical
-            simplify: null
-            width: 0.9
-            width_function: null
-          start_straight_length: 0.01
-          taper_length: 10.0
-          width_wide: null
-        width: 0.9
-    straight:
-      function: straight
-      settings:
-        cross_section:
-          add_pins_function_module: gdsfactory.samples.pdk.fab_c
-          add_pins_function_name: add_pins
-          auto_widen: false
-          auto_widen_minimum_length: 200.0
-          bbox_layers:
-          - - 36
-            - 0
-          bbox_offsets:
-          - 3.0
-          components_along_path: []
-          end_straight_length: 0.01
-          gap: 3.0
-          info: {}
-          min_length: 0.01
-          radius: 10.0
-          radius_min: 5.0
-          sections:
-          - hidden: false
-            insets: null
-            layer:
-            - 34
-            - 0
-            name: _default
-            offset: 0.0
-            offset_function: null
-            port_names:
-            - o1
-            - o2
-            port_types:
-            - optical
-            - optical
-            simplify: null
-            width: 0.9
-            width_function: null
-          start_straight_length: 0.01
-          taper_length: 10.0
-          width_wide: null
-    straight_x_bot: null
-    straight_x_top: null
-    straight_y: null
-    with_splitter: true
-  function_name: mzi
-  info: {}
-  info_version: 2
-  module: gdsfactory.components.mzi
-  name: mzi_3bf7917f
+  add_electrical_ports_bot: true
+  add_optical_ports_arms: false
+  bend:
+    function: bend_euler
+    module: gdsfactory.components.bend_euler
+    settings:
+      cross_section:
+        add_pins_function_module: gdsfactory.samples.pdk.fab_c
+        add_pins_function_name: add_pins
+        auto_widen: false
+        auto_widen_minimum_length: 200.0
+        bbox_layers:
+        - - 36
+          - 0
+        bbox_offsets:
+        - 3.0
+        components_along_path: []
+        end_straight_length: 0.01
+        gap: 3.0
+        info: {}
+        min_length: 0.01
+        radius: 10.0
+        radius_min: 5.0
+        sections:
+        - hidden: false
+          insets: null
+          layer:
+          - 34
+          - 0
+          name: _default
+          offset: 0.0
+          offset_function: null
+          port_names:
+          - o1
+          - o2
+          port_types:
+          - optical
+          - optical
+          simplify: null
+          width: 0.9
+          width_function: null
+        start_straight_length: 0.01
+        taper_length: 10.0
+        width_wide: null
+  combiner: null
+  cross_section:
+    add_pins_function_module: gdsfactory.samples.pdk.fab_c
+    add_pins_function_name: add_pins
+    auto_widen: false
+    auto_widen_minimum_length: 200.0
+    bbox_layers:
+    - - 36
+      - 0
+    bbox_offsets:
+    - 3.0
+    components_along_path: []
+    end_straight_length: 0.01
+    gap: 3.0
+    info: {}
+    min_length: 0.01
+    radius: 10.0
+    radius_min: 5.0
+    sections:
+    - hidden: false
+      insets: null
+      layer:
+      - 34
+      - 0
+      name: _default
+      offset: 0.0
+      offset_function: null
+      port_names:
+      - o1
+      - o2
+      port_types:
+      - optical
+      - optical
+      simplify: null
+      width: 0.9
+      width_function: null
+    start_straight_length: 0.01
+    taper_length: 10.0
+    width_wide: null
+  cross_section_x_bot: null
+  cross_section_x_top: null
+  delta_length: 10.0
+  extend_ports_straight_x: null
+  length_x: 0.1
+  length_y: 2.0
+  mirror_bot: false
+  nbends: 2
+  port_e0_combiner: o3
+  port_e0_splitter: o3
+  port_e1_combiner: o2
+  port_e1_splitter: o2
+  splitter:
+    function: mmi1x2
+    module: gdsfactory.components.mmi1x2
+    settings:
+      cross_section:
+        add_pins_function_module: gdsfactory.samples.pdk.fab_c
+        add_pins_function_name: add_pins
+        auto_widen: false
+        auto_widen_minimum_length: 200.0
+        bbox_layers:
+        - - 36
+          - 0
+        bbox_offsets:
+        - 3.0
+        components_along_path: []
+        end_straight_length: 0.01
+        gap: 3.0
+        info: {}
+        min_length: 0.01
+        radius: 10.0
+        radius_min: 5.0
+        sections:
+        - hidden: false
+          insets: null
+          layer:
+          - 34
+          - 0
+          name: _default
+          offset: 0.0
+          offset_function: null
+          port_names:
+          - o1
+          - o2
+          port_types:
+          - optical
+          - optical
+          simplify: null
+          width: 0.9
+          width_function: null
+        start_straight_length: 0.01
+        taper_length: 10.0
+        width_wide: null
+      width: 0.9
+  straight:
+    function: straight
+    module: gdsfactory.components.straight
+    settings:
+      cross_section:
+        add_pins_function_module: gdsfactory.samples.pdk.fab_c
+        add_pins_function_name: add_pins
+        auto_widen: false
+        auto_widen_minimum_length: 200.0
+        bbox_layers:
+        - - 36
+          - 0
+        bbox_offsets:
+        - 3.0
+        components_along_path: []
+        end_straight_length: 0.01
+        gap: 3.0
+        info: {}
+        min_length: 0.01
+        radius: 10.0
+        radius_min: 5.0
+        sections:
+        - hidden: false
+          insets: null
+          layer:
+          - 34
+          - 0
+          name: _default
+          offset: 0.0
+          offset_function: null
+          port_names:
+          - o1
+          - o2
+          port_types:
+          - optical
+          - optical
+          simplify: null
+          width: 0.9
+          width_function: null
+        start_straight_length: 0.01
+        taper_length: 10.0
+        width_wide: null
+  straight_x_bot: null
+  straight_x_top: null
+  straight_y: null
+  with_splitter: true
```

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml` & `gdsfactory-7.9.4/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml`

 * *Files 23% similar despite different names*

```diff
@@ -1,7 +1,16 @@
+function_name: straight
+info:
+  length: 10.0
+  route_info_length: 10.0
+  route_info_type: xs_7c0f28d3
+  route_info_weight: 10.0
+  route_info_xs_7c0f28d3_length: 10.0
+  width: 1.0
+module: gdsfactory.components.straight
 name: straight_1da7fd5c
 ports:
   o1:
     center:
     - 0.0
     - 0.0
     layer:
@@ -21,150 +30,51 @@
     - 0
     name: o2
     orientation: 0.0
     port_type: optical
     shear_angle: null
     width: 1.0
 settings:
-  changed:
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 1.0
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-  child: null
-  default:
-    add_bbox: null
-    add_pins: true
-    cross_section: xs_sc
-    layer: null
-    length: 10.0
-    npoints: 2
-    width: null
-  full:
-    add_bbox: null
-    add_pins: true
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 1.0
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-    layer: null
-    length: 10.0
-    npoints: 2
-    width: null
-  function_name: straight
-  info:
-    cross_section:
-      add_pins_function_module: gdsfactory.samples.pdk.fab_c
-      add_pins_function_name: add_pins
-      auto_widen: false
-      auto_widen_minimum_length: 200.0
-      bbox_layers:
-      - - 36
-        - 0
-      bbox_offsets:
-      - 3.0
-      components_along_path: []
-      end_straight_length: 0.01
-      gap: 3.0
-      info: {}
-      min_length: 0.01
-      radius: 10.0
-      radius_min: 5.0
-      sections:
-      - hidden: false
-        insets: null
-        layer:
-        - 34
-        - 0
-        name: _default
-        offset: 0.0
-        offset_function: null
-        port_names:
-        - o1
-        - o2
-        port_types:
-        - optical
-        - optical
-        simplify: null
-        width: 1.0
-        width_function: null
-      start_straight_length: 0.01
-      taper_length: 10.0
-      width_wide: null
-    length: 10.0
-    route_info:
-      length: 10.0
-      type: xs_7c0f28d3
-      weight: 10.0
-      xs_7c0f28d3_length: 10.0
-    width: 1.0
-  info_version: 2
-  module: gdsfactory.components.straight
-  name: straight_1da7fd5c
+  add_bbox: null
+  add_pins: true
+  cross_section:
+    add_pins_function_module: gdsfactory.samples.pdk.fab_c
+    add_pins_function_name: add_pins
+    auto_widen: false
+    auto_widen_minimum_length: 200.0
+    bbox_layers:
+    - - 36
+      - 0
+    bbox_offsets:
+    - 3.0
+    components_along_path: []
+    end_straight_length: 0.01
+    gap: 3.0
+    info: {}
+    min_length: 0.01
+    radius: 10.0
+    radius_min: 5.0
+    sections:
+    - hidden: false
+      insets: null
+      layer:
+      - 34
+      - 0
+      name: _default
+      offset: 0.0
+      offset_function: null
+      port_names:
+      - o1
+      - o2
+      port_types:
+      - optical
+      - optical
+      simplify: null
+      width: 1.0
+      width_function: null
+    start_straight_length: 0.01
+    taper_length: 10.0
+    width_wide: null
+  layer: null
+  length: 10.0
+  npoints: 2
+  width: null
```

### Comparing `gdsfactory-7.9.3/gdsfactory/samples/sample_reticle.py` & `gdsfactory-7.9.4/gdsfactory/samples/sample_reticle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/serialization.py` & `gdsfactory-7.9.4/gdsfactory/serialization.py`

 * *Files 15% similar despite different names*

```diff
@@ -63,15 +63,15 @@
         return complex_encoder(value)
 
     elif isinstance(value, np.ndarray):
         value = np.round(value, DEFAULT_SERIALIZATION_MAX_DIGITS)
         return orjson.loads(orjson.dumps(value, option=orjson.OPT_SERIALIZE_NUMPY))
 
     elif callable(value) and isinstance(value, functools.partial):
-        return clean_value_partial(value, include_module=False)
+        return clean_value_partial(value, include_module=True)
     elif hasattr(value, "to_dict"):
         return clean_dict(value.to_dict())
 
     elif callable(value) and isinstance(value, toolz.functoolz.Compose):
         return [clean_value_json(value.first)] + [
             clean_value_json(func) for func in value.funcs
         ]
@@ -104,15 +104,15 @@
             )
             return orjson.loads(value_json)
         except TypeError as e:
             print(f"Error serializing {value!r}")
             raise e
 
 
-def clean_value_partial(value, include_module):
+def clean_value_partial(value, include_module: bool = True):
     sig = inspect.signature(value.func)
     args_as_kwargs = dict(zip(sig.parameters.keys(), value.args))
     args_as_kwargs |= value.keywords
     args_as_kwargs = clean_dict(args_as_kwargs)
 
     func = value.func
     while hasattr(func, "func"):
@@ -122,38 +122,72 @@
         "settings": args_as_kwargs,
     }
     if include_module:
         v.update(module=func.__module__)
     return v
 
 
+def clean_value_partial_all(value, include_module: bool = True):
+    """Does not work with cell magic decorator and info."""
+    # Retrieve the function signature
+    sig = inspect.signature(value.func)
+
+    # Merge default values from the signature with the provided arguments
+    bound_args = sig.bind_partial(*value.args, **value.keywords)
+    bound_args.apply_defaults()
+
+    # Clean and prepare the arguments dictionary
+    args_as_kwargs = dict(bound_args.arguments)
+    args_as_kwargs = clean_dict(
+        args_as_kwargs
+    )  # Assuming 'clean_dict' is defined elsewhere
+
+    # Access the underlying function if wrapped
+    func = value.func
+    while hasattr(func, "func"):
+        func = func.func
+
+    v = {
+        "function": func.__name__,
+        "settings": args_as_kwargs,
+    }
+    if include_module:
+        v.update(module=func.__module__)
+
+    return v
+
+
 def clean_value_name(value: Any) -> str:
     """Returns a string representation of an object."""
     # value1 = clean_value_json(value)
     return str(clean_value_json(value))
 
 
 def get_hash(value: Any) -> str:
     return hashlib.md5((clean_value_name(value)).encode()).hexdigest()[:8]
 
 
 if __name__ == "__main__":
+    from functools import partial
+
     import gdsfactory as gf
 
-    # f = partial(gf.c.straight, length=3)
-    # d = clean_value_json(f)
+    f = partial(gf.c.straight, length=3)
+    d = clean_value_json(f)
+    print(d)
+
     # print(f"{d!r}")
     # f = partial(gf.c.straight, length=3)
     # c = f()
     # d = clean_value_json(c)
     # print(d, d)
 
     # xs = partial(
     #     gf.cross_section.strip,
     #     width=3,
     #     add_pins=gf.partial(gf.add_pins.add_pins_inside1nm, pin_length=0.1),
     # )
     # f = partial(gf.routing.add_fiber_array, cross_section=xs)
     # c = f()
-    c = gf.cross_section.strip(width=3)
-    d = clean_value_json(c)
-    print(get_hash(d))
+    # c = gf.cross_section.strip(width=3)
+    # d = clean_value_json(c)
+    # print(get_hash(d))
```

### Comparing `gdsfactory-7.9.3/gdsfactory/show.py` & `gdsfactory-7.9.4/gdsfactory/show.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/simulation/__init__.py` & `gdsfactory-7.9.4/gdsfactory/simulation/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/snap.py` & `gdsfactory-7.9.4/gdsfactory/snap.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/symbols.py` & `gdsfactory-7.9.4/gdsfactory/symbols.py`

 * *Files 1% similar despite different names*

```diff
@@ -94,26 +94,26 @@
     bbox.move((0, 0), destination=component.bbox[0])
 
     # add text, fit to box with specified margin
     margin = 0.2
     max_w, max_h = w * (1 - margin), h * (1 - margin)
     text_init_size = 3.0
     text_init = text(
-        component.settings.function_name,
+        component.function_name,
         size=text_init_size,
         layer=(2, 0),
         justify="center",
     )
     w_text, h_text = text_init.size
     w_scaling = max_w / w_text
     h_scaling = max_h / h_text
     scaling = min(w_scaling, h_scaling)
     text_size = text_init_size * scaling
     text_component = text(
-        component.settings.function_name, size=text_size, layer=(2, 0), justify="center"
+        component.function_name, size=text_size, layer=(2, 0), justify="center"
     )
 
     text = sym << text_component
     text.move(text.center, destination=bbox.center)
 
     # add ports
     sym.add_ports(component.ports)
```

### Comparing `gdsfactory-7.9.3/gdsfactory/technology/klayout_tech.py` & `gdsfactory-7.9.4/gdsfactory/technology/klayout_tech.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/technology/layer_map.py` & `gdsfactory-7.9.4/gdsfactory/technology/layer_map.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/technology/layer_stack.py` & `gdsfactory-7.9.4/gdsfactory/technology/layer_stack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/technology/layer_views.py` & `gdsfactory-7.9.4/gdsfactory/technology/layer_views.py`

 * *Files 0% similar despite different names*

```diff
@@ -778,20 +778,20 @@
             filepath: can be YAML or LYP.
             layer_map: Optional layermap.
         """
         if filepath is not None:
             filepath = pathlib.Path(filepath)
             if filepath.suffix == ".lyp":
                 lvs = LayerViews.from_lyp(filepath=filepath)
-                logger.info(
+                logger.debug(
                     f"Importing LayerViews from KLayout layer properties file: {str(filepath)!r}."
                 )
             elif filepath.suffix in {".yaml", ".yml"}:
                 lvs = LayerViews.from_yaml(layer_file=filepath)
-                logger.info(f"Importing LayerViews from YAML file: {str(filepath)!r}.")
+                logger.debug(f"Importing LayerViews from YAML file: {str(filepath)!r}.")
             else:
                 raise ValueError(f"Unable to load LayerViews from {str(filepath)!r}.")
 
             data["layer_views"] = lvs.layer_views
             data["custom_line_styles"] = lvs.custom_line_styles
             data["custom_dither_patterns"] = lvs.custom_dither_patterns
```

### Comparing `gdsfactory-7.9.3/gdsfactory/technology/processes.py` & `gdsfactory-7.9.4/gdsfactory/technology/processes.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/technology/read_from_layers_info.py` & `gdsfactory-7.9.4/gdsfactory/technology/read_from_layers_info.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/technology/xml_utils.py` & `gdsfactory-7.9.4/gdsfactory/technology/xml_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/technology/yaml_utils.py` & `gdsfactory-7.9.4/gdsfactory/technology/yaml_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/typings.py` & `gdsfactory-7.9.4/gdsfactory/typings.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/watch.py` & `gdsfactory-7.9.4/gdsfactory/watch.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/gdsfactory/write_cells.py` & `gdsfactory-7.9.4/gdsfactory/write_cells.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.9.3/pyproject.toml` & `gdsfactory-7.9.4/pyproject.toml`

 * *Files 2% similar despite different names*

```diff
@@ -37,15 +37,15 @@
 ]
 description = "python library to generate GDS layouts"
 keywords = ["eda", "photonics", "python"]
 license = {file = "LICENSE"}
 name = "gdsfactory"
 readme = "README.md"
 requires-python = ">=3.10"
-version = "7.9.3"
+version = "7.9.4"
 
 [project.optional-dependencies]
 cad = [
   "freetype-py",
   "ipycytoscape",
   "ipyevents",
   "ipykernel",
@@ -193,15 +193,15 @@
 [[tool.tbump.file]]
 src = "pyproject.toml"
 
 [[tool.tbump.file]]
 src = "gdsfactory/config.py"
 
 [[tool.tbump.file]]
-src = "docs/notebooks/08_pdk.py"
+src = "notebooks/08_pdk.ipynb"
 
 [[tool.tbump.file]]
 src = "gdsfactory/generic_tech/klayout/grain.xml"
 
 [[tool.tbump.file]]
 src = "gdsfactory/generic_tech/klayout/pymacros/set_menus.lym"
 
@@ -209,15 +209,15 @@
 src = ".devcontainer/Dockerfile"
 
 [tool.tbump.git]
 message_template = "Bump to {new_version}"
 tag_template = "v{new_version}"
 
 [tool.tbump.version]
-current = "7.9.3"
+current = "7.9.4"
 regex = '''
   (?P<major>\d+)
   \.
   (?P<minor>\d+)
   \.
   (?P<patch>\d+)
   '''
```

### Comparing `gdsfactory-7.9.3/PKG-INFO` & `gdsfactory-7.9.4/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: gdsfactory
-Version: 7.9.3
+Version: 7.9.4
 Summary: python library to generate GDS layouts
 Keywords: eda,photonics,python
 Author-email: gdsfactory community <contact@gdsfactory.com>
 Requires-Python: >=3.10
 Description-Content-Type: text/markdown
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Programming Language :: Python :: 3.11
@@ -70,15 +70,15 @@
 Requires-Dist: towncrier ; extra == "maintainer"
 Provides-Extra: cad
 Provides-Extra: dev
 Provides-Extra: docs
 Provides-Extra: full
 Provides-Extra: maintainer
 
-# gdsfactory 7.9.3
+# gdsfactory 7.9.4
 
 [![docs](https://github.com/gdsfactory/gdsfactory/actions/workflows/pages.yml/badge.svg)](https://gdsfactory.github.io/gdsfactory/)
 [![PyPI](https://img.shields.io/pypi/v/gdsfactory)](https://pypi.org/project/gdsfactory/)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/gdsfactory.svg)](https://anaconda.org/conda-forge/gdsfactory)
 [![Dockerhub](https://img.shields.io/docker/pulls/joamatab/gdsfactory)](https://hub.docker.com/r/joamatab/gdsfactory)
 [![PyPI Python](https://img.shields.io/pypi/pyversions/gdsfactory.svg)](https://pypi.python.org/pypi/gdsfactory)
 [![Downloads](https://static.pepy.tech/badge/gdsfactory)](https://pepy.tech/project/gdsfactory)
```

