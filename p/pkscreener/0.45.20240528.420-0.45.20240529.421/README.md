# Comparing `tmp/pkscreener-0.45.20240528.420.tar.gz` & `tmp/pkscreener-0.45.20240529.421.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "pkscreener-0.45.20240528.420.tar", last modified: Tue May 28 09:36:44 2024, max compression
+gzip compressed data, was "pkscreener-0.45.20240529.421.tar", last modified: Wed May 29 01:57:16 2024, max compression
```

## Comparing `pkscreener-0.45.20240528.420.tar` & `pkscreener-0.45.20240529.421.tar`

### file list

```diff
@@ -1,50 +1,50 @@
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-28 09:36:44.146202 pkscreener-0.45.20240528.420/
--rw-r--r--   0 runner    (1001) docker     (127)     1065 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/LICENSE
--rw-r--r--   0 runner    (1001) docker     (127)     1070 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/LICENSE-Others
--rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-05-28 09:36:44.146202 pkscreener-0.45.20240528.420/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)    26594 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/README.md
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-28 09:36:44.142202 pkscreener-0.45.20240528.420/pkscreener/
--rw-r--r--   0 runner    (1001) docker     (127)     1547 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-28 09:36:44.146202 pkscreener-0.45.20240528.420/pkscreener/classes/
--rw-r--r--   0 runner    (1001) docker     (127)    13194 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/ArtTexts.py
--rw-r--r--   0 runner    (1001) docker     (127)     9908 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/Backtest.py
--rw-r--r--   0 runner    (1001) docker     (127)     5537 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/Barometer.py
--rw-r--r--   0 runner    (1001) docker     (127)    16986 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/CandlePatterns.py
--rw-r--r--   0 runner    (1001) docker     (127)     1494 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/Changelog.py
--rw-r--r--   0 runner    (1001) docker     (127)    33678 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/ConfigManager.py
--rw-r--r--   0 runner    (1001) docker     (127)    10050 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/Fetcher.py
--rw-r--r--   0 runner    (1001) docker     (127)    13402 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/MarketMonitor.py
--rw-r--r--   0 runner    (1001) docker     (127)     3591 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/MarketStatus.py
--rw-r--r--   0 runner    (1001) docker     (127)    47096 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/MenuOptions.py
--rw-r--r--   0 runner    (1001) docker     (127)    12232 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/OtaUpdater.py
--rw-r--r--   0 runner    (1001) docker     (127)    24198 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/PKMarketOpenCloseAnalyser.py
--rw-r--r--   0 runner    (1001) docker     (127)    22357 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/PKScanRunner.py
--rw-r--r--   0 runner    (1001) docker     (127)     1588 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/PKScheduledTaskProgress.py
--rw-r--r--   0 runner    (1001) docker     (127)     8143 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/PKScheduler.py
--rw-r--r--   0 runner    (1001) docker     (127)     8298 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/PKSpreadsheets.py
--rw-r--r--   0 runner    (1001) docker     (127)     1867 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/PKTask.py
--rw-r--r--   0 runner    (1001) docker     (127)    19048 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/Pktalib.py
--rw-r--r--   0 runner    (1001) docker     (127)    13876 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/Portfolio.py
--rw-r--r--   0 runner    (1001) docker     (127)    47779 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/PortfolioXRay.py
--rw-r--r--   0 runner    (1001) docker     (127)   158334 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/ScreeningStatistics.py
--rw-r--r--   0 runner    (1001) docker     (127)    56970 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/StockScreener.py
--rw-r--r--   0 runner    (1001) docker     (127)     4885 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/UserMenuChoicesHandler.py
--rw-r--r--   0 runner    (1001) docker     (127)    85524 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/Utility.py
--rw-r--r--   0 runner    (1001) docker     (127)     3923 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/WorkflowManager.py
--rw-r--r--   0 runner    (1001) docker     (127)       28 2024-05-28 09:36:37.000000 pkscreener-0.45.20240528.420/pkscreener/classes/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     5122 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/classes/keys.py
--rw-r--r--   0 runner    (1001) docker     (127)   791436 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/courbd.ttf
--rw-r--r--   0 runner    (1001) docker     (127)   145709 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/globals.py
--rw-r--r--   0 runner    (1001) docker     (127)     1083 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/pkscreener.ini
--rw-r--r--   0 runner    (1001) docker     (127)    53805 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/pkscreenerbot.py
--rw-r--r--   0 runner    (1001) docker     (127)    33987 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/pkscreener/pkscreenercli.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-28 09:36:44.142202 pkscreener-0.45.20240528.420/pkscreener.egg-info/
--rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-05-28 09:36:44.000000 pkscreener-0.45.20240528.420/pkscreener.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)     1382 2024-05-28 09:36:44.000000 pkscreener-0.45.20240528.420/pkscreener.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-05-28 09:36:44.000000 pkscreener-0.45.20240528.420/pkscreener.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (127)      120 2024-05-28 09:36:44.000000 pkscreener-0.45.20240528.420/pkscreener.egg-info/entry_points.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-05-28 09:36:44.000000 pkscreener-0.45.20240528.420/pkscreener.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (127)      329 2024-05-28 09:36:44.000000 pkscreener-0.45.20240528.420/pkscreener.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (127)       11 2024-05-28 09:36:44.000000 pkscreener-0.45.20240528.420/pkscreener.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (127)       79 2024-05-28 09:36:44.150202 pkscreener-0.45.20240528.420/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (127)     5567 2024-05-28 09:35:12.000000 pkscreener-0.45.20240528.420/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-29 01:57:16.285523 pkscreener-0.45.20240529.421/
+-rw-r--r--   0 runner    (1001) docker     (127)     1065 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (127)     1070 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/LICENSE-Others
+-rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-05-29 01:57:16.285523 pkscreener-0.45.20240529.421/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)    26594 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/README.md
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-29 01:57:16.277523 pkscreener-0.45.20240529.421/pkscreener/
+-rw-r--r--   0 runner    (1001) docker     (127)     1547 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-29 01:57:16.285523 pkscreener-0.45.20240529.421/pkscreener/classes/
+-rw-r--r--   0 runner    (1001) docker     (127)    13194 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/ArtTexts.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9908 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/Backtest.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5537 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/Barometer.py
+-rw-r--r--   0 runner    (1001) docker     (127)    16986 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/CandlePatterns.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1494 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/Changelog.py
+-rw-r--r--   0 runner    (1001) docker     (127)    34329 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/ConfigManager.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10050 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/Fetcher.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13402 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/MarketMonitor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3591 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/MarketStatus.py
+-rw-r--r--   0 runner    (1001) docker     (127)    47096 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/MenuOptions.py
+-rw-r--r--   0 runner    (1001) docker     (127)    12232 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/OtaUpdater.py
+-rw-r--r--   0 runner    (1001) docker     (127)    24198 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/PKMarketOpenCloseAnalyser.py
+-rw-r--r--   0 runner    (1001) docker     (127)    22357 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/PKScanRunner.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1588 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/PKScheduledTaskProgress.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8143 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/PKScheduler.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8298 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/PKSpreadsheets.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1867 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/PKTask.py
+-rw-r--r--   0 runner    (1001) docker     (127)    19048 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/Pktalib.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13876 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/Portfolio.py
+-rw-r--r--   0 runner    (1001) docker     (127)    47779 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/PortfolioXRay.py
+-rw-r--r--   0 runner    (1001) docker     (127)   159848 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/ScreeningStatistics.py
+-rw-r--r--   0 runner    (1001) docker     (127)    56970 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/StockScreener.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4885 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/UserMenuChoicesHandler.py
+-rw-r--r--   0 runner    (1001) docker     (127)    85524 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/Utility.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3946 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/WorkflowManager.py
+-rw-r--r--   0 runner    (1001) docker     (127)       28 2024-05-29 01:57:09.000000 pkscreener-0.45.20240529.421/pkscreener/classes/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5122 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/classes/keys.py
+-rw-r--r--   0 runner    (1001) docker     (127)   791436 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/courbd.ttf
+-rw-r--r--   0 runner    (1001) docker     (127)   146715 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/globals.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1115 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/pkscreener.ini
+-rw-r--r--   0 runner    (1001) docker     (127)    60746 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/pkscreenerbot.py
+-rw-r--r--   0 runner    (1001) docker     (127)    34702 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/pkscreener/pkscreenercli.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-29 01:57:16.281523 pkscreener-0.45.20240529.421/pkscreener.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-05-29 01:57:16.000000 pkscreener-0.45.20240529.421/pkscreener.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)     1382 2024-05-29 01:57:16.000000 pkscreener-0.45.20240529.421/pkscreener.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-05-29 01:57:16.000000 pkscreener-0.45.20240529.421/pkscreener.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (127)      120 2024-05-29 01:57:16.000000 pkscreener-0.45.20240529.421/pkscreener.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-05-29 01:57:16.000000 pkscreener-0.45.20240529.421/pkscreener.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (127)      338 2024-05-29 01:57:16.000000 pkscreener-0.45.20240529.421/pkscreener.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (127)       11 2024-05-29 01:57:16.000000 pkscreener-0.45.20240529.421/pkscreener.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (127)       79 2024-05-29 01:57:16.285523 pkscreener-0.45.20240529.421/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (127)     5567 2024-05-29 01:55:03.000000 pkscreener-0.45.20240529.421/setup.py
```

### Comparing `pkscreener-0.45.20240528.420/LICENSE` & `pkscreener-0.45.20240529.421/LICENSE`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/LICENSE-Others` & `pkscreener-0.45.20240529.421/LICENSE-Others`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/PKG-INFO` & `pkscreener-0.45.20240529.421/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 Metadata-Version: 2.1
 Name: pkscreener
-Version: 0.45.20240528.420
+Version: 0.45.20240529.421
 Summary: A Python-based stock screener for NSE, India with alerts to Telegram Channel (pkscreener)
 Home-page: https://github.com/pkjmesra/pkscreener
-Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240528.420.zip
+Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240529.421.zip
 Author: pkjmesra
 Author-email: pkjmesra@gmail.com
 License: OSI Approved (MIT)
 Keywords: NSE,Technical Indicators,Scanning,Stock Scanners
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: Microsoft :: Windows
 Classifier: Operating System :: MacOS
@@ -274,19 +274,19 @@
 * Always backtest and analyze the stocks manually before you trade.
 * The Author(s), the software and any related/unrelated entity will not be held liable for your own investing decisions or losses. The authors or this softfware does not make any claim about the correctness of the results.
 * This screener began as a [fork](https://github.com/pranjal-joshi/Screeni-py) but has since added a lot of additional scanners, backtesting, Telegram bots, Alerts and a number of modifications and improvements.
 
 [MADE-IN-INDIA-badge]: https://img.shields.io/badge/MADE%20WITH%20%E2%9D%A4%20IN-INDIA-orange
 [MADE-IN-INDIA]: https://en.wikipedia.org/wiki/India
 [Windows-badge]: https://img.shields.io/badge/Windows-0078D6?logo=windows&logoColor=white
-[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240527.419/pkscreenercli.exe
+[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240528.420/pkscreenercli.exe
 [Linux-badge]: https://img.shields.io/badge/Linux-FCC624?logo=linux&logoColor=black
-[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240527.419/pkscreenercli.bin
+[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240528.420/pkscreenercli.bin
 [Mac OS-badge]: https://img.shields.io/badge/mac%20os-D3D3D3?logo=apple&logoColor=000000
-[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240527.419/pkscreenercli.run
+[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240528.420/pkscreenercli.run
 [GitHub release (latest by date)-badge]: https://img.shields.io/github/v/release/pkjmesra/PKScreener
 [GitHub release (latest by date)]: https://github.com/pkjmesra/PKScreener/releases/latest
 [pypi-badge]: https://img.shields.io/pypi/v/pkscreener.svg?style=flat-square
 [pypi]: https://pypi.python.org/pypi/pkscreener
 [wheel-badge]: https://img.shields.io/pypi/wheel/pkscreener.svg?style=flat-square
 [GitHub all releases]: https://img.shields.io/github/downloads/pkjmesra/PKScreener/total?color=Green&label=Downloads&style=for-the-badge
 [License-badge]: https://img.shields.io/github/license/pkjmesra/PKScreener?style=for-the-badge
```

### Comparing `pkscreener-0.45.20240528.420/README.md` & `pkscreener-0.45.20240529.421/README.md`

 * *Files 1% similar despite different names*

```diff
@@ -252,19 +252,19 @@
 * Always backtest and analyze the stocks manually before you trade.
 * The Author(s), the software and any related/unrelated entity will not be held liable for your own investing decisions or losses. The authors or this softfware does not make any claim about the correctness of the results.
 * This screener began as a [fork](https://github.com/pranjal-joshi/Screeni-py) but has since added a lot of additional scanners, backtesting, Telegram bots, Alerts and a number of modifications and improvements.
 
 [MADE-IN-INDIA-badge]: https://img.shields.io/badge/MADE%20WITH%20%E2%9D%A4%20IN-INDIA-orange
 [MADE-IN-INDIA]: https://en.wikipedia.org/wiki/India
 [Windows-badge]: https://img.shields.io/badge/Windows-0078D6?logo=windows&logoColor=white
-[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240527.419/pkscreenercli.exe
+[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240528.420/pkscreenercli.exe
 [Linux-badge]: https://img.shields.io/badge/Linux-FCC624?logo=linux&logoColor=black
-[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240527.419/pkscreenercli.bin
+[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240528.420/pkscreenercli.bin
 [Mac OS-badge]: https://img.shields.io/badge/mac%20os-D3D3D3?logo=apple&logoColor=000000
-[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240527.419/pkscreenercli.run
+[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240528.420/pkscreenercli.run
 [GitHub release (latest by date)-badge]: https://img.shields.io/github/v/release/pkjmesra/PKScreener
 [GitHub release (latest by date)]: https://github.com/pkjmesra/PKScreener/releases/latest
 [pypi-badge]: https://img.shields.io/pypi/v/pkscreener.svg?style=flat-square
 [pypi]: https://pypi.python.org/pypi/pkscreener
 [wheel-badge]: https://img.shields.io/pypi/wheel/pkscreener.svg?style=flat-square
 [GitHub all releases]: https://img.shields.io/github/downloads/pkjmesra/PKScreener/total?color=Green&label=Downloads&style=for-the-badge
 [License-badge]: https://img.shields.io/github/license/pkjmesra/PKScreener?style=for-the-badge
```

### Comparing `pkscreener-0.45.20240528.420/pkscreener/__init__.py` & `pkscreener-0.45.20240529.421/pkscreener/__init__.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/ArtTexts.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/ArtTexts.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/Backtest.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/Backtest.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/Barometer.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/Barometer.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/CandlePatterns.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/CandlePatterns.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/Changelog.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/Changelog.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/ConfigManager.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/ConfigManager.py`

 * *Files 4% similar despite different names*

```diff
@@ -72,14 +72,15 @@
         self.atrTrailingStopSensitivity = 1
         self.atrTrailingStopPeriod = 10
         self.atrTrailingStopEMAPeriod = 200
         # This determines how many days apart the backtest calculations are run.
         # For example, for weekly backtest calculations, set this to 5 (5 days = 1 week)
         # For fortnightly, set this to 10 and so on (10 trading sessions = 2 weeks)
         self.backtestPeriodFactor = 1
+        self.vcpVolumeContractionRatio = 0.4
         self.maxDashboardWidgetsPerRow = 7
         self.maxNumResultRowsInMonitor = 3
         self.calculatersiintraday = False
         self.defaultMonitorOptions = "X:12:9:2.5~X:12:23~X:12:28~X:12:31~|{1}X:0:23:>|X:0:27:>|X:0:31:~|{2}X:0:31:~|{3}X:0:27:~X:12:7:3:.01:1~|{5}X:0:5:0:35:~X:12:7:6:1~X:12:11:~X:12:12:i 5m~X:12:17~X:12:24~X:12:6:7:1~X:12:6:3~X:12:6:8~X:12:6:9~X:12:2:>|X:12:7:8:>|X:12:7:9:1:1:~X:12:6:10:1~X:12:7:3:.02:1~X:12:13:i 1m~X:12:2~|{1}X:0:29:"
         self.minimumChangePercentage = 0
         self.daysToLookback = 22 * self.backtestPeriodFactor  # 1 month
         self.periods = [1,2,3,4,5,10,15,22,30]
@@ -167,14 +168,15 @@
             parser.set("config", "morninganalysiscandleduration", self.morninganalysiscandleduration)
             parser.set("config", "onlyStageTwoStocks", "y" if self.stageTwo else "n")
             parser.set("config", "period", self.period)
             parser.set("config", "showPastStrategyData", "y" if self.showPastStrategyData else "n")
             parser.set("config", "showunknowntrends", "y" if self.showunknowntrends else "n")
             parser.set("config", "shuffle", "y" if self.shuffleEnabled else "n")
             parser.set("config", "useEMA", "y" if self.useEMA else "n")
+            parser.set("config", "vcpVolumeContractionRatio", str(self.vcpVolumeContractionRatio))
 
             parser.set("filters", "consolidationPercentage", str(self.consolidationPercentage))
             parser.set("filters", "maxPrice", str(self.maxLTP))
             parser.set("filters", "minimumChangePercentage", str(self.minimumChangePercentage))
             parser.set("filters", "minimumVolume", str(self.minVolume))
             parser.set("filters", "minPrice", str(self.minLTP))
             parser.set("filters", "volumeRatio", str(self.volumeRatio))
@@ -318,14 +320,17 @@
                 ) or self.atrTrailingStopPeriod
                 self.atrTrailingStopSensitivity = input(
                     f"[+] ATR Trailing Stop Sensitivity. (number)(Optimal = 1, Current: {colorText.FAIL}{self.atrTrailingStopSensitivity}{colorText.END}): "
                 ) or self.atrTrailingStopSensitivity
                 self.atrTrailingStopEMAPeriod = input(
                     f"[+] ATR Trailing Stop EMA Period. (number)(Optimal = 1 to 200, Current: {colorText.FAIL}{self.atrTrailingStopEMAPeriod}{colorText.END}): "
                 ) or self.atrTrailingStopEMAPeriod
+                self.vcpVolumeContractionRatio = input(
+                    f"[+] Ratio of volume of recent largest to pullback candles for VCP. (number)(Optimal = 0.4, Current: {colorText.FAIL}{self.vcpVolumeContractionRatio}{colorText.END}): "
+                ) or self.vcpVolumeContractionRatio
             except Exception as e:
                 default_logger().debug(e,exc_info=True)
                 from time import sleep
                 OutputControls().printOutput(colorText.FAIL + "Could not save configuration! Please check!" + colorText.END)
                 sleep(3)
                 pass
             try:
@@ -361,14 +366,15 @@
                     endPeriod = str(self.period)[-1].lower()
                     endPeriod = "d" if endPeriod not in ["d","o","y","x"] else ""
                 parser.set("config", "period", str(self.period + endPeriod))
                 parser.set("config", "showPastStrategyData", str(self.showPastStrategyData))
                 parser.set("config", "showunknowntrends", str(self.showunknowntrendsPrompt))
                 parser.set("config", "shuffle", str(self.shuffle))
                 parser.set("config", "useEMA", str(self.useEmaPrompt))
+                parser.set("config", "vcpVolumeContractionRatio", str(self.vcpVolumeContractionRatio))
 
                 parser.set("filters", "consolidationPercentage", str(self.consolidationPercentage))
                 parser.set("filters", "maxPrice", str(self.maxLTP))
                 parser.set("filters", "minimumChangePercentage", str(self.minimumChangePercentage))
                 parser.set("filters", "minimumVolume", str(self.minVolume))
                 parser.set("filters", "minPrice", str(self.minLTP))
                 parser.set("filters", "volumeRatio", str(self.volumeRatio))
@@ -487,14 +493,15 @@
                 self.morninganalysiscandleduration = parser.get("config", "morninganalysiscandleduration")
                 self.minVolume = int(parser.get("filters", "minimumVolume"))
                 self.minimumChangePercentage = float(parser.get("filters", "minimumchangepercentage"))
                 self.backtestPeriodFactor = int(parser.get("config", "backtestPeriodFactor"))
                 self.defaultMonitorOptions = str(parser.get("config", "defaultMonitorOptions"))
                 self.maxDashboardWidgetsPerRow = int(parser.get("config", "maxDashboardWidgetsPerRow"))
                 self.maxNumResultRowsInMonitor = int(parser.get("config", "maxNumResultRowsInMonitor"))
+                self.vcpVolumeContractionRatio = float(parser.get("config", "vcpVolumeContractionRatio"))
             except configparser.NoOptionError as e:# pragma: no cover
                 self.default_logger.debug(e, exc_info=True)
                 # input(colorText.BOLD + colorText.FAIL +
                 #       '[+] pkscreener requires user configuration again. Press enter to continue..' + colorText.END)
                 parser.remove_section("config")
                 parser.remove_section("filters")
                 self.setConfig(parser, default=True, showFileCreatedText=False)
```

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/Fetcher.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/Fetcher.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/MarketMonitor.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/MarketMonitor.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/MarketStatus.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/MarketStatus.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/MenuOptions.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/MenuOptions.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/OtaUpdater.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/OtaUpdater.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/PKMarketOpenCloseAnalyser.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/PKMarketOpenCloseAnalyser.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/PKScanRunner.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/PKScanRunner.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/PKScheduledTaskProgress.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/PKScheduledTaskProgress.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/PKScheduler.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/PKScheduler.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/PKSpreadsheets.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/PKSpreadsheets.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/PKTask.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/PKTask.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/Pktalib.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/Pktalib.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/Portfolio.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/Portfolio.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/PortfolioXRay.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/PortfolioXRay.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/ScreeningStatistics.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/ScreeningStatistics.py`

 * *Files 2% similar despite different names*

```diff
@@ -765,2680 +765,2680 @@
 00002fc0: 7953 656c 6c41 6c6c 203d 3d20 3320 656c  ySellAll == 3 el
 00002fd0: 7365 2046 616c 7365 2929 0a0a 2020 2020  se False))..    
 00002fe0: 2343 616c 6375 6c61 7469 6e67 2073 6967  #Calculating sig
 00002ff0: 6e61 6c73 0a20 2020 2064 6566 2063 6f6d  nals.    def com
 00003000: 7075 7465 4275 7953 656c 6c53 6967 6e61  puteBuySellSigna
 00003010: 6c73 2873 656c 662c 6466 2c65 6d61 5f70  ls(self,df,ema_p
 00003020: 6572 696f 643d 3230 3029 3a0a 2020 2020  eriod=200):.    
-00003030: 2020 2020 656d 6120 3d20 706b 7461 6c69      ema = pktali
-00003040: 622e 454d 4128 6466 5b22 436c 6f73 6522  b.EMA(df["Close"
-00003050: 5d2c 2065 6d61 5f70 6572 696f 6429 2023  ], ema_period) #
-00003060: 7368 6f72 745f 6e61 6d65 3d27 454d 4127  short_name='EMA'
-00003070: 2c20 6577 6d3d 5472 7565 290a 2020 2020  , ewm=True).    
-00003080: 2020 2020 0a20 2020 2020 2020 2064 665b      .        df[
-00003090: 2241 626f 7665 225d 203d 2065 6d61 203e  "Above"] = ema >
-000030a0: 2064 665b 2241 5452 5472 6169 6c69 6e67   df["ATRTrailing
-000030b0: 5374 6f70 225d 0a20 2020 2020 2020 2064  Stop"].        d
-000030c0: 665b 2242 656c 6f77 225d 203d 2065 6d61  f["Below"] = ema
-000030d0: 203c 2064 665b 2241 5452 5472 6169 6c69   < df["ATRTraili
-000030e0: 6e67 5374 6f70 225d 0a20 2020 2020 2020  ngStop"].       
-000030f0: 200a 2020 2020 2020 2020 6466 5b22 4275   .        df["Bu
-00003100: 7922 5d20 3d20 2864 665b 2243 6c6f 7365  y"] = (df["Close
-00003110: 225d 203e 2064 665b 2241 5452 5472 6169  "] > df["ATRTrai
-00003120: 6c69 6e67 5374 6f70 225d 2920 2620 2864  lingStop"]) & (d
-00003130: 665b 2241 626f 7665 225d 3d3d 5472 7565  f["Above"]==True
-00003140: 290a 2020 2020 2020 2020 6466 5b22 5365  ).        df["Se
-00003150: 6c6c 225d 203d 2028 6466 5b22 436c 6f73  ll"] = (df["Clos
-00003160: 6522 5d20 3c20 6466 5b22 4154 5254 7261  e"] < df["ATRTra
-00003170: 696c 696e 6753 746f 7022 5d29 2026 2028  ilingStop"]) & (
-00003180: 6466 5b22 4265 6c6f 7722 5d3d 3d54 7275  df["Below"]==Tru
-00003190: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-000031a0: 6e20 6466 0a0a 2020 2020 6465 6620 6669  n df..    def fi
-000031b0: 6e64 4275 7953 656c 6c53 6967 6e61 6c73  ndBuySellSignals
-000031c0: 4672 6f6d 4154 5254 7261 696c 696e 6728  FromATRTrailing(
-000031d0: 7365 6c66 2c64 662c 206b 6579 5f76 616c  self,df, key_val
-000031e0: 7565 3d31 2c20 6174 725f 7065 7269 6f64  ue=1, atr_period
-000031f0: 3d31 302c 2065 6d61 5f70 6572 696f 643d  =10, ema_period=
-00003200: 3230 302c 6275 7953 656c 6c41 6c6c 3d31  200,buySellAll=1
-00003210: 2c73 6176 6544 6963 743d 4e6f 6e65 2c73  ,saveDict=None,s
-00003220: 6372 6565 6e44 6963 743d 4e6f 6e65 293a  creenDict=None):
-00003230: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
-00003240: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
-00003250: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00003260: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00003270: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00003280: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
-00003290: 2020 6461 7461 203d 2064 6174 612e 6669    data = data.fi
-000032a0: 6c6c 6e61 2830 290a 2020 2020 2020 2020  llna(0).        
-000032b0: 6461 7461 203d 2064 6174 612e 7265 706c  data = data.repl
-000032c0: 6163 6528 5b6e 702e 696e 662c 202d 6e70  ace([np.inf, -np
-000032d0: 2e69 6e66 5d2c 2030 290a 2020 2020 2020  .inf], 0).      
-000032e0: 2020 6461 7461 203d 2064 6174 615b 3a3a    data = data[::
-000032f0: 2d31 5d20 2023 2052 6576 6572 7365 2074  -1]  # Reverse t
-00003300: 6865 2064 6174 6166 7261 6d65 2073 6f20  he dataframe so 
-00003310: 7468 6174 2069 7473 2074 6865 206f 6c64  that its the old
-00003320: 6573 7420 6461 7465 2066 6972 7374 0a0a  est date first..
-00003330: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
-00003340: 6174 6520 4154 5220 616e 6420 7841 5452  ate ATR and xATR
-00003350: 5472 6169 6c69 6e67 5374 6f70 0a20 2020  TrailingStop.   
-00003360: 2020 2020 2078 4154 5220 3d20 6e70 2e61       xATR = np.a
-00003370: 7272 6179 2870 6b74 616c 6962 2e41 5452  rray(pktalib.ATR
-00003380: 2864 6174 615b 2748 6967 6827 5d2c 2064  (data['High'], d
-00003390: 6174 615b 274c 6f77 275d 2c20 6461 7461  ata['Low'], data
-000033a0: 5b27 436c 6f73 6527 5d2c 2074 696d 6570  ['Close'], timep
-000033b0: 6572 696f 643d 6174 725f 7065 7269 6f64  eriod=atr_period
-000033c0: 2929 0a20 2020 2020 2020 206e 4c6f 7373  )).        nLoss
-000033d0: 203d 206b 6579 5f76 616c 7565 202a 2078   = key_value * x
-000033e0: 4154 520a 2020 2020 2020 2020 7372 6320  ATR.        src 
-000033f0: 3d20 6461 7461 5b27 436c 6f73 6527 5d0a  = data['Close'].
-00003400: 2020 2020 2020 2020 2320 496e 6974 6961          # Initia
-00003410: 6c69 7a65 2061 7272 6179 730a 2020 2020  lize arrays.    
-00003420: 2020 2020 7841 5452 5472 6169 6c69 6e67      xATRTrailing
-00003430: 5374 6f70 203d 206e 702e 7a65 726f 7328  Stop = np.zeros(
-00003440: 6c65 6e28 6461 7461 2929 0a20 2020 2020  len(data)).     
-00003450: 2020 2078 4154 5254 7261 696c 696e 6753     xATRTrailingS
-00003460: 746f 705b 305d 203d 2073 7263 5b30 5d20  top[0] = src[0] 
-00003470: 2d20 6e4c 6f73 735b 305d 0a0a 2020 2020  - nLoss[0]..    
-00003480: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
-00003490: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
-000034a0: 2075 7369 6e67 2076 6563 746f 7269 7a65   using vectorize
-000034b0: 6420 6f70 6572 6174 696f 6e73 0a20 2020  d operations.   
-000034c0: 2020 2020 206d 6173 6b5f 3120 3d20 2873       mask_1 = (s
-000034d0: 7263 203e 206e 702e 726f 6c6c 2878 4154  rc > np.roll(xAT
-000034e0: 5254 7261 696c 696e 6753 746f 702c 2031  RTrailingStop, 1
-000034f0: 2929 2026 2028 6e70 2e72 6f6c 6c28 7372  )) & (np.roll(sr
-00003500: 632c 2031 2920 3e20 6e70 2e72 6f6c 6c28  c, 1) > np.roll(
-00003510: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
-00003520: 2c20 3129 290a 2020 2020 2020 2020 6d61  , 1)).        ma
-00003530: 736b 5f32 203d 2028 7372 6320 3c20 6e70  sk_2 = (src < np
-00003540: 2e72 6f6c 6c28 7841 5452 5472 6169 6c69  .roll(xATRTraili
-00003550: 6e67 5374 6f70 2c20 3129 2920 2620 286e  ngStop, 1)) & (n
-00003560: 702e 726f 6c6c 2873 7263 2c20 3129 203c  p.roll(src, 1) <
-00003570: 206e 702e 726f 6c6c 2878 4154 5254 7261   np.roll(xATRTra
-00003580: 696c 696e 6753 746f 702c 2031 2929 0a20  ilingStop, 1)). 
-00003590: 2020 2020 2020 206d 6173 6b5f 3320 3d20         mask_3 = 
-000035a0: 7372 6320 3e20 6e70 2e72 6f6c 6c28 7841  src > np.roll(xA
-000035b0: 5452 5472 6169 6c69 6e67 5374 6f70 2c20  TRTrailingStop, 
-000035c0: 3129 0a0a 2020 2020 2020 2020 7841 5452  1)..        xATR
-000035d0: 5472 6169 6c69 6e67 5374 6f70 203d 206e  TrailingStop = n
-000035e0: 702e 7768 6572 6528 6d61 736b 5f31 2c20  p.where(mask_1, 
-000035f0: 6e70 2e6d 6178 696d 756d 286e 702e 726f  np.maximum(np.ro
-00003600: 6c6c 2878 4154 5254 7261 696c 696e 6753  ll(xATRTrailingS
-00003610: 746f 702c 2031 292c 2073 7263 202d 206e  top, 1), src - n
-00003620: 4c6f 7373 292c 2078 4154 5254 7261 696c  Loss), xATRTrail
-00003630: 696e 6753 746f 7029 0a20 2020 2020 2020  ingStop).       
-00003640: 2078 4154 5254 7261 696c 696e 6753 746f   xATRTrailingSto
-00003650: 7020 3d20 6e70 2e77 6865 7265 286d 6173  p = np.where(mas
-00003660: 6b5f 322c 206e 702e 6d69 6e69 6d75 6d28  k_2, np.minimum(
-00003670: 6e70 2e72 6f6c 6c28 7841 5452 5472 6169  np.roll(xATRTrai
-00003680: 6c69 6e67 5374 6f70 2c20 3129 2c20 7372  lingStop, 1), sr
-00003690: 6320 2b20 6e4c 6f73 7329 2c20 7841 5452  c + nLoss), xATR
-000036a0: 5472 6169 6c69 6e67 5374 6f70 290a 2020  TrailingStop).  
-000036b0: 2020 2020 2020 7841 5452 5472 6169 6c69        xATRTraili
-000036c0: 6e67 5374 6f70 203d 206e 702e 7768 6572  ngStop = np.wher
-000036d0: 6528 6d61 736b 5f33 2c20 7372 6320 2d20  e(mask_3, src - 
-000036e0: 6e4c 6f73 732c 2078 4154 5254 7261 696c  nLoss, xATRTrail
-000036f0: 696e 6753 746f 7029 0a0a 2020 2020 2020  ingStop)..      
-00003700: 2020 6d61 736b 5f62 7579 203d 2028 6e70    mask_buy = (np
-00003710: 2e72 6f6c 6c28 7372 632c 2031 2920 3c20  .roll(src, 1) < 
-00003720: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
-00003730: 2920 2620 2873 7263 203e 206e 702e 726f  ) & (src > np.ro
-00003740: 6c6c 2878 4154 5254 7261 696c 696e 6753  ll(xATRTrailingS
-00003750: 746f 702c 2031 2929 0a20 2020 2020 2020  top, 1)).       
-00003760: 206d 6173 6b5f 7365 6c6c 203d 2028 6e70   mask_sell = (np
-00003770: 2e72 6f6c 6c28 7372 632c 2031 2920 3e20  .roll(src, 1) > 
-00003780: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
-00003790: 2920 2620 2873 7263 203c 206e 702e 726f  ) & (src < np.ro
-000037a0: 6c6c 2878 4154 5254 7261 696c 696e 6753  ll(xATRTrailingS
-000037b0: 746f 702c 2031 2929 0a0a 2020 2020 2020  top, 1))..      
-000037c0: 2020 706f 7320 3d20 6e70 2e7a 6572 6f73    pos = np.zeros
-000037d0: 286c 656e 2864 6174 6129 290a 2020 2020  (len(data)).    
-000037e0: 2020 2020 706f 7320 3d20 6e70 2e77 6865      pos = np.whe
-000037f0: 7265 286d 6173 6b5f 6275 792c 2031 2c20  re(mask_buy, 1, 
-00003800: 706f 7329 0a20 2020 2020 2020 2070 6f73  pos).        pos
-00003810: 203d 206e 702e 7768 6572 6528 6d61 736b   = np.where(mask
-00003820: 5f73 656c 6c2c 202d 312c 2070 6f73 290a  _sell, -1, pos).
-00003830: 2020 2020 2020 2020 706f 735b 7e28 2870          pos[~((p
-00003840: 6f73 203d 3d20 3129 207c 2028 706f 7320  os == 1) | (pos 
-00003850: 3d3d 202d 3129 295d 203d 2030 0a0a 2020  == -1))] = 0..  
-00003860: 2020 2020 2020 656d 6120 3d20 6e70 2e61        ema = np.a
-00003870: 7272 6179 2870 6b74 616c 6962 2e45 4d41  rray(pktalib.EMA
-00003880: 2864 6174 615b 2743 6c6f 7365 275d 2c20  (data['Close'], 
-00003890: 7469 6d65 7065 7269 6f64 3d65 6d61 5f70  timeperiod=ema_p
-000038a0: 6572 696f 6429 290a 0a20 2020 2020 2020  eriod))..       
-000038b0: 2062 7579 5f63 6f6e 6469 7469 6f6e 5f75   buy_condition_u
-000038c0: 7462 6f74 203d 2028 7841 5452 5472 6169  tbot = (xATRTrai
-000038d0: 6c69 6e67 5374 6f70 203e 2065 6d61 2920  lingStop > ema) 
-000038e0: 2620 2870 6f73 203e 2030 2920 2620 2873  & (pos > 0) & (s
-000038f0: 7263 203e 2065 6d61 290a 2020 2020 2020  rc > ema).      
-00003900: 2020 7365 6c6c 5f63 6f6e 6469 7469 6f6e    sell_condition
-00003910: 5f75 7462 6f74 203d 2028 7841 5452 5472  _utbot = (xATRTr
-00003920: 6169 6c69 6e67 5374 6f70 203c 2065 6d61  ailingStop < ema
-00003930: 2920 2620 2870 6f73 203c 2030 2920 2620  ) & (pos < 0) & 
-00003940: 2873 7263 203c 2065 6d61 290a 0a20 2020  (src < ema)..   
-00003950: 2020 2020 2023 2054 6865 2072 6573 756c       # The resul
-00003960: 7469 6e67 2074 7265 6e64 2061 7272 6179  ting trend array
-00003970: 2068 6f6c 6473 2076 616c 7565 7320 6f66   holds values of
-00003980: 2031 2028 6275 7929 2c20 2d31 2028 7365   1 (buy), -1 (se
-00003990: 6c6c 292c 206f 7220 3020 286e 6575 7472  ll), or 0 (neutr
-000039a0: 616c 292e 0a20 2020 2020 2020 2074 7265  al)..        tre
-000039b0: 6e64 203d 206e 702e 7768 6572 6528 6275  nd = np.where(bu
-000039c0: 795f 636f 6e64 6974 696f 6e5f 7574 626f  y_condition_utbo
-000039d0: 742c 2031 2c20 6e70 2e77 6865 7265 2873  t, 1, np.where(s
-000039e0: 656c 6c5f 636f 6e64 6974 696f 6e5f 7574  ell_condition_ut
-000039f0: 626f 742c 202d 312c 2030 2929 0a20 2020  bot, -1, 0)).   
-00003a00: 2020 2020 2074 7265 6e64 5f61 7272 203d       trend_arr =
-00003a10: 206e 702e 6172 7261 7928 7472 656e 6429   np.array(trend)
-00003a20: 0a20 2020 2020 2020 2064 6174 612e 696e  .        data.in
-00003a30: 7365 7274 286c 656e 2864 6174 612e 636f  sert(len(data.co
-00003a40: 6c75 6d6e 7329 2c20 2274 7265 6e64 222c  lumns), "trend",
-00003a50: 2074 7265 6e64 5f61 7272 290a 2020 2020   trend_arr).    
-00003a60: 2020 2020 7472 656e 6420 3d20 7472 656e      trend = tren
-00003a70: 645b 305d 0a20 2020 2020 2020 2073 6176  d[0].        sav
-00003a80: 6544 6963 745b 2242 2f53 225d 203d 2022  eDict["B/S"] = "
-00003a90: 4275 7922 2069 6620 7472 656e 6420 3d3d  Buy" if trend ==
-00003aa0: 2031 2065 6c73 6520 2822 5365 6c6c 2220   1 else ("Sell" 
-00003ab0: 6966 2074 7265 6e64 203d 3d20 2d31 2065  if trend == -1 e
-00003ac0: 6c73 6520 224e 4122 290a 2020 2020 2020  lse "NA").      
-00003ad0: 2020 7363 7265 656e 4469 6374 5b22 422f    screenDict["B/
-00003ae0: 5322 5d20 3d20 2863 6f6c 6f72 5465 7874  S"] = (colorText
-00003af0: 2e47 5245 454e 202b 2022 4275 7922 2920  .GREEN + "Buy") 
-00003b00: 6966 2074 7265 6e64 203d 3d20 3120 656c  if trend == 1 el
-00003b10: 7365 2028 2863 6f6c 6f72 5465 7874 2e46  se ((colorText.F
-00003b20: 4149 4c2b 2022 5365 6c6c 2229 2069 6620  AIL+ "Sell") if 
-00003b30: 7472 656e 6420 3d3d 202d 3120 656c 7365  trend == -1 else
-00003b40: 2028 636f 6c6f 7254 6578 742e 5741 524e   (colorText.WARN
-00003b50: 202b 2022 4e41 2229 2920 2b20 636f 6c6f   + "NA")) + colo
-00003b60: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00003b70: 2020 7265 7475 726e 2062 7579 5365 6c6c    return buySell
-00003b80: 416c 6c20 3d3d 2074 7265 6e64 0a0a 2020  All == trend..  
-00003b90: 2020 2320 4578 616d 706c 6520 6f66 2063    # Example of c
-00003ba0: 6f6d 6269 6e69 6e67 2055 5442 6f74 2041  ombining UTBot A
-00003bb0: 6c65 7274 7320 7769 7468 2052 5349 2061  lerts with RSI a
-00003bc0: 6e64 2041 4458 0a20 2020 2064 6566 2063  nd ADX.    def c
-00003bd0: 7573 746f 6d5f 7374 7261 7465 6779 2873  ustom_strategy(s
-00003be0: 656c 662c 6461 7461 6672 616d 6529 3a0a  elf,dataframe):.
-00003bf0: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
-00003c00: 6520 3d20 7365 6c66 2e66 696e 6442 7579  e = self.findBuy
-00003c10: 5365 6c6c 5369 676e 616c 7346 726f 6d41  SellSignalsFromA
-00003c20: 5452 5472 6169 6c69 6e67 2864 6174 6166  TRTrailing(dataf
-00003c30: 7261 6d65 2c20 6b65 795f 7661 6c75 653d  rame, key_value=
-00003c40: 322c 2061 7472 5f70 6572 696f 643d 372c  2, atr_period=7,
-00003c50: 2065 6d61 5f70 6572 696f 643d 3130 3029   ema_period=100)
-00003c60: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00003c70: 2020 2320 4361 6c63 756c 6174 6520 5253    # Calculate RS
-00003c80: 4920 616e 6420 4144 580a 2020 2020 2020  I and ADX.      
-00003c90: 2020 7273 6920 3d20 706b 7461 6c69 622e    rsi = pktalib.
-00003ca0: 5253 4928 6461 7461 6672 616d 655b 2743  RSI(dataframe['C
-00003cb0: 6c6f 7365 275d 290a 2020 2020 2020 2020  lose']).        
-00003cc0: 6164 7820 3d20 706b 7461 6c69 622e 4144  adx = pktalib.AD
-00003cd0: 5828 6461 7461 6672 616d 655b 2748 6967  X(dataframe['Hig
-00003ce0: 6827 5d2c 2064 6174 6166 7261 6d65 5b27  h'], dataframe['
-00003cf0: 4c6f 7727 5d2c 2064 6174 6166 7261 6d65  Low'], dataframe
-00003d00: 5b27 436c 6f73 6527 5d29 0a20 2020 2020  ['Close']).     
-00003d10: 2020 200a 2020 2020 2020 2020 2320 4465     .        # De
-00003d20: 6669 6e65 2063 6f6e 6469 7469 6f6e 7320  fine conditions 
-00003d30: 6261 7365 6420 6f6e 2055 5442 6f74 2041  based on UTBot A
-00003d40: 6c65 7274 7320 616e 6420 6164 6469 7469  lerts and additi
-00003d50: 6f6e 616c 2069 6e64 6963 6174 6f72 730a  onal indicators.
-00003d60: 2020 2020 2020 2020 2320 2e2e 2e20 2879          # ... (y
-00003d70: 6f75 7220 6375 7374 6f6d 2063 6f6e 6469  our custom condi
-00003d80: 7469 6f6e 7320 6865 7265 290a 2020 2020  tions here).    
-00003d90: 2020 2020 0a20 2020 2020 2020 2072 6574      .        ret
-00003da0: 7572 6e20 6461 7461 6672 616d 650a 2020  urn dataframe.  
-00003db0: 2020 0a20 2020 2064 6566 2070 6f70 756c    .    def popul
-00003dc0: 6174 655f 696e 6469 6361 746f 7273 2873  ate_indicators(s
-00003dd0: 656c 662c 2064 6174 6166 7261 6d65 3a20  elf, dataframe: 
-00003de0: 7064 2e44 6174 6146 7261 6d65 2c20 6d65  pd.DataFrame, me
-00003df0: 7461 6461 7461 3a20 6469 6374 2920 2d3e  tadata: dict) ->
-00003e00: 2070 642e 4461 7461 4672 616d 653a 0a20   pd.DataFrame:. 
-00003e10: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00003e20: 6c66 2e64 703a 0a20 2020 2020 2020 2020  lf.dp:.         
-00003e30: 2020 2023 2044 6f6e 2774 2064 6f20 616e     # Don't do an
-00003e40: 7974 6869 6e67 2069 6620 4461 7461 5072  ything if DataPr
-00003e50: 6f76 6964 6572 2069 7320 6e6f 7420 6176  ovider is not av
-00003e60: 6169 6c61 626c 652e 0a20 2020 2020 2020  ailable..       
-00003e70: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
-00003e80: 6672 616d 650a 2020 2020 2020 2020 4c5f  frame.        L_
-00003e90: 6f70 7469 6d69 7a65 5f74 7265 6e64 5f61  optimize_trend_a
-00003ea0: 6c65 7274 2020 3d20 7365 6c66 2e66 696e  lert  = self.fin
-00003eb0: 6442 7579 5365 6c6c 5369 676e 616c 7346  dBuySellSignalsF
-00003ec0: 726f 6d41 5452 5472 6169 6c69 6e67 2864  romATRTrailing(d
-00003ed0: 6174 6166 7261 6d65 3d64 6174 6166 7261  ataframe=datafra
-00003ee0: 6d65 2c20 6b65 795f 7661 6c75 653d 2073  me, key_value= s
-00003ef0: 656c 662e 6b65 795f 7661 6c75 655f 6c2e  elf.key_value_l.
-00003f00: 7661 6c75 652c 2061 7472 5f70 6572 696f  value, atr_perio
-00003f10: 643d 2073 656c 662e 6174 725f 7065 7269  d= self.atr_peri
-00003f20: 6f64 5f6c 2e76 616c 7565 2c20 656d 615f  od_l.value, ema_
-00003f30: 7065 7269 6f64 3d73 656c 662e 656d 615f  period=self.ema_
-00003f40: 7065 7269 6f64 5f6c 2e76 616c 7565 290a  period_l.value).
-00003f50: 2020 2020 2020 2020 2320 4c6f 6e67 2070          # Long p
-00003f60: 6f73 6974 696f 6e3f 0a20 2020 2020 2020  osition?.       
-00003f70: 2064 6174 6166 7261 6d65 5b27 7472 656e   dataframe['tren
-00003f80: 645f 6c27 5d20 3d20 4c5f 6f70 7469 6d69  d_l'] = L_optimi
-00003f90: 7a65 5f74 7265 6e64 5f61 6c65 7274 5b27  ze_trend_alert['
-00003fa0: 7472 656e 6427 5d0a 2020 2020 2020 2020  trend'].        
-00003fb0: 535f 6f70 7469 6d69 7a65 5f74 7265 6e64  S_optimize_trend
-00003fc0: 5f61 6c65 7274 2020 3d20 7365 6c66 2e66  _alert  = self.f
-00003fd0: 696e 6442 7579 5365 6c6c 5369 676e 616c  indBuySellSignal
-00003fe0: 7346 726f 6d41 5452 5472 6169 6c69 6e67  sFromATRTrailing
-00003ff0: 2864 6174 6166 7261 6d65 3d64 6174 6166  (dataframe=dataf
-00004000: 7261 6d65 2c20 6b65 795f 7661 6c75 653d  rame, key_value=
-00004010: 2073 656c 662e 6b65 795f 7661 6c75 655f   self.key_value_
-00004020: 732e 7661 6c75 652c 2061 7472 5f70 6572  s.value, atr_per
-00004030: 696f 643d 2073 656c 662e 6174 725f 7065  iod= self.atr_pe
-00004040: 7269 6f64 5f73 2e76 616c 7565 2c20 656d  riod_s.value, em
-00004050: 615f 7065 7269 6f64 3d73 656c 662e 656d  a_period=self.em
-00004060: 615f 7065 7269 6f64 5f73 2e76 616c 7565  a_period_s.value
-00004070: 290a 2020 2020 2020 2020 2320 5368 6f72  ).        # Shor
-00004080: 7420 706f 7369 7469 6f6e 3f0a 2020 2020  t position?.    
-00004090: 2020 2020 6461 7461 6672 616d 655b 2774      dataframe['t
-000040a0: 7265 6e64 5f73 275d 203d 2053 5f6f 7074  rend_s'] = S_opt
-000040b0: 696d 697a 655f 7472 656e 645f 616c 6572  imize_trend_aler
-000040c0: 745b 2774 7265 6e64 275d 0a0a 2020 2020  t['trend']..    
-000040d0: 2020 2020 2320 4144 580a 2020 2020 2020      # ADX.      
-000040e0: 2020 6461 7461 6672 616d 655b 2761 6478    dataframe['adx
-000040f0: 275d 203d 2070 6b74 616c 6962 2e41 4458  '] = pktalib.ADX
-00004100: 2864 6174 6166 7261 6d65 290a 2020 2020  (dataframe).    
-00004110: 2020 2020 0a20 2020 2020 2020 2023 2052      .        # R
-00004120: 5349 0a20 2020 2020 2020 2023 2064 6174  SI.        # dat
-00004130: 6166 7261 6d65 5b27 7273 6927 5d20 3d20  aframe['rsi'] = 
-00004140: 7461 2e52 5349 2864 6174 6166 7261 6d65  ta.RSI(dataframe
-00004150: 290a 0a20 2020 2020 2020 2023 2045 4d41  )..        # EMA
-00004160: 0a20 2020 2020 2020 2064 6174 6166 7261  .        datafra
-00004170: 6d65 5b27 656d 615f 6c27 5d20 3d20 706b  me['ema_l'] = pk
-00004180: 7461 6c69 622e 454d 4128 6461 7461 6672  talib.EMA(datafr
-00004190: 616d 655b 2763 6c6f 7365 275d 2c20 7469  ame['close'], ti
-000041a0: 6d65 7065 7269 6f64 3d73 656c 662e 656d  meperiod=self.em
-000041b0: 615f 7065 7269 6f64 5f6c 5f65 7869 742e  a_period_l_exit.
-000041c0: 7661 6c75 6529 0a20 2020 2020 2020 2064  value).        d
-000041d0: 6174 6166 7261 6d65 5b27 656d 615f 7327  ataframe['ema_s'
-000041e0: 5d20 3d20 706b 7461 6c69 622e 454d 4128  ] = pktalib.EMA(
-000041f0: 6461 7461 6672 616d 655b 2763 6c6f 7365  dataframe['close
-00004200: 275d 2c20 7469 6d65 7065 7269 6f64 3d73  '], timeperiod=s
-00004210: 656c 662e 656d 615f 7065 7269 6f64 5f73  elf.ema_period_s
-00004220: 5f65 7869 742e 7661 6c75 6529 0a0a 0a20  _exit.value)... 
-00004230: 2020 2020 2020 2023 2056 6f6c 756d 6520         # Volume 
-00004240: 5765 6967 6874 6564 0a20 2020 2020 2020  Weighted.       
-00004250: 2064 6174 6166 7261 6d65 5b27 766f 6c75   dataframe['volu
-00004260: 6d65 5f6d 6561 6e27 5d20 3d20 6461 7461  me_mean'] = data
-00004270: 6672 616d 655b 2776 6f6c 756d 6527 5d2e  frame['volume'].
-00004280: 726f 6c6c 696e 6728 7365 6c66 2e76 6f6c  rolling(self.vol
-00004290: 756d 655f 6368 6563 6b2e 7661 6c75 6529  ume_check.value)
-000042a0: 2e6d 6561 6e28 292e 7368 6966 7428 3129  .mean().shift(1)
-000042b0: 0a20 2020 2020 2020 2064 6174 6166 7261  .        datafra
-000042c0: 6d65 5b27 766f 6c75 6d65 5f6d 6561 6e5f  me['volume_mean_
-000042d0: 6578 6974 275d 203d 2064 6174 6166 7261  exit'] = datafra
-000042e0: 6d65 5b27 766f 6c75 6d65 275d 2e72 6f6c  me['volume'].rol
-000042f0: 6c69 6e67 2873 656c 662e 766f 6c75 6d65  ling(self.volume
-00004300: 5f63 6865 636b 5f65 7869 742e 7661 6c75  _check_exit.valu
-00004310: 6529 2e6d 6561 6e28 292e 7368 6966 7428  e).mean().shift(
-00004320: 3129 0a0a 2020 2020 2020 2020 6461 7461  1)..        data
-00004330: 6672 616d 655b 2776 6f6c 756d 655f 6d65  frame['volume_me
-00004340: 616e 5f73 275d 203d 2064 6174 6166 7261  an_s'] = datafra
-00004350: 6d65 5b27 766f 6c75 6d65 275d 2e72 6f6c  me['volume'].rol
-00004360: 6c69 6e67 2873 656c 662e 766f 6c75 6d65  ling(self.volume
-00004370: 5f63 6865 636b 5f73 2e76 616c 7565 292e  _check_s.value).
-00004380: 6d65 616e 2829 2e73 6869 6674 2831 290a  mean().shift(1).
-00004390: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
-000043a0: 655b 2776 6f6c 756d 655f 6d65 616e 5f65  e['volume_mean_e
-000043b0: 7869 745f 7327 5d20 3d20 6461 7461 6672  xit_s'] = datafr
-000043c0: 616d 655b 2776 6f6c 756d 6527 5d2e 726f  ame['volume'].ro
-000043d0: 6c6c 696e 6728 7365 6c66 2e76 6f6c 756d  lling(self.volum
-000043e0: 655f 6368 6563 6b5f 6578 6974 5f73 2e76  e_check_exit_s.v
-000043f0: 616c 7565 292e 6d65 616e 2829 2e73 6869  alue).mean().shi
-00004400: 6674 2831 290a 2020 2020 2020 2020 7265  ft(1).        re
-00004410: 7475 726e 2064 6174 6166 7261 6d65 0a20  turn dataframe. 
-00004420: 2020 200a 2020 2020 6465 6620 706f 7075     .    def popu
-00004430: 6c61 7465 5f65 6e74 7279 5f74 7265 6e64  late_entry_trend
-00004440: 2873 656c 662c 2064 6174 6166 7261 6d65  (self, dataframe
-00004450: 3a20 7064 2e44 6174 6146 7261 6d65 2c20  : pd.DataFrame, 
-00004460: 6d65 7461 6461 7461 3a20 6469 6374 2920  metadata: dict) 
-00004470: 2d3e 2070 642e 4461 7461 4672 616d 653a  -> pd.DataFrame:
-00004480: 0a0a 2020 2020 2020 2020 6461 7461 6672  ..        datafr
-00004490: 616d 652e 6c6f 635b 0a20 2020 2020 2020  ame.loc[.       
-000044a0: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-000044b0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000044c0: 6461 7461 6672 616d 655b 2761 6478 275d  dataframe['adx']
-000044d0: 203e 2073 656c 662e 6164 785f 6c6f 6e67   > self.adx_long
-000044e0: 5f6d 696e 2e76 616c 7565 2920 2620 2320  _min.value) & # 
-000044f0: 7472 656e 6420 7374 7265 6e67 7468 2063  trend strength c
-00004500: 6f6e 6669 726d 6174 696f 6e0a 2020 2020  onfirmation.    
-00004510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004520: 2020 2020 2864 6174 6166 7261 6d65 5b27      (dataframe['
-00004530: 6164 7827 5d20 3c20 7365 6c66 2e61 6478  adx'] < self.adx
-00004540: 5f6c 6f6e 675f 6d61 782e 7661 6c75 6529  _long_max.value)
-00004550: 2026 2023 2074 7265 6e64 2073 7472 656e   & # trend stren
-00004560: 6774 6820 636f 6e66 6972 6d61 7469 6f6e  gth confirmation
-00004570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004580: 2020 2020 2020 2020 2028 6461 7461 6672           (datafr
-00004590: 616d 655b 2774 7265 6e64 5f6c 275d 203e  ame['trend_l'] >
-000045a0: 2030 2920 260a 2020 2020 2020 2020 2020   0) &.          
-000045b0: 2020 2020 2020 2020 2020 2020 2020 2864                (d
-000045c0: 6174 6166 7261 6d65 5b27 766f 6c75 6d65  ataframe['volume
-000045d0: 275d 203e 2064 6174 6166 7261 6d65 5b27  '] > dataframe['
-000045e0: 766f 6c75 6d65 5f6d 6561 6e27 5d29 2026  volume_mean']) &
-000045f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004600: 2020 2020 2020 2020 2028 6461 7461 6672           (datafr
-00004610: 616d 655b 2776 6f6c 756d 6527 5d20 3e20  ame['volume'] > 
-00004620: 3029 0a0a 2020 2020 2020 2020 2020 2020  0)..            
-00004630: 292c 0a20 2020 2020 2020 2020 2020 2027  ),.            '
-00004640: 656e 7465 725f 6c6f 6e67 275d 203d 2031  enter_long'] = 1
-00004650: 0a0a 2020 2020 2020 2020 6461 7461 6672  ..        datafr
-00004660: 616d 652e 6c6f 635b 0a20 2020 2020 2020  ame.loc[.       
-00004670: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-00004680: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00004690: 6461 7461 6672 616d 655b 2761 6478 275d  dataframe['adx']
-000046a0: 203e 2073 656c 662e 6164 785f 7368 6f72   > self.adx_shor
-000046b0: 745f 6d69 6e2e 7661 6c75 6529 2026 2023  t_min.value) & #
-000046c0: 2074 7265 6e64 2073 7472 656e 6774 6820   trend strength 
-000046d0: 636f 6e66 6972 6d61 7469 6f6e 0a20 2020  confirmation.   
+00003030: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00003040: 2020 2020 2066 726f 6d20 7665 6374 6f72       from vector
+00003050: 6274 2e69 6e64 6963 6174 6f72 7320 696d  bt.indicators im
+00003060: 706f 7274 204d 4120 6173 2076 6274 0a20  port MA as vbt. 
+00003070: 2020 2020 2020 2020 2020 2065 6d61 203d             ema =
+00003080: 2076 6274 2e72 756e 2864 665b 2243 6c6f   vbt.run(df["Clo
+00003090: 7365 225d 2c20 312c 2073 686f 7274 5f6e  se"], 1, short_n
+000030a0: 616d 653d 2745 4d41 272c 2065 776d 3d54  ame='EMA', ewm=T
+000030b0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+000030c0: 2064 665b 2241 626f 7665 225d 203d 2065   df["Above"] = e
+000030d0: 6d61 2e6d 615f 6372 6f73 7365 645f 6162  ma.ma_crossed_ab
+000030e0: 6f76 6528 6466 5b22 4154 5254 7261 696c  ove(df["ATRTrail
+000030f0: 696e 6753 746f 7022 5d29 0a20 2020 2020  ingStop"]).     
+00003100: 2020 2020 2020 2064 665b 2242 656c 6f77         df["Below
+00003110: 225d 203d 2065 6d61 2e6d 615f 6372 6f73  "] = ema.ma_cros
+00003120: 7365 645f 6265 6c6f 7728 6466 5b22 4154  sed_below(df["AT
+00003130: 5254 7261 696c 696e 6753 746f 7022 5d29  RTrailingStop"])
+00003140: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00003150: 496d 706f 7274 4572 726f 723a 0a20 2020  ImportError:.   
+00003160: 2020 2020 2020 2020 2065 6d61 203d 2070           ema = p
+00003170: 6b74 616c 6962 2e45 4d41 2864 665b 2243  ktalib.EMA(df["C
+00003180: 6c6f 7365 225d 2c20 656d 615f 7065 7269  lose"], ema_peri
+00003190: 6f64 2920 6966 2065 6d61 5f70 6572 696f  od) if ema_perio
+000031a0: 6420 3e20 3120 656c 7365 2064 665b 2243  d > 1 else df["C
+000031b0: 6c6f 7365 225d 2373 686f 7274 5f6e 616d  lose"]#short_nam
+000031c0: 653d 2745 4d41 272c 2065 776d 3d54 7275  e='EMA', ewm=Tru
+000031d0: 6529 2020 2020 2020 2020 0a20 2020 2020  e)        .     
+000031e0: 2020 2020 2020 2064 665b 2241 626f 7665         df["Above
+000031f0: 225d 203d 2065 6d61 203e 2064 665b 2241  "] = ema > df["A
+00003200: 5452 5472 6169 6c69 6e67 5374 6f70 225d  TRTrailingStop"]
+00003210: 0a20 2020 2020 2020 2020 2020 2064 665b  .            df[
+00003220: 2242 656c 6f77 225d 203d 2065 6d61 203c  "Below"] = ema <
+00003230: 2064 665b 2241 5452 5472 6169 6c69 6e67   df["ATRTrailing
+00003240: 5374 6f70 225d 2020 2020 2020 2020 0a20  Stop"]        . 
+00003250: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00003260: 6466 5b22 4275 7922 5d20 3d20 2864 665b  df["Buy"] = (df[
+00003270: 2243 6c6f 7365 225d 203e 2064 665b 2241  "Close"] > df["A
+00003280: 5452 5472 6169 6c69 6e67 5374 6f70 225d  TRTrailingStop"]
+00003290: 2920 2620 2864 665b 2241 626f 7665 225d  ) & (df["Above"]
+000032a0: 3d3d 5472 7565 290a 2020 2020 2020 2020  ==True).        
+000032b0: 6466 5b22 5365 6c6c 225d 203d 2028 6466  df["Sell"] = (df
+000032c0: 5b22 436c 6f73 6522 5d20 3c20 6466 5b22  ["Close"] < df["
+000032d0: 4154 5254 7261 696c 696e 6753 746f 7022  ATRTrailingStop"
+000032e0: 5d29 2026 2028 6466 5b22 4265 6c6f 7722  ]) & (df["Below"
+000032f0: 5d3d 3d54 7275 6529 0a0a 2020 2020 2020  ]==True)..      
+00003300: 2020 7265 7475 726e 2064 660a 0a20 2020    return df..   
+00003310: 2064 6566 2066 696e 6442 7579 5365 6c6c   def findBuySell
+00003320: 5369 676e 616c 7346 726f 6d41 5452 5472  SignalsFromATRTr
+00003330: 6169 6c69 6e67 2873 656c 662c 6466 2c20  ailing(self,df, 
+00003340: 6b65 795f 7661 6c75 653d 312c 2061 7472  key_value=1, atr
+00003350: 5f70 6572 696f 643d 3130 2c20 656d 615f  _period=10, ema_
+00003360: 7065 7269 6f64 3d32 3030 2c62 7579 5365  period=200,buySe
+00003370: 6c6c 416c 6c3d 312c 7361 7665 4469 6374  llAll=1,saveDict
+00003380: 3d4e 6f6e 652c 7363 7265 656e 4469 6374  =None,screenDict
+00003390: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+000033a0: 6966 2064 6620 6973 204e 6f6e 6520 6f72  if df is None or
+000033b0: 206c 656e 2864 6629 203d 3d20 303a 0a20   len(df) == 0:. 
+000033c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000033d0: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+000033e0: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
+000033f0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00003400: 6461 7461 2e66 696c 6c6e 6128 3029 0a20  data.fillna(0). 
+00003410: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00003420: 7461 2e72 6570 6c61 6365 285b 6e70 2e69  ta.replace([np.i
+00003430: 6e66 2c20 2d6e 702e 696e 665d 2c20 3029  nf, -np.inf], 0)
+00003440: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00003450: 6461 7461 5b3a 3a2d 315d 2020 2320 5265  data[::-1]  # Re
+00003460: 7665 7273 6520 7468 6520 6461 7461 6672  verse the datafr
+00003470: 616d 6520 736f 2074 6861 7420 6974 7320  ame so that its 
+00003480: 7468 6520 6f6c 6465 7374 2064 6174 6520  the oldest date 
+00003490: 6669 7273 740a 0a20 2020 2020 2020 2023  first..        #
+000034a0: 2043 616c 6375 6c61 7465 2041 5452 2061   Calculate ATR a
+000034b0: 6e64 2078 4154 5254 7261 696c 696e 6753  nd xATRTrailingS
+000034c0: 746f 700a 2020 2020 2020 2020 7841 5452  top.        xATR
+000034d0: 203d 206e 702e 6172 7261 7928 706b 7461   = np.array(pkta
+000034e0: 6c69 622e 4154 5228 6461 7461 5b27 4869  lib.ATR(data['Hi
+000034f0: 6768 275d 2c20 6461 7461 5b27 4c6f 7727  gh'], data['Low'
+00003500: 5d2c 2064 6174 615b 2743 6c6f 7365 275d  ], data['Close']
+00003510: 2c20 7469 6d65 7065 7269 6f64 3d61 7472  , timeperiod=atr
+00003520: 5f70 6572 696f 6429 290a 2020 2020 2020  _period)).      
+00003530: 2020 6e4c 6f73 7320 3d20 6b65 795f 7661    nLoss = key_va
+00003540: 6c75 6520 2a20 7841 5452 0a20 2020 2020  lue * xATR.     
+00003550: 2020 2073 7263 203d 2064 6174 615b 2743     src = data['C
+00003560: 6c6f 7365 275d 0a20 2020 2020 2020 2023  lose'].        #
+00003570: 2049 6e69 7469 616c 697a 6520 6172 7261   Initialize arra
+00003580: 7973 0a20 2020 2020 2020 2078 4154 5254  ys.        xATRT
+00003590: 7261 696c 696e 6753 746f 7020 3d20 6e70  railingStop = np
+000035a0: 2e7a 6572 6f73 286c 656e 2864 6174 6129  .zeros(len(data)
+000035b0: 290a 2020 2020 2020 2020 7841 5452 5472  ).        xATRTr
+000035c0: 6169 6c69 6e67 5374 6f70 5b30 5d20 3d20  ailingStop[0] = 
+000035d0: 7372 635b 305d 202d 206e 4c6f 7373 5b30  src[0] - nLoss[0
+000035e0: 5d0a 0a20 2020 2020 2020 2023 2043 616c  ]..        # Cal
+000035f0: 6375 6c61 7465 2078 4154 5254 7261 696c  culate xATRTrail
+00003600: 696e 6753 746f 7020 7573 696e 6720 7665  ingStop using ve
+00003610: 6374 6f72 697a 6564 206f 7065 7261 7469  ctorized operati
+00003620: 6f6e 730a 2020 2020 2020 2020 6d61 736b  ons.        mask
+00003630: 5f31 203d 2028 7372 6320 3e20 6e70 2e72  _1 = (src > np.r
+00003640: 6f6c 6c28 7841 5452 5472 6169 6c69 6e67  oll(xATRTrailing
+00003650: 5374 6f70 2c20 3129 2920 2620 286e 702e  Stop, 1)) & (np.
+00003660: 726f 6c6c 2873 7263 2c20 3129 203e 206e  roll(src, 1) > n
+00003670: 702e 726f 6c6c 2878 4154 5254 7261 696c  p.roll(xATRTrail
+00003680: 696e 6753 746f 702c 2031 2929 0a20 2020  ingStop, 1)).   
+00003690: 2020 2020 206d 6173 6b5f 3220 3d20 2873       mask_2 = (s
+000036a0: 7263 203c 206e 702e 726f 6c6c 2878 4154  rc < np.roll(xAT
+000036b0: 5254 7261 696c 696e 6753 746f 702c 2031  RTrailingStop, 1
+000036c0: 2929 2026 2028 6e70 2e72 6f6c 6c28 7372  )) & (np.roll(sr
+000036d0: 632c 2031 2920 3c20 6e70 2e72 6f6c 6c28  c, 1) < np.roll(
+000036e0: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
+000036f0: 2c20 3129 290a 2020 2020 2020 2020 6d61  , 1)).        ma
+00003700: 736b 5f33 203d 2073 7263 203e 206e 702e  sk_3 = src > np.
+00003710: 726f 6c6c 2878 4154 5254 7261 696c 696e  roll(xATRTrailin
+00003720: 6753 746f 702c 2031 290a 0a20 2020 2020  gStop, 1)..     
+00003730: 2020 2078 4154 5254 7261 696c 696e 6753     xATRTrailingS
+00003740: 746f 7020 3d20 6e70 2e77 6865 7265 286d  top = np.where(m
+00003750: 6173 6b5f 312c 206e 702e 6d61 7869 6d75  ask_1, np.maximu
+00003760: 6d28 6e70 2e72 6f6c 6c28 7841 5452 5472  m(np.roll(xATRTr
+00003770: 6169 6c69 6e67 5374 6f70 2c20 3129 2c20  ailingStop, 1), 
+00003780: 7372 6320 2d20 6e4c 6f73 7329 2c20 7841  src - nLoss), xA
+00003790: 5452 5472 6169 6c69 6e67 5374 6f70 290a  TRTrailingStop).
+000037a0: 2020 2020 2020 2020 7841 5452 5472 6169          xATRTrai
+000037b0: 6c69 6e67 5374 6f70 203d 206e 702e 7768  lingStop = np.wh
+000037c0: 6572 6528 6d61 736b 5f32 2c20 6e70 2e6d  ere(mask_2, np.m
+000037d0: 696e 696d 756d 286e 702e 726f 6c6c 2878  inimum(np.roll(x
+000037e0: 4154 5254 7261 696c 696e 6753 746f 702c  ATRTrailingStop,
+000037f0: 2031 292c 2073 7263 202b 206e 4c6f 7373   1), src + nLoss
+00003800: 292c 2078 4154 5254 7261 696c 696e 6753  ), xATRTrailingS
+00003810: 746f 7029 0a20 2020 2020 2020 2078 4154  top).        xAT
+00003820: 5254 7261 696c 696e 6753 746f 7020 3d20  RTrailingStop = 
+00003830: 6e70 2e77 6865 7265 286d 6173 6b5f 332c  np.where(mask_3,
+00003840: 2073 7263 202d 206e 4c6f 7373 2c20 7841   src - nLoss, xA
+00003850: 5452 5472 6169 6c69 6e67 5374 6f70 290a  TRTrailingStop).
+00003860: 0a20 2020 2020 2020 206d 6173 6b5f 6275  .        mask_bu
+00003870: 7920 3d20 286e 702e 726f 6c6c 2873 7263  y = (np.roll(src
+00003880: 2c20 3129 203c 2078 4154 5254 7261 696c  , 1) < xATRTrail
+00003890: 696e 6753 746f 7029 2026 2028 7372 6320  ingStop) & (src 
+000038a0: 3e20 6e70 2e72 6f6c 6c28 7841 5452 5472  > np.roll(xATRTr
+000038b0: 6169 6c69 6e67 5374 6f70 2c20 3129 290a  ailingStop, 1)).
+000038c0: 2020 2020 2020 2020 6d61 736b 5f73 656c          mask_sel
+000038d0: 6c20 3d20 286e 702e 726f 6c6c 2873 7263  l = (np.roll(src
+000038e0: 2c20 3129 203e 2078 4154 5254 7261 696c  , 1) > xATRTrail
+000038f0: 696e 6753 746f 7029 2026 2028 7372 6320  ingStop) & (src 
+00003900: 3c20 6e70 2e72 6f6c 6c28 7841 5452 5472  < np.roll(xATRTr
+00003910: 6169 6c69 6e67 5374 6f70 2c20 3129 290a  ailingStop, 1)).
+00003920: 0a20 2020 2020 2020 2070 6f73 203d 206e  .        pos = n
+00003930: 702e 7a65 726f 7328 6c65 6e28 6461 7461  p.zeros(len(data
+00003940: 2929 0a20 2020 2020 2020 2070 6f73 203d  )).        pos =
+00003950: 206e 702e 7768 6572 6528 6d61 736b 5f62   np.where(mask_b
+00003960: 7579 2c20 312c 2070 6f73 290a 2020 2020  uy, 1, pos).    
+00003970: 2020 2020 706f 7320 3d20 6e70 2e77 6865      pos = np.whe
+00003980: 7265 286d 6173 6b5f 7365 6c6c 2c20 2d31  re(mask_sell, -1
+00003990: 2c20 706f 7329 0a20 2020 2020 2020 2070  , pos).        p
+000039a0: 6f73 5b7e 2828 706f 7320 3d3d 2031 2920  os[~((pos == 1) 
+000039b0: 7c20 2870 6f73 203d 3d20 2d31 2929 5d20  | (pos == -1))] 
+000039c0: 3d20 300a 0a20 2020 2020 2020 2065 6d61  = 0..        ema
+000039d0: 203d 206e 702e 6172 7261 7928 706b 7461   = np.array(pkta
+000039e0: 6c69 622e 454d 4128 6461 7461 5b27 436c  lib.EMA(data['Cl
+000039f0: 6f73 6527 5d2c 2074 696d 6570 6572 696f  ose'], timeperio
+00003a00: 643d 656d 615f 7065 7269 6f64 2929 0a0a  d=ema_period))..
+00003a10: 2020 2020 2020 2020 6275 795f 636f 6e64          buy_cond
+00003a20: 6974 696f 6e5f 7574 626f 7420 3d20 2878  ition_utbot = (x
+00003a30: 4154 5254 7261 696c 696e 6753 746f 7020  ATRTrailingStop 
+00003a40: 3e20 656d 6129 2026 2028 706f 7320 3e20  > ema) & (pos > 
+00003a50: 3029 2026 2028 7372 6320 3e20 656d 6129  0) & (src > ema)
+00003a60: 0a20 2020 2020 2020 2073 656c 6c5f 636f  .        sell_co
+00003a70: 6e64 6974 696f 6e5f 7574 626f 7420 3d20  ndition_utbot = 
+00003a80: 2878 4154 5254 7261 696c 696e 6753 746f  (xATRTrailingSto
+00003a90: 7020 3c20 656d 6129 2026 2028 706f 7320  p < ema) & (pos 
+00003aa0: 3c20 3029 2026 2028 7372 6320 3c20 656d  < 0) & (src < em
+00003ab0: 6129 0a0a 2020 2020 2020 2020 2320 5468  a)..        # Th
+00003ac0: 6520 7265 7375 6c74 696e 6720 7472 656e  e resulting tren
+00003ad0: 6420 6172 7261 7920 686f 6c64 7320 7661  d array holds va
+00003ae0: 6c75 6573 206f 6620 3120 2862 7579 292c  lues of 1 (buy),
+00003af0: 202d 3120 2873 656c 6c29 2c20 6f72 2030   -1 (sell), or 0
+00003b00: 2028 6e65 7574 7261 6c29 2e0a 2020 2020   (neutral)..    
+00003b10: 2020 2020 7472 656e 6420 3d20 6e70 2e77      trend = np.w
+00003b20: 6865 7265 2862 7579 5f63 6f6e 6469 7469  here(buy_conditi
+00003b30: 6f6e 5f75 7462 6f74 2c20 312c 206e 702e  on_utbot, 1, np.
+00003b40: 7768 6572 6528 7365 6c6c 5f63 6f6e 6469  where(sell_condi
+00003b50: 7469 6f6e 5f75 7462 6f74 2c20 2d31 2c20  tion_utbot, -1, 
+00003b60: 3029 290a 2020 2020 2020 2020 7472 656e  0)).        tren
+00003b70: 645f 6172 7220 3d20 6e70 2e61 7272 6179  d_arr = np.array
+00003b80: 2874 7265 6e64 290a 2020 2020 2020 2020  (trend).        
+00003b90: 6461 7461 2e69 6e73 6572 7428 6c65 6e28  data.insert(len(
+00003ba0: 6461 7461 2e63 6f6c 756d 6e73 292c 2022  data.columns), "
+00003bb0: 7472 656e 6422 2c20 7472 656e 645f 6172  trend", trend_ar
+00003bc0: 7229 0a20 2020 2020 2020 2074 7265 6e64  r).        trend
+00003bd0: 203d 2074 7265 6e64 5b30 5d0a 2020 2020   = trend[0].    
+00003be0: 2020 2020 7361 7665 4469 6374 5b22 422f      saveDict["B/
+00003bf0: 5322 5d20 3d20 2242 7579 2220 6966 2074  S"] = "Buy" if t
+00003c00: 7265 6e64 203d 3d20 3120 656c 7365 2028  rend == 1 else (
+00003c10: 2253 656c 6c22 2069 6620 7472 656e 6420  "Sell" if trend 
+00003c20: 3d3d 202d 3120 656c 7365 2022 4e41 2229  == -1 else "NA")
+00003c30: 0a20 2020 2020 2020 2073 6372 6565 6e44  .        screenD
+00003c40: 6963 745b 2242 2f53 225d 203d 2028 636f  ict["B/S"] = (co
+00003c50: 6c6f 7254 6578 742e 4752 4545 4e20 2b20  lorText.GREEN + 
+00003c60: 2242 7579 2229 2069 6620 7472 656e 6420  "Buy") if trend 
+00003c70: 3d3d 2031 2065 6c73 6520 2828 636f 6c6f  == 1 else ((colo
+00003c80: 7254 6578 742e 4641 494c 2b20 2253 656c  rText.FAIL+ "Sel
+00003c90: 6c22 2920 6966 2074 7265 6e64 203d 3d20  l") if trend == 
+00003ca0: 2d31 2065 6c73 6520 2863 6f6c 6f72 5465  -1 else (colorTe
+00003cb0: 7874 2e57 4152 4e20 2b20 224e 4122 2929  xt.WARN + "NA"))
+00003cc0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+00003cd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00003ce0: 6275 7953 656c 6c41 6c6c 203d 3d20 7472  buySellAll == tr
+00003cf0: 656e 640a 0a20 2020 2023 2045 7861 6d70  end..    # Examp
+00003d00: 6c65 206f 6620 636f 6d62 696e 696e 6720  le of combining 
+00003d10: 5554 426f 7420 416c 6572 7473 2077 6974  UTBot Alerts wit
+00003d20: 6820 5253 4920 616e 6420 4144 580a 2020  h RSI and ADX.  
+00003d30: 2020 6465 6620 6375 7374 6f6d 5f73 7472    def custom_str
+00003d40: 6174 6567 7928 7365 6c66 2c64 6174 6166  ategy(self,dataf
+00003d50: 7261 6d65 293a 0a20 2020 2020 2020 2064  rame):.        d
+00003d60: 6174 6166 7261 6d65 203d 2073 656c 662e  ataframe = self.
+00003d70: 6669 6e64 4275 7953 656c 6c53 6967 6e61  findBuySellSigna
+00003d80: 6c73 4672 6f6d 4154 5254 7261 696c 696e  lsFromATRTrailin
+00003d90: 6728 6461 7461 6672 616d 652c 206b 6579  g(dataframe, key
+00003da0: 5f76 616c 7565 3d32 2c20 6174 725f 7065  _value=2, atr_pe
+00003db0: 7269 6f64 3d37 2c20 656d 615f 7065 7269  riod=7, ema_peri
+00003dc0: 6f64 3d31 3030 290a 2020 2020 2020 2020  od=100).        
+00003dd0: 0a20 2020 2020 2020 2023 2043 616c 6375  .        # Calcu
+00003de0: 6c61 7465 2052 5349 2061 6e64 2041 4458  late RSI and ADX
+00003df0: 0a20 2020 2020 2020 2072 7369 203d 2070  .        rsi = p
+00003e00: 6b74 616c 6962 2e52 5349 2864 6174 6166  ktalib.RSI(dataf
+00003e10: 7261 6d65 5b27 436c 6f73 6527 5d29 0a20  rame['Close']). 
+00003e20: 2020 2020 2020 2061 6478 203d 2070 6b74         adx = pkt
+00003e30: 616c 6962 2e41 4458 2864 6174 6166 7261  alib.ADX(datafra
+00003e40: 6d65 5b27 4869 6768 275d 2c20 6461 7461  me['High'], data
+00003e50: 6672 616d 655b 274c 6f77 275d 2c20 6461  frame['Low'], da
+00003e60: 7461 6672 616d 655b 2743 6c6f 7365 275d  taframe['Close']
+00003e70: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
+00003e80: 2020 2023 2044 6566 696e 6520 636f 6e64     # Define cond
+00003e90: 6974 696f 6e73 2062 6173 6564 206f 6e20  itions based on 
+00003ea0: 5554 426f 7420 416c 6572 7473 2061 6e64  UTBot Alerts and
+00003eb0: 2061 6464 6974 696f 6e61 6c20 696e 6469   additional indi
+00003ec0: 6361 746f 7273 0a20 2020 2020 2020 2023  cators.        #
+00003ed0: 202e 2e2e 2028 796f 7572 2063 7573 746f   ... (your custo
+00003ee0: 6d20 636f 6e64 6974 696f 6e73 2068 6572  m conditions her
+00003ef0: 6529 0a20 2020 2020 2020 200a 2020 2020  e).        .    
+00003f00: 2020 2020 7265 7475 726e 2064 6174 6166      return dataf
+00003f10: 7261 6d65 0a20 2020 200a 2020 2020 6465  rame.    .    de
+00003f20: 6620 706f 7075 6c61 7465 5f69 6e64 6963  f populate_indic
+00003f30: 6174 6f72 7328 7365 6c66 2c20 6461 7461  ators(self, data
+00003f40: 6672 616d 653a 2070 642e 4461 7461 4672  frame: pd.DataFr
+00003f50: 616d 652c 206d 6574 6164 6174 613a 2064  ame, metadata: d
+00003f60: 6963 7429 202d 3e20 7064 2e44 6174 6146  ict) -> pd.DataF
+00003f70: 7261 6d65 3a0a 2020 2020 2020 2020 6966  rame:.        if
+00003f80: 206e 6f74 2073 656c 662e 6470 3a0a 2020   not self.dp:.  
+00003f90: 2020 2020 2020 2020 2020 2320 446f 6e27            # Don'
+00003fa0: 7420 646f 2061 6e79 7468 696e 6720 6966  t do anything if
+00003fb0: 2044 6174 6150 726f 7669 6465 7220 6973   DataProvider is
+00003fc0: 206e 6f74 2061 7661 696c 6162 6c65 2e0a   not available..
+00003fd0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00003fe0: 726e 2064 6174 6166 7261 6d65 0a20 2020  rn dataframe.   
+00003ff0: 2020 2020 204c 5f6f 7074 696d 697a 655f       L_optimize_
+00004000: 7472 656e 645f 616c 6572 7420 203d 2073  trend_alert  = s
+00004010: 656c 662e 6669 6e64 4275 7953 656c 6c53  elf.findBuySellS
+00004020: 6967 6e61 6c73 4672 6f6d 4154 5254 7261  ignalsFromATRTra
+00004030: 696c 696e 6728 6461 7461 6672 616d 653d  iling(dataframe=
+00004040: 6461 7461 6672 616d 652c 206b 6579 5f76  dataframe, key_v
+00004050: 616c 7565 3d20 7365 6c66 2e6b 6579 5f76  alue= self.key_v
+00004060: 616c 7565 5f6c 2e76 616c 7565 2c20 6174  alue_l.value, at
+00004070: 725f 7065 7269 6f64 3d20 7365 6c66 2e61  r_period= self.a
+00004080: 7472 5f70 6572 696f 645f 6c2e 7661 6c75  tr_period_l.valu
+00004090: 652c 2065 6d61 5f70 6572 696f 643d 7365  e, ema_period=se
+000040a0: 6c66 2e65 6d61 5f70 6572 696f 645f 6c2e  lf.ema_period_l.
+000040b0: 7661 6c75 6529 0a20 2020 2020 2020 2023  value).        #
+000040c0: 204c 6f6e 6720 706f 7369 7469 6f6e 3f0a   Long position?.
+000040d0: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
+000040e0: 655b 2774 7265 6e64 5f6c 275d 203d 204c  e['trend_l'] = L
+000040f0: 5f6f 7074 696d 697a 655f 7472 656e 645f  _optimize_trend_
+00004100: 616c 6572 745b 2774 7265 6e64 275d 0a20  alert['trend']. 
+00004110: 2020 2020 2020 2053 5f6f 7074 696d 697a         S_optimiz
+00004120: 655f 7472 656e 645f 616c 6572 7420 203d  e_trend_alert  =
+00004130: 2073 656c 662e 6669 6e64 4275 7953 656c   self.findBuySel
+00004140: 6c53 6967 6e61 6c73 4672 6f6d 4154 5254  lSignalsFromATRT
+00004150: 7261 696c 696e 6728 6461 7461 6672 616d  railing(datafram
+00004160: 653d 6461 7461 6672 616d 652c 206b 6579  e=dataframe, key
+00004170: 5f76 616c 7565 3d20 7365 6c66 2e6b 6579  _value= self.key
+00004180: 5f76 616c 7565 5f73 2e76 616c 7565 2c20  _value_s.value, 
+00004190: 6174 725f 7065 7269 6f64 3d20 7365 6c66  atr_period= self
+000041a0: 2e61 7472 5f70 6572 696f 645f 732e 7661  .atr_period_s.va
+000041b0: 6c75 652c 2065 6d61 5f70 6572 696f 643d  lue, ema_period=
+000041c0: 7365 6c66 2e65 6d61 5f70 6572 696f 645f  self.ema_period_
+000041d0: 732e 7661 6c75 6529 0a20 2020 2020 2020  s.value).       
+000041e0: 2023 2053 686f 7274 2070 6f73 6974 696f   # Short positio
+000041f0: 6e3f 0a20 2020 2020 2020 2064 6174 6166  n?.        dataf
+00004200: 7261 6d65 5b27 7472 656e 645f 7327 5d20  rame['trend_s'] 
+00004210: 3d20 535f 6f70 7469 6d69 7a65 5f74 7265  = S_optimize_tre
+00004220: 6e64 5f61 6c65 7274 5b27 7472 656e 6427  nd_alert['trend'
+00004230: 5d0a 0a20 2020 2020 2020 2023 2041 4458  ]..        # ADX
+00004240: 0a20 2020 2020 2020 2064 6174 6166 7261  .        datafra
+00004250: 6d65 5b27 6164 7827 5d20 3d20 706b 7461  me['adx'] = pkta
+00004260: 6c69 622e 4144 5828 6461 7461 6672 616d  lib.ADX(datafram
+00004270: 6529 0a20 2020 2020 2020 200a 2020 2020  e).        .    
+00004280: 2020 2020 2320 5253 490a 2020 2020 2020      # RSI.      
+00004290: 2020 2320 6461 7461 6672 616d 655b 2772    # dataframe['r
+000042a0: 7369 275d 203d 2074 612e 5253 4928 6461  si'] = ta.RSI(da
+000042b0: 7461 6672 616d 6529 0a0a 2020 2020 2020  taframe)..      
+000042c0: 2020 2320 454d 410a 2020 2020 2020 2020    # EMA.        
+000042d0: 6461 7461 6672 616d 655b 2765 6d61 5f6c  dataframe['ema_l
+000042e0: 275d 203d 2070 6b74 616c 6962 2e45 4d41  '] = pktalib.EMA
+000042f0: 2864 6174 6166 7261 6d65 5b27 636c 6f73  (dataframe['clos
+00004300: 6527 5d2c 2074 696d 6570 6572 696f 643d  e'], timeperiod=
+00004310: 7365 6c66 2e65 6d61 5f70 6572 696f 645f  self.ema_period_
+00004320: 6c5f 6578 6974 2e76 616c 7565 290a 2020  l_exit.value).  
+00004330: 2020 2020 2020 6461 7461 6672 616d 655b        dataframe[
+00004340: 2765 6d61 5f73 275d 203d 2070 6b74 616c  'ema_s'] = pktal
+00004350: 6962 2e45 4d41 2864 6174 6166 7261 6d65  ib.EMA(dataframe
+00004360: 5b27 636c 6f73 6527 5d2c 2074 696d 6570  ['close'], timep
+00004370: 6572 696f 643d 7365 6c66 2e65 6d61 5f70  eriod=self.ema_p
+00004380: 6572 696f 645f 735f 6578 6974 2e76 616c  eriod_s_exit.val
+00004390: 7565 290a 0a0a 2020 2020 2020 2020 2320  ue)...        # 
+000043a0: 566f 6c75 6d65 2057 6569 6768 7465 640a  Volume Weighted.
+000043b0: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
+000043c0: 655b 2776 6f6c 756d 655f 6d65 616e 275d  e['volume_mean']
+000043d0: 203d 2064 6174 6166 7261 6d65 5b27 766f   = dataframe['vo
+000043e0: 6c75 6d65 275d 2e72 6f6c 6c69 6e67 2873  lume'].rolling(s
+000043f0: 656c 662e 766f 6c75 6d65 5f63 6865 636b  elf.volume_check
+00004400: 2e76 616c 7565 292e 6d65 616e 2829 2e73  .value).mean().s
+00004410: 6869 6674 2831 290a 2020 2020 2020 2020  hift(1).        
+00004420: 6461 7461 6672 616d 655b 2776 6f6c 756d  dataframe['volum
+00004430: 655f 6d65 616e 5f65 7869 7427 5d20 3d20  e_mean_exit'] = 
+00004440: 6461 7461 6672 616d 655b 2776 6f6c 756d  dataframe['volum
+00004450: 6527 5d2e 726f 6c6c 696e 6728 7365 6c66  e'].rolling(self
+00004460: 2e76 6f6c 756d 655f 6368 6563 6b5f 6578  .volume_check_ex
+00004470: 6974 2e76 616c 7565 292e 6d65 616e 2829  it.value).mean()
+00004480: 2e73 6869 6674 2831 290a 0a20 2020 2020  .shift(1)..     
+00004490: 2020 2064 6174 6166 7261 6d65 5b27 766f     dataframe['vo
+000044a0: 6c75 6d65 5f6d 6561 6e5f 7327 5d20 3d20  lume_mean_s'] = 
+000044b0: 6461 7461 6672 616d 655b 2776 6f6c 756d  dataframe['volum
+000044c0: 6527 5d2e 726f 6c6c 696e 6728 7365 6c66  e'].rolling(self
+000044d0: 2e76 6f6c 756d 655f 6368 6563 6b5f 732e  .volume_check_s.
+000044e0: 7661 6c75 6529 2e6d 6561 6e28 292e 7368  value).mean().sh
+000044f0: 6966 7428 3129 0a20 2020 2020 2020 2064  ift(1).        d
+00004500: 6174 6166 7261 6d65 5b27 766f 6c75 6d65  ataframe['volume
+00004510: 5f6d 6561 6e5f 6578 6974 5f73 275d 203d  _mean_exit_s'] =
+00004520: 2064 6174 6166 7261 6d65 5b27 766f 6c75   dataframe['volu
+00004530: 6d65 275d 2e72 6f6c 6c69 6e67 2873 656c  me'].rolling(sel
+00004540: 662e 766f 6c75 6d65 5f63 6865 636b 5f65  f.volume_check_e
+00004550: 7869 745f 732e 7661 6c75 6529 2e6d 6561  xit_s.value).mea
+00004560: 6e28 292e 7368 6966 7428 3129 0a20 2020  n().shift(1).   
+00004570: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
+00004580: 6672 616d 650a 2020 2020 0a20 2020 2064  frame.    .    d
+00004590: 6566 2070 6f70 756c 6174 655f 656e 7472  ef populate_entr
+000045a0: 795f 7472 656e 6428 7365 6c66 2c20 6461  y_trend(self, da
+000045b0: 7461 6672 616d 653a 2070 642e 4461 7461  taframe: pd.Data
+000045c0: 4672 616d 652c 206d 6574 6164 6174 613a  Frame, metadata:
+000045d0: 2064 6963 7429 202d 3e20 7064 2e44 6174   dict) -> pd.Dat
+000045e0: 6146 7261 6d65 3a0a 0a20 2020 2020 2020  aFrame:..       
+000045f0: 2064 6174 6166 7261 6d65 2e6c 6f63 5b0a   dataframe.loc[.
+00004600: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
+00004610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004620: 2020 2020 2020 2864 6174 6166 7261 6d65        (dataframe
+00004630: 5b27 6164 7827 5d20 3e20 7365 6c66 2e61  ['adx'] > self.a
+00004640: 6478 5f6c 6f6e 675f 6d69 6e2e 7661 6c75  dx_long_min.valu
+00004650: 6529 2026 2023 2074 7265 6e64 2073 7472  e) & # trend str
+00004660: 656e 6774 6820 636f 6e66 6972 6d61 7469  ength confirmati
+00004670: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+00004680: 2020 2020 2020 2020 2020 2028 6461 7461             (data
+00004690: 6672 616d 655b 2761 6478 275d 203c 2073  frame['adx'] < s
+000046a0: 656c 662e 6164 785f 6c6f 6e67 5f6d 6178  elf.adx_long_max
+000046b0: 2e76 616c 7565 2920 2620 2320 7472 656e  .value) & # tren
+000046c0: 6420 7374 7265 6e67 7468 2063 6f6e 6669  d strength confi
+000046d0: 726d 6174 696f 6e0a 2020 2020 2020 2020  rmation.        
 000046e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046f0: 2020 2020 2028 6461 7461 6672 616d 655b       (dataframe[
-00004700: 2761 6478 275d 203c 2073 656c 662e 6164  'adx'] < self.ad
-00004710: 785f 7368 6f72 745f 6d61 782e 7661 6c75  x_short_max.valu
-00004720: 6529 2026 2023 2074 7265 6e64 2073 7472  e) & # trend str
-00004730: 656e 6774 6820 636f 6e66 6972 6d61 7469  ength confirmati
-00004740: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-00004750: 2020 2020 2020 2020 2020 2028 6461 7461             (data
-00004760: 6672 616d 655b 2774 7265 6e64 5f73 275d  frame['trend_s']
-00004770: 203c 2030 2920 260a 2020 2020 2020 2020   < 0) &.        
-00004780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004790: 2864 6174 6166 7261 6d65 5b27 766f 6c75  (dataframe['volu
-000047a0: 6d65 275d 203e 2064 6174 6166 7261 6d65  me'] > dataframe
-000047b0: 5b27 766f 6c75 6d65 5f6d 6561 6e5f 7327  ['volume_mean_s'
-000047c0: 5d29 2023 2076 6f6c 756d 6520 7765 6967  ]) # volume weig
-000047d0: 6874 6564 2069 6e64 6963 6174 6f72 0a20  hted indicator. 
-000047e0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-000047f0: 2020 2020 2020 2020 2020 2765 6e74 6572            'enter
-00004800: 5f73 686f 7274 275d 203d 2031 0a20 2020  _short'] = 1.   
-00004810: 2020 2020 200a 2020 2020 2020 2020 7265       .        re
-00004820: 7475 726e 2064 6174 6166 7261 6d65 0a20  turn dataframe. 
-00004830: 2020 200a 2020 2020 6465 6620 706f 7075     .    def popu
-00004840: 6c61 7465 5f65 7869 745f 7472 656e 6428  late_exit_trend(
-00004850: 7365 6c66 2c20 6461 7461 6672 616d 653a  self, dataframe:
-00004860: 2070 642e 4461 7461 4672 616d 652c 206d   pd.DataFrame, m
-00004870: 6574 6164 6174 613a 2064 6963 7429 202d  etadata: dict) -
-00004880: 3e20 7064 2e44 6174 6146 7261 6d65 3a0a  > pd.DataFrame:.
-00004890: 0a20 2020 2020 2020 2063 6f6e 6469 7469  .        conditi
-000048a0: 6f6e 735f 6c6f 6e67 203d 205b 5d0a 2020  ons_long = [].  
-000048b0: 2020 2020 2020 636f 6e64 6974 696f 6e73        conditions
-000048c0: 5f73 686f 7274 203d 205b 5d0a 2020 2020  _short = [].    
-000048d0: 2020 2020 6461 7461 6672 616d 652e 6c6f      dataframe.lo
-000048e0: 635b 3a2c 2027 6578 6974 5f74 6167 275d  c[:, 'exit_tag']
-000048f0: 203d 2027 270a 0a20 2020 2020 2020 2065   = ''..        e
-00004900: 7869 745f 6c6f 6e67 203d 2028 0a20 2020  xit_long = (.   
-00004910: 2020 2020 2020 2020 2020 2020 2023 2028               # (
-00004920: 6461 7461 6672 616d 655b 2763 6c6f 7365  dataframe['close
-00004930: 275d 203c 2064 6174 6166 7261 6d65 5b27  '] < dataframe['
-00004940: 6c6f 7727 5d2e 7368 6966 7428 7365 6c66  low'].shift(self
-00004950: 2e73 656c 6c5f 7368 6966 742e 7661 6c75  .sell_shift.valu
-00004960: 6529 2920 260a 2020 2020 2020 2020 2020  e)) &.          
-00004970: 2020 2020 2020 2864 6174 6166 7261 6d65        (dataframe
-00004980: 5b27 636c 6f73 6527 5d20 3c20 6461 7461  ['close'] < data
-00004990: 6672 616d 655b 2765 6d61 5f6c 275d 2920  frame['ema_l']) 
-000049a0: 260a 2020 2020 2020 2020 2020 2020 2020  &.              
-000049b0: 2020 2864 6174 6166 7261 6d65 5b27 766f    (dataframe['vo
-000049c0: 6c75 6d65 275d 203e 2064 6174 6166 7261  lume'] > datafra
-000049d0: 6d65 5b27 766f 6c75 6d65 5f6d 6561 6e5f  me['volume_mean_
-000049e0: 6578 6974 275d 290a 2020 2020 2020 2020  exit']).        
-000049f0: 290a 0a20 2020 2020 2020 2065 7869 745f  )..        exit_
-00004a00: 7368 6f72 7420 3d20 280a 2020 2020 2020  short = (.      
-00004a10: 2020 2020 2020 2020 2020 2320 2864 6174            # (dat
-00004a20: 6166 7261 6d65 5b27 636c 6f73 6527 5d20  aframe['close'] 
-00004a30: 3e20 6461 7461 6672 616d 655b 2768 6967  > dataframe['hig
-00004a40: 6827 5d2e 7368 6966 7428 7365 6c66 2e73  h'].shift(self.s
-00004a50: 656c 6c5f 7368 6966 745f 7368 6f72 742e  ell_shift_short.
-00004a60: 7661 6c75 6529 2920 260a 2020 2020 2020  value)) &.      
-00004a70: 2020 2020 2020 2020 2020 2864 6174 6166            (dataf
-00004a80: 7261 6d65 5b27 636c 6f73 6527 5d20 3e20  rame['close'] > 
-00004a90: 6461 7461 6672 616d 655b 2765 6d61 5f73  dataframe['ema_s
-00004aa0: 275d 2920 260a 2020 2020 2020 2020 2020  ']) &.          
-00004ab0: 2020 2020 2020 2864 6174 6166 7261 6d65        (dataframe
-00004ac0: 5b27 766f 6c75 6d65 275d 203e 2064 6174  ['volume'] > dat
-00004ad0: 6166 7261 6d65 5b27 766f 6c75 6d65 5f6d  aframe['volume_m
-00004ae0: 6561 6e5f 6578 6974 5f73 275d 290a 2020  ean_exit_s']).  
-00004af0: 2020 2020 2020 290a 0a0a 2020 2020 2020        )...      
-00004b00: 2020 636f 6e64 6974 696f 6e73 5f73 686f    conditions_sho
-00004b10: 7274 2e61 7070 656e 6428 6578 6974 5f73  rt.append(exit_s
-00004b20: 686f 7274 290a 2020 2020 2020 2020 6461  hort).        da
-00004b30: 7461 6672 616d 652e 6c6f 635b 6578 6974  taframe.loc[exit
-00004b40: 5f73 686f 7274 2c20 2765 7869 745f 7461  _short, 'exit_ta
-00004b50: 6727 5d20 2b3d 2027 6578 6974 5f73 686f  g'] += 'exit_sho
-00004b60: 7274 270a 0a0a 2020 2020 2020 2020 636f  rt'...        co
-00004b70: 6e64 6974 696f 6e73 5f6c 6f6e 672e 6170  nditions_long.ap
-00004b80: 7065 6e64 2865 7869 745f 6c6f 6e67 290a  pend(exit_long).
-00004b90: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
-00004ba0: 652e 6c6f 635b 6578 6974 5f6c 6f6e 672c  e.loc[exit_long,
-00004bb0: 2027 6578 6974 5f74 6167 275d 202b 3d20   'exit_tag'] += 
-00004bc0: 2765 7869 745f 6c6f 6e67 270a 0a0a 2020  'exit_long'...  
-00004bd0: 2020 2020 2020 6966 2063 6f6e 6469 7469        if conditi
-00004be0: 6f6e 735f 6c6f 6e67 3a0a 2020 2020 2020  ons_long:.      
-00004bf0: 2020 2020 2020 6461 7461 6672 616d 652e        dataframe.
-00004c00: 6c6f 635b 0a20 2020 2020 2020 2020 2020  loc[.           
-00004c10: 2020 2020 2070 642e 7265 6475 6365 286c       pd.reduce(l
-00004c20: 616d 6264 6120 782c 2079 3a20 7820 7c20  ambda x, y: x | 
-00004c30: 792c 2063 6f6e 6469 7469 6f6e 735f 6c6f  y, conditions_lo
-00004c40: 6e67 292c 0a20 2020 2020 2020 2020 2020  ng),.           
-00004c50: 2020 2020 2027 6578 6974 5f6c 6f6e 6727       'exit_long'
-00004c60: 5d20 3d20 310a 0a20 2020 2020 2020 2069  ] = 1..        i
-00004c70: 6620 636f 6e64 6974 696f 6e73 5f73 686f  f conditions_sho
-00004c80: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
-00004c90: 6461 7461 6672 616d 652e 6c6f 635b 0a20  dataframe.loc[. 
-00004ca0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00004cb0: 642e 7265 6475 6365 286c 616d 6264 6120  d.reduce(lambda 
-00004cc0: 782c 2079 3a20 7820 7c20 792c 2063 6f6e  x, y: x | y, con
-00004cd0: 6469 7469 6f6e 735f 7368 6f72 7429 2c0a  ditions_short),.
-00004ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004cf0: 2765 7869 745f 7368 6f72 7427 5d20 3d20  'exit_short'] = 
-00004d00: 310a 2020 2020 2020 2020 2020 2020 0a20  1.            . 
-00004d10: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-00004d20: 7461 6672 616d 650a 0a20 2020 2023 2064  taframe..    # d
-00004d30: 6566 2069 6465 6e74 6966 795f 6465 6d61  ef identify_dema
-00004d40: 6e64 5f7a 6f6e 6528 7365 6c66 2c64 6174  nd_zone(self,dat
-00004d50: 612c 2063 6d70 293a 0a20 2020 2023 2020  a, cmp):.    #  
-00004d60: 2020 2064 656d 616e 645f 7a6f 6e65 7320     demand_zones 
-00004d70: 3d20 5b5d 0a20 2020 2023 2020 2020 2064  = [].    #     d
-00004d80: 726f 705f 6261 7365 5f72 616c 6c79 5f7a  rop_base_rally_z
-00004d90: 6f6e 6520 3d20 4661 6c73 650a 2020 2020  one = False.    
-00004da0: 2320 2020 2020 7261 6c6c 795f 6261 7365  #     rally_base
-00004db0: 5f72 616c 6c79 5f7a 6f6e 6520 3d20 4661  _rally_zone = Fa
-00004dc0: 6c73 650a 2020 2020 2020 2020 0a20 2020  lse.        .   
-00004dd0: 2023 2020 2020 2023 2041 6464 6974 696f   #     # Additio
-00004de0: 6e61 6c20 7661 7269 6162 6c65 7320 746f  nal variables to
-00004df0: 2074 7261 636b 2062 6173 6520 6361 6e64   track base cand
-00004e00: 6c65 2070 7269 6365 7320 666f 7220 7072  le prices for pr
-00004e10: 6f78 696d 616c 206c 696e 6520 6361 6c63  oximal line calc
-00004e20: 756c 6174 696f 6e0a 2020 2020 2320 2020  ulation.    #   
-00004e30: 2020 6261 7365 5f63 616e 646c 655f 7072    base_candle_pr
-00004e40: 6963 6573 203d 205b 5d0a 2020 2020 2020  ices = [].      
-00004e50: 2020 0a20 2020 2023 2020 2020 2066 6f72    .    #     for
-00004e60: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
-00004e70: 6461 7461 2920 2d20 3229 3a0a 2020 2020  data) - 2):.    
-00004e80: 2320 2020 2020 2020 2020 6966 2064 6174  #         if dat
-00004e90: 615b 2743 616e 646c 6520 5479 7065 275d  a['Candle Type']
-00004ea0: 5b69 5d20 3d3d 2027 4472 6f70 2043 616e  [i] == 'Drop Can
-00004eb0: 646c 6527 2061 6e64 2064 6174 615b 2743  dle' and data['C
-00004ec0: 616e 646c 6520 5479 7065 275d 5b69 202b  andle Type'][i +
-00004ed0: 2031 5d20 3d3d 2027 4261 7365 2043 616e   1] == 'Base Can
-00004ee0: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
-00004ef0: 2020 2020 2020 2020 6261 7365 5f63 6f75          base_cou
-00004f00: 6e74 203d 2031 0a20 2020 2023 2020 2020  nt = 1.    #    
-00004f10: 2020 2020 2020 2020 206a 203d 2069 202b           j = i +
-00004f20: 2032 0a20 2020 2023 2020 2020 2020 2020   2.    #        
-00004f30: 2020 2020 2077 6869 6c65 206a 203c 206c       while j < l
-00004f40: 656e 2864 6174 6129 2061 6e64 2064 6174  en(data) and dat
-00004f50: 615b 2743 616e 646c 6520 5479 7065 275d  a['Candle Type']
-00004f60: 5b6a 5d20 3d3d 2027 4261 7365 2043 616e  [j] == 'Base Can
-00004f70: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
-00004f80: 2020 2020 2020 2020 2020 2020 6261 7365              base
-00004f90: 5f63 6f75 6e74 202b 3d20 310a 2020 2020  _count += 1.    
-00004fa0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00004fb0: 2020 6a20 2b3d 2031 0a20 2020 2020 2020    j += 1.       
-00004fc0: 2020 2020 2020 2020 200a 2020 2020 2320           .    # 
-00004fd0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-00004fe0: 6173 655f 636f 756e 7420 3c3d 2034 3a20  ase_count <= 4: 
-00004ff0: 2023 204d 6178 696d 756d 206f 6620 3420   # Maximum of 4 
-00005000: 6261 7365 2063 616e 646c 6573 2066 6f72  base candles for
-00005010: 2077 6565 6b6c 7920 6f72 206d 6f6e 7468   weekly or month
-00005020: 6c79 2074 696d 6566 7261 6d65 2c20 656c  ly timeframe, el
-00005030: 7365 2033 2066 6f72 2064 6169 6c79 0a20  se 3 for daily. 
-00005040: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00005050: 2020 2020 2069 6620 6a20 3c20 6c65 6e28       if j < len(
-00005060: 6461 7461 2920 616e 6420 6461 7461 5b27  data) and data['
-00005070: 4361 6e64 6c65 2054 7970 6527 5d5b 6a5d  Candle Type'][j]
-00005080: 203d 3d20 2752 616c 6c79 2043 616e 646c   == 'Rally Candl
-00005090: 6527 3a0a 2020 2020 2320 2020 2020 2020  e':.    #       
-000050a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000050b0: 2064 6174 615b 2743 6c6f 7365 275d 5b6a   data['Close'][j
-000050c0: 5d20 3e20 6461 7461 5b27 4c6f 7727 5d5b  ] > data['Low'][
-000050d0: 695d 202b 2030 2e36 202a 2064 6174 615b  i] + 0.6 * data[
-000050e0: 2743 616e 646c 6520 5261 6e67 6527 5d5b  'Candle Range'][
-000050f0: 695d 2061 6e64 2064 6174 615b 2748 6967  i] and data['Hig
-00005100: 6827 5d5b 695d 203c 3d20 636d 703a 0a20  h'][i] <= cmp:. 
-00005110: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00005120: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-00005130: 6865 636b 2066 6f72 206f 6e65 206d 6f72  heck for one mor
-00005140: 6520 7261 6c6c 7920 6361 6e64 6c65 206f  e rally candle o
-00005150: 7220 6772 6565 6e20 6261 7365 2063 616e  r green base can
-00005160: 646c 650a 2020 2020 2320 2020 2020 2020  dle.    #       
-00005170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005180: 2020 6b20 3d20 6a20 2b20 310a 2020 2020    k = j + 1.    
-00005190: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000051a0: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-000051b0: 6b20 3c20 6c65 6e28 6461 7461 293a 0a20  k < len(data):. 
-000051c0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-000051d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000051e0: 2069 6620 6461 7461 5b27 4361 6e64 6c65   if data['Candle
-000051f0: 2054 7970 6527 5d5b 6b5d 203d 3d20 2752   Type'][k] == 'R
-00005200: 616c 6c79 2043 616e 646c 6527 206f 7220  ally Candle' or 
-00005210: 2864 6174 615b 2743 616e 646c 6520 5479  (data['Candle Ty
-00005220: 7065 275d 5b6b 5d20 3d3d 2027 4261 7365  pe'][k] == 'Base
-00005230: 2043 616e 646c 6527 2061 6e64 2064 6174   Candle' and dat
-00005240: 615b 2743 6c6f 7365 275d 5b6b 5d20 3e20  a['Close'][k] > 
-00005250: 6461 7461 5b27 4f70 656e 275d 5b6b 5d29  data['Open'][k])
-00005260: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-00005270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005280: 2020 2020 2020 2020 6465 6d61 6e64 5f7a          demand_z
-00005290: 6f6e 6573 2e61 7070 656e 6428 2869 2c20  ones.append((i, 
-000052a0: 6a2c 2027 4472 6f70 2042 6173 6520 5261  j, 'Drop Base Ra
-000052b0: 6c6c 7927 2c20 6261 7365 5f63 6f75 6e74  lly', base_count
-000052c0: 2929 0a20 2020 2023 2020 2020 2020 2020  )).    #        
+000046f0: 2864 6174 6166 7261 6d65 5b27 7472 656e  (dataframe['tren
+00004700: 645f 6c27 5d20 3e20 3029 2026 0a20 2020  d_l'] > 0) &.   
+00004710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004720: 2020 2020 2028 6461 7461 6672 616d 655b       (dataframe[
+00004730: 2776 6f6c 756d 6527 5d20 3e20 6461 7461  'volume'] > data
+00004740: 6672 616d 655b 2776 6f6c 756d 655f 6d65  frame['volume_me
+00004750: 616e 275d 2920 260a 2020 2020 2020 2020  an']) &.        
+00004760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004770: 2864 6174 6166 7261 6d65 5b27 766f 6c75  (dataframe['volu
+00004780: 6d65 275d 203e 2030 290a 0a20 2020 2020  me'] > 0)..     
+00004790: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+000047a0: 2020 2020 2020 2765 6e74 6572 5f6c 6f6e        'enter_lon
+000047b0: 6727 5d20 3d20 310a 0a20 2020 2020 2020  g'] = 1..       
+000047c0: 2064 6174 6166 7261 6d65 2e6c 6f63 5b0a   dataframe.loc[.
+000047d0: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
+000047e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000047f0: 2020 2020 2020 2864 6174 6166 7261 6d65        (dataframe
+00004800: 5b27 6164 7827 5d20 3e20 7365 6c66 2e61  ['adx'] > self.a
+00004810: 6478 5f73 686f 7274 5f6d 696e 2e76 616c  dx_short_min.val
+00004820: 7565 2920 2620 2320 7472 656e 6420 7374  ue) & # trend st
+00004830: 7265 6e67 7468 2063 6f6e 6669 726d 6174  rength confirmat
+00004840: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00004850: 2020 2020 2020 2020 2020 2020 2864 6174              (dat
+00004860: 6166 7261 6d65 5b27 6164 7827 5d20 3c20  aframe['adx'] < 
+00004870: 7365 6c66 2e61 6478 5f73 686f 7274 5f6d  self.adx_short_m
+00004880: 6178 2e76 616c 7565 2920 2620 2320 7472  ax.value) & # tr
+00004890: 656e 6420 7374 7265 6e67 7468 2063 6f6e  end strength con
+000048a0: 6669 726d 6174 696f 6e0a 2020 2020 2020  firmation.      
+000048b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048c0: 2020 2864 6174 6166 7261 6d65 5b27 7472    (dataframe['tr
+000048d0: 656e 645f 7327 5d20 3c20 3029 2026 0a20  end_s'] < 0) &. 
+000048e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048f0: 2020 2020 2020 2028 6461 7461 6672 616d         (datafram
+00004900: 655b 2776 6f6c 756d 6527 5d20 3e20 6461  e['volume'] > da
+00004910: 7461 6672 616d 655b 2776 6f6c 756d 655f  taframe['volume_
+00004920: 6d65 616e 5f73 275d 2920 2320 766f 6c75  mean_s']) # volu
+00004930: 6d65 2077 6569 6768 7465 6420 696e 6469  me weighted indi
+00004940: 6361 746f 720a 2020 2020 2020 2020 2020  cator.          
+00004950: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+00004960: 2027 656e 7465 725f 7368 6f72 7427 5d20   'enter_short'] 
+00004970: 3d20 310a 2020 2020 2020 2020 0a20 2020  = 1.        .   
+00004980: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
+00004990: 6672 616d 650a 2020 2020 0a20 2020 2064  frame.    .    d
+000049a0: 6566 2070 6f70 756c 6174 655f 6578 6974  ef populate_exit
+000049b0: 5f74 7265 6e64 2873 656c 662c 2064 6174  _trend(self, dat
+000049c0: 6166 7261 6d65 3a20 7064 2e44 6174 6146  aframe: pd.DataF
+000049d0: 7261 6d65 2c20 6d65 7461 6461 7461 3a20  rame, metadata: 
+000049e0: 6469 6374 2920 2d3e 2070 642e 4461 7461  dict) -> pd.Data
+000049f0: 4672 616d 653a 0a0a 2020 2020 2020 2020  Frame:..        
+00004a00: 636f 6e64 6974 696f 6e73 5f6c 6f6e 6720  conditions_long 
+00004a10: 3d20 5b5d 0a20 2020 2020 2020 2063 6f6e  = [].        con
+00004a20: 6469 7469 6f6e 735f 7368 6f72 7420 3d20  ditions_short = 
+00004a30: 5b5d 0a20 2020 2020 2020 2064 6174 6166  [].        dataf
+00004a40: 7261 6d65 2e6c 6f63 5b3a 2c20 2765 7869  rame.loc[:, 'exi
+00004a50: 745f 7461 6727 5d20 3d20 2727 0a0a 2020  t_tag'] = ''..  
+00004a60: 2020 2020 2020 6578 6974 5f6c 6f6e 6720        exit_long 
+00004a70: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00004a80: 2020 2020 2320 2864 6174 6166 7261 6d65      # (dataframe
+00004a90: 5b27 636c 6f73 6527 5d20 3c20 6461 7461  ['close'] < data
+00004aa0: 6672 616d 655b 276c 6f77 275d 2e73 6869  frame['low'].shi
+00004ab0: 6674 2873 656c 662e 7365 6c6c 5f73 6869  ft(self.sell_shi
+00004ac0: 6674 2e76 616c 7565 2929 2026 0a20 2020  ft.value)) &.   
+00004ad0: 2020 2020 2020 2020 2020 2020 2028 6461               (da
+00004ae0: 7461 6672 616d 655b 2763 6c6f 7365 275d  taframe['close']
+00004af0: 203c 2064 6174 6166 7261 6d65 5b27 656d   < dataframe['em
+00004b00: 615f 6c27 5d29 2026 0a20 2020 2020 2020  a_l']) &.       
+00004b10: 2020 2020 2020 2020 2028 6461 7461 6672           (datafr
+00004b20: 616d 655b 2776 6f6c 756d 6527 5d20 3e20  ame['volume'] > 
+00004b30: 6461 7461 6672 616d 655b 2776 6f6c 756d  dataframe['volum
+00004b40: 655f 6d65 616e 5f65 7869 7427 5d29 0a20  e_mean_exit']). 
+00004b50: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00004b60: 2020 6578 6974 5f73 686f 7274 203d 2028    exit_short = (
+00004b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004b80: 2023 2028 6461 7461 6672 616d 655b 2763   # (dataframe['c
+00004b90: 6c6f 7365 275d 203e 2064 6174 6166 7261  lose'] > datafra
+00004ba0: 6d65 5b27 6869 6768 275d 2e73 6869 6674  me['high'].shift
+00004bb0: 2873 656c 662e 7365 6c6c 5f73 6869 6674  (self.sell_shift
+00004bc0: 5f73 686f 7274 2e76 616c 7565 2929 2026  _short.value)) &
+00004bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004be0: 2028 6461 7461 6672 616d 655b 2763 6c6f   (dataframe['clo
+00004bf0: 7365 275d 203e 2064 6174 6166 7261 6d65  se'] > dataframe
+00004c00: 5b27 656d 615f 7327 5d29 2026 0a20 2020  ['ema_s']) &.   
+00004c10: 2020 2020 2020 2020 2020 2020 2028 6461               (da
+00004c20: 7461 6672 616d 655b 2776 6f6c 756d 6527  taframe['volume'
+00004c30: 5d20 3e20 6461 7461 6672 616d 655b 2776  ] > dataframe['v
+00004c40: 6f6c 756d 655f 6d65 616e 5f65 7869 745f  olume_mean_exit_
+00004c50: 7327 5d29 0a20 2020 2020 2020 2029 0a0a  s']).        )..
+00004c60: 0a20 2020 2020 2020 2063 6f6e 6469 7469  .        conditi
+00004c70: 6f6e 735f 7368 6f72 742e 6170 7065 6e64  ons_short.append
+00004c80: 2865 7869 745f 7368 6f72 7429 0a20 2020  (exit_short).   
+00004c90: 2020 2020 2064 6174 6166 7261 6d65 2e6c       dataframe.l
+00004ca0: 6f63 5b65 7869 745f 7368 6f72 742c 2027  oc[exit_short, '
+00004cb0: 6578 6974 5f74 6167 275d 202b 3d20 2765  exit_tag'] += 'e
+00004cc0: 7869 745f 7368 6f72 7427 0a0a 0a20 2020  xit_short'...   
+00004cd0: 2020 2020 2063 6f6e 6469 7469 6f6e 735f       conditions_
+00004ce0: 6c6f 6e67 2e61 7070 656e 6428 6578 6974  long.append(exit
+00004cf0: 5f6c 6f6e 6729 0a20 2020 2020 2020 2064  _long).        d
+00004d00: 6174 6166 7261 6d65 2e6c 6f63 5b65 7869  ataframe.loc[exi
+00004d10: 745f 6c6f 6e67 2c20 2765 7869 745f 7461  t_long, 'exit_ta
+00004d20: 6727 5d20 2b3d 2027 6578 6974 5f6c 6f6e  g'] += 'exit_lon
+00004d30: 6727 0a0a 0a20 2020 2020 2020 2069 6620  g'...        if 
+00004d40: 636f 6e64 6974 696f 6e73 5f6c 6f6e 673a  conditions_long:
+00004d50: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00004d60: 6166 7261 6d65 2e6c 6f63 5b0a 2020 2020  aframe.loc[.    
+00004d70: 2020 2020 2020 2020 2020 2020 7064 2e72              pd.r
+00004d80: 6564 7563 6528 6c61 6d62 6461 2078 2c20  educe(lambda x, 
+00004d90: 793a 2078 207c 2079 2c20 636f 6e64 6974  y: x | y, condit
+00004da0: 696f 6e73 5f6c 6f6e 6729 2c0a 2020 2020  ions_long),.    
+00004db0: 2020 2020 2020 2020 2020 2020 2765 7869              'exi
+00004dc0: 745f 6c6f 6e67 275d 203d 2031 0a0a 2020  t_long'] = 1..  
+00004dd0: 2020 2020 2020 6966 2063 6f6e 6469 7469        if conditi
+00004de0: 6f6e 735f 7368 6f72 743a 0a20 2020 2020  ons_short:.     
+00004df0: 2020 2020 2020 2064 6174 6166 7261 6d65         dataframe
+00004e00: 2e6c 6f63 5b0a 2020 2020 2020 2020 2020  .loc[.          
+00004e10: 2020 2020 2020 7064 2e72 6564 7563 6528        pd.reduce(
+00004e20: 6c61 6d62 6461 2078 2c20 793a 2078 207c  lambda x, y: x |
+00004e30: 2079 2c20 636f 6e64 6974 696f 6e73 5f73   y, conditions_s
+00004e40: 686f 7274 292c 0a20 2020 2020 2020 2020  hort),.         
+00004e50: 2020 2020 2020 2027 6578 6974 5f73 686f         'exit_sho
+00004e60: 7274 275d 203d 2031 0a20 2020 2020 2020  rt'] = 1.       
+00004e70: 2020 2020 200a 2020 2020 2020 2020 7265       .        re
+00004e80: 7475 726e 2064 6174 6166 7261 6d65 0a0a  turn dataframe..
+00004e90: 2020 2020 2320 6465 6620 6964 656e 7469      # def identi
+00004ea0: 6679 5f64 656d 616e 645f 7a6f 6e65 2873  fy_demand_zone(s
+00004eb0: 656c 662c 6461 7461 2c20 636d 7029 3a0a  elf,data, cmp):.
+00004ec0: 2020 2020 2320 2020 2020 6465 6d61 6e64      #     demand
+00004ed0: 5f7a 6f6e 6573 203d 205b 5d0a 2020 2020  _zones = [].    
+00004ee0: 2320 2020 2020 6472 6f70 5f62 6173 655f  #     drop_base_
+00004ef0: 7261 6c6c 795f 7a6f 6e65 203d 2046 616c  rally_zone = Fal
+00004f00: 7365 0a20 2020 2023 2020 2020 2072 616c  se.    #     ral
+00004f10: 6c79 5f62 6173 655f 7261 6c6c 795f 7a6f  ly_base_rally_zo
+00004f20: 6e65 203d 2046 616c 7365 0a20 2020 2020  ne = False.     
+00004f30: 2020 200a 2020 2020 2320 2020 2020 2320     .    #     # 
+00004f40: 4164 6469 7469 6f6e 616c 2076 6172 6961  Additional varia
+00004f50: 626c 6573 2074 6f20 7472 6163 6b20 6261  bles to track ba
+00004f60: 7365 2063 616e 646c 6520 7072 6963 6573  se candle prices
+00004f70: 2066 6f72 2070 726f 7869 6d61 6c20 6c69   for proximal li
+00004f80: 6e65 2063 616c 6375 6c61 7469 6f6e 0a20  ne calculation. 
+00004f90: 2020 2023 2020 2020 2062 6173 655f 6361     #     base_ca
+00004fa0: 6e64 6c65 5f70 7269 6365 7320 3d20 5b5d  ndle_prices = []
+00004fb0: 0a20 2020 2020 2020 200a 2020 2020 2320  .        .    # 
+00004fc0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00004fd0: 6765 286c 656e 2864 6174 6129 202d 2032  ge(len(data) - 2
+00004fe0: 293a 0a20 2020 2023 2020 2020 2020 2020  ):.    #        
+00004ff0: 2069 6620 6461 7461 5b27 4361 6e64 6c65   if data['Candle
+00005000: 2054 7970 6527 5d5b 695d 203d 3d20 2744   Type'][i] == 'D
+00005010: 726f 7020 4361 6e64 6c65 2720 616e 6420  rop Candle' and 
+00005020: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
+00005030: 6527 5d5b 6920 2b20 315d 203d 3d20 2742  e'][i + 1] == 'B
+00005040: 6173 6520 4361 6e64 6c65 273a 0a20 2020  ase Candle':.   
+00005050: 2023 2020 2020 2020 2020 2020 2020 2062   #             b
+00005060: 6173 655f 636f 756e 7420 3d20 310a 2020  ase_count = 1.  
+00005070: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00005080: 6a20 3d20 6920 2b20 320a 2020 2020 2320  j = i + 2.    # 
+00005090: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+000050a0: 6520 6a20 3c20 6c65 6e28 6461 7461 2920  e j < len(data) 
+000050b0: 616e 6420 6461 7461 5b27 4361 6e64 6c65  and data['Candle
+000050c0: 2054 7970 6527 5d5b 6a5d 203d 3d20 2742   Type'][j] == 'B
+000050d0: 6173 6520 4361 6e64 6c65 273a 0a20 2020  ase Candle':.   
+000050e0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+000050f0: 2020 2062 6173 655f 636f 756e 7420 2b3d     base_count +=
+00005100: 2031 0a20 2020 2023 2020 2020 2020 2020   1.    #        
+00005110: 2020 2020 2020 2020 206a 202b 3d20 310a           j += 1.
+00005120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005130: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00005140: 2020 2069 6620 6261 7365 5f63 6f75 6e74     if base_count
+00005150: 203c 3d20 343a 2020 2320 4d61 7869 6d75   <= 4:  # Maximu
+00005160: 6d20 6f66 2034 2062 6173 6520 6361 6e64  m of 4 base cand
+00005170: 6c65 7320 666f 7220 7765 656b 6c79 206f  les for weekly o
+00005180: 7220 6d6f 6e74 686c 7920 7469 6d65 6672  r monthly timefr
+00005190: 616d 652c 2065 6c73 6520 3320 666f 7220  ame, else 3 for 
+000051a0: 6461 696c 790a 2020 2020 2320 2020 2020  daily.    #     
+000051b0: 2020 2020 2020 2020 2020 2020 6966 206a              if j
+000051c0: 203c 206c 656e 2864 6174 6129 2061 6e64   < len(data) and
+000051d0: 2064 6174 615b 2743 616e 646c 6520 5479   data['Candle Ty
+000051e0: 7065 275d 5b6a 5d20 3d3d 2027 5261 6c6c  pe'][j] == 'Rall
+000051f0: 7920 4361 6e64 6c65 273a 0a20 2020 2023  y Candle':.    #
+00005200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005210: 2020 2020 2069 6620 6461 7461 5b27 436c       if data['Cl
+00005220: 6f73 6527 5d5b 6a5d 203e 2064 6174 615b  ose'][j] > data[
+00005230: 274c 6f77 275d 5b69 5d20 2b20 302e 3620  'Low'][i] + 0.6 
+00005240: 2a20 6461 7461 5b27 4361 6e64 6c65 2052  * data['Candle R
+00005250: 616e 6765 275d 5b69 5d20 616e 6420 6461  ange'][i] and da
+00005260: 7461 5b27 4869 6768 275d 5b69 5d20 3c3d  ta['High'][i] <=
+00005270: 2063 6d70 3a0a 2020 2020 2320 2020 2020   cmp:.    #     
+00005280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005290: 2020 2020 2320 4368 6563 6b20 666f 7220      # Check for 
+000052a0: 6f6e 6520 6d6f 7265 2072 616c 6c79 2063  one more rally c
+000052b0: 616e 646c 6520 6f72 2067 7265 656e 2062  andle or green b
+000052c0: 6173 6520 6361 6e64 6c65 0a20 2020 2023  ase candle.    #
 000052d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052e0: 2020 2020 2020 2020 2064 726f 705f 6261           drop_ba
-000052f0: 7365 5f72 616c 6c79 5f7a 6f6e 6520 3d20  se_rally_zone = 
-00005300: 5472 7565 0a20 2020 2023 2020 2020 2020  True.    #      
-00005310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005320: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00005330: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00005340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005350: 2020 206b 202b 3d20 310a 2020 2020 2320     k += 1.    # 
-00005360: 2020 2020 2020 2020 656c 6966 2064 6174          elif dat
-00005370: 615b 2743 616e 646c 6520 5479 7065 275d  a['Candle Type']
-00005380: 5b69 5d20 3d3d 2027 5261 6c6c 7920 4361  [i] == 'Rally Ca
-00005390: 6e64 6c65 2720 616e 6420 6461 7461 5b27  ndle' and data['
-000053a0: 4361 6e64 6c65 2054 7970 6527 5d5b 6920  Candle Type'][i 
-000053b0: 2b20 315d 203d 3d20 2742 6173 6520 4361  + 1] == 'Base Ca
-000053c0: 6e64 6c65 273a 0a20 2020 2023 2020 2020  ndle':.    #    
-000053d0: 2020 2020 2020 2020 2062 6173 655f 636f           base_co
-000053e0: 756e 7420 3d20 310a 2020 2020 2320 2020  unt = 1.    #   
-000053f0: 2020 2020 2020 2020 2020 6a20 3d20 6920            j = i 
-00005400: 2b20 320a 2020 2020 2320 2020 2020 2020  + 2.    #       
-00005410: 2020 2020 2020 7768 696c 6520 6a20 3c20        while j < 
-00005420: 6c65 6e28 6461 7461 2920 616e 6420 6461  len(data) and da
-00005430: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
-00005440: 5d5b 6a5d 203d 3d20 2742 6173 6520 4361  ][j] == 'Base Ca
-00005450: 6e64 6c65 273a 0a20 2020 2023 2020 2020  ndle':.    #    
-00005460: 2020 2020 2020 2020 2020 2020 2062 6173               bas
-00005470: 655f 636f 756e 7420 2b3d 2031 0a20 2020  e_count += 1.   
-00005480: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00005490: 2020 206a 202b 3d20 310a 2020 2020 2020     j += 1.      
-000054a0: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
-000054b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000054c0: 6261 7365 5f63 6f75 6e74 203e 3d20 313a  base_count >= 1:
-000054d0: 2020 2320 4174 206c 6561 7374 206f 6e65    # At least one
-000054e0: 2062 6173 6520 6361 6e64 6c65 2072 6571   base candle req
-000054f0: 7569 7265 640a 2020 2020 2320 2020 2020  uired.    #     
-00005500: 2020 2020 2020 2020 2020 2020 6966 206a              if j
-00005510: 203c 206c 656e 2864 6174 6129 2061 6e64   < len(data) and
-00005520: 2064 6174 615b 2743 616e 646c 6520 5479   data['Candle Ty
-00005530: 7065 275d 5b6a 5d20 3d3d 2027 5261 6c6c  pe'][j] == 'Rall
-00005540: 7920 4361 6e64 6c65 273a 0a20 2020 2023  y Candle':.    #
-00005550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005560: 2020 2020 2069 6620 6461 7461 5b27 436c       if data['Cl
-00005570: 6f73 6527 5d5b 6a5d 203e 2064 6174 615b  ose'][j] > data[
-00005580: 2743 6c6f 7365 275d 5b69 5d20 616e 6420  'Close'][i] and 
-00005590: 6461 7461 5b27 4869 6768 275d 5b69 5d20  data['High'][i] 
-000055a0: 3c3d 2063 6d70 3a20 2023 204e 6577 2063  <= cmp:  # New c
-000055b0: 6f6e 6469 7469 6f6e 3a20 636c 6f73 6520  ondition: close 
-000055c0: 6f66 2032 6e64 2072 616c 6c79 2063 616e  of 2nd rally can
-000055d0: 646c 6520 3e20 3173 7420 7261 6c6c 7920  dle > 1st rally 
-000055e0: 6361 6e64 6c65 0a20 2020 2023 2020 2020  candle.    #    
-000055f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005600: 2020 2020 2023 2043 6865 636b 2066 6f72       # Check for
-00005610: 206f 6e65 206d 6f72 6520 7261 6c6c 7920   one more rally 
-00005620: 6361 6e64 6c65 206f 7220 6772 6565 6e20  candle or green 
-00005630: 6261 7365 2063 616e 646c 650a 2020 2020  base candle.    
-00005640: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00005650: 2020 2020 2020 2020 2020 6b20 3d20 6a20            k = j 
-00005660: 2b20 310a 2020 2020 2320 2020 2020 2020  + 1.    #       
-00005670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005680: 2020 7768 696c 6520 6b20 3c20 6c65 6e28    while k < len(
-00005690: 6461 7461 293a 0a20 2020 2023 2020 2020  data):.    #    
-000056a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056b0: 2020 2020 2020 2020 2069 6620 6461 7461           if data
-000056c0: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
-000056d0: 6b5d 203d 3d20 2752 616c 6c79 2043 616e  k] == 'Rally Can
-000056e0: 646c 6527 206f 7220 2864 6174 615b 2743  dle' or (data['C
-000056f0: 616e 646c 6520 5479 7065 275d 5b6b 5d20  andle Type'][k] 
-00005700: 3d3d 2027 4261 7365 2043 616e 646c 6527  == 'Base Candle'
-00005710: 2061 6e64 2064 6174 615b 2743 6c6f 7365   and data['Close
-00005720: 275d 5b6b 5d20 3e20 6461 7461 5b27 4f70  '][k] > data['Op
-00005730: 656e 275d 5b6b 5d29 3a0a 2020 2020 2320  en'][k]):.    # 
-00005740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005760: 6465 6d61 6e64 5f7a 6f6e 6573 2e61 7070  demand_zones.app
-00005770: 656e 6428 2869 2c20 6a2c 2027 5261 6c6c  end((i, j, 'Rall
-00005780: 7920 4261 7365 2052 616c 6c79 272c 2062  y Base Rally', b
-00005790: 6173 655f 636f 756e 7429 290a 2020 2020  ase_count)).    
-000057a0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+000052e0: 2020 2020 2020 2020 206b 203d 206a 202b           k = j +
+000052f0: 2031 0a20 2020 2023 2020 2020 2020 2020   1.    #        
+00005300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005310: 2077 6869 6c65 206b 203c 206c 656e 2864   while k < len(d
+00005320: 6174 6129 3a0a 2020 2020 2320 2020 2020  ata):.    #     
+00005330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005340: 2020 2020 2020 2020 6966 2064 6174 615b          if data[
+00005350: 2743 616e 646c 6520 5479 7065 275d 5b6b  'Candle Type'][k
+00005360: 5d20 3d3d 2027 5261 6c6c 7920 4361 6e64  ] == 'Rally Cand
+00005370: 6c65 2720 6f72 2028 6461 7461 5b27 4361  le' or (data['Ca
+00005380: 6e64 6c65 2054 7970 6527 5d5b 6b5d 203d  ndle Type'][k] =
+00005390: 3d20 2742 6173 6520 4361 6e64 6c65 2720  = 'Base Candle' 
+000053a0: 616e 6420 6461 7461 5b27 436c 6f73 6527  and data['Close'
+000053b0: 5d5b 6b5d 203e 2064 6174 615b 274f 7065  ][k] > data['Ope
+000053c0: 6e27 5d5b 6b5d 293a 0a20 2020 2023 2020  n'][k]):.    #  
+000053d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000053e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000053f0: 656d 616e 645f 7a6f 6e65 732e 6170 7065  emand_zones.appe
+00005400: 6e64 2828 692c 206a 2c20 2744 726f 7020  nd((i, j, 'Drop 
+00005410: 4261 7365 2052 616c 6c79 272c 2062 6173  Base Rally', bas
+00005420: 655f 636f 756e 7429 290a 2020 2020 2320  e_count)).    # 
+00005430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005450: 6472 6f70 5f62 6173 655f 7261 6c6c 795f  drop_base_rally_
+00005460: 7a6f 6e65 203d 2054 7275 650a 2020 2020  zone = True.    
+00005470: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00005480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005490: 2020 6272 6561 6b0a 2020 2020 2320 2020    break.    #   
+000054a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054b0: 2020 2020 2020 2020 2020 6b20 2b3d 2031            k += 1
+000054c0: 0a20 2020 2023 2020 2020 2020 2020 2065  .    #         e
+000054d0: 6c69 6620 6461 7461 5b27 4361 6e64 6c65  lif data['Candle
+000054e0: 2054 7970 6527 5d5b 695d 203d 3d20 2752   Type'][i] == 'R
+000054f0: 616c 6c79 2043 616e 646c 6527 2061 6e64  ally Candle' and
+00005500: 2064 6174 615b 2743 616e 646c 6520 5479   data['Candle Ty
+00005510: 7065 275d 5b69 202b 2031 5d20 3d3d 2027  pe'][i + 1] == '
+00005520: 4261 7365 2043 616e 646c 6527 3a0a 2020  Base Candle':.  
+00005530: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00005540: 6261 7365 5f63 6f75 6e74 203d 2031 0a20  base_count = 1. 
+00005550: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00005560: 206a 203d 2069 202b 2032 0a20 2020 2023   j = i + 2.    #
+00005570: 2020 2020 2020 2020 2020 2020 2077 6869               whi
+00005580: 6c65 206a 203c 206c 656e 2864 6174 6129  le j < len(data)
+00005590: 2061 6e64 2064 6174 615b 2743 616e 646c   and data['Candl
+000055a0: 6520 5479 7065 275d 5b6a 5d20 3d3d 2027  e Type'][j] == '
+000055b0: 4261 7365 2043 616e 646c 6527 3a0a 2020  Base Candle':.  
+000055c0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000055d0: 2020 2020 6261 7365 5f63 6f75 6e74 202b      base_count +
+000055e0: 3d20 310a 2020 2020 2320 2020 2020 2020  = 1.    #       
+000055f0: 2020 2020 2020 2020 2020 6a20 2b3d 2031            j += 1
+00005600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005610: 200a 2020 2020 2320 2020 2020 2020 2020   .    #         
+00005620: 2020 2020 6966 2062 6173 655f 636f 756e      if base_coun
+00005630: 7420 3e3d 2031 3a20 2023 2041 7420 6c65  t >= 1:  # At le
+00005640: 6173 7420 6f6e 6520 6261 7365 2063 616e  ast one base can
+00005650: 646c 6520 7265 7175 6972 6564 0a20 2020  dle required.   
+00005660: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00005670: 2020 2069 6620 6a20 3c20 6c65 6e28 6461     if j < len(da
+00005680: 7461 2920 616e 6420 6461 7461 5b27 4361  ta) and data['Ca
+00005690: 6e64 6c65 2054 7970 6527 5d5b 6a5d 203d  ndle Type'][j] =
+000056a0: 3d20 2752 616c 6c79 2043 616e 646c 6527  = 'Rally Candle'
+000056b0: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+000056c0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+000056d0: 6174 615b 2743 6c6f 7365 275d 5b6a 5d20  ata['Close'][j] 
+000056e0: 3e20 6461 7461 5b27 436c 6f73 6527 5d5b  > data['Close'][
+000056f0: 695d 2061 6e64 2064 6174 615b 2748 6967  i] and data['Hig
+00005700: 6827 5d5b 695d 203c 3d20 636d 703a 2020  h'][i] <= cmp:  
+00005710: 2320 4e65 7720 636f 6e64 6974 696f 6e3a  # New condition:
+00005720: 2063 6c6f 7365 206f 6620 326e 6420 7261   close of 2nd ra
+00005730: 6c6c 7920 6361 6e64 6c65 203e 2031 7374  lly candle > 1st
+00005740: 2072 616c 6c79 2063 616e 646c 650a 2020   rally candle.  
+00005750: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00005760: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
+00005770: 6563 6b20 666f 7220 6f6e 6520 6d6f 7265  eck for one more
+00005780: 2072 616c 6c79 2063 616e 646c 6520 6f72   rally candle or
+00005790: 2067 7265 656e 2062 6173 6520 6361 6e64   green base cand
+000057a0: 6c65 0a20 2020 2023 2020 2020 2020 2020  le.    #        
 000057b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057c0: 2020 7261 6c6c 795f 6261 7365 5f72 616c    rally_base_ral
-000057d0: 6c79 5f7a 6f6e 6520 3d20 5472 7565 0a20  ly_zone = True. 
-000057e0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-000057f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005800: 2020 2020 2062 7265 616b 0a20 2020 2023       break.    #
+000057c0: 206b 203d 206a 202b 2031 0a20 2020 2023   k = j + 1.    #
+000057d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000057e0: 2020 2020 2020 2020 2077 6869 6c65 206b           while k
+000057f0: 203c 206c 656e 2864 6174 6129 3a0a 2020   < len(data):.  
+00005800: 2020 2320 2020 2020 2020 2020 2020 2020    #             
 00005810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005820: 2020 2020 2020 2020 2020 2020 206b 202b               k +
-00005830: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00005840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005850: 0a20 2020 2023 2020 2020 2020 2020 2023  .    #         #
-00005860: 2043 6f6c 6c65 6374 2062 6173 6520 6361   Collect base ca
-00005870: 6e64 6c65 2070 7269 6365 7320 666f 7220  ndle prices for 
-00005880: 7072 6f78 696d 616c 206c 696e 6520 6361  proximal line ca
-00005890: 6c63 756c 6174 696f 6e0a 2020 2020 2320  lculation.    # 
-000058a0: 2020 2020 2020 2020 6966 2064 6174 615b          if data[
-000058b0: 2743 616e 646c 6520 5479 7065 275d 5b69  'Candle Type'][i
-000058c0: 5d20 3d3d 2027 4261 7365 2043 616e 646c  ] == 'Base Candl
-000058d0: 6527 3a0a 2020 2020 2320 2020 2020 2020  e':.    #       
-000058e0: 2020 2020 2020 6261 7365 5f63 616e 646c        base_candl
-000058f0: 655f 7072 6963 6573 2e61 7070 656e 6428  e_prices.append(
-00005900: 6461 7461 5b27 436c 6f73 6527 5d5b 695d  data['Close'][i]
-00005910: 290a 0a20 2020 2023 2020 2020 2023 2043  )..    #     # C
-00005920: 616c 6375 6c61 7465 2070 726f 7869 6d61  alculate proxima
-00005930: 6c20 6c69 6e65 2070 7269 6365 2028 6869  l line price (hi
-00005940: 6768 6573 7420 7072 6963 6520 616d 6f6e  ghest price amon
-00005950: 6720 6261 7365 2063 616e 646c 6573 290a  g base candles).
-00005960: 2020 2020 2320 2020 2020 7072 6f78 696d      #     proxim
-00005970: 616c 5f6c 696e 655f 7072 6963 6520 3d20  al_line_price = 
-00005980: 6d61 7828 6261 7365 5f63 616e 646c 655f  max(base_candle_
-00005990: 7072 6963 6573 2920 6966 2062 6173 655f  prices) if base_
-000059a0: 6361 6e64 6c65 5f70 7269 6365 7320 656c  candle_prices el
-000059b0: 7365 204e 6f6e 650a 0a20 2020 2023 2020  se None..    #  
-000059c0: 2020 2072 6574 7572 6e20 6465 6d61 6e64     return demand
-000059d0: 5f7a 6f6e 6573 2c20 6472 6f70 5f62 6173  _zones, drop_bas
-000059e0: 655f 7261 6c6c 795f 7a6f 6e65 2c20 7261  e_rally_zone, ra
-000059f0: 6c6c 795f 6261 7365 5f72 616c 6c79 5f7a  lly_base_rally_z
-00005a00: 6f6e 652c 2070 726f 7869 6d61 6c5f 6c69  one, proximal_li
-00005a10: 6e65 5f70 7269 6365 0a0a 2020 2020 2320  ne_price..    # 
-00005a20: 6465 6620 6964 656e 7469 6679 5f73 7570  def identify_sup
-00005a30: 706c 795f 7a6f 6e65 2873 656c 662c 6461  ply_zone(self,da
-00005a40: 7461 2c20 636d 7029 3a0a 2020 2020 2320  ta, cmp):.    # 
-00005a50: 2020 2020 7375 7070 6c79 5f7a 6f6e 6573      supply_zones
-00005a60: 203d 205b 5d0a 2020 2020 2320 2020 2020   = [].    #     
-00005a70: 7261 6c6c 795f 6261 7365 5f64 726f 705f  rally_base_drop_
-00005a80: 7a6f 6e65 203d 2046 616c 7365 0a20 2020  zone = False.   
-00005a90: 2023 2020 2020 2064 726f 705f 6261 7365   #     drop_base
-00005aa0: 5f64 726f 705f 7a6f 6e65 203d 2046 616c  _drop_zone = Fal
-00005ab0: 7365 0a20 2020 2020 2020 200a 2020 2020  se.        .    
-00005ac0: 2320 2020 2020 2320 4164 6469 7469 6f6e  #     # Addition
-00005ad0: 616c 2076 6172 6961 626c 6573 2074 6f20  al variables to 
-00005ae0: 7472 6163 6b20 6261 7365 2063 616e 646c  track base candl
-00005af0: 6520 7072 6963 6573 2066 6f72 2070 726f  e prices for pro
-00005b00: 7869 6d61 6c20 6c69 6e65 2063 616c 6375  ximal line calcu
-00005b10: 6c61 7469 6f6e 0a20 2020 2023 2020 2020  lation.    #    
-00005b20: 2062 6173 655f 6361 6e64 6c65 5f70 7269   base_candle_pri
-00005b30: 6365 7320 3d20 5b5d 0a20 2020 2020 2020  ces = [].       
-00005b40: 200a 2020 2020 2320 2020 2020 666f 7220   .    #     for 
-00005b50: 6920 696e 2072 616e 6765 286c 656e 2864  i in range(len(d
-00005b60: 6174 6129 202d 2032 293a 0a20 2020 2023  ata) - 2):.    #
-00005b70: 2020 2020 2020 2020 2069 6620 6461 7461           if data
-00005b80: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
-00005b90: 695d 203d 3d20 2744 726f 7020 4361 6e64  i] == 'Drop Cand
-00005ba0: 6c65 2720 616e 6420 6461 7461 5b27 4361  le' and data['Ca
-00005bb0: 6e64 6c65 2054 7970 6527 5d5b 6920 2b20  ndle Type'][i + 
-00005bc0: 315d 203d 3d20 2742 6173 6520 4361 6e64  1] == 'Base Cand
-00005bd0: 6c65 273a 0a20 2020 2023 2020 2020 2020  le':.    #      
-00005be0: 2020 2020 2020 2062 6173 655f 636f 756e         base_coun
-00005bf0: 7420 3d20 310a 2020 2020 2320 2020 2020  t = 1.    #     
-00005c00: 2020 2020 2020 2020 6a20 3d20 6920 2b20          j = i + 
-00005c10: 320a 2020 2020 2320 2020 2020 2020 2020  2.    #         
-00005c20: 2020 2020 7768 696c 6520 6a20 3c20 6c65      while j < le
-00005c30: 6e28 6461 7461 2920 616e 6420 6461 7461  n(data) and data
-00005c40: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
-00005c50: 6a5d 203d 3d20 2742 6173 6520 4361 6e64  j] == 'Base Cand
-00005c60: 6c65 273a 0a20 2020 2023 2020 2020 2020  le':.    #      
-00005c70: 2020 2020 2020 2020 2020 2062 6173 655f             base_
-00005c80: 636f 756e 7420 2b3d 2031 0a20 2020 2023  count += 1.    #
-00005c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ca0: 206a 202b 3d20 310a 2020 2020 2020 2020   j += 1.        
-00005cb0: 2020 2020 2020 2020 0a20 2020 2023 2020          .    #  
-00005cc0: 2020 2020 2020 2020 2020 2069 6620 6261             if ba
-00005cd0: 7365 5f63 6f75 6e74 203c 3d20 343a 2020  se_count <= 4:  
-00005ce0: 2320 4d61 7869 6d75 6d20 6f66 2034 2062  # Maximum of 4 b
-00005cf0: 6173 6520 6361 6e64 6c65 7320 666f 7220  ase candles for 
-00005d00: 7765 656b 6c79 206f 7220 6d6f 6e74 686c  weekly or monthl
-00005d10: 7920 7469 6d65 6672 616d 652c 2065 6c73  y timeframe, els
-00005d20: 6520 3320 666f 7220 6461 696c 790a 2020  e 3 for daily.  
-00005d30: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00005d40: 2020 2020 6966 206a 203c 206c 656e 2864      if j < len(d
-00005d50: 6174 6129 2061 6e64 2064 6174 615b 2743  ata) and data['C
-00005d60: 616e 646c 6520 5479 7065 275d 5b6a 5d20  andle Type'][j] 
-00005d70: 3d3d 2027 4472 6f70 2043 616e 646c 6527  == 'Drop Candle'
-00005d80: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-00005d90: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00005da0: 6174 615b 2743 6c6f 7365 275d 5b69 5d20  ata['Close'][i] 
-00005db0: 3c20 6461 7461 5b27 4c6f 7727 5d5b 6a5d  < data['Low'][j]
-00005dc0: 2061 6e64 2064 6174 615b 274c 6f77 275d   and data['Low']
-00005dd0: 5b69 5d20 3e3d 2063 6d70 3a20 2023 204e  [i] >= cmp:  # N
-00005de0: 6577 2063 6f6e 6469 7469 6f6e 3a20 636c  ew condition: cl
-00005df0: 6f73 6520 6f66 2064 726f 7020 6361 6e64  ose of drop cand
-00005e00: 6c65 203c 206c 6f77 206f 6620 6261 7365  le < low of base
-00005e10: 2063 616e 646c 650a 2020 2020 2320 2020   candle.    #   
-00005e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e30: 2020 2020 2020 2320 4e65 7720 6c6f 6769        # New logi
-00005e40: 633a 204c 6f6f 6b20 666f 7220 6f6e 6520  c: Look for one 
-00005e50: 6d6f 7265 2064 726f 7020 6361 6e64 6c65  more drop candle
-00005e60: 206f 7220 7265 6420 6261 7365 2063 616e   or red base can
-00005e70: 646c 650a 2020 2020 2320 2020 2020 2020  dle.    #       
-00005e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e90: 2020 6b20 3d20 6a20 2b20 310a 2020 2020    k = j + 1.    
-00005ea0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00005eb0: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-00005ec0: 6b20 3c20 6c65 6e28 6461 7461 2920 616e  k < len(data) an
-00005ed0: 6420 2864 6174 615b 2743 616e 646c 6520  d (data['Candle 
-00005ee0: 5479 7065 275d 5b6b 5d20 3d3d 2027 4472  Type'][k] == 'Dr
-00005ef0: 6f70 2043 616e 646c 6527 206f 7220 6461  op Candle' or da
-00005f00: 7461 5b27 436c 6f73 6527 5d5b 6b5d 203c  ta['Close'][k] <
-00005f10: 2064 6174 615b 274f 7065 6e27 5d5b 6b5d   data['Open'][k]
-00005f20: 293a 0a20 2020 2023 2020 2020 2020 2020  ):.    #        
-00005f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f40: 2020 2020 206b 202b 3d20 310a 2020 2020       k += 1.    
-00005f50: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00005f60: 2020 2020 2020 2020 2020 6966 206b 203c            if k <
-00005f70: 206c 656e 2864 6174 6129 2061 6e64 2028   len(data) and (
-00005f80: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
-00005f90: 6527 5d5b 6b5d 203d 3d20 2744 726f 7020  e'][k] == 'Drop 
-00005fa0: 4361 6e64 6c65 2720 6f72 2064 6174 615b  Candle' or data[
-00005fb0: 2743 6c6f 7365 275d 5b6b 5d20 3c20 6461  'Close'][k] < da
-00005fc0: 7461 5b27 4f70 656e 275d 5b6b 5d29 3a0a  ta['Open'][k]):.
-00005fd0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00005820: 6966 2064 6174 615b 2743 616e 646c 6520  if data['Candle 
+00005830: 5479 7065 275d 5b6b 5d20 3d3d 2027 5261  Type'][k] == 'Ra
+00005840: 6c6c 7920 4361 6e64 6c65 2720 6f72 2028  lly Candle' or (
+00005850: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
+00005860: 6527 5d5b 6b5d 203d 3d20 2742 6173 6520  e'][k] == 'Base 
+00005870: 4361 6e64 6c65 2720 616e 6420 6461 7461  Candle' and data
+00005880: 5b27 436c 6f73 6527 5d5b 6b5d 203e 2064  ['Close'][k] > d
+00005890: 6174 615b 274f 7065 6e27 5d5b 6b5d 293a  ata['Open'][k]):
+000058a0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+000058b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000058c0: 2020 2020 2020 2064 656d 616e 645f 7a6f         demand_zo
+000058d0: 6e65 732e 6170 7065 6e64 2828 692c 206a  nes.append((i, j
+000058e0: 2c20 2752 616c 6c79 2042 6173 6520 5261  , 'Rally Base Ra
+000058f0: 6c6c 7927 2c20 6261 7365 5f63 6f75 6e74  lly', base_count
+00005900: 2929 0a20 2020 2023 2020 2020 2020 2020  )).    #        
+00005910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005920: 2020 2020 2020 2020 2072 616c 6c79 5f62           rally_b
+00005930: 6173 655f 7261 6c6c 795f 7a6f 6e65 203d  ase_rally_zone =
+00005940: 2054 7275 650a 2020 2020 2320 2020 2020   True.    #     
+00005950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005960: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00005970: 6b0a 2020 2020 2320 2020 2020 2020 2020  k.    #         
+00005980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005990: 2020 2020 6b20 2b3d 2031 0a20 2020 2020      k += 1.     
+000059a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059b0: 2020 2020 2020 200a 2020 2020 2320 2020         .    #   
+000059c0: 2020 2020 2020 2320 436f 6c6c 6563 7420        # Collect 
+000059d0: 6261 7365 2063 616e 646c 6520 7072 6963  base candle pric
+000059e0: 6573 2066 6f72 2070 726f 7869 6d61 6c20  es for proximal 
+000059f0: 6c69 6e65 2063 616c 6375 6c61 7469 6f6e  line calculation
+00005a00: 0a20 2020 2023 2020 2020 2020 2020 2069  .    #         i
+00005a10: 6620 6461 7461 5b27 4361 6e64 6c65 2054  f data['Candle T
+00005a20: 7970 6527 5d5b 695d 203d 3d20 2742 6173  ype'][i] == 'Bas
+00005a30: 6520 4361 6e64 6c65 273a 0a20 2020 2023  e Candle':.    #
+00005a40: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+00005a50: 655f 6361 6e64 6c65 5f70 7269 6365 732e  e_candle_prices.
+00005a60: 6170 7065 6e64 2864 6174 615b 2743 6c6f  append(data['Clo
+00005a70: 7365 275d 5b69 5d29 0a0a 2020 2020 2320  se'][i])..    # 
+00005a80: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
+00005a90: 7072 6f78 696d 616c 206c 696e 6520 7072  proximal line pr
+00005aa0: 6963 6520 2868 6967 6865 7374 2070 7269  ice (highest pri
+00005ab0: 6365 2061 6d6f 6e67 2062 6173 6520 6361  ce among base ca
+00005ac0: 6e64 6c65 7329 0a20 2020 2023 2020 2020  ndles).    #    
+00005ad0: 2070 726f 7869 6d61 6c5f 6c69 6e65 5f70   proximal_line_p
+00005ae0: 7269 6365 203d 206d 6178 2862 6173 655f  rice = max(base_
+00005af0: 6361 6e64 6c65 5f70 7269 6365 7329 2069  candle_prices) i
+00005b00: 6620 6261 7365 5f63 616e 646c 655f 7072  f base_candle_pr
+00005b10: 6963 6573 2065 6c73 6520 4e6f 6e65 0a0a  ices else None..
+00005b20: 2020 2020 2320 2020 2020 7265 7475 726e      #     return
+00005b30: 2064 656d 616e 645f 7a6f 6e65 732c 2064   demand_zones, d
+00005b40: 726f 705f 6261 7365 5f72 616c 6c79 5f7a  rop_base_rally_z
+00005b50: 6f6e 652c 2072 616c 6c79 5f62 6173 655f  one, rally_base_
+00005b60: 7261 6c6c 795f 7a6f 6e65 2c20 7072 6f78  rally_zone, prox
+00005b70: 696d 616c 5f6c 696e 655f 7072 6963 650a  imal_line_price.
+00005b80: 0a20 2020 2023 2064 6566 2069 6465 6e74  .    # def ident
+00005b90: 6966 795f 7375 7070 6c79 5f7a 6f6e 6528  ify_supply_zone(
+00005ba0: 7365 6c66 2c64 6174 612c 2063 6d70 293a  self,data, cmp):
+00005bb0: 0a20 2020 2023 2020 2020 2073 7570 706c  .    #     suppl
+00005bc0: 795f 7a6f 6e65 7320 3d20 5b5d 0a20 2020  y_zones = [].   
+00005bd0: 2023 2020 2020 2072 616c 6c79 5f62 6173   #     rally_bas
+00005be0: 655f 6472 6f70 5f7a 6f6e 6520 3d20 4661  e_drop_zone = Fa
+00005bf0: 6c73 650a 2020 2020 2320 2020 2020 6472  lse.    #     dr
+00005c00: 6f70 5f62 6173 655f 6472 6f70 5f7a 6f6e  op_base_drop_zon
+00005c10: 6520 3d20 4661 6c73 650a 2020 2020 2020  e = False.      
+00005c20: 2020 0a20 2020 2023 2020 2020 2023 2041    .    #     # A
+00005c30: 6464 6974 696f 6e61 6c20 7661 7269 6162  dditional variab
+00005c40: 6c65 7320 746f 2074 7261 636b 2062 6173  les to track bas
+00005c50: 6520 6361 6e64 6c65 2070 7269 6365 7320  e candle prices 
+00005c60: 666f 7220 7072 6f78 696d 616c 206c 696e  for proximal lin
+00005c70: 6520 6361 6c63 756c 6174 696f 6e0a 2020  e calculation.  
+00005c80: 2020 2320 2020 2020 6261 7365 5f63 616e    #     base_can
+00005c90: 646c 655f 7072 6963 6573 203d 205b 5d0a  dle_prices = [].
+00005ca0: 2020 2020 2020 2020 0a20 2020 2023 2020          .    #  
+00005cb0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00005cc0: 6528 6c65 6e28 6461 7461 2920 2d20 3229  e(len(data) - 2)
+00005cd0: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+00005ce0: 6966 2064 6174 615b 2743 616e 646c 6520  if data['Candle 
+00005cf0: 5479 7065 275d 5b69 5d20 3d3d 2027 4472  Type'][i] == 'Dr
+00005d00: 6f70 2043 616e 646c 6527 2061 6e64 2064  op Candle' and d
+00005d10: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
+00005d20: 275d 5b69 202b 2031 5d20 3d3d 2027 4261  '][i + 1] == 'Ba
+00005d30: 7365 2043 616e 646c 6527 3a0a 2020 2020  se Candle':.    
+00005d40: 2320 2020 2020 2020 2020 2020 2020 6261  #             ba
+00005d50: 7365 5f63 6f75 6e74 203d 2031 0a20 2020  se_count = 1.   
+00005d60: 2023 2020 2020 2020 2020 2020 2020 206a   #             j
+00005d70: 203d 2069 202b 2032 0a20 2020 2023 2020   = i + 2.    #  
+00005d80: 2020 2020 2020 2020 2020 2077 6869 6c65             while
+00005d90: 206a 203c 206c 656e 2864 6174 6129 2061   j < len(data) a
+00005da0: 6e64 2064 6174 615b 2743 616e 646c 6520  nd data['Candle 
+00005db0: 5479 7065 275d 5b6a 5d20 3d3d 2027 4261  Type'][j] == 'Ba
+00005dc0: 7365 2043 616e 646c 6527 3a0a 2020 2020  se Candle':.    
+00005dd0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00005de0: 2020 6261 7365 5f63 6f75 6e74 202b 3d20    base_count += 
+00005df0: 310a 2020 2020 2320 2020 2020 2020 2020  1.    #         
+00005e00: 2020 2020 2020 2020 6a20 2b3d 2031 0a20          j += 1. 
+00005e10: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+00005e20: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00005e30: 2020 6966 2062 6173 655f 636f 756e 7420    if base_count 
+00005e40: 3c3d 2034 3a20 2023 204d 6178 696d 756d  <= 4:  # Maximum
+00005e50: 206f 6620 3420 6261 7365 2063 616e 646c   of 4 base candl
+00005e60: 6573 2066 6f72 2077 6565 6b6c 7920 6f72  es for weekly or
+00005e70: 206d 6f6e 7468 6c79 2074 696d 6566 7261   monthly timefra
+00005e80: 6d65 2c20 656c 7365 2033 2066 6f72 2064  me, else 3 for d
+00005e90: 6169 6c79 0a20 2020 2023 2020 2020 2020  aily.    #      
+00005ea0: 2020 2020 2020 2020 2020 2069 6620 6a20             if j 
+00005eb0: 3c20 6c65 6e28 6461 7461 2920 616e 6420  < len(data) and 
+00005ec0: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
+00005ed0: 6527 5d5b 6a5d 203d 3d20 2744 726f 7020  e'][j] == 'Drop 
+00005ee0: 4361 6e64 6c65 273a 0a20 2020 2023 2020  Candle':.    #  
+00005ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f00: 2020 2069 6620 6461 7461 5b27 436c 6f73     if data['Clos
+00005f10: 6527 5d5b 695d 203c 2064 6174 615b 274c  e'][i] < data['L
+00005f20: 6f77 275d 5b6a 5d20 616e 6420 6461 7461  ow'][j] and data
+00005f30: 5b27 4c6f 7727 5d5b 695d 203e 3d20 636d  ['Low'][i] >= cm
+00005f40: 703a 2020 2320 4e65 7720 636f 6e64 6974  p:  # New condit
+00005f50: 696f 6e3a 2063 6c6f 7365 206f 6620 6472  ion: close of dr
+00005f60: 6f70 2063 616e 646c 6520 3c20 6c6f 7720  op candle < low 
+00005f70: 6f66 2062 6173 6520 6361 6e64 6c65 0a20  of base candle. 
+00005f80: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00005f90: 2020 2020 2020 2020 2020 2020 2023 204e               # N
+00005fa0: 6577 206c 6f67 6963 3a20 4c6f 6f6b 2066  ew logic: Look f
+00005fb0: 6f72 206f 6e65 206d 6f72 6520 6472 6f70  or one more drop
+00005fc0: 2063 616e 646c 6520 6f72 2072 6564 2062   candle or red b
+00005fd0: 6173 6520 6361 6e64 6c65 0a20 2020 2023  ase candle.    #
 00005fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ff0: 2020 7375 7070 6c79 5f7a 6f6e 6573 2e61    supply_zones.a
-00006000: 7070 656e 6428 2869 2c20 6a2c 2027 4472  ppend((i, j, 'Dr
-00006010: 6f70 2042 6173 6520 4472 6f70 272c 2062  op Base Drop', b
-00006020: 6173 655f 636f 756e 7429 290a 2020 2020  ase_count)).    
-00006030: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00006040: 2020 2020 2020 2020 2020 2020 2020 6472                dr
-00006050: 6f70 5f62 6173 655f 6472 6f70 5f7a 6f6e  op_base_drop_zon
-00006060: 6520 3d20 5472 7565 0a20 2020 2023 2020  e = True.    #  
-00006070: 2020 2020 2020 2065 6c69 6620 6461 7461         elif data
-00006080: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
-00006090: 695d 203d 3d20 2752 616c 6c79 2043 616e  i] == 'Rally Can
-000060a0: 646c 6527 2061 6e64 2064 6174 615b 2743  dle' and data['C
-000060b0: 616e 646c 6520 5479 7065 275d 5b69 202b  andle Type'][i +
-000060c0: 2031 5d20 3d3d 2027 4261 7365 2043 616e   1] == 'Base Can
-000060d0: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
-000060e0: 2020 2020 2020 2020 6261 7365 5f63 6f75          base_cou
-000060f0: 6e74 203d 2031 0a20 2020 2023 2020 2020  nt = 1.    #    
-00006100: 2020 2020 2020 2020 206a 203d 2069 202b           j = i +
-00006110: 2032 0a20 2020 2023 2020 2020 2020 2020   2.    #        
-00006120: 2020 2020 2077 6869 6c65 206a 203c 206c       while j < l
-00006130: 656e 2864 6174 6129 2061 6e64 2064 6174  en(data) and dat
-00006140: 615b 2743 616e 646c 6520 5479 7065 275d  a['Candle Type']
-00006150: 5b6a 5d20 3d3d 2027 4261 7365 2043 616e  [j] == 'Base Can
-00006160: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
-00006170: 2020 2020 2020 2020 2020 2020 6261 7365              base
-00006180: 5f63 6f75 6e74 202b 3d20 310a 2020 2020  _count += 1.    
-00006190: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000061a0: 2020 6a20 2b3d 2031 0a20 2020 2020 2020    j += 1.       
-000061b0: 2020 2020 2020 2020 200a 2020 2020 2320           .    # 
-000061c0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-000061d0: 6173 655f 636f 756e 7420 3e3d 2031 3a20  ase_count >= 1: 
-000061e0: 2023 2041 7420 6c65 6173 7420 6f6e 6520   # At least one 
-000061f0: 6261 7365 2063 616e 646c 6520 7265 7175  base candle requ
-00006200: 6972 6564 0a20 2020 2023 2020 2020 2020  ired.    #      
-00006210: 2020 2020 2020 2020 2020 2069 6620 6a20             if j 
-00006220: 3c20 6c65 6e28 6461 7461 2920 616e 6420  < len(data) and 
-00006230: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
-00006240: 6527 5d5b 6a5d 203d 3d20 2744 726f 7020  e'][j] == 'Drop 
-00006250: 4361 6e64 6c65 273a 0a20 2020 2023 2020  Candle':.    #  
-00006260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006270: 2020 2069 6620 6461 7461 5b27 436c 6f73     if data['Clos
-00006280: 6527 5d5b 6a5d 203c 2064 6174 615b 274f  e'][j] < data['O
-00006290: 7065 6e27 5d5b 6a5d 2061 6e64 2064 6174  pen'][j] and dat
-000062a0: 615b 274c 6f77 275d 5b69 5d20 3e3d 2063  a['Low'][i] >= c
-000062b0: 6d70 3a20 2023 204d 6f64 6966 6965 6420  mp:  # Modified 
-000062c0: 636f 6e64 6974 696f 6e3a 2063 6c6f 7365  condition: close
-000062d0: 206f 6620 6472 6f70 2063 616e 646c 6520   of drop candle 
-000062e0: 3c20 6f70 656e 206f 6620 6472 6f70 2063  < open of drop c
-000062f0: 616e 646c 650a 2020 2020 2320 2020 2020  andle.    #     
-00006300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006310: 2020 2020 7375 7070 6c79 5f7a 6f6e 6573      supply_zones
-00006320: 2e61 7070 656e 6428 2869 2c20 6a2c 2027  .append((i, j, '
-00006330: 5261 6c6c 7920 4261 7365 2044 726f 7027  Rally Base Drop'
-00006340: 2c20 6261 7365 5f63 6f75 6e74 2929 0a20  , base_count)). 
-00006350: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00006360: 2020 2020 2020 2020 2020 2020 2072 616c               ral
-00006370: 6c79 5f62 6173 655f 6472 6f70 5f7a 6f6e  ly_base_drop_zon
-00006380: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
-00006390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000063a0: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
-000063b0: 2020 2020 2320 436f 6c6c 6563 7420 6261      # Collect ba
-000063c0: 7365 2063 616e 646c 6520 7072 6963 6573  se candle prices
-000063d0: 2066 6f72 2070 726f 7869 6d61 6c20 6c69   for proximal li
-000063e0: 6e65 2063 616c 6375 6c61 7469 6f6e 0a20  ne calculation. 
-000063f0: 2020 2023 2020 2020 2020 2020 2069 6620     #         if 
-00006400: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
-00006410: 6527 5d5b 695d 203d 3d20 2742 6173 6520  e'][i] == 'Base 
-00006420: 4361 6e64 6c65 273a 0a20 2020 2023 2020  Candle':.    #  
-00006430: 2020 2020 2020 2020 2020 2062 6173 655f             base_
-00006440: 6361 6e64 6c65 5f70 7269 6365 732e 6170  candle_prices.ap
-00006450: 7065 6e64 2864 6174 615b 2743 6c6f 7365  pend(data['Close
-00006460: 275d 5b69 5d29 0a0a 2020 2020 2320 2020  '][i])..    #   
-00006470: 2020 2320 4361 6c63 756c 6174 6520 7072    # Calculate pr
-00006480: 6f78 696d 616c 206c 696e 6520 7072 6963  oximal line pric
-00006490: 6520 286c 6f77 6573 7420 7072 6963 6520  e (lowest price 
-000064a0: 616d 6f6e 6720 6261 7365 2063 616e 646c  among base candl
-000064b0: 6573 290a 2020 2020 2320 2020 2020 7072  es).    #     pr
-000064c0: 6f78 696d 616c 5f6c 696e 655f 7072 6963  oximal_line_pric
-000064d0: 6520 3d20 6d69 6e28 6261 7365 5f63 616e  e = min(base_can
-000064e0: 646c 655f 7072 6963 6573 2920 6966 2062  dle_prices) if b
-000064f0: 6173 655f 6361 6e64 6c65 5f70 7269 6365  ase_candle_price
-00006500: 7320 656c 7365 204e 6f6e 650a 0a20 2020  s else None..   
-00006510: 2023 2020 2020 2072 6574 7572 6e20 7375   #     return su
-00006520: 7070 6c79 5f7a 6f6e 6573 2c20 7261 6c6c  pply_zones, rall
-00006530: 795f 6261 7365 5f64 726f 705f 7a6f 6e65  y_base_drop_zone
-00006540: 2c20 6472 6f70 5f62 6173 655f 6472 6f70  , drop_base_drop
-00006550: 5f7a 6f6e 652c 2070 726f 7869 6d61 6c5f  _zone, proximal_
-00006560: 6c69 6e65 5f70 7269 6365 0a0a 2020 2020  line_price..    
-00006570: 2320 6465 6620 6361 6c63 756c 6174 655f  # def calculate_
-00006580: 6465 6d61 6e64 5f70 726f 7869 6d61 6c5f  demand_proximal_
-00006590: 6c69 6e65 7328 7365 6c66 2c64 6174 612c  lines(self,data,
-000065a0: 2064 656d 616e 645f 7a6f 6e65 7329 3a0a   demand_zones):.
-000065b0: 2020 2020 2320 2020 2020 7072 6f78 696d      #     proxim
-000065c0: 616c 5f6c 696e 655f 7072 6963 6573 203d  al_line_prices =
-000065d0: 205b 5d0a 2020 2020 2320 2020 2020 666f   [].    #     fo
-000065e0: 7220 7374 6172 742c 2065 6e64 2c20 5f2c  r start, end, _,
-000065f0: 205f 2069 6e20 6465 6d61 6e64 5f7a 6f6e   _ in demand_zon
-00006600: 6573 3a0a 2020 2020 2320 2020 2020 2020  es:.    #       
-00006610: 2020 6261 7365 5f63 616e 646c 655f 7072    base_candle_pr
-00006620: 6963 6573 203d 2064 6174 612e 6c6f 635b  ices = data.loc[
-00006630: 2864 6174 615b 2743 616e 646c 6520 5479  (data['Candle Ty
-00006640: 7065 275d 203d 3d20 2742 6173 6520 4361  pe'] == 'Base Ca
-00006650: 6e64 6c65 2729 2026 2028 6461 7461 2e69  ndle') & (data.i
-00006660: 6e64 6578 203e 3d20 6461 7461 2e69 6e64  ndex >= data.ind
-00006670: 6578 5b73 7461 7274 5d29 2026 2028 6461  ex[start]) & (da
-00006680: 7461 2e69 6e64 6578 203c 3d20 6461 7461  ta.index <= data
-00006690: 2e69 6e64 6578 5b65 6e64 5d29 2c20 5b27  .index[end]), ['
-000066a0: 4f70 656e 272c 2027 436c 6f73 6527 5d5d  Open', 'Close']]
-000066b0: 0a20 2020 2023 2020 2020 2020 2020 206d  .    #         m
-000066c0: 6178 5f70 7269 6365 203d 2062 6173 655f  ax_price = base_
-000066d0: 6361 6e64 6c65 5f70 7269 6365 732e 6d61  candle_prices.ma
-000066e0: 7828 6178 6973 3d31 292e 6d61 7828 2920  x(axis=1).max() 
-000066f0: 2023 2047 6574 2074 6865 206d 6178 696d   # Get the maxim
-00006700: 756d 2070 7269 6365 2061 6d6f 6e67 2061  um price among a
-00006710: 6c6c 2062 6173 6520 6361 6e64 6c65 7327  ll base candles'
-00006720: 206f 7065 6e20 616e 6420 636c 6f73 6520   open and close 
-00006730: 7072 6963 6573 0a20 2020 2023 2020 2020  prices.    #    
-00006740: 2020 2020 2070 726f 7869 6d61 6c5f 6c69       proximal_li
-00006750: 6e65 5f70 7269 6365 732e 6170 7065 6e64  ne_prices.append
-00006760: 286d 6178 5f70 7269 6365 290a 2020 2020  (max_price).    
-00006770: 2320 2020 2020 7265 7475 726e 2070 726f  #     return pro
-00006780: 7869 6d61 6c5f 6c69 6e65 5f70 7269 6365  ximal_line_price
-00006790: 730a 0a20 2020 2023 2064 6566 2063 616c  s..    # def cal
-000067a0: 6375 6c61 7465 5f73 7570 706c 795f 7072  culate_supply_pr
-000067b0: 6f78 696d 616c 5f6c 696e 6573 2873 656c  oximal_lines(sel
-000067c0: 662c 6461 7461 2c20 7375 7070 6c79 5f7a  f,data, supply_z
-000067d0: 6f6e 6573 293a 0a20 2020 2023 2020 2020  ones):.    #    
-000067e0: 2070 726f 7869 6d61 6c5f 6c69 6e65 5f70   proximal_line_p
-000067f0: 7269 6365 7320 3d20 5b5d 0a20 2020 2023  rices = [].    #
-00006800: 2020 2020 2066 6f72 2073 7461 7274 2c20       for start, 
-00006810: 656e 642c 205f 2c20 5f20 696e 2073 7570  end, _, _ in sup
-00006820: 706c 795f 7a6f 6e65 733a 0a20 2020 2023  ply_zones:.    #
-00006830: 2020 2020 2020 2020 2062 6173 655f 6361           base_ca
-00006840: 6e64 6c65 5f70 7269 6365 7320 3d20 6461  ndle_prices = da
-00006850: 7461 2e6c 6f63 5b28 6461 7461 5b27 4361  ta.loc[(data['Ca
-00006860: 6e64 6c65 2054 7970 6527 5d20 3d3d 2027  ndle Type'] == '
-00006870: 4261 7365 2043 616e 646c 6527 2920 2620  Base Candle') & 
-00006880: 2864 6174 612e 696e 6465 7820 3e3d 2064  (data.index >= d
-00006890: 6174 612e 696e 6465 785b 7374 6172 745d  ata.index[start]
-000068a0: 2920 2620 2864 6174 612e 696e 6465 7820  ) & (data.index 
-000068b0: 3c3d 2064 6174 612e 696e 6465 785b 656e  <= data.index[en
-000068c0: 645d 292c 205b 274f 7065 6e27 2c20 2743  d]), ['Open', 'C
-000068d0: 6c6f 7365 275d 5d0a 2020 2020 2320 2020  lose']].    #   
-000068e0: 2020 2020 2020 6d69 6e5f 7072 6963 6520        min_price 
-000068f0: 3d20 6261 7365 5f63 616e 646c 655f 7072  = base_candle_pr
-00006900: 6963 6573 2e6d 696e 2861 7869 733d 3129  ices.min(axis=1)
-00006910: 2e6d 696e 2829 2020 2320 4765 7420 7468  .min()  # Get th
-00006920: 6520 6d69 6e69 6d75 6d20 7072 6963 6520  e minimum price 
-00006930: 616d 6f6e 6720 616c 6c20 6261 7365 2063  among all base c
-00006940: 616e 646c 6573 2720 6f70 656e 2061 6e64  andles' open and
-00006950: 2063 6c6f 7365 2070 7269 6365 730a 2020   close prices.  
-00006960: 2020 2320 2020 2020 2020 2020 7072 6f78    #         prox
-00006970: 696d 616c 5f6c 696e 655f 7072 6963 6573  imal_line_prices
-00006980: 2e61 7070 656e 6428 6d69 6e5f 7072 6963  .append(min_pric
-00006990: 6529 0a20 2020 2023 2020 2020 2072 6574  e).    #     ret
-000069a0: 7572 6e20 7072 6f78 696d 616c 5f6c 696e  urn proximal_lin
-000069b0: 655f 7072 6963 6573 0a20 2020 2020 2020  e_prices.       
-000069c0: 200a 2020 2020 2320 6465 6620 6361 6c63   .    # def calc
-000069d0: 756c 6174 655f 6465 6d61 6e64 5f64 6973  ulate_demand_dis
-000069e0: 7461 6c5f 6c69 6e65 7328 7365 6c66 2c64  tal_lines(self,d
-000069f0: 6174 612c 2064 656d 616e 645f 7a6f 6e65  ata, demand_zone
-00006a00: 7329 3a0a 2020 2020 2320 2020 2020 6469  s):.    #     di
-00006a10: 7374 616c 5f6c 696e 655f 7072 6963 6573  stal_line_prices
-00006a20: 203d 205b 5d0a 2020 2020 2320 2020 2020   = [].    #     
-00006a30: 666f 7220 7374 6172 742c 2065 6e64 2c20  for start, end, 
-00006a40: 7061 7474 6572 6e2c 205f 2069 6e20 6465  pattern, _ in de
-00006a50: 6d61 6e64 5f7a 6f6e 6573 3a0a 2020 2020  mand_zones:.    
-00006a60: 2320 2020 2020 2020 2020 6966 2070 6174  #         if pat
-00006a70: 7465 726e 203d 3d20 2744 726f 7020 4261  tern == 'Drop Ba
-00006a80: 7365 2052 616c 6c79 273a 0a20 2020 2023  se Rally':.    #
-00006a90: 2020 2020 2020 2020 2020 2020 2023 204c               # L
-00006aa0: 6f67 6963 2066 6f72 2044 726f 7020 4261  ogic for Drop Ba
-00006ab0: 7365 2052 616c 6c79 2070 6174 7465 726e  se Rally pattern
-00006ac0: 3a20 5461 6b65 2074 6865 206c 6f77 6573  : Take the lowes
-00006ad0: 7420 7072 6963 6520 616d 6f6e 6720 616c  t price among al
-00006ae0: 6c20 636f 6d70 6f6e 656e 7473 206f 6620  l components of 
-00006af0: 7468 6520 7a6f 6e65 0a20 2020 2023 2020  the zone.    #  
-00006b00: 2020 2020 2020 2020 2020 206c 6f77 6573             lowes
-00006b10: 745f 7072 6963 6520 3d20 6d69 6e28 6461  t_price = min(da
-00006b20: 7461 5b27 4c6f 7727 5d5b 7374 6172 743a  ta['Low'][start:
-00006b30: 656e 6420 2b20 315d 2920 2023 2047 6574  end + 1])  # Get
-00006b40: 2074 6865 206c 6f77 6573 7420 7072 6963   the lowest pric
-00006b50: 6520 7769 7468 696e 2074 6865 207a 6f6e  e within the zon
-00006b60: 650a 2020 2020 2320 2020 2020 2020 2020  e.    #         
-00006b70: 2020 2020 6469 7374 616c 5f6c 696e 655f      distal_line_
-00006b80: 7072 6963 6573 2e61 7070 656e 6428 6c6f  prices.append(lo
-00006b90: 7765 7374 5f70 7269 6365 290a 2020 2020  west_price).    
-00006ba0: 2320 2020 2020 2020 2020 656c 6966 2070  #         elif p
-00006bb0: 6174 7465 726e 203d 3d20 2752 616c 6c79  attern == 'Rally
-00006bc0: 2042 6173 6520 5261 6c6c 7927 3a0a 2020   Base Rally':.  
-00006bd0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00006be0: 2320 4c6f 6769 6320 666f 7220 5261 6c6c  # Logic for Rall
-00006bf0: 7920 4261 7365 2052 616c 6c79 2070 6174  y Base Rally pat
-00006c00: 7465 726e 3a20 5461 6b65 2074 6865 206c  tern: Take the l
-00006c10: 6f77 6573 7420 6f66 206f 6e6c 7920 616c  owest of only al
-00006c20: 6c20 6261 7365 2063 616e 646c 6520 616e  l base candle an
-00006c30: 6420 666f 6c6c 6f77 6564 2072 616c 6c79  d followed rally
-00006c40: 2063 616e 646c 650a 2020 2020 2320 2020   candle.    #   
-00006c50: 2020 2020 2020 2020 2020 6261 7365 5f63            base_c
-00006c60: 616e 646c 655f 7072 6963 6573 203d 2064  andle_prices = d
-00006c70: 6174 612e 6c6f 635b 2864 6174 615b 2743  ata.loc[(data['C
-00006c80: 616e 646c 6520 5479 7065 275d 203d 3d20  andle Type'] == 
-00006c90: 2742 6173 6520 4361 6e64 6c65 2729 2026  'Base Candle') &
-00006ca0: 2028 6461 7461 2e69 6e64 6578 203e 3d20   (data.index >= 
-00006cb0: 6461 7461 2e69 6e64 6578 5b73 7461 7274  data.index[start
-00006cc0: 5d29 2026 2028 6461 7461 2e69 6e64 6578  ]) & (data.index
-00006cd0: 203c 3d20 6461 7461 2e69 6e64 6578 5b65   <= data.index[e
-00006ce0: 6e64 5d29 2c20 274c 6f77 275d 0a20 2020  nd]), 'Low'].   
-00006cf0: 2023 2020 2020 2020 2020 2020 2020 2072   #             r
-00006d00: 616c 6c79 5f63 616e 646c 655f 7072 6963  ally_candle_pric
-00006d10: 6573 203d 2064 6174 612e 6c6f 635b 2864  es = data.loc[(d
-00006d20: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
-00006d30: 275d 203d 3d20 2752 616c 6c79 2043 616e  '] == 'Rally Can
-00006d40: 646c 6527 2920 2620 2864 6174 612e 696e  dle') & (data.in
-00006d50: 6465 7820 3e3d 2064 6174 612e 696e 6465  dex >= data.inde
-00006d60: 785b 656e 645d 2920 2620 2864 6174 612e  x[end]) & (data.
-00006d70: 696e 6465 7820 3c20 6461 7461 2e69 6e64  index < data.ind
-00006d80: 6578 5b65 6e64 2b31 5d29 2c20 274c 6f77  ex[end+1]), 'Low
-00006d90: 275d 0a20 2020 2023 2020 2020 2020 2020  '].    #        
-00006da0: 2020 2020 2061 6c6c 5f70 7269 6365 7320       all_prices 
-00006db0: 3d20 7064 2e63 6f6e 6361 7428 5b62 6173  = pd.concat([bas
-00006dc0: 655f 6361 6e64 6c65 5f70 7269 6365 732c  e_candle_prices,
-00006dd0: 2072 616c 6c79 5f63 616e 646c 655f 7072   rally_candle_pr
-00006de0: 6963 6573 5d29 0a20 2020 2023 2020 2020  ices]).    #    
-00006df0: 2020 2020 2020 2020 206c 6f77 6573 745f           lowest_
-00006e00: 7072 6963 6520 3d20 616c 6c5f 7072 6963  price = all_pric
-00006e10: 6573 2e6d 696e 2829 2069 6620 6e6f 7420  es.min() if not 
-00006e20: 616c 6c5f 7072 6963 6573 2e65 6d70 7479  all_prices.empty
-00006e30: 2065 6c73 6520 4e6f 6e65 0a20 2020 2023   else None.    #
-00006e40: 2020 2020 2020 2020 2020 2020 2064 6973               dis
-00006e50: 7461 6c5f 6c69 6e65 5f70 7269 6365 732e  tal_line_prices.
-00006e60: 6170 7065 6e64 286c 6f77 6573 745f 7072  append(lowest_pr
-00006e70: 6963 6529 0a20 2020 2023 2020 2020 2072  ice).    #     r
-00006e80: 6574 7572 6e20 6469 7374 616c 5f6c 696e  eturn distal_lin
-00006e90: 655f 7072 6963 6573 0a0a 2020 2020 2320  e_prices..    # 
-00006ea0: 6465 6620 6361 6c63 756c 6174 655f 7375  def calculate_su
-00006eb0: 7070 6c79 5f64 6973 7461 6c5f 6c69 6e65  pply_distal_line
-00006ec0: 7328 7365 6c66 2c64 6174 612c 2073 7570  s(self,data, sup
-00006ed0: 706c 795f 7a6f 6e65 7329 3a0a 2020 2020  ply_zones):.    
-00006ee0: 2320 2020 2020 6469 7374 616c 5f6c 696e  #     distal_lin
-00006ef0: 655f 7072 6963 6573 203d 205b 5d0a 2020  e_prices = [].  
-00006f00: 2020 2320 2020 2020 666f 7220 7374 6172    #     for star
-00006f10: 742c 2065 6e64 2c20 7061 7474 6572 6e2c  t, end, pattern,
-00006f20: 205f 2069 6e20 7375 7070 6c79 5f7a 6f6e   _ in supply_zon
-00006f30: 6573 3a0a 2020 2020 2320 2020 2020 2020  es:.    #       
-00006f40: 2020 6966 2070 6174 7465 726e 203d 3d20    if pattern == 
-00006f50: 2752 616c 6c79 2042 6173 6520 4472 6f70  'Rally Base Drop
-00006f60: 273a 0a20 2020 2023 2020 2020 2020 2020  ':.    #        
-00006f70: 2020 2020 2023 204c 6f67 6963 2066 6f72       # Logic for
-00006f80: 2052 616c 6c79 2042 6173 6520 4472 6f70   Rally Base Drop
-00006f90: 2070 6174 7465 726e 3a20 5461 6b65 2074   pattern: Take t
-00006fa0: 6865 2068 6967 6865 7374 2070 7269 6365  he highest price
-00006fb0: 2061 6d6f 6e67 2061 6c6c 2063 6f6d 706f   among all compo
-00006fc0: 6e65 6e74 7320 6f66 2074 6865 207a 6f6e  nents of the zon
-00006fd0: 650a 2020 2020 2320 2020 2020 2020 2020  e.    #         
-00006fe0: 2020 2020 6869 6768 6573 745f 7072 6963      highest_pric
-00006ff0: 6520 3d20 6d61 7828 6461 7461 5b27 4869  e = max(data['Hi
-00007000: 6768 275d 5b73 7461 7274 3a65 6e64 202b  gh'][start:end +
-00007010: 2031 5d29 2020 2320 4765 7420 7468 6520   1])  # Get the 
-00007020: 6869 6768 6573 7420 7072 6963 6520 7769  highest price wi
-00007030: 7468 696e 2074 6865 207a 6f6e 650a 2020  thin the zone.  
-00007040: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00007050: 6469 7374 616c 5f6c 696e 655f 7072 6963  distal_line_pric
-00007060: 6573 2e61 7070 656e 6428 6869 6768 6573  es.append(highes
-00007070: 745f 7072 6963 6529 0a20 2020 2023 2020  t_price).    #  
-00007080: 2020 2020 2020 2065 6c69 6620 7061 7474         elif patt
-00007090: 6572 6e20 3d3d 2027 4472 6f70 2042 6173  ern == 'Drop Bas
-000070a0: 6520 4472 6f70 273a 0a20 2020 2023 2020  e Drop':.    #  
-000070b0: 2020 2020 2020 2020 2020 2023 204c 6f67             # Log
-000070c0: 6963 2066 6f72 2044 726f 7020 4261 7365  ic for Drop Base
-000070d0: 2044 726f 7020 7061 7474 6572 6e3a 2054   Drop pattern: T
-000070e0: 616b 6520 7468 6520 6869 6768 6573 7420  ake the highest 
-000070f0: 6f66 206f 6e6c 7920 616c 6c20 6261 7365  of only all base
-00007100: 2063 616e 646c 6573 2061 6e64 2066 6f6c   candles and fol
-00007110: 6c6f 7765 6420 6472 6f70 2063 616e 646c  lowed drop candl
-00007120: 650a 2020 2020 2320 2020 2020 2020 2020  e.    #         
-00007130: 2020 2020 6261 7365 5f63 616e 646c 655f      base_candle_
-00007140: 7072 6963 6573 203d 2064 6174 612e 6c6f  prices = data.lo
-00007150: 635b 2864 6174 615b 2743 616e 646c 6520  c[(data['Candle 
-00007160: 5479 7065 275d 203d 3d20 2742 6173 6520  Type'] == 'Base 
-00007170: 4361 6e64 6c65 2729 2026 2028 6461 7461  Candle') & (data
-00007180: 2e69 6e64 6578 203e 3d20 6461 7461 2e69  .index >= data.i
-00007190: 6e64 6578 5b73 7461 7274 5d29 2026 2028  ndex[start]) & (
-000071a0: 6461 7461 2e69 6e64 6578 203c 3d20 6461  data.index <= da
-000071b0: 7461 2e69 6e64 6578 5b65 6e64 5d29 2c20  ta.index[end]), 
-000071c0: 2748 6967 6827 5d0a 2020 2020 2320 2020  'High'].    #   
-000071d0: 2020 2020 2020 2020 2020 6472 6f70 5f63            drop_c
-000071e0: 616e 646c 655f 7072 6963 6573 203d 2064  andle_prices = d
-000071f0: 6174 612e 6c6f 635b 2864 6174 615b 2743  ata.loc[(data['C
-00007200: 616e 646c 6520 5479 7065 275d 203d 3d20  andle Type'] == 
-00007210: 2744 726f 7020 4361 6e64 6c65 2729 2026  'Drop Candle') &
-00007220: 2028 6461 7461 2e69 6e64 6578 203e 3d20   (data.index >= 
-00007230: 6461 7461 2e69 6e64 6578 5b73 7461 7274  data.index[start
-00007240: 5d29 2026 2028 6461 7461 2e69 6e64 6578  ]) & (data.index
-00007250: 203c 3d20 6461 7461 2e69 6e64 6578 5b65   <= data.index[e
-00007260: 6e64 5d29 2c20 2748 6967 6827 5d0a 2020  nd]), 'High'].  
-00007270: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00007280: 616c 6c5f 7072 6963 6573 203d 2070 642e  all_prices = pd.
-00007290: 636f 6e63 6174 285b 6261 7365 5f63 616e  concat([base_can
-000072a0: 646c 655f 7072 6963 6573 2c20 6472 6f70  dle_prices, drop
-000072b0: 5f63 616e 646c 655f 7072 6963 6573 5d29  _candle_prices])
-000072c0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-000072d0: 2020 2068 6967 6865 7374 5f70 7269 6365     highest_price
-000072e0: 203d 2061 6c6c 5f70 7269 6365 732e 6d61   = all_prices.ma
-000072f0: 7828 2920 6966 206e 6f74 2061 6c6c 5f70  x() if not all_p
-00007300: 7269 6365 732e 656d 7074 7920 656c 7365  rices.empty else
-00007310: 204e 6f6e 650a 2020 2020 2320 2020 2020   None.    #     
-00007320: 2020 2020 2020 2020 6469 7374 616c 5f6c          distal_l
-00007330: 696e 655f 7072 6963 6573 2e61 7070 656e  ine_prices.appen
-00007340: 6428 6869 6768 6573 745f 7072 6963 6529  d(highest_price)
-00007350: 0a20 2020 2023 2020 2020 2072 6574 7572  .    #     retur
-00007360: 6e20 6469 7374 616c 5f6c 696e 655f 7072  n distal_line_pr
-00007370: 6963 6573 0a0a 2020 2020 2320 6465 6620  ices..    # def 
-00007380: 6973 5f7a 6f6e 655f 7465 7374 6564 2873  is_zone_tested(s
-00007390: 656c 662c 6461 7461 2c20 7374 6172 745f  elf,data, start_
-000073a0: 696e 6465 782c 2065 6e64 5f69 6e64 6578  index, end_index
-000073b0: 2c20 7072 6f78 696d 616c 5f6c 696e 655f  , proximal_line_
-000073c0: 7072 6963 6529 3a0a 2020 2020 2320 2020  price):.    #   
-000073d0: 2020 2222 220a 2020 2020 2320 2020 2020    """.    #     
-000073e0: 4368 6563 6b20 6966 2074 6865 2070 726f  Check if the pro
-000073f0: 7869 6d61 6c20 6c69 6e65 2070 7269 6365  ximal line price
-00007400: 2068 6173 2062 6565 6e20 7465 7374 6564   has been tested
-00007410: 2062 7920 6675 7475 7265 2070 7269 6365   by future price
-00007420: 732e 0a20 2020 2020 2020 200a 2020 2020  s..        .    
-00007430: 2320 2020 2020 4172 6773 3a0a 2020 2020  #     Args:.    
-00007440: 2320 2020 2020 2d20 6461 7461 3a20 4461  #     - data: Da
-00007450: 7461 4672 616d 6520 636f 6e74 6169 6e69  taFrame containi
-00007460: 6e67 2073 746f 636b 2064 6174 610a 2020  ng stock data.  
-00007470: 2020 2320 2020 2020 2d20 7374 6172 745f    #     - start_
-00007480: 696e 6465 783a 2053 7461 7274 2069 6e64  index: Start ind
-00007490: 6578 206f 6620 7468 6520 6465 6d61 6e64  ex of the demand
-000074a0: 2f73 7570 706c 7920 7a6f 6e65 0a20 2020  /supply zone.   
-000074b0: 2023 2020 2020 202d 2065 6e64 5f69 6e64   #     - end_ind
-000074c0: 6578 3a20 456e 6420 696e 6465 7820 6f66  ex: End index of
-000074d0: 2074 6865 2064 656d 616e 642f 7375 7070   the demand/supp
-000074e0: 6c79 207a 6f6e 650a 2020 2020 2320 2020  ly zone.    #   
-000074f0: 2020 2d20 7072 6f78 696d 616c 5f6c 696e    - proximal_lin
-00007500: 655f 7072 6963 653a 2050 726f 7869 6d61  e_price: Proxima
-00007510: 6c20 6c69 6e65 2070 7269 6365 0a20 2020  l line price.   
-00007520: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
-00007530: 5265 7475 726e 733a 0a20 2020 2023 2020  Returns:.    #  
-00007540: 2020 202d 2054 7275 6520 6966 2074 6865     - True if the
-00007550: 2070 726f 7869 6d61 6c20 6c69 6e65 2070   proximal line p
-00007560: 7269 6365 2069 7320 7465 7374 6564 2c20  rice is tested, 
-00007570: 4661 6c73 6520 6f74 6865 7277 6973 650a  False otherwise.
-00007580: 2020 2020 2320 2020 2020 2222 220a 2020      #     """.  
-00007590: 2020 2320 2020 2020 666f 7220 6920 696e    #     for i in
-000075a0: 2072 616e 6765 2865 6e64 5f69 6e64 6578   range(end_index
-000075b0: 202b 2031 2c20 6c65 6e28 6461 7461 2929   + 1, len(data))
-000075c0: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-000075d0: 6966 2064 6174 615b 274c 6f77 275d 5b69  if data['Low'][i
-000075e0: 5d20 3c3d 2070 726f 7869 6d61 6c5f 6c69  ] <= proximal_li
-000075f0: 6e65 5f70 7269 6365 203c 3d20 6461 7461  ne_price <= data
-00007600: 5b27 4869 6768 275d 5b69 5d3a 0a20 2020  ['High'][i]:.   
-00007610: 2023 2020 2020 2020 2020 2020 2020 2072   #             r
-00007620: 6574 7572 6e20 5472 7565 0a20 2020 2023  eturn True.    #
-00007630: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00007640: 650a 0a20 2020 2023 2064 6566 2063 616c  e..    # def cal
-00007650: 6375 6c61 7465 5f7a 6f6e 655f 7261 6e67  culate_zone_rang
-00007660: 6528 7365 6c66 2c70 726f 7869 6d61 6c5f  e(self,proximal_
-00007670: 6c69 6e65 2c20 6469 7374 616c 5f6c 696e  line, distal_lin
-00007680: 6529 3a0a 2020 2020 2320 2020 2020 2222  e):.    #     ""
-00007690: 220a 2020 2020 2320 2020 2020 4361 6c63  ".    #     Calc
-000076a0: 756c 6174 6520 7468 6520 7261 6e67 6520  ulate the range 
-000076b0: 6f66 2061 207a 6f6e 6520 6769 7665 6e20  of a zone given 
-000076c0: 6974 7320 7072 6f78 696d 616c 2061 6e64  its proximal and
-000076d0: 2064 6973 7461 6c20 6c69 6e65 732e 0a20   distal lines.. 
-000076e0: 2020 2020 2020 200a 2020 2020 2320 2020         .    #   
-000076f0: 2020 4172 6773 3a0a 2020 2020 2320 2020    Args:.    #   
-00007700: 2020 2d20 7072 6f78 696d 616c 5f6c 696e    - proximal_lin
-00007710: 653a 2050 726f 7869 6d61 6c20 6c69 6e65  e: Proximal line
-00007720: 2070 7269 6365 0a20 2020 2023 2020 2020   price.    #    
-00007730: 202d 2064 6973 7461 6c5f 6c69 6e65 3a20   - distal_line: 
-00007740: 4469 7374 616c 206c 696e 6520 7072 6963  Distal line pric
-00007750: 650a 2020 2020 2020 2020 0a20 2020 2023  e.        .    #
-00007760: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
-00007770: 2020 2320 2020 2020 2d20 5261 6e67 6520    #     - Range 
-00007780: 6f66 2074 6865 207a 6f6e 650a 2020 2020  of the zone.    
-00007790: 2320 2020 2020 2222 220a 2020 2020 2320  #     """.    # 
-000077a0: 2020 2020 6966 2070 726f 7869 6d61 6c5f      if proximal_
-000077b0: 6c69 6e65 2069 7320 6e6f 7420 4e6f 6e65  line is not None
-000077c0: 2061 6e64 2064 6973 7461 6c5f 6c69 6e65   and distal_line
-000077d0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000077e0: 2020 2320 2020 2020 2020 2020 7265 7475    #         retu
-000077f0: 726e 2061 6273 2870 726f 7869 6d61 6c5f  rn abs(proximal_
-00007800: 6c69 6e65 202d 2064 6973 7461 6c5f 6c69  line - distal_li
-00007810: 6e65 290a 2020 2020 2320 2020 2020 656c  ne).    #     el
-00007820: 7365 3a0a 2020 2020 2320 2020 2020 2020  se:.    #       
-00007830: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-00007840: 2020 2023 2064 6566 2063 616c 6375 6c61     # def calcula
-00007850: 7465 5f64 656d 616e 645f 7a6f 6e65 5f72  te_demand_zone_r
-00007860: 616e 6765 7328 7365 6c66 2c64 656d 616e  anges(self,deman
-00007870: 645f 7a6f 6e65 732c 2064 656d 616e 645f  d_zones, demand_
-00007880: 7072 6f78 696d 616c 5f6c 696e 6573 2c20  proximal_lines, 
-00007890: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
-000078a0: 6e65 7329 3a0a 2020 2020 2320 2020 2020  nes):.    #     
-000078b0: 2222 220a 2020 2020 2320 2020 2020 4361  """.    #     Ca
-000078c0: 6c63 756c 6174 6520 7468 6520 7261 6e67  lculate the rang
-000078d0: 6520 6f66 2065 6163 6820 6465 6d61 6e64  e of each demand
-000078e0: 207a 6f6e 652e 0a20 2020 2020 2020 200a   zone..        .
-000078f0: 2020 2020 2320 2020 2020 4172 6773 3a0a      #     Args:.
-00007900: 2020 2020 2320 2020 2020 2d20 6465 6d61      #     - dema
-00007910: 6e64 5f7a 6f6e 6573 3a20 4c69 7374 206f  nd_zones: List o
-00007920: 6620 6465 6d61 6e64 207a 6f6e 6520 7475  f demand zone tu
-00007930: 706c 6573 2028 7374 6172 742c 2065 6e64  ples (start, end
-00007940: 2c20 7061 7474 6572 6e2c 2062 6173 655f  , pattern, base_
-00007950: 636f 756e 7429 0a20 2020 2023 2020 2020  count).    #    
-00007960: 202d 2064 656d 616e 645f 7072 6f78 696d   - demand_proxim
-00007970: 616c 5f6c 696e 6573 3a20 4c69 7374 206f  al_lines: List o
-00007980: 6620 7072 6f78 696d 616c 206c 696e 6520  f proximal line 
-00007990: 7072 6963 6573 2066 6f72 2064 656d 616e  prices for deman
-000079a0: 6420 7a6f 6e65 730a 2020 2020 2320 2020  d zones.    #   
-000079b0: 2020 2d20 6465 6d61 6e64 5f64 6973 7461    - demand_dista
-000079c0: 6c5f 6c69 6e65 733a 204c 6973 7420 6f66  l_lines: List of
-000079d0: 2064 6973 7461 6c20 6c69 6e65 2070 7269   distal line pri
-000079e0: 6365 7320 666f 7220 6465 6d61 6e64 207a  ces for demand z
-000079f0: 6f6e 6573 0a20 2020 2020 2020 200a 2020  ones.        .  
-00007a00: 2020 2320 2020 2020 5265 7475 726e 733a    #     Returns:
-00007a10: 0a20 2020 2023 2020 2020 202d 204c 6973  .    #     - Lis
-00007a20: 7420 6f66 2072 616e 6765 7320 636f 7272  t of ranges corr
-00007a30: 6573 706f 6e64 696e 6720 746f 2065 6163  esponding to eac
-00007a40: 6820 6465 6d61 6e64 207a 6f6e 650a 2020  h demand zone.  
-00007a50: 2020 2320 2020 2020 2222 220a 2020 2020    #     """.    
-00007a60: 2320 2020 2020 6465 6d61 6e64 5f7a 6f6e  #     demand_zon
-00007a70: 655f 7261 6e67 6573 203d 205b 5d0a 2020  e_ranges = [].  
-00007a80: 2020 2320 2020 2020 666f 7220 692c 2028    #     for i, (
-00007a90: 7374 6172 742c 2065 6e64 2c20 5f2c 205f  start, end, _, _
-00007aa0: 2920 696e 2065 6e75 6d65 7261 7465 2864  ) in enumerate(d
-00007ab0: 656d 616e 645f 7a6f 6e65 7329 3a0a 2020  emand_zones):.  
-00007ac0: 2020 2320 2020 2020 2020 2020 7261 6e67    #         rang
-00007ad0: 655f 6f66 5f7a 6f6e 6520 3d20 7365 6c66  e_of_zone = self
-00007ae0: 2e63 616c 6375 6c61 7465 5f7a 6f6e 655f  .calculate_zone_
-00007af0: 7261 6e67 6528 6465 6d61 6e64 5f70 726f  range(demand_pro
-00007b00: 7869 6d61 6c5f 6c69 6e65 735b 695d 2c20  ximal_lines[i], 
-00007b10: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
-00007b20: 6e65 735b 695d 290a 2020 2020 2320 2020  nes[i]).    #   
-00007b30: 2020 2020 2020 6465 6d61 6e64 5f7a 6f6e        demand_zon
-00007b40: 655f 7261 6e67 6573 2e61 7070 656e 6428  e_ranges.append(
-00007b50: 7261 6e67 655f 6f66 5f7a 6f6e 6529 0a20  range_of_zone). 
-00007b60: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
-00007b70: 6465 6d61 6e64 5f7a 6f6e 655f 7261 6e67  demand_zone_rang
-00007b80: 6573 0a0a 2020 2020 2320 6465 6620 6361  es..    # def ca
-00007b90: 6c63 756c 6174 655f 7375 7070 6c79 5f7a  lculate_supply_z
-00007ba0: 6f6e 655f 7261 6e67 6573 2873 656c 662c  one_ranges(self,
-00007bb0: 7375 7070 6c79 5f7a 6f6e 6573 2c20 7375  supply_zones, su
-00007bc0: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
-00007bd0: 6e65 732c 2073 7570 706c 795f 6469 7374  nes, supply_dist
-00007be0: 616c 5f6c 696e 6573 293a 0a20 2020 2023  al_lines):.    #
-00007bf0: 2020 2020 2022 2222 0a20 2020 2023 2020       """.    #  
-00007c00: 2020 2043 616c 6375 6c61 7465 2074 6865     Calculate the
-00007c10: 2072 616e 6765 206f 6620 6561 6368 2073   range of each s
-00007c20: 7570 706c 7920 7a6f 6e65 2e0a 2020 2020  upply zone..    
-00007c30: 2020 2020 0a20 2020 2023 2020 2020 2041      .    #     A
-00007c40: 7267 733a 0a20 2020 2023 2020 2020 202d  rgs:.    #     -
-00007c50: 2073 7570 706c 795f 7a6f 6e65 733a 204c   supply_zones: L
-00007c60: 6973 7420 6f66 2073 7570 706c 7920 7a6f  ist of supply zo
-00007c70: 6e65 2074 7570 6c65 7320 2873 7461 7274  ne tuples (start
-00007c80: 2c20 656e 642c 2070 6174 7465 726e 2c20  , end, pattern, 
-00007c90: 6261 7365 5f63 6f75 6e74 290a 2020 2020  base_count).    
-00007ca0: 2320 2020 2020 2d20 7375 7070 6c79 5f70  #     - supply_p
-00007cb0: 726f 7869 6d61 6c5f 6c69 6e65 733a 204c  roximal_lines: L
-00007cc0: 6973 7420 6f66 2070 726f 7869 6d61 6c20  ist of proximal 
-00007cd0: 6c69 6e65 2070 7269 6365 7320 666f 7220  line prices for 
-00007ce0: 7375 7070 6c79 207a 6f6e 6573 0a20 2020  supply zones.   
-00007cf0: 2023 2020 2020 202d 2073 7570 706c 795f   #     - supply_
-00007d00: 6469 7374 616c 5f6c 696e 6573 3a20 4c69  distal_lines: Li
-00007d10: 7374 206f 6620 6469 7374 616c 206c 696e  st of distal lin
-00007d20: 6520 7072 6963 6573 2066 6f72 2073 7570  e prices for sup
-00007d30: 706c 7920 7a6f 6e65 730a 2020 2020 2020  ply zones.      
-00007d40: 2020 0a20 2020 2023 2020 2020 2052 6574    .    #     Ret
-00007d50: 7572 6e73 3a0a 2020 2020 2320 2020 2020  urns:.    #     
-00007d60: 2d20 4c69 7374 206f 6620 7261 6e67 6573  - List of ranges
-00007d70: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
-00007d80: 6f20 6561 6368 2073 7570 706c 7920 7a6f  o each supply zo
-00007d90: 6e65 0a20 2020 2023 2020 2020 2022 2222  ne.    #     """
-00007da0: 0a20 2020 2023 2020 2020 2073 7570 706c  .    #     suppl
-00007db0: 795f 7a6f 6e65 5f72 616e 6765 7320 3d20  y_zone_ranges = 
-00007dc0: 5b5d 0a20 2020 2023 2020 2020 2066 6f72  [].    #     for
-00007dd0: 2069 2c20 2873 7461 7274 2c20 656e 642c   i, (start, end,
-00007de0: 205f 2c20 5f29 2069 6e20 656e 756d 6572   _, _) in enumer
-00007df0: 6174 6528 7375 7070 6c79 5f7a 6f6e 6573  ate(supply_zones
-00007e00: 293a 0a20 2020 2023 2020 2020 2020 2020  ):.    #        
-00007e10: 2072 616e 6765 5f6f 665f 7a6f 6e65 203d   range_of_zone =
-00007e20: 2073 656c 662e 6361 6c63 756c 6174 655f   self.calculate_
-00007e30: 7a6f 6e65 5f72 616e 6765 2873 7570 706c  zone_range(suppl
-00007e40: 795f 7072 6f78 696d 616c 5f6c 696e 6573  y_proximal_lines
-00007e50: 5b69 5d2c 2073 7570 706c 795f 6469 7374  [i], supply_dist
-00007e60: 616c 5f6c 696e 6573 5b69 5d29 0a20 2020  al_lines[i]).   
-00007e70: 2023 2020 2020 2020 2020 2073 7570 706c   #         suppl
-00007e80: 795f 7a6f 6e65 5f72 616e 6765 732e 6170  y_zone_ranges.ap
-00007e90: 7065 6e64 2872 616e 6765 5f6f 665f 7a6f  pend(range_of_zo
-00007ea0: 6e65 290a 2020 2020 2320 2020 2020 7265  ne).    #     re
-00007eb0: 7475 726e 2073 7570 706c 795f 7a6f 6e65  turn supply_zone
-00007ec0: 5f72 616e 6765 730a 0a20 2020 2023 2064  _ranges..    # d
-00007ed0: 6566 2066 696c 7465 725f 7374 6f63 6b73  ef filter_stocks
-00007ee0: 5f62 795f 6469 7374 616e 6365 2873 656c  _by_distance(sel
-00007ef0: 662c 6461 7461 2c73 796d 626f 6c5f 6c69  f,data,symbol_li
-00007f00: 7374 2c20 7468 7265 7368 6f6c 645f 7065  st, threshold_pe
-00007f10: 7263 656e 742c 2074 696d 6566 7261 6d65  rcent, timeframe
-00007f20: 293a 0a20 2020 2023 2020 2020 2066 696c  ):.    #     fil
-00007f30: 7465 7265 645f 7374 6f63 6b73 203d 205b  tered_stocks = [
-00007f40: 5d0a 2020 2020 2320 2020 2020 666f 7220  ].    #     for 
-00007f50: 7379 6d62 6f6c 2069 6e20 7379 6d62 6f6c  symbol in symbol
-00007f60: 5f6c 6973 743a 0a20 2020 2023 2020 2020  _list:.    #    
-00007f70: 2020 2020 2069 6620 6461 7461 2069 7320       if data is 
-00007f80: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2320  not None:.    # 
-00007f90: 2020 2020 2020 2020 2020 2020 636d 7020              cmp 
-00007fa0: 3d20 6461 7461 2e69 6c6f 635b 2d31 5d5b  = data.iloc[-1][
-00007fb0: 2743 6c6f 7365 275d 2020 2320 4375 7272  'Close']  # Curr
-00007fc0: 656e 7420 6d61 726b 6574 2070 7269 6365  ent market price
-00007fd0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00007fe0: 2020 2064 656d 616e 645f 7a6f 6e65 732c     demand_zones,
-00007ff0: 205f 2c20 5f2c 2064 656d 616e 645f 7072   _, _, demand_pr
-00008000: 6f78 696d 616c 5f6c 696e 6520 3d20 7365  oximal_line = se
-00008010: 6c66 2e69 6465 6e74 6966 795f 6465 6d61  lf.identify_dema
-00008020: 6e64 5f7a 6f6e 6528 6461 7461 2c20 636d  nd_zone(data, cm
-00008030: 7029 2020 2320 5061 7373 2063 6d70 2061  p)  # Pass cmp a
-00008040: 7267 756d 656e 7420 6865 7265 0a20 2020  rgument here.   
-00008050: 2023 2020 2020 2020 2020 2020 2020 2073   #             s
-00008060: 7570 706c 795f 7a6f 6e65 732c 205f 2c20  upply_zones, _, 
-00008070: 5f2c 2073 7570 706c 795f 7072 6f78 696d  _, supply_proxim
-00008080: 616c 5f6c 696e 6520 3d20 7365 6c66 2e69  al_line = self.i
-00008090: 6465 6e74 6966 795f 7375 7070 6c79 5f7a  dentify_supply_z
-000080a0: 6f6e 6528 6461 7461 2c20 636d 7029 2020  one(data, cmp)  
-000080b0: 2320 5061 7373 2063 6d70 2061 7267 756d  # Pass cmp argum
-000080c0: 656e 7420 6865 7265 0a20 2020 2020 2020  ent here.       
-000080d0: 2020 2020 2020 2020 200a 2020 2020 2320           .    # 
-000080e0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-000080f0: 6563 6b20 6966 2065 6974 6865 7220 6465  eck if either de
-00008100: 6d61 6e64 206f 7220 7375 7070 6c79 207a  mand or supply z
-00008110: 6f6e 6573 2065 7869 7374 2066 6f72 2074  ones exist for t
-00008120: 6865 2073 746f 636b 0a20 2020 2023 2020  he stock.    #  
-00008130: 2020 2020 2020 2020 2020 2069 6620 6465             if de
-00008140: 6d61 6e64 5f7a 6f6e 6573 206f 7220 7375  mand_zones or su
-00008150: 7070 6c79 5f7a 6f6e 6573 3a0a 2020 2020  pply_zones:.    
-00008160: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00008170: 2020 6669 6c74 6572 6564 5f73 746f 636b    filtered_stock
-00008180: 732e 6170 7065 6e64 2873 796d 626f 6c29  s.append(symbol)
-00008190: 0a0a 2020 2020 2320 2020 2020 7265 7475  ..    #     retu
-000081a0: 726e 2066 696c 7465 7265 645f 7374 6f63  rn filtered_stoc
-000081b0: 6b73 0a20 2020 200a 2020 2020 2320 6465  ks.    .    # de
-000081c0: 6620 6669 6e64 4465 6d61 6e64 5375 7070  f findDemandSupp
-000081d0: 6c79 5a6f 6e65 7328 7365 6c66 2c64 6174  lyZones(self,dat
-000081e0: 612c 7468 7265 7368 6f6c 645f 7065 7263  a,threshold_perc
-000081f0: 656e 743d 3129 3a20 2020 2020 2020 200a  ent=1):        .
-00008200: 2020 2020 2320 2020 2020 2320 496e 6974      #     # Init
-00008210: 6961 6c69 7a65 2063 6f75 6e74 2066 6f72  ialize count for
-00008220: 2066 696c 7465 7265 6420 7374 6f63 6b73   filtered stocks
-00008230: 0a20 2020 2023 2020 2020 2063 6f75 6e74  .    #     count
-00008240: 5f66 696c 7465 7265 645f 7374 6f63 6b73  _filtered_stocks
-00008250: 203d 2030 0a0a 2020 2020 2320 2020 2020   = 0..    #     
-00008260: 2320 416e 616c 797a 6520 6465 6d61 6e64  # Analyze demand
-00008270: 2061 6e64 2073 7570 706c 7920 7a6f 6e65   and supply zone
-00008280: 7320 666f 7220 6561 6368 2073 746f 636b  s for each stock
-00008290: 2061 6e64 2073 6176 6520 7265 7375 6c74   and save result
-000082a0: 7320 696e 2061 2066 696c 650a 2020 2020  s in a file.    
-000082b0: 2320 2020 2020 7769 7468 206f 7065 6e28  #     with open(
-000082c0: 2264 656d 616e 645f 7375 7070 6c79 5f7a  "demand_supply_z
-000082d0: 6f6e 6573 2e74 7874 222c 2022 7722 2920  ones.txt", "w") 
-000082e0: 6173 2066 696c 653a 0a20 2020 2023 2020  as file:.    #  
-000082f0: 2020 2020 2020 2066 6f72 2073 796d 626f         for symbo
-00008300: 6c20 696e 2064 6174 615b 2253 746f 636b  l in data["Stock
-00008310: 225d 3a0a 2020 2020 2320 2020 2020 2020  "]:.    #       
-00008320: 2020 2020 2020 6966 2064 6174 6120 6973        if data is
-00008330: 206e 6f74 204e 6f6e 653a 0a20 2020 2023   not None:.    #
-00008340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008350: 2063 6d70 203d 2064 6174 612e 696c 6f63   cmp = data.iloc
-00008360: 5b2d 315d 5b27 436c 6f73 6527 5d20 2023  [-1]['Close']  #
-00008370: 2043 7572 7265 6e74 206d 6172 6b65 7420   Current market 
-00008380: 7072 6963 650a 2020 2020 2320 2020 2020  price.    #     
-00008390: 2020 2020 2020 2020 2020 2020 6465 6d61              dema
-000083a0: 6e64 5f7a 6f6e 6573 2c20 5f2c 205f 2c20  nd_zones, _, _, 
-000083b0: 6465 6d61 6e64 5f70 726f 7869 6d61 6c5f  demand_proximal_
-000083c0: 6c69 6e65 203d 2073 656c 662e 6964 656e  line = self.iden
-000083d0: 7469 6679 5f64 656d 616e 645f 7a6f 6e65  tify_demand_zone
-000083e0: 2864 6174 612c 2063 6d70 290a 2020 2020  (data, cmp).    
-000083f0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00008400: 2020 7375 7070 6c79 5f7a 6f6e 6573 2c20    supply_zones, 
-00008410: 5f2c 205f 2c20 7375 7070 6c79 5f70 726f  _, _, supply_pro
-00008420: 7869 6d61 6c5f 6c69 6e65 203d 2073 656c  ximal_line = sel
-00008430: 662e 6964 656e 7469 6679 5f73 7570 706c  f.identify_suppl
-00008440: 795f 7a6f 6e65 2864 6174 612c 2063 6d70  y_zone(data, cmp
-00008450: 290a 0a20 2020 2023 2020 2020 2020 2020  )..    #        
-00008460: 2020 2020 2020 2020 2023 2053 7465 7020           # Step 
-00008470: 313a 2043 616c 6375 6c61 7465 2070 726f  1: Calculate pro
-00008480: 7869 6d61 6c20 6c69 6e65 7320 666f 7220  ximal lines for 
-00008490: 6465 6d61 6e64 2061 6e64 2073 7570 706c  demand and suppl
-000084a0: 7920 7a6f 6e65 730a 2020 2020 2320 2020  y zones.    #   
-000084b0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-000084c0: 6d61 6e64 5f70 726f 7869 6d61 6c5f 6c69  mand_proximal_li
-000084d0: 6e65 7320 3d20 7365 6c66 2e63 616c 6375  nes = self.calcu
-000084e0: 6c61 7465 5f64 656d 616e 645f 7072 6f78  late_demand_prox
-000084f0: 696d 616c 5f6c 696e 6573 2864 6174 612c  imal_lines(data,
-00008500: 2064 656d 616e 645f 7a6f 6e65 7329 0a20   demand_zones). 
-00008510: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00008520: 2020 2020 2073 7570 706c 795f 7072 6f78       supply_prox
-00008530: 696d 616c 5f6c 696e 6573 203d 2073 656c  imal_lines = sel
-00008540: 662e 6361 6c63 756c 6174 655f 7375 7070  f.calculate_supp
-00008550: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
-00008560: 7328 6461 7461 2c20 7375 7070 6c79 5f7a  s(data, supply_z
-00008570: 6f6e 6573 290a 2020 2020 2020 2020 2020  ones).          
-00008580: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
-00008590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085a0: 2023 2053 7465 7020 323a 2043 616c 6375   # Step 2: Calcu
-000085b0: 6c61 7465 2064 6973 7461 6c20 6c69 6e65  late distal line
-000085c0: 7320 666f 7220 6465 6d61 6e64 207a 6f6e  s for demand zon
-000085d0: 6573 2061 6e64 2073 7570 706c 7920 7a6f  es and supply zo
-000085e0: 6e65 730a 2020 2020 2320 2020 2020 2020  nes.    #       
-000085f0: 2020 2020 2020 2020 2020 6465 6d61 6e64            demand
-00008600: 5f64 6973 7461 6c5f 6c69 6e65 7320 3d20  _distal_lines = 
-00008610: 7365 6c66 2e63 616c 6375 6c61 7465 5f64  self.calculate_d
-00008620: 656d 616e 645f 6469 7374 616c 5f6c 696e  emand_distal_lin
-00008630: 6573 2864 6174 612c 2064 656d 616e 645f  es(data, demand_
-00008640: 7a6f 6e65 7329 0a20 2020 2023 2020 2020  zones).    #    
-00008650: 2020 2020 2020 2020 2020 2020 2073 7570               sup
-00008660: 706c 795f 6469 7374 616c 5f6c 696e 6573  ply_distal_lines
-00008670: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
-00008680: 655f 7375 7070 6c79 5f64 6973 7461 6c5f  e_supply_distal_
-00008690: 6c69 6e65 7328 6461 7461 2c20 7375 7070  lines(data, supp
-000086a0: 6c79 5f7a 6f6e 6573 290a 0a20 2020 2023  ly_zones)..    #
-000086b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000086c0: 2023 2043 616c 6375 6c61 7465 2072 616e   # Calculate ran
-000086d0: 6765 206f 6620 6465 6d61 6e64 2061 6e64  ge of demand and
-000086e0: 2073 7570 706c 7920 7a6f 6e65 730a 2020   supply zones.  
-000086f0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00008700: 2020 2020 6465 6d61 6e64 5f7a 6f6e 655f      demand_zone_
-00008710: 7261 6e67 6573 203d 2073 656c 662e 6361  ranges = self.ca
-00008720: 6c63 756c 6174 655f 6465 6d61 6e64 5f7a  lculate_demand_z
-00008730: 6f6e 655f 7261 6e67 6573 2864 656d 616e  one_ranges(deman
-00008740: 645f 7a6f 6e65 732c 2064 656d 616e 645f  d_zones, demand_
-00008750: 7072 6f78 696d 616c 5f6c 696e 6573 2c20  proximal_lines, 
-00008760: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
-00008770: 6e65 7329 0a20 2020 2023 2020 2020 2020  nes).    #      
-00008780: 2020 2020 2020 2020 2020 2073 7570 706c             suppl
-00008790: 795f 7a6f 6e65 5f72 616e 6765 7320 3d20  y_zone_ranges = 
-000087a0: 7365 6c66 2e63 616c 6375 6c61 7465 5f73  self.calculate_s
-000087b0: 7570 706c 795f 7a6f 6e65 5f72 616e 6765  upply_zone_range
-000087c0: 7328 7375 7070 6c79 5f7a 6f6e 6573 2c20  s(supply_zones, 
-000087d0: 7375 7070 6c79 5f70 726f 7869 6d61 6c5f  supply_proximal_
-000087e0: 6c69 6e65 732c 2073 7570 706c 795f 6469  lines, supply_di
-000087f0: 7374 616c 5f6c 696e 6573 290a 2020 2020  stal_lines).    
-00008800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008810: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00008820: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-00008830: 6528 6622 5c6e 5c6e 416e 616c 7973 6973  e(f"\n\nAnalysis
-00008840: 2066 6f72 207b 7379 6d62 6f6c 7d20 287b   for {symbol} ({
-00008850: 7469 6d65 6672 616d 657d 293a 2229 0a20  timeframe}):"). 
-00008860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008870: 2020 200a 2020 2020 2320 2020 2020 2020     .    #       
-00008880: 2020 2020 2020 2020 2020 2320 4465 6d61            # Dema
-00008890: 6e64 205a 6f6e 6573 0a20 2020 2023 2020  nd Zones.    #  
-000088a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000088b0: 696c 652e 7772 6974 6528 225c 6e5c 6e44  ile.write("\n\nD
-000088c0: 656d 616e 6420 5a6f 6e65 733a 2229 0a20  emand Zones:"). 
-000088d0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-000088e0: 2020 2020 2069 6620 6465 6d61 6e64 5f7a       if demand_z
-000088f0: 6f6e 6573 3a20 2023 2043 6865 636b 2069  ones:  # Check i
-00008900: 6620 6465 6d61 6e64 5f7a 6f6e 6573 2069  f demand_zones i
-00008910: 7320 6e6f 7420 656d 7074 790a 2020 2020  s not empty.    
-00008920: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00008930: 2020 2020 2020 666f 7220 692c 2028 7374        for i, (st
-00008940: 6172 742c 2065 6e64 2c20 7061 7474 6572  art, end, patter
-00008950: 6e2c 2062 6173 655f 636f 756e 7429 2069  n, base_count) i
-00008960: 6e20 656e 756d 6572 6174 6528 6465 6d61  n enumerate(dema
-00008970: 6e64 5f7a 6f6e 6573 293a 0a20 2020 2023  nd_zones):.    #
-00008980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008990: 2020 2020 2020 2020 2064 6973 745f 6672           dist_fr
-000089a0: 6f6d 5f63 6d70 203d 2061 6273 2828 636d  om_cmp = abs((cm
-000089b0: 7020 2d20 6465 6d61 6e64 5f70 726f 7869  p - demand_proxi
-000089c0: 6d61 6c5f 6c69 6e65 735b 695d 2920 2f20  mal_lines[i]) / 
-000089d0: 636d 7029 202a 2031 3030 0a20 2020 2023  cmp) * 100.    #
+00005ff0: 2020 2020 2020 2020 206b 203d 206a 202b           k = j +
+00006000: 2031 0a20 2020 2023 2020 2020 2020 2020   1.    #        
+00006010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006020: 2077 6869 6c65 206b 203c 206c 656e 2864   while k < len(d
+00006030: 6174 6129 2061 6e64 2028 6461 7461 5b27  ata) and (data['
+00006040: 4361 6e64 6c65 2054 7970 6527 5d5b 6b5d  Candle Type'][k]
+00006050: 203d 3d20 2744 726f 7020 4361 6e64 6c65   == 'Drop Candle
+00006060: 2720 6f72 2064 6174 615b 2743 6c6f 7365  ' or data['Close
+00006070: 275d 5b6b 5d20 3c20 6461 7461 5b27 4f70  '][k] < data['Op
+00006080: 656e 275d 5b6b 5d29 3a0a 2020 2020 2320  en'][k]):.    # 
+00006090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000060a0: 2020 2020 2020 2020 2020 2020 6b20 2b3d              k +=
+000060b0: 2031 0a20 2020 2023 2020 2020 2020 2020   1.    #        
+000060c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000060d0: 2069 6620 6b20 3c20 6c65 6e28 6461 7461   if k < len(data
+000060e0: 2920 616e 6420 2864 6174 615b 2743 616e  ) and (data['Can
+000060f0: 646c 6520 5479 7065 275d 5b6b 5d20 3d3d  dle Type'][k] ==
+00006100: 2027 4472 6f70 2043 616e 646c 6527 206f   'Drop Candle' o
+00006110: 7220 6461 7461 5b27 436c 6f73 6527 5d5b  r data['Close'][
+00006120: 6b5d 203c 2064 6174 615b 274f 7065 6e27  k] < data['Open'
+00006130: 5d5b 6b5d 293a 0a20 2020 2023 2020 2020  ][k]):.    #    
+00006140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006150: 2020 2020 2020 2020 2073 7570 706c 795f           supply_
+00006160: 7a6f 6e65 732e 6170 7065 6e64 2828 692c  zones.append((i,
+00006170: 206a 2c20 2744 726f 7020 4261 7365 2044   j, 'Drop Base D
+00006180: 726f 7027 2c20 6261 7365 5f63 6f75 6e74  rop', base_count
+00006190: 2929 0a20 2020 2023 2020 2020 2020 2020  )).    #        
+000061a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061b0: 2020 2020 2064 726f 705f 6261 7365 5f64       drop_base_d
+000061c0: 726f 705f 7a6f 6e65 203d 2054 7275 650a  rop_zone = True.
+000061d0: 2020 2020 2320 2020 2020 2020 2020 656c      #         el
+000061e0: 6966 2064 6174 615b 2743 616e 646c 6520  if data['Candle 
+000061f0: 5479 7065 275d 5b69 5d20 3d3d 2027 5261  Type'][i] == 'Ra
+00006200: 6c6c 7920 4361 6e64 6c65 2720 616e 6420  lly Candle' and 
+00006210: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
+00006220: 6527 5d5b 6920 2b20 315d 203d 3d20 2742  e'][i + 1] == 'B
+00006230: 6173 6520 4361 6e64 6c65 273a 0a20 2020  ase Candle':.   
+00006240: 2023 2020 2020 2020 2020 2020 2020 2062   #             b
+00006250: 6173 655f 636f 756e 7420 3d20 310a 2020  ase_count = 1.  
+00006260: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00006270: 6a20 3d20 6920 2b20 320a 2020 2020 2320  j = i + 2.    # 
+00006280: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+00006290: 6520 6a20 3c20 6c65 6e28 6461 7461 2920  e j < len(data) 
+000062a0: 616e 6420 6461 7461 5b27 4361 6e64 6c65  and data['Candle
+000062b0: 2054 7970 6527 5d5b 6a5d 203d 3d20 2742   Type'][j] == 'B
+000062c0: 6173 6520 4361 6e64 6c65 273a 0a20 2020  ase Candle':.   
+000062d0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+000062e0: 2020 2062 6173 655f 636f 756e 7420 2b3d     base_count +=
+000062f0: 2031 0a20 2020 2023 2020 2020 2020 2020   1.    #        
+00006300: 2020 2020 2020 2020 206a 202b 3d20 310a           j += 1.
+00006310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006320: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00006330: 2020 2069 6620 6261 7365 5f63 6f75 6e74     if base_count
+00006340: 203e 3d20 313a 2020 2320 4174 206c 6561   >= 1:  # At lea
+00006350: 7374 206f 6e65 2062 6173 6520 6361 6e64  st one base cand
+00006360: 6c65 2072 6571 7569 7265 640a 2020 2020  le required.    
+00006370: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00006380: 2020 6966 206a 203c 206c 656e 2864 6174    if j < len(dat
+00006390: 6129 2061 6e64 2064 6174 615b 2743 616e  a) and data['Can
+000063a0: 646c 6520 5479 7065 275d 5b6a 5d20 3d3d  dle Type'][j] ==
+000063b0: 2027 4472 6f70 2043 616e 646c 6527 3a0a   'Drop Candle':.
+000063c0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+000063d0: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
+000063e0: 615b 2743 6c6f 7365 275d 5b6a 5d20 3c20  a['Close'][j] < 
+000063f0: 6461 7461 5b27 4f70 656e 275d 5b6a 5d20  data['Open'][j] 
+00006400: 616e 6420 6461 7461 5b27 4c6f 7727 5d5b  and data['Low'][
+00006410: 695d 203e 3d20 636d 703a 2020 2320 4d6f  i] >= cmp:  # Mo
+00006420: 6469 6669 6564 2063 6f6e 6469 7469 6f6e  dified condition
+00006430: 3a20 636c 6f73 6520 6f66 2064 726f 7020  : close of drop 
+00006440: 6361 6e64 6c65 203c 206f 7065 6e20 6f66  candle < open of
+00006450: 2064 726f 7020 6361 6e64 6c65 0a20 2020   drop candle.   
+00006460: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00006470: 2020 2020 2020 2020 2020 2073 7570 706c             suppl
+00006480: 795f 7a6f 6e65 732e 6170 7065 6e64 2828  y_zones.append((
+00006490: 692c 206a 2c20 2752 616c 6c79 2042 6173  i, j, 'Rally Bas
+000064a0: 6520 4472 6f70 272c 2062 6173 655f 636f  e Drop', base_co
+000064b0: 756e 7429 290a 2020 2020 2320 2020 2020  unt)).    #     
+000064c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000064d0: 2020 2020 7261 6c6c 795f 6261 7365 5f64      rally_base_d
+000064e0: 726f 705f 7a6f 6e65 203d 2054 7275 650a  rop_zone = True.
+000064f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006500: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00006510: 2023 2020 2020 2020 2020 2023 2043 6f6c   #         # Col
+00006520: 6c65 6374 2062 6173 6520 6361 6e64 6c65  lect base candle
+00006530: 2070 7269 6365 7320 666f 7220 7072 6f78   prices for prox
+00006540: 696d 616c 206c 696e 6520 6361 6c63 756c  imal line calcul
+00006550: 6174 696f 6e0a 2020 2020 2320 2020 2020  ation.    #     
+00006560: 2020 2020 6966 2064 6174 615b 2743 616e      if data['Can
+00006570: 646c 6520 5479 7065 275d 5b69 5d20 3d3d  dle Type'][i] ==
+00006580: 2027 4261 7365 2043 616e 646c 6527 3a0a   'Base Candle':.
+00006590: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+000065a0: 2020 6261 7365 5f63 616e 646c 655f 7072    base_candle_pr
+000065b0: 6963 6573 2e61 7070 656e 6428 6461 7461  ices.append(data
+000065c0: 5b27 436c 6f73 6527 5d5b 695d 290a 0a20  ['Close'][i]).. 
+000065d0: 2020 2023 2020 2020 2023 2043 616c 6375     #     # Calcu
+000065e0: 6c61 7465 2070 726f 7869 6d61 6c20 6c69  late proximal li
+000065f0: 6e65 2070 7269 6365 2028 6c6f 7765 7374  ne price (lowest
+00006600: 2070 7269 6365 2061 6d6f 6e67 2062 6173   price among bas
+00006610: 6520 6361 6e64 6c65 7329 0a20 2020 2023  e candles).    #
+00006620: 2020 2020 2070 726f 7869 6d61 6c5f 6c69       proximal_li
+00006630: 6e65 5f70 7269 6365 203d 206d 696e 2862  ne_price = min(b
+00006640: 6173 655f 6361 6e64 6c65 5f70 7269 6365  ase_candle_price
+00006650: 7329 2069 6620 6261 7365 5f63 616e 646c  s) if base_candl
+00006660: 655f 7072 6963 6573 2065 6c73 6520 4e6f  e_prices else No
+00006670: 6e65 0a0a 2020 2020 2320 2020 2020 7265  ne..    #     re
+00006680: 7475 726e 2073 7570 706c 795f 7a6f 6e65  turn supply_zone
+00006690: 732c 2072 616c 6c79 5f62 6173 655f 6472  s, rally_base_dr
+000066a0: 6f70 5f7a 6f6e 652c 2064 726f 705f 6261  op_zone, drop_ba
+000066b0: 7365 5f64 726f 705f 7a6f 6e65 2c20 7072  se_drop_zone, pr
+000066c0: 6f78 696d 616c 5f6c 696e 655f 7072 6963  oximal_line_pric
+000066d0: 650a 0a20 2020 2023 2064 6566 2063 616c  e..    # def cal
+000066e0: 6375 6c61 7465 5f64 656d 616e 645f 7072  culate_demand_pr
+000066f0: 6f78 696d 616c 5f6c 696e 6573 2873 656c  oximal_lines(sel
+00006700: 662c 6461 7461 2c20 6465 6d61 6e64 5f7a  f,data, demand_z
+00006710: 6f6e 6573 293a 0a20 2020 2023 2020 2020  ones):.    #    
+00006720: 2070 726f 7869 6d61 6c5f 6c69 6e65 5f70   proximal_line_p
+00006730: 7269 6365 7320 3d20 5b5d 0a20 2020 2023  rices = [].    #
+00006740: 2020 2020 2066 6f72 2073 7461 7274 2c20       for start, 
+00006750: 656e 642c 205f 2c20 5f20 696e 2064 656d  end, _, _ in dem
+00006760: 616e 645f 7a6f 6e65 733a 0a20 2020 2023  and_zones:.    #
+00006770: 2020 2020 2020 2020 2062 6173 655f 6361           base_ca
+00006780: 6e64 6c65 5f70 7269 6365 7320 3d20 6461  ndle_prices = da
+00006790: 7461 2e6c 6f63 5b28 6461 7461 5b27 4361  ta.loc[(data['Ca
+000067a0: 6e64 6c65 2054 7970 6527 5d20 3d3d 2027  ndle Type'] == '
+000067b0: 4261 7365 2043 616e 646c 6527 2920 2620  Base Candle') & 
+000067c0: 2864 6174 612e 696e 6465 7820 3e3d 2064  (data.index >= d
+000067d0: 6174 612e 696e 6465 785b 7374 6172 745d  ata.index[start]
+000067e0: 2920 2620 2864 6174 612e 696e 6465 7820  ) & (data.index 
+000067f0: 3c3d 2064 6174 612e 696e 6465 785b 656e  <= data.index[en
+00006800: 645d 292c 205b 274f 7065 6e27 2c20 2743  d]), ['Open', 'C
+00006810: 6c6f 7365 275d 5d0a 2020 2020 2320 2020  lose']].    #   
+00006820: 2020 2020 2020 6d61 785f 7072 6963 6520        max_price 
+00006830: 3d20 6261 7365 5f63 616e 646c 655f 7072  = base_candle_pr
+00006840: 6963 6573 2e6d 6178 2861 7869 733d 3129  ices.max(axis=1)
+00006850: 2e6d 6178 2829 2020 2320 4765 7420 7468  .max()  # Get th
+00006860: 6520 6d61 7869 6d75 6d20 7072 6963 6520  e maximum price 
+00006870: 616d 6f6e 6720 616c 6c20 6261 7365 2063  among all base c
+00006880: 616e 646c 6573 2720 6f70 656e 2061 6e64  andles' open and
+00006890: 2063 6c6f 7365 2070 7269 6365 730a 2020   close prices.  
+000068a0: 2020 2320 2020 2020 2020 2020 7072 6f78    #         prox
+000068b0: 696d 616c 5f6c 696e 655f 7072 6963 6573  imal_line_prices
+000068c0: 2e61 7070 656e 6428 6d61 785f 7072 6963  .append(max_pric
+000068d0: 6529 0a20 2020 2023 2020 2020 2072 6574  e).    #     ret
+000068e0: 7572 6e20 7072 6f78 696d 616c 5f6c 696e  urn proximal_lin
+000068f0: 655f 7072 6963 6573 0a0a 2020 2020 2320  e_prices..    # 
+00006900: 6465 6620 6361 6c63 756c 6174 655f 7375  def calculate_su
+00006910: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
+00006920: 6e65 7328 7365 6c66 2c64 6174 612c 2073  nes(self,data, s
+00006930: 7570 706c 795f 7a6f 6e65 7329 3a0a 2020  upply_zones):.  
+00006940: 2020 2320 2020 2020 7072 6f78 696d 616c    #     proximal
+00006950: 5f6c 696e 655f 7072 6963 6573 203d 205b  _line_prices = [
+00006960: 5d0a 2020 2020 2320 2020 2020 666f 7220  ].    #     for 
+00006970: 7374 6172 742c 2065 6e64 2c20 5f2c 205f  start, end, _, _
+00006980: 2069 6e20 7375 7070 6c79 5f7a 6f6e 6573   in supply_zones
+00006990: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+000069a0: 6261 7365 5f63 616e 646c 655f 7072 6963  base_candle_pric
+000069b0: 6573 203d 2064 6174 612e 6c6f 635b 2864  es = data.loc[(d
+000069c0: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
+000069d0: 275d 203d 3d20 2742 6173 6520 4361 6e64  '] == 'Base Cand
+000069e0: 6c65 2729 2026 2028 6461 7461 2e69 6e64  le') & (data.ind
+000069f0: 6578 203e 3d20 6461 7461 2e69 6e64 6578  ex >= data.index
+00006a00: 5b73 7461 7274 5d29 2026 2028 6461 7461  [start]) & (data
+00006a10: 2e69 6e64 6578 203c 3d20 6461 7461 2e69  .index <= data.i
+00006a20: 6e64 6578 5b65 6e64 5d29 2c20 5b27 4f70  ndex[end]), ['Op
+00006a30: 656e 272c 2027 436c 6f73 6527 5d5d 0a20  en', 'Close']]. 
+00006a40: 2020 2023 2020 2020 2020 2020 206d 696e     #         min
+00006a50: 5f70 7269 6365 203d 2062 6173 655f 6361  _price = base_ca
+00006a60: 6e64 6c65 5f70 7269 6365 732e 6d69 6e28  ndle_prices.min(
+00006a70: 6178 6973 3d31 292e 6d69 6e28 2920 2023  axis=1).min()  #
+00006a80: 2047 6574 2074 6865 206d 696e 696d 756d   Get the minimum
+00006a90: 2070 7269 6365 2061 6d6f 6e67 2061 6c6c   price among all
+00006aa0: 2062 6173 6520 6361 6e64 6c65 7327 206f   base candles' o
+00006ab0: 7065 6e20 616e 6420 636c 6f73 6520 7072  pen and close pr
+00006ac0: 6963 6573 0a20 2020 2023 2020 2020 2020  ices.    #      
+00006ad0: 2020 2070 726f 7869 6d61 6c5f 6c69 6e65     proximal_line
+00006ae0: 5f70 7269 6365 732e 6170 7065 6e64 286d  _prices.append(m
+00006af0: 696e 5f70 7269 6365 290a 2020 2020 2320  in_price).    # 
+00006b00: 2020 2020 7265 7475 726e 2070 726f 7869      return proxi
+00006b10: 6d61 6c5f 6c69 6e65 5f70 7269 6365 730a  mal_line_prices.
+00006b20: 2020 2020 2020 2020 0a20 2020 2023 2064          .    # d
+00006b30: 6566 2063 616c 6375 6c61 7465 5f64 656d  ef calculate_dem
+00006b40: 616e 645f 6469 7374 616c 5f6c 696e 6573  and_distal_lines
+00006b50: 2873 656c 662c 6461 7461 2c20 6465 6d61  (self,data, dema
+00006b60: 6e64 5f7a 6f6e 6573 293a 0a20 2020 2023  nd_zones):.    #
+00006b70: 2020 2020 2064 6973 7461 6c5f 6c69 6e65       distal_line
+00006b80: 5f70 7269 6365 7320 3d20 5b5d 0a20 2020  _prices = [].   
+00006b90: 2023 2020 2020 2066 6f72 2073 7461 7274   #     for start
+00006ba0: 2c20 656e 642c 2070 6174 7465 726e 2c20  , end, pattern, 
+00006bb0: 5f20 696e 2064 656d 616e 645f 7a6f 6e65  _ in demand_zone
+00006bc0: 733a 0a20 2020 2023 2020 2020 2020 2020  s:.    #        
+00006bd0: 2069 6620 7061 7474 6572 6e20 3d3d 2027   if pattern == '
+00006be0: 4472 6f70 2042 6173 6520 5261 6c6c 7927  Drop Base Rally'
+00006bf0: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+00006c00: 2020 2020 2320 4c6f 6769 6320 666f 7220      # Logic for 
+00006c10: 4472 6f70 2042 6173 6520 5261 6c6c 7920  Drop Base Rally 
+00006c20: 7061 7474 6572 6e3a 2054 616b 6520 7468  pattern: Take th
+00006c30: 6520 6c6f 7765 7374 2070 7269 6365 2061  e lowest price a
+00006c40: 6d6f 6e67 2061 6c6c 2063 6f6d 706f 6e65  mong all compone
+00006c50: 6e74 7320 6f66 2074 6865 207a 6f6e 650a  nts of the zone.
+00006c60: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00006c70: 2020 6c6f 7765 7374 5f70 7269 6365 203d    lowest_price =
+00006c80: 206d 696e 2864 6174 615b 274c 6f77 275d   min(data['Low']
+00006c90: 5b73 7461 7274 3a65 6e64 202b 2031 5d29  [start:end + 1])
+00006ca0: 2020 2320 4765 7420 7468 6520 6c6f 7765    # Get the lowe
+00006cb0: 7374 2070 7269 6365 2077 6974 6869 6e20  st price within 
+00006cc0: 7468 6520 7a6f 6e65 0a20 2020 2023 2020  the zone.    #  
+00006cd0: 2020 2020 2020 2020 2020 2064 6973 7461             dista
+00006ce0: 6c5f 6c69 6e65 5f70 7269 6365 732e 6170  l_line_prices.ap
+00006cf0: 7065 6e64 286c 6f77 6573 745f 7072 6963  pend(lowest_pric
+00006d00: 6529 0a20 2020 2023 2020 2020 2020 2020  e).    #        
+00006d10: 2065 6c69 6620 7061 7474 6572 6e20 3d3d   elif pattern ==
+00006d20: 2027 5261 6c6c 7920 4261 7365 2052 616c   'Rally Base Ral
+00006d30: 6c79 273a 0a20 2020 2023 2020 2020 2020  ly':.    #      
+00006d40: 2020 2020 2020 2023 204c 6f67 6963 2066         # Logic f
+00006d50: 6f72 2052 616c 6c79 2042 6173 6520 5261  or Rally Base Ra
+00006d60: 6c6c 7920 7061 7474 6572 6e3a 2054 616b  lly pattern: Tak
+00006d70: 6520 7468 6520 6c6f 7765 7374 206f 6620  e the lowest of 
+00006d80: 6f6e 6c79 2061 6c6c 2062 6173 6520 6361  only all base ca
+00006d90: 6e64 6c65 2061 6e64 2066 6f6c 6c6f 7765  ndle and followe
+00006da0: 6420 7261 6c6c 7920 6361 6e64 6c65 0a20  d rally candle. 
+00006db0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00006dc0: 2062 6173 655f 6361 6e64 6c65 5f70 7269   base_candle_pri
+00006dd0: 6365 7320 3d20 6461 7461 2e6c 6f63 5b28  ces = data.loc[(
+00006de0: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
+00006df0: 6527 5d20 3d3d 2027 4261 7365 2043 616e  e'] == 'Base Can
+00006e00: 646c 6527 2920 2620 2864 6174 612e 696e  dle') & (data.in
+00006e10: 6465 7820 3e3d 2064 6174 612e 696e 6465  dex >= data.inde
+00006e20: 785b 7374 6172 745d 2920 2620 2864 6174  x[start]) & (dat
+00006e30: 612e 696e 6465 7820 3c3d 2064 6174 612e  a.index <= data.
+00006e40: 696e 6465 785b 656e 645d 292c 2027 4c6f  index[end]), 'Lo
+00006e50: 7727 5d0a 2020 2020 2320 2020 2020 2020  w'].    #       
+00006e60: 2020 2020 2020 7261 6c6c 795f 6361 6e64        rally_cand
+00006e70: 6c65 5f70 7269 6365 7320 3d20 6461 7461  le_prices = data
+00006e80: 2e6c 6f63 5b28 6461 7461 5b27 4361 6e64  .loc[(data['Cand
+00006e90: 6c65 2054 7970 6527 5d20 3d3d 2027 5261  le Type'] == 'Ra
+00006ea0: 6c6c 7920 4361 6e64 6c65 2729 2026 2028  lly Candle') & (
+00006eb0: 6461 7461 2e69 6e64 6578 203e 3d20 6461  data.index >= da
+00006ec0: 7461 2e69 6e64 6578 5b65 6e64 5d29 2026  ta.index[end]) &
+00006ed0: 2028 6461 7461 2e69 6e64 6578 203c 2064   (data.index < d
+00006ee0: 6174 612e 696e 6465 785b 656e 642b 315d  ata.index[end+1]
+00006ef0: 292c 2027 4c6f 7727 5d0a 2020 2020 2320  ), 'Low'].    # 
+00006f00: 2020 2020 2020 2020 2020 2020 616c 6c5f              all_
+00006f10: 7072 6963 6573 203d 2070 642e 636f 6e63  prices = pd.conc
+00006f20: 6174 285b 6261 7365 5f63 616e 646c 655f  at([base_candle_
+00006f30: 7072 6963 6573 2c20 7261 6c6c 795f 6361  prices, rally_ca
+00006f40: 6e64 6c65 5f70 7269 6365 735d 290a 2020  ndle_prices]).  
+00006f50: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00006f60: 6c6f 7765 7374 5f70 7269 6365 203d 2061  lowest_price = a
+00006f70: 6c6c 5f70 7269 6365 732e 6d69 6e28 2920  ll_prices.min() 
+00006f80: 6966 206e 6f74 2061 6c6c 5f70 7269 6365  if not all_price
+00006f90: 732e 656d 7074 7920 656c 7365 204e 6f6e  s.empty else Non
+00006fa0: 650a 2020 2020 2320 2020 2020 2020 2020  e.    #         
+00006fb0: 2020 2020 6469 7374 616c 5f6c 696e 655f      distal_line_
+00006fc0: 7072 6963 6573 2e61 7070 656e 6428 6c6f  prices.append(lo
+00006fd0: 7765 7374 5f70 7269 6365 290a 2020 2020  west_price).    
+00006fe0: 2320 2020 2020 7265 7475 726e 2064 6973  #     return dis
+00006ff0: 7461 6c5f 6c69 6e65 5f70 7269 6365 730a  tal_line_prices.
+00007000: 0a20 2020 2023 2064 6566 2063 616c 6375  .    # def calcu
+00007010: 6c61 7465 5f73 7570 706c 795f 6469 7374  late_supply_dist
+00007020: 616c 5f6c 696e 6573 2873 656c 662c 6461  al_lines(self,da
+00007030: 7461 2c20 7375 7070 6c79 5f7a 6f6e 6573  ta, supply_zones
+00007040: 293a 0a20 2020 2023 2020 2020 2064 6973  ):.    #     dis
+00007050: 7461 6c5f 6c69 6e65 5f70 7269 6365 7320  tal_line_prices 
+00007060: 3d20 5b5d 0a20 2020 2023 2020 2020 2066  = [].    #     f
+00007070: 6f72 2073 7461 7274 2c20 656e 642c 2070  or start, end, p
+00007080: 6174 7465 726e 2c20 5f20 696e 2073 7570  attern, _ in sup
+00007090: 706c 795f 7a6f 6e65 733a 0a20 2020 2023  ply_zones:.    #
+000070a0: 2020 2020 2020 2020 2069 6620 7061 7474           if patt
+000070b0: 6572 6e20 3d3d 2027 5261 6c6c 7920 4261  ern == 'Rally Ba
+000070c0: 7365 2044 726f 7027 3a0a 2020 2020 2320  se Drop':.    # 
+000070d0: 2020 2020 2020 2020 2020 2020 2320 4c6f              # Lo
+000070e0: 6769 6320 666f 7220 5261 6c6c 7920 4261  gic for Rally Ba
+000070f0: 7365 2044 726f 7020 7061 7474 6572 6e3a  se Drop pattern:
+00007100: 2054 616b 6520 7468 6520 6869 6768 6573   Take the highes
+00007110: 7420 7072 6963 6520 616d 6f6e 6720 616c  t price among al
+00007120: 6c20 636f 6d70 6f6e 656e 7473 206f 6620  l components of 
+00007130: 7468 6520 7a6f 6e65 0a20 2020 2023 2020  the zone.    #  
+00007140: 2020 2020 2020 2020 2020 2068 6967 6865             highe
+00007150: 7374 5f70 7269 6365 203d 206d 6178 2864  st_price = max(d
+00007160: 6174 615b 2748 6967 6827 5d5b 7374 6172  ata['High'][star
+00007170: 743a 656e 6420 2b20 315d 2920 2023 2047  t:end + 1])  # G
+00007180: 6574 2074 6865 2068 6967 6865 7374 2070  et the highest p
+00007190: 7269 6365 2077 6974 6869 6e20 7468 6520  rice within the 
+000071a0: 7a6f 6e65 0a20 2020 2023 2020 2020 2020  zone.    #      
+000071b0: 2020 2020 2020 2064 6973 7461 6c5f 6c69         distal_li
+000071c0: 6e65 5f70 7269 6365 732e 6170 7065 6e64  ne_prices.append
+000071d0: 2868 6967 6865 7374 5f70 7269 6365 290a  (highest_price).
+000071e0: 2020 2020 2320 2020 2020 2020 2020 656c      #         el
+000071f0: 6966 2070 6174 7465 726e 203d 3d20 2744  if pattern == 'D
+00007200: 726f 7020 4261 7365 2044 726f 7027 3a0a  rop Base Drop':.
+00007210: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00007220: 2020 2320 4c6f 6769 6320 666f 7220 4472    # Logic for Dr
+00007230: 6f70 2042 6173 6520 4472 6f70 2070 6174  op Base Drop pat
+00007240: 7465 726e 3a20 5461 6b65 2074 6865 2068  tern: Take the h
+00007250: 6967 6865 7374 206f 6620 6f6e 6c79 2061  ighest of only a
+00007260: 6c6c 2062 6173 6520 6361 6e64 6c65 7320  ll base candles 
+00007270: 616e 6420 666f 6c6c 6f77 6564 2064 726f  and followed dro
+00007280: 7020 6361 6e64 6c65 0a20 2020 2023 2020  p candle.    #  
+00007290: 2020 2020 2020 2020 2020 2062 6173 655f             base_
+000072a0: 6361 6e64 6c65 5f70 7269 6365 7320 3d20  candle_prices = 
+000072b0: 6461 7461 2e6c 6f63 5b28 6461 7461 5b27  data.loc[(data['
+000072c0: 4361 6e64 6c65 2054 7970 6527 5d20 3d3d  Candle Type'] ==
+000072d0: 2027 4261 7365 2043 616e 646c 6527 2920   'Base Candle') 
+000072e0: 2620 2864 6174 612e 696e 6465 7820 3e3d  & (data.index >=
+000072f0: 2064 6174 612e 696e 6465 785b 7374 6172   data.index[star
+00007300: 745d 2920 2620 2864 6174 612e 696e 6465  t]) & (data.inde
+00007310: 7820 3c3d 2064 6174 612e 696e 6465 785b  x <= data.index[
+00007320: 656e 645d 292c 2027 4869 6768 275d 0a20  end]), 'High']. 
+00007330: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00007340: 2064 726f 705f 6361 6e64 6c65 5f70 7269   drop_candle_pri
+00007350: 6365 7320 3d20 6461 7461 2e6c 6f63 5b28  ces = data.loc[(
+00007360: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
+00007370: 6527 5d20 3d3d 2027 4472 6f70 2043 616e  e'] == 'Drop Can
+00007380: 646c 6527 2920 2620 2864 6174 612e 696e  dle') & (data.in
+00007390: 6465 7820 3e3d 2064 6174 612e 696e 6465  dex >= data.inde
+000073a0: 785b 7374 6172 745d 2920 2620 2864 6174  x[start]) & (dat
+000073b0: 612e 696e 6465 7820 3c3d 2064 6174 612e  a.index <= data.
+000073c0: 696e 6465 785b 656e 645d 292c 2027 4869  index[end]), 'Hi
+000073d0: 6768 275d 0a20 2020 2023 2020 2020 2020  gh'].    #      
+000073e0: 2020 2020 2020 2061 6c6c 5f70 7269 6365         all_price
+000073f0: 7320 3d20 7064 2e63 6f6e 6361 7428 5b62  s = pd.concat([b
+00007400: 6173 655f 6361 6e64 6c65 5f70 7269 6365  ase_candle_price
+00007410: 732c 2064 726f 705f 6361 6e64 6c65 5f70  s, drop_candle_p
+00007420: 7269 6365 735d 290a 2020 2020 2320 2020  rices]).    #   
+00007430: 2020 2020 2020 2020 2020 6869 6768 6573            highes
+00007440: 745f 7072 6963 6520 3d20 616c 6c5f 7072  t_price = all_pr
+00007450: 6963 6573 2e6d 6178 2829 2069 6620 6e6f  ices.max() if no
+00007460: 7420 616c 6c5f 7072 6963 6573 2e65 6d70  t all_prices.emp
+00007470: 7479 2065 6c73 6520 4e6f 6e65 0a20 2020  ty else None.   
+00007480: 2023 2020 2020 2020 2020 2020 2020 2064   #             d
+00007490: 6973 7461 6c5f 6c69 6e65 5f70 7269 6365  istal_line_price
+000074a0: 732e 6170 7065 6e64 2868 6967 6865 7374  s.append(highest
+000074b0: 5f70 7269 6365 290a 2020 2020 2320 2020  _price).    #   
+000074c0: 2020 7265 7475 726e 2064 6973 7461 6c5f    return distal_
+000074d0: 6c69 6e65 5f70 7269 6365 730a 0a20 2020  line_prices..   
+000074e0: 2023 2064 6566 2069 735f 7a6f 6e65 5f74   # def is_zone_t
+000074f0: 6573 7465 6428 7365 6c66 2c64 6174 612c  ested(self,data,
+00007500: 2073 7461 7274 5f69 6e64 6578 2c20 656e   start_index, en
+00007510: 645f 696e 6465 782c 2070 726f 7869 6d61  d_index, proxima
+00007520: 6c5f 6c69 6e65 5f70 7269 6365 293a 0a20  l_line_price):. 
+00007530: 2020 2023 2020 2020 2022 2222 0a20 2020     #     """.   
+00007540: 2023 2020 2020 2043 6865 636b 2069 6620   #     Check if 
+00007550: 7468 6520 7072 6f78 696d 616c 206c 696e  the proximal lin
+00007560: 6520 7072 6963 6520 6861 7320 6265 656e  e price has been
+00007570: 2074 6573 7465 6420 6279 2066 7574 7572   tested by futur
+00007580: 6520 7072 6963 6573 2e0a 2020 2020 2020  e prices..      
+00007590: 2020 0a20 2020 2023 2020 2020 2041 7267    .    #     Arg
+000075a0: 733a 0a20 2020 2023 2020 2020 202d 2064  s:.    #     - d
+000075b0: 6174 613a 2044 6174 6146 7261 6d65 2063  ata: DataFrame c
+000075c0: 6f6e 7461 696e 696e 6720 7374 6f63 6b20  ontaining stock 
+000075d0: 6461 7461 0a20 2020 2023 2020 2020 202d  data.    #     -
+000075e0: 2073 7461 7274 5f69 6e64 6578 3a20 5374   start_index: St
+000075f0: 6172 7420 696e 6465 7820 6f66 2074 6865  art index of the
+00007600: 2064 656d 616e 642f 7375 7070 6c79 207a   demand/supply z
+00007610: 6f6e 650a 2020 2020 2320 2020 2020 2d20  one.    #     - 
+00007620: 656e 645f 696e 6465 783a 2045 6e64 2069  end_index: End i
+00007630: 6e64 6578 206f 6620 7468 6520 6465 6d61  ndex of the dema
+00007640: 6e64 2f73 7570 706c 7920 7a6f 6e65 0a20  nd/supply zone. 
+00007650: 2020 2023 2020 2020 202d 2070 726f 7869     #     - proxi
+00007660: 6d61 6c5f 6c69 6e65 5f70 7269 6365 3a20  mal_line_price: 
+00007670: 5072 6f78 696d 616c 206c 696e 6520 7072  Proximal line pr
+00007680: 6963 650a 2020 2020 2020 2020 0a20 2020  ice.        .   
+00007690: 2023 2020 2020 2052 6574 7572 6e73 3a0a   #     Returns:.
+000076a0: 2020 2020 2320 2020 2020 2d20 5472 7565      #     - True
+000076b0: 2069 6620 7468 6520 7072 6f78 696d 616c   if the proximal
+000076c0: 206c 696e 6520 7072 6963 6520 6973 2074   line price is t
+000076d0: 6573 7465 642c 2046 616c 7365 206f 7468  ested, False oth
+000076e0: 6572 7769 7365 0a20 2020 2023 2020 2020  erwise.    #    
+000076f0: 2022 2222 0a20 2020 2023 2020 2020 2066   """.    #     f
+00007700: 6f72 2069 2069 6e20 7261 6e67 6528 656e  or i in range(en
+00007710: 645f 696e 6465 7820 2b20 312c 206c 656e  d_index + 1, len
+00007720: 2864 6174 6129 293a 0a20 2020 2023 2020  (data)):.    #  
+00007730: 2020 2020 2020 2069 6620 6461 7461 5b27         if data['
+00007740: 4c6f 7727 5d5b 695d 203c 3d20 7072 6f78  Low'][i] <= prox
+00007750: 696d 616c 5f6c 696e 655f 7072 6963 6520  imal_line_price 
+00007760: 3c3d 2064 6174 615b 2748 6967 6827 5d5b  <= data['High'][
+00007770: 695d 3a0a 2020 2020 2320 2020 2020 2020  i]:.    #       
+00007780: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00007790: 650a 2020 2020 2320 2020 2020 7265 7475  e.    #     retu
+000077a0: 726e 2046 616c 7365 0a0a 2020 2020 2320  rn False..    # 
+000077b0: 6465 6620 6361 6c63 756c 6174 655f 7a6f  def calculate_zo
+000077c0: 6e65 5f72 616e 6765 2873 656c 662c 7072  ne_range(self,pr
+000077d0: 6f78 696d 616c 5f6c 696e 652c 2064 6973  oximal_line, dis
+000077e0: 7461 6c5f 6c69 6e65 293a 0a20 2020 2023  tal_line):.    #
+000077f0: 2020 2020 2022 2222 0a20 2020 2023 2020       """.    #  
+00007800: 2020 2043 616c 6375 6c61 7465 2074 6865     Calculate the
+00007810: 2072 616e 6765 206f 6620 6120 7a6f 6e65   range of a zone
+00007820: 2067 6976 656e 2069 7473 2070 726f 7869   given its proxi
+00007830: 6d61 6c20 616e 6420 6469 7374 616c 206c  mal and distal l
+00007840: 696e 6573 2e0a 2020 2020 2020 2020 0a20  ines..        . 
+00007850: 2020 2023 2020 2020 2041 7267 733a 0a20     #     Args:. 
+00007860: 2020 2023 2020 2020 202d 2070 726f 7869     #     - proxi
+00007870: 6d61 6c5f 6c69 6e65 3a20 5072 6f78 696d  mal_line: Proxim
+00007880: 616c 206c 696e 6520 7072 6963 650a 2020  al line price.  
+00007890: 2020 2320 2020 2020 2d20 6469 7374 616c    #     - distal
+000078a0: 5f6c 696e 653a 2044 6973 7461 6c20 6c69  _line: Distal li
+000078b0: 6e65 2070 7269 6365 0a20 2020 2020 2020  ne price.       
+000078c0: 200a 2020 2020 2320 2020 2020 5265 7475   .    #     Retu
+000078d0: 726e 733a 0a20 2020 2023 2020 2020 202d  rns:.    #     -
+000078e0: 2052 616e 6765 206f 6620 7468 6520 7a6f   Range of the zo
+000078f0: 6e65 0a20 2020 2023 2020 2020 2022 2222  ne.    #     """
+00007900: 0a20 2020 2023 2020 2020 2069 6620 7072  .    #     if pr
+00007910: 6f78 696d 616c 5f6c 696e 6520 6973 206e  oximal_line is n
+00007920: 6f74 204e 6f6e 6520 616e 6420 6469 7374  ot None and dist
+00007930: 616c 5f6c 696e 6520 6973 206e 6f74 204e  al_line is not N
+00007940: 6f6e 653a 0a20 2020 2023 2020 2020 2020  one:.    #      
+00007950: 2020 2072 6574 7572 6e20 6162 7328 7072     return abs(pr
+00007960: 6f78 696d 616c 5f6c 696e 6520 2d20 6469  oximal_line - di
+00007970: 7374 616c 5f6c 696e 6529 0a20 2020 2023  stal_line).    #
+00007980: 2020 2020 2065 6c73 653a 0a20 2020 2023       else:.    #
+00007990: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000079a0: 4e6f 6e65 0a0a 2020 2020 2320 6465 6620  None..    # def 
+000079b0: 6361 6c63 756c 6174 655f 6465 6d61 6e64  calculate_demand
+000079c0: 5f7a 6f6e 655f 7261 6e67 6573 2873 656c  _zone_ranges(sel
+000079d0: 662c 6465 6d61 6e64 5f7a 6f6e 6573 2c20  f,demand_zones, 
+000079e0: 6465 6d61 6e64 5f70 726f 7869 6d61 6c5f  demand_proximal_
+000079f0: 6c69 6e65 732c 2064 656d 616e 645f 6469  lines, demand_di
+00007a00: 7374 616c 5f6c 696e 6573 293a 0a20 2020  stal_lines):.   
+00007a10: 2023 2020 2020 2022 2222 0a20 2020 2023   #     """.    #
+00007a20: 2020 2020 2043 616c 6375 6c61 7465 2074       Calculate t
+00007a30: 6865 2072 616e 6765 206f 6620 6561 6368  he range of each
+00007a40: 2064 656d 616e 6420 7a6f 6e65 2e0a 2020   demand zone..  
+00007a50: 2020 2020 2020 0a20 2020 2023 2020 2020        .    #    
+00007a60: 2041 7267 733a 0a20 2020 2023 2020 2020   Args:.    #    
+00007a70: 202d 2064 656d 616e 645f 7a6f 6e65 733a   - demand_zones:
+00007a80: 204c 6973 7420 6f66 2064 656d 616e 6420   List of demand 
+00007a90: 7a6f 6e65 2074 7570 6c65 7320 2873 7461  zone tuples (sta
+00007aa0: 7274 2c20 656e 642c 2070 6174 7465 726e  rt, end, pattern
+00007ab0: 2c20 6261 7365 5f63 6f75 6e74 290a 2020  , base_count).  
+00007ac0: 2020 2320 2020 2020 2d20 6465 6d61 6e64    #     - demand
+00007ad0: 5f70 726f 7869 6d61 6c5f 6c69 6e65 733a  _proximal_lines:
+00007ae0: 204c 6973 7420 6f66 2070 726f 7869 6d61   List of proxima
+00007af0: 6c20 6c69 6e65 2070 7269 6365 7320 666f  l line prices fo
+00007b00: 7220 6465 6d61 6e64 207a 6f6e 6573 0a20  r demand zones. 
+00007b10: 2020 2023 2020 2020 202d 2064 656d 616e     #     - deman
+00007b20: 645f 6469 7374 616c 5f6c 696e 6573 3a20  d_distal_lines: 
+00007b30: 4c69 7374 206f 6620 6469 7374 616c 206c  List of distal l
+00007b40: 696e 6520 7072 6963 6573 2066 6f72 2064  ine prices for d
+00007b50: 656d 616e 6420 7a6f 6e65 730a 2020 2020  emand zones.    
+00007b60: 2020 2020 0a20 2020 2023 2020 2020 2052      .    #     R
+00007b70: 6574 7572 6e73 3a0a 2020 2020 2320 2020  eturns:.    #   
+00007b80: 2020 2d20 4c69 7374 206f 6620 7261 6e67    - List of rang
+00007b90: 6573 2063 6f72 7265 7370 6f6e 6469 6e67  es corresponding
+00007ba0: 2074 6f20 6561 6368 2064 656d 616e 6420   to each demand 
+00007bb0: 7a6f 6e65 0a20 2020 2023 2020 2020 2022  zone.    #     "
+00007bc0: 2222 0a20 2020 2023 2020 2020 2064 656d  "".    #     dem
+00007bd0: 616e 645f 7a6f 6e65 5f72 616e 6765 7320  and_zone_ranges 
+00007be0: 3d20 5b5d 0a20 2020 2023 2020 2020 2066  = [].    #     f
+00007bf0: 6f72 2069 2c20 2873 7461 7274 2c20 656e  or i, (start, en
+00007c00: 642c 205f 2c20 5f29 2069 6e20 656e 756d  d, _, _) in enum
+00007c10: 6572 6174 6528 6465 6d61 6e64 5f7a 6f6e  erate(demand_zon
+00007c20: 6573 293a 0a20 2020 2023 2020 2020 2020  es):.    #      
+00007c30: 2020 2072 616e 6765 5f6f 665f 7a6f 6e65     range_of_zone
+00007c40: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
+00007c50: 655f 7a6f 6e65 5f72 616e 6765 2864 656d  e_zone_range(dem
+00007c60: 616e 645f 7072 6f78 696d 616c 5f6c 696e  and_proximal_lin
+00007c70: 6573 5b69 5d2c 2064 656d 616e 645f 6469  es[i], demand_di
+00007c80: 7374 616c 5f6c 696e 6573 5b69 5d29 0a20  stal_lines[i]). 
+00007c90: 2020 2023 2020 2020 2020 2020 2064 656d     #         dem
+00007ca0: 616e 645f 7a6f 6e65 5f72 616e 6765 732e  and_zone_ranges.
+00007cb0: 6170 7065 6e64 2872 616e 6765 5f6f 665f  append(range_of_
+00007cc0: 7a6f 6e65 290a 2020 2020 2320 2020 2020  zone).    #     
+00007cd0: 7265 7475 726e 2064 656d 616e 645f 7a6f  return demand_zo
+00007ce0: 6e65 5f72 616e 6765 730a 0a20 2020 2023  ne_ranges..    #
+00007cf0: 2064 6566 2063 616c 6375 6c61 7465 5f73   def calculate_s
+00007d00: 7570 706c 795f 7a6f 6e65 5f72 616e 6765  upply_zone_range
+00007d10: 7328 7365 6c66 2c73 7570 706c 795f 7a6f  s(self,supply_zo
+00007d20: 6e65 732c 2073 7570 706c 795f 7072 6f78  nes, supply_prox
+00007d30: 696d 616c 5f6c 696e 6573 2c20 7375 7070  imal_lines, supp
+00007d40: 6c79 5f64 6973 7461 6c5f 6c69 6e65 7329  ly_distal_lines)
+00007d50: 3a0a 2020 2020 2320 2020 2020 2222 220a  :.    #     """.
+00007d60: 2020 2020 2320 2020 2020 4361 6c63 756c      #     Calcul
+00007d70: 6174 6520 7468 6520 7261 6e67 6520 6f66  ate the range of
+00007d80: 2065 6163 6820 7375 7070 6c79 207a 6f6e   each supply zon
+00007d90: 652e 0a20 2020 2020 2020 200a 2020 2020  e..        .    
+00007da0: 2320 2020 2020 4172 6773 3a0a 2020 2020  #     Args:.    
+00007db0: 2320 2020 2020 2d20 7375 7070 6c79 5f7a  #     - supply_z
+00007dc0: 6f6e 6573 3a20 4c69 7374 206f 6620 7375  ones: List of su
+00007dd0: 7070 6c79 207a 6f6e 6520 7475 706c 6573  pply zone tuples
+00007de0: 2028 7374 6172 742c 2065 6e64 2c20 7061   (start, end, pa
+00007df0: 7474 6572 6e2c 2062 6173 655f 636f 756e  ttern, base_coun
+00007e00: 7429 0a20 2020 2023 2020 2020 202d 2073  t).    #     - s
+00007e10: 7570 706c 795f 7072 6f78 696d 616c 5f6c  upply_proximal_l
+00007e20: 696e 6573 3a20 4c69 7374 206f 6620 7072  ines: List of pr
+00007e30: 6f78 696d 616c 206c 696e 6520 7072 6963  oximal line pric
+00007e40: 6573 2066 6f72 2073 7570 706c 7920 7a6f  es for supply zo
+00007e50: 6e65 730a 2020 2020 2320 2020 2020 2d20  nes.    #     - 
+00007e60: 7375 7070 6c79 5f64 6973 7461 6c5f 6c69  supply_distal_li
+00007e70: 6e65 733a 204c 6973 7420 6f66 2064 6973  nes: List of dis
+00007e80: 7461 6c20 6c69 6e65 2070 7269 6365 7320  tal line prices 
+00007e90: 666f 7220 7375 7070 6c79 207a 6f6e 6573  for supply zones
+00007ea0: 0a20 2020 2020 2020 200a 2020 2020 2320  .        .    # 
+00007eb0: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+00007ec0: 2023 2020 2020 202d 204c 6973 7420 6f66   #     - List of
+00007ed0: 2072 616e 6765 7320 636f 7272 6573 706f   ranges correspo
+00007ee0: 6e64 696e 6720 746f 2065 6163 6820 7375  nding to each su
+00007ef0: 7070 6c79 207a 6f6e 650a 2020 2020 2320  pply zone.    # 
+00007f00: 2020 2020 2222 220a 2020 2020 2320 2020      """.    #   
+00007f10: 2020 7375 7070 6c79 5f7a 6f6e 655f 7261    supply_zone_ra
+00007f20: 6e67 6573 203d 205b 5d0a 2020 2020 2320  nges = [].    # 
+00007f30: 2020 2020 666f 7220 692c 2028 7374 6172      for i, (star
+00007f40: 742c 2065 6e64 2c20 5f2c 205f 2920 696e  t, end, _, _) in
+00007f50: 2065 6e75 6d65 7261 7465 2873 7570 706c   enumerate(suppl
+00007f60: 795f 7a6f 6e65 7329 3a0a 2020 2020 2320  y_zones):.    # 
+00007f70: 2020 2020 2020 2020 7261 6e67 655f 6f66          range_of
+00007f80: 5f7a 6f6e 6520 3d20 7365 6c66 2e63 616c  _zone = self.cal
+00007f90: 6375 6c61 7465 5f7a 6f6e 655f 7261 6e67  culate_zone_rang
+00007fa0: 6528 7375 7070 6c79 5f70 726f 7869 6d61  e(supply_proxima
+00007fb0: 6c5f 6c69 6e65 735b 695d 2c20 7375 7070  l_lines[i], supp
+00007fc0: 6c79 5f64 6973 7461 6c5f 6c69 6e65 735b  ly_distal_lines[
+00007fd0: 695d 290a 2020 2020 2320 2020 2020 2020  i]).    #       
+00007fe0: 2020 7375 7070 6c79 5f7a 6f6e 655f 7261    supply_zone_ra
+00007ff0: 6e67 6573 2e61 7070 656e 6428 7261 6e67  nges.append(rang
+00008000: 655f 6f66 5f7a 6f6e 6529 0a20 2020 2023  e_of_zone).    #
+00008010: 2020 2020 2072 6574 7572 6e20 7375 7070       return supp
+00008020: 6c79 5f7a 6f6e 655f 7261 6e67 6573 0a0a  ly_zone_ranges..
+00008030: 2020 2020 2320 6465 6620 6669 6c74 6572      # def filter
+00008040: 5f73 746f 636b 735f 6279 5f64 6973 7461  _stocks_by_dista
+00008050: 6e63 6528 7365 6c66 2c64 6174 612c 7379  nce(self,data,sy
+00008060: 6d62 6f6c 5f6c 6973 742c 2074 6872 6573  mbol_list, thres
+00008070: 686f 6c64 5f70 6572 6365 6e74 2c20 7469  hold_percent, ti
+00008080: 6d65 6672 616d 6529 3a0a 2020 2020 2320  meframe):.    # 
+00008090: 2020 2020 6669 6c74 6572 6564 5f73 746f      filtered_sto
+000080a0: 636b 7320 3d20 5b5d 0a20 2020 2023 2020  cks = [].    #  
+000080b0: 2020 2066 6f72 2073 796d 626f 6c20 696e     for symbol in
+000080c0: 2073 796d 626f 6c5f 6c69 7374 3a0a 2020   symbol_list:.  
+000080d0: 2020 2320 2020 2020 2020 2020 6966 2064    #         if d
+000080e0: 6174 6120 6973 206e 6f74 204e 6f6e 653a  ata is not None:
+000080f0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00008100: 2020 2063 6d70 203d 2064 6174 612e 696c     cmp = data.il
+00008110: 6f63 5b2d 315d 5b27 436c 6f73 6527 5d20  oc[-1]['Close'] 
+00008120: 2023 2043 7572 7265 6e74 206d 6172 6b65   # Current marke
+00008130: 7420 7072 6963 650a 2020 2020 2320 2020  t price.    #   
+00008140: 2020 2020 2020 2020 2020 6465 6d61 6e64            demand
+00008150: 5f7a 6f6e 6573 2c20 5f2c 205f 2c20 6465  _zones, _, _, de
+00008160: 6d61 6e64 5f70 726f 7869 6d61 6c5f 6c69  mand_proximal_li
+00008170: 6e65 203d 2073 656c 662e 6964 656e 7469  ne = self.identi
+00008180: 6679 5f64 656d 616e 645f 7a6f 6e65 2864  fy_demand_zone(d
+00008190: 6174 612c 2063 6d70 2920 2023 2050 6173  ata, cmp)  # Pas
+000081a0: 7320 636d 7020 6172 6775 6d65 6e74 2068  s cmp argument h
+000081b0: 6572 650a 2020 2020 2320 2020 2020 2020  ere.    #       
+000081c0: 2020 2020 2020 7375 7070 6c79 5f7a 6f6e        supply_zon
+000081d0: 6573 2c20 5f2c 205f 2c20 7375 7070 6c79  es, _, _, supply
+000081e0: 5f70 726f 7869 6d61 6c5f 6c69 6e65 203d  _proximal_line =
+000081f0: 2073 656c 662e 6964 656e 7469 6679 5f73   self.identify_s
+00008200: 7570 706c 795f 7a6f 6e65 2864 6174 612c  upply_zone(data,
+00008210: 2063 6d70 2920 2023 2050 6173 7320 636d   cmp)  # Pass cm
+00008220: 7020 6172 6775 6d65 6e74 2068 6572 650a  p argument here.
+00008230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008240: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00008250: 2020 2023 2043 6865 636b 2069 6620 6569     # Check if ei
+00008260: 7468 6572 2064 656d 616e 6420 6f72 2073  ther demand or s
+00008270: 7570 706c 7920 7a6f 6e65 7320 6578 6973  upply zones exis
+00008280: 7420 666f 7220 7468 6520 7374 6f63 6b0a  t for the stock.
+00008290: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+000082a0: 2020 6966 2064 656d 616e 645f 7a6f 6e65    if demand_zone
+000082b0: 7320 6f72 2073 7570 706c 795f 7a6f 6e65  s or supply_zone
+000082c0: 733a 0a20 2020 2023 2020 2020 2020 2020  s:.    #        
+000082d0: 2020 2020 2020 2020 2066 696c 7465 7265           filtere
+000082e0: 645f 7374 6f63 6b73 2e61 7070 656e 6428  d_stocks.append(
+000082f0: 7379 6d62 6f6c 290a 0a20 2020 2023 2020  symbol)..    #  
+00008300: 2020 2072 6574 7572 6e20 6669 6c74 6572     return filter
+00008310: 6564 5f73 746f 636b 730a 2020 2020 0a20  ed_stocks.    . 
+00008320: 2020 2023 2064 6566 2066 696e 6444 656d     # def findDem
+00008330: 616e 6453 7570 706c 795a 6f6e 6573 2873  andSupplyZones(s
+00008340: 656c 662c 6461 7461 2c74 6872 6573 686f  elf,data,thresho
+00008350: 6c64 5f70 6572 6365 6e74 3d31 293a 2020  ld_percent=1):  
+00008360: 2020 2020 2020 0a20 2020 2023 2020 2020        .    #    
+00008370: 2023 2049 6e69 7469 616c 697a 6520 636f   # Initialize co
+00008380: 756e 7420 666f 7220 6669 6c74 6572 6564  unt for filtered
+00008390: 2073 746f 636b 730a 2020 2020 2320 2020   stocks.    #   
+000083a0: 2020 636f 756e 745f 6669 6c74 6572 6564    count_filtered
+000083b0: 5f73 746f 636b 7320 3d20 300a 0a20 2020  _stocks = 0..   
+000083c0: 2023 2020 2020 2023 2041 6e61 6c79 7a65   #     # Analyze
+000083d0: 2064 656d 616e 6420 616e 6420 7375 7070   demand and supp
+000083e0: 6c79 207a 6f6e 6573 2066 6f72 2065 6163  ly zones for eac
+000083f0: 6820 7374 6f63 6b20 616e 6420 7361 7665  h stock and save
+00008400: 2072 6573 756c 7473 2069 6e20 6120 6669   results in a fi
+00008410: 6c65 0a20 2020 2023 2020 2020 2077 6974  le.    #     wit
+00008420: 6820 6f70 656e 2822 6465 6d61 6e64 5f73  h open("demand_s
+00008430: 7570 706c 795f 7a6f 6e65 732e 7478 7422  upply_zones.txt"
+00008440: 2c20 2277 2229 2061 7320 6669 6c65 3a0a  , "w") as file:.
+00008450: 2020 2020 2320 2020 2020 2020 2020 666f      #         fo
+00008460: 7220 7379 6d62 6f6c 2069 6e20 6461 7461  r symbol in data
+00008470: 5b22 5374 6f63 6b22 5d3a 0a20 2020 2023  ["Stock"]:.    #
+00008480: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00008490: 6461 7461 2069 7320 6e6f 7420 4e6f 6e65  data is not None
+000084a0: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+000084b0: 2020 2020 2020 2020 636d 7020 3d20 6461          cmp = da
+000084c0: 7461 2e69 6c6f 635b 2d31 5d5b 2743 6c6f  ta.iloc[-1]['Clo
+000084d0: 7365 275d 2020 2320 4375 7272 656e 7420  se']  # Current 
+000084e0: 6d61 726b 6574 2070 7269 6365 0a20 2020  market price.   
+000084f0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00008500: 2020 2064 656d 616e 645f 7a6f 6e65 732c     demand_zones,
+00008510: 205f 2c20 5f2c 2064 656d 616e 645f 7072   _, _, demand_pr
+00008520: 6f78 696d 616c 5f6c 696e 6520 3d20 7365  oximal_line = se
+00008530: 6c66 2e69 6465 6e74 6966 795f 6465 6d61  lf.identify_dema
+00008540: 6e64 5f7a 6f6e 6528 6461 7461 2c20 636d  nd_zone(data, cm
+00008550: 7029 0a20 2020 2023 2020 2020 2020 2020  p).    #        
+00008560: 2020 2020 2020 2020 2073 7570 706c 795f           supply_
+00008570: 7a6f 6e65 732c 205f 2c20 5f2c 2073 7570  zones, _, _, sup
+00008580: 706c 795f 7072 6f78 696d 616c 5f6c 696e  ply_proximal_lin
+00008590: 6520 3d20 7365 6c66 2e69 6465 6e74 6966  e = self.identif
+000085a0: 795f 7375 7070 6c79 5f7a 6f6e 6528 6461  y_supply_zone(da
+000085b0: 7461 2c20 636d 7029 0a0a 2020 2020 2320  ta, cmp)..    # 
+000085c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000085d0: 2320 5374 6570 2031 3a20 4361 6c63 756c  # Step 1: Calcul
+000085e0: 6174 6520 7072 6f78 696d 616c 206c 696e  ate proximal lin
+000085f0: 6573 2066 6f72 2064 656d 616e 6420 616e  es for demand an
+00008600: 6420 7375 7070 6c79 207a 6f6e 6573 0a20  d supply zones. 
+00008610: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00008620: 2020 2020 2064 656d 616e 645f 7072 6f78       demand_prox
+00008630: 696d 616c 5f6c 696e 6573 203d 2073 656c  imal_lines = sel
+00008640: 662e 6361 6c63 756c 6174 655f 6465 6d61  f.calculate_dema
+00008650: 6e64 5f70 726f 7869 6d61 6c5f 6c69 6e65  nd_proximal_line
+00008660: 7328 6461 7461 2c20 6465 6d61 6e64 5f7a  s(data, demand_z
+00008670: 6f6e 6573 290a 2020 2020 2320 2020 2020  ones).    #     
+00008680: 2020 2020 2020 2020 2020 2020 7375 7070              supp
+00008690: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
+000086a0: 7320 3d20 7365 6c66 2e63 616c 6375 6c61  s = self.calcula
+000086b0: 7465 5f73 7570 706c 795f 7072 6f78 696d  te_supply_proxim
+000086c0: 616c 5f6c 696e 6573 2864 6174 612c 2073  al_lines(data, s
+000086d0: 7570 706c 795f 7a6f 6e65 7329 0a20 2020  upply_zones).   
+000086e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000086f0: 200a 2020 2020 2320 2020 2020 2020 2020   .    #         
+00008700: 2020 2020 2020 2020 2320 5374 6570 2032          # Step 2
+00008710: 3a20 4361 6c63 756c 6174 6520 6469 7374  : Calculate dist
+00008720: 616c 206c 696e 6573 2066 6f72 2064 656d  al lines for dem
+00008730: 616e 6420 7a6f 6e65 7320 616e 6420 7375  and zones and su
+00008740: 7070 6c79 207a 6f6e 6573 0a20 2020 2023  pply zones.    #
+00008750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008760: 2064 656d 616e 645f 6469 7374 616c 5f6c   demand_distal_l
+00008770: 696e 6573 203d 2073 656c 662e 6361 6c63  ines = self.calc
+00008780: 756c 6174 655f 6465 6d61 6e64 5f64 6973  ulate_demand_dis
+00008790: 7461 6c5f 6c69 6e65 7328 6461 7461 2c20  tal_lines(data, 
+000087a0: 6465 6d61 6e64 5f7a 6f6e 6573 290a 2020  demand_zones).  
+000087b0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000087c0: 2020 2020 7375 7070 6c79 5f64 6973 7461      supply_dista
+000087d0: 6c5f 6c69 6e65 7320 3d20 7365 6c66 2e63  l_lines = self.c
+000087e0: 616c 6375 6c61 7465 5f73 7570 706c 795f  alculate_supply_
+000087f0: 6469 7374 616c 5f6c 696e 6573 2864 6174  distal_lines(dat
+00008800: 612c 2073 7570 706c 795f 7a6f 6e65 7329  a, supply_zones)
+00008810: 0a0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+00008820: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+00008830: 6174 6520 7261 6e67 6520 6f66 2064 656d  ate range of dem
+00008840: 616e 6420 616e 6420 7375 7070 6c79 207a  and and supply z
+00008850: 6f6e 6573 0a20 2020 2023 2020 2020 2020  ones.    #      
+00008860: 2020 2020 2020 2020 2020 2064 656d 616e             deman
+00008870: 645f 7a6f 6e65 5f72 616e 6765 7320 3d20  d_zone_ranges = 
+00008880: 7365 6c66 2e63 616c 6375 6c61 7465 5f64  self.calculate_d
+00008890: 656d 616e 645f 7a6f 6e65 5f72 616e 6765  emand_zone_range
+000088a0: 7328 6465 6d61 6e64 5f7a 6f6e 6573 2c20  s(demand_zones, 
+000088b0: 6465 6d61 6e64 5f70 726f 7869 6d61 6c5f  demand_proximal_
+000088c0: 6c69 6e65 732c 2064 656d 616e 645f 6469  lines, demand_di
+000088d0: 7374 616c 5f6c 696e 6573 290a 2020 2020  stal_lines).    
+000088e0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+000088f0: 2020 7375 7070 6c79 5f7a 6f6e 655f 7261    supply_zone_ra
+00008900: 6e67 6573 203d 2073 656c 662e 6361 6c63  nges = self.calc
+00008910: 756c 6174 655f 7375 7070 6c79 5f7a 6f6e  ulate_supply_zon
+00008920: 655f 7261 6e67 6573 2873 7570 706c 795f  e_ranges(supply_
+00008930: 7a6f 6e65 732c 2073 7570 706c 795f 7072  zones, supply_pr
+00008940: 6f78 696d 616c 5f6c 696e 6573 2c20 7375  oximal_lines, su
+00008950: 7070 6c79 5f64 6973 7461 6c5f 6c69 6e65  pply_distal_line
+00008960: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00008970: 2020 2020 2020 200a 2020 2020 2320 2020         .    #   
+00008980: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00008990: 6c65 2e77 7269 7465 2866 225c 6e5c 6e41  le.write(f"\n\nA
+000089a0: 6e61 6c79 7369 7320 666f 7220 7b73 796d  nalysis for {sym
+000089b0: 626f 6c7d 2028 7b74 696d 6566 7261 6d65  bol} ({timeframe
+000089c0: 7d29 3a22 290a 2020 2020 2020 2020 2020  }):").          
+000089d0: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
 000089e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000089f0: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-00008a00: 6974 6528 6622 5c6e 5c6e 5a6f 6e65 207b  ite(f"\n\nZone {
-00008a10: 692b 317d 3a20 5374 6172 7420 4461 7465  i+1}: Start Date
-00008a20: 3a20 7b64 6174 612e 696e 6465 785b 7374  : {data.index[st
-00008a30: 6172 745d 2e64 6174 6528 297d 2c20 456e  art].date()}, En
-00008a40: 6420 4461 7465 3a20 7b64 6174 612e 696e  d Date: {data.in
-00008a50: 6465 785b 656e 645d 2e64 6174 6528 297d  dex[end].date()}
-00008a60: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
-00008a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a80: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
-00008a90: 5061 7474 6572 6e20 4e61 6d65 3a20 7b70  Pattern Name: {p
-00008aa0: 6174 7465 726e 7d2c 204e 756d 6265 7220  attern}, Number 
-00008ab0: 6f66 2042 6173 6520 4361 6e64 6c65 3a20  of Base Candle: 
-00008ac0: 7b62 6173 655f 636f 756e 747d 2229 0a20  {base_count}"). 
-00008ad0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00008ae0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00008af0: 652e 7772 6974 6528 6622 5c6e 4469 7374  e.write(f"\nDist
-00008b00: 616e 6365 2066 726f 6d20 434d 503a 207b  ance from CMP: {
-00008b10: 6469 7374 5f66 726f 6d5f 636d 703a 2e32  dist_from_cmp:.2
-00008b20: 667d 2522 290a 2020 2020 2320 2020 2020  f}%").    #     
-00008b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008b40: 2020 2020 6966 2064 656d 616e 645f 7072      if demand_pr
-00008b50: 6f78 696d 616c 5f6c 696e 6573 3a0a 2020  oximal_lines:.  
-00008b60: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00008b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008b80: 6669 6c65 2e77 7269 7465 2866 225c 6e50  file.write(f"\nP
-00008b90: 726f 7869 6d61 6c20 4c69 6e65 2050 7269  roximal Line Pri
-00008ba0: 6365 3a20 7b64 656d 616e 645f 7072 6f78  ce: {demand_prox
-00008bb0: 696d 616c 5f6c 696e 6573 5b69 5d3a 2e32  imal_lines[i]:.2
-00008bc0: 667d 2229 0a20 2020 2023 2020 2020 2020  f}").    #      
+000089f0: 2023 2044 656d 616e 6420 5a6f 6e65 730a   # Demand Zones.
+00008a00: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00008a10: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
+00008a20: 2822 5c6e 5c6e 4465 6d61 6e64 205a 6f6e  ("\n\nDemand Zon
+00008a30: 6573 3a22 290a 2020 2020 2320 2020 2020  es:").    #     
+00008a40: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00008a50: 656d 616e 645f 7a6f 6e65 733a 2020 2320  emand_zones:  # 
+00008a60: 4368 6563 6b20 6966 2064 656d 616e 645f  Check if demand_
+00008a70: 7a6f 6e65 7320 6973 206e 6f74 2065 6d70  zones is not emp
+00008a80: 7479 0a20 2020 2023 2020 2020 2020 2020  ty.    #        
+00008a90: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00008aa0: 2069 2c20 2873 7461 7274 2c20 656e 642c   i, (start, end,
+00008ab0: 2070 6174 7465 726e 2c20 6261 7365 5f63   pattern, base_c
+00008ac0: 6f75 6e74 2920 696e 2065 6e75 6d65 7261  ount) in enumera
+00008ad0: 7465 2864 656d 616e 645f 7a6f 6e65 7329  te(demand_zones)
+00008ae0: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+00008af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b00: 6469 7374 5f66 726f 6d5f 636d 7020 3d20  dist_from_cmp = 
+00008b10: 6162 7328 2863 6d70 202d 2064 656d 616e  abs((cmp - deman
+00008b20: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
+00008b30: 5b69 5d29 202f 2063 6d70 2920 2a20 3130  [i]) / cmp) * 10
+00008b40: 300a 2020 2020 2320 2020 2020 2020 2020  0.    #         
+00008b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b60: 6669 6c65 2e77 7269 7465 2866 225c 6e5c  file.write(f"\n\
+00008b70: 6e5a 6f6e 6520 7b69 2b31 7d3a 2053 7461  nZone {i+1}: Sta
+00008b80: 7274 2044 6174 653a 207b 6461 7461 2e69  rt Date: {data.i
+00008b90: 6e64 6578 5b73 7461 7274 5d2e 6461 7465  ndex[start].date
+00008ba0: 2829 7d2c 2045 6e64 2044 6174 653a 207b  ()}, End Date: {
+00008bb0: 6461 7461 2e69 6e64 6578 5b65 6e64 5d2e  data.index[end].
+00008bc0: 6461 7465 2829 7d22 290a 2020 2020 2320  date()}").    # 
 00008bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008be0: 2020 2069 6620 6465 6d61 6e64 5f64 6973     if demand_dis
-00008bf0: 7461 6c5f 6c69 6e65 733a 2020 2320 496e  tal_lines:  # In
-00008c00: 636c 7564 6520 6469 7374 616c 206c 696e  clude distal lin
-00008c10: 6520 7072 6963 6520 6966 2061 7661 696c  e price if avail
-00008c20: 6162 6c65 0a20 2020 2023 2020 2020 2020  able.    #      
-00008c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c40: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-00008c50: 6528 6622 5c6e 4469 7374 616c 204c 696e  e(f"\nDistal Lin
-00008c60: 6520 5072 6963 653a 207b 6465 6d61 6e64  e Price: {demand
-00008c70: 5f64 6973 7461 6c5f 6c69 6e65 735b 695d  _distal_lines[i]
-00008c80: 3a2e 3266 7d22 290a 2020 2020 2320 2020  :.2f}").    #   
-00008c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ca0: 2020 2020 2020 2320 496e 636c 7564 6520        # Include 
-00008cb0: 7a6f 6e65 2072 616e 6765 0a20 2020 2023  zone range.    #
-00008cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008cd0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00008ce0: 652e 7772 6974 6528 6622 5c6e 5a6f 6e65  e.write(f"\nZone
-00008cf0: 2052 616e 6765 3a20 7b64 656d 616e 645f   Range: {demand_
-00008d00: 7a6f 6e65 5f72 616e 6765 735b 695d 3a2e  zone_ranges[i]:.
-00008d10: 3266 7d22 2920 2020 2020 2020 0a20 2020  2f}")       .   
-00008d20: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00008d30: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
-00008d40: 636b 2069 6620 7072 6f78 696d 616c 206c  ck if proximal l
-00008d50: 696e 6520 6973 2074 6573 7465 640a 2020  ine is tested.  
-00008d60: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00008d70: 2020 2020 2020 2020 2020 2020 7465 7374              test
-00008d80: 6564 203d 2073 656c 662e 6973 5f7a 6f6e  ed = self.is_zon
-00008d90: 655f 7465 7374 6564 2864 6174 612c 2073  e_tested(data, s
-00008da0: 7461 7274 2c20 656e 642c 2064 656d 616e  tart, end, deman
-00008db0: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
-00008dc0: 5b69 5d29 0a20 2020 2023 2020 2020 2020  [i]).    #      
-00008dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008de0: 2020 2069 6620 7465 7374 6564 3a0a 2020     if tested:.  
-00008df0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00008e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e10: 6669 6c65 2e77 7269 7465 2822 5c6e 5a6f  file.write("\nZo
-00008e20: 6e65 2069 7320 5465 7374 6564 2229 0a20  ne is Tested"). 
-00008e30: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00008e40: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00008e50: 653a 0a20 2020 2023 2020 2020 2020 2020  e:.    #        
-00008e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e70: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
-00008e80: 225c 6e46 7265 7368 205a 6f6e 6522 290a  "\nFresh Zone").
-00008e90: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-00008ea0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00008eb0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00008ec0: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
-00008ed0: 2822 5c6e 4e6f 2064 656d 616e 6420 7a6f  ("\nNo demand zo
-00008ee0: 6e65 2070 6174 7465 726e 7320 666f 756e  ne patterns foun
-00008ef0: 642e 2229 0a0a 2020 2020 2320 2020 2020  d.")..    #     
-00008f00: 2020 2020 2020 2020 2020 2020 2320 5375              # Su
-00008f10: 7070 6c79 205a 6f6e 6573 0a20 2020 2023  pply Zones.    #
-00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f30: 2066 696c 652e 7772 6974 6528 225c 6e5c   file.write("\n\
-00008f40: 6e53 7570 706c 7920 5a6f 6e65 733a 2229  nSupply Zones:")
-00008f50: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00008f60: 2020 2020 2020 2069 6620 7375 7070 6c79         if supply
-00008f70: 5f7a 6f6e 6573 3a20 2023 2043 6865 636b  _zones:  # Check
-00008f80: 2069 6620 7375 7070 6c79 5f7a 6f6e 6573   if supply_zones
-00008f90: 2069 7320 6e6f 7420 656d 7074 790a 2020   is not empty.  
-00008fa0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00008fb0: 2020 2020 2020 2020 666f 7220 692c 2028          for i, (
-00008fc0: 7374 6172 742c 2065 6e64 2c20 7061 7474  start, end, patt
-00008fd0: 6572 6e2c 2062 6173 655f 636f 756e 7429  ern, base_count)
-00008fe0: 2069 6e20 656e 756d 6572 6174 6528 7375   in enumerate(su
-00008ff0: 7070 6c79 5f7a 6f6e 6573 293a 0a20 2020  pply_zones):.   
-00009000: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00009010: 2020 2020 2020 2020 2020 2064 6973 745f             dist_
-00009020: 6672 6f6d 5f63 6d70 203d 2061 6273 2828  from_cmp = abs((
-00009030: 636d 7020 2d20 7375 7070 6c79 5f70 726f  cmp - supply_pro
-00009040: 7869 6d61 6c5f 6c69 6e65 735b 695d 2920  ximal_lines[i]) 
-00009050: 2f20 636d 7029 202a 2031 3030 0a20 2020  / cmp) * 100.   
+00008be0: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+00008bf0: 7465 2866 225c 6e50 6174 7465 726e 204e  te(f"\nPattern N
+00008c00: 616d 653a 207b 7061 7474 6572 6e7d 2c20  ame: {pattern}, 
+00008c10: 4e75 6d62 6572 206f 6620 4261 7365 2043  Number of Base C
+00008c20: 616e 646c 653a 207b 6261 7365 5f63 6f75  andle: {base_cou
+00008c30: 6e74 7d22 290a 2020 2020 2320 2020 2020  nt}").    #     
+00008c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c50: 2020 2020 6669 6c65 2e77 7269 7465 2866      file.write(f
+00008c60: 225c 6e44 6973 7461 6e63 6520 6672 6f6d  "\nDistance from
+00008c70: 2043 4d50 3a20 7b64 6973 745f 6672 6f6d   CMP: {dist_from
+00008c80: 5f63 6d70 3a2e 3266 7d25 2229 0a20 2020  _cmp:.2f}%").   
+00008c90: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00008ca0: 2020 2020 2020 2020 2020 2069 6620 6465             if de
+00008cb0: 6d61 6e64 5f70 726f 7869 6d61 6c5f 6c69  mand_proximal_li
+00008cc0: 6e65 733a 0a20 2020 2023 2020 2020 2020  nes:.    #      
+00008cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ce0: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
+00008cf0: 6528 6622 5c6e 5072 6f78 696d 616c 204c  e(f"\nProximal L
+00008d00: 696e 6520 5072 6963 653a 207b 6465 6d61  ine Price: {dema
+00008d10: 6e64 5f70 726f 7869 6d61 6c5f 6c69 6e65  nd_proximal_line
+00008d20: 735b 695d 3a2e 3266 7d22 290a 2020 2020  s[i]:.2f}").    
+00008d30: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00008d40: 2020 2020 2020 2020 2020 6966 2064 656d            if dem
+00008d50: 616e 645f 6469 7374 616c 5f6c 696e 6573  and_distal_lines
+00008d60: 3a20 2023 2049 6e63 6c75 6465 2064 6973  :  # Include dis
+00008d70: 7461 6c20 6c69 6e65 2070 7269 6365 2069  tal line price i
+00008d80: 6620 6176 6169 6c61 626c 650a 2020 2020  f available.    
+00008d90: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00008da0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00008db0: 6c65 2e77 7269 7465 2866 225c 6e44 6973  le.write(f"\nDis
+00008dc0: 7461 6c20 4c69 6e65 2050 7269 6365 3a20  tal Line Price: 
+00008dd0: 7b64 656d 616e 645f 6469 7374 616c 5f6c  {demand_distal_l
+00008de0: 696e 6573 5b69 5d3a 2e32 667d 2229 0a20  ines[i]:.2f}"). 
+00008df0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00008e00: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+00008e10: 6e63 6c75 6465 207a 6f6e 6520 7261 6e67  nclude zone rang
+00008e20: 650a 2020 2020 2320 2020 2020 2020 2020  e.    #         
+00008e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e40: 2020 2020 6669 6c65 2e77 7269 7465 2866      file.write(f
+00008e50: 225c 6e5a 6f6e 6520 5261 6e67 653a 207b  "\nZone Range: {
+00008e60: 6465 6d61 6e64 5f7a 6f6e 655f 7261 6e67  demand_zone_rang
+00008e70: 6573 5b69 5d3a 2e32 667d 2229 2020 2020  es[i]:.2f}")    
+00008e80: 2020 200a 2020 2020 2320 2020 2020 2020     .    #       
+00008e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ea0: 2020 2320 4368 6563 6b20 6966 2070 726f    # Check if pro
+00008eb0: 7869 6d61 6c20 6c69 6e65 2069 7320 7465  ximal line is te
+00008ec0: 7374 6564 0a20 2020 2023 2020 2020 2020  sted.    #      
+00008ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ee0: 2020 2074 6573 7465 6420 3d20 7365 6c66     tested = self
+00008ef0: 2e69 735f 7a6f 6e65 5f74 6573 7465 6428  .is_zone_tested(
+00008f00: 6461 7461 2c20 7374 6172 742c 2065 6e64  data, start, end
+00008f10: 2c20 6465 6d61 6e64 5f70 726f 7869 6d61  , demand_proxima
+00008f20: 6c5f 6c69 6e65 735b 695d 290a 2020 2020  l_lines[i]).    
+00008f30: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00008f40: 2020 2020 2020 2020 2020 6966 2074 6573            if tes
+00008f50: 7465 643a 0a20 2020 2023 2020 2020 2020  ted:.    #      
+00008f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f70: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
+00008f80: 6528 225c 6e5a 6f6e 6520 6973 2054 6573  e("\nZone is Tes
+00008f90: 7465 6422 290a 2020 2020 2320 2020 2020  ted").    #     
+00008fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fb0: 2020 2020 656c 7365 3a0a 2020 2020 2320      else:.    # 
+00008fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fd0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00008fe0: 2e77 7269 7465 2822 5c6e 4672 6573 6820  .write("\nFresh 
+00008ff0: 5a6f 6e65 2229 0a20 2020 2023 2020 2020  Zone").    #    
+00009000: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00009010: 653a 0a20 2020 2023 2020 2020 2020 2020  e:.    #        
+00009020: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00009030: 652e 7772 6974 6528 225c 6e4e 6f20 6465  e.write("\nNo de
+00009040: 6d61 6e64 207a 6f6e 6520 7061 7474 6572  mand zone patter
+00009050: 6e73 2066 6f75 6e64 2e22 290a 0a20 2020  ns found.")..   
 00009060: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00009070: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-00009080: 7772 6974 6528 6622 5c6e 5c6e 5a6f 6e65  write(f"\n\nZone
-00009090: 207b 692b 317d 3a20 5374 6172 7420 4461   {i+1}: Start Da
-000090a0: 7465 3a20 7b64 6174 612e 696e 6465 785b  te: {data.index[
-000090b0: 7374 6172 745d 2e64 6174 6528 297d 2c20  start].date()}, 
-000090c0: 456e 6420 4461 7465 3a20 7b64 6174 612e  End Date: {data.
-000090d0: 696e 6465 785b 656e 645d 2e64 6174 6528  index[end].date(
-000090e0: 297d 2229 0a20 2020 2023 2020 2020 2020  )}").    #      
-000090f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009100: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
-00009110: 5c6e 5061 7474 6572 6e20 4e61 6d65 3a20  \nPattern Name: 
-00009120: 7b70 6174 7465 726e 7d2c 204e 756d 6265  {pattern}, Numbe
-00009130: 7220 6f66 2042 6173 6520 4361 6e64 6c65  r of Base Candle
-00009140: 3a20 7b62 6173 655f 636f 756e 747d 2229  : {base_count}")
-00009150: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00009160: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009170: 696c 652e 7772 6974 6528 6622 5c6e 4469  ile.write(f"\nDi
-00009180: 7374 616e 6365 2066 726f 6d20 434d 503a  stance from CMP:
-00009190: 207b 6469 7374 5f66 726f 6d5f 636d 703a   {dist_from_cmp:
-000091a0: 2e32 667d 2522 290a 2020 2020 2320 2020  .2f}%").    #   
-000091b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091c0: 2020 2020 2020 6966 2073 7570 706c 795f        if supply_
-000091d0: 7072 6f78 696d 616c 5f6c 696e 6573 3a0a  proximal_lines:.
-000091e0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-000091f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009200: 2020 6669 6c65 2e77 7269 7465 2866 225c    file.write(f"\
-00009210: 6e50 726f 7869 6d61 6c20 4c69 6e65 2050  nProximal Line P
-00009220: 7269 6365 3a20 7b73 7570 706c 795f 7072  rice: {supply_pr
-00009230: 6f78 696d 616c 5f6c 696e 6573 5b69 5d3a  oximal_lines[i]:
-00009240: 2e32 667d 2229 0a20 2020 2023 2020 2020  .2f}").    #    
-00009250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009260: 2020 2020 2069 6620 7375 7070 6c79 5f64       if supply_d
-00009270: 6973 7461 6c5f 6c69 6e65 733a 2020 2320  istal_lines:  # 
-00009280: 496e 636c 7564 6520 6469 7374 616c 206c  Include distal l
-00009290: 696e 6520 7072 6963 6520 6966 2061 7661  ine price if ava
-000092a0: 696c 6162 6c65 0a20 2020 2023 2020 2020  ilable.    #    
-000092b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092c0: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-000092d0: 6974 6528 6622 5c6e 4469 7374 616c 204c  ite(f"\nDistal L
-000092e0: 696e 6520 5072 6963 653a 207b 7375 7070  ine Price: {supp
-000092f0: 6c79 5f64 6973 7461 6c5f 6c69 6e65 735b  ly_distal_lines[
-00009300: 695d 3a2e 3266 7d22 290a 2020 2020 2320  i]:.2f}").    # 
-00009310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009320: 2020 2020 2020 2020 2320 496e 636c 7564          # Includ
-00009330: 6520 7a6f 6e65 2072 616e 6765 0a20 2020  e zone range.   
-00009340: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00009350: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009360: 696c 652e 7772 6974 6528 6622 5c6e 5a6f  ile.write(f"\nZo
-00009370: 6e65 2052 616e 6765 3a20 7b73 7570 706c  ne Range: {suppl
-00009380: 795f 7a6f 6e65 5f72 616e 6765 735b 695d  y_zone_ranges[i]
-00009390: 3a2e 3266 7d22 290a 2020 2020 2320 2020  :.2f}").    #   
-000093a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093b0: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-000093c0: 2070 726f 7869 6d61 6c20 6c69 6e65 2069   proximal line i
-000093d0: 7320 7465 7374 6564 0a20 2020 2023 2020  s tested.    #  
-000093e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093f0: 2020 2020 2020 2074 6573 7465 6420 3d20         tested = 
-00009400: 6973 5f7a 6f6e 655f 7465 7374 6564 2864  is_zone_tested(d
-00009410: 6174 612c 2073 7461 7274 2c20 656e 642c  ata, start, end,
-00009420: 2073 7570 706c 795f 7072 6f78 696d 616c   supply_proximal
-00009430: 5f6c 696e 6573 5b69 5d29 0a20 2020 2023  _lines[i]).    #
-00009440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009450: 2020 2020 2020 2020 2069 6620 7465 7374           if test
-00009460: 6564 3a0a 2020 2020 2320 2020 2020 2020  ed:.    #       
-00009470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009480: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
-00009490: 2822 5c6e 5a6f 6e65 2069 7320 5465 7374  ("\nZone is Test
-000094a0: 6564 2229 0a20 2020 2023 2020 2020 2020  ed").    #      
+00009070: 2020 2023 2053 7570 706c 7920 5a6f 6e65     # Supply Zone
+00009080: 730a 2020 2020 2320 2020 2020 2020 2020  s.    #         
+00009090: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+000090a0: 7465 2822 5c6e 5c6e 5375 7070 6c79 205a  te("\n\nSupply Z
+000090b0: 6f6e 6573 3a22 290a 2020 2020 2320 2020  ones:").    #   
+000090c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000090d0: 2073 7570 706c 795f 7a6f 6e65 733a 2020   supply_zones:  
+000090e0: 2320 4368 6563 6b20 6966 2073 7570 706c  # Check if suppl
+000090f0: 795f 7a6f 6e65 7320 6973 206e 6f74 2065  y_zones is not e
+00009100: 6d70 7479 0a20 2020 2023 2020 2020 2020  mpty.    #      
+00009110: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00009120: 6f72 2069 2c20 2873 7461 7274 2c20 656e  or i, (start, en
+00009130: 642c 2070 6174 7465 726e 2c20 6261 7365  d, pattern, base
+00009140: 5f63 6f75 6e74 2920 696e 2065 6e75 6d65  _count) in enume
+00009150: 7261 7465 2873 7570 706c 795f 7a6f 6e65  rate(supply_zone
+00009160: 7329 3a0a 2020 2020 2320 2020 2020 2020  s):.    #       
+00009170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009180: 2020 6469 7374 5f66 726f 6d5f 636d 7020    dist_from_cmp 
+00009190: 3d20 6162 7328 2863 6d70 202d 2073 7570  = abs((cmp - sup
+000091a0: 706c 795f 7072 6f78 696d 616c 5f6c 696e  ply_proximal_lin
+000091b0: 6573 5b69 5d29 202f 2063 6d70 2920 2a20  es[i]) / cmp) * 
+000091c0: 3130 300a 2020 2020 2320 2020 2020 2020  100.    #       
+000091d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000091e0: 2020 6669 6c65 2e77 7269 7465 2866 225c    file.write(f"\
+000091f0: 6e5c 6e5a 6f6e 6520 7b69 2b31 7d3a 2053  n\nZone {i+1}: S
+00009200: 7461 7274 2044 6174 653a 207b 6461 7461  tart Date: {data
+00009210: 2e69 6e64 6578 5b73 7461 7274 5d2e 6461  .index[start].da
+00009220: 7465 2829 7d2c 2045 6e64 2044 6174 653a  te()}, End Date:
+00009230: 207b 6461 7461 2e69 6e64 6578 5b65 6e64   {data.index[end
+00009240: 5d2e 6461 7465 2829 7d22 290a 2020 2020  ].date()}").    
+00009250: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00009260: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
+00009270: 7269 7465 2866 225c 6e50 6174 7465 726e  rite(f"\nPattern
+00009280: 204e 616d 653a 207b 7061 7474 6572 6e7d   Name: {pattern}
+00009290: 2c20 4e75 6d62 6572 206f 6620 4261 7365  , Number of Base
+000092a0: 2043 616e 646c 653a 207b 6261 7365 5f63   Candle: {base_c
+000092b0: 6f75 6e74 7d22 290a 2020 2020 2320 2020  ount}").    #   
+000092c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092d0: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
+000092e0: 2866 225c 6e44 6973 7461 6e63 6520 6672  (f"\nDistance fr
+000092f0: 6f6d 2043 4d50 3a20 7b64 6973 745f 6672  om CMP: {dist_fr
+00009300: 6f6d 5f63 6d70 3a2e 3266 7d25 2229 0a20  om_cmp:.2f}%"). 
+00009310: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00009320: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00009330: 7375 7070 6c79 5f70 726f 7869 6d61 6c5f  supply_proximal_
+00009340: 6c69 6e65 733a 0a20 2020 2023 2020 2020  lines:.    #    
+00009350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009360: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
+00009370: 6974 6528 6622 5c6e 5072 6f78 696d 616c  ite(f"\nProximal
+00009380: 204c 696e 6520 5072 6963 653a 207b 7375   Line Price: {su
+00009390: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
+000093a0: 6e65 735b 695d 3a2e 3266 7d22 290a 2020  nes[i]:.2f}").  
+000093b0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000093c0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000093d0: 7570 706c 795f 6469 7374 616c 5f6c 696e  upply_distal_lin
+000093e0: 6573 3a20 2023 2049 6e63 6c75 6465 2064  es:  # Include d
+000093f0: 6973 7461 6c20 6c69 6e65 2070 7269 6365  istal line price
+00009400: 2069 6620 6176 6169 6c61 626c 650a 2020   if available.  
+00009410: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00009420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009430: 6669 6c65 2e77 7269 7465 2866 225c 6e44  file.write(f"\nD
+00009440: 6973 7461 6c20 4c69 6e65 2050 7269 6365  istal Line Price
+00009450: 3a20 7b73 7570 706c 795f 6469 7374 616c  : {supply_distal
+00009460: 5f6c 696e 6573 5b69 5d3a 2e32 667d 2229  _lines[i]:.2f}")
+00009470: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00009480: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009490: 2049 6e63 6c75 6465 207a 6f6e 6520 7261   Include zone ra
+000094a0: 6e67 650a 2020 2020 2320 2020 2020 2020  nge.    #       
 000094b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094c0: 2020 2065 6c73 653a 0a20 2020 2023 2020     else:.    #  
-000094d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094e0: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-000094f0: 7772 6974 6528 225c 6e46 7265 7368 205a  write("\nFresh Z
-00009500: 6f6e 6522 290a 2020 2020 2320 2020 2020  one").    #     
-00009510: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00009520: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-00009530: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00009540: 2e77 7269 7465 2822 5c6e 4e6f 2073 7570  .write("\nNo sup
-00009550: 706c 7920 7a6f 6e65 2070 6174 7465 726e  ply zone pattern
-00009560: 7320 666f 756e 642e 2229 0a0a 2020 2020  s found.")..    
-00009570: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00009580: 2020 2320 4368 6563 6b20 6966 2074 6865    # Check if the
-00009590: 2073 746f 636b 2068 6173 2065 6974 6865   stock has eithe
-000095a0: 7220 6465 6d61 6e64 206f 7220 7375 7070  r demand or supp
-000095b0: 6c79 207a 6f6e 6520 7769 7468 696e 2074  ly zone within t
-000095c0: 6865 2074 6872 6573 686f 6c64 0a20 2020  he threshold.   
-000095d0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-000095e0: 2020 2068 6173 5f64 656d 616e 645f 6f72     has_demand_or
-000095f0: 5f73 7570 706c 795f 7769 7468 696e 5f74  _supply_within_t
-00009600: 6872 6573 686f 6c64 203d 2061 6e79 280a  hreshold = any(.
-00009610: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-00009620: 2020 2020 2020 2020 2020 6162 7328 2863            abs((c
-00009630: 6d70 202d 2070 7269 6365 2920 2f20 636d  mp - price) / cm
-00009640: 7029 202a 2031 3030 203c 3d20 7468 7265  p) * 100 <= thre
-00009650: 7368 6f6c 645f 7065 7263 656e 740a 2020  shold_percent.  
-00009660: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00009670: 2020 2020 2020 2020 666f 7220 7072 6963          for pric
-00009680: 6520 696e 2064 656d 616e 645f 7072 6f78  e in demand_prox
-00009690: 696d 616c 5f6c 696e 6573 202b 2073 7570  imal_lines + sup
-000096a0: 706c 795f 7072 6f78 696d 616c 5f6c 696e  ply_proximal_lin
-000096b0: 6573 0a20 2020 2023 2020 2020 2020 2020  es.    #        
-000096c0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000096d0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-000096e0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-000096f0: 2020 2020 2020 2320 4966 2074 6865 2073        # If the s
-00009700: 746f 636b 2068 6173 2064 656d 616e 6420  tock has demand 
+000094c0: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
+000094d0: 2866 225c 6e5a 6f6e 6520 5261 6e67 653a  (f"\nZone Range:
+000094e0: 207b 7375 7070 6c79 5f7a 6f6e 655f 7261   {supply_zone_ra
+000094f0: 6e67 6573 5b69 5d3a 2e32 667d 2229 0a20  nges[i]:.2f}"). 
+00009500: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00009510: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00009520: 6865 636b 2069 6620 7072 6f78 696d 616c  heck if proximal
+00009530: 206c 696e 6520 6973 2074 6573 7465 640a   line is tested.
+00009540: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00009550: 2020 2020 2020 2020 2020 2020 2020 7465                te
+00009560: 7374 6564 203d 2069 735f 7a6f 6e65 5f74  sted = is_zone_t
+00009570: 6573 7465 6428 6461 7461 2c20 7374 6172  ested(data, star
+00009580: 742c 2065 6e64 2c20 7375 7070 6c79 5f70  t, end, supply_p
+00009590: 726f 7869 6d61 6c5f 6c69 6e65 735b 695d  roximal_lines[i]
+000095a0: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
+000095b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095c0: 6966 2074 6573 7465 643a 0a20 2020 2023  if tested:.    #
+000095d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095e0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+000095f0: 652e 7772 6974 6528 225c 6e5a 6f6e 6520  e.write("\nZone 
+00009600: 6973 2054 6573 7465 6422 290a 2020 2020  is Tested").    
+00009610: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00009620: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00009630: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00009640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009650: 2020 6669 6c65 2e77 7269 7465 2822 5c6e    file.write("\n
+00009660: 4672 6573 6820 5a6f 6e65 2229 0a20 2020  Fresh Zone").   
+00009670: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00009680: 2020 2065 6c73 653a 0a20 2020 2023 2020     else:.    #  
+00009690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000096a0: 2020 2066 696c 652e 7772 6974 6528 225c     file.write("\
+000096b0: 6e4e 6f20 7375 7070 6c79 207a 6f6e 6520  nNo supply zone 
+000096c0: 7061 7474 6572 6e73 2066 6f75 6e64 2e22  patterns found."
+000096d0: 290a 0a20 2020 2023 2020 2020 2020 2020  )..    #        
+000096e0: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+000096f0: 2069 6620 7468 6520 7374 6f63 6b20 6861   if the stock ha
+00009700: 7320 6569 7468 6572 2064 656d 616e 6420  s either demand 
 00009710: 6f72 2073 7570 706c 7920 7a6f 6e65 2077  or supply zone w
 00009720: 6974 6869 6e20 7468 6520 7468 7265 7368  ithin the thresh
-00009730: 6f6c 642c 2069 6e63 7265 6d65 6e74 2074  old, increment t
-00009740: 6865 2063 6f75 6e74 0a20 2020 2023 2020  he count.    #  
-00009750: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00009760: 6620 6861 735f 6465 6d61 6e64 5f6f 725f  f has_demand_or_
-00009770: 7375 7070 6c79 5f77 6974 6869 6e5f 7468  supply_within_th
-00009780: 7265 7368 6f6c 643a 0a20 2020 2023 2020  reshold:.    #  
-00009790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097a0: 2020 2063 6f75 6e74 5f66 696c 7465 7265     count_filtere
-000097b0: 645f 7374 6f63 6b73 202b 3d20 310a 0a20  d_stocks += 1.. 
-000097c0: 2020 2023 2020 2020 2023 2046 696c 7465     #     # Filte
-000097d0: 7220 7374 6f63 6b73 2062 6173 6564 206f  r stocks based o
-000097e0: 6e20 7468 6520 7065 7263 656e 7461 6765  n the percentage
-000097f0: 2074 6872 6573 686f 6c64 2061 6e64 2073   threshold and s
-00009800: 6176 6520 7468 6520 7265 7375 6c74 7320  ave the results 
-00009810: 696e 2061 6e6f 7468 6572 2066 696c 650a  in another file.
-00009820: 2020 2020 2320 2020 2020 6669 6c74 6572      #     filter
-00009830: 6564 5f73 746f 636b 7320 3d20 7365 6c66  ed_stocks = self
-00009840: 2e66 696c 7465 725f 7374 6f63 6b73 5f62  .filter_stocks_b
-00009850: 795f 6469 7374 616e 6365 2873 746f 636b  y_distance(stock
-00009860: 5f73 796d 626f 6c73 2c20 7468 7265 7368  _symbols, thresh
-00009870: 6f6c 645f 7065 7263 656e 742c 2074 696d  old_percent, tim
-00009880: 6566 7261 6d65 290a 0a20 2020 2023 2020  eframe)..    #  
-00009890: 2020 2077 6974 6820 6f70 656e 2822 6669     with open("fi
-000098a0: 6c74 6572 6564 5f73 746f 636b 735f 6461  ltered_stocks_da
-000098b0: 7461 2e74 7874 222c 2022 7722 2920 6173  ta.txt", "w") as
-000098c0: 2066 696c 653a 0a20 2020 2023 2020 2020   file:.    #    
-000098d0: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
-000098e0: 6622 4e75 6d62 6572 206f 6620 7374 6f63  f"Number of stoc
-000098f0: 6b73 2046 696c 7465 7265 643a 207b 636f  ks Filtered: {co
-00009900: 756e 745f 6669 6c74 6572 6564 5f73 746f  unt_filtered_sto
-00009910: 636b 737d 5c6e 5c6e 2229 0a20 2020 2023  cks}\n\n").    #
-00009920: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-00009930: 6974 6528 2246 696c 7465 7265 6420 5374  ite("Filtered St
-00009940: 6f63 6b20 4461 7461 3a5c 6e5c 6e22 290a  ock Data:\n\n").
-00009950: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00009960: 2023 2020 2020 2020 2020 2066 6f72 2073   #         for s
-00009970: 796d 626f 6c20 696e 2066 696c 7465 7265  ymbol in filtere
-00009980: 645f 7374 6f63 6b73 3a0a 2020 2020 2320  d_stocks:.    # 
-00009990: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-000099a0: 6174 6120 6973 206e 6f74 204e 6f6e 653a  ata is not None:
-000099b0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-000099c0: 2020 2020 2020 2063 6d70 203d 2064 6174         cmp = dat
-000099d0: 612e 696c 6f63 5b2d 315d 5b27 436c 6f73  a.iloc[-1]['Clos
-000099e0: 6527 5d20 2023 2043 7572 7265 6e74 206d  e']  # Current m
-000099f0: 6172 6b65 7420 7072 6963 650a 2020 2020  arket price.    
-00009a00: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00009a10: 2020 6465 6d61 6e64 5f7a 6f6e 6573 2c20    demand_zones, 
-00009a20: 5f2c 205f 2c20 6465 6d61 6e64 5f70 726f  _, _, demand_pro
-00009a30: 7869 6d61 6c5f 6c69 6e65 203d 2073 656c  ximal_line = sel
-00009a40: 662e 6964 656e 7469 6679 5f64 656d 616e  f.identify_deman
-00009a50: 645f 7a6f 6e65 2864 6174 612c 2063 6d70  d_zone(data, cmp
-00009a60: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
-00009a70: 2020 2020 2020 2020 7375 7070 6c79 5f7a          supply_z
-00009a80: 6f6e 6573 2c20 5f2c 205f 2c20 7375 7070  ones, _, _, supp
-00009a90: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
-00009aa0: 203d 2073 656c 662e 6964 656e 7469 6679   = self.identify
-00009ab0: 5f73 7570 706c 795f 7a6f 6e65 2864 6174  _supply_zone(dat
-00009ac0: 612c 2063 6d70 290a 0a20 2020 2023 2020  a, cmp)..    #  
-00009ad0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00009ae0: 2053 7465 7020 313a 2043 616c 6375 6c61   Step 1: Calcula
-00009af0: 7465 2070 726f 7869 6d61 6c20 6c69 6e65  te proximal line
-00009b00: 7320 666f 7220 6465 6d61 6e64 2061 6e64  s for demand and
-00009b10: 2073 7570 706c 7920 7a6f 6e65 730a 2020   supply zones.  
-00009b20: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00009b30: 2020 2020 6465 6d61 6e64 5f70 726f 7869      demand_proxi
-00009b40: 6d61 6c5f 6c69 6e65 7320 3d20 7365 6c66  mal_lines = self
-00009b50: 2e63 616c 6375 6c61 7465 5f64 656d 616e  .calculate_deman
-00009b60: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
-00009b70: 2864 6174 612c 2064 656d 616e 645f 7a6f  (data, demand_zo
-00009b80: 6e65 7329 0a20 2020 2023 2020 2020 2020  nes).    #      
-00009b90: 2020 2020 2020 2020 2020 2073 7570 706c             suppl
-00009ba0: 795f 7072 6f78 696d 616c 5f6c 696e 6573  y_proximal_lines
-00009bb0: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
-00009bc0: 655f 7375 7070 6c79 5f70 726f 7869 6d61  e_supply_proxima
-00009bd0: 6c5f 6c69 6e65 7328 6461 7461 2c20 7375  l_lines(data, su
-00009be0: 7070 6c79 5f7a 6f6e 6573 290a 2020 2020  pply_zones).    
-00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c00: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00009c10: 2020 2020 2020 2023 2053 7465 7020 323a         # Step 2:
-00009c20: 2043 616c 6375 6c61 7465 2064 6973 7461   Calculate dista
-00009c30: 6c20 6c69 6e65 7320 666f 7220 6465 6d61  l lines for dema
-00009c40: 6e64 207a 6f6e 6573 2061 6e64 2073 7570  nd zones and sup
-00009c50: 706c 7920 7a6f 6e65 730a 2020 2020 2320  ply zones.    # 
-00009c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c70: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
-00009c80: 6e65 7320 3d20 7365 6c66 2e63 616c 6375  nes = self.calcu
-00009c90: 6c61 7465 5f64 656d 616e 645f 6469 7374  late_demand_dist
-00009ca0: 616c 5f6c 696e 6573 2864 6174 612c 2064  al_lines(data, d
-00009cb0: 656d 616e 645f 7a6f 6e65 7329 0a20 2020  emand_zones).   
-00009cc0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00009cd0: 2020 2073 7570 706c 795f 6469 7374 616c     supply_distal
-00009ce0: 5f6c 696e 6573 203d 2073 656c 662e 6361  _lines = self.ca
-00009cf0: 6c63 756c 6174 655f 7375 7070 6c79 5f64  lculate_supply_d
-00009d00: 6973 7461 6c5f 6c69 6e65 7328 6461 7461  istal_lines(data
-00009d10: 2c20 7375 7070 6c79 5f7a 6f6e 6573 290a  , supply_zones).
-00009d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d30: 2020 2020 0a20 2020 2023 2020 2020 2020      .    #      
-00009d40: 2020 2020 2020 2020 2020 2023 2043 616c             # Cal
-00009d50: 6375 6c61 7465 2072 616e 6765 206f 6620  culate range of 
-00009d60: 6465 6d61 6e64 2061 6e64 2073 7570 706c  demand and suppl
-00009d70: 7920 7a6f 6e65 730a 2020 2020 2320 2020  y zones.    #   
-00009d80: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00009d90: 6d61 6e64 5f7a 6f6e 655f 7261 6e67 6573  mand_zone_ranges
-00009da0: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
-00009db0: 655f 6465 6d61 6e64 5f7a 6f6e 655f 7261  e_demand_zone_ra
-00009dc0: 6e67 6573 2864 656d 616e 645f 7a6f 6e65  nges(demand_zone
-00009dd0: 732c 2064 656d 616e 645f 7072 6f78 696d  s, demand_proxim
-00009de0: 616c 5f6c 696e 6573 2c20 6465 6d61 6e64  al_lines, demand
-00009df0: 5f64 6973 7461 6c5f 6c69 6e65 7329 0a20  _distal_lines). 
-00009e00: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00009e10: 2020 2020 2073 7570 706c 795f 7a6f 6e65       supply_zone
-00009e20: 5f72 616e 6765 7320 3d20 7365 6c66 2e63  _ranges = self.c
-00009e30: 616c 6375 6c61 7465 5f73 7570 706c 795f  alculate_supply_
-00009e40: 7a6f 6e65 5f72 616e 6765 7328 7375 7070  zone_ranges(supp
-00009e50: 6c79 5f7a 6f6e 6573 2c20 7375 7070 6c79  ly_zones, supply
-00009e60: 5f70 726f 7869 6d61 6c5f 6c69 6e65 732c  _proximal_lines,
-00009e70: 2073 7570 706c 795f 6469 7374 616c 5f6c   supply_distal_l
-00009e80: 696e 6573 290a 2020 2020 2020 2020 2020  ines).          
-00009e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ea0: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
-00009eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ec0: 2023 2043 6865 636b 2069 6620 7468 6520   # Check if the 
-00009ed0: 7374 6f63 6b20 6861 7320 6569 7468 6572  stock has either
-00009ee0: 2064 656d 616e 6420 6f72 2073 7570 706c   demand or suppl
-00009ef0: 7920 7a6f 6e65 2077 6974 6869 6e20 7468  y zone within th
-00009f00: 6520 7468 7265 7368 6f6c 640a 2020 2020  e threshold.    
-00009f10: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00009f20: 2020 6861 735f 6465 6d61 6e64 5f6f 725f    has_demand_or_
-00009f30: 7375 7070 6c79 5f77 6974 6869 6e5f 7468  supply_within_th
-00009f40: 7265 7368 6f6c 6420 3d20 616e 7928 0a20  reshold = any(. 
-00009f50: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00009f60: 2020 2020 2020 2020 2061 6273 2828 636d           abs((cm
-00009f70: 7020 2d20 7072 6963 6529 202f 2063 6d70  p - price) / cmp
-00009f80: 2920 2a20 3130 3020 3c3d 2074 6872 6573  ) * 100 <= thres
-00009f90: 686f 6c64 5f70 6572 6365 6e74 0a20 2020  hold_percent.   
-00009fa0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00009fb0: 2020 2020 2020 2066 6f72 2070 7269 6365         for price
-00009fc0: 2069 6e20 6465 6d61 6e64 5f70 726f 7869   in demand_proxi
-00009fd0: 6d61 6c5f 6c69 6e65 7320 2b20 7375 7070  mal_lines + supp
-00009fe0: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
-00009ff0: 730a 2020 2020 2320 2020 2020 2020 2020  s.    #         
-0000a000: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000a010: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0000a020: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000a030: 2020 2020 2023 2049 6620 7468 6520 7374       # If the st
-0000a040: 6f63 6b20 6861 7320 6465 6d61 6e64 206f  ock has demand o
+00009730: 6f6c 640a 2020 2020 2320 2020 2020 2020  old.    #       
+00009740: 2020 2020 2020 2020 2020 6861 735f 6465            has_de
+00009750: 6d61 6e64 5f6f 725f 7375 7070 6c79 5f77  mand_or_supply_w
+00009760: 6974 6869 6e5f 7468 7265 7368 6f6c 6420  ithin_threshold 
+00009770: 3d20 616e 7928 0a20 2020 2023 2020 2020  = any(.    #    
+00009780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009790: 2061 6273 2828 636d 7020 2d20 7072 6963   abs((cmp - pric
+000097a0: 6529 202f 2063 6d70 2920 2a20 3130 3020  e) / cmp) * 100 
+000097b0: 3c3d 2074 6872 6573 686f 6c64 5f70 6572  <= threshold_per
+000097c0: 6365 6e74 0a20 2020 2023 2020 2020 2020  cent.    #      
+000097d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000097e0: 6f72 2070 7269 6365 2069 6e20 6465 6d61  or price in dema
+000097f0: 6e64 5f70 726f 7869 6d61 6c5f 6c69 6e65  nd_proximal_line
+00009800: 7320 2b20 7375 7070 6c79 5f70 726f 7869  s + supply_proxi
+00009810: 6d61 6c5f 6c69 6e65 730a 2020 2020 2320  mal_lines.    # 
+00009820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009830: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00009840: 2020 2020 2020 0a20 2020 2023 2020 2020        .    #    
+00009850: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+00009860: 6620 7468 6520 7374 6f63 6b20 6861 7320  f the stock has 
+00009870: 6465 6d61 6e64 206f 7220 7375 7070 6c79  demand or supply
+00009880: 207a 6f6e 6520 7769 7468 696e 2074 6865   zone within the
+00009890: 2074 6872 6573 686f 6c64 2c20 696e 6372   threshold, incr
+000098a0: 656d 656e 7420 7468 6520 636f 756e 740a  ement the count.
+000098b0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+000098c0: 2020 2020 2020 6966 2068 6173 5f64 656d        if has_dem
+000098d0: 616e 645f 6f72 5f73 7570 706c 795f 7769  and_or_supply_wi
+000098e0: 7468 696e 5f74 6872 6573 686f 6c64 3a0a  thin_threshold:.
+000098f0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00009900: 2020 2020 2020 2020 2020 636f 756e 745f            count_
+00009910: 6669 6c74 6572 6564 5f73 746f 636b 7320  filtered_stocks 
+00009920: 2b3d 2031 0a0a 2020 2020 2320 2020 2020  += 1..    #     
+00009930: 2320 4669 6c74 6572 2073 746f 636b 7320  # Filter stocks 
+00009940: 6261 7365 6420 6f6e 2074 6865 2070 6572  based on the per
+00009950: 6365 6e74 6167 6520 7468 7265 7368 6f6c  centage threshol
+00009960: 6420 616e 6420 7361 7665 2074 6865 2072  d and save the r
+00009970: 6573 756c 7473 2069 6e20 616e 6f74 6865  esults in anothe
+00009980: 7220 6669 6c65 0a20 2020 2023 2020 2020  r file.    #    
+00009990: 2066 696c 7465 7265 645f 7374 6f63 6b73   filtered_stocks
+000099a0: 203d 2073 656c 662e 6669 6c74 6572 5f73   = self.filter_s
+000099b0: 746f 636b 735f 6279 5f64 6973 7461 6e63  tocks_by_distanc
+000099c0: 6528 7374 6f63 6b5f 7379 6d62 6f6c 732c  e(stock_symbols,
+000099d0: 2074 6872 6573 686f 6c64 5f70 6572 6365   threshold_perce
+000099e0: 6e74 2c20 7469 6d65 6672 616d 6529 0a0a  nt, timeframe)..
+000099f0: 2020 2020 2320 2020 2020 7769 7468 206f      #     with o
+00009a00: 7065 6e28 2266 696c 7465 7265 645f 7374  pen("filtered_st
+00009a10: 6f63 6b73 5f64 6174 612e 7478 7422 2c20  ocks_data.txt", 
+00009a20: 2277 2229 2061 7320 6669 6c65 3a0a 2020  "w") as file:.  
+00009a30: 2020 2320 2020 2020 2020 2020 6669 6c65    #         file
+00009a40: 2e77 7269 7465 2866 224e 756d 6265 7220  .write(f"Number 
+00009a50: 6f66 2073 746f 636b 7320 4669 6c74 6572  of stocks Filter
+00009a60: 6564 3a20 7b63 6f75 6e74 5f66 696c 7465  ed: {count_filte
+00009a70: 7265 645f 7374 6f63 6b73 7d5c 6e5c 6e22  red_stocks}\n\n"
+00009a80: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
+00009a90: 6669 6c65 2e77 7269 7465 2822 4669 6c74  file.write("Filt
+00009aa0: 6572 6564 2053 746f 636b 2044 6174 613a  ered Stock Data:
+00009ab0: 5c6e 5c6e 2229 0a20 2020 2020 2020 2020  \n\n").         
+00009ac0: 2020 200a 2020 2020 2320 2020 2020 2020     .    #       
+00009ad0: 2020 666f 7220 7379 6d62 6f6c 2069 6e20    for symbol in 
+00009ae0: 6669 6c74 6572 6564 5f73 746f 636b 733a  filtered_stocks:
+00009af0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00009b00: 2020 2069 6620 6461 7461 2069 7320 6e6f     if data is no
+00009b10: 7420 4e6f 6e65 3a0a 2020 2020 2320 2020  t None:.    #   
+00009b20: 2020 2020 2020 2020 2020 2020 2020 636d                cm
+00009b30: 7020 3d20 6461 7461 2e69 6c6f 635b 2d31  p = data.iloc[-1
+00009b40: 5d5b 2743 6c6f 7365 275d 2020 2320 4375  ]['Close']  # Cu
+00009b50: 7272 656e 7420 6d61 726b 6574 2070 7269  rrent market pri
+00009b60: 6365 0a20 2020 2023 2020 2020 2020 2020  ce.    #        
+00009b70: 2020 2020 2020 2020 2064 656d 616e 645f           demand_
+00009b80: 7a6f 6e65 732c 205f 2c20 5f2c 2064 656d  zones, _, _, dem
+00009b90: 616e 645f 7072 6f78 696d 616c 5f6c 696e  and_proximal_lin
+00009ba0: 6520 3d20 7365 6c66 2e69 6465 6e74 6966  e = self.identif
+00009bb0: 795f 6465 6d61 6e64 5f7a 6f6e 6528 6461  y_demand_zone(da
+00009bc0: 7461 2c20 636d 7029 0a20 2020 2023 2020  ta, cmp).    #  
+00009bd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009be0: 7570 706c 795f 7a6f 6e65 732c 205f 2c20  upply_zones, _, 
+00009bf0: 5f2c 2073 7570 706c 795f 7072 6f78 696d  _, supply_proxim
+00009c00: 616c 5f6c 696e 6520 3d20 7365 6c66 2e69  al_line = self.i
+00009c10: 6465 6e74 6966 795f 7375 7070 6c79 5f7a  dentify_supply_z
+00009c20: 6f6e 6528 6461 7461 2c20 636d 7029 0a0a  one(data, cmp)..
+00009c30: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00009c40: 2020 2020 2020 2320 5374 6570 2031 3a20        # Step 1: 
+00009c50: 4361 6c63 756c 6174 6520 7072 6f78 696d  Calculate proxim
+00009c60: 616c 206c 696e 6573 2066 6f72 2064 656d  al lines for dem
+00009c70: 616e 6420 616e 6420 7375 7070 6c79 207a  and and supply z
+00009c80: 6f6e 6573 0a20 2020 2023 2020 2020 2020  ones.    #      
+00009c90: 2020 2020 2020 2020 2020 2064 656d 616e             deman
+00009ca0: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
+00009cb0: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
+00009cc0: 655f 6465 6d61 6e64 5f70 726f 7869 6d61  e_demand_proxima
+00009cd0: 6c5f 6c69 6e65 7328 6461 7461 2c20 6465  l_lines(data, de
+00009ce0: 6d61 6e64 5f7a 6f6e 6573 290a 2020 2020  mand_zones).    
+00009cf0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00009d00: 2020 7375 7070 6c79 5f70 726f 7869 6d61    supply_proxima
+00009d10: 6c5f 6c69 6e65 7320 3d20 7365 6c66 2e63  l_lines = self.c
+00009d20: 616c 6375 6c61 7465 5f73 7570 706c 795f  alculate_supply_
+00009d30: 7072 6f78 696d 616c 5f6c 696e 6573 2864  proximal_lines(d
+00009d40: 6174 612c 2073 7570 706c 795f 7a6f 6e65  ata, supply_zone
+00009d50: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00009d60: 2020 2020 2020 200a 2020 2020 2320 2020         .    #   
+00009d70: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00009d80: 5374 6570 2032 3a20 4361 6c63 756c 6174  Step 2: Calculat
+00009d90: 6520 6469 7374 616c 206c 696e 6573 2066  e distal lines f
+00009da0: 6f72 2064 656d 616e 6420 7a6f 6e65 7320  or demand zones 
+00009db0: 616e 6420 7375 7070 6c79 207a 6f6e 6573  and supply zones
+00009dc0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00009dd0: 2020 2020 2020 2064 656d 616e 645f 6469         demand_di
+00009de0: 7374 616c 5f6c 696e 6573 203d 2073 656c  stal_lines = sel
+00009df0: 662e 6361 6c63 756c 6174 655f 6465 6d61  f.calculate_dema
+00009e00: 6e64 5f64 6973 7461 6c5f 6c69 6e65 7328  nd_distal_lines(
+00009e10: 6461 7461 2c20 6465 6d61 6e64 5f7a 6f6e  data, demand_zon
+00009e20: 6573 290a 2020 2020 2320 2020 2020 2020  es).    #       
+00009e30: 2020 2020 2020 2020 2020 7375 7070 6c79            supply
+00009e40: 5f64 6973 7461 6c5f 6c69 6e65 7320 3d20  _distal_lines = 
+00009e50: 7365 6c66 2e63 616c 6375 6c61 7465 5f73  self.calculate_s
+00009e60: 7570 706c 795f 6469 7374 616c 5f6c 696e  upply_distal_lin
+00009e70: 6573 2864 6174 612c 2073 7570 706c 795f  es(data, supply_
+00009e80: 7a6f 6e65 7329 0a20 2020 2020 2020 2020  zones).         
+00009e90: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00009ea0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00009eb0: 2020 2320 4361 6c63 756c 6174 6520 7261    # Calculate ra
+00009ec0: 6e67 6520 6f66 2064 656d 616e 6420 616e  nge of demand an
+00009ed0: 6420 7375 7070 6c79 207a 6f6e 6573 0a20  d supply zones. 
+00009ee0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00009ef0: 2020 2020 2064 656d 616e 645f 7a6f 6e65       demand_zone
+00009f00: 5f72 616e 6765 7320 3d20 7365 6c66 2e63  _ranges = self.c
+00009f10: 616c 6375 6c61 7465 5f64 656d 616e 645f  alculate_demand_
+00009f20: 7a6f 6e65 5f72 616e 6765 7328 6465 6d61  zone_ranges(dema
+00009f30: 6e64 5f7a 6f6e 6573 2c20 6465 6d61 6e64  nd_zones, demand
+00009f40: 5f70 726f 7869 6d61 6c5f 6c69 6e65 732c  _proximal_lines,
+00009f50: 2064 656d 616e 645f 6469 7374 616c 5f6c   demand_distal_l
+00009f60: 696e 6573 290a 2020 2020 2320 2020 2020  ines).    #     
+00009f70: 2020 2020 2020 2020 2020 2020 7375 7070              supp
+00009f80: 6c79 5f7a 6f6e 655f 7261 6e67 6573 203d  ly_zone_ranges =
+00009f90: 2073 656c 662e 6361 6c63 756c 6174 655f   self.calculate_
+00009fa0: 7375 7070 6c79 5f7a 6f6e 655f 7261 6e67  supply_zone_rang
+00009fb0: 6573 2873 7570 706c 795f 7a6f 6e65 732c  es(supply_zones,
+00009fc0: 2073 7570 706c 795f 7072 6f78 696d 616c   supply_proximal
+00009fd0: 5f6c 696e 6573 2c20 7375 7070 6c79 5f64  _lines, supply_d
+00009fe0: 6973 7461 6c5f 6c69 6e65 7329 0a20 2020  istal_lines).   
+00009ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a010: 200a 2020 2020 2320 2020 2020 2020 2020   .    #         
+0000a020: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+0000a030: 6966 2074 6865 2073 746f 636b 2068 6173  if the stock has
+0000a040: 2065 6974 6865 7220 6465 6d61 6e64 206f   either demand o
 0000a050: 7220 7375 7070 6c79 207a 6f6e 6520 7769  r supply zone wi
 0000a060: 7468 696e 2074 6865 2074 6872 6573 686f  thin the thresho
-0000a070: 6c64 2c20 7772 6974 6520 6974 7320 616e  ld, write its an
-0000a080: 616c 7973 6973 0a20 2020 2023 2020 2020  alysis.    #    
-0000a090: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000a0a0: 6861 735f 6465 6d61 6e64 5f6f 725f 7375  has_demand_or_su
-0000a0b0: 7070 6c79 5f77 6974 6869 6e5f 7468 7265  pply_within_thre
-0000a0c0: 7368 6f6c 643a 0a20 2020 2023 2020 2020  shold:.    #    
-0000a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0e0: 2066 696c 652e 7772 6974 6528 6622 416e   file.write(f"An
-0000a0f0: 616c 7973 6973 2066 6f72 207b 7379 6d62  alysis for {symb
-0000a100: 6f6c 7d20 287b 7469 6d65 6672 616d 657d  ol} ({timeframe}
-0000a110: 293a 5c6e 2229 0a20 2020 2020 2020 2020  ):\n").         
-0000a120: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-0000a130: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000a140: 2020 2020 2020 2020 2020 2320 4465 6d61            # Dema
-0000a150: 6e64 205a 6f6e 6573 0a20 2020 2023 2020  nd Zones.    #  
-0000a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a170: 2020 2066 696c 652e 7772 6974 6528 225c     file.write("\
-0000a180: 6e5c 6e44 656d 616e 6420 5a6f 6e65 733a  n\nDemand Zones:
-0000a190: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
-0000a1a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000a1b0: 6465 6d61 6e64 5f7a 6f6e 6573 3a20 2023  demand_zones:  #
-0000a1c0: 2043 6865 636b 2069 6620 6465 6d61 6e64   Check if demand
-0000a1d0: 5f7a 6f6e 6573 2069 7320 6e6f 7420 656d  _zones is not em
-0000a1e0: 7074 790a 2020 2020 2320 2020 2020 2020  pty.    #       
-0000a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a200: 2020 666f 7220 692c 2028 7374 6172 742c    for i, (start,
-0000a210: 2065 6e64 2c20 7061 7474 6572 6e2c 2062   end, pattern, b
-0000a220: 6173 655f 636f 756e 7429 2069 6e20 656e  ase_count) in en
-0000a230: 756d 6572 6174 6528 6465 6d61 6e64 5f7a  umerate(demand_z
-0000a240: 6f6e 6573 293a 0a20 2020 2023 2020 2020  ones):.    #    
-0000a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a260: 2020 2020 2020 2020 2064 6973 745f 6672           dist_fr
-0000a270: 6f6d 5f63 6d70 203d 2061 6273 2828 636d  om_cmp = abs((cm
-0000a280: 7020 2d20 6465 6d61 6e64 5f70 726f 7869  p - demand_proxi
-0000a290: 6d61 6c5f 6c69 6e65 735b 695d 2920 2f20  mal_lines[i]) / 
-0000a2a0: 636d 7029 202a 2031 3030 0a20 2020 2023  cmp) * 100.    #
-0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000a2d0: 6162 7328 6469 7374 5f66 726f 6d5f 636d  abs(dist_from_cm
-0000a2e0: 7029 203c 3d20 7468 7265 7368 6f6c 645f  p) <= threshold_
-0000a2f0: 7065 7263 656e 743a 2020 2320 4368 6563  percent:  # Chec
-0000a300: 6b20 6966 2064 6973 745f 6672 6f6d 5f63  k if dist_from_c
-0000a310: 6d70 2069 7320 7769 7468 696e 2074 6872  mp is within thr
-0000a320: 6573 686f 6c64 0a20 2020 2023 2020 2020  eshold.    #    
-0000a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a340: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0000a350: 652e 7772 6974 6528 6622 5c6e 5c6e 5a6f  e.write(f"\n\nZo
-0000a360: 6e65 207b 692b 317d 3a20 5374 6172 7420  ne {i+1}: Start 
-0000a370: 4461 7465 3a20 7b64 6174 612e 696e 6465  Date: {data.inde
-0000a380: 785b 7374 6172 745d 2e64 6174 6528 297d  x[start].date()}
-0000a390: 2c20 456e 6420 4461 7465 3a20 7b64 6174  , End Date: {dat
-0000a3a0: 612e 696e 6465 785b 656e 645d 2e64 6174  a.index[end].dat
-0000a3b0: 6528 297d 2229 0a20 2020 2023 2020 2020  e()}").    #    
+0000a070: 6c64 0a20 2020 2023 2020 2020 2020 2020  ld.    #        
+0000a080: 2020 2020 2020 2020 2068 6173 5f64 656d           has_dem
+0000a090: 616e 645f 6f72 5f73 7570 706c 795f 7769  and_or_supply_wi
+0000a0a0: 7468 696e 5f74 6872 6573 686f 6c64 203d  thin_threshold =
+0000a0b0: 2061 6e79 280a 2020 2020 2320 2020 2020   any(.    #     
+0000a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0d0: 6162 7328 2863 6d70 202d 2070 7269 6365  abs((cmp - price
+0000a0e0: 2920 2f20 636d 7029 202a 2031 3030 203c  ) / cmp) * 100 <
+0000a0f0: 3d20 7468 7265 7368 6f6c 645f 7065 7263  = threshold_perc
+0000a100: 656e 740a 2020 2020 2320 2020 2020 2020  ent.    #       
+0000a110: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000a120: 7220 7072 6963 6520 696e 2064 656d 616e  r price in deman
+0000a130: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
+0000a140: 202b 2073 7570 706c 795f 7072 6f78 696d   + supply_proxim
+0000a150: 616c 5f6c 696e 6573 0a20 2020 2023 2020  al_lines.    #  
+0000a160: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000a170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a180: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
+0000a190: 2020 2020 2020 2020 2020 2020 2320 4966              # If
+0000a1a0: 2074 6865 2073 746f 636b 2068 6173 2064   the stock has d
+0000a1b0: 656d 616e 6420 6f72 2073 7570 706c 7920  emand or supply 
+0000a1c0: 7a6f 6e65 2077 6974 6869 6e20 7468 6520  zone within the 
+0000a1d0: 7468 7265 7368 6f6c 642c 2077 7269 7465  threshold, write
+0000a1e0: 2069 7473 2061 6e61 6c79 7369 730a 2020   its analysis.  
+0000a1f0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000a200: 2020 2020 6966 2068 6173 5f64 656d 616e      if has_deman
+0000a210: 645f 6f72 5f73 7570 706c 795f 7769 7468  d_or_supply_with
+0000a220: 696e 5f74 6872 6573 686f 6c64 3a0a 2020  in_threshold:.  
+0000a230: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000a240: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+0000a250: 7465 2866 2241 6e61 6c79 7369 7320 666f  te(f"Analysis fo
+0000a260: 7220 7b73 796d 626f 6c7d 2028 7b74 696d  r {symbol} ({tim
+0000a270: 6566 7261 6d65 7d29 3a5c 6e22 290a 2020  eframe}):\n").  
+0000a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a290: 2020 2020 2020 0a20 2020 2023 2020 2020        .    #    
+0000a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2b0: 2023 2044 656d 616e 6420 5a6f 6e65 730a   # Demand Zones.
+0000a2c0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000a2d0: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
+0000a2e0: 7269 7465 2822 5c6e 5c6e 4465 6d61 6e64  rite("\n\nDemand
+0000a2f0: 205a 6f6e 6573 3a22 290a 2020 2020 2320   Zones:").    # 
+0000a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a310: 2020 2020 6966 2064 656d 616e 645f 7a6f      if demand_zo
+0000a320: 6e65 733a 2020 2320 4368 6563 6b20 6966  nes:  # Check if
+0000a330: 2064 656d 616e 645f 7a6f 6e65 7320 6973   demand_zones is
+0000a340: 206e 6f74 2065 6d70 7479 0a20 2020 2023   not empty.    #
+0000a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a360: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
+0000a370: 2873 7461 7274 2c20 656e 642c 2070 6174  (start, end, pat
+0000a380: 7465 726e 2c20 6261 7365 5f63 6f75 6e74  tern, base_count
+0000a390: 2920 696e 2065 6e75 6d65 7261 7465 2864  ) in enumerate(d
+0000a3a0: 656d 616e 645f 7a6f 6e65 7329 3a0a 2020  emand_zones):.  
+0000a3b0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
 0000a3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3d0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0000a3e0: 652e 7772 6974 6528 6622 5c6e 5061 7474  e.write(f"\nPatt
-0000a3f0: 6572 6e20 4e61 6d65 3a20 7b70 6174 7465  ern Name: {patte
-0000a400: 726e 7d2c 204e 756d 6265 7220 6f66 2042  rn}, Number of B
-0000a410: 6173 6520 4361 6e64 6c65 3a20 7b62 6173  ase Candle: {bas
-0000a420: 655f 636f 756e 747d 2229 0a20 2020 2023  e_count}").    #
-0000a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a450: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
-0000a460: 4469 7374 616e 6365 2066 726f 6d20 434d  Distance from CM
-0000a470: 503a 207b 6469 7374 5f66 726f 6d5f 636d  P: {dist_from_cm
-0000a480: 703a 2e32 667d 2522 290a 2020 2020 2320  p:.2f}%").    # 
-0000a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3d0: 6469 7374 5f66 726f 6d5f 636d 7020 3d20  dist_from_cmp = 
+0000a3e0: 6162 7328 2863 6d70 202d 2064 656d 616e  abs((cmp - deman
+0000a3f0: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
+0000a400: 5b69 5d29 202f 2063 6d70 2920 2a20 3130  [i]) / cmp) * 10
+0000a410: 300a 2020 2020 2320 2020 2020 2020 2020  0.    #         
+0000a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a430: 2020 2020 6966 2061 6273 2864 6973 745f      if abs(dist_
+0000a440: 6672 6f6d 5f63 6d70 2920 3c3d 2074 6872  from_cmp) <= thr
+0000a450: 6573 686f 6c64 5f70 6572 6365 6e74 3a20  eshold_percent: 
+0000a460: 2023 2043 6865 636b 2069 6620 6469 7374   # Check if dist
+0000a470: 5f66 726f 6d5f 636d 7020 6973 2077 6974  _from_cmp is wit
+0000a480: 6869 6e20 7468 7265 7368 6f6c 640a 2020  hin threshold.  
+0000a490: 2020 2320 2020 2020 2020 2020 2020 2020    #             
 0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4b0: 6966 2064 656d 616e 645f 7072 6f78 696d  if demand_proxim
-0000a4c0: 616c 5f6c 696e 6573 3a0a 2020 2020 2320  al_lines:.    # 
-0000a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4f0: 2020 2020 6669 6c65 2e77 7269 7465 2866      file.write(f
-0000a500: 225c 6e50 726f 7869 6d61 6c20 4c69 6e65  "\nProximal Line
-0000a510: 2050 7269 6365 3a20 7b64 656d 616e 645f   Price: {demand_
-0000a520: 7072 6f78 696d 616c 5f6c 696e 6573 5b69  proximal_lines[i
-0000a530: 5d3a 2e32 667d 2229 0a20 2020 2023 2020  ]:.2f}").    #  
-0000a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a550: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000a560: 6620 6465 6d61 6e64 5f64 6973 7461 6c5f  f demand_distal_
-0000a570: 6c69 6e65 733a 2020 2320 496e 636c 7564  lines:  # Includ
-0000a580: 6520 6469 7374 616c 206c 696e 6520 7072  e distal line pr
-0000a590: 6963 6520 6966 2061 7661 696c 6162 6c65  ice if available
-0000a5a0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5c0: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-0000a5d0: 7772 6974 6528 6622 5c6e 4469 7374 616c  write(f"\nDistal
-0000a5e0: 204c 696e 6520 5072 6963 653a 207b 6465   Line Price: {de
-0000a5f0: 6d61 6e64 5f64 6973 7461 6c5f 6c69 6e65  mand_distal_line
-0000a600: 735b 695d 3a2e 3266 7d22 290a 2020 2020  s[i]:.2f}").    
-0000a610: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0000a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a630: 2020 2320 496e 636c 7564 6520 7a6f 6e65    # Include zone
-0000a640: 2072 616e 6765 0a20 2020 2023 2020 2020   range.    #    
-0000a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a670: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
-0000a680: 5a6f 6e65 2052 616e 6765 3a20 7b64 656d  Zone Range: {dem
-0000a690: 616e 645f 7a6f 6e65 5f72 616e 6765 735b  and_zone_ranges[
-0000a6a0: 695d 3a2e 3266 7d22 290a 2020 2020 2320  i]:.2f}").    # 
+0000a4b0: 2020 2020 6669 6c65 2e77 7269 7465 2866      file.write(f
+0000a4c0: 225c 6e5c 6e5a 6f6e 6520 7b69 2b31 7d3a  "\n\nZone {i+1}:
+0000a4d0: 2053 7461 7274 2044 6174 653a 207b 6461   Start Date: {da
+0000a4e0: 7461 2e69 6e64 6578 5b73 7461 7274 5d2e  ta.index[start].
+0000a4f0: 6461 7465 2829 7d2c 2045 6e64 2044 6174  date()}, End Dat
+0000a500: 653a 207b 6461 7461 2e69 6e64 6578 5b65  e: {data.index[e
+0000a510: 6e64 5d2e 6461 7465 2829 7d22 290a 2020  nd].date()}").  
+0000a520: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a540: 2020 2020 6669 6c65 2e77 7269 7465 2866      file.write(f
+0000a550: 225c 6e50 6174 7465 726e 204e 616d 653a  "\nPattern Name:
+0000a560: 207b 7061 7474 6572 6e7d 2c20 4e75 6d62   {pattern}, Numb
+0000a570: 6572 206f 6620 4261 7365 2043 616e 646c  er of Base Candl
+0000a580: 653a 207b 6261 7365 5f63 6f75 6e74 7d22  e: {base_count}"
+0000a590: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
+0000a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5b0: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+0000a5c0: 7465 2866 225c 6e44 6973 7461 6e63 6520  te(f"\nDistance 
+0000a5d0: 6672 6f6d 2043 4d50 3a20 7b64 6973 745f  from CMP: {dist_
+0000a5e0: 6672 6f6d 5f63 6d70 3a2e 3266 7d25 2229  from_cmp:.2f}%")
+0000a5f0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a610: 2020 2020 2020 2069 6620 6465 6d61 6e64         if demand
+0000a620: 5f70 726f 7869 6d61 6c5f 6c69 6e65 733a  _proximal_lines:
+0000a630: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a650: 2020 2020 2020 2020 2020 2066 696c 652e             file.
+0000a660: 7772 6974 6528 6622 5c6e 5072 6f78 696d  write(f"\nProxim
+0000a670: 616c 204c 696e 6520 5072 6963 653a 207b  al Line Price: {
+0000a680: 6465 6d61 6e64 5f70 726f 7869 6d61 6c5f  demand_proximal_
+0000a690: 6c69 6e65 735b 695d 3a2e 3266 7d22 290a  lines[i]:.2f}").
+0000a6a0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
 0000a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6d0: 2320 4368 6563 6b20 6966 2070 726f 7869  # Check if proxi
-0000a6e0: 6d61 6c20 6c69 6e65 2069 7320 7465 7374  mal line is test
-0000a6f0: 6564 0a20 2020 2023 2020 2020 2020 2020  ed.    #        
-0000a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a710: 2020 2020 2020 2020 2074 6573 7465 6420           tested 
-0000a720: 3d20 6973 5f7a 6f6e 655f 7465 7374 6564  = is_zone_tested
-0000a730: 2864 6174 612c 2073 7461 7274 2c20 656e  (data, start, en
-0000a740: 642c 2064 656d 616e 645f 7072 6f78 696d  d, demand_proxim
-0000a750: 616c 5f6c 696e 6573 5b69 5d29 0a20 2020  al_lines[i]).   
-0000a760: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a780: 2020 2069 6620 7465 7374 6564 3a0a 2020     if tested:.  
-0000a790: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7b0: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
-0000a7c0: 7465 2822 5c6e 5a6f 6e65 2069 7320 5465  te("\nZone is Te
-0000a7d0: 7374 6564 2229 0a20 2020 2023 2020 2020  sted").    #    
-0000a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7f0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0000a800: 653a 0a20 2020 2023 2020 2020 2020 2020  e:.    #        
-0000a810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a820: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0000a830: 652e 7772 6974 6528 225c 6e46 7265 7368  e.write("\nFresh
-0000a840: 205a 6f6e 6522 290a 2020 2020 2320 2020   Zone").    #   
-0000a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a860: 2020 656c 7365 3a0a 2020 2020 2320 2020    else:.    #   
+0000a6c0: 2020 2020 2020 6966 2064 656d 616e 645f        if demand_
+0000a6d0: 6469 7374 616c 5f6c 696e 6573 3a20 2023  distal_lines:  #
+0000a6e0: 2049 6e63 6c75 6465 2064 6973 7461 6c20   Include distal 
+0000a6f0: 6c69 6e65 2070 7269 6365 2069 6620 6176  line price if av
+0000a700: 6169 6c61 626c 650a 2020 2020 2320 2020  ailable.    #   
+0000a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a730: 2020 6669 6c65 2e77 7269 7465 2866 225c    file.write(f"\
+0000a740: 6e44 6973 7461 6c20 4c69 6e65 2050 7269  nDistal Line Pri
+0000a750: 6365 3a20 7b64 656d 616e 645f 6469 7374  ce: {demand_dist
+0000a760: 616c 5f6c 696e 6573 5b69 5d3a 2e32 667d  al_lines[i]:.2f}
+0000a770: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
+0000a780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a790: 2020 2020 2020 2020 2023 2049 6e63 6c75           # Inclu
+0000a7a0: 6465 207a 6f6e 6520 7261 6e67 650a 2020  de zone range.  
+0000a7b0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7d0: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+0000a7e0: 7465 2866 225c 6e5a 6f6e 6520 5261 6e67  te(f"\nZone Rang
+0000a7f0: 653a 207b 6465 6d61 6e64 5f7a 6f6e 655f  e: {demand_zone_
+0000a800: 7261 6e67 6573 5b69 5d3a 2e32 667d 2229  ranges[i]:.2f}")
+0000a810: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a830: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
+0000a840: 6620 7072 6f78 696d 616c 206c 696e 6520  f proximal line 
+0000a850: 6973 2074 6573 7465 640a 2020 2020 2320  is tested.    # 
+0000a860: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a880: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
-0000a890: 2822 5c6e 4e6f 2064 656d 616e 6420 7a6f  ("\nNo demand zo
-0000a8a0: 6e65 2070 6174 7465 726e 7320 666f 756e  ne patterns foun
-0000a8b0: 642e 2229 0a0a 2020 2020 2320 2020 2020  d.")..    #     
-0000a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a8d0: 2320 5375 7070 6c79 205a 6f6e 6573 0a20  # Supply Zones. 
-0000a8e0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000a8f0: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-0000a900: 6974 6528 225c 6e5c 6e53 7570 706c 7920  ite("\n\nSupply 
-0000a910: 5a6f 6e65 733a 2229 0a20 2020 2023 2020  Zones:").    #  
-0000a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a930: 2020 2069 6620 7375 7070 6c79 5f7a 6f6e     if supply_zon
-0000a940: 6573 3a20 2023 2043 6865 636b 2069 6620  es:  # Check if 
-0000a950: 7375 7070 6c79 5f7a 6f6e 6573 2069 7320  supply_zones is 
-0000a960: 6e6f 7420 656d 7074 790a 2020 2020 2320  not empty.    # 
+0000a880: 7465 7374 6564 203d 2069 735f 7a6f 6e65  tested = is_zone
+0000a890: 5f74 6573 7465 6428 6461 7461 2c20 7374  _tested(data, st
+0000a8a0: 6172 742c 2065 6e64 2c20 6465 6d61 6e64  art, end, demand
+0000a8b0: 5f70 726f 7869 6d61 6c5f 6c69 6e65 735b  _proximal_lines[
+0000a8c0: 695d 290a 2020 2020 2320 2020 2020 2020  i]).    #       
+0000a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8e0: 2020 2020 2020 2020 2020 6966 2074 6573            if tes
+0000a8f0: 7465 643a 0a20 2020 2023 2020 2020 2020  ted:.    #      
+0000a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a910: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000a920: 696c 652e 7772 6974 6528 225c 6e5a 6f6e  ile.write("\nZon
+0000a930: 6520 6973 2054 6573 7465 6422 290a 2020  e is Tested").  
+0000a940: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a960: 2020 2020 656c 7365 3a0a 2020 2020 2320      else:.    # 
 0000a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a980: 2020 2020 2020 2020 666f 7220 692c 2028          for i, (
-0000a990: 7374 6172 742c 2065 6e64 2c20 7061 7474  start, end, patt
-0000a9a0: 6572 6e2c 2062 6173 655f 636f 756e 7429  ern, base_count)
-0000a9b0: 2069 6e20 656e 756d 6572 6174 6528 7375   in enumerate(su
-0000a9c0: 7070 6c79 5f7a 6f6e 6573 293a 0a20 2020  pply_zones):.   
-0000a9d0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000a9e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000a9f0: 6973 745f 6672 6f6d 5f63 6d70 203d 2061  ist_from_cmp = a
-0000aa00: 6273 2828 636d 7020 2d20 7375 7070 6c79  bs((cmp - supply
-0000aa10: 5f70 726f 7869 6d61 6c5f 6c69 6e65 735b  _proximal_lines[
-0000aa20: 695d 2920 2f20 636d 7029 202a 2031 3030  i]) / cmp) * 100
-0000aa30: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa50: 2020 2069 6620 6162 7328 6469 7374 5f66     if abs(dist_f
-0000aa60: 726f 6d5f 636d 7029 203c 3d20 7468 7265  rom_cmp) <= thre
-0000aa70: 7368 6f6c 645f 7065 7263 656e 743a 2020  shold_percent:  
-0000aa80: 2320 4368 6563 6b20 6966 2064 6973 745f  # Check if dist_
-0000aa90: 6672 6f6d 5f63 6d70 2069 7320 7769 7468  from_cmp is with
-0000aaa0: 696e 2074 6872 6573 686f 6c64 0a20 2020  in threshold.   
-0000aab0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aad0: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
-0000aae0: 5c6e 5c6e 5a6f 6e65 207b 692b 317d 3a20  \n\nZone {i+1}: 
-0000aaf0: 5374 6172 7420 4461 7465 3a20 7b64 6174  Start Date: {dat
-0000ab00: 612e 696e 6465 785b 7374 6172 745d 2e64  a.index[start].d
-0000ab10: 6174 6528 297d 2c20 456e 6420 4461 7465  ate()}, End Date
-0000ab20: 3a20 7b64 6174 612e 696e 6465 785b 656e  : {data.index[en
-0000ab30: 645d 2e64 6174 6528 297d 2229 0a20 2020  d].date()}").   
-0000ab40: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab60: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
-0000ab70: 5c6e 5061 7474 6572 6e20 4e61 6d65 3a20  \nPattern Name: 
-0000ab80: 7b70 6174 7465 726e 7d2c 204e 756d 6265  {pattern}, Numbe
-0000ab90: 7220 6f66 2042 6173 6520 4361 6e64 6c65  r of Base Candle
-0000aba0: 3a20 7b62 6173 655f 636f 756e 747d 2229  : {base_count}")
-0000abb0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000abd0: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-0000abe0: 6528 6622 5c6e 4469 7374 616e 6365 2066  e(f"\nDistance f
-0000abf0: 726f 6d20 434d 503a 207b 6469 7374 5f66  rom CMP: {dist_f
-0000ac00: 726f 6d5f 636d 703a 2e32 667d 2522 290a  rom_cmp:.2f}%").
-0000ac10: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a990: 2020 2020 6669 6c65 2e77 7269 7465 2822      file.write("
+0000a9a0: 5c6e 4672 6573 6820 5a6f 6e65 2229 0a20  \nFresh Zone"). 
+0000a9b0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000a9c0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000a9d0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000a9e0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000a9f0: 652e 7772 6974 6528 225c 6e4e 6f20 6465  e.write("\nNo de
+0000aa00: 6d61 6e64 207a 6f6e 6520 7061 7474 6572  mand zone patter
+0000aa10: 6e73 2066 6f75 6e64 2e22 290a 0a20 2020  ns found.")..   
+0000aa20: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000aa30: 2020 2020 2020 2023 2053 7570 706c 7920         # Supply 
+0000aa40: 5a6f 6e65 730a 2020 2020 2320 2020 2020  Zones.    #     
+0000aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa60: 6669 6c65 2e77 7269 7465 2822 5c6e 5c6e  file.write("\n\n
+0000aa70: 5375 7070 6c79 205a 6f6e 6573 3a22 290a  Supply Zones:").
+0000aa80: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000aa90: 2020 2020 2020 2020 2020 6966 2073 7570            if sup
+0000aaa0: 706c 795f 7a6f 6e65 733a 2020 2320 4368  ply_zones:  # Ch
+0000aab0: 6563 6b20 6966 2073 7570 706c 795f 7a6f  eck if supply_zo
+0000aac0: 6e65 7320 6973 206e 6f74 2065 6d70 7479  nes is not empty
+0000aad0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000aae0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000aaf0: 6f72 2069 2c20 2873 7461 7274 2c20 656e  or i, (start, en
+0000ab00: 642c 2070 6174 7465 726e 2c20 6261 7365  d, pattern, base
+0000ab10: 5f63 6f75 6e74 2920 696e 2065 6e75 6d65  _count) in enume
+0000ab20: 7261 7465 2873 7570 706c 795f 7a6f 6e65  rate(supply_zone
+0000ab30: 7329 3a0a 2020 2020 2320 2020 2020 2020  s):.    #       
+0000ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab50: 2020 2020 2020 6469 7374 5f66 726f 6d5f        dist_from_
+0000ab60: 636d 7020 3d20 6162 7328 2863 6d70 202d  cmp = abs((cmp -
+0000ab70: 2073 7570 706c 795f 7072 6f78 696d 616c   supply_proximal
+0000ab80: 5f6c 696e 6573 5b69 5d29 202f 2063 6d70  _lines[i]) / cmp
+0000ab90: 2920 2a20 3130 300a 2020 2020 2320 2020  ) * 100.    #   
+0000aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000abb0: 2020 2020 2020 2020 2020 6966 2061 6273            if abs
+0000abc0: 2864 6973 745f 6672 6f6d 5f63 6d70 2920  (dist_from_cmp) 
+0000abd0: 3c3d 2074 6872 6573 686f 6c64 5f70 6572  <= threshold_per
+0000abe0: 6365 6e74 3a20 2023 2043 6865 636b 2069  cent:  # Check i
+0000abf0: 6620 6469 7374 5f66 726f 6d5f 636d 7020  f dist_from_cmp 
+0000ac00: 6973 2077 6974 6869 6e20 7468 7265 7368  is within thresh
+0000ac10: 6f6c 640a 2020 2020 2320 2020 2020 2020  old.    #       
 0000ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac30: 2020 2020 2020 6966 2073 7570 706c 795f        if supply_
-0000ac40: 7072 6f78 696d 616c 5f6c 696e 6573 3a0a  proximal_lines:.
-0000ac50: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac70: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
-0000ac80: 7269 7465 2866 225c 6e50 726f 7869 6d61  rite(f"\nProxima
-0000ac90: 6c20 4c69 6e65 2050 7269 6365 3a20 7b73  l Line Price: {s
-0000aca0: 7570 706c 795f 7072 6f78 696d 616c 5f6c  upply_proximal_l
-0000acb0: 696e 6573 5b69 5d3a 2e32 667d 2229 0a20  ines[i]:.2f}"). 
-0000acc0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ace0: 2020 2020 2069 6620 7375 7070 6c79 5f64       if supply_d
-0000acf0: 6973 7461 6c5f 6c69 6e65 733a 2020 2320  istal_lines:  # 
-0000ad00: 496e 636c 7564 6520 6469 7374 616c 206c  Include distal l
-0000ad10: 696e 6520 7072 6963 6520 6966 2061 7661  ine price if ava
-0000ad20: 696c 6162 6c65 0a20 2020 2023 2020 2020  ilable.    #    
-0000ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad50: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
-0000ad60: 4469 7374 616c 204c 696e 6520 5072 6963  Distal Line Pric
-0000ad70: 653a 207b 7375 7070 6c79 5f64 6973 7461  e: {supply_dista
-0000ad80: 6c5f 6c69 6e65 735b 695d 3a2e 3266 7d22  l_lines[i]:.2f}"
-0000ad90: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
-0000ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adb0: 2020 2020 2020 2020 2320 496e 636c 7564          # Includ
-0000adc0: 6520 7a6f 6e65 2072 616e 6765 0a20 2020  e zone range.   
-0000add0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adf0: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-0000ae00: 6528 6622 5c6e 5a6f 6e65 2052 616e 6765  e(f"\nZone Range
-0000ae10: 3a20 7b73 7570 706c 795f 7a6f 6e65 5f72  : {supply_zone_r
-0000ae20: 616e 6765 735b 695d 3a2e 3266 7d22 290a  anges[i]:.2f}").
-0000ae30: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000ae40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae50: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-0000ae60: 2070 726f 7869 6d61 6c20 6c69 6e65 2069   proximal line i
-0000ae70: 7320 7465 7374 6564 0a20 2020 2023 2020  s tested.    #  
-0000ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000aea0: 6573 7465 6420 3d20 7365 6c66 2e69 735f  ested = self.is_
-0000aeb0: 7a6f 6e65 5f74 6573 7465 6428 6461 7461  zone_tested(data
-0000aec0: 2c20 7374 6172 742c 2065 6e64 2c20 7375  , start, end, su
-0000aed0: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
-0000aee0: 6e65 735b 695d 290a 2020 2020 2320 2020  nes[i]).    #   
-0000aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af00: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000af10: 2074 6573 7465 643a 0a20 2020 2023 2020   tested:.    #  
-0000af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af40: 2020 2066 696c 652e 7772 6974 6528 225c     file.write("\
-0000af50: 6e5a 6f6e 6520 6973 2054 6573 7465 6422  nZone is Tested"
-0000af60: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
-0000af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af80: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000af90: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000ac30: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
+0000ac40: 7269 7465 2866 225c 6e5c 6e5a 6f6e 6520  rite(f"\n\nZone 
+0000ac50: 7b69 2b31 7d3a 2053 7461 7274 2044 6174  {i+1}: Start Dat
+0000ac60: 653a 207b 6461 7461 2e69 6e64 6578 5b73  e: {data.index[s
+0000ac70: 7461 7274 5d2e 6461 7465 2829 7d2c 2045  tart].date()}, E
+0000ac80: 6e64 2044 6174 653a 207b 6461 7461 2e69  nd Date: {data.i
+0000ac90: 6e64 6578 5b65 6e64 5d2e 6461 7465 2829  ndex[end].date()
+0000aca0: 7d22 290a 2020 2020 2320 2020 2020 2020  }").    #       
+0000acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000acc0: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
+0000acd0: 7269 7465 2866 225c 6e50 6174 7465 726e  rite(f"\nPattern
+0000ace0: 204e 616d 653a 207b 7061 7474 6572 6e7d   Name: {pattern}
+0000acf0: 2c20 4e75 6d62 6572 206f 6620 4261 7365  , Number of Base
+0000ad00: 2043 616e 646c 653a 207b 6261 7365 5f63   Candle: {base_c
+0000ad10: 6f75 6e74 7d22 290a 2020 2020 2320 2020  ount}").    #   
+0000ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad30: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000ad40: 6c65 2e77 7269 7465 2866 225c 6e44 6973  le.write(f"\nDis
+0000ad50: 7461 6e63 6520 6672 6f6d 2043 4d50 3a20  tance from CMP: 
+0000ad60: 7b64 6973 745f 6672 6f6d 5f63 6d70 3a2e  {dist_from_cmp:.
+0000ad70: 3266 7d25 2229 0a20 2020 2023 2020 2020  2f}%").    #    
+0000ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000ada0: 7375 7070 6c79 5f70 726f 7869 6d61 6c5f  supply_proximal_
+0000adb0: 6c69 6e65 733a 0a20 2020 2023 2020 2020  lines:.    #    
+0000adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ade0: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
+0000adf0: 5072 6f78 696d 616c 204c 696e 6520 5072  Proximal Line Pr
+0000ae00: 6963 653a 207b 7375 7070 6c79 5f70 726f  ice: {supply_pro
+0000ae10: 7869 6d61 6c5f 6c69 6e65 735b 695d 3a2e  ximal_lines[i]:.
+0000ae20: 3266 7d22 290a 2020 2020 2320 2020 2020  2f}").    #     
+0000ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae40: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000ae50: 7570 706c 795f 6469 7374 616c 5f6c 696e  upply_distal_lin
+0000ae60: 6573 3a20 2023 2049 6e63 6c75 6465 2064  es:  # Include d
+0000ae70: 6973 7461 6c20 6c69 6e65 2070 7269 6365  istal line price
+0000ae80: 2069 6620 6176 6169 6c61 626c 650a 2020   if available.  
+0000ae90: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aeb0: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+0000aec0: 7465 2866 225c 6e44 6973 7461 6c20 4c69  te(f"\nDistal Li
+0000aed0: 6e65 2050 7269 6365 3a20 7b73 7570 706c  ne Price: {suppl
+0000aee0: 795f 6469 7374 616c 5f6c 696e 6573 5b69  y_distal_lines[i
+0000aef0: 5d3a 2e32 667d 2229 0a20 2020 2023 2020  ]:.2f}").    #  
+0000af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af10: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000af20: 2049 6e63 6c75 6465 207a 6f6e 6520 7261   Include zone ra
+0000af30: 6e67 650a 2020 2020 2320 2020 2020 2020  nge.    #       
+0000af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af50: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000af60: 6c65 2e77 7269 7465 2866 225c 6e5a 6f6e  le.write(f"\nZon
+0000af70: 6520 5261 6e67 653a 207b 7375 7070 6c79  e Range: {supply
+0000af80: 5f7a 6f6e 655f 7261 6e67 6573 5b69 5d3a  _zone_ranges[i]:
+0000af90: 2e32 667d 2229 0a20 2020 2023 2020 2020  .2f}").    #    
 0000afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afb0: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
-0000afc0: 7465 2822 5c6e 4672 6573 6820 5a6f 6e65  te("\nFresh Zone
-0000afd0: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
-0000afe0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0000aff0: 653a 0a20 2020 2023 2020 2020 2020 2020  e:.    #        
-0000b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b010: 2066 696c 652e 7772 6974 6528 225c 6e4e   file.write("\nN
-0000b020: 6f20 7375 7070 6c79 207a 6f6e 6520 7061  o supply zone pa
-0000b030: 7474 6572 6e73 2066 6f75 6e64 2e22 290a  tterns found.").
-0000b040: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000b050: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-0000b060: 7772 6974 6528 225c 6e5c 6e22 290a 2020  write("\n\n").  
-0000b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b080: 2020 0a20 2020 2023 2020 2020 2070 7269    .    #     pri
-0000b090: 6e74 2822 416e 616c 7973 6973 2063 6f6d  nt("Analysis com
-0000b0a0: 706c 6574 6564 2061 6e64 2072 6573 756c  pleted and resul
-0000b0b0: 7473 2073 6176 6564 2e22 290a 2020 2020  ts saved.").    
-0000b0c0: 2020 2020 0a20 2020 2023 2046 696e 6420      .    # Find 
-0000b0d0: 6163 6375 7261 7465 2062 7265 616b 6f75  accurate breakou
-0000b0e0: 7420 7661 6c75 650a 2020 2020 6465 6620  t value.    def 
-0000b0f0: 6669 6e64 4272 6561 6b69 6e67 6f75 744e  findBreakingoutN
-0000b100: 6f77 2873 656c 662c 2064 662c 2066 756c  ow(self, df, ful
-0000b110: 6c44 6174 612c 2073 6176 6544 6963 742c  lData, saveDict,
-0000b120: 2073 6372 6565 6e44 6963 7429 3a0a 2020   screenDict):.  
-0000b130: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
-0000b140: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
-0000b150: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0000b160: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-0000b170: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
-0000b180: 636f 7079 2829 0a20 2020 2020 2020 2072  copy().        r
-0000b190: 6576 6572 7365 6444 6174 6120 3d20 6675  eversedData = fu
-0000b1a0: 6c6c 4461 7461 5b3a 3a2d 315d 2e63 6f70  llData[::-1].cop
-0000b1b0: 7928 290a 2020 2020 2020 2020 6461 7461  y().        data
-0000b1c0: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
-0000b1d0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-0000b1e0: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
-0000b1f0: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
-0000b200: 2030 290a 2020 2020 2020 2020 7265 6365   0).        rece
-0000b210: 6e74 203d 2064 6174 612e 6865 6164 2831  nt = data.head(1
-0000b220: 290a 2020 2020 2020 2020 7265 6365 6e74  ).        recent
-0000b230: 4361 6e64 6c65 4865 6967 6874 203d 2073  CandleHeight = s
-0000b240: 656c 662e 6765 7443 616e 646c 6542 6f64  elf.getCandleBod
-0000b250: 7948 6569 6768 7428 7265 6365 6e74 290a  yHeight(recent).
-0000b260: 2020 2020 2020 2020 6966 206c 656e 2864          if len(d
-0000b270: 6174 6129 203c 2031 3120 6f72 2072 6563  ata) < 11 or rec
-0000b280: 656e 7443 616e 646c 6548 6569 6768 7420  entCandleHeight 
-0000b290: 3c3d 2030 3a0a 2020 2020 2020 2020 2020  <= 0:.          
-0000b2a0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-0000b2b0: 2020 2020 2020 2074 6f74 616c 4361 6e64         totalCand
-0000b2c0: 6c65 4865 6967 6874 203d 2030 0a20 2020  leHeight = 0.   
-0000b2d0: 2020 2020 2063 616e 646c 6520 3d20 300a       candle = 0.
-0000b2e0: 2020 2020 2020 2020 7768 696c 6520 6361          while ca
-0000b2f0: 6e64 6c65 203c 2031 303a 0a20 2020 2020  ndle < 10:.     
-0000b300: 2020 2020 2020 2063 616e 646c 6520 2b3d         candle +=
-0000b310: 2031 0a20 2020 2020 2020 2020 2020 2063   1.            c
-0000b320: 616e 646c 6548 6569 6768 7420 3d20 6162  andleHeight = ab
-0000b330: 7328 7365 6c66 2e67 6574 4361 6e64 6c65  s(self.getCandle
-0000b340: 426f 6479 4865 6967 6874 2864 6174 615b  BodyHeight(data[
-0000b350: 6361 6e64 6c65 3a5d 2929 0a20 2020 2020  candle:])).     
-0000b360: 2020 2020 2020 2074 6f74 616c 4361 6e64         totalCand
-0000b370: 6c65 4865 6967 6874 202b 3d20 6361 6e64  leHeight += cand
-0000b380: 6c65 4865 6967 6874 0a0a 2020 2020 2020  leHeight..      
-0000b390: 2020 7265 7665 7273 6564 4461 7461 2e6c    reversedData.l
-0000b3a0: 6f63 5b3a 2c27 4242 616e 6473 2d55 275d  oc[:,'BBands-U']
-0000b3b0: 2c20 7265 7665 7273 6564 4461 7461 2e6c  , reversedData.l
-0000b3c0: 6f63 5b3a 2c27 4242 616e 6473 2d4d 275d  oc[:,'BBands-M']
-0000b3d0: 2c20 7265 7665 7273 6564 4461 7461 2e6c  , reversedData.l
-0000b3e0: 6f63 5b3a 2c27 4242 616e 6473 2d4c 275d  oc[:,'BBands-L']
-0000b3f0: 203d 2070 6b74 616c 6962 2e42 4241 4e44   = pktalib.BBAND
-0000b400: 5328 7265 7665 7273 6564 4461 7461 5b22  S(reversedData["
-0000b410: 436c 6f73 6522 5d2c 2032 3029 0a20 2020  Close"], 20).   
-0000b420: 2020 2020 2072 6576 6572 7365 6444 6174       reversedDat
-0000b430: 6120 3d20 7265 7665 7273 6564 4461 7461  a = reversedData
-0000b440: 5b3a 3a2d 315d 0a20 2020 2020 2020 2072  [::-1].        r
-0000b450: 6563 656e 7473 203d 2072 6576 6572 7365  ecents = reverse
-0000b460: 6444 6174 612e 6865 6164 2836 290a 2020  dData.head(6).  
-0000b470: 2020 2020 2020 756c 7220 3d20 7365 6c66        ulr = self
-0000b480: 2e6e 6f6e 5f7a 6572 6f5f 7261 6e67 6528  .non_zero_range(
-0000b490: 7265 6365 6e74 732e 6c6f 635b 3a2c 2742  recents.loc[:,'B
-0000b4a0: 4261 6e64 732d 5527 5d2c 2072 6563 656e  Bands-U'], recen
-0000b4b0: 7473 2e6c 6f63 5b3a 2c27 4242 616e 6473  ts.loc[:,'BBands
-0000b4c0: 2d4c 275d 290a 2020 2020 2020 2020 6d61  -L']).        ma
-0000b4d0: 784f 664c 6173 7435 4361 6e64 6c65 7320  xOfLast5Candles 
-0000b4e0: 3d20 756c 722e 7461 696c 2835 292e 6d61  = ulr.tail(5).ma
-0000b4f0: 7828 290a 2020 2020 2020 2020 2320 6261  x().        # ba
-0000b500: 6e64 7769 6474 6820 3d20 3130 3020 2a20  ndwidth = 100 * 
-0000b510: 756c 7220 2f20 7265 6365 6e74 732e 6c6f  ulr / recents.lo
-0000b520: 635b 3a2c 2742 4261 6e64 732d 4d27 5d0a  c[:,'BBands-M'].
-0000b530: 2020 2020 2020 2020 2320 7065 7263 656e          # percen
-0000b540: 7420 3d20 7365 6c66 2e6e 6f6e 5f7a 6572  t = self.non_zer
-0000b550: 6f5f 7261 6e67 6528 7265 6365 6e74 732e  o_range(recents.
-0000b560: 6c6f 635b 3a2c 2743 6c6f 7365 275d 2c20  loc[:,'Close'], 
-0000b570: 7265 6365 6e74 732e 6c6f 635b 3a2c 2742  recents.loc[:,'B
-0000b580: 4261 6e64 732d 4c27 5d29 202f 2075 6c72  Bands-L']) / ulr
-0000b590: 0a20 2020 2020 2020 2073 6176 6544 6963  .        saveDic
-0000b5a0: 745b 2262 6261 6e64 735f 756c 725f 7261  t["bbands_ulr_ra
-0000b5b0: 7469 6f5f 6d61 7835 225d 203d 2072 6f75  tio_max5"] = rou
-0000b5c0: 6e64 2875 6c72 2e69 6c6f 635b 305d 2f6d  nd(ulr.iloc[0]/m
-0000b5d0: 6178 4f66 4c61 7374 3543 616e 646c 6573  axOfLast5Candles
-0000b5e0: 2c32 2920 2370 6572 6365 6e74 2e69 6c6f  ,2) #percent.ilo
-0000b5f0: 635b 305d 0a20 2020 2020 2020 2073 6372  c[0].        scr
-0000b600: 6565 6e44 6963 745b 2262 6261 6e64 735f  eenDict["bbands_
-0000b610: 756c 725f 7261 7469 6f5f 6d61 7835 225d  ulr_ratio_max5"]
-0000b620: 203d 2073 6176 6544 6963 745b 2262 6261   = saveDict["bba
-0000b630: 6e64 735f 756c 725f 7261 7469 6f5f 6d61  nds_ulr_ratio_ma
-0000b640: 7835 225d 0a20 2020 2020 2020 2023 2073  x5"].        # s
-0000b650: 6176 6544 6963 745b 2262 6261 6e64 735f  aveDict["bbands_
-0000b660: 6261 6e64 7769 6474 6822 5d20 3d20 6261  bandwidth"] = ba
-0000b670: 6e64 7769 6474 682e 696c 6f63 5b30 5d0a  ndwidth.iloc[0].
-0000b680: 2020 2020 2020 2020 2320 7363 7265 656e          # screen
-0000b690: 4469 6374 5b22 6262 616e 6473 5f62 616e  Dict["bbands_ban
-0000b6a0: 6477 6964 7468 225d 203d 2073 6176 6544  dwidth"] = saveD
-0000b6b0: 6963 745b 2262 6261 6e64 735f 6261 6e64  ict["bbands_band
-0000b6c0: 7769 6474 6822 5d0a 2020 2020 2020 2020  width"].        
-0000b6d0: 2320 7361 7665 4469 6374 5b22 6262 616e  # saveDict["bban
-0000b6e0: 6473 5f75 6c72 225d 203d 2075 6c72 2e69  ds_ulr"] = ulr.i
-0000b6f0: 6c6f 635b 305d 0a20 2020 2020 2020 2023  loc[0].        #
-0000b700: 2073 6372 6565 6e44 6963 745b 2262 6261   screenDict["bba
-0000b710: 6e64 735f 756c 7222 5d20 3d20 7361 7665  nds_ulr"] = save
-0000b720: 4469 6374 5b22 6262 616e 6473 5f75 6c72  Dict["bbands_ulr
-0000b730: 225d 0a0a 2020 2020 2020 2020 7265 7475  "]..        retu
-0000b740: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
-0000b750: 2072 6563 656e 7443 616e 646c 6548 6569   recentCandleHei
-0000b760: 6768 7420 3e20 300a 2020 2020 2020 2020  ght > 0.        
-0000b770: 2020 2020 616e 6420 746f 7461 6c43 616e      and totalCan
-0000b780: 646c 6548 6569 6768 7420 3e20 300a 2020  dleHeight > 0.  
-0000b790: 2020 2020 2020 2020 2020 616e 6420 2872            and (r
-0000b7a0: 6563 656e 7443 616e 646c 6548 6569 6768  ecentCandleHeigh
-0000b7b0: 7420 3e3d 2033 202a 2028 666c 6f61 7428  t >= 3 * (float(
-0000b7c0: 746f 7461 6c43 616e 646c 6548 6569 6768  totalCandleHeigh
-0000b7d0: 7420 2f20 6361 6e64 6c65 2929 290a 2020  t / candle))).  
-0000b7e0: 2020 2020 2020 290a 0a20 2020 2023 406d        )..    #@m
-0000b7f0: 6561 7375 7265 5f74 696d 650a 2020 2020  easure_time.    
-0000b800: 2320 4669 6e64 2061 6363 7572 6174 6520  # Find accurate 
-0000b810: 6272 6561 6b6f 7574 2076 616c 7565 0a20  breakout value. 
-0000b820: 2020 2064 6566 2066 696e 6442 7265 616b     def findBreak
-0000b830: 6f75 7456 616c 7565 280a 2020 2020 2020  outValue(.      
-0000b840: 2020 7365 6c66 2c20 6466 2c20 7363 7265    self, df, scre
-0000b850: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
-0000b860: 2c20 6461 7973 546f 4c6f 6f6b 6261 636b  , daysToLookback
-0000b870: 2c20 616c 7265 6164 7942 726f 6b65 6e6f  , alreadyBrokeno
-0000b880: 7574 3d46 616c 7365 0a20 2020 2029 3a0a  ut=False.    ):.
-0000b890: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-0000b8a0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-0000b8b0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0000b8c0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000b8d0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000b8e0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-0000b8f0: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
-0000b900: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
-0000b910: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
-0000b920: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
-0000b930: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
-0000b940: 2072 6563 656e 7420 3d20 6461 7461 2e68   recent = data.h
-0000b950: 6561 6428 3129 0a20 2020 2020 2020 2064  ead(1).        d
-0000b960: 6174 6120 3d20 6461 7461 5b31 3a5d 0a20  ata = data[1:]. 
-0000b970: 2020 2020 2020 206d 6178 4869 6768 203d         maxHigh =
-0000b980: 2072 6f75 6e64 2864 6174 612e 6465 7363   round(data.desc
-0000b990: 7269 6265 2829 5b22 4869 6768 225d 5b22  ribe()["High"]["
-0000b9a0: 6d61 7822 5d2c 2032 290a 2020 2020 2020  max"], 2).      
-0000b9b0: 2020 6d61 7843 6c6f 7365 203d 2072 6f75    maxClose = rou
-0000b9c0: 6e64 2864 6174 612e 6465 7363 7269 6265  nd(data.describe
-0000b9d0: 2829 5b22 436c 6f73 6522 5d5b 226d 6178  ()["Close"]["max
-0000b9e0: 225d 2c20 3229 0a20 2020 2020 2020 2072  "], 2).        r
-0000b9f0: 6563 656e 7443 6c6f 7365 203d 2072 6f75  ecentClose = rou
-0000ba00: 6e64 2872 6563 656e 745b 2243 6c6f 7365  nd(recent["Close
-0000ba10: 225d 2e69 6c6f 635b 305d 2c20 3229 0a20  "].iloc[0], 2). 
-0000ba20: 2020 2020 2020 2069 6620 6e70 2e69 736e         if np.isn
-0000ba30: 616e 286d 6178 436c 6f73 6529 206f 7220  an(maxClose) or 
-0000ba40: 6e70 2e69 736e 616e 286d 6178 4869 6768  np.isnan(maxHigh
-0000ba50: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000ba60: 6176 6544 6963 745b 2242 7265 616b 6f75  aveDict["Breakou
-0000ba70: 7422 5d20 3d20 2242 4f3a 2030 2052 3a20  t"] = "BO: 0 R: 
-0000ba80: 3022 0a20 2020 2020 2020 2020 2020 2073  0".            s
-0000ba90: 6372 6565 6e44 6963 745b 2242 7265 616b  creenDict["Break
-0000baa0: 6f75 7422 5d20 3d20 280a 2020 2020 2020  out"] = (.      
-0000bab0: 2020 2020 2020 2020 2020 636f 6c6f 7254            colorT
-0000bac0: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
-0000bad0: 5465 7874 2e57 4152 4e20 2b20 2242 4f3a  Text.WARN + "BO:
-0000bae0: 2030 2052 3a20 3022 202b 2063 6f6c 6f72   0 R: 0" + color
-0000baf0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-0000bb00: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000bb10: 2020 2023 2073 656c 662e 6465 6661 756c     # self.defaul
-0000bb20: 745f 6c6f 6767 6572 2e69 6e66 6f28 0a20  t_logger.info(. 
-0000bb30: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-0000bb40: 2066 2746 6f72 2053 746f 636b 3a7b 7361   f'For Stock:{sa
-0000bb50: 7665 4469 6374 5b22 5374 6f63 6b22 5d7d  veDict["Stock"]}
-0000bb60: 2c20 7468 6520 6272 6561 6b6f 7574 2069  , the breakout i
-0000bb70: 7320 756e 6b6e 6f77 6e20 6265 6361 7573  s unknown becaus
-0000bb80: 6520 6d61 782d 6869 6768 2028 7b6d 6178  e max-high ({max
-0000bb90: 4869 6768 7d29 206f 7220 6d61 782d 636c  High}) or max-cl
-0000bba0: 6f73 6520 287b 6d61 7843 6c6f 7365 7d29  ose ({maxClose})
-0000bbb0: 2061 7265 206e 6f74 2064 6566 696e 6564   are not defined
-0000bbc0: 2e27 0a20 2020 2020 2020 2020 2020 2023  .'.            #
-0000bbd0: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
-0000bbe0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-0000bbf0: 2020 2020 6966 206d 6178 4869 6768 203e      if maxHigh >
-0000bc00: 206d 6178 436c 6f73 653a 0a20 2020 2020   maxClose:.     
-0000bc10: 2020 2020 2020 2069 6620 286d 6178 4869         if (maxHi
-0000bc20: 6768 202d 206d 6178 436c 6f73 6529 203c  gh - maxClose) <
-0000bc30: 3d20 286d 6178 4869 6768 202a 2032 202f  = (maxHigh * 2 /
-0000bc40: 2031 3030 293a 0a20 2020 2020 2020 2020   100):.         
-0000bc50: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
-0000bc60: 2242 7265 616b 6f75 7422 5d20 3d20 2242  "Breakout"] = "B
-0000bc70: 4f3a 2022 202b 2073 7472 286d 6178 436c  O: " + str(maxCl
-0000bc80: 6f73 6529 202b 2022 2052 3a20 2220 2b20  ose) + " R: " + 
-0000bc90: 7374 7228 6d61 7848 6967 6829 0a20 2020  str(maxHigh).   
-0000bca0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000bcb0: 7265 6365 6e74 436c 6f73 6520 3e3d 206d  recentClose >= m
-0000bcc0: 6178 436c 6f73 653a 0a20 2020 2020 2020  axClose:.       
-0000bcd0: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-0000bce0: 6565 6e44 6963 745b 2242 7265 616b 6f75  eenDict["Breakou
-0000bcf0: 7422 5d20 3d20 280a 2020 2020 2020 2020  t"] = (.        
-0000bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd10: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
-0000bd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd30: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-0000bd40: 7874 2e47 5245 454e 0a20 2020 2020 2020  xt.GREEN.       
-0000bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd60: 202b 2022 424f 3a20 220a 2020 2020 2020   + "BO: ".      
-0000bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd80: 2020 2b20 7374 7228 6d61 7843 6c6f 7365    + str(maxClose
-0000bd90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000bda0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0000bdb0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-0000bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdd0: 2020 2b20 2863 6f6c 6f72 5465 7874 2e47    + (colorText.G
-0000bde0: 5245 454e 2069 6620 7265 6365 6e74 436c  REEN if recentCl
-0000bdf0: 6f73 6520 3e3d 206d 6178 4869 6768 2065  ose >= maxHigh e
-0000be00: 6c73 6520 636f 6c6f 7254 6578 742e 4641  lse colorText.FA
-0000be10: 494c 290a 2020 2020 2020 2020 2020 2020  IL).            
-0000be20: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-0000be30: 523a 2022 0a20 2020 2020 2020 2020 2020  R: ".           
-0000be40: 2020 2020 2020 2020 2020 2020 202b 2073               + s
-0000be50: 7472 286d 6178 4869 6768 290a 2020 2020  tr(maxHigh).    
+0000afb0: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+0000afc0: 6865 636b 2069 6620 7072 6f78 696d 616c  heck if proximal
+0000afd0: 206c 696e 6520 6973 2074 6573 7465 640a   line is tested.
+0000afe0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b000: 2020 2020 2020 7465 7374 6564 203d 2073        tested = s
+0000b010: 656c 662e 6973 5f7a 6f6e 655f 7465 7374  elf.is_zone_test
+0000b020: 6564 2864 6174 612c 2073 7461 7274 2c20  ed(data, start, 
+0000b030: 656e 642c 2073 7570 706c 795f 7072 6f78  end, supply_prox
+0000b040: 696d 616c 5f6c 696e 6573 5b69 5d29 0a20  imal_lines[i]). 
+0000b050: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b070: 2020 2020 2069 6620 7465 7374 6564 3a0a       if tested:.
+0000b080: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0a0: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
+0000b0b0: 7269 7465 2822 5c6e 5a6f 6e65 2069 7320  rite("\nZone is 
+0000b0c0: 5465 7374 6564 2229 0a20 2020 2023 2020  Tested").    #  
+0000b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000b0f0: 6c73 653a 0a20 2020 2023 2020 2020 2020  lse:.    #      
+0000b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b110: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000b120: 696c 652e 7772 6974 6528 225c 6e46 7265  ile.write("\nFre
+0000b130: 7368 205a 6f6e 6522 290a 2020 2020 2320  sh Zone").    # 
+0000b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b150: 2020 2020 656c 7365 3a0a 2020 2020 2320      else:.    # 
+0000b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b170: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+0000b180: 7465 2822 5c6e 4e6f 2073 7570 706c 7920  te("\nNo supply 
+0000b190: 7a6f 6e65 2070 6174 7465 726e 7320 666f  zone patterns fo
+0000b1a0: 756e 642e 2229 0a0a 2020 2020 2320 2020  und.")..    #   
+0000b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1c0: 2020 6669 6c65 2e77 7269 7465 2822 5c6e    file.write("\n
+0000b1d0: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+0000b1e0: 2020 2020 2020 2020 200a 2020 2020 2320           .    # 
+0000b1f0: 2020 2020 7072 696e 7428 2241 6e61 6c79      print("Analy
+0000b200: 7369 7320 636f 6d70 6c65 7465 6420 616e  sis completed an
+0000b210: 6420 7265 7375 6c74 7320 7361 7665 642e  d results saved.
+0000b220: 2229 0a20 2020 2020 2020 200a 2020 2020  ").        .    
+0000b230: 2320 4669 6e64 2061 6363 7572 6174 6520  # Find accurate 
+0000b240: 6272 6561 6b6f 7574 2076 616c 7565 0a20  breakout value. 
+0000b250: 2020 2064 6566 2066 696e 6442 7265 616b     def findBreak
+0000b260: 696e 676f 7574 4e6f 7728 7365 6c66 2c20  ingoutNow(self, 
+0000b270: 6466 2c20 6675 6c6c 4461 7461 2c20 7361  df, fullData, sa
+0000b280: 7665 4469 6374 2c20 7363 7265 656e 4469  veDict, screenDi
+0000b290: 6374 293a 0a20 2020 2020 2020 2069 6620  ct):.        if 
+0000b2a0: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
+0000b2b0: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
+0000b2c0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0000b2d0: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
+0000b2e0: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
+0000b2f0: 2020 2020 2020 7265 7665 7273 6564 4461        reversedDa
+0000b300: 7461 203d 2066 756c 6c44 6174 615b 3a3a  ta = fullData[::
+0000b310: 2d31 5d2e 636f 7079 2829 0a20 2020 2020  -1].copy().     
+0000b320: 2020 2064 6174 6120 3d20 6461 7461 2e66     data = data.f
+0000b330: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
+0000b340: 2064 6174 6120 3d20 6461 7461 2e72 6570   data = data.rep
+0000b350: 6c61 6365 285b 6e70 2e69 6e66 2c20 2d6e  lace([np.inf, -n
+0000b360: 702e 696e 665d 2c20 3029 0a20 2020 2020  p.inf], 0).     
+0000b370: 2020 2072 6563 656e 7420 3d20 6461 7461     recent = data
+0000b380: 2e68 6561 6428 3129 0a20 2020 2020 2020  .head(1).       
+0000b390: 2072 6563 656e 7443 616e 646c 6548 6569   recentCandleHei
+0000b3a0: 6768 7420 3d20 7365 6c66 2e67 6574 4361  ght = self.getCa
+0000b3b0: 6e64 6c65 426f 6479 4865 6967 6874 2872  ndleBodyHeight(r
+0000b3c0: 6563 656e 7429 0a20 2020 2020 2020 2069  ecent).        i
+0000b3d0: 6620 6c65 6e28 6461 7461 2920 3c20 3131  f len(data) < 11
+0000b3e0: 206f 7220 7265 6365 6e74 4361 6e64 6c65   or recentCandle
+0000b3f0: 4865 6967 6874 203c 3d20 303a 0a20 2020  Height <= 0:.   
+0000b400: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000b410: 4661 6c73 650a 2020 2020 2020 2020 746f  False.        to
+0000b420: 7461 6c43 616e 646c 6548 6569 6768 7420  talCandleHeight 
+0000b430: 3d20 300a 2020 2020 2020 2020 6361 6e64  = 0.        cand
+0000b440: 6c65 203d 2030 0a20 2020 2020 2020 2077  le = 0.        w
+0000b450: 6869 6c65 2063 616e 646c 6520 3c20 3130  hile candle < 10
+0000b460: 3a0a 2020 2020 2020 2020 2020 2020 6361  :.            ca
+0000b470: 6e64 6c65 202b 3d20 310a 2020 2020 2020  ndle += 1.      
+0000b480: 2020 2020 2020 6361 6e64 6c65 4865 6967        candleHeig
+0000b490: 6874 203d 2061 6273 2873 656c 662e 6765  ht = abs(self.ge
+0000b4a0: 7443 616e 646c 6542 6f64 7948 6569 6768  tCandleBodyHeigh
+0000b4b0: 7428 6461 7461 5b63 616e 646c 653a 5d29  t(data[candle:])
+0000b4c0: 290a 2020 2020 2020 2020 2020 2020 746f  ).            to
+0000b4d0: 7461 6c43 616e 646c 6548 6569 6768 7420  talCandleHeight 
+0000b4e0: 2b3d 2063 616e 646c 6548 6569 6768 740a  += candleHeight.
+0000b4f0: 0a20 2020 2020 2020 2072 6576 6572 7365  .        reverse
+0000b500: 6444 6174 612e 6c6f 635b 3a2c 2742 4261  dData.loc[:,'BBa
+0000b510: 6e64 732d 5527 5d2c 2072 6576 6572 7365  nds-U'], reverse
+0000b520: 6444 6174 612e 6c6f 635b 3a2c 2742 4261  dData.loc[:,'BBa
+0000b530: 6e64 732d 4d27 5d2c 2072 6576 6572 7365  nds-M'], reverse
+0000b540: 6444 6174 612e 6c6f 635b 3a2c 2742 4261  dData.loc[:,'BBa
+0000b550: 6e64 732d 4c27 5d20 3d20 706b 7461 6c69  nds-L'] = pktali
+0000b560: 622e 4242 414e 4453 2872 6576 6572 7365  b.BBANDS(reverse
+0000b570: 6444 6174 615b 2243 6c6f 7365 225d 2c20  dData["Close"], 
+0000b580: 3230 290a 2020 2020 2020 2020 7265 7665  20).        reve
+0000b590: 7273 6564 4461 7461 203d 2072 6576 6572  rsedData = rever
+0000b5a0: 7365 6444 6174 615b 3a3a 2d31 5d0a 2020  sedData[::-1].  
+0000b5b0: 2020 2020 2020 7265 6365 6e74 7320 3d20        recents = 
+0000b5c0: 7265 7665 7273 6564 4461 7461 2e68 6561  reversedData.hea
+0000b5d0: 6428 3629 0a20 2020 2020 2020 2075 6c72  d(6).        ulr
+0000b5e0: 203d 2073 656c 662e 6e6f 6e5f 7a65 726f   = self.non_zero
+0000b5f0: 5f72 616e 6765 2872 6563 656e 7473 2e6c  _range(recents.l
+0000b600: 6f63 5b3a 2c27 4242 616e 6473 2d55 275d  oc[:,'BBands-U']
+0000b610: 2c20 7265 6365 6e74 732e 6c6f 635b 3a2c  , recents.loc[:,
+0000b620: 2742 4261 6e64 732d 4c27 5d29 0a20 2020  'BBands-L']).   
+0000b630: 2020 2020 206d 6178 4f66 4c61 7374 3543       maxOfLast5C
+0000b640: 616e 646c 6573 203d 2075 6c72 2e74 6169  andles = ulr.tai
+0000b650: 6c28 3529 2e6d 6178 2829 0a20 2020 2020  l(5).max().     
+0000b660: 2020 2023 2062 616e 6477 6964 7468 203d     # bandwidth =
+0000b670: 2031 3030 202a 2075 6c72 202f 2072 6563   100 * ulr / rec
+0000b680: 656e 7473 2e6c 6f63 5b3a 2c27 4242 616e  ents.loc[:,'BBan
+0000b690: 6473 2d4d 275d 0a20 2020 2020 2020 2023  ds-M'].        #
+0000b6a0: 2070 6572 6365 6e74 203d 2073 656c 662e   percent = self.
+0000b6b0: 6e6f 6e5f 7a65 726f 5f72 616e 6765 2872  non_zero_range(r
+0000b6c0: 6563 656e 7473 2e6c 6f63 5b3a 2c27 436c  ecents.loc[:,'Cl
+0000b6d0: 6f73 6527 5d2c 2072 6563 656e 7473 2e6c  ose'], recents.l
+0000b6e0: 6f63 5b3a 2c27 4242 616e 6473 2d4c 275d  oc[:,'BBands-L']
+0000b6f0: 2920 2f20 756c 720a 2020 2020 2020 2020  ) / ulr.        
+0000b700: 7361 7665 4469 6374 5b22 6262 616e 6473  saveDict["bbands
+0000b710: 5f75 6c72 5f72 6174 696f 5f6d 6178 3522  _ulr_ratio_max5"
+0000b720: 5d20 3d20 726f 756e 6428 756c 722e 696c  ] = round(ulr.il
+0000b730: 6f63 5b30 5d2f 6d61 784f 664c 6173 7435  oc[0]/maxOfLast5
+0000b740: 4361 6e64 6c65 732c 3229 2023 7065 7263  Candles,2) #perc
+0000b750: 656e 742e 696c 6f63 5b30 5d0a 2020 2020  ent.iloc[0].    
+0000b760: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+0000b770: 6262 616e 6473 5f75 6c72 5f72 6174 696f  bbands_ulr_ratio
+0000b780: 5f6d 6178 3522 5d20 3d20 7361 7665 4469  _max5"] = saveDi
+0000b790: 6374 5b22 6262 616e 6473 5f75 6c72 5f72  ct["bbands_ulr_r
+0000b7a0: 6174 696f 5f6d 6178 3522 5d0a 2020 2020  atio_max5"].    
+0000b7b0: 2020 2020 2320 7361 7665 4469 6374 5b22      # saveDict["
+0000b7c0: 6262 616e 6473 5f62 616e 6477 6964 7468  bbands_bandwidth
+0000b7d0: 225d 203d 2062 616e 6477 6964 7468 2e69  "] = bandwidth.i
+0000b7e0: 6c6f 635b 305d 0a20 2020 2020 2020 2023  loc[0].        #
+0000b7f0: 2073 6372 6565 6e44 6963 745b 2262 6261   screenDict["bba
+0000b800: 6e64 735f 6261 6e64 7769 6474 6822 5d20  nds_bandwidth"] 
+0000b810: 3d20 7361 7665 4469 6374 5b22 6262 616e  = saveDict["bban
+0000b820: 6473 5f62 616e 6477 6964 7468 225d 0a20  ds_bandwidth"]. 
+0000b830: 2020 2020 2020 2023 2073 6176 6544 6963         # saveDic
+0000b840: 745b 2262 6261 6e64 735f 756c 7222 5d20  t["bbands_ulr"] 
+0000b850: 3d20 756c 722e 696c 6f63 5b30 5d0a 2020  = ulr.iloc[0].  
+0000b860: 2020 2020 2020 2320 7363 7265 656e 4469        # screenDi
+0000b870: 6374 5b22 6262 616e 6473 5f75 6c72 225d  ct["bbands_ulr"]
+0000b880: 203d 2073 6176 6544 6963 745b 2262 6261   = saveDict["bba
+0000b890: 6e64 735f 756c 7222 5d0a 0a20 2020 2020  nds_ulr"]..     
+0000b8a0: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
+0000b8b0: 2020 2020 2020 2020 7265 6365 6e74 4361          recentCa
+0000b8c0: 6e64 6c65 4865 6967 6874 203e 2030 0a20  ndleHeight > 0. 
+0000b8d0: 2020 2020 2020 2020 2020 2061 6e64 2074             and t
+0000b8e0: 6f74 616c 4361 6e64 6c65 4865 6967 6874  otalCandleHeight
+0000b8f0: 203e 2030 0a20 2020 2020 2020 2020 2020   > 0.           
+0000b900: 2061 6e64 2028 7265 6365 6e74 4361 6e64   and (recentCand
+0000b910: 6c65 4865 6967 6874 203e 3d20 3320 2a20  leHeight >= 3 * 
+0000b920: 2866 6c6f 6174 2874 6f74 616c 4361 6e64  (float(totalCand
+0000b930: 6c65 4865 6967 6874 202f 2063 616e 646c  leHeight / candl
+0000b940: 6529 2929 0a20 2020 2020 2020 2029 0a0a  e))).        )..
+0000b950: 2020 2020 2340 6d65 6173 7572 655f 7469      #@measure_ti
+0000b960: 6d65 0a20 2020 2023 2046 696e 6420 6163  me.    # Find ac
+0000b970: 6375 7261 7465 2062 7265 616b 6f75 7420  curate breakout 
+0000b980: 7661 6c75 650a 2020 2020 6465 6620 6669  value.    def fi
+0000b990: 6e64 4272 6561 6b6f 7574 5661 6c75 6528  ndBreakoutValue(
+0000b9a0: 0a20 2020 2020 2020 2073 656c 662c 2064  .        self, d
+0000b9b0: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
+0000b9c0: 6176 6544 6963 742c 2064 6179 7354 6f4c  aveDict, daysToL
+0000b9d0: 6f6f 6b62 6163 6b2c 2061 6c72 6561 6479  ookback, already
+0000b9e0: 4272 6f6b 656e 6f75 743d 4661 6c73 650a  Brokenout=False.
+0000b9f0: 2020 2020 293a 0a20 2020 2020 2020 2069      ):.        i
+0000ba00: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
+0000ba10: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
+0000ba20: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000ba30: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
+0000ba40: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
+0000ba50: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0000ba60: 6174 612e 6669 6c6c 6e61 2830 290a 2020  ata.fillna(0).  
+0000ba70: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0000ba80: 612e 7265 706c 6163 6528 5b6e 702e 696e  a.replace([np.in
+0000ba90: 662c 202d 6e70 2e69 6e66 5d2c 2030 290a  f, -np.inf], 0).
+0000baa0: 2020 2020 2020 2020 7265 6365 6e74 203d          recent =
+0000bab0: 2064 6174 612e 6865 6164 2831 290a 2020   data.head(1).  
+0000bac0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0000bad0: 615b 313a 5d0a 2020 2020 2020 2020 6d61  a[1:].        ma
+0000bae0: 7848 6967 6820 3d20 726f 756e 6428 6461  xHigh = round(da
+0000baf0: 7461 2e64 6573 6372 6962 6528 295b 2248  ta.describe()["H
+0000bb00: 6967 6822 5d5b 226d 6178 225d 2c20 3229  igh"]["max"], 2)
+0000bb10: 0a20 2020 2020 2020 206d 6178 436c 6f73  .        maxClos
+0000bb20: 6520 3d20 726f 756e 6428 6461 7461 2e64  e = round(data.d
+0000bb30: 6573 6372 6962 6528 295b 2243 6c6f 7365  escribe()["Close
+0000bb40: 225d 5b22 6d61 7822 5d2c 2032 290a 2020  "]["max"], 2).  
+0000bb50: 2020 2020 2020 7265 6365 6e74 436c 6f73        recentClos
+0000bb60: 6520 3d20 726f 756e 6428 7265 6365 6e74  e = round(recent
+0000bb70: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+0000bb80: 5d2c 2032 290a 2020 2020 2020 2020 6966  ], 2).        if
+0000bb90: 206e 702e 6973 6e61 6e28 6d61 7843 6c6f   np.isnan(maxClo
+0000bba0: 7365 2920 6f72 206e 702e 6973 6e61 6e28  se) or np.isnan(
+0000bbb0: 6d61 7848 6967 6829 3a0a 2020 2020 2020  maxHigh):.      
+0000bbc0: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+0000bbd0: 4272 6561 6b6f 7574 225d 203d 2022 424f  Breakout"] = "BO
+0000bbe0: 3a20 3020 523a 2030 220a 2020 2020 2020  : 0 R: 0".      
+0000bbf0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+0000bc00: 5b22 4272 6561 6b6f 7574 225d 203d 2028  ["Breakout"] = (
+0000bc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bc20: 2063 6f6c 6f72 5465 7874 2e42 4f4c 4420   colorText.BOLD 
+0000bc30: 2b20 636f 6c6f 7254 6578 742e 5741 524e  + colorText.WARN
+0000bc40: 202b 2022 424f 3a20 3020 523a 2030 2220   + "BO: 0 R: 0" 
+0000bc50: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+0000bc60: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000bc70: 2020 2020 2020 2020 2020 2320 7365 6c66            # self
+0000bc80: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
+0000bc90: 696e 666f 280a 2020 2020 2020 2020 2020  info(.          
+0000bca0: 2020 2320 2020 2020 6627 466f 7220 5374    #     f'For St
+0000bcb0: 6f63 6b3a 7b73 6176 6544 6963 745b 2253  ock:{saveDict["S
+0000bcc0: 746f 636b 225d 7d2c 2074 6865 2062 7265  tock"]}, the bre
+0000bcd0: 616b 6f75 7420 6973 2075 6e6b 6e6f 776e  akout is unknown
+0000bce0: 2062 6563 6175 7365 206d 6178 2d68 6967   because max-hig
+0000bcf0: 6820 287b 6d61 7848 6967 687d 2920 6f72  h ({maxHigh}) or
+0000bd00: 206d 6178 2d63 6c6f 7365 2028 7b6d 6178   max-close ({max
+0000bd10: 436c 6f73 657d 2920 6172 6520 6e6f 7420  Close}) are not 
+0000bd20: 6465 6669 6e65 642e 270a 2020 2020 2020  defined.'.      
+0000bd30: 2020 2020 2020 2320 290a 2020 2020 2020        # ).      
+0000bd40: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0000bd50: 7365 0a20 2020 2020 2020 2069 6620 6d61  se.        if ma
+0000bd60: 7848 6967 6820 3e20 6d61 7843 6c6f 7365  xHigh > maxClose
+0000bd70: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000bd80: 2028 6d61 7848 6967 6820 2d20 6d61 7843   (maxHigh - maxC
+0000bd90: 6c6f 7365 2920 3c3d 2028 6d61 7848 6967  lose) <= (maxHig
+0000bda0: 6820 2a20 3220 2f20 3130 3029 3a0a 2020  h * 2 / 100):.  
+0000bdb0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+0000bdc0: 7665 4469 6374 5b22 4272 6561 6b6f 7574  veDict["Breakout
+0000bdd0: 225d 203d 2022 424f 3a20 2220 2b20 7374  "] = "BO: " + st
+0000bde0: 7228 6d61 7843 6c6f 7365 2920 2b20 2220  r(maxClose) + " 
+0000bdf0: 523a 2022 202b 2073 7472 286d 6178 4869  R: " + str(maxHi
+0000be00: 6768 290a 2020 2020 2020 2020 2020 2020  gh).            
+0000be10: 2020 2020 6966 2072 6563 656e 7443 6c6f      if recentClo
+0000be20: 7365 203e 3d20 6d61 7843 6c6f 7365 3a0a  se >= maxClose:.
+0000be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be40: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+0000be50: 4272 6561 6b6f 7574 225d 203d 2028 0a20  Breakout"] = (. 
 0000be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be70: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-0000be80: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-0000be90: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000bea0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000beb0: 7365 6c66 2e64 6566 6175 6c74 5f6c 6f67  self.default_log
-0000bec0: 6765 722e 696e 666f 280a 2020 2020 2020  ger.info(.      
-0000bed0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000bee0: 2020 2020 6627 5374 6f63 6b3a 7b73 6176      f'Stock:{sav
-0000bef0: 6544 6963 745b 2253 746f 636b 225d 7d2c  eDict["Stock"]},
-0000bf00: 2068 6173 2061 2062 7265 616b 6f75 7420   has a breakout 
-0000bf10: 6265 6361 7573 6520 6d61 782d 6869 6768  because max-high
-0000bf20: 2028 7b6d 6178 4869 6768 7d29 203e 3d20   ({maxHigh}) >= 
-0000bf30: 6d61 782d 636c 6f73 6520 287b 6d61 7843  max-close ({maxC
-0000bf40: 6c6f 7365 7d29 270a 2020 2020 2020 2020  lose})'.        
-0000bf50: 2020 2020 2020 2020 2020 2020 2320 290a              # ).
-0000bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf70: 2020 2020 7265 7475 726e 2054 7275 6520      return True 
-0000bf80: 616e 6420 616c 7265 6164 7942 726f 6b65  and alreadyBroke
-0000bf90: 6e6f 7574 2061 6e64 2073 656c 662e 6765  nout and self.ge
-0000bfa0: 7443 616e 646c 6554 7970 6528 7265 6365  tCandleType(rece
-0000bfb0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
-0000bfc0: 2020 2020 2320 7365 6c66 2e64 6566 6175      # self.defau
-0000bfd0: 6c74 5f6c 6f67 6765 722e 696e 666f 280a  lt_logger.info(.
-0000bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bff0: 2320 2020 2020 6627 5374 6f63 6b3a 7b73  #     f'Stock:{s
-0000c000: 6176 6544 6963 745b 2253 746f 636b 225d  aveDict["Stock"]
-0000c010: 7d2c 2064 6f65 7320 6e6f 7420 6861 7665  }, does not have
-0000c020: 2061 2062 7265 616b 6f75 7420 7965 7420   a breakout yet 
-0000c030: 6265 6361 7573 6520 6d61 782d 6869 6768  because max-high
-0000c040: 2028 7b6d 6178 4869 6768 7d29 203c 206d   ({maxHigh}) < m
-0000c050: 6178 2d63 6c6f 7365 2028 7b6d 6178 436c  ax-close ({maxCl
-0000c060: 6f73 657d 2927 0a20 2020 2020 2020 2020  ose})'.         
-0000c070: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
-0000c080: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0000c090: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
-0000c0a0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-0000c0b0: 2020 2020 2020 2020 2020 636f 6c6f 7254            colorT
-0000c0c0: 6578 742e 424f 4c44 0a20 2020 2020 2020  ext.BOLD.       
-0000c0d0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0000c0e0: 6f6c 6f72 5465 7874 2e46 4149 4c0a 2020  olorText.FAIL.  
-0000c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c100: 2020 2b20 2242 4f3a 2022 0a20 2020 2020    + "BO: ".     
-0000c110: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000c120: 2073 7472 286d 6178 436c 6f73 6529 0a20   str(maxClose). 
-0000c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c140: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
-0000c150: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
-0000c160: 2020 2020 2020 202b 2028 636f 6c6f 7254         + (colorT
-0000c170: 6578 742e 4752 4545 4e20 6966 2072 6563  ext.GREEN if rec
-0000c180: 656e 7443 6c6f 7365 203e 3d20 6d61 7848  entClose >= maxH
-0000c190: 6967 6820 656c 7365 2063 6f6c 6f72 5465  igh else colorTe
-0000c1a0: 7874 2e46 4149 4c29 0a20 2020 2020 2020  xt.FAIL).       
-0000c1b0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-0000c1c0: 2052 3a20 220a 2020 2020 2020 2020 2020   R: ".          
-0000c1d0: 2020 2020 2020 2020 2020 2b20 7374 7228            + str(
-0000c1e0: 6d61 7848 6967 6829 0a20 2020 2020 2020  maxHigh).       
-0000c1f0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0000c200: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-0000c210: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000c220: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000c230: 6574 7572 6e20 6e6f 7420 616c 7265 6164  eturn not alread
-0000c240: 7942 726f 6b65 6e6f 7574 0a20 2020 2020  yBrokenout.     
-0000c250: 2020 2020 2020 206e 6f4f 6648 6967 6865         noOfHighe
-0000c260: 7253 6861 646f 7773 203d 206c 656e 2864  rShadows = len(d
-0000c270: 6174 615b 6461 7461 2e48 6967 6820 3e20  ata[data.High > 
-0000c280: 6d61 7843 6c6f 7365 5d29 0a20 2020 2020  maxClose]).     
-0000c290: 2020 2020 2020 2069 6620 6461 7973 546f         if daysTo
-0000c2a0: 4c6f 6f6b 6261 636b 202f 206e 6f4f 6648  Lookback / noOfH
-0000c2b0: 6967 6865 7253 6861 646f 7773 203c 3d20  igherShadows <= 
-0000c2c0: 333a 0a20 2020 2020 2020 2020 2020 2020  3:.             
-0000c2d0: 2020 2073 6176 6544 6963 745b 2242 7265     saveDict["Bre
-0000c2e0: 616b 6f75 7422 5d20 3d20 2242 4f3a 2022  akout"] = "BO: "
-0000c2f0: 202b 2073 7472 286d 6178 4869 6768 2920   + str(maxHigh) 
-0000c300: 2b20 2220 523a 2030 220a 2020 2020 2020  + " R: 0".      
-0000c310: 2020 2020 2020 2020 2020 6966 2072 6563            if rec
-0000c320: 656e 7443 6c6f 7365 203e 3d20 6d61 7848  entClose >= maxH
-0000c330: 6967 683a 0a20 2020 2020 2020 2020 2020  igh:.           
-0000c340: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-0000c350: 6963 745b 2242 7265 616b 6f75 7422 5d20  ict["Breakout"] 
-0000c360: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0000c370: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-0000c380: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
-0000c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3a0: 2020 202b 2063 6f6c 6f72 5465 7874 2e47     + colorText.G
-0000c3b0: 5245 454e 0a20 2020 2020 2020 2020 2020  REEN.           
-0000c3c0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-0000c3d0: 424f 3a20 220a 2020 2020 2020 2020 2020  BO: ".          
-0000c3e0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000c3f0: 7374 7228 6d61 7848 6967 6829 0a20 2020  str(maxHigh).   
-0000c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c410: 2020 2020 202b 2022 2052 3a20 3022 0a20       + " R: 0". 
-0000c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c430: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-0000c440: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-0000c450: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000c460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c470: 2023 2073 656c 662e 6465 6661 756c 745f   # self.default_
-0000c480: 6c6f 6767 6572 2e69 6e66 6f28 0a20 2020  logger.info(.   
-0000c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4a0: 2023 2020 2020 2066 2753 746f 636b 3a7b   #     f'Stock:{
-0000c4b0: 7361 7665 4469 6374 5b22 5374 6f63 6b22  saveDict["Stock"
-0000c4c0: 5d7d 2c20 6861 7320 6120 6272 6561 6b6f  ]}, has a breako
-0000c4d0: 7574 2062 6563 6175 7365 2072 6563 656e  ut because recen
-0000c4e0: 742d 636c 6f73 6520 287b 7265 6365 6e74  t-close ({recent
-0000c4f0: 436c 6f73 657d 2920 3e3d 206d 6178 2d68  Close}) >= max-h
-0000c500: 6967 6820 287b 6d61 7848 6967 687d 2927  igh ({maxHigh})'
-0000c510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c520: 2020 2020 2023 2029 0a20 2020 2020 2020       # ).       
-0000c530: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000c540: 7572 6e20 5472 7565 2061 6e64 2061 6c72  urn True and alr
-0000c550: 6561 6479 4272 6f6b 656e 6f75 7420 616e  eadyBrokenout an
-0000c560: 6420 7365 6c66 2e67 6574 4361 6e64 6c65  d self.getCandle
-0000c570: 5479 7065 2872 6563 656e 7429 0a20 2020  Type(recent).   
-0000c580: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-0000c590: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
-0000c5a0: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
-0000c5b0: 2020 2020 2020 2020 2023 2020 2020 2066           #     f
-0000c5c0: 2753 746f 636b 3a7b 7361 7665 4469 6374  'Stock:{saveDict
-0000c5d0: 5b22 5374 6f63 6b22 5d7d 2c20 646f 6573  ["Stock"]}, does
-0000c5e0: 206e 6f74 2068 6176 6520 6120 6272 6561   not have a brea
-0000c5f0: 6b6f 7574 2079 6574 2062 6563 6175 7365  kout yet because
-0000c600: 2072 6563 656e 742d 636c 6f73 6520 287b   recent-close ({
-0000c610: 7265 6365 6e74 436c 6f73 657d 2920 3c20  recentClose}) < 
-0000c620: 6d61 782d 6869 6768 2028 7b6d 6178 4869  max-high ({maxHi
-0000c630: 6768 7d29 270a 2020 2020 2020 2020 2020  gh})'.          
-0000c640: 2020 2020 2020 2320 290a 2020 2020 2020        # ).      
-0000c650: 2020 2020 2020 2020 2020 7363 7265 656e            screen
-0000c660: 4469 6374 5b22 4272 6561 6b6f 7574 225d  Dict["Breakout"]
-0000c670: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-0000c680: 2020 2020 2020 2020 2063 6f6c 6f72 5465           colorTe
-0000c690: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
-0000c6a0: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
-0000c6b0: 6c6f 7254 6578 742e 4641 494c 0a20 2020  lorText.FAIL.   
-0000c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c6d0: 202b 2022 424f 3a20 220a 2020 2020 2020   + "BO: ".      
-0000c6e0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000c6f0: 7374 7228 6d61 7848 6967 6829 0a20 2020  str(maxHigh).   
-0000c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c710: 202b 2022 2052 3a20 3022 0a20 2020 2020   + " R: 0".     
-0000c720: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000c730: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0000c740: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000c750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c760: 2072 6574 7572 6e20 6e6f 7420 616c 7265   return not alre
-0000c770: 6164 7942 726f 6b65 6e6f 7574 0a20 2020  adyBrokenout.   
-0000c780: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-0000c790: 745b 2242 7265 616b 6f75 7422 5d20 3d20  t["Breakout"] = 
-0000c7a0: 2242 4f3a 2022 202b 2073 7472 286d 6178  "BO: " + str(max
-0000c7b0: 436c 6f73 6529 202b 2022 2052 3a20 2220  Close) + " R: " 
-0000c7c0: 2b20 7374 7228 6d61 7848 6967 6829 0a20  + str(maxHigh). 
-0000c7d0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0000c7e0: 6365 6e74 436c 6f73 6520 3e3d 206d 6178  centClose >= max
-0000c7f0: 436c 6f73 653a 0a20 2020 2020 2020 2020  Close:.         
-0000c800: 2020 2020 2020 2023 2073 656c 662e 6465         # self.de
-0000c810: 6661 756c 745f 6c6f 6767 6572 2e69 6e66  fault_logger.inf
-0000c820: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
-0000c830: 2020 2023 2020 2020 2066 2753 746f 636b     #     f'Stock
-0000c840: 3a7b 7361 7665 4469 6374 5b22 5374 6f63  :{saveDict["Stoc
-0000c850: 6b22 5d7d 2c20 6861 7320 6120 6272 6561  k"]}, has a brea
-0000c860: 6b6f 7574 2062 6563 6175 7365 2072 6563  kout because rec
-0000c870: 656e 742d 636c 6f73 6520 287b 7265 6365  ent-close ({rece
-0000c880: 6e74 436c 6f73 657d 2920 3e3d 206d 6178  ntClose}) >= max
-0000c890: 2d63 6c6f 7365 2028 7b6d 6178 436c 6f73  -close ({maxClos
-0000c8a0: 657d 2927 0a20 2020 2020 2020 2020 2020  e})'.           
-0000c8b0: 2020 2020 2023 2029 0a20 2020 2020 2020       # ).       
-0000c8c0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-0000c8d0: 6963 745b 2242 7265 616b 6f75 7422 5d20  ict["Breakout"] 
-0000c8e0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0000c8f0: 2020 2020 2020 2020 636f 6c6f 7254 6578          colorTex
-0000c900: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
-0000c910: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
-0000c920: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
-0000c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c940: 202b 2022 424f 3a20 220a 2020 2020 2020   + "BO: ".      
-0000c950: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000c960: 7374 7228 6d61 7843 6c6f 7365 290a 2020  str(maxClose).  
-0000c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c980: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-0000c990: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-0000c9a0: 2020 2020 2020 2b20 2863 6f6c 6f72 5465        + (colorTe
-0000c9b0: 7874 2e47 5245 454e 2069 6620 7265 6365  xt.GREEN if rece
-0000c9c0: 6e74 436c 6f73 6520 3e3d 206d 6178 4869  ntClose >= maxHi
-0000c9d0: 6768 2065 6c73 6520 636f 6c6f 7254 6578  gh else colorTex
-0000c9e0: 742e 4641 494c 290a 2020 2020 2020 2020  t.FAIL).        
-0000c9f0: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-0000ca00: 523a 2022 0a20 2020 2020 2020 2020 2020  R: ".           
-0000ca10: 2020 2020 2020 2020 202b 2073 7472 286d           + str(m
-0000ca20: 6178 4869 6768 290a 2020 2020 2020 2020  axHigh).        
-0000ca30: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
-0000ca40: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
-0000ca50: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000ca60: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000ca70: 7475 726e 2054 7275 6520 616e 6420 616c  turn True and al
-0000ca80: 7265 6164 7942 726f 6b65 6e6f 7574 2061  readyBrokenout a
-0000ca90: 6e64 2073 656c 662e 6765 7443 616e 646c  nd self.getCandl
-0000caa0: 6554 7970 6528 7265 6365 6e74 290a 2020  eType(recent).  
-0000cab0: 2020 2020 2020 2020 2020 2320 7365 6c66            # self
-0000cac0: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
-0000cad0: 696e 666f 280a 2020 2020 2020 2020 2020  info(.          
-0000cae0: 2020 2320 2020 2020 6627 5374 6f63 6b3a    #     f'Stock:
-0000caf0: 7b73 6176 6544 6963 745b 2253 746f 636b  {saveDict["Stock
-0000cb00: 225d 7d2c 2064 6f65 7320 6e6f 7420 6861  "]}, does not ha
-0000cb10: 7665 2061 2062 7265 616b 6f75 7420 7965  ve a breakout ye
-0000cb20: 7420 6265 6361 7573 6520 7265 6365 6e74  t because recent
-0000cb30: 2d63 6c6f 7365 2028 7b72 6563 656e 7443  -close ({recentC
-0000cb40: 6c6f 7365 7d29 203c 206d 6178 2d68 6967  lose}) < max-hig
-0000cb50: 6820 287b 6d61 7848 6967 687d 2927 0a20  h ({maxHigh})'. 
-0000cb60: 2020 2020 2020 2020 2020 2023 2029 0a20             # ). 
-0000cb70: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0000cb80: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
-0000cb90: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-0000cba0: 2020 2020 2020 636f 6c6f 7254 6578 742e        colorText.
-0000cbb0: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
-0000cbc0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-0000cbd0: 2e46 4149 4c0a 2020 2020 2020 2020 2020  .FAIL.          
-0000cbe0: 2020 2020 2020 2b20 2242 4f3a 2022 0a20        + "BO: ". 
-0000cbf0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000cc00: 2073 7472 286d 6178 436c 6f73 6529 0a20   str(maxClose). 
-0000cc10: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000cc20: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0000cc30: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000cc40: 2028 636f 6c6f 7254 6578 742e 4752 4545   (colorText.GREE
-0000cc50: 4e20 6966 2072 6563 656e 7443 6c6f 7365  N if recentClose
-0000cc60: 203e 3d20 6d61 7848 6967 6820 656c 7365   >= maxHigh else
-0000cc70: 2063 6f6c 6f72 5465 7874 2e46 4149 4c29   colorText.FAIL)
-0000cc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cc90: 202b 2022 2052 3a20 220a 2020 2020 2020   + " R: ".      
-0000cca0: 2020 2020 2020 2020 2020 2b20 7374 7228            + str(
-0000ccb0: 6d61 7848 6967 6829 0a20 2020 2020 2020  maxHigh).       
-0000ccc0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-0000ccd0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-0000cce0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000ccf0: 2020 2072 6574 7572 6e20 6e6f 7420 616c     return not al
-0000cd00: 7265 6164 7942 726f 6b65 6e6f 7574 0a20  readyBrokenout. 
-0000cd10: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000cd20: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-0000cd30: 745b 2242 7265 616b 6f75 7422 5d20 3d20  t["Breakout"] = 
-0000cd40: 2242 4f3a 2022 202b 2073 7472 286d 6178  "BO: " + str(max
-0000cd50: 436c 6f73 6529 202b 2022 2052 3a20 3022  Close) + " R: 0"
-0000cd60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000cd70: 7265 6365 6e74 436c 6f73 6520 3e3d 206d  recentClose >= m
-0000cd80: 6178 436c 6f73 653a 0a20 2020 2020 2020  axClose:.       
-0000cd90: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
-0000cda0: 6465 6661 756c 745f 6c6f 6767 6572 2e69  default_logger.i
-0000cdb0: 6e66 6f28 0a20 2020 2020 2020 2020 2020  nfo(.           
-0000cdc0: 2020 2020 2023 2020 2020 2066 2753 746f       #     f'Sto
-0000cdd0: 636b 3a7b 7361 7665 4469 6374 5b22 5374  ck:{saveDict["St
-0000cde0: 6f63 6b22 5d7d 2c20 6861 7320 6120 6272  ock"]}, has a br
-0000cdf0: 6561 6b6f 7574 2062 6563 6175 7365 2072  eakout because r
-0000ce00: 6563 656e 742d 636c 6f73 6520 287b 7265  ecent-close ({re
-0000ce10: 6365 6e74 436c 6f73 657d 2920 3e3d 206d  centClose}) >= m
-0000ce20: 6178 2d63 6c6f 7365 2028 7b6d 6178 436c  ax-close ({maxCl
-0000ce30: 6f73 657d 2927 0a20 2020 2020 2020 2020  ose})'.         
-0000ce40: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
-0000ce50: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0000ce60: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
-0000ce70: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-0000ce80: 2020 2020 2020 2020 2020 636f 6c6f 7254            colorT
-0000ce90: 6578 742e 424f 4c44 0a20 2020 2020 2020  ext.BOLD.       
-0000cea0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0000ceb0: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
-0000cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ced0: 2020 202b 2022 424f 3a20 220a 2020 2020     + "BO: ".    
-0000cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cef0: 2b20 7374 7228 6d61 7843 6c6f 7365 290a  + str(maxClose).
-0000cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf10: 2020 2020 2b20 2220 523a 2030 220a 2020      + " R: 0".  
-0000cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf30: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-0000cf40: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-0000cf50: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000cf60: 2020 2020 7265 7475 726e 2054 7275 6520      return True 
-0000cf70: 616e 6420 616c 7265 6164 7942 726f 6b65  and alreadyBroke
-0000cf80: 6e6f 7574 2061 6e64 2073 656c 662e 6765  nout and self.ge
-0000cf90: 7443 616e 646c 6554 7970 6528 7265 6365  tCandleType(rece
-0000cfa0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
-0000cfb0: 2320 7365 6c66 2e64 6566 6175 6c74 5f6c  # self.default_l
-0000cfc0: 6f67 6765 722e 696e 666f 280a 2020 2020  ogger.info(.    
-0000cfd0: 2020 2020 2020 2020 2320 2020 2020 6627          #     f'
-0000cfe0: 5374 6f63 6b3a 7b73 6176 6544 6963 745b  Stock:{saveDict[
-0000cff0: 2253 746f 636b 225d 7d2c 2068 6173 2061  "Stock"]}, has a
-0000d000: 2062 7265 616b 6f75 7420 6265 6361 7573   breakout becaus
-0000d010: 6520 7265 6365 6e74 2d63 6c6f 7365 2028  e recent-close (
-0000d020: 7b72 6563 656e 7443 6c6f 7365 7d29 203c  {recentClose}) <
-0000d030: 206d 6178 2d63 6c6f 7365 2028 7b6d 6178   max-close ({max
-0000d040: 436c 6f73 657d 2927 0a20 2020 2020 2020  Close})'.       
-0000d050: 2020 2020 2023 2029 0a20 2020 2020 2020       # ).       
-0000d060: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-0000d070: 2242 7265 616b 6f75 7422 5d20 3d20 280a  "Breakout"] = (.
-0000d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d090: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
-0000d0a0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000d0b0: 2063 6f6c 6f72 5465 7874 2e46 4149 4c0a   colorText.FAIL.
-0000d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0d0: 2b20 2242 4f3a 2022 0a20 2020 2020 2020  + "BO: ".       
-0000d0e0: 2020 2020 2020 2020 202b 2073 7472 286d           + str(m
-0000d0f0: 6178 436c 6f73 6529 0a20 2020 2020 2020  axClose).       
-0000d100: 2020 2020 2020 2020 202b 2022 2052 3a20           + " R: 
-0000d110: 3022 0a20 2020 2020 2020 2020 2020 2020  0".             
-0000d120: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
-0000d130: 4e44 0a20 2020 2020 2020 2020 2020 2029  ND.            )
-0000d140: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000d150: 7572 6e20 6e6f 7420 616c 7265 6164 7942  urn not alreadyB
-0000d160: 726f 6b65 6e6f 7574 0a0a 2020 2020 2320  rokenout..    # 
-0000d170: 4669 6e64 2073 746f 636b 7320 7468 6174  Find stocks that
-0000d180: 2061 7265 2062 756c 6c69 7368 2069 6e74   are bullish int
-0000d190: 7261 6461 793a 2052 5349 2063 726f 7373  raday: RSI cross
-0000d1a0: 6573 2035 352c 204d 6163 6420 4869 7374  es 55, Macd Hist
-0000d1b0: 6f67 7261 6d20 706f 7369 7469 7665 2c20  ogram positive, 
-0000d1c0: 7072 6963 6520 6162 6f76 6520 454d 4120  price above EMA 
-0000d1d0: 3130 0a20 2020 2064 6566 2066 696e 6442  10.    def findB
-0000d1e0: 756c 6c69 7368 496e 7472 6164 6179 5253  ullishIntradayRS
-0000d1f0: 494d 4143 4428 7365 6c66 2c20 6466 293a  IMACD(self, df):
-0000d200: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
-0000d210: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
-0000d220: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-0000d230: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0000d240: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-0000d250: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
-0000d260: 2020 6461 7461 203d 2064 6174 612e 6669    data = data.fi
-0000d270: 6c6c 6e61 2830 290a 2020 2020 2020 2020  llna(0).        
-0000d280: 6461 7461 203d 2064 6174 612e 7265 706c  data = data.repl
-0000d290: 6163 6528 5b6e 702e 696e 662c 202d 6e70  ace([np.inf, -np
-0000d2a0: 2e69 6e66 5d2c 2030 290a 2020 2020 2020  .inf], 0).      
-0000d2b0: 2020 6461 7461 203d 2064 6174 615b 3a3a    data = data[::
-0000d2c0: 2d31 5d20 2023 2052 6576 6572 7365 2074  -1]  # Reverse t
-0000d2d0: 6865 2064 6174 6166 7261 6d65 2073 6f20  he dataframe so 
-0000d2e0: 7468 6174 2069 7473 2074 6865 206f 6c64  that its the old
-0000d2f0: 6573 7420 6461 7465 2066 6972 7374 0a20  est date first. 
-0000d300: 2020 2020 2020 2064 6174 615b 2252 5349         data["RSI
-0000d310: 3132 225d 203d 2070 6b74 616c 6962 2e52  12"] = pktalib.R
-0000d320: 5349 2864 6174 615b 2243 6c6f 7365 225d  SI(data["Close"]
-0000d330: 2c20 3132 290a 2020 2020 2020 2020 6461  , 12).        da
-0000d340: 7461 5b22 454d 4131 3022 5d20 3d20 706b  ta["EMA10"] = pk
-0000d350: 7461 6c69 622e 454d 4128 6461 7461 5b22  talib.EMA(data["
-0000d360: 436c 6f73 6522 5d2c 2031 3029 0a20 2020  Close"], 10).   
-0000d370: 2020 2020 2064 6174 615b 2245 4d41 3230       data["EMA20
-0000d380: 3022 5d20 3d20 706b 7461 6c69 622e 454d  0"] = pktalib.EM
-0000d390: 4128 6461 7461 5b22 436c 6f73 6522 5d2c  A(data["Close"],
-0000d3a0: 2032 3030 290a 2020 2020 2020 2020 6d61   200).        ma
-0000d3b0: 6364 203d 2070 6b74 616c 6962 2e4d 4143  cd = pktalib.MAC
-0000d3c0: 4428 6461 7461 5b22 436c 6f73 6522 5d2c  D(data["Close"],
-0000d3d0: 2031 302c 2031 382c 2039 295b 325d 2e74   10, 18, 9)[2].t
-0000d3e0: 6169 6c28 3129 0a20 2020 2020 2020 2072  ail(1).        r
-0000d3f0: 6563 656e 7420 3d20 6461 7461 2e74 6169  ecent = data.tai
-0000d400: 6c28 3129 0a20 2020 2020 2020 2063 6f6e  l(1).        con
-0000d410: 6431 203d 2072 6563 656e 745b 2252 5349  d1 = recent["RSI
-0000d420: 3132 225d 2e69 6c6f 635b 305d 203e 2035  12"].iloc[0] > 5
-0000d430: 350a 2020 2020 2020 2020 636f 6e64 3220  5.        cond2 
-0000d440: 3d20 636f 6e64 3120 616e 6420 286d 6163  = cond1 and (mac
-0000d450: 642e 696c 6f63 5b3a 315d 5b30 5d20 3e20  d.iloc[:1][0] > 
-0000d460: 3029 0a20 2020 2020 2020 2063 6f6e 6433  0).        cond3
-0000d470: 203d 2063 6f6e 6432 2061 6e64 2028 7265   = cond2 and (re
-0000d480: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
-0000d490: 6f63 5b30 5d20 3e20 7265 6365 6e74 5b22  oc[0] > recent["
-0000d4a0: 454d 4131 3022 5d2e 696c 6f63 5b30 5d29  EMA10"].iloc[0])
-0000d4b0: 0a20 2020 2020 2020 2063 6f6e 6434 203d  .        cond4 =
-0000d4c0: 2063 6f6e 6433 2061 6e64 2028 7265 6365   cond3 and (rece
-0000d4d0: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
-0000d4e0: 5b30 5d20 3e20 7265 6365 6e74 5b22 454d  [0] > recent["EM
-0000d4f0: 4132 3030 225d 2e69 6c6f 635b 305d 290a  A200"].iloc[0]).
-0000d500: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-0000d510: 6f6e 6434 0a20 2020 200a 2020 2020 2320  ond4.    .    # 
-0000d520: 4669 6e64 2073 746f 636b 7320 7468 6174  Find stocks that
-0000d530: 206f 7065 6e65 6420 6869 6768 6572 2074   opened higher t
-0000d540: 6861 6e20 7468 6520 7072 6576 696f 7573  han the previous
-0000d550: 2068 6967 680a 2020 2020 6465 6620 6669   high.    def fi
-0000d560: 6e64 4869 6768 6572 4f70 656e 7328 7365  ndHigherOpens(se
-0000d570: 6c66 2c20 6466 293a 0a20 2020 2020 2020  lf, df):.       
-0000d580: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
-0000d590: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
-0000d5a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000d5b0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0000d5c0: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
-0000d5d0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-0000d5e0: 2064 6174 612e 6669 6c6c 6e61 2830 290a   data.fillna(0).
-0000d5f0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000d600: 6174 612e 7265 706c 6163 6528 5b6e 702e  ata.replace([np.
-0000d610: 696e 662c 202d 6e70 2e69 6e66 5d2c 2030  inf, -np.inf], 0
-0000d620: 290a 2020 2020 2020 2020 7265 6365 6e74  ).        recent
-0000d630: 203d 2064 6174 612e 6865 6164 2832 290a   = data.head(2).
-0000d640: 2020 2020 2020 2020 6966 206c 656e 2872          if len(r
-0000d650: 6563 656e 7429 203c 2032 3a0a 2020 2020  ecent) < 2:.    
-0000d660: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0000d670: 616c 7365 0a20 2020 2020 2020 2072 6574  alse.        ret
-0000d680: 7572 6e20 7265 6365 6e74 5b22 4f70 656e  urn recent["Open
-0000d690: 225d 2e69 6c6f 635b 305d 203e 2072 6563  "].iloc[0] > rec
-0000d6a0: 656e 745b 2243 6c6f 7365 225d 2e69 6c6f  ent["Close"].ilo
-0000d6b0: 635b 315d 0a0a 2020 2020 6465 6620 6669  c[1]..    def fi
-0000d6c0: 6e64 4869 6768 6572 4275 6c6c 6973 684f  ndHigherBullishO
+0000be70: 2020 2020 2020 2063 6f6c 6f72 5465 7874         colorText
+0000be80: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
+0000be90: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000bea0: 636f 6c6f 7254 6578 742e 4752 4545 4e0a  colorText.GREEN.
+0000beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bec0: 2020 2020 2020 2020 2b20 2242 4f3a 2022          + "BO: "
+0000bed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bee0: 2020 2020 2020 2020 202b 2073 7472 286d           + str(m
+0000bef0: 6178 436c 6f73 6529 0a20 2020 2020 2020  axClose).       
+0000bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf10: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0000bf20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bf30: 2020 2020 2020 2020 202b 2028 636f 6c6f           + (colo
+0000bf40: 7254 6578 742e 4752 4545 4e20 6966 2072  rText.GREEN if r
+0000bf50: 6563 656e 7443 6c6f 7365 203e 3d20 6d61  ecentClose >= ma
+0000bf60: 7848 6967 6820 656c 7365 2063 6f6c 6f72  xHigh else color
+0000bf70: 5465 7874 2e46 4149 4c29 0a20 2020 2020  Text.FAIL).     
+0000bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf90: 2020 202b 2022 2052 3a20 220a 2020 2020     + " R: ".    
+0000bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfb0: 2020 2020 2b20 7374 7228 6d61 7848 6967      + str(maxHig
+0000bfc0: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
+0000bfd0: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+0000bfe0: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+0000bff0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000c000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c010: 2020 2020 2023 2073 656c 662e 6465 6661       # self.defa
+0000c020: 756c 745f 6c6f 6767 6572 2e69 6e66 6f28  ult_logger.info(
+0000c030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c040: 2020 2020 2023 2020 2020 2066 2753 746f       #     f'Sto
+0000c050: 636b 3a7b 7361 7665 4469 6374 5b22 5374  ck:{saveDict["St
+0000c060: 6f63 6b22 5d7d 2c20 6861 7320 6120 6272  ock"]}, has a br
+0000c070: 6561 6b6f 7574 2062 6563 6175 7365 206d  eakout because m
+0000c080: 6178 2d68 6967 6820 287b 6d61 7848 6967  ax-high ({maxHig
+0000c090: 687d 2920 3e3d 206d 6178 2d63 6c6f 7365  h}) >= max-close
+0000c0a0: 2028 7b6d 6178 436c 6f73 657d 2927 0a20   ({maxClose})'. 
+0000c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0c0: 2020 2023 2029 0a20 2020 2020 2020 2020     # ).         
+0000c0d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000c0e0: 6e20 5472 7565 2061 6e64 2061 6c72 6561  n True and alrea
+0000c0f0: 6479 4272 6f6b 656e 6f75 7420 616e 6420  dyBrokenout and 
+0000c100: 7365 6c66 2e67 6574 4361 6e64 6c65 5479  self.getCandleTy
+0000c110: 7065 2872 6563 656e 7429 0a20 2020 2020  pe(recent).     
+0000c120: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
+0000c130: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
+0000c140: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
+0000c150: 2020 2020 2020 2023 2020 2020 2066 2753         #     f'S
+0000c160: 746f 636b 3a7b 7361 7665 4469 6374 5b22  tock:{saveDict["
+0000c170: 5374 6f63 6b22 5d7d 2c20 646f 6573 206e  Stock"]}, does n
+0000c180: 6f74 2068 6176 6520 6120 6272 6561 6b6f  ot have a breako
+0000c190: 7574 2079 6574 2062 6563 6175 7365 206d  ut yet because m
+0000c1a0: 6178 2d68 6967 6820 287b 6d61 7848 6967  ax-high ({maxHig
+0000c1b0: 687d 2920 3c20 6d61 782d 636c 6f73 6520  h}) < max-close 
+0000c1c0: 287b 6d61 7843 6c6f 7365 7d29 270a 2020  ({maxClose})'.  
+0000c1d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000c1e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c1f0: 2020 7363 7265 656e 4469 6374 5b22 4272    screenDict["Br
+0000c200: 6561 6b6f 7574 225d 203d 2028 0a20 2020  eakout"] = (.   
+0000c210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c220: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
+0000c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c240: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0000c250: 4641 494c 0a20 2020 2020 2020 2020 2020  FAIL.           
+0000c260: 2020 2020 2020 2020 202b 2022 424f 3a20           + "BO: 
+0000c270: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000c280: 2020 2020 2020 2b20 7374 7228 6d61 7843        + str(maxC
+0000c290: 6c6f 7365 290a 2020 2020 2020 2020 2020  lose).          
+0000c2a0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+0000c2b0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+0000c2c0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000c2d0: 2863 6f6c 6f72 5465 7874 2e47 5245 454e  (colorText.GREEN
+0000c2e0: 2069 6620 7265 6365 6e74 436c 6f73 6520   if recentClose 
+0000c2f0: 3e3d 206d 6178 4869 6768 2065 6c73 6520  >= maxHigh else 
+0000c300: 636f 6c6f 7254 6578 742e 4641 494c 290a  colorText.FAIL).
+0000c310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c320: 2020 2020 2b20 2220 523a 2022 0a20 2020      + " R: ".   
+0000c330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c340: 202b 2073 7472 286d 6178 4869 6768 290a   + str(maxHigh).
+0000c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c360: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0000c370: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+0000c380: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000c390: 2020 2020 2020 7265 7475 726e 206e 6f74        return not
+0000c3a0: 2061 6c72 6561 6479 4272 6f6b 656e 6f75   alreadyBrokenou
+0000c3b0: 740a 2020 2020 2020 2020 2020 2020 6e6f  t.            no
+0000c3c0: 4f66 4869 6768 6572 5368 6164 6f77 7320  OfHigherShadows 
+0000c3d0: 3d20 6c65 6e28 6461 7461 5b64 6174 612e  = len(data[data.
+0000c3e0: 4869 6768 203e 206d 6178 436c 6f73 655d  High > maxClose]
+0000c3f0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000c400: 2064 6179 7354 6f4c 6f6f 6b62 6163 6b20   daysToLookback 
+0000c410: 2f20 6e6f 4f66 4869 6768 6572 5368 6164  / noOfHigherShad
+0000c420: 6f77 7320 3c3d 2033 3a0a 2020 2020 2020  ows <= 3:.      
+0000c430: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
+0000c440: 6374 5b22 4272 6561 6b6f 7574 225d 203d  ct["Breakout"] =
+0000c450: 2022 424f 3a20 2220 2b20 7374 7228 6d61   "BO: " + str(ma
+0000c460: 7848 6967 6829 202b 2022 2052 3a20 3022  xHigh) + " R: 0"
+0000c470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c480: 2069 6620 7265 6365 6e74 436c 6f73 6520   if recentClose 
+0000c490: 3e3d 206d 6178 4869 6768 3a0a 2020 2020  >= maxHigh:.    
+0000c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4b0: 7363 7265 656e 4469 6374 5b22 4272 6561  screenDict["Brea
+0000c4c0: 6b6f 7574 225d 203d 2028 0a20 2020 2020  kout"] = (.     
+0000c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4e0: 2020 2063 6f6c 6f72 5465 7874 2e42 4f4c     colorText.BOL
+0000c4f0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0000c500: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+0000c510: 7254 6578 742e 4752 4545 4e0a 2020 2020  rText.GREEN.    
+0000c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c530: 2020 2020 2b20 2242 4f3a 2022 0a20 2020      + "BO: ".   
+0000c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c550: 2020 2020 202b 2073 7472 286d 6178 4869       + str(maxHi
+0000c560: 6768 290a 2020 2020 2020 2020 2020 2020  gh).            
+0000c570: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
+0000c580: 523a 2030 220a 2020 2020 2020 2020 2020  R: 0".          
+0000c590: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000c5a0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+0000c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5c0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000c5d0: 2020 2020 2020 2020 2320 7365 6c66 2e64          # self.d
+0000c5e0: 6566 6175 6c74 5f6c 6f67 6765 722e 696e  efault_logger.in
+0000c5f0: 666f 280a 2020 2020 2020 2020 2020 2020  fo(.            
+0000c600: 2020 2020 2020 2020 2320 2020 2020 6627          #     f'
+0000c610: 5374 6f63 6b3a 7b73 6176 6544 6963 745b  Stock:{saveDict[
+0000c620: 2253 746f 636b 225d 7d2c 2068 6173 2061  "Stock"]}, has a
+0000c630: 2062 7265 616b 6f75 7420 6265 6361 7573   breakout becaus
+0000c640: 6520 7265 6365 6e74 2d63 6c6f 7365 2028  e recent-close (
+0000c650: 7b72 6563 656e 7443 6c6f 7365 7d29 203e  {recentClose}) >
+0000c660: 3d20 6d61 782d 6869 6768 2028 7b6d 6178  = max-high ({max
+0000c670: 4869 6768 7d29 270a 2020 2020 2020 2020  High})'.        
+0000c680: 2020 2020 2020 2020 2020 2020 2320 290a              # ).
+0000c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6a0: 2020 2020 7265 7475 726e 2054 7275 6520      return True 
+0000c6b0: 616e 6420 616c 7265 6164 7942 726f 6b65  and alreadyBroke
+0000c6c0: 6e6f 7574 2061 6e64 2073 656c 662e 6765  nout and self.ge
+0000c6d0: 7443 616e 646c 6554 7970 6528 7265 6365  tCandleType(rece
+0000c6e0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
+0000c6f0: 2020 2020 2320 7365 6c66 2e64 6566 6175      # self.defau
+0000c700: 6c74 5f6c 6f67 6765 722e 696e 666f 280a  lt_logger.info(.
+0000c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c720: 2320 2020 2020 6627 5374 6f63 6b3a 7b73  #     f'Stock:{s
+0000c730: 6176 6544 6963 745b 2253 746f 636b 225d  aveDict["Stock"]
+0000c740: 7d2c 2064 6f65 7320 6e6f 7420 6861 7665  }, does not have
+0000c750: 2061 2062 7265 616b 6f75 7420 7965 7420   a breakout yet 
+0000c760: 6265 6361 7573 6520 7265 6365 6e74 2d63  because recent-c
+0000c770: 6c6f 7365 2028 7b72 6563 656e 7443 6c6f  lose ({recentClo
+0000c780: 7365 7d29 203c 206d 6178 2d68 6967 6820  se}) < max-high 
+0000c790: 287b 6d61 7848 6967 687d 2927 0a20 2020  ({maxHigh})'.   
+0000c7a0: 2020 2020 2020 2020 2020 2020 2023 2029               # )
+0000c7b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c7c0: 2073 6372 6565 6e44 6963 745b 2242 7265   screenDict["Bre
+0000c7d0: 616b 6f75 7422 5d20 3d20 280a 2020 2020  akout"] = (.    
+0000c7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c7f0: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
+0000c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c810: 2020 202b 2063 6f6c 6f72 5465 7874 2e46     + colorText.F
+0000c820: 4149 4c0a 2020 2020 2020 2020 2020 2020  AIL.            
+0000c830: 2020 2020 2020 2020 2b20 2242 4f3a 2022          + "BO: "
+0000c840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c850: 2020 2020 202b 2073 7472 286d 6178 4869       + str(maxHi
+0000c860: 6768 290a 2020 2020 2020 2020 2020 2020  gh).            
+0000c870: 2020 2020 2020 2020 2b20 2220 523a 2030          + " R: 0
+0000c880: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000c890: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0000c8a0: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+0000c8b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000c8c0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+0000c8d0: 6f74 2061 6c72 6561 6479 4272 6f6b 656e  ot alreadyBroken
+0000c8e0: 6f75 740a 2020 2020 2020 2020 2020 2020  out.            
+0000c8f0: 7361 7665 4469 6374 5b22 4272 6561 6b6f  saveDict["Breako
+0000c900: 7574 225d 203d 2022 424f 3a20 2220 2b20  ut"] = "BO: " + 
+0000c910: 7374 7228 6d61 7843 6c6f 7365 2920 2b20  str(maxClose) + 
+0000c920: 2220 523a 2022 202b 2073 7472 286d 6178  " R: " + str(max
+0000c930: 4869 6768 290a 2020 2020 2020 2020 2020  High).          
+0000c940: 2020 6966 2072 6563 656e 7443 6c6f 7365    if recentClose
+0000c950: 203e 3d20 6d61 7843 6c6f 7365 3a0a 2020   >= maxClose:.  
+0000c960: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000c970: 7365 6c66 2e64 6566 6175 6c74 5f6c 6f67  self.default_log
+0000c980: 6765 722e 696e 666f 280a 2020 2020 2020  ger.info(.      
+0000c990: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0000c9a0: 6627 5374 6f63 6b3a 7b73 6176 6544 6963  f'Stock:{saveDic
+0000c9b0: 745b 2253 746f 636b 225d 7d2c 2068 6173  t["Stock"]}, has
+0000c9c0: 2061 2062 7265 616b 6f75 7420 6265 6361   a breakout beca
+0000c9d0: 7573 6520 7265 6365 6e74 2d63 6c6f 7365  use recent-close
+0000c9e0: 2028 7b72 6563 656e 7443 6c6f 7365 7d29   ({recentClose})
+0000c9f0: 203e 3d20 6d61 782d 636c 6f73 6520 287b   >= max-close ({
+0000ca00: 6d61 7843 6c6f 7365 7d29 270a 2020 2020  maxClose})'.    
+0000ca10: 2020 2020 2020 2020 2020 2020 2320 290a              # ).
+0000ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca30: 7363 7265 656e 4469 6374 5b22 4272 6561  screenDict["Brea
+0000ca40: 6b6f 7574 225d 203d 2028 0a20 2020 2020  kout"] = (.     
+0000ca50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000ca60: 6f6c 6f72 5465 7874 2e42 4f4c 440a 2020  olorText.BOLD.  
+0000ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca80: 2020 2b20 636f 6c6f 7254 6578 742e 4752    + colorText.GR
+0000ca90: 4545 4e0a 2020 2020 2020 2020 2020 2020  EEN.            
+0000caa0: 2020 2020 2020 2020 2b20 2242 4f3a 2022          + "BO: "
+0000cab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cac0: 2020 2020 202b 2073 7472 286d 6178 436c       + str(maxCl
+0000cad0: 6f73 6529 0a20 2020 2020 2020 2020 2020  ose).           
+0000cae0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+0000caf0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+0000cb00: 2020 2020 2020 2020 2020 2020 202b 2028               + (
+0000cb10: 636f 6c6f 7254 6578 742e 4752 4545 4e20  colorText.GREEN 
+0000cb20: 6966 2072 6563 656e 7443 6c6f 7365 203e  if recentClose >
+0000cb30: 3d20 6d61 7848 6967 6820 656c 7365 2063  = maxHigh else c
+0000cb40: 6f6c 6f72 5465 7874 2e46 4149 4c29 0a20  olorText.FAIL). 
+0000cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb60: 2020 202b 2022 2052 3a20 220a 2020 2020     + " R: ".    
+0000cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb80: 2b20 7374 7228 6d61 7848 6967 6829 0a20  + str(maxHigh). 
+0000cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cba0: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
+0000cbb0: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
+0000cbc0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000cbd0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+0000cbe0: 2061 6e64 2061 6c72 6561 6479 4272 6f6b   and alreadyBrok
+0000cbf0: 656e 6f75 7420 616e 6420 7365 6c66 2e67  enout and self.g
+0000cc00: 6574 4361 6e64 6c65 5479 7065 2872 6563  etCandleType(rec
+0000cc10: 656e 7429 0a20 2020 2020 2020 2020 2020  ent).           
+0000cc20: 2023 2073 656c 662e 6465 6661 756c 745f   # self.default_
+0000cc30: 6c6f 6767 6572 2e69 6e66 6f28 0a20 2020  logger.info(.   
+0000cc40: 2020 2020 2020 2020 2023 2020 2020 2066           #     f
+0000cc50: 2753 746f 636b 3a7b 7361 7665 4469 6374  'Stock:{saveDict
+0000cc60: 5b22 5374 6f63 6b22 5d7d 2c20 646f 6573  ["Stock"]}, does
+0000cc70: 206e 6f74 2068 6176 6520 6120 6272 6561   not have a brea
+0000cc80: 6b6f 7574 2079 6574 2062 6563 6175 7365  kout yet because
+0000cc90: 2072 6563 656e 742d 636c 6f73 6520 287b   recent-close ({
+0000cca0: 7265 6365 6e74 436c 6f73 657d 2920 3c20  recentClose}) < 
+0000ccb0: 6d61 782d 6869 6768 2028 7b6d 6178 4869  max-high ({maxHi
+0000ccc0: 6768 7d29 270a 2020 2020 2020 2020 2020  gh})'.          
+0000ccd0: 2020 2320 290a 2020 2020 2020 2020 2020    # ).          
+0000cce0: 2020 7363 7265 656e 4469 6374 5b22 4272    screenDict["Br
+0000ccf0: 6561 6b6f 7574 225d 203d 2028 0a20 2020  eakout"] = (.   
+0000cd00: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+0000cd10: 6f72 5465 7874 2e42 4f4c 440a 2020 2020  orText.BOLD.    
+0000cd20: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0000cd30: 6c6f 7254 6578 742e 4641 494c 0a20 2020  lorText.FAIL.   
+0000cd40: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+0000cd50: 424f 3a20 220a 2020 2020 2020 2020 2020  BO: ".          
+0000cd60: 2020 2020 2020 2b20 7374 7228 6d61 7843        + str(maxC
+0000cd70: 6c6f 7365 290a 2020 2020 2020 2020 2020  lose).          
+0000cd80: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0000cd90: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+0000cda0: 2020 2020 2020 2b20 2863 6f6c 6f72 5465        + (colorTe
+0000cdb0: 7874 2e47 5245 454e 2069 6620 7265 6365  xt.GREEN if rece
+0000cdc0: 6e74 436c 6f73 6520 3e3d 206d 6178 4869  ntClose >= maxHi
+0000cdd0: 6768 2065 6c73 6520 636f 6c6f 7254 6578  gh else colorTex
+0000cde0: 742e 4641 494c 290a 2020 2020 2020 2020  t.FAIL).        
+0000cdf0: 2020 2020 2020 2020 2b20 2220 523a 2022          + " R: "
+0000ce00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ce10: 202b 2073 7472 286d 6178 4869 6768 290a   + str(maxHigh).
+0000ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce30: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+0000ce40: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000ce50: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000ce60: 206e 6f74 2061 6c72 6561 6479 4272 6f6b   not alreadyBrok
+0000ce70: 656e 6f75 740a 2020 2020 2020 2020 656c  enout.        el
+0000ce80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000ce90: 7361 7665 4469 6374 5b22 4272 6561 6b6f  saveDict["Breako
+0000cea0: 7574 225d 203d 2022 424f 3a20 2220 2b20  ut"] = "BO: " + 
+0000ceb0: 7374 7228 6d61 7843 6c6f 7365 2920 2b20  str(maxClose) + 
+0000cec0: 2220 523a 2030 220a 2020 2020 2020 2020  " R: 0".        
+0000ced0: 2020 2020 6966 2072 6563 656e 7443 6c6f      if recentClo
+0000cee0: 7365 203e 3d20 6d61 7843 6c6f 7365 3a0a  se >= maxClose:.
+0000cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf00: 2320 7365 6c66 2e64 6566 6175 6c74 5f6c  # self.default_l
+0000cf10: 6f67 6765 722e 696e 666f 280a 2020 2020  ogger.info(.    
+0000cf20: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+0000cf30: 2020 6627 5374 6f63 6b3a 7b73 6176 6544    f'Stock:{saveD
+0000cf40: 6963 745b 2253 746f 636b 225d 7d2c 2068  ict["Stock"]}, h
+0000cf50: 6173 2061 2062 7265 616b 6f75 7420 6265  as a breakout be
+0000cf60: 6361 7573 6520 7265 6365 6e74 2d63 6c6f  cause recent-clo
+0000cf70: 7365 2028 7b72 6563 656e 7443 6c6f 7365  se ({recentClose
+0000cf80: 7d29 203e 3d20 6d61 782d 636c 6f73 6520  }) >= max-close 
+0000cf90: 287b 6d61 7843 6c6f 7365 7d29 270a 2020  ({maxClose})'.  
+0000cfa0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000cfb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000cfc0: 2020 7363 7265 656e 4469 6374 5b22 4272    screenDict["Br
+0000cfd0: 6561 6b6f 7574 225d 203d 2028 0a20 2020  eakout"] = (.   
+0000cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cff0: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
+0000d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d010: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0000d020: 4752 4545 4e0a 2020 2020 2020 2020 2020  GREEN.          
+0000d030: 2020 2020 2020 2020 2020 2b20 2242 4f3a            + "BO:
+0000d040: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0000d050: 2020 2020 2020 202b 2073 7472 286d 6178         + str(max
+0000d060: 436c 6f73 6529 0a20 2020 2020 2020 2020  Close).         
+0000d070: 2020 2020 2020 2020 2020 202b 2022 2052             + " R
+0000d080: 3a20 3022 0a20 2020 2020 2020 2020 2020  : 0".           
+0000d090: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+0000d0a0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+0000d0b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000d0c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000d0d0: 6e20 5472 7565 2061 6e64 2061 6c72 6561  n True and alrea
+0000d0e0: 6479 4272 6f6b 656e 6f75 7420 616e 6420  dyBrokenout and 
+0000d0f0: 7365 6c66 2e67 6574 4361 6e64 6c65 5479  self.getCandleTy
+0000d100: 7065 2872 6563 656e 7429 0a20 2020 2020  pe(recent).     
+0000d110: 2020 2020 2020 2023 2073 656c 662e 6465         # self.de
+0000d120: 6661 756c 745f 6c6f 6767 6572 2e69 6e66  fault_logger.inf
+0000d130: 6f28 0a20 2020 2020 2020 2020 2020 2023  o(.            #
+0000d140: 2020 2020 2066 2753 746f 636b 3a7b 7361       f'Stock:{sa
+0000d150: 7665 4469 6374 5b22 5374 6f63 6b22 5d7d  veDict["Stock"]}
+0000d160: 2c20 6861 7320 6120 6272 6561 6b6f 7574  , has a breakout
+0000d170: 2062 6563 6175 7365 2072 6563 656e 742d   because recent-
+0000d180: 636c 6f73 6520 287b 7265 6365 6e74 436c  close ({recentCl
+0000d190: 6f73 657d 2920 3c20 6d61 782d 636c 6f73  ose}) < max-clos
+0000d1a0: 6520 287b 6d61 7843 6c6f 7365 7d29 270a  e ({maxClose})'.
+0000d1b0: 2020 2020 2020 2020 2020 2020 2320 290a              # ).
+0000d1c0: 2020 2020 2020 2020 2020 2020 7363 7265              scre
+0000d1d0: 656e 4469 6374 5b22 4272 6561 6b6f 7574  enDict["Breakout
+0000d1e0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+0000d1f0: 2020 2020 2020 2063 6f6c 6f72 5465 7874         colorText
+0000d200: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
+0000d210: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0000d220: 742e 4641 494c 0a20 2020 2020 2020 2020  t.FAIL.         
+0000d230: 2020 2020 2020 202b 2022 424f 3a20 220a         + "BO: ".
+0000d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d250: 2b20 7374 7228 6d61 7843 6c6f 7365 290a  + str(maxClose).
+0000d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d270: 2b20 2220 523a 2030 220a 2020 2020 2020  + " R: 0".      
+0000d280: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+0000d290: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+0000d2a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000d2b0: 2020 2020 7265 7475 726e 206e 6f74 2061      return not a
+0000d2c0: 6c72 6561 6479 4272 6f6b 656e 6f75 740a  lreadyBrokenout.
+0000d2d0: 0a20 2020 2023 2046 696e 6420 7374 6f63  .    # Find stoc
+0000d2e0: 6b73 2074 6861 7420 6172 6520 6275 6c6c  ks that are bull
+0000d2f0: 6973 6820 696e 7472 6164 6179 3a20 5253  ish intraday: RS
+0000d300: 4920 6372 6f73 7365 7320 3535 2c20 4d61  I crosses 55, Ma
+0000d310: 6364 2048 6973 746f 6772 616d 2070 6f73  cd Histogram pos
+0000d320: 6974 6976 652c 2070 7269 6365 2061 626f  itive, price abo
+0000d330: 7665 2045 4d41 2031 300a 2020 2020 6465  ve EMA 10.    de
+0000d340: 6620 6669 6e64 4275 6c6c 6973 6849 6e74  f findBullishInt
+0000d350: 7261 6461 7952 5349 4d41 4344 2873 656c  radayRSIMACD(sel
+0000d360: 662c 2064 6629 3a0a 2020 2020 2020 2020  f, df):.        
+0000d370: 6966 2064 6620 6973 204e 6f6e 6520 6f72  if df is None or
+0000d380: 206c 656e 2864 6629 203d 3d20 303a 0a20   len(df) == 0:. 
+0000d390: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000d3a0: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+0000d3b0: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
+0000d3c0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+0000d3d0: 6461 7461 2e66 696c 6c6e 6128 3029 0a20  data.fillna(0). 
+0000d3e0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0000d3f0: 7461 2e72 6570 6c61 6365 285b 6e70 2e69  ta.replace([np.i
+0000d400: 6e66 2c20 2d6e 702e 696e 665d 2c20 3029  nf, -np.inf], 0)
+0000d410: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+0000d420: 6461 7461 5b3a 3a2d 315d 2020 2320 5265  data[::-1]  # Re
+0000d430: 7665 7273 6520 7468 6520 6461 7461 6672  verse the datafr
+0000d440: 616d 6520 736f 2074 6861 7420 6974 7320  ame so that its 
+0000d450: 7468 6520 6f6c 6465 7374 2064 6174 6520  the oldest date 
+0000d460: 6669 7273 740a 2020 2020 2020 2020 6461  first.        da
+0000d470: 7461 5b22 5253 4931 3222 5d20 3d20 706b  ta["RSI12"] = pk
+0000d480: 7461 6c69 622e 5253 4928 6461 7461 5b22  talib.RSI(data["
+0000d490: 436c 6f73 6522 5d2c 2031 3229 0a20 2020  Close"], 12).   
+0000d4a0: 2020 2020 2064 6174 615b 2245 4d41 3130       data["EMA10
+0000d4b0: 225d 203d 2070 6b74 616c 6962 2e45 4d41  "] = pktalib.EMA
+0000d4c0: 2864 6174 615b 2243 6c6f 7365 225d 2c20  (data["Close"], 
+0000d4d0: 3130 290a 2020 2020 2020 2020 6461 7461  10).        data
+0000d4e0: 5b22 454d 4132 3030 225d 203d 2070 6b74  ["EMA200"] = pkt
+0000d4f0: 616c 6962 2e45 4d41 2864 6174 615b 2243  alib.EMA(data["C
+0000d500: 6c6f 7365 225d 2c20 3230 3029 0a20 2020  lose"], 200).   
+0000d510: 2020 2020 206d 6163 6420 3d20 706b 7461       macd = pkta
+0000d520: 6c69 622e 4d41 4344 2864 6174 615b 2243  lib.MACD(data["C
+0000d530: 6c6f 7365 225d 2c20 3130 2c20 3138 2c20  lose"], 10, 18, 
+0000d540: 3929 5b32 5d2e 7461 696c 2831 290a 2020  9)[2].tail(1).  
+0000d550: 2020 2020 2020 7265 6365 6e74 203d 2064        recent = d
+0000d560: 6174 612e 7461 696c 2831 290a 2020 2020  ata.tail(1).    
+0000d570: 2020 2020 636f 6e64 3120 3d20 7265 6365      cond1 = rece
+0000d580: 6e74 5b22 5253 4931 3222 5d2e 696c 6f63  nt["RSI12"].iloc
+0000d590: 5b30 5d20 3e20 3535 0a20 2020 2020 2020  [0] > 55.       
+0000d5a0: 2063 6f6e 6432 203d 2063 6f6e 6431 2061   cond2 = cond1 a
+0000d5b0: 6e64 2028 6d61 6364 2e69 6c6f 635b 3a31  nd (macd.iloc[:1
+0000d5c0: 5d5b 305d 203e 2030 290a 2020 2020 2020  ][0] > 0).      
+0000d5d0: 2020 636f 6e64 3320 3d20 636f 6e64 3220    cond3 = cond2 
+0000d5e0: 616e 6420 2872 6563 656e 745b 2243 6c6f  and (recent["Clo
+0000d5f0: 7365 225d 2e69 6c6f 635b 305d 203e 2072  se"].iloc[0] > r
+0000d600: 6563 656e 745b 2245 4d41 3130 225d 2e69  ecent["EMA10"].i
+0000d610: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
+0000d620: 636f 6e64 3420 3d20 636f 6e64 3320 616e  cond4 = cond3 an
+0000d630: 6420 2872 6563 656e 745b 2243 6c6f 7365  d (recent["Close
+0000d640: 225d 2e69 6c6f 635b 305d 203e 2072 6563  "].iloc[0] > rec
+0000d650: 656e 745b 2245 4d41 3230 3022 5d2e 696c  ent["EMA200"].il
+0000d660: 6f63 5b30 5d29 0a20 2020 2020 2020 2072  oc[0]).        r
+0000d670: 6574 7572 6e20 636f 6e64 340a 2020 2020  eturn cond4.    
+0000d680: 0a20 2020 2023 2046 696e 6420 7374 6f63  .    # Find stoc
+0000d690: 6b73 2074 6861 7420 6f70 656e 6564 2068  ks that opened h
+0000d6a0: 6967 6865 7220 7468 616e 2074 6865 2070  igher than the p
+0000d6b0: 7265 7669 6f75 7320 6869 6768 0a20 2020  revious high.   
+0000d6c0: 2064 6566 2066 696e 6448 6967 6865 724f   def findHigherO
 0000d6d0: 7065 6e73 2873 656c 662c 2064 6629 3a0a  pens(self, df):.
 0000d6e0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
 0000d6f0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
 0000d700: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
 0000d710: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
 0000d720: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
 0000d730: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
@@ -3450,6447 +3450,6542 @@
 0000d790: 2072 6563 656e 7420 3d20 6461 7461 2e68   recent = data.h
 0000d7a0: 6561 6428 3229 0a20 2020 2020 2020 2069  ead(2).        i
 0000d7b0: 6620 6c65 6e28 7265 6365 6e74 2920 3c20  f len(recent) < 
 0000d7c0: 323a 0a20 2020 2020 2020 2020 2020 2072  2:.            r
 0000d7d0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
 0000d7e0: 2020 2020 7265 7475 726e 2072 6563 656e      return recen
 0000d7f0: 745b 224f 7065 6e22 5d2e 696c 6f63 5b30  t["Open"].iloc[0
-0000d800: 5d20 3e20 7265 6365 6e74 5b22 4869 6768  ] > recent["High
-0000d810: 225d 2e69 6c6f 635b 315d 0a20 2020 200a  "].iloc[1].    .
-0000d820: 2020 2020 6465 6620 6669 6e64 4e52 3444      def findNR4D
-0000d830: 6179 2873 656c 662c 2064 6629 3a0a 2020  ay(self, df):.  
-0000d840: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
-0000d850: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
-0000d860: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0000d870: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-0000d880: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
-0000d890: 636f 7079 2829 0a20 2020 2020 2020 2023  copy().        #
-0000d8a0: 2068 7474 7073 3a2f 2f63 6861 7274 696e   https://chartin
-0000d8b0: 6b2e 636f 6d2f 7363 7265 656e 6572 2f6e  k.com/screener/n
-0000d8c0: 7234 2d64 6169 6c79 2d74 6f64 6179 0a20  r4-daily-today. 
-0000d8d0: 2020 2020 2020 2069 6620 6461 7461 2e74         if data.t
-0000d8e0: 6169 6c28 3129 5b22 566f 6c75 6d65 225d  ail(1)["Volume"]
-0000d8f0: 2e69 6c6f 635b 305d 203c 3d20 3530 3030  .iloc[0] <= 5000
-0000d900: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
-0000d910: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-0000d920: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-0000d930: 6669 6c6c 6e61 2830 290a 2020 2020 2020  fillna(0).      
-0000d940: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
-0000d950: 706c 6163 6528 5b6e 702e 696e 662c 202d  place([np.inf, -
-0000d960: 6e70 2e69 6e66 5d2c 2030 290a 2020 2020  np.inf], 0).    
-0000d970: 2020 2020 6461 7461 203d 2064 6174 615b      data = data[
-0000d980: 3a3a 2d31 5d20 2023 2052 6576 6572 7365  ::-1]  # Reverse
-0000d990: 2074 6865 2064 6174 6166 7261 6d65 2073   the dataframe s
-0000d9a0: 6f20 7468 6174 2069 7473 2074 6865 206f  o that its the o
-0000d9b0: 6c64 6573 7420 6461 7465 2066 6972 7374  ldest date first
-0000d9c0: 0a20 2020 2020 2020 2064 6174 615b 2253  .        data["S
-0000d9d0: 4d41 3130 225d 203d 2070 6b74 616c 6962  MA10"] = pktalib
-0000d9e0: 2e53 4d41 2864 6174 615b 2243 6c6f 7365  .SMA(data["Close
-0000d9f0: 225d 2c20 3130 290a 2020 2020 2020 2020  "], 10).        
-0000da00: 6461 7461 5b22 534d 4135 3022 5d20 3d20  data["SMA50"] = 
-0000da10: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
-0000da20: 5b22 436c 6f73 6522 5d2c 2035 3029 0a20  ["Close"], 50). 
-0000da30: 2020 2020 2020 2064 6174 615b 2253 4d41         data["SMA
-0000da40: 3230 3022 5d20 3d20 706b 7461 6c69 622e  200"] = pktalib.
-0000da50: 534d 4128 6461 7461 5b22 436c 6f73 6522  SMA(data["Close"
-0000da60: 5d2c 2032 3030 290a 2020 2020 2020 2020  ], 200).        
-0000da70: 7265 6365 6e74 203d 2064 6174 612e 7461  recent = data.ta
-0000da80: 696c 2835 290a 2020 2020 2020 2020 7265  il(5).        re
-0000da90: 6365 6e74 203d 2072 6563 656e 745b 3a3a  cent = recent[::
-0000daa0: 2d31 5d0a 2020 2020 2020 2020 636f 6e64  -1].        cond
-0000dab0: 3120 3d20 2872 6563 656e 745b 2248 6967  1 = (recent["Hig
-0000dac0: 6822 5d2e 696c 6f63 5b30 5d20 2d20 7265  h"].iloc[0] - re
-0000dad0: 6365 6e74 5b22 4c6f 7722 5d2e 696c 6f63  cent["Low"].iloc
-0000dae0: 5b30 5d29 203c 2028 0a20 2020 2020 2020  [0]) < (.       
-0000daf0: 2020 2020 2072 6563 656e 745b 2248 6967       recent["Hig
-0000db00: 6822 5d2e 696c 6f63 5b31 5d20 2d20 7265  h"].iloc[1] - re
-0000db10: 6365 6e74 5b22 4c6f 7722 5d2e 696c 6f63  cent["Low"].iloc
-0000db20: 5b31 5d0a 2020 2020 2020 2020 290a 2020  [1].        ).  
-0000db30: 2020 2020 2020 636f 6e64 3220 3d20 636f        cond2 = co
-0000db40: 6e64 3120 616e 6420 2872 6563 656e 745b  nd1 and (recent[
-0000db50: 2248 6967 6822 5d2e 696c 6f63 5b30 5d20  "High"].iloc[0] 
-0000db60: 2d20 7265 6365 6e74 5b22 4c6f 7722 5d2e  - recent["Low"].
-0000db70: 696c 6f63 5b30 5d29 203c 2028 0a20 2020  iloc[0]) < (.   
-0000db80: 2020 2020 2020 2020 2072 6563 656e 745b           recent[
-0000db90: 2248 6967 6822 5d2e 696c 6f63 5b32 5d20  "High"].iloc[2] 
-0000dba0: 2d20 7265 6365 6e74 5b22 4c6f 7722 5d2e  - recent["Low"].
-0000dbb0: 696c 6f63 5b32 5d0a 2020 2020 2020 2020  iloc[2].        
-0000dbc0: 290a 2020 2020 2020 2020 636f 6e64 3320  ).        cond3 
-0000dbd0: 3d20 636f 6e64 3220 616e 6420 2872 6563  = cond2 and (rec
-0000dbe0: 656e 745b 2248 6967 6822 5d2e 696c 6f63  ent["High"].iloc
-0000dbf0: 5b30 5d20 2d20 7265 6365 6e74 5b22 4c6f  [0] - recent["Lo
-0000dc00: 7722 5d2e 696c 6f63 5b30 5d29 203c 2028  w"].iloc[0]) < (
-0000dc10: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
-0000dc20: 656e 745b 2248 6967 6822 5d2e 696c 6f63  ent["High"].iloc
-0000dc30: 5b33 5d20 2d20 7265 6365 6e74 5b22 4c6f  [3] - recent["Lo
-0000dc40: 7722 5d2e 696c 6f63 5b33 5d0a 2020 2020  w"].iloc[3].    
-0000dc50: 2020 2020 290a 2020 2020 2020 2020 636f      ).        co
-0000dc60: 6e64 3420 3d20 636f 6e64 3320 616e 6420  nd4 = cond3 and 
-0000dc70: 2872 6563 656e 745b 2248 6967 6822 5d2e  (recent["High"].
-0000dc80: 696c 6f63 5b30 5d20 2d20 7265 6365 6e74  iloc[0] - recent
-0000dc90: 5b22 4c6f 7722 5d2e 696c 6f63 5b30 5d29  ["Low"].iloc[0])
-0000dca0: 203c 2028 0a20 2020 2020 2020 2020 2020   < (.           
-0000dcb0: 2072 6563 656e 745b 2248 6967 6822 5d2e   recent["High"].
-0000dcc0: 696c 6f63 5b34 5d20 2d20 7265 6365 6e74  iloc[4] - recent
-0000dcd0: 5b22 4c6f 7722 5d2e 696c 6f63 5b34 5d0a  ["Low"].iloc[4].
-0000dce0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000dcf0: 2020 636f 6e64 3520 3d20 636f 6e64 3420    cond5 = cond4 
-0000dd00: 616e 6420 2872 6563 656e 745b 2253 4d41  and (recent["SMA
-0000dd10: 3130 225d 2e69 6c6f 635b 305d 203e 2072  10"].iloc[0] > r
-0000dd20: 6563 656e 745b 2253 4d41 3530 225d 2e69  ecent["SMA50"].i
-0000dd30: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
-0000dd40: 636f 6e64 3620 3d20 636f 6e64 3520 616e  cond6 = cond5 an
-0000dd50: 6420 2872 6563 656e 745b 2253 4d41 3530  d (recent["SMA50
-0000dd60: 225d 2e69 6c6f 635b 305d 203e 2072 6563  "].iloc[0] > rec
-0000dd70: 656e 745b 2253 4d41 3230 3022 5d2e 696c  ent["SMA200"].il
-0000dd80: 6f63 5b30 5d29 0a20 2020 2020 2020 2072  oc[0]).        r
-0000dd90: 6574 7572 6e20 636f 6e64 360a 0a20 2020  eturn cond6..   
-0000dda0: 2023 2046 696e 6420 706f 7465 6e74 6961   # Find potentia
-0000ddb0: 6c20 6272 6561 6b6f 7574 2073 746f 636b  l breakout stock
-0000ddc0: 730a 2020 2020 2320 5468 6973 2073 6361  s.    # This sca
-0000ddd0: 6e6e 6572 2066 696c 7465 7273 2073 746f  nner filters sto
-0000dde0: 636b 7320 7768 6f73 6520 6375 7272 656e  cks whose curren
-0000ddf0: 7420 636c 6f73 6520 7072 6963 6520 2b20  t close price + 
-0000de00: 3525 2069 7320 6869 6768 6572 0a20 2020  5% is higher.   
-0000de10: 2023 2074 6861 6e20 7468 6520 6869 6768   # than the high
-0000de20: 6573 7420 4869 6768 2070 7269 6365 2069  est High price i
-0000de30: 6e20 7061 7374 2032 3030 2063 616e 646c  n past 200 candl
-0000de40: 6573 2061 6e64 2074 6865 206d 6178 696d  es and the maxim
-0000de50: 756d 2068 6967 680a 2020 2020 2320 696e  um high.    # in
-0000de60: 2074 6865 2070 7265 7669 6f75 7320 3330   the previous 30
-0000de70: 2063 616e 646c 6573 2069 7320 6c6f 7765   candles is lowe
-0000de80: 7220 7468 616e 2074 6865 2068 6967 6865  r than the highe
-0000de90: 7374 2068 6967 6820 6d61 6465 2069 6e20  st high made in 
-0000dea0: 7468 650a 2020 2020 2320 7072 6576 696f  the.    # previo
-0000deb0: 7573 2032 3030 2063 616e 646c 6573 2c20  us 200 candles, 
-0000dec0: 7374 6172 7469 6e67 2066 726f 6d20 7468  starting from th
-0000ded0: 6520 7072 6576 696f 7573 2033 3074 6820  e previous 30th 
-0000dee0: 6361 6e64 6c65 2e20 4174 2074 6865 0a20  candle. At the. 
-0000def0: 2020 2023 2073 616d 6520 7469 6d65 2074     # same time t
-0000df00: 6865 2063 7572 7265 6e74 2063 616e 646c  he current candl
-0000df10: 6520 766f 6c75 6d65 2069 7320 6869 6768  e volume is high
-0000df20: 6572 2074 6861 6e20 3230 3020 534d 4120  er than 200 SMA 
-0000df30: 6f66 2076 6f6c 756d 652e 0a20 2020 2064  of volume..    d
-0000df40: 6566 2066 696e 6450 6f74 656e 7469 616c  ef findPotential
-0000df50: 4272 6561 6b6f 7574 2873 656c 662c 2064  Breakout(self, d
-0000df60: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
-0000df70: 6176 6544 6963 742c 2064 6179 7354 6f4c  aveDict, daysToL
-0000df80: 6f6f 6b62 6163 6b29 3a0a 2020 2020 2020  ookback):.      
-0000df90: 2020 6966 2064 6620 6973 204e 6f6e 6520    if df is None 
-0000dfa0: 6f72 206c 656e 2864 6629 203d 3d20 303a  or len(df) == 0:
-0000dfb0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000dfc0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0000dfd0: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-0000dfe0: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
-0000dff0: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-0000e000: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-0000e010: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
-0000e020: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
-0000e030: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
-0000e040: 3d20 6461 7461 2e68 6561 6428 3233 3129  = data.head(231)
-0000e050: 0a20 2020 2020 2020 2072 6563 656e 7420  .        recent 
-0000e060: 3d20 6461 7461 2e68 6561 6428 3129 0a20  = data.head(1). 
-0000e070: 2020 2020 2020 2072 6563 656e 7456 6f6c         recentVol
-0000e080: 756d 6520 3d20 7265 6365 6e74 5b22 566f  ume = recent["Vo
-0000e090: 6c75 6d65 225d 2e69 6c6f 635b 305d 0a20  lume"].iloc[0]. 
-0000e0a0: 2020 2020 2020 2072 6563 656e 7443 6c6f         recentClo
-0000e0b0: 7365 203d 2072 6f75 6e64 2872 6563 656e  se = round(recen
-0000e0c0: 745b 2243 6c6f 7365 225d 2e69 6c6f 635b  t["Close"].iloc[
-0000e0d0: 305d 202a 2031 2e30 352c 2032 290a 2020  0] * 1.05, 2).  
-0000e0e0: 2020 2020 2020 6869 6768 6573 7448 6967        highestHig
-0000e0f0: 6832 3030 203d 2072 6f75 6e64 2864 6174  h200 = round(dat
-0000e100: 612e 6865 6164 2832 3031 292e 7461 696c  a.head(201).tail
-0000e110: 2832 3030 292e 6465 7363 7269 6265 2829  (200).describe()
-0000e120: 5b22 4869 6768 225d 5b22 6d61 7822 5d2c  ["High"]["max"],
-0000e130: 2032 290a 2020 2020 2020 2020 6869 6768   2).        high
-0000e140: 6573 7448 6967 6833 3020 3d20 726f 756e  estHigh30 = roun
-0000e150: 6428 6461 7461 2e68 6561 6428 3331 292e  d(data.head(31).
-0000e160: 7461 696c 2833 3029 2e64 6573 6372 6962  tail(30).describ
-0000e170: 6528 295b 2248 6967 6822 5d5b 226d 6178  e()["High"]["max
-0000e180: 225d 2c20 3229 0a20 2020 2020 2020 2068  "], 2).        h
-0000e190: 6967 6865 7374 4869 6768 3230 3046 726f  ighestHigh200Fro
-0000e1a0: 6d33 3020 3d20 726f 756e 6428 6461 7461  m30 = round(data
-0000e1b0: 2e74 6169 6c28 3230 3029 2e64 6573 6372  .tail(200).descr
-0000e1c0: 6962 6528 295b 2248 6967 6822 5d5b 226d  ibe()["High"]["m
-0000e1d0: 6178 225d 2c20 3229 0a20 2020 2020 2020  ax"], 2).       
-0000e1e0: 2068 6967 6865 7374 4869 6768 3846 726f   highestHigh8Fro
-0000e1f0: 6d33 3020 3d20 726f 756e 6428 6461 7461  m30 = round(data
-0000e200: 2e68 6561 6428 3339 292e 7461 696c 2838  .head(39).tail(8
-0000e210: 292e 6465 7363 7269 6265 2829 5b22 4869  ).describe()["Hi
-0000e220: 6768 225d 5b22 6d61 7822 5d2c 2032 290a  gh"]["max"], 2).
-0000e230: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000e240: 6174 612e 6865 6164 2832 3030 290a 2020  ata.head(200).  
-0000e250: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-0000e260: 615b 3a3a 2d31 5d20 2023 2052 6576 6572  a[::-1]  # Rever
-0000e270: 7365 2074 6865 2064 6174 6166 7261 6d65  se the dataframe
-0000e280: 2073 6f20 7468 6174 2069 7473 2074 6865   so that its the
-0000e290: 206f 6c64 6573 7420 6461 7465 2066 6972   oldest date fir
-0000e2a0: 7374 0a20 2020 2020 2020 2076 6f6c 3230  st.        vol20
-0000e2b0: 3020 3d20 706b 7461 6c69 622e 534d 4128  0 = pktalib.SMA(
-0000e2c0: 6461 7461 5b22 566f 6c75 6d65 225d 2c74  data["Volume"],t
-0000e2d0: 696d 6570 6572 696f 643d 3230 3029 0a20  imeperiod=200). 
-0000e2e0: 2020 2020 2020 2064 6174 615b 2253 4d41         data["SMA
-0000e2f0: 3230 3056 225d 203d 2076 6f6c 3230 300a  200V"] = vol200.
-0000e300: 2020 2020 2020 2020 766f 6c35 3020 3d20          vol50 = 
-0000e310: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
-0000e320: 5b22 566f 6c75 6d65 225d 2c74 696d 6570  ["Volume"],timep
-0000e330: 6572 696f 643d 3530 290a 2020 2020 2020  eriod=50).      
-0000e340: 2020 6461 7461 5b22 534d 4135 3056 225d    data["SMA50V"]
-0000e350: 203d 2076 6f6c 3530 0a20 2020 2020 2020   = vol50.       
-0000e360: 2072 6563 656e 7420 3d20 6461 7461 2e74   recent = data.t
-0000e370: 6169 6c28 3129 0a20 2020 2020 2020 2073  ail(1).        s
-0000e380: 6d61 3230 3076 203d 2072 6563 656e 745b  ma200v = recent[
-0000e390: 2253 4d41 3230 3056 225d 2e69 6c6f 635b  "SMA200V"].iloc[
-0000e3a0: 305d 0a20 2020 2020 2020 2073 6d61 3530  0].        sma50
-0000e3b0: 7620 3d20 7265 6365 6e74 5b22 534d 4135  v = recent["SMA5
-0000e3c0: 3056 225d 2e69 6c6f 635b 305d 0a20 2020  0V"].iloc[0].   
-0000e3d0: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-0000e3e0: 2020 2020 2020 6e70 2e69 736e 616e 2872        np.isnan(r
-0000e3f0: 6563 656e 7443 6c6f 7365 290a 2020 2020  ecentClose).    
-0000e400: 2020 2020 2020 2020 6f72 206e 702e 6973          or np.is
-0000e410: 6e61 6e28 6869 6768 6573 7448 6967 6832  nan(highestHigh2
-0000e420: 3030 290a 2020 2020 2020 2020 2020 2020  00).            
-0000e430: 6f72 206e 702e 6973 6e61 6e28 6869 6768  or np.isnan(high
-0000e440: 6573 7448 6967 6833 3029 0a20 2020 2020  estHigh30).     
-0000e450: 2020 2020 2020 206f 7220 6e70 2e69 736e         or np.isn
-0000e460: 616e 2868 6967 6865 7374 4869 6768 3230  an(highestHigh20
-0000e470: 3046 726f 6d33 3029 0a20 2020 2020 2020  0From30).       
-0000e480: 2020 2020 206f 7220 6e70 2e69 736e 616e       or np.isnan
-0000e490: 2868 6967 6865 7374 4869 6768 3846 726f  (highestHigh8Fro
-0000e4a0: 6d33 3029 0a20 2020 2020 2020 2020 2020  m30).           
-0000e4b0: 206f 7220 6e70 2e69 736e 616e 2872 6563   or np.isnan(rec
-0000e4c0: 656e 7456 6f6c 756d 6529 0a20 2020 2020  entVolume).     
-0000e4d0: 2020 2020 2020 206f 7220 6e70 2e69 736e         or np.isn
-0000e4e0: 616e 2873 6d61 3230 3076 290a 2020 2020  an(sma200v).    
-0000e4f0: 2020 2020 2020 2020 6f72 206e 702e 6973          or np.is
-0000e500: 6e61 6e28 736d 6135 3076 290a 2020 2020  nan(sma50v).    
-0000e510: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-0000e520: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000e530: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-0000e540: 2020 2020 2020 2020 2028 7265 6365 6e74           (recent
-0000e550: 436c 6f73 6520 3e20 6869 6768 6573 7448  Close > highestH
-0000e560: 6967 6832 3030 290a 2020 2020 2020 2020  igh200).        
-0000e570: 2020 2020 616e 6420 2828 2868 6967 6865      and (((highe
-0000e580: 7374 4869 6768 3330 203c 2068 6967 6865  stHigh30 < highe
-0000e590: 7374 4869 6768 3230 3046 726f 6d33 3029  stHigh200From30)
-0000e5a0: 2061 6e64 2028 7265 6365 6e74 566f 6c75   and (recentVolu
-0000e5b0: 6d65 203e 2073 6d61 3230 3076 2929 206f  me > sma200v)) o
-0000e5c0: 7220 5c0a 2020 2020 2020 2020 2020 2020  r \.            
-0000e5d0: 2020 2020 2028 2868 6967 6865 7374 4869       ((highestHi
-0000e5e0: 6768 3330 203c 2068 6967 6865 7374 4869  gh30 < highestHi
-0000e5f0: 6768 3846 726f 6d33 3029 2061 6e64 2028  gh8From30) and (
-0000e600: 7265 6365 6e74 566f 6c75 6d65 203e 2073  recentVolume > s
-0000e610: 6d61 3530 7629 290a 2020 2020 2020 2020  ma50v)).        
-0000e620: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000e630: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-0000e640: 2073 6176 6544 6963 745b 2242 7265 616b   saveDict["Break
-0000e650: 6f75 7422 5d20 3d20 7361 7665 4469 6374  out"] = saveDict
-0000e660: 5b22 4272 6561 6b6f 7574 225d 202b 2022  ["Breakout"] + "
-0000e670: 2850 6f74 656e 7469 616c 2922 0a20 2020  (Potential)".   
-0000e680: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-0000e690: 6963 745b 2242 7265 616b 6f75 7422 5d20  ict["Breakout"] 
-0000e6a0: 3d20 7363 7265 656e 4469 6374 5b22 4272  = screenDict["Br
-0000e6b0: 6561 6b6f 7574 225d 202b 2028 0a20 2020  eakout"] + (.   
-0000e6c0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-0000e6d0: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-0000e6e0: 6c6f 7254 6578 742e 4752 4545 4e20 2b20  lorText.GREEN + 
-0000e6f0: 2220 2850 6f74 656e 7469 616c 2922 202b  " (Potential)" +
-0000e700: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0000e710: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000e720: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000e730: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
-0000e740: 7572 6e20 4661 6c73 650a 0a20 2020 2023  urn False..    #
-0000e750: 2046 696e 6420 7374 6f63 6b73 2077 6974   Find stocks wit
-0000e760: 6820 7265 7665 7273 696e 6720 5053 4152  h reversing PSAR
-0000e770: 2061 6e64 2052 5349 0a20 2020 2064 6566   and RSI.    def
-0000e780: 2066 696e 6450 5341 5252 6576 6572 7361   findPSARReversa
-0000e790: 6c57 6974 6852 5349 2873 656c 662c 2064  lWithRSI(self, d
-0000e7a0: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
-0000e7b0: 6176 6544 6963 742c 6d69 6e52 5349 3d35  aveDict,minRSI=5
-0000e7c0: 3029 3a0a 2020 2020 2020 2020 6966 2064  0):.        if d
-0000e7d0: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-0000e7e0: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-0000e7f0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0000e800: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-0000e810: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-0000e820: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0000e830: 5b3a 3a2d 315d 0a20 2020 2020 2020 2070  [::-1].        p
-0000e840: 7361 7220 3d20 706b 7461 6c69 622e 7073  sar = pktalib.ps
-0000e850: 6172 2864 6174 615b 2248 6967 6822 5d2c  ar(data["High"],
-0000e860: 6461 7461 5b22 4c6f 7722 5d29 0a20 2020  data["Low"]).   
-0000e870: 2020 2020 2069 6620 6c65 6e28 7073 6172       if len(psar
-0000e880: 2920 3c20 333a 0a20 2020 2020 2020 2020  ) < 3:.         
-0000e890: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000e8a0: 2020 2020 2020 2020 7073 6172 203d 2070          psar = p
-0000e8b0: 7361 722e 7461 696c 2833 290a 2020 2020  sar.tail(3).    
-0000e8c0: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-0000e8d0: 7461 696c 2833 290a 2020 2020 2020 2020  tail(3).        
-0000e8e0: 2320 6461 794d 696e 7573 3250 7361 7220  # dayMinus2Psar 
-0000e8f0: 3d20 7073 6172 2e69 6c6f 635b 305d 0a20  = psar.iloc[0]. 
-0000e900: 2020 2020 2020 2064 6179 4d69 6e75 7331         dayMinus1
-0000e910: 5073 6172 203d 2070 7361 722e 696c 6f63  Psar = psar.iloc
-0000e920: 5b31 5d0a 2020 2020 2020 2020 6461 7950  [1].        dayP
-0000e930: 5341 5220 3d20 7073 6172 2e69 6c6f 635b  SAR = psar.iloc[
-0000e940: 325d 0a20 2020 2020 2020 2023 2064 6179  2].        # day
-0000e950: 4d69 6e75 7332 436c 6f73 6520 3d20 6461  Minus2Close = da
-0000e960: 7461 5b22 436c 6f73 6522 5d2e 696c 6f63  ta["Close"].iloc
-0000e970: 5b30 5d0a 2020 2020 2020 2020 6461 794d  [0].        dayM
-0000e980: 696e 7573 3143 6c6f 7365 203d 2064 6174  inus1Close = dat
-0000e990: 615b 2243 6c6f 7365 225d 2e69 6c6f 635b  a["Close"].iloc[
-0000e9a0: 315d 0a20 2020 2020 2020 2064 6179 436c  1].        dayCl
-0000e9b0: 6f73 6520 3d20 6461 7461 5b22 436c 6f73  ose = data["Clos
-0000e9c0: 6522 5d2e 696c 6f63 5b32 5d0a 2020 2020  e"].iloc[2].    
-0000e9d0: 2020 2020 2320 6461 794d 696e 7573 3252      # dayMinus2R
-0000e9e0: 5349 203d 2064 6174 615b 2252 5349 225d  SI = data["RSI"]
-0000e9f0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
-0000ea00: 2064 6179 4d69 6e75 7331 5253 4920 3d20   dayMinus1RSI = 
-0000ea10: 6461 7461 5b22 5253 4922 5d2e 696c 6f63  data["RSI"].iloc
-0000ea20: 5b31 5d0a 2020 2020 2020 2020 6461 7952  [1].        dayR
-0000ea30: 5349 203d 2064 6174 615b 2252 5349 225d  SI = data["RSI"]
-0000ea40: 2e69 6c6f 635b 325d 0a20 2020 2020 2020  .iloc[2].       
-0000ea50: 200a 2020 2020 2020 2020 6861 7352 6576   .        hasRev
-0000ea60: 6572 7361 6c3d 2028 2828 6461 794d 696e  ersal= (((dayMin
-0000ea70: 7573 3150 7361 7220 3e3d 2064 6179 4d69  us1Psar >= dayMi
-0000ea80: 6e75 7331 436c 6f73 6529 2061 6e64 205c  nus1Close) and \
-0000ea90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eaa0: 2020 2020 2028 6461 7943 6c6f 7365 203e       (dayClose >
-0000eab0: 3d20 6461 7950 5341 5229 2920 616e 6420  = dayPSAR)) and 
-0000eac0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0000ead0: 2020 2020 2020 2864 6179 4d69 6e75 7331        (dayMinus1
-0000eae0: 5253 4920 3c3d 206d 696e 5253 4929 2061  RSI <= minRSI) a
-0000eaf0: 6e64 205c 0a20 2020 2020 2020 2020 2020  nd \.           
-0000eb00: 2020 2020 2020 2020 2028 6461 7952 5349           (dayRSI
-0000eb10: 203e 3d20 6461 794d 696e 7573 3152 5349   >= dayMinus1RSI
-0000eb20: 2929 0a20 2020 2020 2020 2069 6620 6861  )).        if ha
-0000eb30: 7352 6576 6572 7361 6c3a 0a20 2020 2020  sReversal:.     
-0000eb40: 2020 2020 2020 2073 6176 6564 203d 2073         saved = s
-0000eb50: 656c 662e 6669 6e64 4375 7272 656e 7453  elf.findCurrentS
-0000eb60: 6176 6564 5661 6c75 6528 7363 7265 656e  avedValue(screen
-0000eb70: 4469 6374 2c73 6176 6544 6963 742c 2022  Dict,saveDict, "
-0000eb80: 5061 7474 6572 6e22 290a 2020 2020 2020  Pattern").      
-0000eb90: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-0000eba0: 5b22 5061 7474 6572 6e22 5d20 3d20 280a  ["Pattern"] = (.
-0000ebb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebc0: 7361 7665 645b 305d 200a 2020 2020 2020  saved[0] .      
-0000ebd0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0000ebe0: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
-0000ebf0: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
-0000ec00: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
-0000ec10: 2020 2020 2020 2020 2020 2020 202b 2066               + f
-0000ec20: 2250 5341 522d 5253 492d 5265 7622 0a20  "PSAR-RSI-Rev". 
-0000ec30: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000ec40: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0000ec50: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000ec60: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-0000ec70: 745b 2250 6174 7465 726e 225d 203d 2073  t["Pattern"] = s
-0000ec80: 6176 6564 5b31 5d20 2b20 6622 5053 4152  aved[1] + f"PSAR
-0000ec90: 2d52 5349 2d52 6576 220a 2020 2020 2020  -RSI-Rev".      
-0000eca0: 2020 2020 2020 2020 2020 2320 2828 2864            # (((d
-0000ecb0: 6179 4d69 6e75 7332 5073 6172 203e 3d20  ayMinus2Psar >= 
-0000ecc0: 6461 794d 696e 7573 3243 6c6f 7365 2920  dayMinus2Close) 
-0000ecd0: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
-0000ece0: 2020 2020 2020 2320 2828 6461 794d 696e        # ((dayMin
-0000ecf0: 7573 3143 6c6f 7365 203e 3d20 6461 794d  us1Close >= dayM
-0000ed00: 696e 7573 3150 7361 7229 2061 6e64 205c  inus1Psar) and \
-0000ed10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ed20: 2023 2028 6461 7943 6c6f 7365 203e 3d20   # (dayClose >= 
-0000ed30: 6461 7950 5341 5229 2929 2061 6e64 205c  dayPSAR))) and \
-0000ed40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ed50: 2023 2028 6461 794d 696e 7573 3252 5349   # (dayMinus2RSI
-0000ed60: 203e 3d20 6d69 6e52 5349 2920 616e 6420   >= minRSI) and 
-0000ed70: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0000ed80: 2020 2320 2864 6179 4d69 6e75 7331 5253    # (dayMinus1RS
-0000ed90: 4920 3e3d 2064 6179 4d69 6e75 7332 5253  I >= dayMinus2RS
-0000eda0: 4929 2061 6e64 205c 0a20 2020 2020 2020  I) and \.       
-0000edb0: 2020 2020 2020 2020 2023 2028 6461 7952           # (dayR
-0000edc0: 5349 203e 3d20 6461 794d 696e 7573 3152  SI >= dayMinus1R
-0000edd0: 5349 2929 206f 7220 5c0a 2020 2020 2020  SI)) or \.      
-0000ede0: 2020 7265 7475 726e 2068 6173 5265 7665    return hasReve
-0000edf0: 7273 616c 0a0a 2020 2020 2320 4669 6e64  rsal..    # Find
-0000ee00: 2073 746f 636b 2072 6576 6572 7369 6e67   stock reversing
-0000ee10: 2061 7420 6769 7665 6e20 4d41 0a20 2020   at given MA.   
-0000ee20: 2064 6566 2066 696e 6452 6576 6572 7361   def findReversa
-0000ee30: 6c4d 4128 7365 6c66 2c20 6466 2c20 7363  lMA(self, df, sc
-0000ee40: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
-0000ee50: 6374 2c20 6d61 4c65 6e67 7468 2c20 7065  ct, maLength, pe
-0000ee60: 7263 656e 7461 6765 3d30 2e30 3229 3a0a  rcentage=0.02):.
-0000ee70: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-0000ee80: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-0000ee90: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0000eea0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000eeb0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000eec0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-0000eed0: 206d 6152 616e 6765 203d 205b 392c 2031   maRange = [9, 1
-0000eee0: 302c 2032 302c 2035 302c 2032 3030 5d20  0, 20, 50, 200] 
-0000eef0: 6966 206d 614c 656e 6774 6820 696e 205b  if maLength in [
-0000ef00: 392c 3130 2c32 302c 3530 2c31 3030 5d20  9,10,20,50,100] 
-0000ef10: 656c 7365 205b 392c 3130 2c32 302c 3530  else [9,10,20,50
-0000ef20: 2c31 3030 2c6d 6152 616e 6765 5d0a 2020  ,100,maRange].  
-0000ef30: 2020 2020 2020 7265 7375 6c74 7320 3d20        results = 
-0000ef40: 5b5d 0a20 2020 2020 2020 2068 6173 5265  [].        hasRe
-0000ef50: 7665 7273 616c 7320 3d20 4661 6c73 650a  versals = False.
-0000ef60: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000ef70: 6174 615b 3a3a 2d31 5d0a 2020 2020 2020  ata[::-1].      
-0000ef80: 2020 7361 7665 6420 3d20 7365 6c66 2e66    saved = self.f
-0000ef90: 696e 6443 7572 7265 6e74 5361 7665 6456  indCurrentSavedV
-0000efa0: 616c 7565 2873 6372 6565 6e44 6963 742c  alue(screenDict,
-0000efb0: 7361 7665 4469 6374 2c20 224d 412d 5369  saveDict, "MA-Si
-0000efc0: 676e 616c 2229 0a20 2020 2020 2020 2066  gnal").        f
-0000efd0: 6f72 206d 614c 656e 6774 6820 696e 206d  or maLength in m
-0000efe0: 6152 616e 6765 3a0a 2020 2020 2020 2020  aRange:.        
-0000eff0: 2020 2020 6461 7461 436f 7079 203d 2064      dataCopy = d
-0000f000: 6174 610a 2020 2020 2020 2020 2020 2020  ata.            
-0000f010: 6966 2073 656c 662e 636f 6e66 6967 4d61  if self.configMa
-0000f020: 6e61 6765 722e 7573 6545 4d41 206f 7220  nager.useEMA or 
-0000f030: 6d61 4c65 6e67 7468 203d 3d20 393a 0a20  maLength == 9:. 
-0000f040: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000f050: 6152 6576 203d 2070 6b74 616c 6962 2e45  aRev = pktalib.E
-0000f060: 4d41 2864 6174 6143 6f70 795b 2243 6c6f  MA(dataCopy["Clo
-0000f070: 7365 225d 2c20 7469 6d65 7065 7269 6f64  se"], timeperiod
-0000f080: 3d6d 614c 656e 6774 6829 0a20 2020 2020  =maLength).     
-0000f090: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000f0a0: 2020 2020 2020 2020 2020 2020 206d 6152               maR
-0000f0b0: 6576 203d 2070 6b74 616c 6962 2e4d 4128  ev = pktalib.MA(
-0000f0c0: 6461 7461 436f 7079 5b22 436c 6f73 6522  dataCopy["Close"
-0000f0d0: 5d2c 2074 696d 6570 6572 696f 643d 6d61  ], timeperiod=ma
-0000f0e0: 4c65 6e67 7468 290a 2020 2020 2020 2020  Length).        
-0000f0f0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000f100: 2020 2020 2020 2020 2064 6174 6143 6f70           dataCop
-0000f110: 792e 6472 6f70 2822 6d61 5265 7622 2c20  y.drop("maRev", 
-0000f120: 6178 6973 3d31 2c20 696e 706c 6163 653d  axis=1, inplace=
-0000f130: 5472 7565 2c20 6572 726f 7273 3d22 6967  True, errors="ig
-0000f140: 6e6f 7265 2229 0a20 2020 2020 2020 2020  nore").         
-0000f150: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0000f160: 696f 6e3a 2320 7072 6167 6d61 3a20 6e6f  ion:# pragma: no
-0000f170: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
-0000f180: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-0000f190: 2020 2020 2020 2020 6461 7461 436f 7079          dataCopy
-0000f1a0: 2e69 6e73 6572 7428 6c65 6e28 6461 7461  .insert(len(data
-0000f1b0: 436f 7079 2e63 6f6c 756d 6e73 292c 2022  Copy.columns), "
-0000f1c0: 6d61 5265 7622 2c20 6d61 5265 7629 0a20  maRev", maRev). 
-0000f1d0: 2020 2020 2020 2020 2020 2064 6174 6143             dataC
-0000f1e0: 6f70 7920 3d20 6461 7461 436f 7079 5b3a  opy = dataCopy[:
-0000f1f0: 3a2d 315d 2e68 6561 6428 3429 0a20 2020  :-1].head(4).   
-0000f200: 2020 2020 2020 2020 2062 756c 6c69 7368           bullish
-0000f210: 4d41 5265 7665 7273 616c 203d 2064 6174  MAReversal = dat
-0000f220: 6143 6f70 795b 226d 6152 6576 225d 2e69  aCopy["maRev"].i
-0000f230: 6c6f 635b 305d 203e 3d20 6461 7461 436f  loc[0] >= dataCo
-0000f240: 7079 5b22 6d61 5265 7622 5d2e 696c 6f63  py["maRev"].iloc
-0000f250: 5b31 5d20 616e 6420 5c0a 2020 2020 2020  [1] and \.      
-0000f260: 2020 2020 2020 2020 2020 6461 7461 436f            dataCo
-0000f270: 7079 5b22 6d61 5265 7622 5d2e 696c 6f63  py["maRev"].iloc
-0000f280: 5b31 5d20 3e3d 2064 6174 6143 6f70 795b  [1] >= dataCopy[
-0000f290: 226d 6152 6576 225d 2e69 6c6f 635b 325d  "maRev"].iloc[2]
-0000f2a0: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
-0000f2b0: 2020 2020 2020 2020 2020 2064 6174 6143             dataC
-0000f2c0: 6f70 795b 226d 6152 6576 225d 2e69 6c6f  opy["maRev"].ilo
-0000f2d0: 635b 325d 203c 2064 6174 6143 6f70 795b  c[2] < dataCopy[
-0000f2e0: 226d 6152 6576 225d 2e69 6c6f 635b 335d  "maRev"].iloc[3]
-0000f2f0: 0a20 2020 2020 2020 2020 2020 2062 756c  .            bul
-0000f300: 6c69 7368 436c 6f73 6520 3d20 6461 7461  lishClose = data
-0000f310: 436f 7079 2e68 6561 6428 3129 5b22 436c  Copy.head(1)["Cl
-0000f320: 6f73 6522 5d2e 696c 6f63 5b30 5d20 3e3d  ose"].iloc[0] >=
-0000f330: 2064 6174 6143 6f70 792e 6865 6164 2831   dataCopy.head(1
-0000f340: 295b 226d 6152 6576 225d 2e69 6c6f 635b  )["maRev"].iloc[
-0000f350: 305d 0a20 2020 2020 2020 2020 2020 2062  0].            b
-0000f360: 6561 7269 7368 4d41 5265 7665 7273 616c  earishMAReversal
-0000f370: 203d 2064 6174 6143 6f70 795b 226d 6152   = dataCopy["maR
-0000f380: 6576 225d 2e69 6c6f 635b 305d 203c 3d20  ev"].iloc[0] <= 
-0000f390: 6461 7461 436f 7079 5b22 6d61 5265 7622  dataCopy["maRev"
-0000f3a0: 5d2e 696c 6f63 5b31 5d20 616e 6420 5c0a  ].iloc[1] and \.
-0000f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3c0: 6461 7461 436f 7079 5b22 6d61 5265 7622  dataCopy["maRev"
-0000f3d0: 5d2e 696c 6f63 5b31 5d20 3c3d 2064 6174  ].iloc[1] <= dat
-0000f3e0: 6143 6f70 795b 226d 6152 6576 225d 2e69  aCopy["maRev"].i
-0000f3f0: 6c6f 635b 325d 2061 6e64 205c 0a20 2020  loc[2] and \.   
-0000f400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f410: 2064 6174 6143 6f70 795b 226d 6152 6576   dataCopy["maRev
-0000f420: 225d 2e69 6c6f 635b 325d 203e 2064 6174  "].iloc[2] > dat
-0000f430: 6143 6f70 795b 226d 6152 6576 225d 2e69  aCopy["maRev"].i
-0000f440: 6c6f 635b 335d 0a20 2020 2020 2020 2020  loc[3].         
-0000f450: 2020 2069 7352 6563 656e 7443 6c6f 7365     isRecentClose
-0000f460: 5769 7468 696e 5065 7263 656e 7452 616e  WithinPercentRan
-0000f470: 6765 203d 2064 6174 6143 6f70 792e 6571  ge = dataCopy.eq
-0000f480: 7561 6c73 2864 6174 6143 6f70 795b 2864  uals(dataCopy[(d
-0000f490: 6174 6143 6f70 792e 436c 6f73 6520 3e3d  ataCopy.Close >=
-0000f4a0: 2028 6461 7461 436f 7079 2e6d 6152 6576   (dataCopy.maRev
-0000f4b0: 202d 2028 6461 7461 436f 7079 2e6d 6152   - (dataCopy.maR
-0000f4c0: 6576 202a 2070 6572 6365 6e74 6167 6529  ev * percentage)
-0000f4d0: 2929 2026 2028 6461 7461 436f 7079 2e43  )) & (dataCopy.C
-0000f4e0: 6c6f 7365 203c 3d20 2864 6174 6143 6f70  lose <= (dataCop
-0000f4f0: 792e 6d61 5265 7620 2b20 2864 6174 6143  y.maRev + (dataC
-0000f500: 6f70 792e 6d61 5265 7620 2a20 7065 7263  opy.maRev * perc
-0000f510: 656e 7461 6765 2929 295d 290a 2020 2020  entage)))]).    
-0000f520: 2020 2020 2020 2020 6966 2028 6973 5265          if (isRe
-0000f530: 6365 6e74 436c 6f73 6557 6974 6869 6e50  centCloseWithinP
-0000f540: 6572 6365 6e74 5261 6e67 6520 616e 6420  ercentRange and 
-0000f550: 6275 6c6c 6973 6843 6c6f 7365 2061 6e64  bullishClose and
-0000f560: 2062 756c 6c69 7368 4d41 5265 7665 7273   bullishMARevers
-0000f570: 616c 2920 6f72 205c 0a20 2020 2020 2020  al) or \.       
-0000f580: 2020 2020 2020 2020 2028 6973 5265 6365           (isRece
-0000f590: 6e74 436c 6f73 6557 6974 6869 6e50 6572  ntCloseWithinPer
-0000f5a0: 6365 6e74 5261 6e67 6520 616e 6420 6e6f  centRange and no
-0000f5b0: 7420 6275 6c6c 6973 6843 6c6f 7365 2061  t bullishClose a
-0000f5c0: 6e64 2062 6561 7269 7368 4d41 5265 7665  nd bearishMAReve
-0000f5d0: 7273 616c 293a 0a20 2020 2020 2020 2020  rsal):.         
-0000f5e0: 2020 2020 2020 2068 6173 5265 7665 7273         hasRevers
-0000f5f0: 616c 7320 3d20 5472 7565 0a20 2020 2020  als = True.     
-0000f600: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0000f610: 7473 2e61 7070 656e 6428 7374 7228 6d61  ts.append(str(ma
-0000f620: 4c65 6e67 7468 2929 0a20 2020 2020 2020  Length)).       
-0000f630: 2069 6620 6861 7352 6576 6572 7361 6c73   if hasReversals
-0000f640: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
-0000f650: 7265 656e 4469 6374 5b22 4d41 2d53 6967  reenDict["MA-Sig
-0000f660: 6e61 6c22 5d20 3d20 280a 2020 2020 2020  nal"] = (.      
-0000f670: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
-0000f680: 305d 200a 2020 2020 2020 2020 2020 2020  0] .            
-0000f690: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-0000f6a0: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
-0000f6b0: 2020 2020 202b 2028 636f 6c6f 7254 6578       + (colorTex
-0000f6c0: 742e 4752 4545 4e20 6966 2062 756c 6c69  t.GREEN if bulli
-0000f6d0: 7368 4d41 5265 7665 7273 616c 2065 6c73  shMAReversal els
-0000f6e0: 6520 2863 6f6c 6f72 5465 7874 2e46 4149  e (colorText.FAI
-0000f6f0: 4c20 6966 2062 6561 7269 7368 4d41 5265  L if bearishMARe
-0000f700: 7665 7273 616c 2065 6c73 6520 636f 6c6f  versal else colo
-0000f710: 7254 6578 742e 5741 524e 2929 0a20 2020  rText.WARN)).   
-0000f720: 2020 2020 2020 2020 2020 2020 202b 2066               + f
-0000f730: 2252 6576 6572 7361 6c2d 5b7b 272c 272e  "Reversal-[{','.
-0000f740: 6a6f 696e 2872 6573 756c 7473 297d 5d7b  join(results)}]{
-0000f750: 2745 4d41 2720 6966 2028 6d61 4c65 6e67  'EMA' if (maLeng
-0000f760: 7468 203d 3d20 3920 6f72 2073 656c 662e  th == 9 or self.
-0000f770: 636f 6e66 6967 4d61 6e61 6765 722e 7573  configManager.us
-0000f780: 6545 4d41 2920 656c 7365 2027 4d41 277d  eEMA) else 'MA'}
-0000f790: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000f7a0: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-0000f7b0: 440a 2020 2020 2020 2020 2020 2020 290a  D.            ).
-0000f7c0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-0000f7d0: 4469 6374 5b22 4d41 2d53 6967 6e61 6c22  Dict["MA-Signal"
-0000f7e0: 5d20 3d20 7361 7665 645b 315d 202b 2066  ] = saved[1] + f
-0000f7f0: 2252 6576 6572 7361 6c2d 5b7b 272c 272e  "Reversal-[{','.
-0000f800: 6a6f 696e 2872 6573 756c 7473 297d 5d7b  join(results)}]{
-0000f810: 2745 4d41 2720 6966 2028 6d61 4c65 6e67  'EMA' if (maLeng
-0000f820: 7468 203d 3d20 3920 6f72 2073 656c 662e  th == 9 or self.
-0000f830: 636f 6e66 6967 4d61 6e61 6765 722e 7573  configManager.us
-0000f840: 6545 4d41 2920 656c 7365 2027 4d41 277d  eEMA) else 'MA'}
-0000f850: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0000f860: 2068 6173 5265 7665 7273 616c 730a 0a20   hasReversals.. 
-0000f870: 2020 2064 6566 2066 696e 6443 7572 7265     def findCurre
-0000f880: 6e74 5361 7665 6456 616c 7565 2873 656c  ntSavedValue(sel
-0000f890: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
-0000f8a0: 6176 6544 6963 742c 206b 6579 293a 0a20  aveDict, key):. 
-0000f8b0: 2020 2020 2020 2065 7869 7374 696e 6753         existingS
-0000f8c0: 6372 6565 6e20 3d20 7363 7265 656e 4469  creen = screenDi
-0000f8d0: 6374 2e67 6574 286b 6579 290a 2020 2020  ct.get(key).    
-0000f8e0: 2020 2020 6578 6973 7469 6e67 5361 7665      existingSave
-0000f8f0: 203d 2073 6176 6544 6963 742e 6765 7428   = saveDict.get(
-0000f900: 6b65 7929 0a20 2020 2020 2020 2065 7869  key).        exi
-0000f910: 7374 696e 6753 6372 6565 6e20 3d20 6622  stingScreen = f"
-0000f920: 7b65 7869 7374 696e 6753 6372 6565 6e7d  {existingScreen}
-0000f930: 2c20 2220 6966 2028 6578 6973 7469 6e67  , " if (existing
-0000f940: 5363 7265 656e 2069 7320 6e6f 7420 4e6f  Screen is not No
-0000f950: 6e65 2061 6e64 206c 656e 2865 7869 7374  ne and len(exist
-0000f960: 696e 6753 6372 6565 6e29 203e 2030 2920  ingScreen) > 0) 
-0000f970: 656c 7365 2022 220a 2020 2020 2020 2020  else "".        
-0000f980: 6578 6973 7469 6e67 5361 7665 203d 2066  existingSave = f
-0000f990: 227b 6578 6973 7469 6e67 5361 7665 7d2c  "{existingSave},
-0000f9a0: 2022 2069 6620 2865 7869 7374 696e 6753   " if (existingS
-0000f9b0: 6176 6520 6973 206e 6f74 204e 6f6e 6520  ave is not None 
-0000f9c0: 616e 6420 6c65 6e28 6578 6973 7469 6e67  and len(existing
-0000f9d0: 5361 7665 2920 3e20 3029 2065 6c73 6520  Save) > 0) else 
-0000f9e0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0000f9f0: 6e20 6578 6973 7469 6e67 5363 7265 656e  n existingScreen
-0000fa00: 2c20 6578 6973 7469 6e67 5361 7665 0a0a  , existingSave..
-0000fa10: 2020 2020 2320 406d 6561 7375 7265 5f74      # @measure_t
-0000fa20: 696d 650a 2020 2020 6465 6620 6669 6e64  ime.    def find
-0000fa30: 4262 616e 6473 5371 7565 657a 6528 7365  BbandsSqueeze(se
-0000fa40: 6c66 2c66 756c 6c44 6174 612c 2073 6372  lf,fullData, scr
-0000fa50: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
-0000fa60: 742c 2066 696c 7465 723d 3429 3a0a 2020  t, filter=4):.  
-0000fa70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000fa80: 2020 5468 6520 5454 4d20 5371 7565 657a    The TTM Squeez
-0000fa90: 6520 696e 6469 6361 746f 7220 6d65 6173  e indicator meas
-0000faa0: 7572 6573 2074 6865 2072 656c 6174 696f  ures the relatio
-0000fab0: 6e73 6869 7020 6265 7477 6565 6e20 7468  nship between th
-0000fac0: 6520 0a20 2020 2020 2020 2042 6f6c 6c69  e .        Bolli
-0000fad0: 6e67 6572 2042 616e 6473 2061 6e64 204b  nger Bands and K
-0000fae0: 656c 746e 6572 2773 2043 6861 6e6e 656c  eltner's Channel
-0000faf0: 2e20 5768 656e 2074 6865 2076 6f6c 6174  . When the volat
-0000fb00: 696c 6974 7920 696e 6372 6561 7365 732c  ility increases,
-0000fb10: 200a 2020 2020 2020 2020 736f 2064 6f65   .        so doe
-0000fb20: 7320 7468 6520 6469 7374 616e 6365 2062  s the distance b
-0000fb30: 6574 7765 656e 2074 6865 2062 616e 6473  etween the bands
-0000fb40: 2c20 616e 6420 636f 6e76 6572 7365 6c79  , and conversely
-0000fb50: 2c20 7768 656e 2074 6865 200a 2020 2020  , when the .    
-0000fb60: 2020 2020 766f 6c61 7469 6c69 7479 2064      volatility d
-0000fb70: 6563 6c69 6e65 732c 2074 6865 2064 6973  eclines, the dis
-0000fb80: 7461 6e63 6520 616c 736f 2064 6563 7265  tance also decre
-0000fb90: 6173 6573 2e20 5468 6520 5371 7565 657a  ases. The Squeez
-0000fba0: 6520 696e 6469 6361 746f 7220 0a20 2020  e indicator .   
-0000fbb0: 2020 2020 2066 696e 6473 2073 6563 7469       finds secti
-0000fbc0: 6f6e 7320 6f66 2074 6865 2042 6f6c 6c69  ons of the Bolli
-0000fbd0: 6e67 6572 2042 616e 6473 2073 7475 6479  nger Bands study
-0000fbe0: 2077 6869 6368 2066 616c 6c20 696e 7369   which fall insi
-0000fbf0: 6465 2074 6865 200a 2020 2020 2020 2020  de the .        
-0000fc00: 4b65 6c74 6e65 7227 7320 4368 616e 6e65  Keltner's Channe
-0000fc10: 6c73 2e0a 2020 2020 2020 2020 0a20 2020  ls..        .   
-0000fc20: 2020 2020 2041 7420 7468 6520 6d6f 6d65       At the mome
-0000fc30: 6e74 2074 6869 7320 7371 7565 657a 6520  nt this squeeze 
-0000fc40: 6861 7070 656e 732c 2061 2070 7269 6365  happens, a price
-0000fc50: 2062 7265 616b 6f75 7420 6672 6f6d 2074   breakout from t
-0000fc60: 6865 2075 7070 6572 200a 2020 2020 2020  he upper .      
-0000fc70: 2020 426f 6c6c 696e 6765 7220 4261 6e64    Bollinger Band
-0000fc80: 2077 6f75 6c64 2069 6e64 6963 6174 6520   would indicate 
-0000fc90: 7468 6520 706f 7373 6962 696c 6974 7920  the possibility 
-0000fca0: 6f66 2061 6e20 7570 7472 656e 6420 696e  of an uptrend in
-0000fcb0: 2074 6865 200a 2020 2020 2020 2020 6675   the .        fu
-0000fcc0: 7475 7265 2e20 5468 6973 2069 7320 6261  ture. This is ba
-0000fcd0: 636b 6564 2062 7920 7468 6520 6661 6374  cked by the fact
-0000fce0: 2074 6861 7420 6f6e 6365 2074 6865 2070   that once the p
-0000fcf0: 7269 6365 2073 7461 7274 7320 6272 6561  rice starts brea
-0000fd00: 6b69 6e67 200a 2020 2020 2020 2020 6f75  king .        ou
-0000fd10: 7420 6f66 2074 6865 2062 616e 6473 2c20  t of the bands, 
-0000fd20: 6974 2077 6f75 6c64 206d 6561 6e20 6120  it would mean a 
-0000fd30: 7265 6c61 7861 7469 6f6e 206f 6620 7468  relaxation of th
-0000fd40: 6520 7371 7565 657a 6520 616e 6420 7468  e squeeze and th
-0000fd50: 6520 0a20 2020 2020 2020 2070 6f73 7369  e .        possi
-0000fd60: 6269 6c69 7479 206f 6620 6869 6768 206d  bility of high m
-0000fd70: 6172 6b65 7420 766f 6c61 7469 6c69 7479  arket volatility
-0000fd80: 2061 6e64 2070 7269 6365 206d 6f76 656d   and price movem
-0000fd90: 656e 7420 696e 2074 6865 2066 7574 7572  ent in the futur
-0000fda0: 652e 200a 2020 2020 2020 2020 5369 6d69  e. .        Simi
-0000fdb0: 6c61 726c 792c 2061 2070 7269 6365 2062  larly, a price b
-0000fdc0: 7265 616b 6f75 7420 6672 6f6d 2074 6865  reakout from the
-0000fdd0: 206c 6f77 6572 2042 6f6c 6c69 6e67 6572   lower Bollinger
-0000fde0: 2042 616e 6420 6166 7465 7220 6120 7371   Band after a sq
-0000fdf0: 7565 657a 6520 0a20 2020 2020 2020 2077  ueeze .        w
-0000fe00: 6f75 6c64 2069 6e64 6963 6174 6520 7468  ould indicate th
-0000fe10: 6520 706f 7373 6962 696c 6974 7920 6f66  e possibility of
-0000fe20: 2061 2064 6f77 6e74 7265 6e64 2069 6e20   a downtrend in 
-0000fe30: 7468 6520 6675 7475 7265 2061 6e64 2061  the future and a
-0000fe40: 6e20 0a20 2020 2020 2020 2069 6e63 7265  n .        incre
-0000fe50: 6173 6564 206d 6172 6b65 7420 766f 6c61  ased market vola
-0000fe60: 7469 6c69 7479 2069 6e20 7468 6520 7361  tility in the sa
-0000fe70: 6d65 2064 6972 6563 7469 6f6e 2e20 5768  me direction. Wh
-0000fe80: 656e 2074 6865 206d 6172 6b65 7420 0a20  en the market . 
-0000fe90: 2020 2020 2020 2066 696e 6973 6865 7320         finishes 
-0000fea0: 6120 6d6f 7665 2c20 7468 6520 696e 6469  a move, the indi
-0000feb0: 6361 746f 7220 7475 726e 7320 6f66 662c  cator turns off,
-0000fec0: 2077 6869 6368 2063 6f72 7265 7370 6f6e   which correspon
-0000fed0: 6473 2074 6f20 6261 6e64 7320 0a20 2020  ds to bands .   
-0000fee0: 2020 2020 2068 6176 696e 6720 7075 7368       having push
-0000fef0: 6564 2077 656c 6c20 6f75 7473 6964 6520  ed well outside 
-0000ff00: 7468 6520 7261 6e67 6520 6f66 204b 656c  the range of Kel
-0000ff10: 746e 6572 2773 2043 6861 6e6e 656c 732e  tner's Channels.
-0000ff20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ff30: 2020 2020 2069 6620 6675 6c6c 4461 7461       if fullData
-0000ff40: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
-0000ff50: 6675 6c6c 4461 7461 2920 3c20 3230 3a0a  fullData) < 20:.
-0000ff60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000ff70: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0000ff80: 206f 6c64 6573 7452 6563 6f72 6473 4669   oldestRecordsFi
-0000ff90: 7273 745f 6466 203d 2066 756c 6c44 6174  rst_df = fullDat
-0000ffa0: 612e 6865 6164 2833 3029 2e63 6f70 7928  a.head(30).copy(
-0000ffb0: 290a 2020 2020 2020 2020 6c61 7465 7374  ).        latest
-0000ffc0: 5265 636f 7264 7346 6972 7374 5f64 6620  RecordsFirst_df 
-0000ffd0: 3d20 6f6c 6465 7374 5265 636f 7264 7346  = oldestRecordsF
-0000ffe0: 6972 7374 5f64 665b 3a3a 2d31 5d2e 7461  irst_df[::-1].ta
-0000fff0: 696c 2833 3029 0a20 2020 2020 2020 206c  il(30).        l
-00010000: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
-00010010: 745f 6466 203d 206c 6174 6573 7452 6563  t_df = latestRec
-00010020: 6f72 6473 4669 7273 745f 6466 2e66 696c  ordsFirst_df.fil
-00010030: 6c6e 6128 3029 0a20 2020 2020 2020 206c  lna(0).        l
-00010040: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
-00010050: 745f 6466 203d 206c 6174 6573 7452 6563  t_df = latestRec
-00010060: 6f72 6473 4669 7273 745f 6466 2e72 6570  ordsFirst_df.rep
-00010070: 6c61 6365 285b 6e70 2e69 6e66 2c20 2d6e  lace([np.inf, -n
-00010080: 702e 696e 665d 2c20 3029 0a20 2020 2020  p.inf], 0).     
-00010090: 2020 2023 2042 6f6c 6c69 6e67 6572 2062     # Bollinger b
-000100a0: 616e 6473 0a20 2020 2020 2020 206c 6174  ands.        lat
-000100b0: 6573 7452 6563 6f72 6473 4669 7273 745f  estRecordsFirst_
-000100c0: 6466 2e6c 6f63 5b3a 2c27 4242 616e 6473  df.loc[:,'BBands
-000100d0: 2d55 275d 2c20 6c61 7465 7374 5265 636f  -U'], latestReco
-000100e0: 7264 7346 6972 7374 5f64 662e 6c6f 635b  rdsFirst_df.loc[
-000100f0: 3a2c 2742 4261 6e64 732d 4d27 5d2c 206c  :,'BBands-M'], l
-00010100: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
-00010110: 745f 6466 2e6c 6f63 5b3a 2c27 4242 616e  t_df.loc[:,'BBan
-00010120: 6473 2d4c 275d 203d 2070 6b74 616c 6962  ds-L'] = pktalib
-00010130: 2e42 4241 4e44 5328 6c61 7465 7374 5265  .BBANDS(latestRe
-00010140: 636f 7264 7346 6972 7374 5f64 665b 2243  cordsFirst_df["C
-00010150: 6c6f 7365 225d 2c20 3230 290a 2020 2020  lose"], 20).    
-00010160: 2020 2020 2320 636f 6d70 7574 6520 4b65      # compute Ke
-00010170: 6c74 6e65 7227 7320 6368 616e 6e65 6c0a  ltner's channel.
-00010180: 2020 2020 2020 2020 6c61 7465 7374 5265          latestRe
-00010190: 636f 7264 7346 6972 7374 5f64 665b 276c  cordsFirst_df['l
-000101a0: 6f77 5f6b 656c 275d 2c20 6c61 7465 7374  ow_kel'], latest
-000101b0: 5265 636f 7264 7346 6972 7374 5f64 665b  RecordsFirst_df[
-000101c0: 2775 7070 5f6b 656c 275d 203d 2070 6b74  'upp_kel'] = pkt
-000101d0: 616c 6962 2e4b 656c 746e 6572 7343 6861  alib.KeltnersCha
-000101e0: 6e6e 656c 286c 6174 6573 7452 6563 6f72  nnel(latestRecor
-000101f0: 6473 4669 7273 745f 6466 5b22 4869 6768  dsFirst_df["High
-00010200: 225d 2c20 6c61 7465 7374 5265 636f 7264  "], latestRecord
-00010210: 7346 6972 7374 5f64 665b 224c 6f77 225d  sFirst_df["Low"]
-00010220: 2c6c 6174 6573 7452 6563 6f72 6473 4669  ,latestRecordsFi
-00010230: 7273 745f 6466 5b22 436c 6f73 6522 5d2c  rst_df["Close"],
-00010240: 3230 290a 2020 2020 2020 2020 2320 7371  20).        # sq
-00010250: 7565 657a 6520 696e 6469 6361 746f 720a  ueeze indicator.
-00010260: 2020 2020 2020 2020 6465 6620 696e 5f73          def in_s
-00010270: 7175 6565 7a65 2864 6629 3a0a 2020 2020  queeze(df):.    
-00010280: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00010290: 665b 276c 6f77 5f6b 656c 275d 203c 2064  f['low_kel'] < d
-000102a0: 665b 2742 4261 6e64 732d 4c27 5d20 3c20  f['BBands-L'] < 
-000102b0: 6466 5b27 4242 616e 6473 2d55 275d 203c  df['BBands-U'] <
-000102c0: 2064 665b 2775 7070 5f6b 656c 275d 0a0a   df['upp_kel']..
-000102d0: 2020 2020 2020 2020 6c61 7465 7374 5265          latestRe
-000102e0: 636f 7264 7346 6972 7374 5f64 665b 2773  cordsFirst_df['s
-000102f0: 7175 6565 7a65 275d 203d 206c 6174 6573  queeze'] = lates
-00010300: 7452 6563 6f72 6473 4669 7273 745f 6466  tRecordsFirst_df
-00010310: 2e61 7070 6c79 2869 6e5f 7371 7565 657a  .apply(in_squeez
-00010320: 652c 2061 7869 733d 3129 0a0a 2020 2020  e, axis=1)..    
-00010330: 2020 2020 2320 4c65 7427 7320 7265 7669      # Let's revi
-00010340: 6577 206a 7573 7420 7468 6520 7072 6576  ew just the prev
-00010350: 696f 7573 2033 2063 616e 646c 6573 2069  ious 3 candles i
-00010360: 6e63 6c75 6469 6e67 2074 6f64 6179 2028  ncluding today (
-00010370: 6174 2074 6865 2065 6e64 290a 2020 2020  at the end).    
-00010380: 2020 2020 6c61 7465 7374 5265 636f 7264      latestRecord
-00010390: 7346 6972 7374 5f64 6620 3d20 6c61 7465  sFirst_df = late
-000103a0: 7374 5265 636f 7264 7346 6972 7374 5f64  stRecordsFirst_d
-000103b0: 662e 7461 696c 2833 290a 2020 2020 2020  f.tail(3).      
-000103c0: 2020 2320 7374 6f63 6b20 6973 2063 6f6d    # stock is com
-000103d0: 696e 6720 6f75 7420 6f66 2074 6865 2073  ing out of the s
-000103e0: 7175 6565 7a65 0a20 2020 2020 2020 2073  queeze.        s
-000103f0: 6176 6564 203d 2073 656c 662e 6669 6e64  aved = self.find
-00010400: 4375 7272 656e 7453 6176 6564 5661 6c75  CurrentSavedValu
-00010410: 6528 7363 7265 656e 4469 6374 2c20 7361  e(screenDict, sa
-00010420: 7665 4469 6374 2c20 2250 6174 7465 726e  veDict, "Pattern
-00010430: 2229 0a20 2020 2020 2020 2063 616e 646c  ").        candl
-00010440: 6533 5371 7a20 3d20 6c61 7465 7374 5265  e3Sqz = latestRe
-00010450: 636f 7264 7346 6972 7374 5f64 662e 696c  cordsFirst_df.il
-00010460: 6f63 5b2d 335d 5b22 7371 7565 657a 6522  oc[-3]["squeeze"
-00010470: 5d0a 2020 2020 2020 2020 6361 6e64 6c65  ].        candle
-00010480: 3153 717a 203d 206c 6174 6573 7452 6563  1Sqz = latestRec
-00010490: 6f72 6473 4669 7273 745f 6466 2e69 6c6f  ordsFirst_df.ilo
-000104a0: 635b 2d31 5d5b 2273 7175 6565 7a65 225d  c[-1]["squeeze"]
-000104b0: 0a20 2020 2020 2020 2063 616e 646c 6532  .        candle2
-000104c0: 5371 7a20 3d20 6c61 7465 7374 5265 636f  Sqz = latestReco
-000104d0: 7264 7346 6972 7374 5f64 662e 696c 6f63  rdsFirst_df.iloc
-000104e0: 5b2d 325d 5b22 7371 7565 657a 6522 5d0a  [-2]["squeeze"].
-000104f0: 2020 2020 2020 2020 6966 2063 616e 646c          if candl
-00010500: 6533 5371 7a20 616e 6420 6e6f 7420 6361  e3Sqz and not ca
-00010510: 6e64 6c65 3153 717a 3a0a 2020 2020 2020  ndle1Sqz:.      
-00010520: 2020 2020 2020 2320 3372 6420 6361 6e64        # 3rd cand
-00010530: 6c65 2066 726f 6d20 7468 6520 6d6f 7374  le from the most
-00010540: 2072 6563 656e 7420 6f6e 6520 7761 7320   recent one was 
-00010550: 696e 2073 7175 6565 7a65 2062 7574 2074  in squeeze but t
-00010560: 6865 206d 6f73 7420 7265 6365 6e74 206f  he most recent o
-00010570: 6e65 2069 7320 6e6f 742e 0a20 2020 2020  ne is not..     
-00010580: 2020 2020 2020 2069 6620 6669 6c74 6572         if filter
-00010590: 206e 6f74 2069 6e20 5b31 2c33 2c34 5d3a   not in [1,3,4]:
-000105a0: 2023 2042 7579 2f53 656c 6c2f 416c 6c0a   # Buy/Sell/All.
-000105b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105c0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-000105d0: 2020 2020 2020 2020 2023 2064 6563 6964           # decid
-000105e0: 6520 7768 6963 6820 6163 7469 6f6e 2074  e which action t
-000105f0: 6f20 7461 6b65 2062 7920 636f 6d70 6172  o take by compar
-00010600: 696e 6720 6469 7374 616e 6365 7320 2020  ing distances   
-00010610: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00010620: 2020 2020 2020 2020 2020 6469 7374 616e            distan
-00010630: 6365 5f74 6f5f 7570 7065 7220 3d20 6162  ce_to_upper = ab
-00010640: 7328 6c61 7465 7374 5265 636f 7264 7346  s(latestRecordsF
-00010650: 6972 7374 5f64 665b 2742 4261 6e64 732d  irst_df['BBands-
-00010660: 5527 5d2e 7661 6c75 6573 5b2d 315d 202d  U'].values[-1] -
-00010670: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
-00010680: 7273 745f 6466 5b27 436c 6f73 6527 5d2e  rst_df['Close'].
-00010690: 7661 6c75 6573 5b2d 315d 290a 2020 2020  values[-1]).    
-000106a0: 2020 2020 2020 2020 6469 7374 616e 6365          distance
-000106b0: 5f74 6f5f 6c6f 7765 7220 3d20 6162 7328  _to_lower = abs(
-000106c0: 6c61 7465 7374 5265 636f 7264 7346 6972  latestRecordsFir
-000106d0: 7374 5f64 665b 2742 4261 6e64 732d 4c27  st_df['BBands-L'
-000106e0: 5d2e 7661 6c75 6573 5b2d 315d 202d 206c  ].values[-1] - l
-000106f0: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
-00010700: 745f 6466 5b27 436c 6f73 6527 5d2e 7661  t_df['Close'].va
-00010710: 6c75 6573 5b2d 315d 290a 2020 2020 2020  lues[-1]).      
-00010720: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00010730: 2020 2061 6374 696f 6e20 3d20 4661 6c73     action = Fals
-00010740: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-00010750: 2064 6973 7461 6e63 655f 746f 5f75 7070   distance_to_upp
-00010760: 6572 203c 2064 6973 7461 6e63 655f 746f  er < distance_to
-00010770: 5f6c 6f77 6572 3a0a 2020 2020 2020 2020  _lower:.        
-00010780: 2020 2020 2020 2020 6966 2066 696c 7465          if filte
-00010790: 7220 6e6f 7420 696e 205b 312c 345d 3a20  r not in [1,4]: 
-000107a0: 2320 4275 792f 416c 6c0a 2020 2020 2020  # Buy/All.      
-000107b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000107c0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-000107d0: 2020 2020 2020 2020 2020 2061 6374 696f             actio
-000107e0: 6e20 3d20 5472 7565 0a20 2020 2020 2020  n = True.       
-000107f0: 2020 2020 2065 6c69 6620 6669 6c74 6572       elif filter
-00010800: 206e 6f74 2069 6e20 5b33 2c34 5d3a 2023   not in [3,4]: #
-00010810: 2053 656c 6c2f 416c 6c0a 2020 2020 2020   Sell/All.      
-00010820: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00010830: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-00010840: 2020 2073 6372 6565 6e44 6963 745b 2250     screenDict["P
-00010850: 6174 7465 726e 225d 203d 2073 6176 6564  attern"] = saved
-00010860: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-00010870: 424f 4c44 202b 2028 636f 6c6f 7254 6578  BOLD + (colorTex
-00010880: 742e 4752 4545 4e20 6966 2061 6374 696f  t.GREEN if actio
-00010890: 6e20 656c 7365 2063 6f6c 6f72 5465 7874  n else colorText
-000108a0: 2e46 4149 4c29 202b 2066 2242 4261 6e64  .FAIL) + f"BBand
-000108b0: 732d 5351 5a2d 7b27 4275 7927 2069 6620  s-SQZ-{'Buy' if 
-000108c0: 6163 7469 6f6e 2065 6c73 6520 2753 656c  action else 'Sel
-000108d0: 6c27 7d22 202b 2063 6f6c 6f72 5465 7874  l'}" + colorText
-000108e0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-000108f0: 2073 6176 6544 6963 745b 2250 6174 7465   saveDict["Patte
-00010900: 726e 225d 203d 2073 6176 6564 5b31 5d20  rn"] = saved[1] 
-00010910: 2b20 6622 5454 4d2d 5351 5a2d 7b27 4275  + f"TTM-SQZ-{'Bu
-00010920: 7927 2069 6620 6163 7469 6f6e 2065 6c73  y' if action els
-00010930: 6520 2753 656c 6c27 7d22 0a20 2020 2020  e 'Sell'}".     
-00010940: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00010950: 7565 0a20 2020 2020 2020 2065 6c69 6620  ue.        elif 
-00010960: 6361 6e64 6c65 3353 717a 2061 6e64 2063  candle3Sqz and c
-00010970: 616e 646c 6532 5371 7a20 616e 6420 6361  andle2Sqz and ca
-00010980: 6e64 6c65 3153 717a 3a0a 2020 2020 2020  ndle1Sqz:.      
-00010990: 2020 2020 2020 2320 4c61 7374 2033 2063        # Last 3 c
-000109a0: 616e 646c 6573 2069 6e20 7371 7565 657a  andles in squeez
-000109b0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-000109c0: 2066 696c 7465 7220 6e6f 7420 696e 205b   filter not in [
-000109d0: 322c 345d 3a20 2320 5371 5a2f 416c 6c0a  2,4]: # SqZ/All.
-000109e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109f0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-00010a00: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-00010a10: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
-00010a20: 2066 277b 7361 7665 645b 305d 7d7b 636f   f'{saved[0]}{co
-00010a30: 6c6f 7254 6578 742e 424f 4c44 7d7b 636f  lorText.BOLD}{co
-00010a40: 6c6f 7254 6578 742e 5741 524e 7d54 544d  lorText.WARN}TTM
-00010a50: 2d53 515a 7b63 6f6c 6f72 5465 7874 2e45  -SQZ{colorText.E
-00010a60: 4e44 7d27 0a20 2020 2020 2020 2020 2020  ND}'.           
-00010a70: 2073 6176 6544 6963 745b 2250 6174 7465   saveDict["Patte
-00010a80: 726e 225d 203d 2066 277b 7361 7665 645b  rn"] = f'{saved[
-00010a90: 315d 7d54 544d 2d53 515a 270a 2020 2020  1]}TTM-SQZ'.    
-00010aa0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00010ab0: 7275 650a 2020 2020 2020 2020 7265 7475  rue.        retu
-00010ac0: 726e 2046 616c 7365 0a0a 2020 2020 6465  rn False..    de
-00010ad0: 6620 6669 6e64 496e 7472 6164 6179 4869  f findIntradayHi
-00010ae0: 6768 4372 6f73 736f 7665 7228 7365 6c66  ghCrossover(self
-00010af0: 2c20 6466 2c20 6166 7465 7254 696d 6573  , df, afterTimes
-00010b00: 7461 6d70 3d4e 6f6e 6529 3a0a 2020 2020  tamp=None):.    
-00010b10: 2020 2020 6966 2064 6620 6973 204e 6f6e      if df is Non
-00010b20: 6520 6f72 206c 656e 2864 6629 203d 3d20  e or len(df) == 
-00010b30: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
-00010b40: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00010b50: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
-00010b60: 7079 2829 0a20 2020 2020 2020 2064 6174  py().        dat
-00010b70: 6120 3d20 6461 7461 2e66 696c 6c6e 6128  a = data.fillna(
-00010b80: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
-00010b90: 3d20 6461 7461 2e72 6570 6c61 6365 285b  = data.replace([
-00010ba0: 6e70 2e69 6e66 2c20 2d6e 702e 696e 665d  np.inf, -np.inf]
-00010bb0: 2c20 3029 0a20 2020 2020 2020 2064 6174  , 0).        dat
-00010bc0: 6120 3d20 6461 7461 5b3a 3a2d 315d 2020  a = data[::-1]  
-00010bd0: 2320 5265 7665 7273 6520 7468 6520 6461  # Reverse the da
-00010be0: 7461 6672 616d 6520 736f 2074 6861 7420  taframe so that 
-00010bf0: 6974 7320 7468 6520 6f6c 6465 7374 2064  its the oldest d
-00010c00: 6174 6520 6669 7273 740a 2020 2020 2020  ate first.      
-00010c10: 2020 6469 6666 5f64 6620 3d20 4e6f 6e65    diff_df = None
-00010c20: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00010c30: 2020 2020 2020 2020 2020 2320 4c65 7427            # Let'
-00010c40: 7320 6f6e 6c79 2063 6f6e 7369 6465 7220  s only consider 
-00010c50: 7468 6f73 6520 6361 6e64 6c65 7320 7468  those candles th
-00010c60: 6174 2061 7265 2061 6674 6572 2074 6865  at are after the
-00010c70: 2061 6c65 7274 2069 7373 7565 2d74 696d   alert issue-tim
-00010c80: 6520 696e 2074 6865 206d 6f72 6e69 6e67  e in the morning
-00010c90: 7320 2b20 3220 6361 6e64 6c65 7320 2866  s + 2 candles (f
-00010ca0: 6f72 2062 7579 2f73 656c 6c29 0a20 2020  or buy/sell).   
-00010cb0: 2020 2020 2020 2020 2064 6966 665f 6466           diff_df
-00010cc0: 203d 2064 6174 615b 6461 7461 2e69 6e64   = data[data.ind
-00010cd0: 6578 203e 3d20 2070 642e 746f 5f64 6174  ex >=  pd.to_dat
-00010ce0: 6574 696d 6528 6627 7b50 4b44 6174 6555  etime(f'{PKDateU
-00010cf0: 7469 6c69 7469 6573 2e74 7261 6469 6e67  tilities.trading
-00010d00: 4461 7465 2829 2e73 7472 6674 696d 6528  Date().strftime(
-00010d10: 6622 2559 2d25 6d2d 2564 2229 7d20 3039  f"%Y-%m-%d")} 09
-00010d20: 3a7b 3135 2b73 656c 662e 636f 6e66 6967  :{15+self.config
-00010d30: 4d61 6e61 6765 722e 6d6f 726e 696e 6761  Manager.morninga
-00010d40: 6e61 6c79 7369 7363 616e 646c 656e 756d  nalysiscandlenum
-00010d50: 6265 7220 2b20 327d 3a30 302b 3035 3a33  ber + 2}:00+05:3
-00010d60: 3027 292e 746f 5f64 6174 6574 696d 6536  0').to_datetime6
-00010d70: 3428 295d 0a20 2020 2020 2020 2020 2020  4()].           
-00010d80: 2023 2062 726f 6b65 7253 7172 4f66 6674   # brokerSqrOfft
-00010d90: 696d 6520 3d20 7064 2e74 6f5f 6461 7465  ime = pd.to_date
-00010da0: 7469 6d65 2866 277b 504b 4461 7465 5574  time(f'{PKDateUt
-00010db0: 696c 6974 6965 732e 7472 6164 696e 6744  ilities.tradingD
-00010dc0: 6174 6528 292e 7374 7266 7469 6d65 2866  ate().strftime(f
-00010dd0: 2225 592d 256d 2d25 6422 297d 2031 353a  "%Y-%m-%d")} 15:
-00010de0: 3134 3a30 302b 3035 3a33 3027 292e 746f  14:00+05:30').to
-00010df0: 5f64 6174 6574 696d 6536 3428 290a 2020  _datetime64().  
-00010e00: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-00010e10: 2020 2020 2020 2020 2020 6469 6666 5f64            diff_d
-00010e20: 6620 3d20 6461 7461 5b64 6174 612e 696e  f = data[data.in
-00010e30: 6465 7820 3e3d 2020 7064 2e74 6f5f 6461  dex >=  pd.to_da
-00010e40: 7465 7469 6d65 2866 277b 504b 4461 7465  tetime(f'{PKDate
-00010e50: 5574 696c 6974 6965 732e 7472 6164 696e  Utilities.tradin
-00010e60: 6744 6174 6528 292e 7374 7266 7469 6d65  gDate().strftime
-00010e70: 2866 2225 592d 256d 2d25 6422 297d 2030  (f"%Y-%m-%d")} 0
-00010e80: 393a 7b31 352b 7365 6c66 2e63 6f6e 6669  9:{15+self.confi
-00010e90: 674d 616e 6167 6572 2e6d 6f72 6e69 6e67  gManager.morning
-00010ea0: 616e 616c 7973 6973 6361 6e64 6c65 6e75  analysiscandlenu
-00010eb0: 6d62 6572 202b 2032 7d3a 3030 2b30 353a  mber + 2}:00+05:
-00010ec0: 3330 272c 2075 7463 3d54 7275 6529 5d0a  30', utc=True)].
-00010ed0: 2020 2020 2020 2020 2020 2020 2320 6272              # br
-00010ee0: 6f6b 6572 5371 724f 6666 7469 6d65 203d  okerSqrOfftime =
-00010ef0: 2070 642e 746f 5f64 6174 6574 696d 6528   pd.to_datetime(
-00010f00: 6627 7b50 4b44 6174 6555 7469 6c69 7469  f'{PKDateUtiliti
-00010f10: 6573 2e74 7261 6469 6e67 4461 7465 2829  es.tradingDate()
-00010f20: 2e73 7472 6674 696d 6528 6622 2559 2d25  .strftime(f"%Y-%
-00010f30: 6d2d 2564 2229 7d20 3135 3a31 343a 3030  m-%d")} 15:14:00
-00010f40: 2b30 353a 3330 272c 2075 7463 3d54 7275  +05:30', utc=Tru
-00010f50: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
-00010f60: 6173 730a 2020 2020 2020 2020 6461 7948  ass.        dayH
-00010f70: 6967 6841 6674 6572 416c 6572 7420 3d20  ighAfterAlert = 
-00010f80: 6469 6666 5f64 665b 2248 6967 6822 5d2e  diff_df["High"].
-00010f90: 6d61 7828 290a 2020 2020 2020 2020 6869  max().        hi
-00010fa0: 6768 526f 7720 3d20 6469 6666 5f64 665b  ghRow = diff_df[
-00010fb0: 6469 6666 5f64 665b 2248 6967 6822 5d20  diff_df["High"] 
-00010fc0: 3e3d 2064 6179 4869 6768 4166 7465 7241  >= dayHighAfterA
-00010fd0: 6c65 7274 5d0a 2020 2020 2020 2020 6966  lert].        if
-00010fe0: 2068 6967 6852 6f77 2069 7320 6e6f 7420   highRow is not 
-00010ff0: 4e6f 6e65 2061 6e64 206c 656e 2868 6967  None and len(hig
-00011000: 6852 6f77 2920 3e20 303a 0a20 2020 2020  hRow) > 0:.     
-00011010: 2020 2020 2020 2068 6967 6852 6f77 203d         highRow =
-00011020: 2068 6967 6852 6f77 2e74 6169 6c28 3129   highRow.tail(1)
-00011030: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00011040: 6869 6768 526f 772e 696e 6465 785b 2d31  highRow.index[-1
-00011050: 5d2c 2068 6967 6852 6f77 0a0a 0a20 2020  ], highRow...   
-00011060: 2064 6566 2066 696e 644d 4143 4443 726f   def findMACDCro
-00011070: 7373 6f76 6572 2873 656c 662c 2064 662c  ssover(self, df,
-00011080: 2061 6674 6572 5469 6d65 7374 616d 703d   afterTimestamp=
-00011090: 4e6f 6e65 2c20 6e74 6843 726f 7373 6f76  None, nthCrossov
-000110a0: 6572 3d31 2c20 7570 4469 7265 6374 696f  er=1, upDirectio
-000110b0: 6e3d 5472 7565 2c20 6d69 6e52 5349 3d36  n=True, minRSI=6
-000110c0: 3029 3a0a 2020 2020 2020 2020 6966 2064  0):.        if d
-000110d0: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-000110e0: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-000110f0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00011100: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-00011110: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-00011120: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-00011130: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-00011140: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-00011150: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-00011160: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-00011170: 2020 2020 2064 6174 612e 6472 6f70 6e61       data.dropna
-00011180: 2861 7869 733d 302c 2068 6f77 3d22 616c  (axis=0, how="al
-00011190: 6c22 2c20 696e 706c 6163 653d 5472 7565  l", inplace=True
-000111a0: 2920 2320 4d61 7962 6520 7468 6572 6520  ) # Maybe there 
-000111b0: 7761 7320 6e6f 2074 7261 6465 2064 6f6e  was no trade don
-000111c0: 6520 6174 2074 6865 7365 2074 696d 6573  e at these times
-000111d0: 3f0a 2020 2020 2020 2020 6461 7461 203d  ?.        data =
-000111e0: 2064 6174 615b 3a3a 2d31 5d20 2023 2052   data[::-1]  # R
-000111f0: 6576 6572 7365 2074 6865 2064 6174 6166  everse the dataf
-00011200: 7261 6d65 2073 6f20 7468 6174 2069 7473  rame so that its
-00011210: 2074 6865 206f 6c64 6573 7420 6461 7465   the oldest date
-00011220: 2066 6972 7374 0a20 2020 2020 2020 206d   first.        m
-00011230: 6163 644c 696e 652c 206d 6163 6453 6967  acdLine, macdSig
-00011240: 6e61 6c2c 206d 6163 6448 6973 7420 3d20  nal, macdHist = 
-00011250: 706b 7461 6c69 622e 4d41 4344 2864 6174  pktalib.MACD(dat
-00011260: 615b 2243 6c6f 7365 225d 2c20 3132 2c20  a["Close"], 12, 
-00011270: 3236 2c20 3929 0a20 2020 2020 2020 2023  26, 9).        #
-00011280: 2072 7369 5f64 6620 3d20 706b 7461 6c69   rsi_df = pktali
-00011290: 622e 5253 4928 6461 7461 5b22 436c 6f73  b.RSI(data["Clos
-000112a0: 6522 5d2c 2031 3429 0a20 2020 2020 2020  e"], 14).       
-000112b0: 206c 696e 655f 6466 203d 2070 642e 4461   line_df = pd.Da
-000112c0: 7461 4672 616d 6528 6d61 6364 4c69 6e65  taFrame(macdLine
-000112d0: 290a 2020 2020 2020 2020 7369 676e 616c  ).        signal
-000112e0: 5f64 6620 3d20 7064 2e44 6174 6146 7261  _df = pd.DataFra
-000112f0: 6d65 286d 6163 6453 6967 6e61 6c29 0a20  me(macdSignal). 
-00011300: 2020 2020 2020 2076 6f6c 5f64 6620 3d20         vol_df = 
-00011310: 6461 7461 5b22 566f 6c75 6d65 225d 0a20  data["Volume"]. 
-00011320: 2020 2020 2020 2064 6966 665f 6466 203d         diff_df =
-00011330: 2070 642e 636f 6e63 6174 285b 6c69 6e65   pd.concat([line
-00011340: 5f64 662c 2073 6967 6e61 6c5f 6466 2c20  _df, signal_df, 
-00011350: 7369 676e 616c 5f64 662d 6c69 6e65 5f64  signal_df-line_d
-00011360: 662c 766f 6c5f 6466 5d2c 2061 7869 733d  f,vol_df], axis=
-00011370: 3129 0a20 2020 2020 2020 2064 6966 665f  1).        diff_
-00011380: 6466 2e63 6f6c 756d 6e73 203d 205b 226c  df.columns = ["l
-00011390: 696e 6522 2c22 7369 676e 616c 222c 2264  ine","signal","d
-000113a0: 6966 6622 2c22 766f 6c22 5d0a 2020 2020  iff","vol"].    
-000113b0: 2020 2020 6469 6666 5f64 6620 3d20 6469      diff_df = di
-000113c0: 6666 5f64 665b 6469 6666 5f64 665b 2276  ff_df[diff_df["v
-000113d0: 6f6c 225d 203e 2030 5d20 2320 5765 2772  ol"] > 0] # We'r
-000113e0: 6520 6e6f 7420 676f 696e 6720 746f 2064  e not going to d
-000113f0: 6f20 616e 7974 6869 6e67 2077 6974 6820  o anything with 
-00011400: 6120 6361 6e64 6c65 2077 6865 7265 2074  a candle where t
-00011410: 6865 7265 2077 6173 206e 6f20 7472 6164  here was no trad
-00011420: 652e 0a20 2020 2020 2020 2023 2062 726f  e..        # bro
-00011430: 6b65 7253 7172 4f66 6674 696d 6520 3d20  kerSqrOfftime = 
-00011440: 4e6f 6e65 0a20 2020 2020 2020 2074 7279  None.        try
-00011450: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00011460: 4c65 7427 7320 6f6e 6c79 2063 6f6e 7369  Let's only consi
-00011470: 6465 7220 7468 6f73 6520 6361 6e64 6c65  der those candle
-00011480: 7320 7468 6174 2061 7265 2061 6674 6572  s that are after
-00011490: 2074 6865 2061 6c65 7274 2069 7373 7565   the alert issue
-000114a0: 2d74 696d 6520 696e 2074 6865 206d 6f72  -time in the mor
-000114b0: 6e69 6e67 7320 2b20 3220 6361 6e64 6c65  nings + 2 candle
-000114c0: 7320 2866 6f72 2062 7579 2f73 656c 6c29  s (for buy/sell)
-000114d0: 0a20 2020 2020 2020 2020 2020 2064 6966  .            dif
-000114e0: 665f 6466 203d 2064 6966 665f 6466 5b64  f_df = diff_df[d
-000114f0: 6966 665f 6466 2e69 6e64 6578 203e 3d20  iff_df.index >= 
-00011500: 2070 642e 746f 5f64 6174 6574 696d 6528   pd.to_datetime(
-00011510: 6627 7b50 4b44 6174 6555 7469 6c69 7469  f'{PKDateUtiliti
-00011520: 6573 2e74 7261 6469 6e67 4461 7465 2829  es.tradingDate()
-00011530: 2e73 7472 6674 696d 6528 6622 2559 2d25  .strftime(f"%Y-%
-00011540: 6d2d 2564 2229 7d20 3039 3a7b 3135 2b73  m-%d")} 09:{15+s
-00011550: 656c 662e 636f 6e66 6967 4d61 6e61 6765  elf.configManage
-00011560: 722e 6d6f 726e 696e 6761 6e61 6c79 7369  r.morninganalysi
-00011570: 7363 616e 646c 656e 756d 6265 7220 2b20  scandlenumber + 
-00011580: 327d 3a30 302b 3035 3a33 3027 292e 746f  2}:00+05:30').to
-00011590: 5f64 6174 6574 696d 6536 3428 295d 0a20  _datetime64()]. 
-000115a0: 2020 2020 2020 2020 2020 2023 2062 726f             # bro
-000115b0: 6b65 7253 7172 4f66 6674 696d 6520 3d20  kerSqrOfftime = 
-000115c0: 7064 2e74 6f5f 6461 7465 7469 6d65 2866  pd.to_datetime(f
-000115d0: 277b 504b 4461 7465 5574 696c 6974 6965  '{PKDateUtilitie
-000115e0: 732e 7472 6164 696e 6744 6174 6528 292e  s.tradingDate().
-000115f0: 7374 7266 7469 6d65 2866 2225 592d 256d  strftime(f"%Y-%m
-00011600: 2d25 6422 297d 2031 353a 3134 3a30 302b  -%d")} 15:14:00+
-00011610: 3035 3a33 3027 292e 746f 5f64 6174 6574  05:30').to_datet
-00011620: 696d 6536 3428 290a 2020 2020 2020 2020  ime64().        
-00011630: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+0000d800: 5d20 3e20 7265 6365 6e74 5b22 436c 6f73  ] > recent["Clos
+0000d810: 6522 5d2e 696c 6f63 5b31 5d0a 0a20 2020  e"].iloc[1]..   
+0000d820: 2064 6566 2066 696e 6448 6967 6865 7242   def findHigherB
+0000d830: 756c 6c69 7368 4f70 656e 7328 7365 6c66  ullishOpens(self
+0000d840: 2c20 6466 293a 0a20 2020 2020 2020 2069  , df):.        i
+0000d850: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
+0000d860: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
+0000d870: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000d880: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
+0000d890: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
+0000d8a0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0000d8b0: 6174 612e 6669 6c6c 6e61 2830 290a 2020  ata.fillna(0).  
+0000d8c0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0000d8d0: 612e 7265 706c 6163 6528 5b6e 702e 696e  a.replace([np.in
+0000d8e0: 662c 202d 6e70 2e69 6e66 5d2c 2030 290a  f, -np.inf], 0).
+0000d8f0: 2020 2020 2020 2020 7265 6365 6e74 203d          recent =
+0000d900: 2064 6174 612e 6865 6164 2832 290a 2020   data.head(2).  
+0000d910: 2020 2020 2020 6966 206c 656e 2872 6563        if len(rec
+0000d920: 656e 7429 203c 2032 3a0a 2020 2020 2020  ent) < 2:.      
+0000d930: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0000d940: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
+0000d950: 6e20 7265 6365 6e74 5b22 4f70 656e 225d  n recent["Open"]
+0000d960: 2e69 6c6f 635b 305d 203e 2072 6563 656e  .iloc[0] > recen
+0000d970: 745b 2248 6967 6822 5d2e 696c 6f63 5b31  t["High"].iloc[1
+0000d980: 5d0a 2020 2020 0a20 2020 2064 6566 2066  ].    .    def f
+0000d990: 696e 644e 5234 4461 7928 7365 6c66 2c20  indNR4Day(self, 
+0000d9a0: 6466 293a 0a20 2020 2020 2020 2069 6620  df):.        if 
+0000d9b0: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
+0000d9c0: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
+0000d9d0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0000d9e0: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
+0000d9f0: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
+0000da00: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
+0000da10: 6368 6172 7469 6e6b 2e63 6f6d 2f73 6372  chartink.com/scr
+0000da20: 6565 6e65 722f 6e72 342d 6461 696c 792d  eener/nr4-daily-
+0000da30: 746f 6461 790a 2020 2020 2020 2020 6966  today.        if
+0000da40: 2064 6174 612e 7461 696c 2831 295b 2256   data.tail(1)["V
+0000da50: 6f6c 756d 6522 5d2e 696c 6f63 5b30 5d20  olume"].iloc[0] 
+0000da60: 3c3d 2035 3030 3030 3a0a 2020 2020 2020  <= 50000:.      
+0000da70: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0000da80: 7365 0a20 2020 2020 2020 2064 6174 6120  se.        data 
+0000da90: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
+0000daa0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+0000dab0: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
+0000dac0: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
+0000dad0: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
+0000dae0: 3d20 6461 7461 5b3a 3a2d 315d 2020 2320  = data[::-1]  # 
+0000daf0: 5265 7665 7273 6520 7468 6520 6461 7461  Reverse the data
+0000db00: 6672 616d 6520 736f 2074 6861 7420 6974  frame so that it
+0000db10: 7320 7468 6520 6f6c 6465 7374 2064 6174  s the oldest dat
+0000db20: 6520 6669 7273 740a 2020 2020 2020 2020  e first.        
+0000db30: 6461 7461 5b22 534d 4131 3022 5d20 3d20  data["SMA10"] = 
+0000db40: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
+0000db50: 5b22 436c 6f73 6522 5d2c 2031 3029 0a20  ["Close"], 10). 
+0000db60: 2020 2020 2020 2064 6174 615b 2253 4d41         data["SMA
+0000db70: 3530 225d 203d 2070 6b74 616c 6962 2e53  50"] = pktalib.S
+0000db80: 4d41 2864 6174 615b 2243 6c6f 7365 225d  MA(data["Close"]
+0000db90: 2c20 3530 290a 2020 2020 2020 2020 6461  , 50).        da
+0000dba0: 7461 5b22 534d 4132 3030 225d 203d 2070  ta["SMA200"] = p
+0000dbb0: 6b74 616c 6962 2e53 4d41 2864 6174 615b  ktalib.SMA(data[
+0000dbc0: 2243 6c6f 7365 225d 2c20 3230 3029 0a20  "Close"], 200). 
+0000dbd0: 2020 2020 2020 2072 6563 656e 7420 3d20         recent = 
+0000dbe0: 6461 7461 2e74 6169 6c28 3529 0a20 2020  data.tail(5).   
+0000dbf0: 2020 2020 2072 6563 656e 7420 3d20 7265       recent = re
+0000dc00: 6365 6e74 5b3a 3a2d 315d 0a20 2020 2020  cent[::-1].     
+0000dc10: 2020 2063 6f6e 6431 203d 2028 7265 6365     cond1 = (rece
+0000dc20: 6e74 5b22 4869 6768 225d 2e69 6c6f 635b  nt["High"].iloc[
+0000dc30: 305d 202d 2072 6563 656e 745b 224c 6f77  0] - recent["Low
+0000dc40: 225d 2e69 6c6f 635b 305d 2920 3c20 280a  "].iloc[0]) < (.
+0000dc50: 2020 2020 2020 2020 2020 2020 7265 6365              rece
+0000dc60: 6e74 5b22 4869 6768 225d 2e69 6c6f 635b  nt["High"].iloc[
+0000dc70: 315d 202d 2072 6563 656e 745b 224c 6f77  1] - recent["Low
+0000dc80: 225d 2e69 6c6f 635b 315d 0a20 2020 2020  "].iloc[1].     
+0000dc90: 2020 2029 0a20 2020 2020 2020 2063 6f6e     ).        con
+0000dca0: 6432 203d 2063 6f6e 6431 2061 6e64 2028  d2 = cond1 and (
+0000dcb0: 7265 6365 6e74 5b22 4869 6768 225d 2e69  recent["High"].i
+0000dcc0: 6c6f 635b 305d 202d 2072 6563 656e 745b  loc[0] - recent[
+0000dcd0: 224c 6f77 225d 2e69 6c6f 635b 305d 2920  "Low"].iloc[0]) 
+0000dce0: 3c20 280a 2020 2020 2020 2020 2020 2020  < (.            
+0000dcf0: 7265 6365 6e74 5b22 4869 6768 225d 2e69  recent["High"].i
+0000dd00: 6c6f 635b 325d 202d 2072 6563 656e 745b  loc[2] - recent[
+0000dd10: 224c 6f77 225d 2e69 6c6f 635b 325d 0a20  "Low"].iloc[2]. 
+0000dd20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000dd30: 2063 6f6e 6433 203d 2063 6f6e 6432 2061   cond3 = cond2 a
+0000dd40: 6e64 2028 7265 6365 6e74 5b22 4869 6768  nd (recent["High
+0000dd50: 225d 2e69 6c6f 635b 305d 202d 2072 6563  "].iloc[0] - rec
+0000dd60: 656e 745b 224c 6f77 225d 2e69 6c6f 635b  ent["Low"].iloc[
+0000dd70: 305d 2920 3c20 280a 2020 2020 2020 2020  0]) < (.        
+0000dd80: 2020 2020 7265 6365 6e74 5b22 4869 6768      recent["High
+0000dd90: 225d 2e69 6c6f 635b 335d 202d 2072 6563  "].iloc[3] - rec
+0000dda0: 656e 745b 224c 6f77 225d 2e69 6c6f 635b  ent["Low"].iloc[
+0000ddb0: 335d 0a20 2020 2020 2020 2029 0a20 2020  3].        ).   
+0000ddc0: 2020 2020 2063 6f6e 6434 203d 2063 6f6e       cond4 = con
+0000ddd0: 6433 2061 6e64 2028 7265 6365 6e74 5b22  d3 and (recent["
+0000dde0: 4869 6768 225d 2e69 6c6f 635b 305d 202d  High"].iloc[0] -
+0000ddf0: 2072 6563 656e 745b 224c 6f77 225d 2e69   recent["Low"].i
+0000de00: 6c6f 635b 305d 2920 3c20 280a 2020 2020  loc[0]) < (.    
+0000de10: 2020 2020 2020 2020 7265 6365 6e74 5b22          recent["
+0000de20: 4869 6768 225d 2e69 6c6f 635b 345d 202d  High"].iloc[4] -
+0000de30: 2072 6563 656e 745b 224c 6f77 225d 2e69   recent["Low"].i
+0000de40: 6c6f 635b 345d 0a20 2020 2020 2020 2029  loc[4].        )
+0000de50: 0a20 2020 2020 2020 2063 6f6e 6435 203d  .        cond5 =
+0000de60: 2063 6f6e 6434 2061 6e64 2028 7265 6365   cond4 and (rece
+0000de70: 6e74 5b22 534d 4131 3022 5d2e 696c 6f63  nt["SMA10"].iloc
+0000de80: 5b30 5d20 3e20 7265 6365 6e74 5b22 534d  [0] > recent["SM
+0000de90: 4135 3022 5d2e 696c 6f63 5b30 5d29 0a20  A50"].iloc[0]). 
+0000dea0: 2020 2020 2020 2063 6f6e 6436 203d 2063         cond6 = c
+0000deb0: 6f6e 6435 2061 6e64 2028 7265 6365 6e74  ond5 and (recent
+0000dec0: 5b22 534d 4135 3022 5d2e 696c 6f63 5b30  ["SMA50"].iloc[0
+0000ded0: 5d20 3e20 7265 6365 6e74 5b22 534d 4132  ] > recent["SMA2
+0000dee0: 3030 225d 2e69 6c6f 635b 305d 290a 2020  00"].iloc[0]).  
+0000def0: 2020 2020 2020 7265 7475 726e 2063 6f6e        return con
+0000df00: 6436 0a0a 2020 2020 2320 4669 6e64 2070  d6..    # Find p
+0000df10: 6f74 656e 7469 616c 2062 7265 616b 6f75  otential breakou
+0000df20: 7420 7374 6f63 6b73 0a20 2020 2023 2054  t stocks.    # T
+0000df30: 6869 7320 7363 616e 6e65 7220 6669 6c74  his scanner filt
+0000df40: 6572 7320 7374 6f63 6b73 2077 686f 7365  ers stocks whose
+0000df50: 2063 7572 7265 6e74 2063 6c6f 7365 2070   current close p
+0000df60: 7269 6365 202b 2035 2520 6973 2068 6967  rice + 5% is hig
+0000df70: 6865 720a 2020 2020 2320 7468 616e 2074  her.    # than t
+0000df80: 6865 2068 6967 6865 7374 2048 6967 6820  he highest High 
+0000df90: 7072 6963 6520 696e 2070 6173 7420 3230  price in past 20
+0000dfa0: 3020 6361 6e64 6c65 7320 616e 6420 7468  0 candles and th
+0000dfb0: 6520 6d61 7869 6d75 6d20 6869 6768 0a20  e maximum high. 
+0000dfc0: 2020 2023 2069 6e20 7468 6520 7072 6576     # in the prev
+0000dfd0: 696f 7573 2033 3020 6361 6e64 6c65 7320  ious 30 candles 
+0000dfe0: 6973 206c 6f77 6572 2074 6861 6e20 7468  is lower than th
+0000dff0: 6520 6869 6768 6573 7420 6869 6768 206d  e highest high m
+0000e000: 6164 6520 696e 2074 6865 0a20 2020 2023  ade in the.    #
+0000e010: 2070 7265 7669 6f75 7320 3230 3020 6361   previous 200 ca
+0000e020: 6e64 6c65 732c 2073 7461 7274 696e 6720  ndles, starting 
+0000e030: 6672 6f6d 2074 6865 2070 7265 7669 6f75  from the previou
+0000e040: 7320 3330 7468 2063 616e 646c 652e 2041  s 30th candle. A
+0000e050: 7420 7468 650a 2020 2020 2320 7361 6d65  t the.    # same
+0000e060: 2074 696d 6520 7468 6520 6375 7272 656e   time the curren
+0000e070: 7420 6361 6e64 6c65 2076 6f6c 756d 6520  t candle volume 
+0000e080: 6973 2068 6967 6865 7220 7468 616e 2032  is higher than 2
+0000e090: 3030 2053 4d41 206f 6620 766f 6c75 6d65  00 SMA of volume
+0000e0a0: 2e0a 2020 2020 6465 6620 6669 6e64 506f  ..    def findPo
+0000e0b0: 7465 6e74 6961 6c42 7265 616b 6f75 7428  tentialBreakout(
+0000e0c0: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
+0000e0d0: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
+0000e0e0: 6461 7973 546f 4c6f 6f6b 6261 636b 293a  daysToLookback):
+0000e0f0: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
+0000e100: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
+0000e110: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+0000e120: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000e130: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+0000e140: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
+0000e150: 2020 6461 7461 203d 2064 6174 612e 6669    data = data.fi
+0000e160: 6c6c 6e61 2830 290a 2020 2020 2020 2020  llna(0).        
+0000e170: 6461 7461 203d 2064 6174 612e 7265 706c  data = data.repl
+0000e180: 6163 6528 5b6e 702e 696e 662c 202d 6e70  ace([np.inf, -np
+0000e190: 2e69 6e66 5d2c 2030 290a 2020 2020 2020  .inf], 0).      
+0000e1a0: 2020 6461 7461 203d 2064 6174 612e 6865    data = data.he
+0000e1b0: 6164 2832 3331 290a 2020 2020 2020 2020  ad(231).        
+0000e1c0: 7265 6365 6e74 203d 2064 6174 612e 6865  recent = data.he
+0000e1d0: 6164 2831 290a 2020 2020 2020 2020 7265  ad(1).        re
+0000e1e0: 6365 6e74 566f 6c75 6d65 203d 2072 6563  centVolume = rec
+0000e1f0: 656e 745b 2256 6f6c 756d 6522 5d2e 696c  ent["Volume"].il
+0000e200: 6f63 5b30 5d0a 2020 2020 2020 2020 7265  oc[0].        re
+0000e210: 6365 6e74 436c 6f73 6520 3d20 726f 756e  centClose = roun
+0000e220: 6428 7265 6365 6e74 5b22 436c 6f73 6522  d(recent["Close"
+0000e230: 5d2e 696c 6f63 5b30 5d20 2a20 312e 3035  ].iloc[0] * 1.05
+0000e240: 2c20 3229 0a20 2020 2020 2020 2068 6967  , 2).        hig
+0000e250: 6865 7374 4869 6768 3230 3020 3d20 726f  hestHigh200 = ro
+0000e260: 756e 6428 6461 7461 2e68 6561 6428 3230  und(data.head(20
+0000e270: 3129 2e74 6169 6c28 3230 3029 2e64 6573  1).tail(200).des
+0000e280: 6372 6962 6528 295b 2248 6967 6822 5d5b  cribe()["High"][
+0000e290: 226d 6178 225d 2c20 3229 0a20 2020 2020  "max"], 2).     
+0000e2a0: 2020 2068 6967 6865 7374 4869 6768 3330     highestHigh30
+0000e2b0: 203d 2072 6f75 6e64 2864 6174 612e 6865   = round(data.he
+0000e2c0: 6164 2833 3129 2e74 6169 6c28 3330 292e  ad(31).tail(30).
+0000e2d0: 6465 7363 7269 6265 2829 5b22 4869 6768  describe()["High
+0000e2e0: 225d 5b22 6d61 7822 5d2c 2032 290a 2020  "]["max"], 2).  
+0000e2f0: 2020 2020 2020 6869 6768 6573 7448 6967        highestHig
+0000e300: 6832 3030 4672 6f6d 3330 203d 2072 6f75  h200From30 = rou
+0000e310: 6e64 2864 6174 612e 7461 696c 2832 3030  nd(data.tail(200
+0000e320: 292e 6465 7363 7269 6265 2829 5b22 4869  ).describe()["Hi
+0000e330: 6768 225d 5b22 6d61 7822 5d2c 2032 290a  gh"]["max"], 2).
+0000e340: 2020 2020 2020 2020 6869 6768 6573 7448          highestH
+0000e350: 6967 6838 4672 6f6d 3330 203d 2072 6f75  igh8From30 = rou
+0000e360: 6e64 2864 6174 612e 6865 6164 2833 3929  nd(data.head(39)
+0000e370: 2e74 6169 6c28 3829 2e64 6573 6372 6962  .tail(8).describ
+0000e380: 6528 295b 2248 6967 6822 5d5b 226d 6178  e()["High"]["max
+0000e390: 225d 2c20 3229 0a20 2020 2020 2020 2064  "], 2).        d
+0000e3a0: 6174 6120 3d20 6461 7461 2e68 6561 6428  ata = data.head(
+0000e3b0: 3230 3029 0a20 2020 2020 2020 2064 6174  200).        dat
+0000e3c0: 6120 3d20 6461 7461 5b3a 3a2d 315d 2020  a = data[::-1]  
+0000e3d0: 2320 5265 7665 7273 6520 7468 6520 6461  # Reverse the da
+0000e3e0: 7461 6672 616d 6520 736f 2074 6861 7420  taframe so that 
+0000e3f0: 6974 7320 7468 6520 6f6c 6465 7374 2064  its the oldest d
+0000e400: 6174 6520 6669 7273 740a 2020 2020 2020  ate first.      
+0000e410: 2020 766f 6c32 3030 203d 2070 6b74 616c    vol200 = pktal
+0000e420: 6962 2e53 4d41 2864 6174 615b 2256 6f6c  ib.SMA(data["Vol
+0000e430: 756d 6522 5d2c 7469 6d65 7065 7269 6f64  ume"],timeperiod
+0000e440: 3d32 3030 290a 2020 2020 2020 2020 6461  =200).        da
+0000e450: 7461 5b22 534d 4132 3030 5622 5d20 3d20  ta["SMA200V"] = 
+0000e460: 766f 6c32 3030 0a20 2020 2020 2020 2076  vol200.        v
+0000e470: 6f6c 3530 203d 2070 6b74 616c 6962 2e53  ol50 = pktalib.S
+0000e480: 4d41 2864 6174 615b 2256 6f6c 756d 6522  MA(data["Volume"
+0000e490: 5d2c 7469 6d65 7065 7269 6f64 3d35 3029  ],timeperiod=50)
+0000e4a0: 0a20 2020 2020 2020 2064 6174 615b 2253  .        data["S
+0000e4b0: 4d41 3530 5622 5d20 3d20 766f 6c35 300a  MA50V"] = vol50.
+0000e4c0: 2020 2020 2020 2020 7265 6365 6e74 203d          recent =
+0000e4d0: 2064 6174 612e 7461 696c 2831 290a 2020   data.tail(1).  
+0000e4e0: 2020 2020 2020 736d 6132 3030 7620 3d20        sma200v = 
+0000e4f0: 7265 6365 6e74 5b22 534d 4132 3030 5622  recent["SMA200V"
+0000e500: 5d2e 696c 6f63 5b30 5d0a 2020 2020 2020  ].iloc[0].      
+0000e510: 2020 736d 6135 3076 203d 2072 6563 656e    sma50v = recen
+0000e520: 745b 2253 4d41 3530 5622 5d2e 696c 6f63  t["SMA50V"].iloc
+0000e530: 5b30 5d0a 2020 2020 2020 2020 6966 2028  [0].        if (
+0000e540: 0a20 2020 2020 2020 2020 2020 206e 702e  .            np.
+0000e550: 6973 6e61 6e28 7265 6365 6e74 436c 6f73  isnan(recentClos
+0000e560: 6529 0a20 2020 2020 2020 2020 2020 206f  e).            o
+0000e570: 7220 6e70 2e69 736e 616e 2868 6967 6865  r np.isnan(highe
+0000e580: 7374 4869 6768 3230 3029 0a20 2020 2020  stHigh200).     
+0000e590: 2020 2020 2020 206f 7220 6e70 2e69 736e         or np.isn
+0000e5a0: 616e 2868 6967 6865 7374 4869 6768 3330  an(highestHigh30
+0000e5b0: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
+0000e5c0: 206e 702e 6973 6e61 6e28 6869 6768 6573   np.isnan(highes
+0000e5d0: 7448 6967 6832 3030 4672 6f6d 3330 290a  tHigh200From30).
+0000e5e0: 2020 2020 2020 2020 2020 2020 6f72 206e              or n
+0000e5f0: 702e 6973 6e61 6e28 6869 6768 6573 7448  p.isnan(highestH
+0000e600: 6967 6838 4672 6f6d 3330 290a 2020 2020  igh8From30).    
+0000e610: 2020 2020 2020 2020 6f72 206e 702e 6973          or np.is
+0000e620: 6e61 6e28 7265 6365 6e74 566f 6c75 6d65  nan(recentVolume
+0000e630: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
+0000e640: 206e 702e 6973 6e61 6e28 736d 6132 3030   np.isnan(sma200
+0000e650: 7629 0a20 2020 2020 2020 2020 2020 206f  v).            o
+0000e660: 7220 6e70 2e69 736e 616e 2873 6d61 3530  r np.isnan(sma50
+0000e670: 7629 0a20 2020 2020 2020 2029 3a0a 2020  v).        ):.  
+0000e680: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000e690: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
+0000e6a0: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+0000e6b0: 2872 6563 656e 7443 6c6f 7365 203e 2068  (recentClose > h
+0000e6c0: 6967 6865 7374 4869 6768 3230 3029 0a20  ighestHigh200). 
+0000e6d0: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
+0000e6e0: 2828 6869 6768 6573 7448 6967 6833 3020  ((highestHigh30 
+0000e6f0: 3c20 6869 6768 6573 7448 6967 6832 3030  < highestHigh200
+0000e700: 4672 6f6d 3330 2920 616e 6420 2872 6563  From30) and (rec
+0000e710: 656e 7456 6f6c 756d 6520 3e20 736d 6132  entVolume > sma2
+0000e720: 3030 7629 2920 6f72 205c 0a20 2020 2020  00v)) or \.     
+0000e730: 2020 2020 2020 2020 2020 2020 2828 6869              ((hi
+0000e740: 6768 6573 7448 6967 6833 3020 3c20 6869  ghestHigh30 < hi
+0000e750: 6768 6573 7448 6967 6838 4672 6f6d 3330  ghestHigh8From30
+0000e760: 2920 616e 6420 2872 6563 656e 7456 6f6c  ) and (recentVol
+0000e770: 756d 6520 3e20 736d 6135 3076 2929 0a20  ume > sma50v)). 
+0000e780: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000e790: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
+0000e7a0: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
+0000e7b0: 5b22 4272 6561 6b6f 7574 225d 203d 2073  ["Breakout"] = s
+0000e7c0: 6176 6544 6963 745b 2242 7265 616b 6f75  aveDict["Breakou
+0000e7d0: 7422 5d20 2b20 2228 506f 7465 6e74 6961  t"] + "(Potentia
+0000e7e0: 6c29 220a 2020 2020 2020 2020 2020 2020  l)".            
+0000e7f0: 7363 7265 656e 4469 6374 5b22 4272 6561  screenDict["Brea
+0000e800: 6b6f 7574 225d 203d 2073 6372 6565 6e44  kout"] = screenD
+0000e810: 6963 745b 2242 7265 616b 6f75 7422 5d20  ict["Breakout"] 
+0000e820: 2b20 280a 2020 2020 2020 2020 2020 2020  + (.            
+0000e830: 2020 2020 636f 6c6f 7254 6578 742e 424f      colorText.BO
+0000e840: 4c44 202b 2063 6f6c 6f72 5465 7874 2e47  LD + colorText.G
+0000e850: 5245 454e 202b 2022 2028 506f 7465 6e74  REEN + " (Potent
+0000e860: 6961 6c29 2220 2b20 636f 6c6f 7254 6578  ial)" + colorTex
+0000e870: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+0000e880: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000e890: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+0000e8a0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000e8b0: 0a0a 2020 2020 2320 4669 6e64 2073 746f  ..    # Find sto
+0000e8c0: 636b 7320 7769 7468 2072 6576 6572 7369  cks with reversi
+0000e8d0: 6e67 2050 5341 5220 616e 6420 5253 490a  ng PSAR and RSI.
+0000e8e0: 2020 2020 6465 6620 6669 6e64 5053 4152      def findPSAR
+0000e8f0: 5265 7665 7273 616c 5769 7468 5253 4928  ReversalWithRSI(
+0000e900: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
+0000e910: 4469 6374 2c20 7361 7665 4469 6374 2c6d  Dict, saveDict,m
+0000e920: 696e 5253 493d 3530 293a 0a20 2020 2020  inRSI=50):.     
+0000e930: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
+0000e940: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
+0000e950: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000e960: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+0000e970: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
+0000e980: 7928 290a 2020 2020 2020 2020 6461 7461  y().        data
+0000e990: 203d 2064 6174 615b 3a3a 2d31 5d0a 2020   = data[::-1].  
+0000e9a0: 2020 2020 2020 7073 6172 203d 2070 6b74        psar = pkt
+0000e9b0: 616c 6962 2e70 7361 7228 6461 7461 5b22  alib.psar(data["
+0000e9c0: 4869 6768 225d 2c64 6174 615b 224c 6f77  High"],data["Low
+0000e9d0: 225d 290a 2020 2020 2020 2020 6966 206c  "]).        if l
+0000e9e0: 656e 2870 7361 7229 203c 2033 3a0a 2020  en(psar) < 3:.  
+0000e9f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000ea00: 2046 616c 7365 0a20 2020 2020 2020 2070   False.        p
+0000ea10: 7361 7220 3d20 7073 6172 2e74 6169 6c28  sar = psar.tail(
+0000ea20: 3329 0a20 2020 2020 2020 2064 6174 6120  3).        data 
+0000ea30: 3d20 6461 7461 2e74 6169 6c28 3329 0a20  = data.tail(3). 
+0000ea40: 2020 2020 2020 2023 2064 6179 4d69 6e75         # dayMinu
+0000ea50: 7332 5073 6172 203d 2070 7361 722e 696c  s2Psar = psar.il
+0000ea60: 6f63 5b30 5d0a 2020 2020 2020 2020 6461  oc[0].        da
+0000ea70: 794d 696e 7573 3150 7361 7220 3d20 7073  yMinus1Psar = ps
+0000ea80: 6172 2e69 6c6f 635b 315d 0a20 2020 2020  ar.iloc[1].     
+0000ea90: 2020 2064 6179 5053 4152 203d 2070 7361     dayPSAR = psa
+0000eaa0: 722e 696c 6f63 5b32 5d0a 2020 2020 2020  r.iloc[2].      
+0000eab0: 2020 2320 6461 794d 696e 7573 3243 6c6f    # dayMinus2Clo
+0000eac0: 7365 203d 2064 6174 615b 2243 6c6f 7365  se = data["Close
+0000ead0: 225d 2e69 6c6f 635b 305d 0a20 2020 2020  "].iloc[0].     
+0000eae0: 2020 2064 6179 4d69 6e75 7331 436c 6f73     dayMinus1Clos
+0000eaf0: 6520 3d20 6461 7461 5b22 436c 6f73 6522  e = data["Close"
+0000eb00: 5d2e 696c 6f63 5b31 5d0a 2020 2020 2020  ].iloc[1].      
+0000eb10: 2020 6461 7943 6c6f 7365 203d 2064 6174    dayClose = dat
+0000eb20: 615b 2243 6c6f 7365 225d 2e69 6c6f 635b  a["Close"].iloc[
+0000eb30: 325d 0a20 2020 2020 2020 2023 2064 6179  2].        # day
+0000eb40: 4d69 6e75 7332 5253 4920 3d20 6461 7461  Minus2RSI = data
+0000eb50: 5b22 5253 4922 5d2e 696c 6f63 5b30 5d0a  ["RSI"].iloc[0].
+0000eb60: 2020 2020 2020 2020 6461 794d 696e 7573          dayMinus
+0000eb70: 3152 5349 203d 2064 6174 615b 2252 5349  1RSI = data["RSI
+0000eb80: 225d 2e69 6c6f 635b 315d 0a20 2020 2020  "].iloc[1].     
+0000eb90: 2020 2064 6179 5253 4920 3d20 6461 7461     dayRSI = data
+0000eba0: 5b22 5253 4922 5d2e 696c 6f63 5b32 5d0a  ["RSI"].iloc[2].
+0000ebb0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0000ebc0: 2068 6173 5265 7665 7273 616c 3d20 2828   hasReversal= ((
+0000ebd0: 2864 6179 4d69 6e75 7331 5073 6172 203e  (dayMinus1Psar >
+0000ebe0: 3d20 6461 794d 696e 7573 3143 6c6f 7365  = dayMinus1Close
+0000ebf0: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
+0000ec00: 2020 2020 2020 2020 2020 2020 2864 6179              (day
+0000ec10: 436c 6f73 6520 3e3d 2064 6179 5053 4152  Close >= dayPSAR
+0000ec20: 2929 2061 6e64 205c 0a20 2020 2020 2020  )) and \.       
+0000ec30: 2020 2020 2020 2020 2020 2020 2028 6461               (da
+0000ec40: 794d 696e 7573 3152 5349 203c 3d20 6d69  yMinus1RSI <= mi
+0000ec50: 6e52 5349 2920 616e 6420 5c0a 2020 2020  nRSI) and \.    
+0000ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec70: 2864 6179 5253 4920 3e3d 2064 6179 4d69  (dayRSI >= dayMi
+0000ec80: 6e75 7331 5253 4929 290a 2020 2020 2020  nus1RSI)).      
+0000ec90: 2020 6966 2068 6173 5265 7665 7273 616c    if hasReversal
+0000eca0: 3a0a 2020 2020 2020 2020 2020 2020 7361  :.            sa
+0000ecb0: 7665 6420 3d20 7365 6c66 2e66 696e 6443  ved = self.findC
+0000ecc0: 7572 7265 6e74 5361 7665 6456 616c 7565  urrentSavedValue
+0000ecd0: 2873 6372 6565 6e44 6963 742c 7361 7665  (screenDict,save
+0000ece0: 4469 6374 2c20 2250 6174 7465 726e 2229  Dict, "Pattern")
+0000ecf0: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
+0000ed00: 6565 6e44 6963 745b 2250 6174 7465 726e  eenDict["Pattern
+0000ed10: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+0000ed20: 2020 2020 2020 2073 6176 6564 5b30 5d20         saved[0] 
+0000ed30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ed40: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
+0000ed50: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0000ed60: 2020 2b20 636f 6c6f 7254 6578 742e 4752    + colorText.GR
+0000ed70: 4545 4e0a 2020 2020 2020 2020 2020 2020  EEN.            
+0000ed80: 2020 2020 2b20 6622 5053 4152 2d52 5349      + f"PSAR-RSI
+0000ed90: 2d52 6576 220a 2020 2020 2020 2020 2020  -Rev".          
+0000eda0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0000edb0: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+0000edc0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000edd0: 7361 7665 4469 6374 5b22 5061 7474 6572  saveDict["Patter
+0000ede0: 6e22 5d20 3d20 7361 7665 645b 315d 202b  n"] = saved[1] +
+0000edf0: 2066 2250 5341 522d 5253 492d 5265 7622   f"PSAR-RSI-Rev"
+0000ee00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ee10: 2023 2028 2828 6461 794d 696e 7573 3250   # (((dayMinus2P
+0000ee20: 7361 7220 3e3d 2064 6179 4d69 6e75 7332  sar >= dayMinus2
+0000ee30: 436c 6f73 6529 2061 6e64 205c 0a20 2020  Close) and \.   
+0000ee40: 2020 2020 2020 2020 2020 2020 2023 2028               # (
+0000ee50: 2864 6179 4d69 6e75 7331 436c 6f73 6520  (dayMinus1Close 
+0000ee60: 3e3d 2064 6179 4d69 6e75 7331 5073 6172  >= dayMinus1Psar
+0000ee70: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
+0000ee80: 2020 2020 2020 2020 2320 2864 6179 436c          # (dayCl
+0000ee90: 6f73 6520 3e3d 2064 6179 5053 4152 2929  ose >= dayPSAR))
+0000eea0: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
+0000eeb0: 2020 2020 2020 2020 2320 2864 6179 4d69          # (dayMi
+0000eec0: 6e75 7332 5253 4920 3e3d 206d 696e 5253  nus2RSI >= minRS
+0000eed0: 4929 2061 6e64 205c 0a20 2020 2020 2020  I) and \.       
+0000eee0: 2020 2020 2020 2020 2023 2028 6461 794d           # (dayM
+0000eef0: 696e 7573 3152 5349 203e 3d20 6461 794d  inus1RSI >= dayM
+0000ef00: 696e 7573 3252 5349 2920 616e 6420 5c0a  inus2RSI) and \.
+0000ef10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef20: 2320 2864 6179 5253 4920 3e3d 2064 6179  # (dayRSI >= day
+0000ef30: 4d69 6e75 7331 5253 4929 2920 6f72 205c  Minus1RSI)) or \
+0000ef40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000ef50: 6861 7352 6576 6572 7361 6c0a 0a20 2020  hasReversal..   
+0000ef60: 2023 2046 696e 6420 7374 6f63 6b20 7265   # Find stock re
+0000ef70: 7665 7273 696e 6720 6174 2067 6976 656e  versing at given
+0000ef80: 204d 410a 2020 2020 6465 6620 6669 6e64   MA.    def find
+0000ef90: 5265 7665 7273 616c 4d41 2873 656c 662c  ReversalMA(self,
+0000efa0: 2064 662c 2073 6372 6565 6e44 6963 742c   df, screenDict,
+0000efb0: 2073 6176 6544 6963 742c 206d 614c 656e   saveDict, maLen
+0000efc0: 6774 682c 2070 6572 6365 6e74 6167 653d  gth, percentage=
+0000efd0: 302e 3032 293a 0a20 2020 2020 2020 2069  0.02):.        i
+0000efe0: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
+0000eff0: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
+0000f000: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000f010: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
+0000f020: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
+0000f030: 2020 2020 2020 2020 6d61 5261 6e67 6520          maRange 
+0000f040: 3d20 5b39 2c20 3130 2c20 3230 2c20 3530  = [9, 10, 20, 50
+0000f050: 2c20 3230 305d 2069 6620 6d61 4c65 6e67  , 200] if maLeng
+0000f060: 7468 2069 6e20 5b39 2c31 302c 3230 2c35  th in [9,10,20,5
+0000f070: 302c 3130 305d 2065 6c73 6520 5b39 2c31  0,100] else [9,1
+0000f080: 302c 3230 2c35 302c 3130 302c 6d61 5261  0,20,50,100,maRa
+0000f090: 6e67 655d 0a20 2020 2020 2020 2072 6573  nge].        res
+0000f0a0: 756c 7473 203d 205b 5d0a 2020 2020 2020  ults = [].      
+0000f0b0: 2020 6861 7352 6576 6572 7361 6c73 203d    hasReversals =
+0000f0c0: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
+0000f0d0: 6174 6120 3d20 6461 7461 5b3a 3a2d 315d  ata = data[::-1]
+0000f0e0: 0a20 2020 2020 2020 2073 6176 6564 203d  .        saved =
+0000f0f0: 2073 656c 662e 6669 6e64 4375 7272 656e   self.findCurren
+0000f100: 7453 6176 6564 5661 6c75 6528 7363 7265  tSavedValue(scre
+0000f110: 656e 4469 6374 2c73 6176 6544 6963 742c  enDict,saveDict,
+0000f120: 2022 4d41 2d53 6967 6e61 6c22 290a 2020   "MA-Signal").  
+0000f130: 2020 2020 2020 666f 7220 6d61 4c65 6e67        for maLeng
+0000f140: 7468 2069 6e20 6d61 5261 6e67 653a 0a20  th in maRange:. 
+0000f150: 2020 2020 2020 2020 2020 2064 6174 6143             dataC
+0000f160: 6f70 7920 3d20 6461 7461 0a20 2020 2020  opy = data.     
+0000f170: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+0000f180: 6f6e 6669 674d 616e 6167 6572 2e75 7365  onfigManager.use
+0000f190: 454d 4120 6f72 206d 614c 656e 6774 6820  EMA or maLength 
+0000f1a0: 3d3d 2039 3a0a 2020 2020 2020 2020 2020  == 9:.          
+0000f1b0: 2020 2020 2020 6d61 5265 7620 3d20 706b        maRev = pk
+0000f1c0: 7461 6c69 622e 454d 4128 6461 7461 436f  talib.EMA(dataCo
+0000f1d0: 7079 5b22 436c 6f73 6522 5d2c 2074 696d  py["Close"], tim
+0000f1e0: 6570 6572 696f 643d 6d61 4c65 6e67 7468  eperiod=maLength
+0000f1f0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000f200: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000f210: 2020 2020 6d61 5265 7620 3d20 706b 7461      maRev = pkta
+0000f220: 6c69 622e 4d41 2864 6174 6143 6f70 795b  lib.MA(dataCopy[
+0000f230: 2243 6c6f 7365 225d 2c20 7469 6d65 7065  "Close"], timepe
+0000f240: 7269 6f64 3d6d 614c 656e 6774 6829 0a20  riod=maLength). 
+0000f250: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0000f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f270: 6461 7461 436f 7079 2e64 726f 7028 226d  dataCopy.drop("m
+0000f280: 6152 6576 222c 2061 7869 733d 312c 2069  aRev", axis=1, i
+0000f290: 6e70 6c61 6365 3d54 7275 652c 2065 7272  nplace=True, err
+0000f2a0: 6f72 733d 2269 676e 6f72 6522 290a 2020  ors="ignore").  
+0000f2b0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000f2c0: 2045 7863 6570 7469 6f6e 3a23 2070 7261   Exception:# pra
+0000f2d0: 676d 613a 206e 6f20 636f 7665 720a 2020  gma: no cover.  
+0000f2e0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000f2f0: 7373 0a20 2020 2020 2020 2020 2020 2064  ss.            d
+0000f300: 6174 6143 6f70 792e 696e 7365 7274 286c  ataCopy.insert(l
+0000f310: 656e 2864 6174 6143 6f70 792e 636f 6c75  en(dataCopy.colu
+0000f320: 6d6e 7329 2c20 226d 6152 6576 222c 206d  mns), "maRev", m
+0000f330: 6152 6576 290a 2020 2020 2020 2020 2020  aRev).          
+0000f340: 2020 6461 7461 436f 7079 203d 2064 6174    dataCopy = dat
+0000f350: 6143 6f70 795b 3a3a 2d31 5d2e 6865 6164  aCopy[::-1].head
+0000f360: 2834 290a 2020 2020 2020 2020 2020 2020  (4).            
+0000f370: 6275 6c6c 6973 684d 4152 6576 6572 7361  bullishMAReversa
+0000f380: 6c20 3d20 6461 7461 436f 7079 5b22 6d61  l = dataCopy["ma
+0000f390: 5265 7622 5d2e 696c 6f63 5b30 5d20 3e3d  Rev"].iloc[0] >=
+0000f3a0: 2064 6174 6143 6f70 795b 226d 6152 6576   dataCopy["maRev
+0000f3b0: 225d 2e69 6c6f 635b 315d 2061 6e64 205c  "].iloc[1] and \
+0000f3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f3d0: 2064 6174 6143 6f70 795b 226d 6152 6576   dataCopy["maRev
+0000f3e0: 225d 2e69 6c6f 635b 315d 203e 3d20 6461  "].iloc[1] >= da
+0000f3f0: 7461 436f 7079 5b22 6d61 5265 7622 5d2e  taCopy["maRev"].
+0000f400: 696c 6f63 5b32 5d20 616e 6420 5c0a 2020  iloc[2] and \.  
+0000f410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f420: 2020 6461 7461 436f 7079 5b22 6d61 5265    dataCopy["maRe
+0000f430: 7622 5d2e 696c 6f63 5b32 5d20 3c20 6461  v"].iloc[2] < da
+0000f440: 7461 436f 7079 5b22 6d61 5265 7622 5d2e  taCopy["maRev"].
+0000f450: 696c 6f63 5b33 5d0a 2020 2020 2020 2020  iloc[3].        
+0000f460: 2020 2020 6275 6c6c 6973 6843 6c6f 7365      bullishClose
+0000f470: 203d 2064 6174 6143 6f70 792e 6865 6164   = dataCopy.head
+0000f480: 2831 295b 2243 6c6f 7365 225d 2e69 6c6f  (1)["Close"].ilo
+0000f490: 635b 305d 203e 3d20 6461 7461 436f 7079  c[0] >= dataCopy
+0000f4a0: 2e68 6561 6428 3129 5b22 6d61 5265 7622  .head(1)["maRev"
+0000f4b0: 5d2e 696c 6f63 5b30 5d0a 2020 2020 2020  ].iloc[0].      
+0000f4c0: 2020 2020 2020 6265 6172 6973 684d 4152        bearishMAR
+0000f4d0: 6576 6572 7361 6c20 3d20 6461 7461 436f  eversal = dataCo
+0000f4e0: 7079 5b22 6d61 5265 7622 5d2e 696c 6f63  py["maRev"].iloc
+0000f4f0: 5b30 5d20 3c3d 2064 6174 6143 6f70 795b  [0] <= dataCopy[
+0000f500: 226d 6152 6576 225d 2e69 6c6f 635b 315d  "maRev"].iloc[1]
+0000f510: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
+0000f520: 2020 2020 2020 2064 6174 6143 6f70 795b         dataCopy[
+0000f530: 226d 6152 6576 225d 2e69 6c6f 635b 315d  "maRev"].iloc[1]
+0000f540: 203c 3d20 6461 7461 436f 7079 5b22 6d61   <= dataCopy["ma
+0000f550: 5265 7622 5d2e 696c 6f63 5b32 5d20 616e  Rev"].iloc[2] an
+0000f560: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
+0000f570: 2020 2020 2020 2020 6461 7461 436f 7079          dataCopy
+0000f580: 5b22 6d61 5265 7622 5d2e 696c 6f63 5b32  ["maRev"].iloc[2
+0000f590: 5d20 3e20 6461 7461 436f 7079 5b22 6d61  ] > dataCopy["ma
+0000f5a0: 5265 7622 5d2e 696c 6f63 5b33 5d0a 2020  Rev"].iloc[3].  
+0000f5b0: 2020 2020 2020 2020 2020 6973 5265 6365            isRece
+0000f5c0: 6e74 436c 6f73 6557 6974 6869 6e50 6572  ntCloseWithinPer
+0000f5d0: 6365 6e74 5261 6e67 6520 3d20 6461 7461  centRange = data
+0000f5e0: 436f 7079 2e65 7175 616c 7328 6461 7461  Copy.equals(data
+0000f5f0: 436f 7079 5b28 6461 7461 436f 7079 2e43  Copy[(dataCopy.C
+0000f600: 6c6f 7365 203e 3d20 2864 6174 6143 6f70  lose >= (dataCop
+0000f610: 792e 6d61 5265 7620 2d20 2864 6174 6143  y.maRev - (dataC
+0000f620: 6f70 792e 6d61 5265 7620 2a20 7065 7263  opy.maRev * perc
+0000f630: 656e 7461 6765 2929 2920 2620 2864 6174  entage))) & (dat
+0000f640: 6143 6f70 792e 436c 6f73 6520 3c3d 2028  aCopy.Close <= (
+0000f650: 6461 7461 436f 7079 2e6d 6152 6576 202b  dataCopy.maRev +
+0000f660: 2028 6461 7461 436f 7079 2e6d 6152 6576   (dataCopy.maRev
+0000f670: 202a 2070 6572 6365 6e74 6167 6529 2929   * percentage)))
+0000f680: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
+0000f690: 6620 2869 7352 6563 656e 7443 6c6f 7365  f (isRecentClose
+0000f6a0: 5769 7468 696e 5065 7263 656e 7452 616e  WithinPercentRan
+0000f6b0: 6765 2061 6e64 2062 756c 6c69 7368 436c  ge and bullishCl
+0000f6c0: 6f73 6520 616e 6420 6275 6c6c 6973 684d  ose and bullishM
+0000f6d0: 4152 6576 6572 7361 6c29 206f 7220 5c0a  AReversal) or \.
+0000f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6f0: 2869 7352 6563 656e 7443 6c6f 7365 5769  (isRecentCloseWi
+0000f700: 7468 696e 5065 7263 656e 7452 616e 6765  thinPercentRange
+0000f710: 2061 6e64 206e 6f74 2062 756c 6c69 7368   and not bullish
+0000f720: 436c 6f73 6520 616e 6420 6265 6172 6973  Close and bearis
+0000f730: 684d 4152 6576 6572 7361 6c29 3a0a 2020  hMAReversal):.  
+0000f740: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+0000f750: 7352 6576 6572 7361 6c73 203d 2054 7275  sReversals = Tru
+0000f760: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000f770: 2020 7265 7375 6c74 732e 6170 7065 6e64    results.append
+0000f780: 2873 7472 286d 614c 656e 6774 6829 290a  (str(maLength)).
+0000f790: 2020 2020 2020 2020 6966 2068 6173 5265          if hasRe
+0000f7a0: 7665 7273 616c 733a 0a20 2020 2020 2020  versals:.       
+0000f7b0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+0000f7c0: 224d 412d 5369 676e 616c 225d 203d 2028  "MA-Signal"] = (
+0000f7d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f7e0: 2073 6176 6564 5b30 5d20 0a20 2020 2020   saved[0] .     
+0000f7f0: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+0000f800: 6f72 5465 7874 2e42 4f4c 440a 2020 2020  orText.BOLD.    
+0000f810: 2020 2020 2020 2020 2020 2020 2b20 2863              + (c
+0000f820: 6f6c 6f72 5465 7874 2e47 5245 454e 2069  olorText.GREEN i
+0000f830: 6620 6275 6c6c 6973 684d 4152 6576 6572  f bullishMARever
+0000f840: 7361 6c20 656c 7365 2028 636f 6c6f 7254  sal else (colorT
+0000f850: 6578 742e 4641 494c 2069 6620 6265 6172  ext.FAIL if bear
+0000f860: 6973 684d 4152 6576 6572 7361 6c20 656c  ishMAReversal el
+0000f870: 7365 2063 6f6c 6f72 5465 7874 2e57 4152  se colorText.WAR
+0000f880: 4e29 290a 2020 2020 2020 2020 2020 2020  N)).            
+0000f890: 2020 2020 2b20 6622 5265 7665 7273 616c      + f"Reversal
+0000f8a0: 2d5b 7b27 2c27 2e6a 6f69 6e28 7265 7375  -[{','.join(resu
+0000f8b0: 6c74 7329 7d5d 7b27 454d 4127 2069 6620  lts)}]{'EMA' if 
+0000f8c0: 286d 614c 656e 6774 6820 3d3d 2039 206f  (maLength == 9 o
+0000f8d0: 7220 7365 6c66 2e63 6f6e 6669 674d 616e  r self.configMan
+0000f8e0: 6167 6572 2e75 7365 454d 4129 2065 6c73  ager.useEMA) els
+0000f8f0: 6520 274d 4127 7d22 0a20 2020 2020 2020  e 'MA'}".       
+0000f900: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+0000f910: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+0000f920: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000f930: 2020 2073 6176 6544 6963 745b 224d 412d     saveDict["MA-
+0000f940: 5369 676e 616c 225d 203d 2073 6176 6564  Signal"] = saved
+0000f950: 5b31 5d20 2b20 6622 5265 7665 7273 616c  [1] + f"Reversal
+0000f960: 2d5b 7b27 2c27 2e6a 6f69 6e28 7265 7375  -[{','.join(resu
+0000f970: 6c74 7329 7d5d 7b27 454d 4127 2069 6620  lts)}]{'EMA' if 
+0000f980: 286d 614c 656e 6774 6820 3d3d 2039 206f  (maLength == 9 o
+0000f990: 7220 7365 6c66 2e63 6f6e 6669 674d 616e  r self.configMan
+0000f9a0: 6167 6572 2e75 7365 454d 4129 2065 6c73  ager.useEMA) els
+0000f9b0: 6520 274d 4127 7d22 0a20 2020 2020 2020  e 'MA'}".       
+0000f9c0: 2072 6574 7572 6e20 6861 7352 6576 6572   return hasRever
+0000f9d0: 7361 6c73 0a0a 2020 2020 6465 6620 6669  sals..    def fi
+0000f9e0: 6e64 4375 7272 656e 7453 6176 6564 5661  ndCurrentSavedVa
+0000f9f0: 6c75 6528 7365 6c66 2c20 7363 7265 656e  lue(self, screen
+0000fa00: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
+0000fa10: 6b65 7929 3a0a 2020 2020 2020 2020 6578  key):.        ex
+0000fa20: 6973 7469 6e67 5363 7265 656e 203d 2073  istingScreen = s
+0000fa30: 6372 6565 6e44 6963 742e 6765 7428 6b65  creenDict.get(ke
+0000fa40: 7929 0a20 2020 2020 2020 2065 7869 7374  y).        exist
+0000fa50: 696e 6753 6176 6520 3d20 7361 7665 4469  ingSave = saveDi
+0000fa60: 6374 2e67 6574 286b 6579 290a 2020 2020  ct.get(key).    
+0000fa70: 2020 2020 6578 6973 7469 6e67 5363 7265      existingScre
+0000fa80: 656e 203d 2066 227b 6578 6973 7469 6e67  en = f"{existing
+0000fa90: 5363 7265 656e 7d2c 2022 2069 6620 2865  Screen}, " if (e
+0000faa0: 7869 7374 696e 6753 6372 6565 6e20 6973  xistingScreen is
+0000fab0: 206e 6f74 204e 6f6e 6520 616e 6420 6c65   not None and le
+0000fac0: 6e28 6578 6973 7469 6e67 5363 7265 656e  n(existingScreen
+0000fad0: 2920 3e20 3029 2065 6c73 6520 2222 0a20  ) > 0) else "". 
+0000fae0: 2020 2020 2020 2065 7869 7374 696e 6753         existingS
+0000faf0: 6176 6520 3d20 6622 7b65 7869 7374 696e  ave = f"{existin
+0000fb00: 6753 6176 657d 2c20 2220 6966 2028 6578  gSave}, " if (ex
+0000fb10: 6973 7469 6e67 5361 7665 2069 7320 6e6f  istingSave is no
+0000fb20: 7420 4e6f 6e65 2061 6e64 206c 656e 2865  t None and len(e
+0000fb30: 7869 7374 696e 6753 6176 6529 203e 2030  xistingSave) > 0
+0000fb40: 2920 656c 7365 2022 220a 2020 2020 2020  ) else "".      
+0000fb50: 2020 7265 7475 726e 2065 7869 7374 696e    return existin
+0000fb60: 6753 6372 6565 6e2c 2065 7869 7374 696e  gScreen, existin
+0000fb70: 6753 6176 650a 0a20 2020 2023 2040 6d65  gSave..    # @me
+0000fb80: 6173 7572 655f 7469 6d65 0a20 2020 2064  asure_time.    d
+0000fb90: 6566 2066 696e 6442 6261 6e64 7353 7175  ef findBbandsSqu
+0000fba0: 6565 7a65 2873 656c 662c 6675 6c6c 4461  eeze(self,fullDa
+0000fbb0: 7461 2c20 7363 7265 656e 4469 6374 2c20  ta, screenDict, 
+0000fbc0: 7361 7665 4469 6374 2c20 6669 6c74 6572  saveDict, filter
+0000fbd0: 3d34 293a 0a20 2020 2020 2020 2022 2222  =4):.        """
+0000fbe0: 0a20 2020 2020 2020 2054 6865 2054 544d  .        The TTM
+0000fbf0: 2053 7175 6565 7a65 2069 6e64 6963 6174   Squeeze indicat
+0000fc00: 6f72 206d 6561 7375 7265 7320 7468 6520  or measures the 
+0000fc10: 7265 6c61 7469 6f6e 7368 6970 2062 6574  relationship bet
+0000fc20: 7765 656e 2074 6865 200a 2020 2020 2020  ween the .      
+0000fc30: 2020 426f 6c6c 696e 6765 7220 4261 6e64    Bollinger Band
+0000fc40: 7320 616e 6420 4b65 6c74 6e65 7227 7320  s and Keltner's 
+0000fc50: 4368 616e 6e65 6c2e 2057 6865 6e20 7468  Channel. When th
+0000fc60: 6520 766f 6c61 7469 6c69 7479 2069 6e63  e volatility inc
+0000fc70: 7265 6173 6573 2c20 0a20 2020 2020 2020  reases, .       
+0000fc80: 2073 6f20 646f 6573 2074 6865 2064 6973   so does the dis
+0000fc90: 7461 6e63 6520 6265 7477 6565 6e20 7468  tance between th
+0000fca0: 6520 6261 6e64 732c 2061 6e64 2063 6f6e  e bands, and con
+0000fcb0: 7665 7273 656c 792c 2077 6865 6e20 7468  versely, when th
+0000fcc0: 6520 0a20 2020 2020 2020 2076 6f6c 6174  e .        volat
+0000fcd0: 696c 6974 7920 6465 636c 696e 6573 2c20  ility declines, 
+0000fce0: 7468 6520 6469 7374 616e 6365 2061 6c73  the distance als
+0000fcf0: 6f20 6465 6372 6561 7365 732e 2054 6865  o decreases. The
+0000fd00: 2053 7175 6565 7a65 2069 6e64 6963 6174   Squeeze indicat
+0000fd10: 6f72 200a 2020 2020 2020 2020 6669 6e64  or .        find
+0000fd20: 7320 7365 6374 696f 6e73 206f 6620 7468  s sections of th
+0000fd30: 6520 426f 6c6c 696e 6765 7220 4261 6e64  e Bollinger Band
+0000fd40: 7320 7374 7564 7920 7768 6963 6820 6661  s study which fa
+0000fd50: 6c6c 2069 6e73 6964 6520 7468 6520 0a20  ll inside the . 
+0000fd60: 2020 2020 2020 204b 656c 746e 6572 2773         Keltner's
+0000fd70: 2043 6861 6e6e 656c 732e 0a20 2020 2020   Channels..     
+0000fd80: 2020 200a 2020 2020 2020 2020 4174 2074     .        At t
+0000fd90: 6865 206d 6f6d 656e 7420 7468 6973 2073  he moment this s
+0000fda0: 7175 6565 7a65 2068 6170 7065 6e73 2c20  queeze happens, 
+0000fdb0: 6120 7072 6963 6520 6272 6561 6b6f 7574  a price breakout
+0000fdc0: 2066 726f 6d20 7468 6520 7570 7065 7220   from the upper 
+0000fdd0: 0a20 2020 2020 2020 2042 6f6c 6c69 6e67  .        Bolling
+0000fde0: 6572 2042 616e 6420 776f 756c 6420 696e  er Band would in
+0000fdf0: 6469 6361 7465 2074 6865 2070 6f73 7369  dicate the possi
+0000fe00: 6269 6c69 7479 206f 6620 616e 2075 7074  bility of an upt
+0000fe10: 7265 6e64 2069 6e20 7468 6520 0a20 2020  rend in the .   
+0000fe20: 2020 2020 2066 7574 7572 652e 2054 6869       future. Thi
+0000fe30: 7320 6973 2062 6163 6b65 6420 6279 2074  s is backed by t
+0000fe40: 6865 2066 6163 7420 7468 6174 206f 6e63  he fact that onc
+0000fe50: 6520 7468 6520 7072 6963 6520 7374 6172  e the price star
+0000fe60: 7473 2062 7265 616b 696e 6720 0a20 2020  ts breaking .   
+0000fe70: 2020 2020 206f 7574 206f 6620 7468 6520       out of the 
+0000fe80: 6261 6e64 732c 2069 7420 776f 756c 6420  bands, it would 
+0000fe90: 6d65 616e 2061 2072 656c 6178 6174 696f  mean a relaxatio
+0000fea0: 6e20 6f66 2074 6865 2073 7175 6565 7a65  n of the squeeze
+0000feb0: 2061 6e64 2074 6865 200a 2020 2020 2020   and the .      
+0000fec0: 2020 706f 7373 6962 696c 6974 7920 6f66    possibility of
+0000fed0: 2068 6967 6820 6d61 726b 6574 2076 6f6c   high market vol
+0000fee0: 6174 696c 6974 7920 616e 6420 7072 6963  atility and pric
+0000fef0: 6520 6d6f 7665 6d65 6e74 2069 6e20 7468  e movement in th
+0000ff00: 6520 6675 7475 7265 2e20 0a20 2020 2020  e future. .     
+0000ff10: 2020 2053 696d 696c 6172 6c79 2c20 6120     Similarly, a 
+0000ff20: 7072 6963 6520 6272 6561 6b6f 7574 2066  price breakout f
+0000ff30: 726f 6d20 7468 6520 6c6f 7765 7220 426f  rom the lower Bo
+0000ff40: 6c6c 696e 6765 7220 4261 6e64 2061 6674  llinger Band aft
+0000ff50: 6572 2061 2073 7175 6565 7a65 200a 2020  er a squeeze .  
+0000ff60: 2020 2020 2020 776f 756c 6420 696e 6469        would indi
+0000ff70: 6361 7465 2074 6865 2070 6f73 7369 6269  cate the possibi
+0000ff80: 6c69 7479 206f 6620 6120 646f 776e 7472  lity of a downtr
+0000ff90: 656e 6420 696e 2074 6865 2066 7574 7572  end in the futur
+0000ffa0: 6520 616e 6420 616e 200a 2020 2020 2020  e and an .      
+0000ffb0: 2020 696e 6372 6561 7365 6420 6d61 726b    increased mark
+0000ffc0: 6574 2076 6f6c 6174 696c 6974 7920 696e  et volatility in
+0000ffd0: 2074 6865 2073 616d 6520 6469 7265 6374   the same direct
+0000ffe0: 696f 6e2e 2057 6865 6e20 7468 6520 6d61  ion. When the ma
+0000fff0: 726b 6574 200a 2020 2020 2020 2020 6669  rket .        fi
+00010000: 6e69 7368 6573 2061 206d 6f76 652c 2074  nishes a move, t
+00010010: 6865 2069 6e64 6963 6174 6f72 2074 7572  he indicator tur
+00010020: 6e73 206f 6666 2c20 7768 6963 6820 636f  ns off, which co
+00010030: 7272 6573 706f 6e64 7320 746f 2062 616e  rresponds to ban
+00010040: 6473 200a 2020 2020 2020 2020 6861 7669  ds .        havi
+00010050: 6e67 2070 7573 6865 6420 7765 6c6c 206f  ng pushed well o
+00010060: 7574 7369 6465 2074 6865 2072 616e 6765  utside the range
+00010070: 206f 6620 4b65 6c74 6e65 7227 7320 4368   of Keltner's Ch
+00010080: 616e 6e65 6c73 2e0a 2020 2020 2020 2020  annels..        
+00010090: 2222 220a 2020 2020 2020 2020 6966 2066  """.        if f
+000100a0: 756c 6c44 6174 6120 6973 204e 6f6e 6520  ullData is None 
+000100b0: 6f72 206c 656e 2866 756c 6c44 6174 6129  or len(fullData)
+000100c0: 203c 2032 303a 0a20 2020 2020 2020 2020   < 20:.         
+000100d0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+000100e0: 2020 2020 2020 2020 6f6c 6465 7374 5265          oldestRe
+000100f0: 636f 7264 7346 6972 7374 5f64 6620 3d20  cordsFirst_df = 
+00010100: 6675 6c6c 4461 7461 2e68 6561 6428 3330  fullData.head(30
+00010110: 292e 636f 7079 2829 0a20 2020 2020 2020  ).copy().       
+00010120: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
+00010130: 7273 745f 6466 203d 206f 6c64 6573 7452  rst_df = oldestR
+00010140: 6563 6f72 6473 4669 7273 745f 6466 5b3a  ecordsFirst_df[:
+00010150: 3a2d 315d 2e74 6169 6c28 3330 290a 2020  :-1].tail(30).  
+00010160: 2020 2020 2020 6c61 7465 7374 5265 636f        latestReco
+00010170: 7264 7346 6972 7374 5f64 6620 3d20 6c61  rdsFirst_df = la
+00010180: 7465 7374 5265 636f 7264 7346 6972 7374  testRecordsFirst
+00010190: 5f64 662e 6669 6c6c 6e61 2830 290a 2020  _df.fillna(0).  
+000101a0: 2020 2020 2020 6c61 7465 7374 5265 636f        latestReco
+000101b0: 7264 7346 6972 7374 5f64 6620 3d20 6c61  rdsFirst_df = la
+000101c0: 7465 7374 5265 636f 7264 7346 6972 7374  testRecordsFirst
+000101d0: 5f64 662e 7265 706c 6163 6528 5b6e 702e  _df.replace([np.
+000101e0: 696e 662c 202d 6e70 2e69 6e66 5d2c 2030  inf, -np.inf], 0
+000101f0: 290a 2020 2020 2020 2020 2320 426f 6c6c  ).        # Boll
+00010200: 696e 6765 7220 6261 6e64 730a 2020 2020  inger bands.    
+00010210: 2020 2020 6c61 7465 7374 5265 636f 7264      latestRecord
+00010220: 7346 6972 7374 5f64 662e 6c6f 635b 3a2c  sFirst_df.loc[:,
+00010230: 2742 4261 6e64 732d 5527 5d2c 206c 6174  'BBands-U'], lat
+00010240: 6573 7452 6563 6f72 6473 4669 7273 745f  estRecordsFirst_
+00010250: 6466 2e6c 6f63 5b3a 2c27 4242 616e 6473  df.loc[:,'BBands
+00010260: 2d4d 275d 2c20 6c61 7465 7374 5265 636f  -M'], latestReco
+00010270: 7264 7346 6972 7374 5f64 662e 6c6f 635b  rdsFirst_df.loc[
+00010280: 3a2c 2742 4261 6e64 732d 4c27 5d20 3d20  :,'BBands-L'] = 
+00010290: 706b 7461 6c69 622e 4242 414e 4453 286c  pktalib.BBANDS(l
+000102a0: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
+000102b0: 745f 6466 5b22 436c 6f73 6522 5d2c 2032  t_df["Close"], 2
+000102c0: 3029 0a20 2020 2020 2020 2023 2063 6f6d  0).        # com
+000102d0: 7075 7465 204b 656c 746e 6572 2773 2063  pute Keltner's c
+000102e0: 6861 6e6e 656c 0a20 2020 2020 2020 206c  hannel.        l
+000102f0: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
+00010300: 745f 6466 5b27 6c6f 775f 6b65 6c27 5d2c  t_df['low_kel'],
+00010310: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
+00010320: 7273 745f 6466 5b27 7570 705f 6b65 6c27  rst_df['upp_kel'
+00010330: 5d20 3d20 706b 7461 6c69 622e 4b65 6c74  ] = pktalib.Kelt
+00010340: 6e65 7273 4368 616e 6e65 6c28 6c61 7465  nersChannel(late
+00010350: 7374 5265 636f 7264 7346 6972 7374 5f64  stRecordsFirst_d
+00010360: 665b 2248 6967 6822 5d2c 206c 6174 6573  f["High"], lates
+00010370: 7452 6563 6f72 6473 4669 7273 745f 6466  tRecordsFirst_df
+00010380: 5b22 4c6f 7722 5d2c 6c61 7465 7374 5265  ["Low"],latestRe
+00010390: 636f 7264 7346 6972 7374 5f64 665b 2243  cordsFirst_df["C
+000103a0: 6c6f 7365 225d 2c32 3029 0a20 2020 2020  lose"],20).     
+000103b0: 2020 2023 2073 7175 6565 7a65 2069 6e64     # squeeze ind
+000103c0: 6963 6174 6f72 0a20 2020 2020 2020 2064  icator.        d
+000103d0: 6566 2069 6e5f 7371 7565 657a 6528 6466  ef in_squeeze(df
+000103e0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+000103f0: 6574 7572 6e20 6466 5b27 6c6f 775f 6b65  eturn df['low_ke
+00010400: 6c27 5d20 3c20 6466 5b27 4242 616e 6473  l'] < df['BBands
+00010410: 2d4c 275d 203c 2064 665b 2742 4261 6e64  -L'] < df['BBand
+00010420: 732d 5527 5d20 3c20 6466 5b27 7570 705f  s-U'] < df['upp_
+00010430: 6b65 6c27 5d0a 0a20 2020 2020 2020 206c  kel']..        l
+00010440: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
+00010450: 745f 6466 5b27 7371 7565 657a 6527 5d20  t_df['squeeze'] 
+00010460: 3d20 6c61 7465 7374 5265 636f 7264 7346  = latestRecordsF
+00010470: 6972 7374 5f64 662e 6170 706c 7928 696e  irst_df.apply(in
+00010480: 5f73 7175 6565 7a65 2c20 6178 6973 3d31  _squeeze, axis=1
+00010490: 290a 0a20 2020 2020 2020 2023 204c 6574  )..        # Let
+000104a0: 2773 2072 6576 6965 7720 6a75 7374 2074  's review just t
+000104b0: 6865 2070 7265 7669 6f75 7320 3320 6361  he previous 3 ca
+000104c0: 6e64 6c65 7320 696e 636c 7564 696e 6720  ndles including 
+000104d0: 746f 6461 7920 2861 7420 7468 6520 656e  today (at the en
+000104e0: 6429 0a20 2020 2020 2020 206c 6174 6573  d).        lates
+000104f0: 7452 6563 6f72 6473 4669 7273 745f 6466  tRecordsFirst_df
+00010500: 203d 206c 6174 6573 7452 6563 6f72 6473   = latestRecords
+00010510: 4669 7273 745f 6466 2e74 6169 6c28 3329  First_df.tail(3)
+00010520: 0a20 2020 2020 2020 2023 2073 746f 636b  .        # stock
+00010530: 2069 7320 636f 6d69 6e67 206f 7574 206f   is coming out o
+00010540: 6620 7468 6520 7371 7565 657a 650a 2020  f the squeeze.  
+00010550: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
+00010560: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
+00010570: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
+00010580: 6963 742c 2073 6176 6544 6963 742c 2022  ict, saveDict, "
+00010590: 5061 7474 6572 6e22 290a 2020 2020 2020  Pattern").      
+000105a0: 2020 6361 6e64 6c65 3353 717a 203d 206c    candle3Sqz = l
+000105b0: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
+000105c0: 745f 6466 2e69 6c6f 635b 2d33 5d5b 2273  t_df.iloc[-3]["s
+000105d0: 7175 6565 7a65 225d 0a20 2020 2020 2020  queeze"].       
+000105e0: 2063 616e 646c 6531 5371 7a20 3d20 6c61   candle1Sqz = la
+000105f0: 7465 7374 5265 636f 7264 7346 6972 7374  testRecordsFirst
+00010600: 5f64 662e 696c 6f63 5b2d 315d 5b22 7371  _df.iloc[-1]["sq
+00010610: 7565 657a 6522 5d0a 2020 2020 2020 2020  ueeze"].        
+00010620: 6361 6e64 6c65 3253 717a 203d 206c 6174  candle2Sqz = lat
+00010630: 6573 7452 6563 6f72 6473 4669 7273 745f  estRecordsFirst_
+00010640: 6466 2e69 6c6f 635b 2d32 5d5b 2273 7175  df.iloc[-2]["squ
+00010650: 6565 7a65 225d 0a20 2020 2020 2020 2069  eeze"].        i
+00010660: 6620 6361 6e64 6c65 3353 717a 2061 6e64  f candle3Sqz and
+00010670: 206e 6f74 2063 616e 646c 6531 5371 7a3a   not candle1Sqz:
+00010680: 0a20 2020 2020 2020 2020 2020 2023 2033  .            # 3
+00010690: 7264 2063 616e 646c 6520 6672 6f6d 2074  rd candle from t
+000106a0: 6865 206d 6f73 7420 7265 6365 6e74 206f  he most recent o
+000106b0: 6e65 2077 6173 2069 6e20 7371 7565 657a  ne was in squeez
+000106c0: 6520 6275 7420 7468 6520 6d6f 7374 2072  e but the most r
+000106d0: 6563 656e 7420 6f6e 6520 6973 206e 6f74  ecent one is not
+000106e0: 2e0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000106f0: 2066 696c 7465 7220 6e6f 7420 696e 205b   filter not in [
+00010700: 312c 332c 345d 3a20 2320 4275 792f 5365  1,3,4]: # Buy/Se
+00010710: 6c6c 2f41 6c6c 0a20 2020 2020 2020 2020  ll/All.         
+00010720: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00010730: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00010740: 2320 6465 6369 6465 2077 6869 6368 2061  # decide which a
+00010750: 6374 696f 6e20 746f 2074 616b 6520 6279  ction to take by
+00010760: 2063 6f6d 7061 7269 6e67 2064 6973 7461   comparing dista
+00010770: 6e63 6573 2020 2020 2020 2020 2020 2020  nces            
+00010780: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00010790: 2064 6973 7461 6e63 655f 746f 5f75 7070   distance_to_upp
+000107a0: 6572 203d 2061 6273 286c 6174 6573 7452  er = abs(latestR
+000107b0: 6563 6f72 6473 4669 7273 745f 6466 5b27  ecordsFirst_df['
+000107c0: 4242 616e 6473 2d55 275d 2e76 616c 7565  BBands-U'].value
+000107d0: 735b 2d31 5d20 2d20 6c61 7465 7374 5265  s[-1] - latestRe
+000107e0: 636f 7264 7346 6972 7374 5f64 665b 2743  cordsFirst_df['C
+000107f0: 6c6f 7365 275d 2e76 616c 7565 735b 2d31  lose'].values[-1
+00010800: 5d29 0a20 2020 2020 2020 2020 2020 2064  ]).            d
+00010810: 6973 7461 6e63 655f 746f 5f6c 6f77 6572  istance_to_lower
+00010820: 203d 2061 6273 286c 6174 6573 7452 6563   = abs(latestRec
+00010830: 6f72 6473 4669 7273 745f 6466 5b27 4242  ordsFirst_df['BB
+00010840: 616e 6473 2d4c 275d 2e76 616c 7565 735b  ands-L'].values[
+00010850: 2d31 5d20 2d20 6c61 7465 7374 5265 636f  -1] - latestReco
+00010860: 7264 7346 6972 7374 5f64 665b 2743 6c6f  rdsFirst_df['Clo
+00010870: 7365 275d 2e76 616c 7565 735b 2d31 5d29  se'].values[-1])
+00010880: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00010890: 2020 2020 2020 2020 2020 6163 7469 6f6e            action
+000108a0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+000108b0: 2020 2020 2069 6620 6469 7374 616e 6365       if distance
+000108c0: 5f74 6f5f 7570 7065 7220 3c20 6469 7374  _to_upper < dist
+000108d0: 616e 6365 5f74 6f5f 6c6f 7765 723a 0a20  ance_to_lower:. 
+000108e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000108f0: 6620 6669 6c74 6572 206e 6f74 2069 6e20  f filter not in 
+00010900: 5b31 2c34 5d3a 2023 2042 7579 2f41 6c6c  [1,4]: # Buy/All
+00010910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010920: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00010930: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00010940: 2020 6163 7469 6f6e 203d 2054 7275 650a    action = True.
+00010950: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00010960: 2066 696c 7465 7220 6e6f 7420 696e 205b   filter not in [
+00010970: 332c 345d 3a20 2320 5365 6c6c 2f41 6c6c  3,4]: # Sell/All
+00010980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010990: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+000109a0: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+000109b0: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+000109c0: 3d20 7361 7665 645b 305d 202b 2063 6f6c  = saved[0] + col
+000109d0: 6f72 5465 7874 2e42 4f4c 4420 2b20 2863  orText.BOLD + (c
+000109e0: 6f6c 6f72 5465 7874 2e47 5245 454e 2069  olorText.GREEN i
+000109f0: 6620 6163 7469 6f6e 2065 6c73 6520 636f  f action else co
+00010a00: 6c6f 7254 6578 742e 4641 494c 2920 2b20  lorText.FAIL) + 
+00010a10: 6622 4242 616e 6473 2d53 515a 2d7b 2742  f"BBands-SQZ-{'B
+00010a20: 7579 2720 6966 2061 6374 696f 6e20 656c  uy' if action el
+00010a30: 7365 2027 5365 6c6c 277d 2220 2b20 636f  se 'Sell'}" + co
+00010a40: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+00010a50: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
+00010a60: 5b22 5061 7474 6572 6e22 5d20 3d20 7361  ["Pattern"] = sa
+00010a70: 7665 645b 315d 202b 2066 2254 544d 2d53  ved[1] + f"TTM-S
+00010a80: 515a 2d7b 2742 7579 2720 6966 2061 6374  QZ-{'Buy' if act
+00010a90: 696f 6e20 656c 7365 2027 5365 6c6c 277d  ion else 'Sell'}
+00010aa0: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
+00010ab0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+00010ac0: 2020 656c 6966 2063 616e 646c 6533 5371    elif candle3Sq
+00010ad0: 7a20 616e 6420 6361 6e64 6c65 3253 717a  z and candle2Sqz
+00010ae0: 2061 6e64 2063 616e 646c 6531 5371 7a3a   and candle1Sqz:
+00010af0: 0a20 2020 2020 2020 2020 2020 2023 204c  .            # L
+00010b00: 6173 7420 3320 6361 6e64 6c65 7320 696e  ast 3 candles in
+00010b10: 2073 7175 6565 7a65 0a20 2020 2020 2020   squeeze.       
+00010b20: 2020 2020 2069 6620 6669 6c74 6572 206e       if filter n
+00010b30: 6f74 2069 6e20 5b32 2c34 5d3a 2023 2053  ot in [2,4]: # S
+00010b40: 715a 2f41 6c6c 0a20 2020 2020 2020 2020  qZ/All.         
+00010b50: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00010b60: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00010b70: 7363 7265 656e 4469 6374 5b22 5061 7474  screenDict["Patt
+00010b80: 6572 6e22 5d20 3d20 6627 7b73 6176 6564  ern"] = f'{saved
+00010b90: 5b30 5d7d 7b63 6f6c 6f72 5465 7874 2e42  [0]}{colorText.B
+00010ba0: 4f4c 447d 7b63 6f6c 6f72 5465 7874 2e57  OLD}{colorText.W
+00010bb0: 4152 4e7d 5454 4d2d 5351 5a7b 636f 6c6f  ARN}TTM-SQZ{colo
+00010bc0: 7254 6578 742e 454e 447d 270a 2020 2020  rText.END}'.    
+00010bd0: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
+00010be0: 5b22 5061 7474 6572 6e22 5d20 3d20 6627  ["Pattern"] = f'
+00010bf0: 7b73 6176 6564 5b31 5d7d 5454 4d2d 5351  {saved[1]}TTM-SQ
+00010c00: 5a27 0a20 2020 2020 2020 2020 2020 2072  Z'.            r
+00010c10: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
+00010c20: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00010c30: 0a20 2020 2064 6566 2066 696e 6449 6e74  .    def findInt
+00010c40: 7261 6461 7948 6967 6843 726f 7373 6f76  radayHighCrossov
+00010c50: 6572 2873 656c 662c 2064 662c 2061 6674  er(self, df, aft
+00010c60: 6572 5469 6d65 7374 616d 703d 4e6f 6e65  erTimestamp=None
+00010c70: 293a 0a20 2020 2020 2020 2069 6620 6466  ):.        if df
+00010c80: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
+00010c90: 6466 2920 3d3d 2030 3a0a 2020 2020 2020  df) == 0:.      
+00010ca0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00010cb0: 7365 0a20 2020 2020 2020 2064 6174 6120  se.        data 
+00010cc0: 3d20 6466 2e63 6f70 7928 290a 2020 2020  = df.copy().    
+00010cd0: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+00010ce0: 6669 6c6c 6e61 2830 290a 2020 2020 2020  fillna(0).      
+00010cf0: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
+00010d00: 706c 6163 6528 5b6e 702e 696e 662c 202d  place([np.inf, -
+00010d10: 6e70 2e69 6e66 5d2c 2030 290a 2020 2020  np.inf], 0).    
+00010d20: 2020 2020 6461 7461 203d 2064 6174 615b      data = data[
+00010d30: 3a3a 2d31 5d20 2023 2052 6576 6572 7365  ::-1]  # Reverse
+00010d40: 2074 6865 2064 6174 6166 7261 6d65 2073   the dataframe s
+00010d50: 6f20 7468 6174 2069 7473 2074 6865 206f  o that its the o
+00010d60: 6c64 6573 7420 6461 7465 2066 6972 7374  ldest date first
+00010d70: 0a20 2020 2020 2020 2064 6966 665f 6466  .        diff_df
+00010d80: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00010d90: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00010da0: 2023 204c 6574 2773 206f 6e6c 7920 636f   # Let's only co
+00010db0: 6e73 6964 6572 2074 686f 7365 2063 616e  nsider those can
+00010dc0: 646c 6573 2074 6861 7420 6172 6520 6166  dles that are af
+00010dd0: 7465 7220 7468 6520 616c 6572 7420 6973  ter the alert is
+00010de0: 7375 652d 7469 6d65 2069 6e20 7468 6520  sue-time in the 
+00010df0: 6d6f 726e 696e 6773 202b 2032 2063 616e  mornings + 2 can
+00010e00: 646c 6573 2028 666f 7220 6275 792f 7365  dles (for buy/se
+00010e10: 6c6c 290a 2020 2020 2020 2020 2020 2020  ll).            
+00010e20: 6469 6666 5f64 6620 3d20 6461 7461 5b64  diff_df = data[d
+00010e30: 6174 612e 696e 6465 7820 3e3d 2020 7064  ata.index >=  pd
+00010e40: 2e74 6f5f 6461 7465 7469 6d65 2866 277b  .to_datetime(f'{
+00010e50: 504b 4461 7465 5574 696c 6974 6965 732e  PKDateUtilities.
+00010e60: 7472 6164 696e 6744 6174 6528 292e 7374  tradingDate().st
+00010e70: 7266 7469 6d65 2866 2225 592d 256d 2d25  rftime(f"%Y-%m-%
+00010e80: 6422 297d 2030 393a 7b31 352b 7365 6c66  d")} 09:{15+self
+00010e90: 2e63 6f6e 6669 674d 616e 6167 6572 2e6d  .configManager.m
+00010ea0: 6f72 6e69 6e67 616e 616c 7973 6973 6361  orninganalysisca
+00010eb0: 6e64 6c65 6e75 6d62 6572 202b 2032 7d3a  ndlenumber + 2}:
+00010ec0: 3030 2b30 353a 3330 2729 2e74 6f5f 6461  00+05:30').to_da
+00010ed0: 7465 7469 6d65 3634 2829 5d0a 2020 2020  tetime64()].    
+00010ee0: 2020 2020 2020 2020 2320 6272 6f6b 6572          # broker
+00010ef0: 5371 724f 6666 7469 6d65 203d 2070 642e  SqrOfftime = pd.
+00010f00: 746f 5f64 6174 6574 696d 6528 6627 7b50  to_datetime(f'{P
+00010f10: 4b44 6174 6555 7469 6c69 7469 6573 2e74  KDateUtilities.t
+00010f20: 7261 6469 6e67 4461 7465 2829 2e73 7472  radingDate().str
+00010f30: 6674 696d 6528 6622 2559 2d25 6d2d 2564  ftime(f"%Y-%m-%d
+00010f40: 2229 7d20 3135 3a31 343a 3030 2b30 353a  ")} 15:14:00+05:
+00010f50: 3330 2729 2e74 6f5f 6461 7465 7469 6d65  30').to_datetime
+00010f60: 3634 2829 0a20 2020 2020 2020 2065 7863  64().        exc
+00010f70: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+00010f80: 2064 6966 665f 6466 203d 2064 6174 615b   diff_df = data[
+00010f90: 6461 7461 2e69 6e64 6578 203e 3d20 2070  data.index >=  p
+00010fa0: 642e 746f 5f64 6174 6574 696d 6528 6627  d.to_datetime(f'
+00010fb0: 7b50 4b44 6174 6555 7469 6c69 7469 6573  {PKDateUtilities
+00010fc0: 2e74 7261 6469 6e67 4461 7465 2829 2e73  .tradingDate().s
+00010fd0: 7472 6674 696d 6528 6622 2559 2d25 6d2d  trftime(f"%Y-%m-
+00010fe0: 2564 2229 7d20 3039 3a7b 3135 2b73 656c  %d")} 09:{15+sel
+00010ff0: 662e 636f 6e66 6967 4d61 6e61 6765 722e  f.configManager.
+00011000: 6d6f 726e 696e 6761 6e61 6c79 7369 7363  morninganalysisc
+00011010: 616e 646c 656e 756d 6265 7220 2b20 327d  andlenumber + 2}
+00011020: 3a30 302b 3035 3a33 3027 2c20 7574 633d  :00+05:30', utc=
+00011030: 5472 7565 295d 0a20 2020 2020 2020 2020  True)].         
+00011040: 2020 2023 2062 726f 6b65 7253 7172 4f66     # brokerSqrOf
+00011050: 6674 696d 6520 3d20 7064 2e74 6f5f 6461  ftime = pd.to_da
+00011060: 7465 7469 6d65 2866 277b 504b 4461 7465  tetime(f'{PKDate
+00011070: 5574 696c 6974 6965 732e 7472 6164 696e  Utilities.tradin
+00011080: 6744 6174 6528 292e 7374 7266 7469 6d65  gDate().strftime
+00011090: 2866 2225 592d 256d 2d25 6422 297d 2031  (f"%Y-%m-%d")} 1
+000110a0: 353a 3134 3a30 302b 3035 3a33 3027 2c20  5:14:00+05:30', 
+000110b0: 7574 633d 5472 7565 290a 2020 2020 2020  utc=True).      
+000110c0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+000110d0: 2020 2064 6179 4869 6768 4166 7465 7241     dayHighAfterA
+000110e0: 6c65 7274 203d 2064 6966 665f 6466 5b22  lert = diff_df["
+000110f0: 4869 6768 225d 2e6d 6178 2829 0a20 2020  High"].max().   
+00011100: 2020 2020 2068 6967 6852 6f77 203d 2064       highRow = d
+00011110: 6966 665f 6466 5b64 6966 665f 6466 5b22  iff_df[diff_df["
+00011120: 4869 6768 225d 203e 3d20 6461 7948 6967  High"] >= dayHig
+00011130: 6841 6674 6572 416c 6572 745d 0a20 2020  hAfterAlert].   
+00011140: 2020 2020 2069 6620 6869 6768 526f 7720       if highRow 
+00011150: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00011160: 6c65 6e28 6869 6768 526f 7729 203e 2030  len(highRow) > 0
+00011170: 3a0a 2020 2020 2020 2020 2020 2020 6869  :.            hi
+00011180: 6768 526f 7720 3d20 6869 6768 526f 772e  ghRow = highRow.
+00011190: 7461 696c 2831 290a 2020 2020 2020 2020  tail(1).        
+000111a0: 7265 7475 726e 2068 6967 6852 6f77 2e69  return highRow.i
+000111b0: 6e64 6578 5b2d 315d 2c20 6869 6768 526f  ndex[-1], highRo
+000111c0: 770a 0a0a 2020 2020 6465 6620 6669 6e64  w...    def find
+000111d0: 4d41 4344 4372 6f73 736f 7665 7228 7365  MACDCrossover(se
+000111e0: 6c66 2c20 6466 2c20 6166 7465 7254 696d  lf, df, afterTim
+000111f0: 6573 7461 6d70 3d4e 6f6e 652c 206e 7468  estamp=None, nth
+00011200: 4372 6f73 736f 7665 723d 312c 2075 7044  Crossover=1, upD
+00011210: 6972 6563 7469 6f6e 3d54 7275 652c 206d  irection=True, m
+00011220: 696e 5253 493d 3630 293a 0a20 2020 2020  inRSI=60):.     
+00011230: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
+00011240: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
+00011250: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00011260: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00011270: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
+00011280: 7928 290a 2020 2020 2020 2020 6461 7461  y().        data
+00011290: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
+000112a0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+000112b0: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
+000112c0: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
+000112d0: 2030 290a 2020 2020 2020 2020 6461 7461   0).        data
+000112e0: 2e64 726f 706e 6128 6178 6973 3d30 2c20  .dropna(axis=0, 
+000112f0: 686f 773d 2261 6c6c 222c 2069 6e70 6c61  how="all", inpla
+00011300: 6365 3d54 7275 6529 2023 204d 6179 6265  ce=True) # Maybe
+00011310: 2074 6865 7265 2077 6173 206e 6f20 7472   there was no tr
+00011320: 6164 6520 646f 6e65 2061 7420 7468 6573  ade done at thes
+00011330: 6520 7469 6d65 733f 0a20 2020 2020 2020  e times?.       
+00011340: 2064 6174 6120 3d20 6461 7461 5b3a 3a2d   data = data[::-
+00011350: 315d 2020 2320 5265 7665 7273 6520 7468  1]  # Reverse th
+00011360: 6520 6461 7461 6672 616d 6520 736f 2074  e dataframe so t
+00011370: 6861 7420 6974 7320 7468 6520 6f6c 6465  hat its the olde
+00011380: 7374 2064 6174 6520 6669 7273 740a 2020  st date first.  
+00011390: 2020 2020 2020 6d61 6364 4c69 6e65 2c20        macdLine, 
+000113a0: 6d61 6364 5369 676e 616c 2c20 6d61 6364  macdSignal, macd
+000113b0: 4869 7374 203d 2070 6b74 616c 6962 2e4d  Hist = pktalib.M
+000113c0: 4143 4428 6461 7461 5b22 436c 6f73 6522  ACD(data["Close"
+000113d0: 5d2c 2031 322c 2032 362c 2039 290a 2020  ], 12, 26, 9).  
+000113e0: 2020 2020 2020 2320 7273 695f 6466 203d        # rsi_df =
+000113f0: 2070 6b74 616c 6962 2e52 5349 2864 6174   pktalib.RSI(dat
+00011400: 615b 2243 6c6f 7365 225d 2c20 3134 290a  a["Close"], 14).
+00011410: 2020 2020 2020 2020 6c69 6e65 5f64 6620          line_df 
+00011420: 3d20 7064 2e44 6174 6146 7261 6d65 286d  = pd.DataFrame(m
+00011430: 6163 644c 696e 6529 0a20 2020 2020 2020  acdLine).       
+00011440: 2073 6967 6e61 6c5f 6466 203d 2070 642e   signal_df = pd.
+00011450: 4461 7461 4672 616d 6528 6d61 6364 5369  DataFrame(macdSi
+00011460: 676e 616c 290a 2020 2020 2020 2020 766f  gnal).        vo
+00011470: 6c5f 6466 203d 2064 6174 615b 2256 6f6c  l_df = data["Vol
+00011480: 756d 6522 5d0a 2020 2020 2020 2020 6469  ume"].        di
+00011490: 6666 5f64 6620 3d20 7064 2e63 6f6e 6361  ff_df = pd.conca
+000114a0: 7428 5b6c 696e 655f 6466 2c20 7369 676e  t([line_df, sign
+000114b0: 616c 5f64 662c 2073 6967 6e61 6c5f 6466  al_df, signal_df
+000114c0: 2d6c 696e 655f 6466 2c76 6f6c 5f64 665d  -line_df,vol_df]
+000114d0: 2c20 6178 6973 3d31 290a 2020 2020 2020  , axis=1).      
+000114e0: 2020 6469 6666 5f64 662e 636f 6c75 6d6e    diff_df.column
+000114f0: 7320 3d20 5b22 6c69 6e65 222c 2273 6967  s = ["line","sig
+00011500: 6e61 6c22 2c22 6469 6666 222c 2276 6f6c  nal","diff","vol
+00011510: 225d 0a20 2020 2020 2020 2064 6966 665f  "].        diff_
+00011520: 6466 203d 2064 6966 665f 6466 5b64 6966  df = diff_df[dif
+00011530: 665f 6466 5b22 766f 6c22 5d20 3e20 305d  f_df["vol"] > 0]
+00011540: 2023 2057 6527 7265 206e 6f74 2067 6f69   # We're not goi
+00011550: 6e67 2074 6f20 646f 2061 6e79 7468 696e  ng to do anythin
+00011560: 6720 7769 7468 2061 2063 616e 646c 6520  g with a candle 
+00011570: 7768 6572 6520 7468 6572 6520 7761 7320  where there was 
+00011580: 6e6f 2074 7261 6465 2e0a 2020 2020 2020  no trade..      
+00011590: 2020 2320 6272 6f6b 6572 5371 724f 6666    # brokerSqrOff
+000115a0: 7469 6d65 203d 204e 6f6e 650a 2020 2020  time = None.    
+000115b0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000115c0: 2020 2020 2023 204c 6574 2773 206f 6e6c       # Let's onl
+000115d0: 7920 636f 6e73 6964 6572 2074 686f 7365  y consider those
+000115e0: 2063 616e 646c 6573 2074 6861 7420 6172   candles that ar
+000115f0: 6520 6166 7465 7220 7468 6520 616c 6572  e after the aler
+00011600: 7420 6973 7375 652d 7469 6d65 2069 6e20  t issue-time in 
+00011610: 7468 6520 6d6f 726e 696e 6773 202b 2032  the mornings + 2
+00011620: 2063 616e 646c 6573 2028 666f 7220 6275   candles (for bu
+00011630: 792f 7365 6c6c 290a 2020 2020 2020 2020  y/sell).        
 00011640: 2020 2020 6469 6666 5f64 6620 3d20 6469      diff_df = di
 00011650: 6666 5f64 665b 6469 6666 5f64 662e 696e  ff_df[diff_df.in
 00011660: 6465 7820 3e3d 2020 7064 2e74 6f5f 6461  dex >=  pd.to_da
 00011670: 7465 7469 6d65 2866 277b 504b 4461 7465  tetime(f'{PKDate
 00011680: 5574 696c 6974 6965 732e 7472 6164 696e  Utilities.tradin
 00011690: 6744 6174 6528 292e 7374 7266 7469 6d65  gDate().strftime
 000116a0: 2866 2225 592d 256d 2d25 6422 297d 2030  (f"%Y-%m-%d")} 0
 000116b0: 393a 7b31 352b 7365 6c66 2e63 6f6e 6669  9:{15+self.confi
 000116c0: 674d 616e 6167 6572 2e6d 6f72 6e69 6e67  gManager.morning
 000116d0: 616e 616c 7973 6973 6361 6e64 6c65 6e75  analysiscandlenu
 000116e0: 6d62 6572 202b 2032 7d3a 3030 2b30 353a  mber + 2}:00+05:
-000116f0: 3330 272c 2075 7463 3d54 7275 6529 5d0a  30', utc=True)].
-00011700: 2020 2020 2020 2020 2020 2020 2320 6272              # br
-00011710: 6f6b 6572 5371 724f 6666 7469 6d65 203d  okerSqrOfftime =
-00011720: 2070 642e 746f 5f64 6174 6574 696d 6528   pd.to_datetime(
-00011730: 6627 7b50 4b44 6174 6555 7469 6c69 7469  f'{PKDateUtiliti
-00011740: 6573 2e74 7261 6469 6e67 4461 7465 2829  es.tradingDate()
-00011750: 2e73 7472 6674 696d 6528 6622 2559 2d25  .strftime(f"%Y-%
-00011760: 6d2d 2564 2229 7d20 3135 3a31 343a 3030  m-%d")} 15:14:00
-00011770: 2b30 353a 3330 272c 2075 7463 3d54 7275  +05:30', utc=Tru
-00011780: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
-00011790: 6173 730a 2020 2020 2020 2020 696e 6465  ass.        inde
-000117a0: 7820 3d20 6c65 6e28 6469 6666 5f64 6629  x = len(diff_df)
-000117b0: 0a20 2020 2020 2020 2063 726f 7373 4f76  .        crossOv
-000117c0: 6572 203d 2030 0a20 2020 2020 2020 200a  er = 0.        .
-000117d0: 2020 2020 2020 2020 2320 4c6f 6f70 2075          # Loop u
-000117e0: 6e74 696c 2077 6527 7665 2066 6f75 6e64  ntil we've found
-000117f0: 2074 6865 206e 7468 2063 726f 7373 6f76   the nth crossov
-00011800: 6572 2066 6f72 204d 4143 4420 6f72 2077  er for MACD or w
-00011810: 6527 7665 2072 6561 6368 6564 2074 6865  e've reached the
-00011820: 206c 6173 7420 706f 696e 7420 696e 2074   last point in t
-00011830: 696d 650a 2020 2020 2020 2020 7768 696c  ime.        whil
-00011840: 6520 2863 726f 7373 4f76 6572 203c 206e  e (crossOver < n
-00011850: 7468 4372 6f73 736f 7665 7220 616e 6420  thCrossover and 
-00011860: 696e 6465 7820 3e3d 3029 3a0a 2020 2020  index >=0):.    
-00011870: 2020 2020 2020 2020 6966 2064 6966 665f          if diff_
-00011880: 6466 5b22 6469 6666 225d 5b69 6e64 6578  df["diff"][index
-00011890: 2d31 5d20 3c20 303a 2023 2053 6967 6e61  -1] < 0: # Signa
-000118a0: 6c20 6c69 6e65 2068 6173 206e 6f74 2063  l line has not c
-000118b0: 726f 7373 6564 2079 6574 2061 6e64 2069  rossed yet and i
-000118c0: 7320 6265 6c6f 7720 7468 6520 7a65 726f  s below the zero
-000118d0: 206c 696e 650a 2020 2020 2020 2020 2020   line.          
-000118e0: 2020 2020 2020 7768 696c 6528 2864 6966        while((dif
-000118f0: 665f 6466 5b22 6469 6666 225d 5b69 6e64  f_df["diff"][ind
-00011900: 6578 2d31 5d20 3c20 3020 616e 6420 696e  ex-1] < 0 and in
-00011910: 6465 7820 3e3d 3029 293a 2023 2061 6e64  dex >=0)): # and
-00011920: 2064 6966 665f 6466 2e69 6e64 6578 203c   diff_df.index <
-00011930: 3d20 6272 6f6b 6572 5371 724f 6666 7469  = brokerSqrOffti
-00011940: 6d65 293a 2023 206f 7220 6469 6666 5f64  me): # or diff_d
-00011950: 665b 2272 7369 225d 5b69 6e64 6578 2d31  f["rsi"][index-1
-00011960: 5d20 3c3d 206d 696e 5253 4929 3a0a 2020  ] <= minRSI):.  
-00011970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011980: 2020 2320 4c6f 6f70 2077 6869 6c65 2053    # Loop while S
-00011990: 6967 6e61 6c20 6c69 6e65 2068 6173 206e  ignal line has n
-000119a0: 6f74 2063 726f 7373 6564 2079 6574 2061  ot crossed yet a
-000119b0: 6e64 2069 7320 6265 6c6f 7720 7468 6520  nd is below the 
-000119c0: 7a65 726f 206c 696e 6520 616e 6420 7765  zero line and we
-000119d0: 2776 6520 6e6f 7420 7265 6163 6865 6420  've not reached 
-000119e0: 7468 6520 6c61 7374 2070 6f69 6e74 0a20  the last point. 
-000119f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a00: 2020 2069 6e64 6578 202d 3d20 310a 2020     index -= 1.  
-00011a10: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00011a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a30: 7768 696c 6528 2864 6966 665f 6466 5b22  while((diff_df["
-00011a40: 6469 6666 225d 5b69 6e64 6578 2d31 5d20  diff"][index-1] 
-00011a50: 3e3d 2030 2061 6e64 2069 6e64 6578 203e  >= 0 and index >
-00011a60: 3d30 2929 3a20 2320 616e 6420 6469 6666  =0)): # and diff
-00011a70: 5f64 662e 696e 6465 7820 3c3d 2062 726f  _df.index <= bro
-00011a80: 6b65 7253 7172 4f66 6674 696d 6529 3a20  kerSqrOfftime): 
-00011a90: 2320 6f72 2064 6966 665f 6466 5b22 7273  # or diff_df["rs
-00011aa0: 6922 5d5b 696e 6465 782d 315d 203c 3d20  i"][index-1] <= 
-00011ab0: 6d69 6e52 5349 293a 0a20 2020 2020 2020  minRSI):.       
-00011ac0: 2020 2020 2020 2020 2020 2020 2023 204c               # L
-00011ad0: 6f6f 7020 756e 7469 6c20 7369 676e 616c  oop until signal
-00011ae0: 206c 696e 6520 6861 7320 6e6f 7420 6372   line has not cr
-00011af0: 6f73 7365 6420 7965 7420 616e 6420 6973  ossed yet and is
-00011b00: 2061 626f 7665 2074 6865 207a 6572 6f20   above the zero 
-00011b10: 6c69 6e65 0a20 2020 2020 2020 2020 2020  line.           
-00011b20: 2020 2020 2020 2020 2069 6e64 6578 202d           index -
-00011b30: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00011b40: 6372 6f73 734f 7665 7220 2b3d 2031 0a20  crossOver += 1. 
-00011b50: 2020 2020 2020 2074 7320 3d20 6469 6666         ts = diff
-00011b60: 5f64 662e 7461 696c 286c 656e 2864 6966  _df.tail(len(dif
-00011b70: 665f 6466 292d 696e 6465 7820 2b31 292e  f_df)-index +1).
-00011b80: 6865 6164 2831 292e 696e 6465 785b 2d31  head(1).index[-1
-00011b90: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
-00011ba0: 2074 732c 2064 6174 615b 6461 7461 2e69   ts, data[data.i
-00011bb0: 6e64 6578 203d 3d20 7473 5d20 2364 662e  ndex == ts] #df.
-00011bc0: 6865 6164 286c 656e 2864 6629 202d 696e  head(len(df) -in
-00011bd0: 6465 7820 2b31 292e 7461 696c 2831 290a  dex +1).tail(1).
-00011be0: 2020 2020 0a20 2020 2023 2046 696e 6420      .    # Find 
-00011bf0: 7374 6f63 6b20 7368 6f77 696e 6720 5253  stock showing RS
-00011c00: 4920 6372 6f73 7369 6e67 2077 6974 6820  I crossing with 
-00011c10: 5253 4920 3920 534d 410a 2020 2020 6465  RSI 9 SMA.    de
-00011c20: 6620 6669 6e64 5253 4943 726f 7373 696e  f findRSICrossin
-00011c30: 674d 4128 7365 6c66 2c20 6466 2c20 7363  gMA(self, df, sc
-00011c40: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
-00011c50: 6374 2c6c 6f6f 6b46 6f72 3d31 2c20 6d61  ct,lookFor=1, ma
-00011c60: 4c65 6e67 7468 3d39 2c20 7273 694b 6579  Length=9, rsiKey
-00011c70: 3d22 5253 4922 293a 0a20 2020 2020 2020  ="RSI"):.       
-00011c80: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
-00011c90: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
-00011ca0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00011cb0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-00011cc0: 2069 6620 7273 694b 6579 206e 6f74 2069   if rsiKey not i
-00011cd0: 6e20 6466 2e63 6f6c 756d 6e73 3a0a 2020  n df.columns:.  
-00011ce0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00011cf0: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-00011d00: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
-00011d10: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-00011d20: 6174 615b 3a3a 2d31 5d0a 2020 2020 2020  ata[::-1].      
-00011d30: 2020 6d61 5273 6920 3d20 706b 7461 6c69    maRsi = pktali
-00011d40: 622e 4d41 2864 6174 615b 7273 694b 6579  b.MA(data[rsiKey
-00011d50: 5d2c 2074 696d 6570 6572 696f 643d 6d61  ], timeperiod=ma
-00011d60: 4c65 6e67 7468 290a 2020 2020 2020 2020  Length).        
-00011d70: 6461 7461 203d 2064 6174 615b 3a3a 2d31  data = data[::-1
-00011d80: 5d2e 6865 6164 2833 290a 2020 2020 2020  ].head(3).      
-00011d90: 2020 6d61 5273 6920 3d20 6d61 5273 695b    maRsi = maRsi[
-00011da0: 3a3a 2d31 5d2e 6865 6164 2833 290a 2020  ::-1].head(3).  
-00011db0: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
-00011dc0: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
-00011dd0: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
-00011de0: 6963 742c 7361 7665 4469 6374 2c22 5472  ict,saveDict,"Tr
-00011df0: 656e 6422 290a 2020 2020 2020 2020 6966  end").        if
-00011e00: 206c 6f6f 6b46 6f72 2069 6e20 5b31 2c33   lookFor in [1,3
-00011e10: 5d20 616e 6420 6d61 5273 692e 696c 6f63  ] and maRsi.iloc
-00011e20: 5b30 5d20 3c3d 2064 6174 615b 7273 694b  [0] <= data[rsiK
-00011e30: 6579 5d2e 696c 6f63 5b30 5d20 616e 6420  ey].iloc[0] and 
-00011e40: 6d61 5273 692e 696c 6f63 5b31 5d20 3e20  maRsi.iloc[1] > 
-00011e50: 6461 7461 5b72 7369 4b65 795d 2e69 6c6f  data[rsiKey].ilo
-00011e60: 635b 315d 3a0a 2020 2020 2020 2020 2020  c[1]:.          
-00011e70: 2020 7363 7265 656e 4469 6374 5b27 4d41    screenDict['MA
-00011e80: 2d53 6967 6e61 6c27 5d20 3d20 7361 7665  -Signal'] = save
-00011e90: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
-00011ea0: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
-00011eb0: 742e 4752 4545 4e20 2b20 6627 5253 492d  t.GREEN + f'RSI-
-00011ec0: 4d41 2d42 7579 2720 2b20 636f 6c6f 7254  MA-Buy' + colorT
-00011ed0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-00011ee0: 2020 2020 7361 7665 4469 6374 5b27 4d41      saveDict['MA
-00011ef0: 2d53 6967 6e61 6c27 5d20 3d20 7361 7665  -Signal'] = save
-00011f00: 645b 315d 202b 2066 2752 5349 2d4d 412d  d[1] + f'RSI-MA-
-00011f10: 4275 7927 0a20 2020 2020 2020 2020 2020  Buy'.           
-00011f20: 2072 6574 7572 6e20 5472 7565 2069 6620   return True if 
-00011f30: 2872 7369 4b65 7920 3d3d 2022 5253 4969  (rsiKey == "RSIi
-00011f40: 2229 2065 6c73 6520 2873 656c 662e 6669  ") else (self.fi
-00011f50: 6e64 5253 4943 726f 7373 696e 674d 4128  ndRSICrossingMA(
-00011f60: 6466 2c20 7363 7265 656e 4469 6374 2c20  df, screenDict, 
-00011f70: 7361 7665 4469 6374 2c6c 6f6f 6b46 6f72  saveDict,lookFor
-00011f80: 3d6c 6f6f 6b46 6f72 2c20 6d61 4c65 6e67  =lookFor, maLeng
-00011f90: 7468 3d6d 614c 656e 6774 682c 2072 7369  th=maLength, rsi
-00011fa0: 4b65 793d 2252 5349 6922 2920 6f72 2054  Key="RSIi") or T
-00011fb0: 7275 6529 0a20 2020 2020 2020 2065 6c69  rue).        eli
-00011fc0: 6620 6c6f 6f6b 466f 7220 696e 205b 322c  f lookFor in [2,
-00011fd0: 335d 2061 6e64 206d 6152 7369 2e69 6c6f  3] and maRsi.ilo
-00011fe0: 635b 305d 203e 3d20 6461 7461 5b72 7369  c[0] >= data[rsi
-00011ff0: 4b65 795d 2e69 6c6f 635b 305d 2061 6e64  Key].iloc[0] and
-00012000: 206d 6152 7369 2e69 6c6f 635b 315d 203c   maRsi.iloc[1] <
-00012010: 2064 6174 615b 7273 694b 6579 5d2e 696c   data[rsiKey].il
-00012020: 6f63 5b31 5d3a 0a20 2020 2020 2020 2020  oc[1]:.         
-00012030: 2020 2073 6372 6565 6e44 6963 745b 274d     screenDict['M
-00012040: 412d 5369 676e 616c 275d 203d 2073 6176  A-Signal'] = sav
-00012050: 6564 5b30 5d20 2b20 636f 6c6f 7254 6578  ed[0] + colorTex
-00012060: 742e 424f 4c44 202b 2063 6f6c 6f72 5465  t.BOLD + colorTe
-00012070: 7874 2e46 4149 4c20 2b20 6627 5253 492d  xt.FAIL + f'RSI-
-00012080: 4d41 2d53 656c 6c27 202b 2063 6f6c 6f72  MA-Sell' + color
-00012090: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-000120a0: 2020 2020 2073 6176 6544 6963 745b 274d       saveDict['M
-000120b0: 412d 5369 676e 616c 275d 203d 2073 6176  A-Signal'] = sav
-000120c0: 6564 5b31 5d20 2b20 6627 5253 492d 4d41  ed[1] + f'RSI-MA
-000120d0: 2d53 656c 6c27 0a20 2020 2020 2020 2020  -Sell'.         
-000120e0: 2020 2072 6574 7572 6e20 5472 7565 2069     return True i
-000120f0: 6620 2872 7369 4b65 7920 3d3d 2022 5253  f (rsiKey == "RS
-00012100: 4969 2229 2065 6c73 6520 2873 656c 662e  Ii") else (self.
-00012110: 6669 6e64 5253 4943 726f 7373 696e 674d  findRSICrossingM
-00012120: 4128 6466 2c20 7363 7265 656e 4469 6374  A(df, screenDict
-00012130: 2c20 7361 7665 4469 6374 2c6c 6f6f 6b46  , saveDict,lookF
-00012140: 6f72 3d6c 6f6f 6b46 6f72 2c20 6d61 4c65  or=lookFor, maLe
-00012150: 6e67 7468 3d6d 614c 656e 6774 682c 2072  ngth=maLength, r
-00012160: 7369 4b65 793d 2252 5349 6922 2920 6f72  siKey="RSIi") or
-00012170: 2054 7275 6529 0a20 2020 2020 2020 2072   True).        r
-00012180: 6574 7572 6e20 4661 6c73 6520 6966 2028  eturn False if (
-00012190: 7273 694b 6579 203d 3d20 2252 5349 6922  rsiKey == "RSIi"
-000121a0: 2920 656c 7365 2028 7365 6c66 2e66 696e  ) else (self.fin
-000121b0: 6452 5349 4372 6f73 7369 6e67 4d41 2864  dRSICrossingMA(d
-000121c0: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
-000121d0: 6176 6544 6963 742c 6c6f 6f6b 466f 723d  aveDict,lookFor=
-000121e0: 6c6f 6f6b 466f 722c 206d 614c 656e 6774  lookFor, maLengt
-000121f0: 683d 6d61 4c65 6e67 7468 2c20 7273 694b  h=maLength, rsiK
-00012200: 6579 3d22 5253 4969 2229 290a 2020 2020  ey="RSIi")).    
-00012210: 0a20 2020 2023 2046 696e 6420 7374 6f63  .    # Find stoc
-00012220: 6b73 2077 6974 6820 7269 7369 6e67 2052  ks with rising R
-00012230: 5349 2066 726f 6d20 6c6f 7765 7220 6c65  SI from lower le
-00012240: 7665 6c73 0a20 2020 2064 6566 2066 696e  vels.    def fin
-00012250: 6452 6973 696e 6752 5349 2873 656c 662c  dRisingRSI(self,
-00012260: 2064 662c 2072 7369 4b65 793d 2252 5349   df, rsiKey="RSI
-00012270: 2229 3a0a 2020 2020 2020 2020 6966 2064  "):.        if d
-00012280: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-00012290: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-000122a0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000122b0: 6c73 650a 2020 2020 2020 2020 6966 2072  lse.        if r
-000122c0: 7369 4b65 7920 6e6f 7420 696e 2064 662e  siKey not in df.
-000122d0: 636f 6c75 6d6e 733a 0a20 2020 2020 2020  columns:.       
-000122e0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-000122f0: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
-00012300: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
-00012310: 2020 2064 6174 6120 3d20 6461 7461 5b3a     data = data[:
-00012320: 3a2d 315d 0a20 2020 2020 2020 2064 6174  :-1].        dat
-00012330: 6120 3d20 6461 7461 2e74 6169 6c28 3329  a = data.tail(3)
-00012340: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00012350: 6461 7461 2920 3c20 333a 0a20 2020 2020  data) < 3:.     
-00012360: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00012370: 6c73 650a 2020 2020 2020 2020 6461 794d  lse.        dayM
-00012380: 696e 7573 3252 5349 203d 2064 6174 615b  inus2RSI = data[
-00012390: 2252 5349 225d 2e69 6c6f 635b 305d 0a20  "RSI"].iloc[0]. 
-000123a0: 2020 2020 2020 2064 6179 4d69 6e75 7331         dayMinus1
-000123b0: 5253 4920 3d20 6461 7461 5b22 5253 4922  RSI = data["RSI"
-000123c0: 5d2e 696c 6f63 5b31 5d0a 2020 2020 2020  ].iloc[1].      
-000123d0: 2020 6461 7952 5349 203d 2064 6174 615b    dayRSI = data[
-000123e0: 2252 5349 225d 2e69 6c6f 635b 325d 0a20  "RSI"].iloc[2]. 
-000123f0: 2020 2020 2020 2072 6574 7572 6e56 616c         returnVal
-00012400: 7565 203d 2028 6461 794d 696e 7573 3252  ue = (dayMinus2R
-00012410: 5349 203c 3d20 3335 2061 6e64 2064 6179  SI <= 35 and day
-00012420: 4d69 6e75 7331 5253 4920 3e20 6461 794d  Minus1RSI > dayM
-00012430: 696e 7573 3252 5349 2061 6e64 2064 6179  inus2RSI and day
-00012440: 5253 4920 3e20 6461 794d 696e 7573 3152  RSI > dayMinus1R
-00012450: 5349 2920 6f72 205c 0a20 2020 2020 2020  SI) or \.       
-00012460: 2020 2020 2020 2020 2028 6461 794d 696e           (dayMin
-00012470: 7573 3152 5349 203c 3d20 3335 2061 6e64  us1RSI <= 35 and
-00012480: 2064 6179 5253 4920 3e20 6461 794d 696e   dayRSI > dayMin
-00012490: 7573 3152 5349 290a 2020 2020 2020 2020  us1RSI).        
-000124a0: 6966 2072 7369 4b65 7920 3d3d 2022 5253  if rsiKey == "RS
-000124b0: 4922 3a0a 2020 2020 2020 2020 2020 2020  I":.            
-000124c0: 7265 7475 726e 5661 6c75 6520 3d20 7365  returnValue = se
-000124d0: 6c66 2e66 696e 6452 6973 696e 6752 5349  lf.findRisingRSI
-000124e0: 2864 662c 2072 7369 4b65 793d 2252 5349  (df, rsiKey="RSI
-000124f0: 6922 2920 6f72 2072 6574 7572 6e56 616c  i") or returnVal
-00012500: 7565 0a20 2020 2020 2020 2072 6574 7572  ue.        retur
-00012510: 6e20 7265 7475 726e 5661 6c75 650a 0a20  n returnValue.. 
-00012520: 2020 2023 406d 6561 7375 7265 5f74 696d     #@measure_tim
-00012530: 650a 2020 2020 2320 4669 6e64 206f 7574  e.    # Find out
-00012540: 2074 7265 6e64 2066 6f72 2064 6179 7320   trend for days 
-00012550: 746f 206c 6f6f 6b62 6163 6b0a 2020 2020  to lookback.    
-00012560: 6465 6620 6669 6e64 5472 656e 6428 7365  def findTrend(se
-00012570: 6c66 2c20 6466 2c20 7363 7265 656e 4469  lf, df, screenDi
-00012580: 6374 2c20 7361 7665 4469 6374 2c20 6461  ct, saveDict, da
-00012590: 7973 546f 4c6f 6f6b 6261 636b 3d4e 6f6e  ysToLookback=Non
-000125a0: 652c 2073 746f 636b 4e61 6d65 3d22 2229  e, stockName="")
-000125b0: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
-000125c0: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
-000125d0: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
-000125e0: 2020 2020 2072 6574 7572 6e20 2255 6e6b       return "Unk
-000125f0: 6e6f 776e 220a 2020 2020 2020 2020 6461  nown".        da
-00012600: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
-00012610: 2020 2020 2020 2069 6620 6461 7973 546f         if daysTo
-00012620: 4c6f 6f6b 6261 636b 2069 7320 4e6f 6e65  Lookback is None
-00012630: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
-00012640: 7973 546f 4c6f 6f6b 6261 636b 203d 2073  ysToLookback = s
-00012650: 656c 662e 636f 6e66 6967 4d61 6e61 6765  elf.configManage
-00012660: 722e 6461 7973 546f 4c6f 6f6b 6261 636b  r.daysToLookback
-00012670: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00012680: 6461 7461 2e68 6561 6428 6461 7973 546f  data.head(daysTo
-00012690: 4c6f 6f6b 6261 636b 290a 2020 2020 2020  Lookback).      
-000126a0: 2020 6461 7461 203d 2064 6174 615b 3a3a    data = data[::
-000126b0: 2d31 5d0a 2020 2020 2020 2020 6461 7461  -1].        data
-000126c0: 203d 2064 6174 612e 7365 745f 696e 6465   = data.set_inde
-000126d0: 7828 6e70 2e61 7261 6e67 6528 6c65 6e28  x(np.arange(len(
-000126e0: 6461 7461 2929 290a 2020 2020 2020 2020  data))).        
-000126f0: 6461 7461 203d 2064 6174 612e 6669 6c6c  data = data.fill
-00012700: 6e61 2830 290a 2020 2020 2020 2020 6461  na(0).        da
-00012710: 7461 203d 2064 6174 612e 7265 706c 6163  ta = data.replac
-00012720: 6528 5b6e 702e 696e 662c 202d 6e70 2e69  e([np.inf, -np.i
-00012730: 6e66 5d2c 2030 290a 2020 2020 2020 2020  nf], 0).        
-00012740: 7361 7665 6420 3d20 7365 6c66 2e66 696e  saved = self.fin
-00012750: 6443 7572 7265 6e74 5361 7665 6456 616c  dCurrentSavedVal
-00012760: 7565 2873 6372 6565 6e44 6963 742c 7361  ue(screenDict,sa
-00012770: 7665 4469 6374 2c22 5472 656e 6422 290a  veDict,"Trend").
-00012780: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00012790: 2020 2020 2020 2020 2077 6974 6820 5375           with Su
-000127a0: 7070 7265 7373 4f75 7470 7574 2873 7570  ppressOutput(sup
-000127b0: 7072 6573 735f 7374 646f 7574 3d54 7275  press_stdout=Tru
-000127c0: 652c 2073 7570 7072 6573 735f 7374 6465  e, suppress_stde
-000127d0: 7272 3d54 7275 6529 3a0a 2020 2020 2020  rr=True):.      
-000127e0: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
-000127f0: 746f 7073 225d 203d 2064 6174 615b 2243  tops"] = data["C
-00012800: 6c6f 7365 225d 2e69 6c6f 635b 0a20 2020  lose"].iloc[.   
-00012810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012820: 206c 6973 7428 0a20 2020 2020 2020 2020   list(.         
-00012830: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00012840: 6b74 616c 6962 2e61 7267 7265 6c65 7874  ktalib.argrelext
-00012850: 7265 6d61 280a 2020 2020 2020 2020 2020  rema(.          
-00012860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012870: 2020 6e70 2e61 7272 6179 2864 6174 615b    np.array(data[
-00012880: 2243 6c6f 7365 225d 292c 206e 702e 6772  "Close"]), np.gr
-00012890: 6561 7465 725f 6571 7561 6c2c 206f 7264  eater_equal, ord
-000128a0: 6572 3d31 0a20 2020 2020 2020 2020 2020  er=1.           
-000128b0: 2020 2020 2020 2020 2020 2020 2029 5b30               )[0
-000128c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000128d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000128e0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-000128f0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-00012900: 612e 6669 6c6c 6e61 2830 290a 2020 2020  a.fillna(0).    
-00012910: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-00012920: 6174 612e 7265 706c 6163 6528 5b6e 702e  ata.replace([np.
-00012930: 696e 662c 202d 6e70 2e69 6e66 5d2c 2030  inf, -np.inf], 0
-00012940: 290a 0a20 2020 2020 2020 2020 2020 2074  )..            t
-00012950: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00012960: 2020 2020 2320 6966 206c 656e 2864 6174      # if len(dat
-00012970: 6129 203c 2064 6179 7354 6f4c 6f6f 6b62  a) < daysToLookb
-00012980: 6163 6b3a 0a20 2020 2020 2020 2020 2020  ack:.           
-00012990: 2020 2020 2023 2020 2020 2073 656c 662e       #     self.
-000129a0: 6465 6661 756c 745f 6c6f 6767 6572 2e64  default_logger.d
-000129b0: 6562 7567 2864 6174 6129 0a20 2020 2020  ebug(data).     
-000129c0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-000129d0: 2072 6169 7365 2053 746f 636b 4461 7461   raise StockData
-000129e0: 4e6f 7441 6465 7175 6174 650a 2020 2020  NotAdequate.    
-000129f0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00012a00: 203d 2064 6174 612e 7265 706c 6163 6528   = data.replace(
-00012a10: 6e70 2e69 6e66 2c20 6e70 2e6e 616e 292e  np.inf, np.nan).
-00012a20: 7265 706c 6163 6528 2d6e 702e 696e 662c  replace(-np.inf,
-00012a30: 206e 702e 6e61 6e29 2e64 726f 706e 6128   np.nan).dropna(
-00012a40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012a50: 2020 6966 206c 656e 2864 6174 615b 2274    if len(data["t
-00012a60: 6f70 7322 5d5b 6461 7461 2e74 6f70 7320  ops"][data.tops 
-00012a70: 3e20 305d 2920 3e20 313a 0a20 2020 2020  > 0]) > 1:.     
-00012a80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012a90: 6c6f 7065 203d 206e 702e 706f 6c79 6669  lope = np.polyfi
-00012aa0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00012ab0: 2020 2020 2020 2020 2020 2064 6174 612e             data.
-00012ac0: 696e 6465 785b 6461 7461 2e74 6f70 7320  index[data.tops 
-00012ad0: 3e20 305d 2c20 6461 7461 5b22 746f 7073  > 0], data["tops
-00012ae0: 225d 5b64 6174 612e 746f 7073 203e 2030  "][data.tops > 0
-00012af0: 5d2c 2031 0a20 2020 2020 2020 2020 2020  ], 1.           
-00012b00: 2020 2020 2020 2020 2029 5b30 5d0a 2020           )[0].  
-00012b10: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00012b20: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00012b30: 2020 2020 2020 2020 736c 6f70 6520 3d20          slope = 
-00012b40: 300a 2020 2020 2020 2020 2020 2020 6578  0.            ex
-00012b50: 6365 7074 206e 702e 6c69 6e61 6c67 2e4c  cept np.linalg.L
-00012b60: 696e 416c 6745 7272 6f72 2061 7320 653a  inAlgError as e:
-00012b70: 2023 2070 7261 676d 613a 206e 6f20 636f   # pragma: no co
-00012b80: 7665 720a 2020 2020 2020 2020 2020 2020  ver.            
-00012b90: 2020 2020 7365 6c66 2e64 6566 6175 6c74      self.default
-00012ba0: 5f6c 6f67 6765 722e 6465 6275 6728 652c  _logger.debug(e,
-00012bb0: 2065 7863 5f69 6e66 6f3d 5472 7565 290a   exc_info=True).
-00012bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012bd0: 7363 7265 656e 4469 6374 5b22 5472 656e  screenDict["Tren
-00012be0: 6422 5d20 3d20 280a 2020 2020 2020 2020  d"] = (.        
-00012bf0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00012c00: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
-00012c10: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
-00012c20: 742e 5741 524e 202b 2022 556e 6b6e 6f77  t.WARN + "Unknow
-00012c30: 6e22 202b 2063 6f6c 6f72 5465 7874 2e45  n" + colorText.E
-00012c40: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
-00012c50: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00012c60: 2020 2020 2073 6176 6544 6963 745b 2254       saveDict["T
-00012c70: 7265 6e64 225d 203d 2073 6176 6564 5b31  rend"] = saved[1
-00012c80: 5d20 2b20 2255 6e6b 6e6f 776e 220a 2020  ] + "Unknown".  
-00012c90: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00012ca0: 7475 726e 2073 6176 6544 6963 745b 2254  turn saveDict["T
-00012cb0: 7265 6e64 225d 0a20 2020 2020 2020 2020  rend"].         
-00012cc0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00012cd0: 696f 6e20 6173 2065 3a20 2023 2070 7261  ion as e:  # pra
-00012ce0: 676d 613a 206e 6f20 636f 7665 720a 2020  gma: no cover.  
-00012cf0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00012d00: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
-00012d10: 722e 6465 6275 6728 652c 2065 7863 5f69  r.debug(e, exc_i
-00012d20: 6e66 6f3d 5472 7565 290a 2020 2020 2020  nfo=True).      
-00012d30: 2020 2020 2020 2020 2020 736c 6f70 652c            slope,
-00012d40: 205f 203d 2030 2c20 300a 2020 2020 2020   _ = 0, 0.      
-00012d50: 2020 2020 2020 616e 676c 6520 3d20 6e70        angle = np
-00012d60: 2e72 6164 3264 6567 286e 702e 6172 6374  .rad2deg(np.arct
-00012d70: 616e 2873 6c6f 7065 2929 0a20 2020 2020  an(slope)).     
-00012d80: 2020 2020 2020 2069 6620 616e 676c 6520         if angle 
-00012d90: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00012da0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-00012db0: 5b22 5472 656e 6422 5d20 3d20 280a 2020  ["Trend"] = (.  
-00012dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012dd0: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
-00012de0: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-00012df0: 6c6f 7254 6578 742e 5741 524e 202b 2022  lorText.WARN + "
-00012e00: 556e 6b6e 6f77 6e22 202b 2063 6f6c 6f72  Unknown" + color
-00012e10: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-00012e20: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00012e30: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00012e40: 6963 745b 2254 7265 6e64 225d 203d 2073  ict["Trend"] = s
-00012e50: 6176 6564 5b31 5d20 2b20 2255 6e6b 6e6f  aved[1] + "Unkno
-00012e60: 776e 220a 2020 2020 2020 2020 2020 2020  wn".            
-00012e70: 656c 6966 2061 6e67 6c65 203c 3d20 3330  elif angle <= 30
-00012e80: 2061 6e64 2061 6e67 6c65 203e 3d20 2d33   and angle >= -3
-00012e90: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00012ea0: 2020 2073 6372 6565 6e44 6963 745b 2254     screenDict["T
-00012eb0: 7265 6e64 225d 203d 2028 0a20 2020 2020  rend"] = (.     
-00012ec0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012ed0: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
-00012ee0: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
-00012ef0: 5465 7874 2e57 4152 4e20 2b20 2253 6964  Text.WARN + "Sid
-00012f00: 6577 6179 7322 202b 2063 6f6c 6f72 5465  eways" + colorTe
-00012f10: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-00012f20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00012f30: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-00012f40: 745b 2254 7265 6e64 225d 203d 2073 6176  t["Trend"] = sav
-00012f50: 6564 5b31 5d20 2b20 2253 6964 6577 6179  ed[1] + "Sideway
-00012f60: 7322 0a20 2020 2020 2020 2020 2020 2065  s".            e
-00012f70: 6c69 6620 616e 676c 6520 3e3d 2033 3020  lif angle >= 30 
-00012f80: 616e 6420 616e 676c 6520 3c20 3631 3a0a  and angle < 61:.
-00012f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fa0: 7363 7265 656e 4469 6374 5b22 5472 656e  screenDict["Tren
-00012fb0: 6422 5d20 3d20 280a 2020 2020 2020 2020  d"] = (.        
-00012fc0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00012fd0: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
-00012fe0: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
-00012ff0: 742e 4752 4545 4e20 2b20 2257 6561 6b20  t.GREEN + "Weak 
-00013000: 5570 2220 2b20 636f 6c6f 7254 6578 742e  Up" + colorText.
-00013010: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-00013020: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00013030: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
-00013040: 5472 656e 6422 5d20 3d20 7361 7665 645b  Trend"] = saved[
-00013050: 315d 202b 2022 5765 616b 2055 7022 0a20  1] + "Weak Up". 
-00013060: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00013070: 616e 676c 6520 3e3d 2036 303a 0a20 2020  angle >= 60:.   
-00013080: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-00013090: 6565 6e44 6963 745b 2254 7265 6e64 225d  eenDict["Trend"]
-000130a0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-000130b0: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
-000130c0: 5d20 2b20 636f 6c6f 7254 6578 742e 424f  ] + colorText.BO
-000130d0: 4c44 202b 2063 6f6c 6f72 5465 7874 2e47  LD + colorText.G
-000130e0: 5245 454e 202b 2022 5374 726f 6e67 2055  REEN + "Strong U
-000130f0: 7022 202b 2063 6f6c 6f72 5465 7874 2e45  p" + colorText.E
-00013100: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
-00013110: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00013120: 2020 2020 2073 6176 6544 6963 745b 2254       saveDict["T
-00013130: 7265 6e64 225d 203d 2073 6176 6564 5b31  rend"] = saved[1
-00013140: 5d20 2b20 2253 7472 6f6e 6720 5570 220a  ] + "Strong Up".
-00013150: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00013160: 2061 6e67 6c65 203c 3d20 2d33 3020 616e   angle <= -30 an
-00013170: 6420 616e 676c 6520 3e20 2d36 313a 0a20  d angle > -61:. 
-00013180: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013190: 6372 6565 6e44 6963 745b 2254 7265 6e64  creenDict["Trend
-000131a0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-000131b0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-000131c0: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-000131d0: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
-000131e0: 2e46 4149 4c20 2b20 2257 6561 6b20 446f  .FAIL + "Weak Do
-000131f0: 776e 2220 2b20 636f 6c6f 7254 6578 742e  wn" + colorText.
-00013200: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-00013210: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00013220: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
-00013230: 5472 656e 6422 5d20 3d20 7361 7665 645b  Trend"] = saved[
-00013240: 315d 202b 2022 5765 616b 2044 6f77 6e22  1] + "Weak Down"
-00013250: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00013260: 6620 616e 676c 6520 3c20 2d36 303a 0a20  f angle < -60:. 
-00013270: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013280: 6372 6565 6e44 6963 745b 2254 7265 6e64  creenDict["Trend
-00013290: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-000132a0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-000132b0: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-000132c0: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
-000132d0: 2e46 4149 4c20 2b20 2253 7472 6f6e 6720  .FAIL + "Strong 
-000132e0: 446f 776e 2220 2b20 636f 6c6f 7254 6578  Down" + colorTex
-000132f0: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
-00013300: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00013310: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
-00013320: 5b22 5472 656e 6422 5d20 3d20 7361 7665  ["Trend"] = save
-00013330: 645b 315d 202b 2022 5374 726f 6e67 2044  d[1] + "Strong D
-00013340: 6f77 6e22 0a20 2020 2020 2020 2065 7863  own".        exc
-00013350: 6570 7420 6e70 2e6c 696e 616c 672e 4c69  ept np.linalg.Li
-00013360: 6e41 6c67 4572 726f 7220 6173 2065 3a20  nAlgError as e: 
-00013370: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
-00013380: 6572 0a20 2020 2020 2020 2020 2020 2073  er.            s
-00013390: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
-000133a0: 6572 2e64 6562 7567 2865 2c20 6578 635f  er.debug(e, exc_
-000133b0: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
-000133c0: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
-000133d0: 745b 2254 7265 6e64 225d 203d 2028 0a20  t["Trend"] = (. 
-000133e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000133f0: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
-00013400: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
-00013410: 5465 7874 2e57 4152 4e20 2b20 2255 6e6b  Text.WARN + "Unk
-00013420: 6e6f 776e 2220 2b20 636f 6c6f 7254 6578  nown" + colorTex
-00013430: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
-00013440: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00013450: 7361 7665 4469 6374 5b22 5472 656e 6422  saveDict["Trend"
-00013460: 5d20 3d20 7361 7665 645b 315d 202b 2022  ] = saved[1] + "
-00013470: 556e 6b6e 6f77 6e22 0a20 2020 2020 2020  Unknown".       
-00013480: 2072 6574 7572 6e20 7361 7665 4469 6374   return saveDict
-00013490: 5b22 5472 656e 6422 5d0a 0a20 2020 2023  ["Trend"]..    #
-000134a0: 2046 696e 6420 7374 6f63 6b73 2061 7070   Find stocks app
-000134b0: 726f 6368 696e 6720 746f 206c 6f6e 6720  roching to long 
-000134c0: 7465 726d 2074 7265 6e64 6c69 6e65 730a  term trendlines.
-000134d0: 2020 2020 6465 6620 6669 6e64 5472 656e      def findTren
-000134e0: 646c 696e 6573 2873 656c 662c 2064 662c  dlines(self, df,
-000134f0: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
-00013500: 6544 6963 742c 2070 6572 6365 6e74 6167  eDict, percentag
-00013510: 653d 302e 3035 293a 0a20 2020 2020 2020  e=0.05):.       
-00013520: 2023 2070 6572 696f 6420 3d20 696e 7428   # period = int(
-00013530: 2222 2e6a 6f69 6e28 6320 666f 7220 6320  "".join(c for c 
-00013540: 696e 2073 656c 662e 636f 6e66 6967 4d61  in self.configMa
-00013550: 6e61 6765 722e 7065 7269 6f64 2069 6620  nager.period if 
-00013560: 632e 6973 6469 6769 7428 2929 290a 2020  c.isdigit())).  
-00013570: 2020 2020 2020 2320 6966 206c 656e 2864        # if len(d
-00013580: 6174 6129 203c 2070 6572 696f 643a 0a20  ata) < period:. 
-00013590: 2020 2020 2020 2023 2020 2020 2072 6574         #     ret
-000135a0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-000135b0: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-000135c0: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
-000135d0: 3d20 6461 7461 5b3a 3a2d 315d 0a20 2020  = data[::-1].   
-000135e0: 2020 2020 2064 6174 615b 224e 756d 6265       data["Numbe
-000135f0: 7222 5d20 3d20 6e70 2e61 7261 6e67 6528  r"] = np.arange(
-00013600: 6c65 6e28 6461 7461 2929 202b 2031 0a20  len(data)) + 1. 
-00013610: 2020 2020 2020 2064 6174 615f 6c6f 7720         data_low 
-00013620: 3d20 6461 7461 2e63 6f70 7928 290a 2020  = data.copy().  
-00013630: 2020 2020 2020 706f 696e 7473 203d 2033        points = 3
-00013640: 300a 0a20 2020 2020 2020 2022 2222 2049  0..        """ I
-00013650: 676e 6f72 696e 6720 7468 6520 5265 7369  gnoring the Resi
-00013660: 7461 6e63 6520 666f 7220 6c6f 6e67 2d74  tance for long-t
-00013670: 6572 6d20 7075 7270 6f73 650a 2020 2020  erm purpose.    
-00013680: 2020 2020 7768 696c 6520 6c65 6e28 6461      while len(da
-00013690: 7461 5f68 6967 6829 203e 2070 6f69 6e74  ta_high) > point
-000136a0: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-000136b0: 6c6f 7065 2c20 696e 7465 7263 6570 742c  lope, intercept,
-000136c0: 2072 5f76 616c 7565 2c20 705f 7661 6c75   r_value, p_valu
-000136d0: 652c 2073 7464 5f65 7272 203d 206c 696e  e, std_err = lin
-000136e0: 7265 6772 6573 7328 783d 6461 7461 5f68  regress(x=data_h
-000136f0: 6967 685b 274e 756d 6265 7227 5d2c 2079  igh['Number'], y
-00013700: 3d64 6174 615f 6869 6768 5b27 4869 6768  =data_high['High
-00013710: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-00013720: 6461 7461 5f68 6967 6820 3d20 6461 7461  data_high = data
-00013730: 5f68 6967 682e 6c6f 635b 6461 7461 5f68  _high.loc[data_h
-00013740: 6967 685b 2748 6967 6827 5d20 3e20 736c  igh['High'] > sl
-00013750: 6f70 6520 2a20 6461 7461 5f68 6967 685b  ope * data_high[
-00013760: 274e 756d 6265 7227 5d20 2b20 696e 7465  'Number'] + inte
-00013770: 7263 6570 745d 0a20 2020 2020 2020 2073  rcept].        s
-00013780: 6c6f 7065 2c20 696e 7465 7263 6570 742c  lope, intercept,
-00013790: 2072 5f76 616c 7565 2c20 705f 7661 6c75   r_value, p_valu
-000137a0: 652c 2073 7464 5f65 7272 203d 206c 696e  e, std_err = lin
-000137b0: 7265 6772 6573 7328 783d 6461 7461 5f68  regress(x=data_h
-000137c0: 6967 685b 274e 756d 6265 7227 5d2c 2079  igh['Number'], y
-000137d0: 3d64 6174 615f 6869 6768 5b27 436c 6f73  =data_high['Clos
-000137e0: 6527 5d29 0a20 2020 2020 2020 2064 6174  e']).        dat
-000137f0: 615b 2752 6573 6973 7461 6e63 6527 5d20  a['Resistance'] 
-00013800: 3d20 736c 6f70 6520 2a20 6461 7461 5b27  = slope * data['
-00013810: 4e75 6d62 6572 275d 202b 2069 6e74 6572  Number'] + inter
-00013820: 6365 7074 0a20 2020 2020 2020 2022 2222  cept.        """
-00013830: 0a0a 2020 2020 2020 2020 7768 696c 6520  ..        while 
-00013840: 6c65 6e28 6461 7461 5f6c 6f77 2920 3e20  len(data_low) > 
-00013850: 706f 696e 7473 3a0a 2020 2020 2020 2020  points:.        
-00013860: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00013870: 2020 2020 2020 2020 2073 6c6f 7065 2c20           slope, 
-00013880: 696e 7465 7263 6570 742c 2072 5f76 616c  intercept, r_val
-00013890: 7565 2c20 705f 7661 6c75 652c 2073 7464  ue, p_value, std
-000138a0: 5f65 7272 203d 206c 696e 7265 6772 6573  _err = linregres
-000138b0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-000138c0: 2020 2020 2020 2078 3d64 6174 615f 6c6f         x=data_lo
-000138d0: 775b 224e 756d 6265 7222 5d2c 2079 3d64  w["Number"], y=d
-000138e0: 6174 615f 6c6f 775b 224c 6f77 225d 0a20  ata_low["Low"]. 
-000138f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00013900: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00013910: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-00013920: 2065 3a20 2023 2070 7261 676d 613a 206e   e:  # pragma: n
-00013930: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
-00013940: 2020 2020 2020 2020 7365 6c66 2e64 6566          self.def
-00013950: 6175 6c74 5f6c 6f67 6765 722e 6465 6275  ault_logger.debu
-00013960: 6728 652c 2065 7863 5f69 6e66 6f3d 5472  g(e, exc_info=Tr
-00013970: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00013980: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-00013990: 2020 2020 2020 2020 2064 6174 615f 6c6f           data_lo
-000139a0: 7720 3d20 6461 7461 5f6c 6f77 2e6c 6f63  w = data_low.loc
-000139b0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-000139c0: 2020 6461 7461 5f6c 6f77 5b22 4c6f 7722    data_low["Low"
-000139d0: 5d20 3c20 736c 6f70 6520 2a20 6461 7461  ] < slope * data
-000139e0: 5f6c 6f77 5b22 4e75 6d62 6572 225d 202b  _low["Number"] +
-000139f0: 2069 6e74 6572 6365 7074 0a20 2020 2020   intercept.     
-00013a00: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
-00013a10: 2020 736c 6f70 652c 2069 6e74 6572 6365    slope, interce
-00013a20: 7074 2c20 725f 7661 6c75 652c 2070 5f76  pt, r_value, p_v
-00013a30: 616c 7565 2c20 7374 645f 6572 7220 3d20  alue, std_err = 
-00013a40: 6c69 6e72 6567 7265 7373 280a 2020 2020  linregress(.    
-00013a50: 2020 2020 2020 2020 783d 6461 7461 5f6c          x=data_l
-00013a60: 6f77 5b22 4e75 6d62 6572 225d 2c20 793d  ow["Number"], y=
-00013a70: 6461 7461 5f6c 6f77 5b22 436c 6f73 6522  data_low["Close"
-00013a80: 5d0a 2020 2020 2020 2020 290a 2020 2020  ].        ).    
-00013a90: 2020 2020 6461 7461 5b22 5375 7070 6f72      data["Suppor
-00013aa0: 7422 5d20 3d20 736c 6f70 6520 2a20 6461  t"] = slope * da
-00013ab0: 7461 5b22 4e75 6d62 6572 225d 202b 2069  ta["Number"] + i
-00013ac0: 6e74 6572 6365 7074 0a20 2020 2020 2020  ntercept.       
-00013ad0: 206e 6f77 203d 2064 6174 612e 7461 696c   now = data.tail
-00013ae0: 2831 290a 0a20 2020 2020 2020 206c 696d  (1)..        lim
-00013af0: 6974 5f75 7070 6572 203d 206e 6f77 5b22  it_upper = now["
-00013b00: 5375 7070 6f72 7422 5d2e 696c 6f63 5b30  Support"].iloc[0
-00013b10: 5d20 2b20 286e 6f77 5b22 5375 7070 6f72  ] + (now["Suppor
-00013b20: 7422 5d2e 696c 6f63 5b30 5d20 2a20 7065  t"].iloc[0] * pe
-00013b30: 7263 656e 7461 6765 290a 2020 2020 2020  rcentage).      
-00013b40: 2020 6c69 6d69 745f 6c6f 7765 7220 3d20    limit_lower = 
-00013b50: 6e6f 775b 2253 7570 706f 7274 225d 2e69  now["Support"].i
-00013b60: 6c6f 635b 305d 202d 2028 6e6f 775b 2253  loc[0] - (now["S
-00013b70: 7570 706f 7274 225d 2e69 6c6f 635b 305d  upport"].iloc[0]
-00013b80: 202a 2070 6572 6365 6e74 6167 6529 0a20   * percentage). 
-00013b90: 2020 2020 2020 2073 6176 6564 203d 2073         saved = s
-00013ba0: 656c 662e 6669 6e64 4375 7272 656e 7453  elf.findCurrentS
-00013bb0: 6176 6564 5661 6c75 6528 7363 7265 656e  avedValue(screen
-00013bc0: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
-00013bd0: 2250 6174 7465 726e 2229 0a20 2020 2020  "Pattern").     
-00013be0: 2020 2069 6620 6c69 6d69 745f 6c6f 7765     if limit_lowe
-00013bf0: 7220 3c20 6e6f 775b 2243 6c6f 7365 225d  r < now["Close"]
-00013c00: 2e69 6c6f 635b 305d 203c 206c 696d 6974  .iloc[0] < limit
-00013c10: 5f75 7070 6572 2061 6e64 2073 6c6f 7065  _upper and slope
-00013c20: 203e 2030 2e31 353a 0a20 2020 2020 2020   > 0.15:.       
-00013c30: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-00013c40: 2250 6174 7465 726e 225d 203d 2028 0a20  "Pattern"] = (. 
-00013c50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013c60: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
-00013c70: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
-00013c80: 5465 7874 2e47 5245 454e 202b 2022 5472  Text.GREEN + "Tr
-00013c90: 656e 646c 696e 652d 5375 7070 6f72 7422  endline-Support"
-00013ca0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-00013cb0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00013cc0: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00013cd0: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
-00013ce0: 2073 6176 6564 5b31 5d20 2b20 2254 7265   saved[1] + "Tre
-00013cf0: 6e64 6c69 6e65 2d53 7570 706f 7274 220a  ndline-Support".
-00013d00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00013d10: 726e 2054 7275 650a 0a20 2020 2020 2020  rn True..       
-00013d20: 2022 2222 2050 6c6f 7473 2066 6f72 2064   """ Plots for d
-00013d30: 6562 7567 6769 6e67 0a20 2020 2020 2020  ebugging.       
-00013d40: 2069 6d70 6f72 7420 6d61 7470 6c6f 746c   import matplotl
-00013d50: 6962 2e70 7970 6c6f 7420 6173 2070 6c74  ib.pyplot as plt
-00013d60: 0a20 2020 2020 2020 2066 6967 2c20 6178  .        fig, ax
-00013d70: 3120 3d20 706c 742e 7375 6270 6c6f 7473  1 = plt.subplots
-00013d80: 2866 6967 7369 7a65 3d28 3135 2c31 3029  (figsize=(15,10)
-00013d90: 290a 2020 2020 2020 2020 636f 6c6f 7220  ).        color 
-00013da0: 3d20 2774 6162 3a67 7265 656e 270a 2020  = 'tab:green'.  
-00013db0: 2020 2020 2020 7864 6174 6520 3d20 5b78        xdate = [x
-00013dc0: 2e64 6174 6528 2920 666f 7220 7820 696e  .date() for x in
-00013dd0: 2064 6174 612e 696e 6465 785d 0a20 2020   data.index].   
-00013de0: 2020 2020 2061 7831 2e73 6574 5f78 6c61       ax1.set_xla
-00013df0: 6265 6c28 2744 6174 6527 2c20 636f 6c6f  bel('Date', colo
-00013e00: 723d 636f 6c6f 7229 0a20 2020 2020 2020  r=color).       
-00013e10: 2061 7831 2e70 6c6f 7428 7864 6174 652c   ax1.plot(xdate,
-00013e20: 2064 6174 612e 436c 6f73 652c 206c 6162   data.Close, lab
-00013e30: 656c 3d22 636c 6f73 6522 2c20 636f 6c6f  el="close", colo
-00013e40: 723d 636f 6c6f 7229 0a20 2020 2020 2020  r=color).       
-00013e50: 2061 7831 2e74 6963 6b5f 7061 7261 6d73   ax1.tick_params
-00013e60: 2861 7869 733d 2778 272c 206c 6162 656c  (axis='x', label
-00013e70: 636f 6c6f 723d 636f 6c6f 7229 0a0a 2020  color=color)..  
-00013e80: 2020 2020 2020 6178 3220 3d20 6178 312e        ax2 = ax1.
-00013e90: 7477 696e 7928 2920 2320 6178 3220 616e  twiny() # ax2 an
-00013ea0: 6420 6178 3120 7769 6c6c 2068 6176 6520  d ax1 will have 
-00013eb0: 636f 6d6d 6f6e 2079 2061 7869 7320 616e  common y axis an
-00013ec0: 6420 6469 6666 6572 656e 7420 7820 6178  d different x ax
-00013ed0: 6973 2c20 7477 696e 790a 2020 2020 2020  is, twiny.      
-00013ee0: 2020 6178 322e 706c 6f74 2864 6174 612e    ax2.plot(data.
-00013ef0: 4e75 6d62 6572 2c20 6461 7461 2e52 6573  Number, data.Res
-00013f00: 6973 7461 6e63 652c 206c 6162 656c 3d22  istance, label="
-00013f10: 5265 7322 290a 2020 2020 2020 2020 6178  Res").        ax
-00013f20: 322e 706c 6f74 2864 6174 612e 4e75 6d62  2.plot(data.Numb
-00013f30: 6572 2c20 6461 7461 2e53 7570 706f 7274  er, data.Support
-00013f40: 2c20 6c61 6265 6c3d 2253 7570 2229 0a0a  , label="Sup")..
-00013f50: 2020 2020 2020 2020 706c 742e 6c65 6765          plt.lege
-00013f60: 6e64 2829 0a20 2020 2020 2020 2070 6c74  nd().        plt
-00013f70: 2e67 7269 6428 290a 2020 2020 2020 2020  .grid().        
-00013f80: 706c 742e 7368 6f77 2829 0a20 2020 2020  plt.show().     
-00013f90: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00013fa0: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
-00013fb0: 2023 2040 6d65 6173 7572 655f 7469 6d65   # @measure_time
-00013fc0: 0a20 2020 2064 6566 2066 696e 6455 7074  .    def findUpt
-00013fd0: 7265 6e64 2873 656c 662c 2064 662c 2073  rend(self, df, s
-00013fe0: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
-00013ff0: 6963 742c 2074 6573 7469 6e67 2c20 7374  ict, testing, st
-00014000: 6f63 6b2c 6f6e 6c79 4d46 3d46 616c 7365  ock,onlyMF=False
-00014010: 2c68 6f73 7444 6174 613d 4e6f 6e65 2c65  ,hostData=None,e
-00014020: 7863 6861 6e67 654e 616d 653d 2249 4e44  xchangeName="IND
-00014030: 4941 222c 7265 6672 6573 684d 4641 6e64  IA",refreshMFAnd
-00014040: 4656 3d54 7275 6529 3a0a 2020 2020 2020  FV=True):.      
-00014050: 2020 2320 7368 6f75 6c64 5072 6f63 6565    # shouldProcee
-00014060: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-00014070: 2069 7355 7074 7265 6e64 203d 2046 616c   isUptrend = Fal
-00014080: 7365 0a20 2020 2020 2020 2069 7344 6f77  se.        isDow
-00014090: 6e74 7265 6e64 203d 2046 616c 7365 0a20  ntrend = False. 
-000140a0: 2020 2020 2020 2069 7335 3044 4d41 5570         is50DMAUp
-000140b0: 7472 656e 6420 3d20 4661 6c73 650a 2020  trend = False.  
-000140c0: 2020 2020 2020 6973 3530 444d 4144 6f77        is50DMADow
-000140d0: 6e74 7265 6e64 203d 2046 616c 7365 0a20  ntrend = False. 
-000140e0: 2020 2020 2020 2064 6563 6973 696f 6e20         decision 
-000140f0: 3d20 2222 0a20 2020 2020 2020 2064 6d61  = "".        dma
-00014100: 3530 6465 6369 7369 6f6e 203d 2022 220a  50decision = "".
-00014110: 2020 2020 2020 2020 6661 6972 5661 6c75          fairValu
-00014120: 6520 3d20 300a 2020 2020 2020 2020 6661  e = 0.        fa
-00014130: 6972 5661 6c75 6544 6966 6620 3d20 300a  irValueDiff = 0.
-00014140: 2020 2020 2020 2020 2320 6966 2064 6620          # if df 
-00014150: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
-00014160: 6629 203c 2032 3230 206f 7220 7465 7374  f) < 220 or test
-00014170: 696e 673a 0a20 2020 2020 2020 2023 2020  ing:.        #  
-00014180: 2020 2073 686f 756c 6450 726f 6365 6564     shouldProceed
-00014190: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-000141a0: 2069 6620 6466 2069 7320 6e6f 7420 4e6f   if df is not No
-000141b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000141c0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-000141d0: 2020 2020 2064 6174 6120 3d20 6466 2e63       data = df.c
-000141e0: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-000141f0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-00014200: 615b 3a3a 2d31 5d0a 2020 2020 2020 2020  a[::-1].        
-00014210: 2020 2020 2020 2020 746f 6461 795f 736d          today_sm
-00014220: 6120 3d20 706b 7461 6c69 622e 534d 4128  a = pktalib.SMA(
-00014230: 6461 7461 5b22 436c 6f73 6522 5d2c 2074  data["Close"], t
-00014240: 696d 6570 6572 696f 643d 3530 290a 2020  imeperiod=50).  
-00014250: 2020 2020 2020 2020 2020 2020 2020 736d                sm
-00014260: 615f 6d69 6e75 7339 203d 2070 6b74 616c  a_minus9 = pktal
-00014270: 6962 2e53 4d41 2864 6174 612e 6865 6164  ib.SMA(data.head
-00014280: 286c 656e 2864 6174 6129 2d39 295b 2243  (len(data)-9)["C
-00014290: 6c6f 7365 225d 2c20 7469 6d65 7065 7269  lose"], timeperi
-000142a0: 6f64 3d35 3029 0a20 2020 2020 2020 2020  od=50).         
-000142b0: 2020 2020 2020 2073 6d61 5f6d 696e 7573         sma_minus
-000142c0: 3134 203d 2070 6b74 616c 6962 2e53 4d41  14 = pktalib.SMA
-000142d0: 2864 6174 612e 6865 6164 286c 656e 2864  (data.head(len(d
-000142e0: 6174 6129 2d31 3429 5b22 436c 6f73 6522  ata)-14)["Close"
-000142f0: 5d2c 2074 696d 6570 6572 696f 643d 3530  ], timeperiod=50
-00014300: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014310: 2020 736d 615f 6d69 6e75 7332 3020 3d20    sma_minus20 = 
-00014320: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
-00014330: 2e68 6561 6428 6c65 6e28 6461 7461 292d  .head(len(data)-
-00014340: 3230 295b 2243 6c6f 7365 225d 2c20 7469  20)["Close"], ti
-00014350: 6d65 7065 7269 6f64 3d35 3029 0a20 2020  meperiod=50).   
-00014360: 2020 2020 2020 2020 2020 2020 2074 6f64               tod
-00014370: 6179 5f6c 6d61 203d 2070 6b74 616c 6962  ay_lma = pktalib
-00014380: 2e53 4d41 2864 6174 615b 2243 6c6f 7365  .SMA(data["Close
-00014390: 225d 2c20 7469 6d65 7065 7269 6f64 3d32  "], timeperiod=2
-000143a0: 3030 290a 2020 2020 2020 2020 2020 2020  00).            
-000143b0: 2020 2020 6c6d 615f 6d69 6e75 7332 3020      lma_minus20 
-000143c0: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
-000143d0: 7461 2e68 6561 6428 6c65 6e28 6461 7461  ta.head(len(data
-000143e0: 292d 3230 295b 2243 6c6f 7365 225d 2c20  )-20)["Close"], 
-000143f0: 7469 6d65 7065 7269 6f64 3d32 3030 290a  timeperiod=200).
-00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014410: 6c6d 615f 6d69 6e75 7338 3020 3d20 706b  lma_minus80 = pk
-00014420: 7461 6c69 622e 534d 4128 6461 7461 2e68  talib.SMA(data.h
-00014430: 6561 6428 6c65 6e28 6461 7461 292d 3830  ead(len(data)-80
-00014440: 295b 2243 6c6f 7365 225d 2c20 7469 6d65  )["Close"], time
-00014450: 7065 7269 6f64 3d32 3030 290a 2020 2020  period=200).    
-00014460: 2020 2020 2020 2020 2020 2020 6c6d 615f              lma_
-00014470: 6d69 6e75 7331 3030 203d 2070 6b74 616c  minus100 = pktal
-00014480: 6962 2e53 4d41 2864 6174 612e 6865 6164  ib.SMA(data.head
-00014490: 286c 656e 2864 6174 6129 2d31 3030 295b  (len(data)-100)[
-000144a0: 2243 6c6f 7365 225d 2c20 7469 6d65 7065  "Close"], timepe
-000144b0: 7269 6f64 3d32 3030 290a 2020 2020 2020  riod=200).      
-000144c0: 2020 2020 2020 2020 2020 746f 6461 795f            today_
-000144d0: 6c6d 6120 3d20 746f 6461 795f 6c6d 612e  lma = today_lma.
-000144e0: 696c 6f63 5b6c 656e 2874 6f64 6179 5f6c  iloc[len(today_l
-000144f0: 6d61 292d 315d 2069 6620 746f 6461 795f  ma)-1] if today_
-00014500: 6c6d 6120 6973 206e 6f74 204e 6f6e 6520  lma is not None 
-00014510: 656c 7365 2030 0a20 2020 2020 2020 2020  else 0.         
-00014520: 2020 2020 2020 206c 6d61 5f6d 696e 7573         lma_minus
-00014530: 3230 203d 206c 6d61 5f6d 696e 7573 3230  20 = lma_minus20
-00014540: 2e69 6c6f 635b 6c65 6e28 6c6d 615f 6d69  .iloc[len(lma_mi
-00014550: 6e75 7332 3029 2d31 5d20 6966 206c 6d61  nus20)-1] if lma
-00014560: 5f6d 696e 7573 3230 2069 7320 6e6f 7420  _minus20 is not 
-00014570: 4e6f 6e65 2065 6c73 6520 300a 2020 2020  None else 0.    
-00014580: 2020 2020 2020 2020 2020 2020 6c6d 615f              lma_
-00014590: 6d69 6e75 7338 3020 3d20 6c6d 615f 6d69  minus80 = lma_mi
-000145a0: 6e75 7338 302e 696c 6f63 5b6c 656e 286c  nus80.iloc[len(l
-000145b0: 6d61 5f6d 696e 7573 3830 292d 315d 2069  ma_minus80)-1] i
-000145c0: 6620 6c6d 615f 6d69 6e75 7338 3020 6973  f lma_minus80 is
-000145d0: 206e 6f74 204e 6f6e 6520 656c 7365 2030   not None else 0
-000145e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000145f0: 206c 6d61 5f6d 696e 7573 3130 3020 3d20   lma_minus100 = 
-00014600: 6c6d 615f 6d69 6e75 7331 3030 2e69 6c6f  lma_minus100.ilo
-00014610: 635b 6c65 6e28 6c6d 615f 6d69 6e75 7331  c[len(lma_minus1
-00014620: 3030 292d 315d 2069 6620 6c6d 615f 6d69  00)-1] if lma_mi
-00014630: 6e75 7331 3030 2069 7320 6e6f 7420 4e6f  nus100 is not No
-00014640: 6e65 2065 6c73 6520 300a 2020 2020 2020  ne else 0.      
-00014650: 2020 2020 2020 2020 2020 746f 6461 795f            today_
-00014660: 736d 6120 3d20 746f 6461 795f 736d 612e  sma = today_sma.
-00014670: 696c 6f63 5b6c 656e 2874 6f64 6179 5f73  iloc[len(today_s
-00014680: 6d61 292d 315d 2069 6620 746f 6461 795f  ma)-1] if today_
-00014690: 736d 6120 6973 206e 6f74 204e 6f6e 6520  sma is not None 
-000146a0: 656c 7365 2030 0a20 2020 2020 2020 2020  else 0.         
-000146b0: 2020 2020 2020 2073 6d61 5f6d 696e 7573         sma_minus
-000146c0: 3920 3d20 736d 615f 6d69 6e75 7339 2e69  9 = sma_minus9.i
-000146d0: 6c6f 635b 6c65 6e28 736d 615f 6d69 6e75  loc[len(sma_minu
-000146e0: 7339 292d 315d 2069 6620 736d 615f 6d69  s9)-1] if sma_mi
-000146f0: 6e75 7339 2069 7320 6e6f 7420 4e6f 6e65  nus9 is not None
-00014700: 2065 6c73 6520 300a 2020 2020 2020 2020   else 0.        
-00014710: 2020 2020 2020 2020 736d 615f 6d69 6e75          sma_minu
-00014720: 7331 3420 3d20 736d 615f 6d69 6e75 7331  s14 = sma_minus1
-00014730: 342e 696c 6f63 5b6c 656e 2873 6d61 5f6d  4.iloc[len(sma_m
-00014740: 696e 7573 3134 292d 315d 2069 6620 736d  inus14)-1] if sm
-00014750: 615f 6d69 6e75 7331 3420 6973 206e 6f74  a_minus14 is not
-00014760: 204e 6f6e 6520 656c 7365 2030 0a20 2020   None else 0.   
-00014770: 2020 2020 2020 2020 2020 2020 2073 6d61               sma
-00014780: 5f6d 696e 7573 3230 203d 2073 6d61 5f6d  _minus20 = sma_m
-00014790: 696e 7573 3230 2e69 6c6f 635b 6c65 6e28  inus20.iloc[len(
-000147a0: 736d 615f 6d69 6e75 7332 3029 2d31 5d20  sma_minus20)-1] 
-000147b0: 6966 2073 6d61 5f6d 696e 7573 3230 2069  if sma_minus20 i
-000147c0: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-000147d0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-000147e0: 2020 6973 5570 7472 656e 6420 3d20 2874    isUptrend = (t
-000147f0: 6f64 6179 5f6c 6d61 203e 206c 6d61 5f6d  oday_lma > lma_m
-00014800: 696e 7573 3230 2920 6f72 2028 746f 6461  inus20) or (toda
-00014810: 795f 6c6d 6120 3e20 6c6d 615f 6d69 6e75  y_lma > lma_minu
-00014820: 7338 3029 206f 7220 2874 6f64 6179 5f6c  s80) or (today_l
-00014830: 6d61 203e 206c 6d61 5f6d 696e 7573 3130  ma > lma_minus10
-00014840: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-00014850: 2020 2069 7344 6f77 6e74 7265 6e64 203d     isDowntrend =
-00014860: 2028 746f 6461 795f 6c6d 6120 3c20 6c6d   (today_lma < lm
-00014870: 615f 6d69 6e75 7332 3029 2061 6e64 2028  a_minus20) and (
-00014880: 746f 6461 795f 6c6d 6120 3c20 6c6d 615f  today_lma < lma_
-00014890: 6d69 6e75 7338 3029 2061 6e64 2028 746f  minus80) and (to
-000148a0: 6461 795f 6c6d 6120 3c20 6c6d 615f 6d69  day_lma < lma_mi
-000148b0: 6e75 7331 3030 290a 2020 2020 2020 2020  nus100).        
-000148c0: 2020 2020 2020 2020 6973 3530 444d 4155          is50DMAU
-000148d0: 7074 7265 6e64 203d 2028 746f 6461 795f  ptrend = (today_
-000148e0: 736d 6120 3e20 736d 615f 6d69 6e75 7339  sma > sma_minus9
-000148f0: 2920 6f72 2028 746f 6461 795f 736d 6120  ) or (today_sma 
-00014900: 3e20 736d 615f 6d69 6e75 7331 3429 206f  > sma_minus14) o
-00014910: 7220 2874 6f64 6179 5f73 6d61 203e 2073  r (today_sma > s
-00014920: 6d61 5f6d 696e 7573 3230 290a 2020 2020  ma_minus20).    
-00014930: 2020 2020 2020 2020 2020 2020 6973 3530              is50
-00014940: 444d 4144 6f77 6e74 7265 6e64 203d 2028  DMADowntrend = (
-00014950: 746f 6461 795f 736d 6120 3c20 736d 615f  today_sma < sma_
-00014960: 6d69 6e75 7339 2920 616e 6420 2874 6f64  minus9) and (tod
-00014970: 6179 5f73 6d61 203c 2073 6d61 5f6d 696e  ay_sma < sma_min
-00014980: 7573 3134 2920 616e 6420 2874 6f64 6179  us14) and (today
-00014990: 5f73 6d61 203c 2073 6d61 5f6d 696e 7573  _sma < sma_minus
-000149a0: 3230 290a 2020 2020 2020 2020 2020 2020  20).            
-000149b0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-000149c0: 3a20 2023 2070 7261 676d 613a 206e 6f20  :  # pragma: no 
-000149d0: 636f 7665 720a 2020 2020 2020 2020 2020  cover.          
-000149e0: 2020 2020 2020 2320 7365 6c66 2e64 6566        # self.def
-000149f0: 6175 6c74 5f6c 6f67 6765 722e 6465 6275  ault_logger.debu
-00014a00: 6728 652c 2065 7863 5f69 6e66 6f3d 5472  g(e, exc_info=Tr
-00014a10: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00014a20: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-00014a30: 2064 6563 6973 696f 6e20 3d20 2754 3ae2   decision = 'T:.
-00014a40: 96b2 2720 6966 2069 7355 7074 7265 6e64  ..' if isUptrend
-00014a50: 2065 6c73 6520 2827 543a e296 bc27 2069   else ('T:...' i
-00014a60: 6620 6973 446f 776e 7472 656e 6420 656c  f isDowntrend el
-00014a70: 7365 2027 2729 0a20 2020 2020 2020 2064  se '').        d
-00014a80: 6d61 3530 6465 6369 7369 6f6e 203d 2027  ma50decision = '
-00014a90: 743a e296 b227 2069 6620 6973 3530 444d  t:...' if is50DM
-00014aa0: 4155 7074 7265 6e64 2065 6c73 6520 2827  AUptrend else ('
-00014ab0: 743a e296 bc27 2069 6620 6973 3530 444d  t:...' if is50DM
-00014ac0: 4144 6f77 6e74 7265 6e64 2065 6c73 6520  ADowntrend else 
-00014ad0: 2727 290a 2020 2020 2020 2020 6d66 5f69  '').        mf_i
-00014ae0: 6e73 745f 6f77 6e65 7273 6869 7043 6861  nst_ownershipCha
-00014af0: 6e67 6520 3d20 300a 2020 2020 2020 2020  nge = 0.        
-00014b00: 6368 616e 6765 5f6d 696c 6c69 6f6e 7320  change_millions 
-00014b10: 3d22 220a 2020 2020 2020 2020 6d66 203d  ="".        mf =
-00014b20: 2022 220a 2020 2020 2020 2020 6d66 7320   "".        mfs 
-00014b30: 3d20 2222 0a20 2020 2020 2020 2069 6620  = "".        if 
-00014b40: 7265 6672 6573 684d 4641 6e64 4656 3a0a  refreshMFAndFV:.
-00014b50: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00014b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014b70: 206d 665f 696e 7374 5f6f 776e 6572 7368   mf_inst_ownersh
-00014b80: 6970 4368 616e 6765 203d 2073 656c 662e  ipChange = self.
-00014b90: 6765 744d 7574 7561 6c46 756e 6453 7461  getMutualFundSta
-00014ba0: 7475 7328 7374 6f63 6b2c 6f6e 6c79 4d46  tus(stock,onlyMF
-00014bb0: 3d6f 6e6c 794d 462c 686f 7374 4461 7461  =onlyMF,hostData
-00014bc0: 3d68 6f73 7444 6174 612c 666f 7263 653d  =hostData,force=
-00014bd0: 2868 6f73 7444 6174 6120 6973 204e 6f6e  (hostData is Non
-00014be0: 6520 6f72 2068 6f73 7444 6174 612e 656d  e or hostData.em
-00014bf0: 7074 7920 6f72 206e 6f74 2028 224d 4622  pty or not ("MF"
-00014c00: 2069 6e20 686f 7374 4461 7461 2e63 6f6c   in hostData.col
-00014c10: 756d 6e73 206f 7220 2246 4949 2220 696e  umns or "FII" in
-00014c20: 2068 6f73 7444 6174 612e 636f 6c75 6d6e   hostData.column
-00014c30: 7329 292c 6578 6368 616e 6765 4e61 6d65  s)),exchangeName
-00014c40: 3d65 7863 6861 6e67 654e 616d 6529 0a20  =exchangeName). 
-00014c50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00014c60: 6620 6973 696e 7374 616e 6365 286d 665f  f isinstance(mf_
-00014c70: 696e 7374 5f6f 776e 6572 7368 6970 4368  inst_ownershipCh
-00014c80: 616e 6765 2c20 7064 2e53 6572 6965 7329  ange, pd.Series)
-00014c90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014ca0: 2020 2020 2020 6d66 5f69 6e73 745f 6f77        mf_inst_ow
-00014cb0: 6e65 7273 6869 7043 6861 6e67 6520 3d20  nershipChange = 
-00014cc0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-00014cd0: 2020 726f 756e 644f 6666 203d 2032 0a20    roundOff = 2. 
-00014ce0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00014cf0: 696c 6c69 6f6e 7320 3d20 726f 756e 6428  illions = round(
-00014d00: 6d66 5f69 6e73 745f 6f77 6e65 7273 6869  mf_inst_ownershi
-00014d10: 7043 6861 6e67 652f 3130 3030 3030 302c  pChange/1000000,
-00014d20: 726f 756e 644f 6666 290a 2020 2020 2020  roundOff).      
-00014d30: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-00014d40: 666c 6f61 7428 6d69 6c6c 696f 6e73 2920  float(millions) 
-00014d50: 3d3d 2030 2061 6e64 2072 6f75 6e64 4f66  == 0 and roundOf
-00014d60: 6620 3c3d 353a 0a20 2020 2020 2020 2020  f <=5:.         
-00014d70: 2020 2020 2020 2020 2020 2072 6f75 6e64             round
-00014d80: 4f66 6620 2b3d 310a 2020 2020 2020 2020  Off +=1.        
-00014d90: 2020 2020 2020 2020 2020 2020 6d69 6c6c              mill
-00014da0: 696f 6e73 203d 2072 6f75 6e64 286d 665f  ions = round(mf_
-00014db0: 696e 7374 5f6f 776e 6572 7368 6970 4368  inst_ownershipCh
-00014dc0: 616e 6765 2f31 3030 3030 3030 2c72 6f75  ange/1000000,rou
-00014dd0: 6e64 4f66 6629 0a20 2020 2020 2020 2020  ndOff).         
-00014de0: 2020 2020 2020 2063 6861 6e67 655f 6d69         change_mi
-00014df0: 6c6c 696f 6e73 203d 2066 2228 7b6d 696c  llions = f"({mil
-00014e00: 6c69 6f6e 737d 4d29 220a 2020 2020 2020  lions}M)".      
-00014e10: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00014e20: 6570 7469 6f6e 2061 7320 653a 2020 2320  eption as e:  # 
-00014e30: 7072 6167 6d61 3a20 6e6f 2063 6f76 6572  pragma: no cover
-00014e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014e50: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
-00014e60: 6767 6572 2e64 6562 7567 2865 2c20 6578  gger.debug(e, ex
-00014e70: 635f 696e 666f 3d54 7275 6529 0a20 2020  c_info=True).   
-00014e80: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00014e90: 730a 2020 2020 2020 2020 2020 2020 7472  s.            tr
-00014ea0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00014eb0: 2020 2023 4c65 7427 7320 6765 7420 7468     #Let's get th
-00014ec0: 6520 6661 6972 2076 616c 7565 2c20 6569  e fair value, ei
-00014ed0: 7468 6572 2073 6176 6564 206f 7220 6672  ther saved or fr
-00014ee0: 6573 6820 6672 6f6d 2073 6572 7669 6365  esh from service
-00014ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014f00: 2066 6169 7256 616c 7565 203d 2073 656c   fairValue = sel
-00014f10: 662e 6765 7446 6169 7256 616c 7565 2873  f.getFairValue(s
-00014f20: 746f 636b 2c68 6f73 7444 6174 612c 666f  tock,hostData,fo
-00014f30: 7263 653d 2868 6f73 7444 6174 6120 6973  rce=(hostData is
-00014f40: 204e 6f6e 6520 6f72 2068 6f73 7444 6174   None or hostDat
-00014f50: 612e 656d 7074 7920 6f72 2022 4661 6972  a.empty or "Fair
-00014f60: 5661 6c75 6522 206e 6f74 2069 6e20 686f  Value" not in ho
-00014f70: 7374 4461 7461 2e63 6f6c 756d 6e73 292c  stData.columns),
-00014f80: 6578 6368 616e 6765 4e61 6d65 3d65 7863  exchangeName=exc
-00014f90: 6861 6e67 654e 616d 6529 0a20 2020 2020  hangeName).     
-00014fa0: 2020 2020 2020 2020 2020 2069 6620 6661             if fa
-00014fb0: 6972 5661 6c75 6520 6973 206e 6f74 204e  irValue is not N
-00014fc0: 6f6e 6520 616e 6420 6661 6972 5661 6c75  one and fairValu
-00014fd0: 6520 213d 2030 3a0a 2020 2020 2020 2020  e != 0:.        
-00014fe0: 2020 2020 2020 2020 2020 2020 6c74 7020              ltp 
-00014ff0: 3d20 7361 7665 4469 6374 5b22 4c54 5022  = saveDict["LTP"
-00015000: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00015010: 2020 2020 2020 6661 6972 5661 6c75 6544        fairValueD
-00015020: 6966 6620 3d20 726f 756e 6428 6661 6972  iff = round(fair
-00015030: 5661 6c75 6520 2d20 6c74 702c 3029 0a20  Value - ltp,0). 
-00015040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015050: 2020 2073 6176 6544 6963 745b 2246 6169     saveDict["Fai
-00015060: 7256 616c 7565 225d 203d 2073 7472 2866  rValue"] = str(f
-00015070: 6169 7256 616c 7565 290a 2020 2020 2020  airValue).      
-00015080: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00015090: 7665 4469 6374 5b22 4656 4469 6666 225d  veDict["FVDiff"]
-000150a0: 203d 2066 6169 7256 616c 7565 4469 6666   = fairValueDiff
-000150b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000150c0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-000150d0: 2246 5644 6966 6622 5d20 3d20 6661 6972  "FVDiff"] = fair
-000150e0: 5661 6c75 6544 6966 660a 2020 2020 2020  ValueDiff.      
-000150f0: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-00015100: 7265 656e 4469 6374 5b22 4661 6972 5661  reenDict["FairVa
-00015110: 6c75 6522 5d20 3d20 2863 6f6c 6f72 5465  lue"] = (colorTe
-00015120: 7874 2e47 5245 454e 2069 6620 6661 6972  xt.GREEN if fair
-00015130: 5661 6c75 6520 3e3d 206c 7470 2065 6c73  Value >= ltp els
-00015140: 6520 636f 6c6f 7254 6578 742e 4641 494c  e colorText.FAIL
-00015150: 2920 2b20 7361 7665 4469 6374 5b22 4661  ) + saveDict["Fa
-00015160: 6972 5661 6c75 6522 5d20 2b20 636f 6c6f  irValue"] + colo
-00015170: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00015180: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00015190: 6570 7469 6f6e 2061 7320 653a 2020 2320  eption as e:  # 
-000151a0: 7072 6167 6d61 3a20 6e6f 2063 6f76 6572  pragma: no cover
-000151b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000151c0: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
-000151d0: 6767 6572 2e64 6562 7567 2865 2c20 6578  gger.debug(e, ex
-000151e0: 635f 696e 666f 3d54 7275 6529 0a20 2020  c_info=True).   
-000151f0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00015200: 730a 2020 2020 2020 2020 2020 2020 0a20  s.            . 
-00015210: 2020 2020 2020 2020 2020 2069 6620 6d66             if mf
-00015220: 5f69 6e73 745f 6f77 6e65 7273 6869 7043  _inst_ownershipC
-00015230: 6861 6e67 6520 3e20 303a 0a20 2020 2020  hange > 0:.     
-00015240: 2020 2020 2020 2020 2020 206d 6620 3d20             mf = 
-00015250: 6622 4d46 493a e296 b220 7b63 6861 6e67  f"MFI:... {chang
-00015260: 655f 6d69 6c6c 696f 6e73 7d22 0a20 2020  e_millions}".   
-00015270: 2020 2020 2020 2020 2020 2020 206d 6673               mfs
-00015280: 203d 2063 6f6c 6f72 5465 7874 2e47 5245   = colorText.GRE
-00015290: 454e 202b 206d 6620 2b20 636f 6c6f 7254  EN + mf + colorT
-000152a0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-000152b0: 2020 2020 656c 6966 206d 665f 696e 7374      elif mf_inst
-000152c0: 5f6f 776e 6572 7368 6970 4368 616e 6765  _ownershipChange
-000152d0: 203c 2030 3a0a 2020 2020 2020 2020 2020   < 0:.          
-000152e0: 2020 2020 2020 6d66 203d 2066 224d 4649        mf = f"MFI
-000152f0: 3ae2 96bc 207b 6368 616e 6765 5f6d 696c  :... {change_mil
-00015300: 6c69 6f6e 737d 220a 2020 2020 2020 2020  lions}".        
-00015310: 2020 2020 2020 2020 6d66 7320 3d20 636f          mfs = co
-00015320: 6c6f 7254 6578 742e 4641 494c 202b 206d  lorText.FAIL + m
-00015330: 6620 2b20 636f 6c6f 7254 6578 742e 454e  f + colorText.EN
-00015340: 440a 0a20 2020 2020 2020 2073 6176 6564  D..        saved
-00015350: 203d 2073 656c 662e 6669 6e64 4375 7272   = self.findCurr
-00015360: 656e 7453 6176 6564 5661 6c75 6528 7363  entSavedValue(sc
-00015370: 7265 656e 4469 6374 2c73 6176 6544 6963  reenDict,saveDic
-00015380: 742c 2254 7265 6e64 2229 0a20 2020 2020  t,"Trend").     
-00015390: 2020 2064 6563 6973 696f 6e5f 7363 7220     decision_scr 
-000153a0: 3d20 2863 6f6c 6f72 5465 7874 2e47 5245  = (colorText.GRE
-000153b0: 454e 2069 6620 6973 5570 7472 656e 6420  EN if isUptrend 
-000153c0: 656c 7365 2028 636f 6c6f 7254 6578 742e  else (colorText.
-000153d0: 4641 494c 2069 6620 6973 446f 776e 7472  FAIL if isDowntr
-000153e0: 656e 6420 656c 7365 2063 6f6c 6f72 5465  end else colorTe
-000153f0: 7874 2e57 4152 4e29 2920 2b20 6622 7b64  xt.WARN)) + f"{d
-00015400: 6563 6973 696f 6e7d 2220 2b20 636f 6c6f  ecision}" + colo
-00015410: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00015420: 2020 646d 6135 3064 6563 6973 696f 6e5f    dma50decision_
-00015430: 7363 7220 3d20 2863 6f6c 6f72 5465 7874  scr = (colorText
-00015440: 2e47 5245 454e 2069 6620 6973 3530 444d  .GREEN if is50DM
-00015450: 4155 7074 7265 6e64 2065 6c73 6520 2863  AUptrend else (c
-00015460: 6f6c 6f72 5465 7874 2e46 4149 4c20 6966  olorText.FAIL if
-00015470: 2069 7335 3044 4d41 446f 776e 7472 656e   is50DMADowntren
-00015480: 6420 656c 7365 2063 6f6c 6f72 5465 7874  d else colorText
-00015490: 2e57 4152 4e29 2920 2b20 6622 7b64 6d61  .WARN)) + f"{dma
-000154a0: 3530 6465 6369 7369 6f6e 7d22 202b 2063  50decision}" + c
-000154b0: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-000154c0: 2020 2020 2073 6176 6544 6963 745b 2254       saveDict["T
-000154d0: 7265 6e64 225d 203d 2066 227b 7361 7665  rend"] = f"{save
-000154e0: 645b 315d 7d20 7b64 6563 6973 696f 6e7d  d[1]} {decision}
-000154f0: 207b 646d 6135 3064 6563 6973 696f 6e7d   {dma50decision}
-00015500: 207b 6d66 7d22 0a20 2020 2020 2020 2073   {mf}".        s
-00015510: 6372 6565 6e44 6963 745b 2254 7265 6e64  creenDict["Trend
-00015520: 225d 203d 2066 227b 7361 7665 645b 305d  "] = f"{saved[0]
-00015530: 7d20 7b64 6563 6973 696f 6e5f 7363 727d  } {decision_scr}
-00015540: 207b 646d 6135 3064 6563 6973 696f 6e5f   {dma50decision_
-00015550: 7363 727d 207b 6d66 737d 220a 2020 2020  scr} {mfs}".    
-00015560: 2020 2020 7361 7665 4469 6374 5b22 4d46      saveDict["MF
-00015570: 4922 5d20 3d20 6d66 5f69 6e73 745f 6f77  I"] = mf_inst_ow
-00015580: 6e65 7273 6869 7043 6861 6e67 650a 2020  nershipChange.  
-00015590: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-000155a0: 5b22 4d46 4922 5d20 3d20 6d66 5f69 6e73  ["MFI"] = mf_ins
-000155b0: 745f 6f77 6e65 7273 6869 7043 6861 6e67  t_ownershipChang
-000155c0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-000155d0: 2069 7355 7074 7265 6e64 2c20 6d66 5f69   isUptrend, mf_i
-000155e0: 6e73 745f 6f77 6e65 7273 6869 7043 6861  nst_ownershipCha
-000155f0: 6e67 652c 2066 6169 7256 616c 7565 4469  nge, fairValueDi
-00015600: 6666 0a20 2020 200a 2020 2020 2320 5072  ff.    .    # Pr
-00015610: 6976 6174 6520 6d65 7468 6f64 2074 6f20  ivate method to 
-00015620: 6669 6e64 2063 616e 646c 6520 7479 7065  find candle type
-00015630: 0a20 2020 2023 2054 7275 6520 3d20 4275  .    # True = Bu
-00015640: 6c6c 6973 682c 2046 616c 7365 203d 2042  llish, False = B
-00015650: 6561 7269 7368 0a20 2020 2064 6566 2067  earish.    def g
-00015660: 6574 4361 6e64 6c65 5479 7065 2873 656c  etCandleType(sel
-00015670: 662c 2064 6169 6c79 4461 7461 293a 0a20  f, dailyData):. 
-00015680: 2020 2020 2020 2072 6574 7572 6e20 626f         return bo
-00015690: 6f6c 2864 6169 6c79 4461 7461 5b22 436c  ol(dailyData["Cl
-000156a0: 6f73 6522 5d2e 696c 6f63 5b30 5d20 3e3d  ose"].iloc[0] >=
-000156b0: 2064 6169 6c79 4461 7461 5b22 4f70 656e   dailyData["Open
-000156c0: 225d 2e69 6c6f 635b 305d 290a 0a20 2020  "].iloc[0])..   
-000156d0: 2064 6566 2067 6574 4361 6e64 6c65 426f   def getCandleBo
-000156e0: 6479 4865 6967 6874 2873 656c 662c 2064  dyHeight(self, d
-000156f0: 6169 6c79 4461 7461 293a 0a20 2020 2020  ailyData):.     
-00015700: 2020 2062 6f64 7948 6569 6768 7420 3d20     bodyHeight = 
-00015710: 6461 696c 7944 6174 615b 2243 6c6f 7365  dailyData["Close
-00015720: 225d 2e69 6c6f 635b 305d 202d 2064 6169  "].iloc[0] - dai
-00015730: 6c79 4461 7461 5b22 4f70 656e 225d 2e69  lyData["Open"].i
-00015740: 6c6f 635b 305d 0a20 2020 2020 2020 2072  loc[0].        r
-00015750: 6574 7572 6e20 626f 6479 4865 6967 6874  eturn bodyHeight
-00015760: 0a0a 2020 2020 6465 6620 6765 7446 6169  ..    def getFai
-00015770: 7256 616c 7565 2873 656c 662c 2073 746f  rValue(self, sto
-00015780: 636b 2c20 686f 7374 4461 7461 3d4e 6f6e  ck, hostData=Non
-00015790: 652c 2066 6f72 6365 3d46 616c 7365 2c65  e, force=False,e
-000157a0: 7863 6861 6e67 654e 616d 653d 2249 4e44  xchangeName="IND
-000157b0: 4941 2229 3a0a 2020 2020 2020 2020 6966  IA"):.        if
-000157c0: 2068 6f73 7444 6174 6120 6973 204e 6f6e   hostData is Non
-000157d0: 6520 6f72 206c 656e 2868 6f73 7444 6174  e or len(hostDat
-000157e0: 6129 203c 2031 3a0a 2020 2020 2020 2020  a) < 1:.        
-000157f0: 2020 2020 686f 7374 4461 7461 203d 2070      hostData = p
-00015800: 642e 4461 7461 4672 616d 6528 290a 2020  d.DataFrame().  
-00015810: 2020 2020 2020 2320 4c65 7427 7320 6c6f        # Let's lo
-00015820: 6f6b 2066 6f72 2066 6169 7220 7661 6c75  ok for fair valu
-00015830: 6573 0a20 2020 2020 2020 2066 6169 7256  es.        fairV
-00015840: 616c 7565 203d 2030 0a20 2020 2020 2020  alue = 0.       
-00015850: 2069 6620 2246 6169 7256 616c 7565 2220   if "FairValue" 
-00015860: 696e 2068 6f73 7444 6174 612e 636f 6c75  in hostData.colu
-00015870: 6d6e 7320 616e 6420 504b 4461 7465 5574  mns and PKDateUt
-00015880: 696c 6974 6965 732e 6375 7272 656e 7444  ilities.currentD
-00015890: 6174 6554 696d 6528 292e 7765 656b 6461  ateTime().weekda
-000158a0: 7928 2920 3c3d 2034 3a0a 2020 2020 2020  y() <= 4:.      
-000158b0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000158c0: 2020 2020 2020 2020 2020 2066 6169 7256             fairV
-000158d0: 616c 7565 203d 2068 6f73 7444 6174 612e  alue = hostData.
-000158e0: 6c6f 635b 686f 7374 4461 7461 2e69 6e64  loc[hostData.ind
-000158f0: 6578 5b2d 315d 2c22 4661 6972 5661 6c75  ex[-1],"FairValu
-00015900: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
-00015910: 6578 6365 7074 2028 4b65 7945 7272 6f72  except (KeyError
-00015920: 2c49 6e64 6578 4572 726f 7229 3a0a 2020  ,IndexError):.  
-00015930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015940: 2020 7061 7373 0a20 2020 2020 2020 2065    pass.        e
-00015950: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00015960: 2069 6620 504b 4461 7465 5574 696c 6974   if PKDateUtilit
-00015970: 6965 732e 6375 7272 656e 7444 6174 6554  ies.currentDateT
-00015980: 696d 6528 292e 7765 656b 6461 7928 2920  ime().weekday() 
-00015990: 3e3d 2035 206f 7220 666f 7263 653a 0a20  >= 5 or force:. 
-000159a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000159b0: 6563 7572 6974 7920 3d20 4e6f 6e65 0a20  ecurity = None. 
-000159c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000159d0: 2052 6566 7265 7368 2065 6163 6820 7361   Refresh each sa
-000159e0: 7475 7264 6179 206f 7220 7375 6e64 6179  turday or sunday
-000159f0: 206f 7220 7768 656e 206e 6f74 2066 6f75   or when not fou
-00015a00: 6e64 2069 6e20 7361 7665 6420 6461 7461  nd in saved data
-00015a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015a20: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00015a30: 2020 2020 2020 2020 2020 7769 7468 2053            with S
-00015a40: 7570 7072 6573 734f 7574 7075 7428 7375  uppressOutput(su
-00015a50: 7070 7265 7373 5f73 7464 6572 723d 5472  ppress_stderr=Tr
-00015a60: 7565 2c20 7375 7070 7265 7373 5f73 7464  ue, suppress_std
-00015a70: 6f75 743d 5472 7565 293a 0a20 2020 2020  out=True):.     
-00015a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a90: 2020 2073 6563 7572 6974 7920 3d20 5374     security = St
-00015aa0: 6f63 6b28 7374 6f63 6b2c 6578 6368 616e  ock(stock,exchan
-00015ab0: 6765 3d65 7863 6861 6e67 654e 616d 6529  ge=exchangeName)
-00015ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015ad0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
-00015ae0: 6f72 3a20 2320 7072 6167 6d61 3a20 6e6f  or: # pragma: no
-00015af0: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
-00015b00: 2020 2020 2020 2020 2020 2023 2057 6520             # We 
-00015b10: 6469 6420 6e6f 7420 6669 6e64 2074 6865  did not find the
-00015b20: 2073 746f 636b 3f20 4974 2773 206f 6b61   stock? It's oka
-00015b30: 792e 204d 6f76 6520 6f6e 2074 6f20 7468  y. Move on to th
-00015b40: 6520 6e65 7874 206f 6e65 2e0a 2020 2020  e next one..    
-00015b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b60: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
-00015b70: 2020 2020 2065 7863 6570 7420 2854 696d       except (Tim
-00015b80: 656f 7574 4572 726f 722c 2043 6f6e 6e65  eoutError, Conne
-00015b90: 6374 696f 6e45 7272 6f72 2920 6173 2065  ctionError) as e
-00015ba0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015bb0: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
-00015bc0: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
-00015bd0: 652c 2065 7863 5f69 6e66 6f3d 5472 7565  e, exc_info=True
-00015be0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015bf0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00015c00: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00015c10: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00015c20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015c30: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
-00015c40: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
-00015c50: 652c 2065 7863 5f69 6e66 6f3d 5472 7565  e, exc_info=True
-00015c60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015c70: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00015c80: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00015c90: 6375 7269 7479 2069 7320 6e6f 7420 4e6f  curity is not No
-00015ca0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00015cb0: 2020 2020 2020 2020 7769 7468 2053 7570          with Sup
-00015cc0: 7072 6573 734f 7574 7075 7428 7375 7070  pressOutput(supp
-00015cd0: 7265 7373 5f73 7464 6572 723d 5472 7565  ress_stderr=True
-00015ce0: 2c20 7375 7070 7265 7373 5f73 7464 6f75  , suppress_stdou
-00015cf0: 743d 5472 7565 293a 0a20 2020 2020 2020  t=True):.       
-00015d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d10: 2066 7620 3d20 7365 6375 7269 7479 2e66   fv = security.f
-00015d20: 6169 7256 616c 7565 2829 0a20 2020 2020  airValue().     
-00015d30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00015d40: 6620 6676 2069 7320 6e6f 7420 4e6f 6e65  f fv is not None
-00015d50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015d60: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00015d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d80: 2020 2020 2020 2020 2020 2066 7652 6573             fvRes
-00015d90: 706f 6e73 6556 616c 7565 203d 2066 765b  ponseValue = fv[
-00015da0: 226c 6174 6573 7446 6169 7256 616c 7565  "latestFairValue
-00015db0: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
-00015dc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00015dd0: 6620 6676 5265 7370 6f6e 7365 5661 6c75  f fvResponseValu
-00015de0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00015df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00015e10: 6169 7256 616c 7565 203d 2066 6c6f 6174  airValue = float
-00015e20: 2866 7652 6573 706f 6e73 6556 616c 7565  (fvResponseValue
-00015e30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015e40: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00015e50: 3a20 2320 7072 6167 6d61 3a20 6e6f 2063  : # pragma: no c
-00015e60: 6f76 6572 0a20 2020 2020 2020 2020 2020  over.           
-00015e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e80: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-00015e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ea0: 2020 2320 7365 6c66 2e64 6566 6175 6c74    # self.default
-00015eb0: 5f6c 6f67 6765 722e 6465 6275 6728 6622  _logger.debug(f"
-00015ec0: 7b65 7d5c 6e52 6573 706f 6e73 653a 6676  {e}\nResponse:fv
-00015ed0: 3a5c 6e7b 6676 7d22 2c20 6578 635f 696e  :\n{fv}", exc_in
-00015ee0: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
-00015ef0: 2020 2020 2020 2020 2020 2020 2066 6169               fai
-00015f00: 7256 616c 7565 203d 2072 6f75 6e64 2866  rValue = round(f
-00015f10: 6c6f 6174 2866 6169 7256 616c 7565 292c  loat(fairValue),
-00015f20: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00015f30: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00015f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f50: 2020 2020 686f 7374 4461 7461 2e6c 6f63      hostData.loc
-00015f60: 5b68 6f73 7444 6174 612e 696e 6465 785b  [hostData.index[
-00015f70: 2d31 5d2c 2246 6169 7256 616c 7565 225d  -1],"FairValue"]
-00015f80: 203d 2066 6169 7256 616c 7565 0a20 2020   = fairValue.   
-00015f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015fa0: 2065 7863 6570 7420 284b 6579 4572 726f   except (KeyErro
-00015fb0: 722c 496e 6465 7845 7272 6f72 293a 0a20  r,IndexError):. 
-00015fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015fd0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00015fe0: 2020 2020 7265 7475 726e 2066 6169 7256      return fairV
-00015ff0: 616c 7565 0a0a 2020 2020 6465 6620 6765  alue..    def ge
-00016000: 744d 7574 7561 6c46 756e 6453 7461 7475  tMutualFundStatu
-00016010: 7328 7365 6c66 2c20 7374 6f63 6b2c 6f6e  s(self, stock,on
-00016020: 6c79 4d46 3d46 616c 7365 2c20 686f 7374  lyMF=False, host
-00016030: 4461 7461 3d4e 6f6e 652c 2066 6f72 6365  Data=None, force
-00016040: 3d46 616c 7365 2c65 7863 6861 6e67 654e  =False,exchangeN
-00016050: 616d 653d 2249 4e44 4941 2229 3a0a 2020  ame="INDIA"):.  
-00016060: 2020 2020 2020 6966 2068 6f73 7444 6174        if hostDat
-00016070: 6120 6973 204e 6f6e 6520 6f72 206c 656e  a is None or len
-00016080: 2868 6f73 7444 6174 6129 203c 2031 3a0a  (hostData) < 1:.
-00016090: 2020 2020 2020 2020 2020 2020 686f 7374              host
-000160a0: 4461 7461 203d 2070 642e 4461 7461 4672  Data = pd.DataFr
-000160b0: 616d 6528 290a 2020 2020 2020 2020 0a20  ame().        . 
-000160c0: 2020 2020 2020 206e 6574 4368 616e 6765         netChange
-000160d0: 4d46 203d 2030 0a20 2020 2020 2020 206e  MF = 0.        n
-000160e0: 6574 4368 616e 6765 496e 7374 203d 2030  etChangeInst = 0
-000160f0: 0a20 2020 2020 2020 206c 6174 6573 745f  .        latest_
-00016100: 6d66 6461 7465 203d 204e 6f6e 650a 2020  mfdate = None.  
-00016110: 2020 2020 2020 6c61 7465 7374 5f69 6e73        latest_ins
-00016120: 7464 6174 6520 3d20 4e6f 6e65 0a20 2020  tdate = None.   
-00016130: 2020 2020 206e 6565 6473 4672 6573 6855       needsFreshU
-00016140: 7064 6174 6520 3d20 5472 7565 0a20 2020  pdate = True.   
-00016150: 2020 2020 206c 6173 7444 6179 4c61 7374       lastDayLast
-00016160: 4d6f 6e74 6820 3d20 504b 4461 7465 5574  Month = PKDateUt
-00016170: 696c 6974 6965 732e 6c61 7374 5f64 6179  ilities.last_day
-00016180: 5f6f 665f 7072 6576 696f 7573 5f6d 6f6e  _of_previous_mon
-00016190: 7468 2850 4b44 6174 6555 7469 6c69 7469  th(PKDateUtiliti
-000161a0: 6573 2e63 7572 7265 6e74 4461 7465 5469  es.currentDateTi
-000161b0: 6d65 2829 290a 2020 2020 2020 2020 6966  me()).        if
-000161c0: 2068 6f73 7444 6174 6120 6973 206e 6f74   hostData is not
-000161d0: 204e 6f6e 6520 616e 6420 6c65 6e28 686f   None and len(ho
-000161e0: 7374 4461 7461 2920 3e20 303a 0a20 2020  stData) > 0:.   
-000161f0: 2020 2020 2020 2020 2069 6620 224d 4622           if "MF"
-00016200: 2069 6e20 686f 7374 4461 7461 2e63 6f6c   in hostData.col
-00016210: 756d 6e73 206f 7220 2246 4949 2220 696e  umns or "FII" in
-00016220: 2068 6f73 7444 6174 612e 636f 6c75 6d6e   hostData.column
-00016230: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00016240: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00016250: 2020 2020 2020 2020 2020 2020 6e65 7443              netC
-00016260: 6861 6e67 654d 4620 3d20 686f 7374 4461  hangeMF = hostDa
-00016270: 7461 2e6c 6f63 5b68 6f73 7444 6174 612e  ta.loc[hostData.
-00016280: 696e 6465 785b 2d31 5d2c 224d 4622 5d0a  index[-1],"MF"].
-00016290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162a0: 6578 6365 7074 2028 4b65 7945 7272 6f72  except (KeyError
-000162b0: 2c49 6e64 6578 4572 726f 7229 3a0a 2020  ,IndexError):.  
-000162c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162d0: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
-000162e0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-000162f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016300: 6e65 7443 6861 6e67 6549 6e73 7420 3d20  netChangeInst = 
-00016310: 686f 7374 4461 7461 2e6c 6f63 5b68 6f73  hostData.loc[hos
-00016320: 7444 6174 612e 696e 6465 785b 2d31 5d2c  tData.index[-1],
-00016330: 2246 4949 225d 0a20 2020 2020 2020 2020  "FII"].         
-00016340: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
-00016350: 6579 4572 726f 722c 496e 6465 7845 7272  eyError,IndexErr
-00016360: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-00016370: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-00016380: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00016390: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-000163a0: 2020 2020 2020 206c 6174 6573 745f 6d66         latest_mf
-000163b0: 6461 7465 203d 2068 6f73 7444 6174 612e  date = hostData.
-000163c0: 6c6f 635b 686f 7374 4461 7461 2e69 6e64  loc[hostData.ind
-000163d0: 6578 5b2d 315d 2c22 4d46 5f44 6174 6522  ex[-1],"MF_Date"
-000163e0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000163f0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00016400: 6e63 6528 6c61 7465 7374 5f6d 6664 6174  nce(latest_mfdat
-00016410: 652c 2066 6c6f 6174 293a 0a20 2020 2020  e, float):.     
-00016420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016430: 2020 206c 6174 6573 745f 6d66 6461 7465     latest_mfdate
-00016440: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
-00016450: 7469 6d65 2e66 726f 6d74 696d 6573 7461  time.fromtimesta
-00016460: 6d70 286c 6174 6573 745f 6d66 6461 7465  mp(latest_mfdate
-00016470: 292e 7374 7266 7469 6d65 2827 2559 2d25  ).strftime('%Y-%
-00016480: 6d2d 2564 2729 0a20 2020 2020 2020 2020  m-%d').         
-00016490: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
-000164a0: 6579 4572 726f 722c 496e 6465 7845 7272  eyError,IndexErr
-000164b0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-000164c0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-000164d0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-000164e0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-000164f0: 2020 2020 2020 206c 6174 6573 745f 696e         latest_in
-00016500: 7374 6461 7465 203d 2068 6f73 7444 6174  stdate = hostDat
-00016510: 612e 6c6f 635b 686f 7374 4461 7461 2e69  a.loc[hostData.i
-00016520: 6e64 6578 5b2d 315d 2c22 4649 495f 4461  ndex[-1],"FII_Da
-00016530: 7465 225d 0a20 2020 2020 2020 2020 2020  te"].           
-00016540: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00016550: 7374 616e 6365 286c 6174 6573 745f 696e  stance(latest_in
-00016560: 7374 6461 7465 2c20 666c 6f61 7429 3a0a  stdate, float):.
-00016570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016580: 2020 2020 2020 2020 6c61 7465 7374 5f69          latest_i
-00016590: 6e73 7464 6174 6520 3d20 6461 7465 7469  nstdate = dateti
-000165a0: 6d65 2e64 6174 6574 696d 652e 6672 6f6d  me.datetime.from
-000165b0: 7469 6d65 7374 616d 7028 6c61 7465 7374  timestamp(latest
-000165c0: 5f69 6e73 7464 6174 6529 2e73 7472 6674  _instdate).strft
-000165d0: 696d 6528 2725 592d 256d 2d25 6427 290a  ime('%Y-%m-%d').
-000165e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165f0: 6578 6365 7074 2028 4b65 7945 7272 6f72  except (KeyError
-00016600: 2c49 6e64 6578 4572 726f 7229 3a0a 2020  ,IndexError):.  
-00016610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016620: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
-00016630: 2020 2020 2020 2069 6620 6c61 7465 7374         if latest
-00016640: 5f6d 6664 6174 6520 6973 206e 6f74 204e  _mfdate is not N
-00016650: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00016660: 2020 2020 2020 2020 2073 6176 6564 5f6d           saved_m
-00016670: 6664 6174 6520 3d20 504b 4461 7465 5574  fdate = PKDateUt
-00016680: 696c 6974 6965 732e 6461 7465 4672 6f6d  ilities.dateFrom
-00016690: 596d 6453 7472 696e 6728 6c61 7465 7374  YmdString(latest
-000166a0: 5f6d 6664 6174 652e 7370 6c69 7428 2254  _mfdate.split("T
-000166b0: 2229 5b30 5d29 0a20 2020 2020 2020 2020  ")[0]).         
-000166c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000166d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000166e0: 2073 6176 6564 5f6d 6664 6174 6520 3d20   saved_mfdate = 
-000166f0: 6c61 7374 4461 794c 6173 744d 6f6e 7468  lastDayLastMonth
-00016700: 202d 2064 6174 6574 696d 652e 7469 6d65   - datetime.time
-00016710: 6465 6c74 6128 3129 0a20 2020 2020 2020  delta(1).       
-00016720: 2020 2020 2020 2020 2069 6620 6c61 7465           if late
-00016730: 7374 5f69 6e73 7464 6174 6520 6973 206e  st_instdate is n
-00016740: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00016750: 2020 2020 2020 2020 2020 2020 2073 6176               sav
-00016760: 6564 5f69 6e73 7464 6174 6520 3d20 504b  ed_instdate = PK
-00016770: 4461 7465 5574 696c 6974 6965 732e 6461  DateUtilities.da
-00016780: 7465 4672 6f6d 596d 6453 7472 696e 6728  teFromYmdString(
-00016790: 6c61 7465 7374 5f69 6e73 7464 6174 652e  latest_instdate.
-000167a0: 7370 6c69 7428 2254 2229 5b30 5d29 0a20  split("T")[0]). 
-000167b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000167c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000167d0: 2020 2020 2020 2020 2073 6176 6564 5f69           saved_i
-000167e0: 6e73 7464 6174 6520 3d20 6c61 7374 4461  nstdate = lastDa
-000167f0: 794c 6173 744d 6f6e 7468 202d 2064 6174  yLastMonth - dat
-00016800: 6574 696d 652e 7469 6d65 6465 6c74 6128  etime.timedelta(
-00016810: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00016820: 2020 2074 6f64 6179 203d 2050 4b44 6174     today = PKDat
-00016830: 6555 7469 6c69 7469 6573 2e63 7572 7265  eUtilities.curre
-00016840: 6e74 4461 7465 5469 6d65 2829 0a20 2020  ntDateTime().   
-00016850: 2020 2020 2020 2020 2020 2020 206e 6565               nee
-00016860: 6473 4672 6573 6855 7064 6174 6520 3d20  dsFreshUpdate = 
-00016870: 2873 6176 6564 5f6d 6664 6174 652e 6461  (saved_mfdate.da
-00016880: 7465 2829 203c 206c 6173 7444 6179 4c61  te() < lastDayLa
-00016890: 7374 4d6f 6e74 682e 6461 7465 2829 2920  stMonth.date()) 
-000168a0: 616e 6420 2873 6176 6564 5f69 6e73 7464  and (saved_instd
-000168b0: 6174 652e 6461 7465 2829 203c 206c 6173  ate.date() < las
-000168c0: 7444 6179 4c61 7374 4d6f 6e74 682e 6461  tDayLastMonth.da
-000168d0: 7465 2829 290a 2020 2020 2020 2020 2020  te()).          
-000168e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000168f0: 2020 2020 2020 2020 6e65 6564 7346 7265          needsFre
-00016900: 7368 5570 6461 7465 203d 2054 7275 650a  shUpdate = True.
-00016910: 0a20 2020 2020 2020 2069 6620 6e65 6564  .        if need
-00016920: 7346 7265 7368 5570 6461 7465 2061 6e64  sFreshUpdate and
-00016930: 2066 6f72 6365 3a0a 2020 2020 2020 2020   force:.        
-00016940: 2020 2020 6e65 7443 6861 6e67 654d 462c      netChangeMF,
-00016950: 206e 6574 4368 616e 6765 496e 7374 2c20   netChangeInst, 
-00016960: 6c61 7465 7374 5f6d 6664 6174 652c 206c  latest_mfdate, l
-00016970: 6174 6573 745f 696e 7374 6461 7465 203d  atest_instdate =
-00016980: 2073 656c 662e 6765 7446 7265 7368 4d46   self.getFreshMF
-00016990: 4953 7461 7475 7328 7374 6f63 6b2c 6578  IStatus(stock,ex
-000169a0: 6368 616e 6765 4e61 6d65 3d65 7863 6861  changeName=excha
-000169b0: 6e67 654e 616d 6529 0a20 2020 2020 2020  ngeName).       
-000169c0: 2020 2020 2069 6620 6e65 7443 6861 6e67       if netChang
-000169d0: 654d 4620 6973 206e 6f74 204e 6f6e 653a  eMF is not None:
-000169e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000169f0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00016a00: 2020 2020 2020 2020 2020 686f 7374 4461            hostDa
-00016a10: 7461 2e6c 6f63 5b68 6f73 7444 6174 612e  ta.loc[hostData.
-00016a20: 696e 6465 785b 2d31 5d2c 224d 4622 5d20  index[-1],"MF"] 
-00016a30: 3d20 6e65 7443 6861 6e67 654d 460a 2020  = netChangeMF.  
-00016a40: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00016a50: 6365 7074 2028 4b65 7945 7272 6f72 2c49  cept (KeyError,I
-00016a60: 6e64 6578 4572 726f 7229 3a0a 2020 2020  ndexError):.    
-00016a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a80: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
-00016a90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00016aa0: 2020 2020 2020 206e 6574 4368 616e 6765         netChange
-00016ab0: 4d46 203d 2030 0a20 2020 2020 2020 2020  MF = 0.         
-00016ac0: 2020 2069 6620 6c61 7465 7374 5f6d 6664     if latest_mfd
-00016ad0: 6174 6520 6973 206e 6f74 204e 6f6e 653a  ate is not None:
-00016ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016af0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00016b00: 2020 2020 2020 2020 2020 686f 7374 4461            hostDa
-00016b10: 7461 2e6c 6f63 5b68 6f73 7444 6174 612e  ta.loc[hostData.
-00016b20: 696e 6465 785b 2d31 5d2c 224d 465f 4461  index[-1],"MF_Da
-00016b30: 7465 225d 203d 206c 6174 6573 745f 6d66  te"] = latest_mf
-00016b40: 6461 7465 0a20 2020 2020 2020 2020 2020  date.           
-00016b50: 2020 2020 2065 7863 6570 7420 284b 6579       except (Key
-00016b60: 4572 726f 722c 496e 6465 7845 7272 6f72  Error,IndexError
-00016b70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00016b80: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00016b90: 2020 2020 2020 2020 6966 206e 6574 4368          if netCh
-00016ba0: 616e 6765 496e 7374 2069 7320 6e6f 7420  angeInst is not 
-00016bb0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00016bc0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00016bd0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00016be0: 6f73 7444 6174 612e 6c6f 635b 686f 7374  ostData.loc[host
-00016bf0: 4461 7461 2e69 6e64 6578 5b2d 315d 2c22  Data.index[-1],"
-00016c00: 4649 4922 5d20 3d20 6e65 7443 6861 6e67  FII"] = netChang
-00016c10: 6549 6e73 740a 2020 2020 2020 2020 2020  eInst.          
-00016c20: 2020 2020 2020 6578 6365 7074 2028 4b65        except (Ke
-00016c30: 7945 7272 6f72 2c49 6e64 6578 4572 726f  yError,IndexErro
-00016c40: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00016c50: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-00016c60: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00016c70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00016c80: 6574 4368 616e 6765 496e 7374 203d 2030  etChangeInst = 0
-00016c90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00016ca0: 6c61 7465 7374 5f69 6e73 7464 6174 6520  latest_instdate 
-00016cb0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00016cc0: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00016cd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016ce0: 2020 2020 2020 686f 7374 4461 7461 2e6c        hostData.l
-00016cf0: 6f63 5b68 6f73 7444 6174 612e 696e 6465  oc[hostData.inde
-00016d00: 785b 2d31 5d2c 2246 4949 5f44 6174 6522  x[-1],"FII_Date"
-00016d10: 5d20 3d20 6c61 7465 7374 5f69 6e73 7464  ] = latest_instd
-00016d20: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-00016d30: 2020 2020 6578 6365 7074 2028 4b65 7945      except (KeyE
-00016d40: 7272 6f72 2c49 6e64 6578 4572 726f 7229  rror,IndexError)
-00016d50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016d60: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00016d70: 2020 206c 6173 7444 6179 4c61 7374 4d6f     lastDayLastMo
-00016d80: 6e74 6820 3d20 6c61 7374 4461 794c 6173  nth = lastDayLas
-00016d90: 744d 6f6e 7468 2e73 7472 6674 696d 6528  tMonth.strftime(
-00016da0: 2225 592d 256d 2d25 6454 3030 3a30 303a  "%Y-%m-%dT00:00:
-00016db0: 3030 2e30 3030 2229 0a20 2020 2020 2020  00.000").       
-00016dc0: 2069 6620 6f6e 6c79 4d46 3a0a 2020 2020   if onlyMF:.    
-00016dd0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-00016de0: 6574 4368 616e 6765 4d46 0a20 2020 2020  etChangeMF.     
-00016df0: 2020 2069 6620 6c61 7465 7374 5f69 6e73     if latest_ins
-00016e00: 7464 6174 6520 3d3d 206c 6174 6573 745f  tdate == latest_
-00016e10: 6d66 6461 7465 3a0a 2020 2020 2020 2020  mfdate:.        
-00016e20: 2020 2020 7265 7475 726e 2028 6e65 7443      return (netC
-00016e30: 6861 6e67 654d 4620 2b20 6e65 7443 6861  hangeMF + netCha
-00016e40: 6e67 6549 6e73 7429 0a20 2020 2020 2020  ngeInst).       
-00016e50: 2065 6c69 6620 6c61 7465 7374 5f6d 6664   elif latest_mfd
-00016e60: 6174 6520 3d3d 206c 6173 7444 6179 4c61  ate == lastDayLa
-00016e70: 7374 4d6f 6e74 683a 0a20 2020 2020 2020  stMonth:.       
-00016e80: 2020 2020 2072 6574 7572 6e20 6e65 7443       return netC
-00016e90: 6861 6e67 654d 460a 2020 2020 2020 2020  hangeMF.        
-00016ea0: 656c 6966 206c 6174 6573 745f 696e 7374  elif latest_inst
-00016eb0: 6461 7465 203d 3d20 6c61 7374 4461 794c  date == lastDayL
-00016ec0: 6173 744d 6f6e 7468 3a0a 2020 2020 2020  astMonth:.      
-00016ed0: 2020 2020 2020 7265 7475 726e 206e 6574        return net
-00016ee0: 4368 616e 6765 496e 7374 0a20 2020 2020  ChangeInst.     
-00016ef0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00016f00: 2020 2020 2023 2066 696e 6420 7468 6520       # find the 
-00016f10: 6c61 7465 7374 2064 6174 650a 2020 2020  latest date.    
-00016f20: 2020 2020 2020 2020 6966 206c 6174 6573          if lates
-00016f30: 745f 6d66 6461 7465 2069 7320 6e6f 7420  t_mfdate is not 
-00016f40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00016f50: 2020 2020 2020 6c61 7465 7374 5f6d 6664        latest_mfd
-00016f60: 6174 6520 3d20 504b 4461 7465 5574 696c  ate = PKDateUtil
-00016f70: 6974 6965 732e 6461 7465 4672 6f6d 596d  ities.dateFromYm
-00016f80: 6453 7472 696e 6728 6c61 7465 7374 5f6d  dString(latest_m
-00016f90: 6664 6174 652e 7370 6c69 7428 2254 2229  fdate.split("T")
-00016fa0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
-00016fb0: 2069 6620 6c61 7465 7374 5f69 6e73 7464   if latest_instd
-00016fc0: 6174 6520 6973 206e 6f74 204e 6f6e 653a  ate is not None:
-00016fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016fe0: 206c 6174 6573 745f 696e 7374 6461 7465   latest_instdate
-00016ff0: 203d 2050 4b44 6174 6555 7469 6c69 7469   = PKDateUtiliti
-00017000: 6573 2e64 6174 6546 726f 6d59 6d64 5374  es.dateFromYmdSt
-00017010: 7269 6e67 286c 6174 6573 745f 696e 7374  ring(latest_inst
-00017020: 6461 7465 2e73 706c 6974 2822 5422 295b  date.split("T")[
-00017030: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
-00017040: 7265 7475 726e 206e 6574 4368 616e 6765  return netChange
-00017050: 4d46 2069 6620 2828 6c61 7465 7374 5f6d  MF if ((latest_m
-00017060: 6664 6174 6520 6973 206e 6f74 204e 6f6e  fdate is not Non
-00017070: 6529 2061 6e64 206c 6174 6573 745f 6d66  e) and latest_mf
-00017080: 6461 7465 203e 2028 6c61 7465 7374 5f69  date > (latest_i
-00017090: 6e73 7464 6174 6520 6966 206c 6174 6573  nstdate if lates
-000170a0: 745f 696e 7374 6461 7465 2069 7320 6e6f  t_instdate is no
-000170b0: 7420 4e6f 6e65 2065 6c73 6520 286c 6174  t None else (lat
-000170c0: 6573 745f 6d66 6461 7465 202d 2064 6174  est_mfdate - dat
-000170d0: 6574 696d 652e 7469 6d65 6465 6c74 6128  etime.timedelta(
-000170e0: 3129 2929 2920 656c 7365 206e 6574 4368  1)))) else netCh
-000170f0: 616e 6765 496e 7374 0a0a 2020 2020 6465  angeInst..    de
-00017100: 6620 6765 7446 7265 7368 4d46 4953 7461  f getFreshMFISta
-00017110: 7475 7328 7365 6c66 2c20 7374 6f63 6b2c  tus(self, stock,
-00017120: 6578 6368 616e 6765 4e61 6d65 3d22 494e  exchangeName="IN
-00017130: 4449 4122 293a 0a20 2020 2020 2020 2063  DIA"):.        c
-00017140: 6861 6e67 6553 7461 7475 7344 6174 614d  hangeStatusDataM
-00017150: 4620 3d20 4e6f 6e65 0a20 2020 2020 2020  F = None.       
-00017160: 2063 6861 6e67 6553 7461 7475 7344 6174   changeStatusDat
-00017170: 6149 6e73 7420 3d20 4e6f 6e65 0a20 2020  aInst = None.   
-00017180: 2020 2020 206e 6574 4368 616e 6765 4d46       netChangeMF
-00017190: 203d 2030 0a20 2020 2020 2020 206e 6574   = 0.        net
-000171a0: 4368 616e 6765 496e 7374 203d 2030 0a20  ChangeInst = 0. 
-000171b0: 2020 2020 2020 206c 6174 6573 745f 6d66         latest_mf
-000171c0: 6461 7465 203d 204e 6f6e 650a 2020 2020  date = None.    
-000171d0: 2020 2020 6c61 7465 7374 5f69 6e73 7464      latest_instd
-000171e0: 6174 6520 3d20 4e6f 6e65 0a20 2020 2020  ate = None.     
-000171f0: 2020 2073 6563 7572 6974 7920 3d20 4e6f     security = No
-00017200: 6e65 0a20 2020 2020 2020 2074 7279 3a0a  ne.        try:.
-00017210: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00017220: 2053 7570 7072 6573 734f 7574 7075 7428   SuppressOutput(
-00017230: 7375 7070 7265 7373 5f73 7464 6572 723d  suppress_stderr=
-00017240: 5472 7565 2c20 7375 7070 7265 7373 5f73  True, suppress_s
-00017250: 7464 6f75 743d 5472 7565 293a 0a20 2020  tdout=True):.   
-00017260: 2020 2020 2020 2020 2020 2020 2073 6563               sec
-00017270: 7572 6974 7920 3d20 5374 6f63 6b28 7374  urity = Stock(st
-00017280: 6f63 6b2c 6578 6368 616e 6765 3d65 7863  ock,exchange=exc
-00017290: 6861 6e67 654e 616d 6529 0a20 2020 2020  hangeName).     
-000172a0: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
-000172b0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-000172c0: 2020 2320 5765 2064 6964 206e 6f74 2066    # We did not f
-000172d0: 696e 6420 7468 6520 7374 6f63 6b3f 2049  ind the stock? I
-000172e0: 7427 7320 6f6b 6179 2e20 4d6f 7665 206f  t's okay. Move o
-000172f0: 6e20 746f 2074 6865 206e 6578 7420 6f6e  n to the next on
-00017300: 652e 0a20 2020 2020 2020 2020 2020 2070  e..            p
-00017310: 6173 730a 2020 2020 2020 2020 6578 6365  ass.        exce
-00017320: 7074 2028 5469 6d65 6f75 7445 7272 6f72  pt (TimeoutError
-00017330: 2c20 436f 6e6e 6563 7469 6f6e 4572 726f  , ConnectionErro
-00017340: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
-00017350: 2020 2020 2073 656c 662e 6465 6661 756c       self.defaul
-00017360: 745f 6c6f 6767 6572 2e64 6562 7567 2865  t_logger.debug(e
-00017370: 2c20 6578 635f 696e 666f 3d54 7275 6529  , exc_info=True)
-00017380: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-00017390: 730a 2020 2020 2020 2020 6578 6365 7074  s.        except
-000173a0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-000173b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000173c0: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
-000173d0: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
-000173e0: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
-000173f0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00017400: 2020 6966 2073 6563 7572 6974 7920 6973    if security is
-00017410: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00017420: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00017430: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00017440: 2053 7570 7072 6573 734f 7574 7075 7428   SuppressOutput(
-00017450: 7375 7070 7265 7373 5f73 7464 6572 723d  suppress_stderr=
-00017460: 5472 7565 2c20 7375 7070 7265 7373 5f73  True, suppress_s
-00017470: 7464 6f75 743d 5472 7565 293a 0a20 2020  tdout=True):.   
-00017480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017490: 2063 6861 6e67 6553 7461 7475 7352 6f77   changeStatusRow
-000174a0: 734d 4620 3d20 7365 6375 7269 7479 2e6d  sMF = security.m
-000174b0: 7574 7561 6c46 756e 644f 776e 6572 7368  utualFundOwnersh
-000174c0: 6970 2874 6f70 3d35 290a 2020 2020 2020  ip(top=5).      
-000174d0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-000174e0: 616e 6765 5374 6174 7573 526f 7773 496e  angeStatusRowsIn
-000174f0: 7374 203d 2073 6563 7572 6974 792e 696e  st = security.in
-00017500: 7374 6974 7574 696f 6e4f 776e 6572 7368  stitutionOwnersh
-00017510: 6970 2874 6f70 3d35 290a 2020 2020 2020  ip(top=5).      
-00017520: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00017530: 616e 6765 5374 6174 7573 4461 7461 4d46  angeStatusDataMF
-00017540: 203d 2073 6563 7572 6974 792e 6d75 7475   = security.mutu
-00017550: 616c 4675 6e64 4649 4943 6861 6e67 6544  alFundFIIChangeD
-00017560: 6174 6128 6368 616e 6765 5374 6174 7573  ata(changeStatus
-00017570: 526f 7773 4d46 290a 2020 2020 2020 2020  RowsMF).        
-00017580: 2020 2020 2020 2020 2020 2020 6368 616e              chan
-00017590: 6765 5374 6174 7573 4461 7461 496e 7374  geStatusDataInst
-000175a0: 203d 2073 6563 7572 6974 792e 6d75 7475   = security.mutu
-000175b0: 616c 4675 6e64 4649 4943 6861 6e67 6544  alFundFIIChangeD
-000175c0: 6174 6128 6368 616e 6765 5374 6174 7573  ata(changeStatus
-000175d0: 526f 7773 496e 7374 290a 2020 2020 2020  RowsInst).      
-000175e0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-000175f0: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-00017600: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00017610: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
-00017620: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
-00017630: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
-00017640: 2020 2020 2020 2020 2023 2054 7970 6545           # TypeE
-00017650: 7272 6f72 206f 7220 436f 6e6e 6563 7469  rror or Connecti
-00017660: 6f6e 4572 726f 7220 6265 6361 7573 6520  onError because 
-00017670: 7765 2063 6f75 6c64 206e 6f74 2066 696e  we could not fin
-00017680: 6420 7468 6520 7374 6f63 6b20 6f72 204d  d the stock or M
-00017690: 4649 2064 6174 6120 6973 6e27 7420 6176  FI data isn't av
-000176a0: 6169 6c61 626c 653f 0a20 2020 2020 2020  ailable?.       
-000176b0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-000176c0: 2020 2020 2020 2020 2020 6c61 7374 4461            lastDa
-000176d0: 794c 6173 744d 6f6e 7468 203d 2050 4b44  yLastMonth = PKD
-000176e0: 6174 6555 7469 6c69 7469 6573 2e6c 6173  ateUtilities.las
-000176f0: 745f 6461 795f 6f66 5f70 7265 7669 6f75  t_day_of_previou
-00017700: 735f 6d6f 6e74 6828 504b 4461 7465 5574  s_month(PKDateUt
-00017710: 696c 6974 6965 732e 6375 7272 656e 7444  ilities.currentD
-00017720: 6174 6554 696d 6528 2929 0a20 2020 2020  ateTime()).     
-00017730: 2020 2020 2020 206c 6173 7444 6179 4c61         lastDayLa
-00017740: 7374 4d6f 6e74 6820 3d20 6c61 7374 4461  stMonth = lastDa
-00017750: 794c 6173 744d 6f6e 7468 2e73 7472 6674  yLastMonth.strft
-00017760: 696d 6528 2225 592d 256d 2d25 6454 3030  ime("%Y-%m-%dT00
-00017770: 3a30 303a 3030 2e30 3030 2229 0a20 2020  :00:00.000").   
-00017780: 2020 2020 2020 2020 2069 6620 6368 616e           if chan
-00017790: 6765 5374 6174 7573 4461 7461 4d46 2069  geStatusDataMF i
-000177a0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206c  s not None and l
-000177b0: 656e 2863 6861 6e67 6553 7461 7475 7344  en(changeStatusD
-000177c0: 6174 614d 4629 203e 2030 3a0a 2020 2020  ataMF) > 0:.    
-000177d0: 2020 2020 2020 2020 2020 2020 6466 5f67              df_g
-000177e0: 726f 7570 6564 4d46 203d 2063 6861 6e67  roupedMF = chang
-000177f0: 6553 7461 7475 7344 6174 614d 462e 6772  eStatusDataMF.gr
-00017800: 6f75 7062 7928 2264 6174 6522 2c20 736f  oupby("date", so
-00017810: 7274 3d46 616c 7365 290a 2020 2020 2020  rt=False).      
-00017820: 2020 2020 2020 2020 2020 666f 7220 6d66            for mf
-00017830: 6461 7465 2c20 6466 5f67 726f 7570 4d46  date, df_groupMF
-00017840: 2069 6e20 6466 5f67 726f 7570 6564 4d46   in df_groupedMF
-00017850: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017860: 2020 2020 2020 6e65 7443 6861 6e67 654d        netChangeM
-00017870: 4620 3d20 6466 5f67 726f 7570 4d46 5b22  F = df_groupMF["
-00017880: 6368 616e 6765 416d 6f75 6e74 225d 2e73  changeAmount"].s
-00017890: 756d 2829 0a20 2020 2020 2020 2020 2020  um().           
-000178a0: 2020 2020 2020 2020 206c 6174 6573 745f           latest_
-000178b0: 6d66 6461 7465 203d 206d 6664 6174 650a  mfdate = mfdate.
-000178c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178d0: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-000178e0: 2020 2020 2020 6966 2063 6861 6e67 6553        if changeS
-000178f0: 7461 7475 7344 6174 6149 6e73 7420 6973  tatusDataInst is
-00017900: 206e 6f74 204e 6f6e 6520 616e 6420 6c65   not None and le
-00017910: 6e28 6368 616e 6765 5374 6174 7573 4461  n(changeStatusDa
-00017920: 7461 496e 7374 2920 3e20 303a 0a20 2020  taInst) > 0:.   
-00017930: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-00017940: 6772 6f75 7065 6449 6e73 7420 3d20 6368  groupedInst = ch
-00017950: 616e 6765 5374 6174 7573 4461 7461 496e  angeStatusDataIn
-00017960: 7374 2e67 726f 7570 6279 2822 6461 7465  st.groupby("date
-00017970: 222c 2073 6f72 743d 4661 6c73 6529 0a20  ", sort=False). 
-00017980: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00017990: 6f72 2069 6e73 7464 6174 652c 2064 665f  or instdate, df_
-000179a0: 6772 6f75 7049 6e73 7420 696e 2064 665f  groupInst in df_
-000179b0: 6772 6f75 7065 6449 6e73 743a 0a20 2020  groupedInst:.   
-000179c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179d0: 2069 6620 286c 6174 6573 745f 6d66 6461   if (latest_mfda
-000179e0: 7465 2069 7320 6e6f 7420 4e6f 6e65 2061  te is not None a
-000179f0: 6e64 206c 6174 6573 745f 6d66 6461 7465  nd latest_mfdate
-00017a00: 203d 3d20 696e 7374 6461 7465 2920 6f72   == instdate) or
-00017a10: 2028 6c61 7465 7374 5f6d 6664 6174 6520   (latest_mfdate 
-00017a20: 6973 204e 6f6e 6529 206f 7220 2869 6e73  is None) or (ins
-00017a30: 7464 6174 6520 3d3d 206c 6173 7444 6179  tdate == lastDay
-00017a40: 4c61 7374 4d6f 6e74 6829 3a0a 2020 2020  LastMonth):.    
-00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a60: 2020 2020 6e65 7443 6861 6e67 6549 6e73      netChangeIns
-00017a70: 7420 3d20 6466 5f67 726f 7570 496e 7374  t = df_groupInst
-00017a80: 5b22 6368 616e 6765 416d 6f75 6e74 225d  ["changeAmount"]
-00017a90: 2e73 756d 2829 0a20 2020 2020 2020 2020  .sum().         
-00017aa0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00017ab0: 6174 6573 745f 696e 7374 6461 7465 203d  atest_instdate =
-00017ac0: 2069 6e73 7464 6174 650a 2020 2020 2020   instdate.      
-00017ad0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00017ae0: 6561 6b0a 2020 2020 2020 2020 7265 7475  eak.        retu
-00017af0: 726e 206e 6574 4368 616e 6765 4d46 2c6e  rn netChangeMF,n
-00017b00: 6574 4368 616e 6765 496e 7374 2c6c 6174  etChangeInst,lat
-00017b10: 6573 745f 6d66 6461 7465 2c6c 6174 6573  est_mfdate,lates
-00017b20: 745f 696e 7374 6461 7465 0a0a 0a20 2020  t_instdate...   
-00017b30: 2064 6566 2067 6574 4e69 6674 7950 7265   def getNiftyPre
-00017b40: 6469 6374 696f 6e28 7365 6c66 2c20 6466  diction(self, df
-00017b50: 293a 0a20 2020 2020 2020 2069 6d70 6f72  ):.        impor
-00017b60: 7420 7761 726e 696e 6773 0a0a 2020 2020  t warnings..    
-00017b70: 2020 2020 7761 726e 696e 6773 2e66 696c      warnings.fil
-00017b80: 7465 7277 6172 6e69 6e67 7328 2269 676e  terwarnings("ign
-00017b90: 6f72 6522 290a 2020 2020 2020 2020 6461  ore").        da
-00017ba0: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
-00017bb0: 2020 2020 2020 206d 6f64 656c 2c20 706b         model, pk
-00017bc0: 6c20 3d20 5574 696c 6974 792e 746f 6f6c  l = Utility.tool
-00017bd0: 732e 6765 744e 6966 7479 4d6f 6465 6c28  s.getNiftyModel(
-00017be0: 290a 2020 2020 2020 2020 6966 206d 6f64  ).        if mod
-00017bf0: 656c 2069 7320 4e6f 6e65 206f 7220 706b  el is None or pk
-00017c00: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
-00017c10: 2020 2020 2020 2072 6574 7572 6e20 302c         return 0,
-00017c20: 2022 556e 6b6e 6f77 6e22 2c20 2255 6e6b   "Unknown", "Unk
-00017c30: 6e6f 776e 220a 2020 2020 2020 2020 7769  nown".        wi
-00017c40: 7468 2053 7570 7072 6573 734f 7574 7075  th SuppressOutpu
-00017c50: 7428 7375 7070 7265 7373 5f73 7464 6572  t(suppress_stder
-00017c60: 723d 5472 7565 2c20 7375 7070 7265 7373  r=True, suppress
-00017c70: 5f73 7464 6f75 743d 5472 7565 293a 0a20  _stdout=True):. 
-00017c80: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-00017c90: 3d20 6461 7461 5b70 6b6c 5b22 636f 6c75  = data[pkl["colu
-00017ca0: 6d6e 7322 5d5d 0a20 2020 2020 2020 2020  mns"]].         
-00017cb0: 2020 2023 2323 2076 3220 5072 6570 726f     ### v2 Prepro
-00017cc0: 6365 7373 696e 670a 2020 2020 2020 2020  cessing.        
-00017cd0: 2020 2020 6461 7461 5b22 4869 6768 225d      data["High"]
-00017ce0: 203d 2064 6174 615b 2248 6967 6822 5d2e   = data["High"].
-00017cf0: 7063 745f 6368 616e 6765 2829 202a 2031  pct_change() * 1
-00017d00: 3030 0a20 2020 2020 2020 2020 2020 2064  00.            d
-00017d10: 6174 615b 224c 6f77 225d 203d 2064 6174  ata["Low"] = dat
-00017d20: 615b 224c 6f77 225d 2e70 6374 5f63 6861  a["Low"].pct_cha
-00017d30: 6e67 6528 2920 2a20 3130 300a 2020 2020  nge() * 100.    
-00017d40: 2020 2020 2020 2020 6461 7461 5b22 4f70          data["Op
-00017d50: 656e 225d 203d 2064 6174 615b 224f 7065  en"] = data["Ope
-00017d60: 6e22 5d2e 7063 745f 6368 616e 6765 2829  n"].pct_change()
-00017d70: 202a 2031 3030 0a20 2020 2020 2020 2020   * 100.         
-00017d80: 2020 2064 6174 615b 2243 6c6f 7365 225d     data["Close"]
-00017d90: 203d 2064 6174 615b 2243 6c6f 7365 225d   = data["Close"]
-00017da0: 2e70 6374 5f63 6861 6e67 6528 2920 2a20  .pct_change() * 
-00017db0: 3130 300a 2020 2020 2020 2020 2020 2020  100.            
-00017dc0: 6461 7461 203d 2064 6174 612e 696c 6f63  data = data.iloc
-00017dd0: 5b2d 315d 0a20 2020 2020 2020 2020 2020  [-1].           
-00017de0: 2023 2323 0a20 2020 2020 2020 2020 2020   ###.           
-00017df0: 2064 6174 6120 3d20 706b 6c5b 2273 6361   data = pkl["sca
-00017e00: 6c65 7222 5d2e 7472 616e 7366 6f72 6d28  ler"].transform(
-00017e10: 5b64 6174 615d 290a 2020 2020 2020 2020  [data]).        
-00017e20: 2020 2020 7769 7468 2053 7570 7072 6573      with Suppres
-00017e30: 734f 7574 7075 7428 7375 7070 7265 7373  sOutput(suppress
-00017e40: 5f73 7464 6f75 743d 5472 7565 2c20 7375  _stdout=True, su
-00017e50: 7070 7265 7373 5f73 7464 6572 723d 5472  ppress_stderr=Tr
-00017e60: 7565 293a 0a20 2020 2020 2020 2020 2020  ue):.           
-00017e70: 2020 2020 2070 7265 6420 3d20 6d6f 6465       pred = mode
-00017e80: 6c2e 7072 6564 6963 7428 6461 7461 295b  l.predict(data)[
-00017e90: 305d 0a20 2020 2020 2020 2069 6620 7072  0].        if pr
-00017ea0: 6564 203e 2030 2e35 3a0a 2020 2020 2020  ed > 0.5:.      
-00017eb0: 2020 2020 2020 6f75 7454 6578 7420 3d20        outText = 
-00017ec0: 2242 4541 5249 5348 220a 2020 2020 2020  "BEARISH".      
-00017ed0: 2020 2020 2020 6f75 7420 3d20 280a 2020        out = (.  
-00017ee0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00017ef0: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
-00017f00: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-00017f10: 6f6c 6f72 5465 7874 2e46 4149 4c0a 2020  olorText.FAIL.  
-00017f20: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00017f30: 6f75 7454 6578 740a 2020 2020 2020 2020  outText.        
-00017f40: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-00017f50: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-00017f60: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-00017f70: 6578 742e 424f 4c44 0a20 2020 2020 2020  ext.BOLD.       
-00017f80: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00017f90: 2020 2073 7567 203d 2022 486f 6c64 2079     sug = "Hold y
-00017fa0: 6f75 7220 5368 6f72 7420 706f 7369 7469  our Short positi
-00017fb0: 6f6e 2122 0a20 2020 2020 2020 2065 6c73  on!".        els
-00017fc0: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-00017fd0: 7574 5465 7874 203d 2022 4255 4c4c 4953  utText = "BULLIS
-00017fe0: 4822 0a20 2020 2020 2020 2020 2020 206f  H".            o
-00017ff0: 7574 203d 2028 0a20 2020 2020 2020 2020  ut = (.         
-00018000: 2020 2020 2020 2063 6f6c 6f72 5465 7874         colorText
-00018010: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
-00018020: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-00018030: 742e 4752 4545 4e0a 2020 2020 2020 2020  t.GREEN.        
-00018040: 2020 2020 2020 2020 2b20 6f75 7454 6578          + outTex
-00018050: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00018060: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-00018070: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-00018080: 2020 2b20 636f 6c6f 7254 6578 742e 424f    + colorText.BO
-00018090: 4c44 0a20 2020 2020 2020 2020 2020 2029  LD.            )
-000180a0: 0a20 2020 2020 2020 2020 2020 2073 7567  .            sug
-000180b0: 203d 2022 5374 6179 2042 756c 6c69 7368   = "Stay Bullish
-000180c0: 2122 0a20 2020 2020 2020 2069 6620 504b  !".        if PK
-000180d0: 4461 7465 5574 696c 6974 6965 732e 6973  DateUtilities.is
-000180e0: 436c 6f73 696e 6748 6f75 7228 293a 0a20  ClosingHour():. 
-000180f0: 2020 2020 2020 2020 2020 204f 7574 7075             Outpu
-00018100: 7443 6f6e 7472 6f6c 7328 292e 7072 696e  tControls().prin
-00018110: 744f 7574 7075 7428 0a20 2020 2020 2020  tOutput(.       
-00018120: 2020 2020 2020 2020 2063 6f6c 6f72 5465           colorTe
-00018130: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
-00018140: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-00018150: 6578 742e 5741 524e 0a20 2020 2020 2020  ext.WARN.       
-00018160: 2020 2020 2020 2020 202b 2022 4e6f 7465           + "Note
-00018170: 3a20 5468 6520 4149 2070 7265 6469 6374  : The AI predict
-00018180: 696f 6e20 7368 6f75 6c64 2062 6520 6578  ion should be ex
-00018190: 6563 7574 6564 2041 6674 6572 2033 2050  ecuted After 3 P
-000181a0: 4d20 6f72 204e 6561 7220 746f 2043 6c6f  M or Near to Clo
-000181b0: 7369 6e67 2074 696d 6520 6173 2074 6865  sing time as the
-000181c0: 2050 7265 6469 6374 696f 6e20 4163 6375   Prediction Accu
-000181d0: 7261 6379 2069 7320 6261 7365 6420 6f6e  racy is based on
-000181e0: 2074 6865 2043 6c6f 7369 6e67 2070 7269   the Closing pri
-000181f0: 6365 2122 0a20 2020 2020 2020 2020 2020  ce!".           
-00018200: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-00018210: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-00018220: 2029 0a20 2020 2020 2020 2070 7265 6469   ).        predi
-00018230: 6374 696f 6e54 6578 7420 3d20 224d 6172  ctionText = "Mar
-00018240: 6b65 7420 6d61 7920 4f70 656e 207b 7d20  ket may Open {} 
-00018250: 6e65 7874 2064 6179 2120 7b7d 222e 666f  next day! {}".fo
-00018260: 726d 6174 286f 7574 2c20 7375 6729 0a20  rmat(out, sug). 
-00018270: 2020 2020 2020 2073 7472 656e 6774 6854         strengthT
-00018280: 6578 7420 3d20 2250 726f 6261 6269 6c69  ext = "Probabili
-00018290: 7479 2f53 7472 656e 6774 6820 6f66 2050  ty/Strength of P
-000182a0: 7265 6469 6374 696f 6e20 3d20 7b7d 2522  rediction = {}%"
-000182b0: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
-000182c0: 2020 2020 2055 7469 6c69 7479 2e74 6f6f       Utility.too
-000182d0: 6c73 2e67 6574 5369 676d 6f69 6443 6f6e  ls.getSigmoidCon
-000182e0: 6669 6465 6e63 6528 7072 6564 5b30 5d29  fidence(pred[0])
-000182f0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00018300: 2020 204f 7574 7075 7443 6f6e 7472 6f6c     OutputControl
-00018310: 7328 292e 7072 696e 744f 7574 7075 7428  s().printOutput(
-00018320: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00018330: 6f72 5465 7874 2e42 4f4c 440a 2020 2020  orText.BOLD.    
-00018340: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-00018350: 6578 742e 424c 5545 0a20 2020 2020 2020  ext.BLUE.       
-00018360: 2020 2020 202b 2022 5c6e 220a 2020 2020       + "\n".    
-00018370: 2020 2020 2020 2020 2b20 225b 2b5d 204e          + "[+] N
-00018380: 6966 7479 2041 4920 5072 6564 6963 7469  ifty AI Predicti
-00018390: 6f6e 202d 3e20 220a 2020 2020 2020 2020  on -> ".        
-000183a0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-000183b0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-000183c0: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
-000183d0: 0a20 2020 2020 2020 2020 2020 202b 2070  .            + p
-000183e0: 7265 6469 6374 696f 6e54 6578 740a 2020  redictionText.  
-000183f0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-00018400: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00018410: 2020 290a 2020 2020 2020 2020 4f75 7470    ).        Outp
-00018420: 7574 436f 6e74 726f 6c73 2829 2e70 7269  utControls().pri
-00018430: 6e74 4f75 7470 7574 280a 2020 2020 2020  ntOutput(.      
-00018440: 2020 2020 2020 636f 6c6f 7254 6578 742e        colorText.
-00018450: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
-00018460: 202b 2063 6f6c 6f72 5465 7874 2e42 4c55   + colorText.BLU
-00018470: 450a 2020 2020 2020 2020 2020 2020 2b20  E.            + 
-00018480: 225c 6e22 0a20 2020 2020 2020 2020 2020  "\n".           
-00018490: 202b 2022 5b2b 5d20 4e69 6674 7920 4149   + "[+] Nifty AI
-000184a0: 2050 7265 6469 6374 696f 6e20 2d3e 2022   Prediction -> "
-000184b0: 0a20 2020 2020 2020 2020 2020 202b 2063  .            + c
-000184c0: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-000184d0: 2020 2020 2020 2020 202b 2073 7472 656e           + stren
-000184e0: 6774 6854 6578 740a 2020 2020 2020 2020  gthText.        
-000184f0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00018500: 6e20 7072 6564 2c20 7072 6564 6963 7469  n pred, predicti
-00018510: 6f6e 5465 7874 2e72 6570 6c61 6365 286f  onText.replace(o
-00018520: 7574 2c20 6f75 7454 6578 7429 2c20 7374  ut, outText), st
-00018530: 7265 6e67 7468 5465 7874 0a0a 2020 2020  rengthText..    
-00018540: 6465 6620 6d6f 6e69 746f 7246 6976 6545  def monitorFiveE
-00018550: 6d61 2873 656c 662c 2066 6574 6368 6572  ma(self, fetcher
-00018560: 2c20 7265 7375 6c74 5f64 662c 206c 6173  , result_df, las
-00018570: 745f 7369 676e 616c 2c20 7269 736b 5f72  t_signal, risk_r
-00018580: 6577 6172 643d 3329 3a0a 2020 2020 2020  eward=3):.      
-00018590: 2020 636f 6c5f 6e61 6d65 7320 3d20 5b22    col_names = ["
-000185a0: 4869 6768 222c 2022 4c6f 7722 2c20 2243  High", "Low", "C
-000185b0: 6c6f 7365 222c 2022 3545 4d41 225d 0a20  lose", "5EMA"]. 
-000185c0: 2020 2020 2020 2064 6174 615f 6c69 7374         data_list
-000185d0: 203d 205b 226e 6966 7479 5f62 7579 222c   = ["nifty_buy",
-000185e0: 2022 6261 6e6b 6e69 6674 795f 6275 7922   "banknifty_buy"
-000185f0: 2c20 226e 6966 7479 5f73 656c 6c22 2c20  , "nifty_sell", 
-00018600: 2262 616e 6b6e 6966 7479 5f73 656c 6c22  "banknifty_sell"
-00018610: 5d0a 0a20 2020 2020 2020 2064 6174 615f  ]..        data_
-00018620: 7475 706c 6520 3d20 6665 7463 6865 722e  tuple = fetcher.
-00018630: 6665 7463 6846 6976 6545 6d61 4461 7461  fetchFiveEmaData
-00018640: 2829 0a20 2020 2020 2020 2066 6f72 2063  ().        for c
-00018650: 6e74 2069 6e20 7261 6e67 6528 6c65 6e28  nt in range(len(
-00018660: 6461 7461 5f74 7570 6c65 2929 3a0a 2020  data_tuple)):.  
-00018670: 2020 2020 2020 2020 2020 6420 3d20 6461            d = da
-00018680: 7461 5f74 7570 6c65 5b63 6e74 5d0a 2020  ta_tuple[cnt].  
-00018690: 2020 2020 2020 2020 2020 645b 2235 454d            d["5EM
-000186a0: 4122 5d20 3d20 706b 7461 6c69 622e 454d  A"] = pktalib.EM
-000186b0: 4128 645b 2243 6c6f 7365 225d 2c20 7469  A(d["Close"], ti
-000186c0: 6d65 7065 7269 6f64 3d35 290a 2020 2020  meperiod=5).    
-000186d0: 2020 2020 2020 2020 6420 3d20 645b 636f          d = d[co
-000186e0: 6c5f 6e61 6d65 735d 0a20 2020 2020 2020  l_names].       
-000186f0: 2020 2020 2064 203d 2064 2e64 726f 706e       d = d.dropn
-00018700: 6128 292e 726f 756e 6428 3229 0a0a 2020  a().round(2)..  
-00018710: 2020 2020 2020 2020 2020 7769 7468 2053            with S
-00018720: 7570 7072 6573 734f 7574 7075 7428 7375  uppressOutput(su
-00018730: 7070 7265 7373 5f73 7464 6572 723d 5472  ppress_stderr=Tr
-00018740: 7565 2c20 7375 7070 7265 7373 5f73 7464  ue, suppress_std
-00018750: 6f75 743d 5472 7565 293a 0a20 2020 2020  out=True):.     
-00018760: 2020 2020 2020 2020 2020 2069 6620 2273             if "s
-00018770: 656c 6c22 2069 6e20 6461 7461 5f6c 6973  ell" in data_lis
-00018780: 745b 636e 745d 3a0a 2020 2020 2020 2020  t[cnt]:.        
-00018790: 2020 2020 2020 2020 2020 2020 7374 7265              stre
-000187a0: 6368 6564 203d 2064 5b28 642e 4c6f 7720  ched = d[(d.Low 
-000187b0: 3e20 645b 2235 454d 4122 5d29 2026 2028  > d["5EMA"]) & (
-000187c0: 642e 4c6f 7720 2d20 645b 2235 454d 4122  d.Low - d["5EMA"
-000187d0: 5d20 3e20 302e 3529 5d0a 2020 2020 2020  ] > 0.5)].      
-000187e0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-000187f0: 7265 6368 6564 5b22 534c 225d 203d 2073  reched["SL"] = s
-00018800: 7472 6563 6865 642e 4869 6768 0a20 2020  treched.High.   
-00018810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018820: 2076 616c 6964 6174 6520 3d20 645b 0a20   validate = d[. 
-00018830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018840: 2020 2020 2020 2028 642e 4c6f 772e 7368         (d.Low.sh
-00018850: 6966 7428 3129 203e 2064 5b22 3545 4d41  ift(1) > d["5EMA
-00018860: 225d 2e73 6869 6674 2831 2929 0a20 2020  "].shift(1)).   
-00018870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018880: 2020 2020 2026 2028 642e 4c6f 772e 7368       & (d.Low.sh
-00018890: 6966 7428 3129 202d 2064 5b22 3545 4d41  ift(1) - d["5EMA
-000188a0: 225d 2e73 6869 6674 2831 2920 3e20 302e  "].shift(1) > 0.
-000188b0: 3529 0a20 2020 2020 2020 2020 2020 2020  5).             
-000188c0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-000188d0: 2020 2020 2020 2020 2020 2020 206f 6c64               old
-000188e0: 5f69 6e64 6578 203d 2076 616c 6964 6174  _index = validat
-000188f0: 652e 696e 6465 780a 2020 2020 2020 2020  e.index.        
-00018900: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00018910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018920: 2020 6d61 736b 203d 2028 642e 4869 6768    mask = (d.High
-00018930: 203c 2064 5b22 3545 4d41 225d 2920 2620   < d["5EMA"]) & 
-00018940: 2864 5b22 3545 4d41 225d 202d 2064 2e48  (d["5EMA"] - d.H
-00018950: 6967 6820 3e20 302e 3529 2020 2320 4275  igh > 0.5)  # Bu
-00018960: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-00018970: 2020 2020 2020 7374 7265 6368 6564 203d        streched =
-00018980: 2064 5b6d 6173 6b5d 0a20 2020 2020 2020   d[mask].       
-00018990: 2020 2020 2020 2020 2020 2020 2073 7472               str
-000189a0: 6563 6865 645b 2253 4c22 5d20 3d20 7374  eched["SL"] = st
-000189b0: 7265 6368 6564 2e4c 6f77 0a20 2020 2020  reched.Low.     
-000189c0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000189d0: 616c 6964 6174 6520 3d20 642e 6c6f 635b  alidate = d.loc[
-000189e0: 6d61 736b 2e73 6869 6674 2831 292e 6669  mask.shift(1).fi
-000189f0: 6c6c 6e61 2846 616c 7365 295d 0a20 2020  llna(False)].   
-00018a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a10: 206f 6c64 5f69 6e64 6578 203d 2076 616c   old_index = val
-00018a20: 6964 6174 652e 696e 6465 780a 2020 2020  idate.index.    
-00018a30: 2020 2020 2020 2020 7467 7420 3d20 7064          tgt = pd
-00018a40: 2e44 6174 6146 7261 6d65 280a 2020 2020  .DataFrame(.    
-00018a50: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-00018a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a70: 2020 7661 6c69 6461 7465 2e43 6c6f 7365    validate.Close
-00018a80: 2e72 6573 6574 5f69 6e64 6578 2864 726f  .reset_index(dro
-00018a90: 703d 5472 7565 290a 2020 2020 2020 2020  p=True).        
-00018aa0: 2020 2020 2020 2020 2020 2020 2d20 280a              - (.
-00018ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ac0: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
-00018ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ae0: 2020 2020 2020 7374 7265 6368 6564 2e53        streched.S
-00018af0: 4c2e 7265 7365 745f 696e 6465 7828 6472  L.reset_index(dr
-00018b00: 6f70 3d54 7275 6529 0a20 2020 2020 2020  op=True).       
-00018b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b20: 2020 2020 202d 2076 616c 6964 6174 652e       - validate.
-00018b30: 436c 6f73 652e 7265 7365 745f 696e 6465  Close.reset_inde
-00018b40: 7828 6472 6f70 3d54 7275 6529 0a20 2020  x(drop=True).   
-00018b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b60: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00018b70: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00018b80: 2072 6973 6b5f 7265 7761 7264 0a20 2020   risk_reward.   
-00018b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ba0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00018bb0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-00018bc0: 2020 2020 2020 636f 6c75 6d6e 733d 5b22        columns=["
-00018bd0: 5461 7267 6574 225d 2c0a 2020 2020 2020  Target"],.      
-00018be0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00018bf0: 2020 2020 7661 6c69 6461 7465 203d 2070      validate = p
-00018c00: 642e 636f 6e63 6174 280a 2020 2020 2020  d.concat(.      
-00018c10: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
-00018c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c30: 7661 6c69 6461 7465 2e72 6573 6574 5f69  validate.reset_i
-00018c40: 6e64 6578 2864 726f 703d 5472 7565 292c  ndex(drop=True),
-00018c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018c60: 2020 2020 2073 7472 6563 6865 645b 2253       streched["S
-00018c70: 4c22 5d2e 7265 7365 745f 696e 6465 7828  L"].reset_index(
-00018c80: 6472 6f70 3d54 7275 6529 2c0a 2020 2020  drop=True),.    
-00018c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ca0: 7467 742c 0a20 2020 2020 2020 2020 2020  tgt,.           
-00018cb0: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
-00018cc0: 2020 2020 2020 2020 6178 6973 3d31 2c0a          axis=1,.
-00018cd0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00018ce0: 2020 2020 2020 2020 2020 7661 6c69 6461            valida
-00018cf0: 7465 203d 2076 616c 6964 6174 652e 7461  te = validate.ta
-00018d00: 696c 286c 656e 286f 6c64 5f69 6e64 6578  il(len(old_index
-00018d10: 2929 0a20 2020 2020 2020 2020 2020 2076  )).            v
-00018d20: 616c 6964 6174 6520 3d20 7661 6c69 6461  alidate = valida
-00018d30: 7465 2e73 6574 5f69 6e64 6578 286f 6c64  te.set_index(old
-00018d40: 5f69 6e64 6578 290a 2020 2020 2020 2020  _index).        
-00018d50: 2020 2020 6966 2022 7365 6c6c 2220 696e      if "sell" in
-00018d60: 2064 6174 615f 6c69 7374 5b63 6e74 5d3a   data_list[cnt]:
+000116f0: 3330 2729 2e74 6f5f 6461 7465 7469 6d65  30').to_datetime
+00011700: 3634 2829 5d0a 2020 2020 2020 2020 2020  64()].          
+00011710: 2020 2320 6272 6f6b 6572 5371 724f 6666    # brokerSqrOff
+00011720: 7469 6d65 203d 2070 642e 746f 5f64 6174  time = pd.to_dat
+00011730: 6574 696d 6528 6627 7b50 4b44 6174 6555  etime(f'{PKDateU
+00011740: 7469 6c69 7469 6573 2e74 7261 6469 6e67  tilities.trading
+00011750: 4461 7465 2829 2e73 7472 6674 696d 6528  Date().strftime(
+00011760: 6622 2559 2d25 6d2d 2564 2229 7d20 3135  f"%Y-%m-%d")} 15
+00011770: 3a31 343a 3030 2b30 353a 3330 2729 2e74  :14:00+05:30').t
+00011780: 6f5f 6461 7465 7469 6d65 3634 2829 0a20  o_datetime64(). 
+00011790: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+000117a0: 2020 2020 2020 2020 2020 2064 6966 665f             diff_
+000117b0: 6466 203d 2064 6966 665f 6466 5b64 6966  df = diff_df[dif
+000117c0: 665f 6466 2e69 6e64 6578 203e 3d20 2070  f_df.index >=  p
+000117d0: 642e 746f 5f64 6174 6574 696d 6528 6627  d.to_datetime(f'
+000117e0: 7b50 4b44 6174 6555 7469 6c69 7469 6573  {PKDateUtilities
+000117f0: 2e74 7261 6469 6e67 4461 7465 2829 2e73  .tradingDate().s
+00011800: 7472 6674 696d 6528 6622 2559 2d25 6d2d  trftime(f"%Y-%m-
+00011810: 2564 2229 7d20 3039 3a7b 3135 2b73 656c  %d")} 09:{15+sel
+00011820: 662e 636f 6e66 6967 4d61 6e61 6765 722e  f.configManager.
+00011830: 6d6f 726e 696e 6761 6e61 6c79 7369 7363  morninganalysisc
+00011840: 616e 646c 656e 756d 6265 7220 2b20 327d  andlenumber + 2}
+00011850: 3a30 302b 3035 3a33 3027 2c20 7574 633d  :00+05:30', utc=
+00011860: 5472 7565 295d 0a20 2020 2020 2020 2020  True)].         
+00011870: 2020 2023 2062 726f 6b65 7253 7172 4f66     # brokerSqrOf
+00011880: 6674 696d 6520 3d20 7064 2e74 6f5f 6461  ftime = pd.to_da
+00011890: 7465 7469 6d65 2866 277b 504b 4461 7465  tetime(f'{PKDate
+000118a0: 5574 696c 6974 6965 732e 7472 6164 696e  Utilities.tradin
+000118b0: 6744 6174 6528 292e 7374 7266 7469 6d65  gDate().strftime
+000118c0: 2866 2225 592d 256d 2d25 6422 297d 2031  (f"%Y-%m-%d")} 1
+000118d0: 353a 3134 3a30 302b 3035 3a33 3027 2c20  5:14:00+05:30', 
+000118e0: 7574 633d 5472 7565 290a 2020 2020 2020  utc=True).      
+000118f0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00011900: 2020 2069 6e64 6578 203d 206c 656e 2864     index = len(d
+00011910: 6966 665f 6466 290a 2020 2020 2020 2020  iff_df).        
+00011920: 6372 6f73 734f 7665 7220 3d20 300a 2020  crossOver = 0.  
+00011930: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+00011940: 204c 6f6f 7020 756e 7469 6c20 7765 2776   Loop until we'v
+00011950: 6520 666f 756e 6420 7468 6520 6e74 6820  e found the nth 
+00011960: 6372 6f73 736f 7665 7220 666f 7220 4d41  crossover for MA
+00011970: 4344 206f 7220 7765 2776 6520 7265 6163  CD or we've reac
+00011980: 6865 6420 7468 6520 6c61 7374 2070 6f69  hed the last poi
+00011990: 6e74 2069 6e20 7469 6d65 0a20 2020 2020  nt in time.     
+000119a0: 2020 2077 6869 6c65 2028 6372 6f73 734f     while (crossO
+000119b0: 7665 7220 3c20 6e74 6843 726f 7373 6f76  ver < nthCrossov
+000119c0: 6572 2061 6e64 2069 6e64 6578 203e 3d30  er and index >=0
+000119d0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+000119e0: 6620 6469 6666 5f64 665b 2264 6966 6622  f diff_df["diff"
+000119f0: 5d5b 696e 6465 782d 315d 203c 2030 3a20  ][index-1] < 0: 
+00011a00: 2320 5369 676e 616c 206c 696e 6520 6861  # Signal line ha
+00011a10: 7320 6e6f 7420 6372 6f73 7365 6420 7965  s not crossed ye
+00011a20: 7420 616e 6420 6973 2062 656c 6f77 2074  t and is below t
+00011a30: 6865 207a 6572 6f20 6c69 6e65 0a20 2020  he zero line.   
+00011a40: 2020 2020 2020 2020 2020 2020 2077 6869               whi
+00011a50: 6c65 2828 6469 6666 5f64 665b 2264 6966  le((diff_df["dif
+00011a60: 6622 5d5b 696e 6465 782d 315d 203c 2030  f"][index-1] < 0
+00011a70: 2061 6e64 2069 6e64 6578 203e 3d30 2929   and index >=0))
+00011a80: 3a20 2320 616e 6420 6469 6666 5f64 662e  : # and diff_df.
+00011a90: 696e 6465 7820 3c3d 2062 726f 6b65 7253  index <= brokerS
+00011aa0: 7172 4f66 6674 696d 6529 3a20 2320 6f72  qrOfftime): # or
+00011ab0: 2064 6966 665f 6466 5b22 7273 6922 5d5b   diff_df["rsi"][
+00011ac0: 696e 6465 782d 315d 203c 3d20 6d69 6e52  index-1] <= minR
+00011ad0: 5349 293a 0a20 2020 2020 2020 2020 2020  SI):.           
+00011ae0: 2020 2020 2020 2020 2023 204c 6f6f 7020           # Loop 
+00011af0: 7768 696c 6520 5369 676e 616c 206c 696e  while Signal lin
+00011b00: 6520 6861 7320 6e6f 7420 6372 6f73 7365  e has not crosse
+00011b10: 6420 7965 7420 616e 6420 6973 2062 656c  d yet and is bel
+00011b20: 6f77 2074 6865 207a 6572 6f20 6c69 6e65  ow the zero line
+00011b30: 2061 6e64 2077 6527 7665 206e 6f74 2072   and we've not r
+00011b40: 6561 6368 6564 2074 6865 206c 6173 7420  eached the last 
+00011b50: 706f 696e 740a 2020 2020 2020 2020 2020  point.          
+00011b60: 2020 2020 2020 2020 2020 696e 6465 7820            index 
+00011b70: 2d3d 2031 0a20 2020 2020 2020 2020 2020  -= 1.           
+00011b80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00011b90: 2020 2020 2020 2077 6869 6c65 2828 6469         while((di
+00011ba0: 6666 5f64 665b 2264 6966 6622 5d5b 696e  ff_df["diff"][in
+00011bb0: 6465 782d 315d 203e 3d20 3020 616e 6420  dex-1] >= 0 and 
+00011bc0: 696e 6465 7820 3e3d 3029 293a 2023 2061  index >=0)): # a
+00011bd0: 6e64 2064 6966 665f 6466 2e69 6e64 6578  nd diff_df.index
+00011be0: 203c 3d20 6272 6f6b 6572 5371 724f 6666   <= brokerSqrOff
+00011bf0: 7469 6d65 293a 2023 206f 7220 6469 6666  time): # or diff
+00011c00: 5f64 665b 2272 7369 225d 5b69 6e64 6578  _df["rsi"][index
+00011c10: 2d31 5d20 3c3d 206d 696e 5253 4929 3a0a  -1] <= minRSI):.
+00011c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c30: 2020 2020 2320 4c6f 6f70 2075 6e74 696c      # Loop until
+00011c40: 2073 6967 6e61 6c20 6c69 6e65 2068 6173   signal line has
+00011c50: 206e 6f74 2063 726f 7373 6564 2079 6574   not crossed yet
+00011c60: 2061 6e64 2069 7320 6162 6f76 6520 7468   and is above th
+00011c70: 6520 7a65 726f 206c 696e 650a 2020 2020  e zero line.    
+00011c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c90: 696e 6465 7820 2d3d 2031 0a20 2020 2020  index -= 1.     
+00011ca0: 2020 2020 2020 2063 726f 7373 4f76 6572         crossOver
+00011cb0: 202b 3d20 310a 2020 2020 2020 2020 7473   += 1.        ts
+00011cc0: 203d 2064 6966 665f 6466 2e74 6169 6c28   = diff_df.tail(
+00011cd0: 6c65 6e28 6469 6666 5f64 6629 2d69 6e64  len(diff_df)-ind
+00011ce0: 6578 202b 3129 2e68 6561 6428 3129 2e69  ex +1).head(1).i
+00011cf0: 6e64 6578 5b2d 315d 0a20 2020 2020 2020  ndex[-1].       
+00011d00: 2072 6574 7572 6e20 7473 2c20 6461 7461   return ts, data
+00011d10: 5b64 6174 612e 696e 6465 7820 3d3d 2074  [data.index == t
+00011d20: 735d 2023 6466 2e68 6561 6428 6c65 6e28  s] #df.head(len(
+00011d30: 6466 2920 2d69 6e64 6578 202b 3129 2e74  df) -index +1).t
+00011d40: 6169 6c28 3129 0a20 2020 200a 2020 2020  ail(1).    .    
+00011d50: 2320 4669 6e64 2073 746f 636b 2073 686f  # Find stock sho
+00011d60: 7769 6e67 2052 5349 2063 726f 7373 696e  wing RSI crossin
+00011d70: 6720 7769 7468 2052 5349 2039 2053 4d41  g with RSI 9 SMA
+00011d80: 0a20 2020 2064 6566 2066 696e 6452 5349  .    def findRSI
+00011d90: 4372 6f73 7369 6e67 4d41 2873 656c 662c  CrossingMA(self,
+00011da0: 2064 662c 2073 6372 6565 6e44 6963 742c   df, screenDict,
+00011db0: 2073 6176 6544 6963 742c 6c6f 6f6b 466f   saveDict,lookFo
+00011dc0: 723d 312c 206d 614c 656e 6774 683d 392c  r=1, maLength=9,
+00011dd0: 2072 7369 4b65 793d 2252 5349 2229 3a0a   rsiKey="RSI"):.
+00011de0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+00011df0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+00011e00: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00011e10: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00011e20: 2020 2020 2020 2020 6966 2072 7369 4b65          if rsiKe
+00011e30: 7920 6e6f 7420 696e 2064 662e 636f 6c75  y not in df.colu
+00011e40: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
+00011e50: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00011e60: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
+00011e70: 636f 7079 2829 0a20 2020 2020 2020 2064  copy().        d
+00011e80: 6174 6120 3d20 6461 7461 5b3a 3a2d 315d  ata = data[::-1]
+00011e90: 0a20 2020 2020 2020 206d 6152 7369 203d  .        maRsi =
+00011ea0: 2070 6b74 616c 6962 2e4d 4128 6461 7461   pktalib.MA(data
+00011eb0: 5b72 7369 4b65 795d 2c20 7469 6d65 7065  [rsiKey], timepe
+00011ec0: 7269 6f64 3d6d 614c 656e 6774 6829 0a20  riod=maLength). 
+00011ed0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00011ee0: 7461 5b3a 3a2d 315d 2e68 6561 6428 3329  ta[::-1].head(3)
+00011ef0: 0a20 2020 2020 2020 206d 6152 7369 203d  .        maRsi =
+00011f00: 206d 6152 7369 5b3a 3a2d 315d 2e68 6561   maRsi[::-1].hea
+00011f10: 6428 3329 0a20 2020 2020 2020 2073 6176  d(3).        sav
+00011f20: 6564 203d 2073 656c 662e 6669 6e64 4375  ed = self.findCu
+00011f30: 7272 656e 7453 6176 6564 5661 6c75 6528  rrentSavedValue(
+00011f40: 7363 7265 656e 4469 6374 2c73 6176 6544  screenDict,saveD
+00011f50: 6963 742c 2254 7265 6e64 2229 0a20 2020  ict,"Trend").   
+00011f60: 2020 2020 2069 6620 6c6f 6f6b 466f 7220       if lookFor 
+00011f70: 696e 205b 312c 335d 2061 6e64 206d 6152  in [1,3] and maR
+00011f80: 7369 2e69 6c6f 635b 305d 203c 3d20 6461  si.iloc[0] <= da
+00011f90: 7461 5b72 7369 4b65 795d 2e69 6c6f 635b  ta[rsiKey].iloc[
+00011fa0: 305d 2061 6e64 206d 6152 7369 2e69 6c6f  0] and maRsi.ilo
+00011fb0: 635b 315d 203e 2064 6174 615b 7273 694b  c[1] > data[rsiK
+00011fc0: 6579 5d2e 696c 6f63 5b31 5d3a 0a20 2020  ey].iloc[1]:.   
+00011fd0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+00011fe0: 6963 745b 274d 412d 5369 676e 616c 275d  ict['MA-Signal']
+00011ff0: 203d 2073 6176 6564 5b30 5d20 2b20 636f   = saved[0] + co
+00012000: 6c6f 7254 6578 742e 424f 4c44 202b 2063  lorText.BOLD + c
+00012010: 6f6c 6f72 5465 7874 2e47 5245 454e 202b  olorText.GREEN +
+00012020: 2066 2752 5349 2d4d 412d 4275 7927 202b   f'RSI-MA-Buy' +
+00012030: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+00012040: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+00012050: 6963 745b 274d 412d 5369 676e 616c 275d  ict['MA-Signal']
+00012060: 203d 2073 6176 6564 5b31 5d20 2b20 6627   = saved[1] + f'
+00012070: 5253 492d 4d41 2d42 7579 270a 2020 2020  RSI-MA-Buy'.    
+00012080: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00012090: 7275 6520 6966 2028 7273 694b 6579 203d  rue if (rsiKey =
+000120a0: 3d20 2252 5349 6922 2920 656c 7365 2028  = "RSIi") else (
+000120b0: 7365 6c66 2e66 696e 6452 5349 4372 6f73  self.findRSICros
+000120c0: 7369 6e67 4d41 2864 662c 2073 6372 6565  singMA(df, scree
+000120d0: 6e44 6963 742c 2073 6176 6544 6963 742c  nDict, saveDict,
+000120e0: 6c6f 6f6b 466f 723d 6c6f 6f6b 466f 722c  lookFor=lookFor,
+000120f0: 206d 614c 656e 6774 683d 6d61 4c65 6e67   maLength=maLeng
+00012100: 7468 2c20 7273 694b 6579 3d22 5253 4969  th, rsiKey="RSIi
+00012110: 2229 206f 7220 5472 7565 290a 2020 2020  ") or True).    
+00012120: 2020 2020 656c 6966 206c 6f6f 6b46 6f72      elif lookFor
+00012130: 2069 6e20 5b32 2c33 5d20 616e 6420 6d61   in [2,3] and ma
+00012140: 5273 692e 696c 6f63 5b30 5d20 3e3d 2064  Rsi.iloc[0] >= d
+00012150: 6174 615b 7273 694b 6579 5d2e 696c 6f63  ata[rsiKey].iloc
+00012160: 5b30 5d20 616e 6420 6d61 5273 692e 696c  [0] and maRsi.il
+00012170: 6f63 5b31 5d20 3c20 6461 7461 5b72 7369  oc[1] < data[rsi
+00012180: 4b65 795d 2e69 6c6f 635b 315d 3a0a 2020  Key].iloc[1]:.  
+00012190: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+000121a0: 4469 6374 5b27 4d41 2d53 6967 6e61 6c27  Dict['MA-Signal'
+000121b0: 5d20 3d20 7361 7665 645b 305d 202b 2063  ] = saved[0] + c
+000121c0: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
+000121d0: 636f 6c6f 7254 6578 742e 4641 494c 202b  colorText.FAIL +
+000121e0: 2066 2752 5349 2d4d 412d 5365 6c6c 2720   f'RSI-MA-Sell' 
+000121f0: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+00012200: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00012210: 4469 6374 5b27 4d41 2d53 6967 6e61 6c27  Dict['MA-Signal'
+00012220: 5d20 3d20 7361 7665 645b 315d 202b 2066  ] = saved[1] + f
+00012230: 2752 5349 2d4d 412d 5365 6c6c 270a 2020  'RSI-MA-Sell'.  
+00012240: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00012250: 2054 7275 6520 6966 2028 7273 694b 6579   True if (rsiKey
+00012260: 203d 3d20 2252 5349 6922 2920 656c 7365   == "RSIi") else
+00012270: 2028 7365 6c66 2e66 696e 6452 5349 4372   (self.findRSICr
+00012280: 6f73 7369 6e67 4d41 2864 662c 2073 6372  ossingMA(df, scr
+00012290: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
+000122a0: 742c 6c6f 6f6b 466f 723d 6c6f 6f6b 466f  t,lookFor=lookFo
+000122b0: 722c 206d 614c 656e 6774 683d 6d61 4c65  r, maLength=maLe
+000122c0: 6e67 7468 2c20 7273 694b 6579 3d22 5253  ngth, rsiKey="RS
+000122d0: 4969 2229 206f 7220 5472 7565 290a 2020  Ii") or True).  
+000122e0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+000122f0: 7365 2069 6620 2872 7369 4b65 7920 3d3d  se if (rsiKey ==
+00012300: 2022 5253 4969 2229 2065 6c73 6520 2873   "RSIi") else (s
+00012310: 656c 662e 6669 6e64 5253 4943 726f 7373  elf.findRSICross
+00012320: 696e 674d 4128 6466 2c20 7363 7265 656e  ingMA(df, screen
+00012330: 4469 6374 2c20 7361 7665 4469 6374 2c6c  Dict, saveDict,l
+00012340: 6f6f 6b46 6f72 3d6c 6f6f 6b46 6f72 2c20  ookFor=lookFor, 
+00012350: 6d61 4c65 6e67 7468 3d6d 614c 656e 6774  maLength=maLengt
+00012360: 682c 2072 7369 4b65 793d 2252 5349 6922  h, rsiKey="RSIi"
+00012370: 2929 0a20 2020 200a 2020 2020 2320 4669  )).    .    # Fi
+00012380: 6e64 2073 746f 636b 7320 7769 7468 2072  nd stocks with r
+00012390: 6973 696e 6720 5253 4920 6672 6f6d 206c  ising RSI from l
+000123a0: 6f77 6572 206c 6576 656c 730a 2020 2020  ower levels.    
+000123b0: 6465 6620 6669 6e64 5269 7369 6e67 5253  def findRisingRS
+000123c0: 4928 7365 6c66 2c20 6466 2c20 7273 694b  I(self, df, rsiK
+000123d0: 6579 3d22 5253 4922 293a 0a20 2020 2020  ey="RSI"):.     
+000123e0: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
+000123f0: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
+00012400: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00012410: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00012420: 2020 2069 6620 7273 694b 6579 206e 6f74     if rsiKey not
+00012430: 2069 6e20 6466 2e63 6f6c 756d 6e73 3a0a   in df.columns:.
+00012440: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00012450: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00012460: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+00012470: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+00012480: 2064 6174 615b 3a3a 2d31 5d0a 2020 2020   data[::-1].    
+00012490: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+000124a0: 7461 696c 2833 290a 2020 2020 2020 2020  tail(3).        
+000124b0: 6966 206c 656e 2864 6174 6129 203c 2033  if len(data) < 3
+000124c0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000124d0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+000124e0: 2020 2064 6179 4d69 6e75 7332 5253 4920     dayMinus2RSI 
+000124f0: 3d20 6461 7461 5b22 5253 4922 5d2e 696c  = data["RSI"].il
+00012500: 6f63 5b30 5d0a 2020 2020 2020 2020 6461  oc[0].        da
+00012510: 794d 696e 7573 3152 5349 203d 2064 6174  yMinus1RSI = dat
+00012520: 615b 2252 5349 225d 2e69 6c6f 635b 315d  a["RSI"].iloc[1]
+00012530: 0a20 2020 2020 2020 2064 6179 5253 4920  .        dayRSI 
+00012540: 3d20 6461 7461 5b22 5253 4922 5d2e 696c  = data["RSI"].il
+00012550: 6f63 5b32 5d0a 2020 2020 2020 2020 7265  oc[2].        re
+00012560: 7475 726e 5661 6c75 6520 3d20 2864 6179  turnValue = (day
+00012570: 4d69 6e75 7332 5253 4920 3c3d 2033 3520  Minus2RSI <= 35 
+00012580: 616e 6420 6461 794d 696e 7573 3152 5349  and dayMinus1RSI
+00012590: 203e 2064 6179 4d69 6e75 7332 5253 4920   > dayMinus2RSI 
+000125a0: 616e 6420 6461 7952 5349 203e 2064 6179  and dayRSI > day
+000125b0: 4d69 6e75 7331 5253 4929 206f 7220 5c0a  Minus1RSI) or \.
+000125c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125d0: 2864 6179 4d69 6e75 7331 5253 4920 3c3d  (dayMinus1RSI <=
+000125e0: 2033 3520 616e 6420 6461 7952 5349 203e   35 and dayRSI >
+000125f0: 2064 6179 4d69 6e75 7331 5253 4929 0a20   dayMinus1RSI). 
+00012600: 2020 2020 2020 2069 6620 7273 694b 6579         if rsiKey
+00012610: 203d 3d20 2252 5349 223a 0a20 2020 2020   == "RSI":.     
+00012620: 2020 2020 2020 2072 6574 7572 6e56 616c         returnVal
+00012630: 7565 203d 2073 656c 662e 6669 6e64 5269  ue = self.findRi
+00012640: 7369 6e67 5253 4928 6466 2c20 7273 694b  singRSI(df, rsiK
+00012650: 6579 3d22 5253 4969 2229 206f 7220 7265  ey="RSIi") or re
+00012660: 7475 726e 5661 6c75 650a 2020 2020 2020  turnValue.      
+00012670: 2020 7265 7475 726e 2072 6574 7572 6e56    return returnV
+00012680: 616c 7565 0a0a 2020 2020 2340 6d65 6173  alue..    #@meas
+00012690: 7572 655f 7469 6d65 0a20 2020 2023 2046  ure_time.    # F
+000126a0: 696e 6420 6f75 7420 7472 656e 6420 666f  ind out trend fo
+000126b0: 7220 6461 7973 2074 6f20 6c6f 6f6b 6261  r days to lookba
+000126c0: 636b 0a20 2020 2064 6566 2066 696e 6454  ck.    def findT
+000126d0: 7265 6e64 2873 656c 662c 2064 662c 2073  rend(self, df, s
+000126e0: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
+000126f0: 6963 742c 2064 6179 7354 6f4c 6f6f 6b62  ict, daysToLookb
+00012700: 6163 6b3d 4e6f 6e65 2c20 7374 6f63 6b4e  ack=None, stockN
+00012710: 616d 653d 2222 293a 0a20 2020 2020 2020  ame=""):.       
+00012720: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
+00012730: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
+00012740: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00012750: 726e 2022 556e 6b6e 6f77 6e22 0a20 2020  rn "Unknown".   
+00012760: 2020 2020 2064 6174 6120 3d20 6466 2e63       data = df.c
+00012770: 6f70 7928 290a 2020 2020 2020 2020 6966  opy().        if
+00012780: 2064 6179 7354 6f4c 6f6f 6b62 6163 6b20   daysToLookback 
+00012790: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000127a0: 2020 2020 2064 6179 7354 6f4c 6f6f 6b62       daysToLookb
+000127b0: 6163 6b20 3d20 7365 6c66 2e63 6f6e 6669  ack = self.confi
+000127c0: 674d 616e 6167 6572 2e64 6179 7354 6f4c  gManager.daysToL
+000127d0: 6f6f 6b62 6163 6b0a 2020 2020 2020 2020  ookback.        
+000127e0: 6461 7461 203d 2064 6174 612e 6865 6164  data = data.head
+000127f0: 2864 6179 7354 6f4c 6f6f 6b62 6163 6b29  (daysToLookback)
+00012800: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00012810: 6461 7461 5b3a 3a2d 315d 0a20 2020 2020  data[::-1].     
+00012820: 2020 2064 6174 6120 3d20 6461 7461 2e73     data = data.s
+00012830: 6574 5f69 6e64 6578 286e 702e 6172 616e  et_index(np.aran
+00012840: 6765 286c 656e 2864 6174 6129 2929 0a20  ge(len(data))). 
+00012850: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00012860: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+00012870: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+00012880: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
+00012890: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
+000128a0: 2020 2020 2020 2073 6176 6564 203d 2073         saved = s
+000128b0: 656c 662e 6669 6e64 4375 7272 656e 7453  elf.findCurrentS
+000128c0: 6176 6564 5661 6c75 6528 7363 7265 656e  avedValue(screen
+000128d0: 4469 6374 2c73 6176 6544 6963 742c 2254  Dict,saveDict,"T
+000128e0: 7265 6e64 2229 0a20 2020 2020 2020 2074  rend").        t
+000128f0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00012900: 7769 7468 2053 7570 7072 6573 734f 7574  with SuppressOut
+00012910: 7075 7428 7375 7070 7265 7373 5f73 7464  put(suppress_std
+00012920: 6f75 743d 5472 7565 2c20 7375 7070 7265  out=True, suppre
+00012930: 7373 5f73 7464 6572 723d 5472 7565 293a  ss_stderr=True):
+00012940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012950: 2064 6174 615b 2274 6f70 7322 5d20 3d20   data["tops"] = 
+00012960: 6461 7461 5b22 436c 6f73 6522 5d2e 696c  data["Close"].il
+00012970: 6f63 5b0a 2020 2020 2020 2020 2020 2020  oc[.            
+00012980: 2020 2020 2020 2020 6c69 7374 280a 2020          list(.  
+00012990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129a0: 2020 2020 2020 706b 7461 6c69 622e 6172        pktalib.ar
+000129b0: 6772 656c 6578 7472 656d 6128 0a20 2020  grelextrema(.   
+000129c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129d0: 2020 2020 2020 2020 206e 702e 6172 7261           np.arra
+000129e0: 7928 6461 7461 5b22 436c 6f73 6522 5d29  y(data["Close"])
+000129f0: 2c20 6e70 2e67 7265 6174 6572 5f65 7175  , np.greater_equ
+00012a00: 616c 2c20 6f72 6465 723d 310a 2020 2020  al, order=1.    
+00012a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a20: 2020 2020 295b 305d 0a20 2020 2020 2020      )[0].       
+00012a30: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00012a40: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00012a50: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00012a60: 6120 3d20 6461 7461 2e66 696c 6c6e 6128  a = data.fillna(
+00012a70: 3029 0a20 2020 2020 2020 2020 2020 2064  0).            d
+00012a80: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
+00012a90: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
+00012aa0: 696e 665d 2c20 3029 0a0a 2020 2020 2020  inf], 0)..      
+00012ab0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00012ac0: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+00012ad0: 6c65 6e28 6461 7461 2920 3c20 6461 7973  len(data) < days
+00012ae0: 546f 4c6f 6f6b 6261 636b 3a0a 2020 2020  ToLookback:.    
+00012af0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00012b00: 2020 7365 6c66 2e64 6566 6175 6c74 5f6c    self.default_l
+00012b10: 6f67 6765 722e 6465 6275 6728 6461 7461  ogger.debug(data
+00012b20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012b30: 2020 2320 2020 2020 7261 6973 6520 5374    #     raise St
+00012b40: 6f63 6b44 6174 614e 6f74 4164 6571 7561  ockDataNotAdequa
+00012b50: 7465 0a20 2020 2020 2020 2020 2020 2020  te.             
+00012b60: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
+00012b70: 6570 6c61 6365 286e 702e 696e 662c 206e  eplace(np.inf, n
+00012b80: 702e 6e61 6e29 2e72 6570 6c61 6365 282d  p.nan).replace(-
+00012b90: 6e70 2e69 6e66 2c20 6e70 2e6e 616e 292e  np.inf, np.nan).
+00012ba0: 6472 6f70 6e61 2829 0a20 2020 2020 2020  dropna().       
+00012bb0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00012bc0: 6461 7461 5b22 746f 7073 225d 5b64 6174  data["tops"][dat
+00012bd0: 612e 746f 7073 203e 2030 5d29 203e 2031  a.tops > 0]) > 1
+00012be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012bf0: 2020 2020 2020 736c 6f70 6520 3d20 6e70        slope = np
+00012c00: 2e70 6f6c 7966 6974 280a 2020 2020 2020  .polyfit(.      
+00012c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c20: 2020 6461 7461 2e69 6e64 6578 5b64 6174    data.index[dat
+00012c30: 612e 746f 7073 203e 2030 5d2c 2064 6174  a.tops > 0], dat
+00012c40: 615b 2274 6f70 7322 5d5b 6461 7461 2e74  a["tops"][data.t
+00012c50: 6f70 7320 3e20 305d 2c20 310a 2020 2020  ops > 0], 1.    
+00012c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c70: 295b 305d 0a20 2020 2020 2020 2020 2020  )[0].           
+00012c80: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00012c90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00012ca0: 6c6f 7065 203d 2030 0a20 2020 2020 2020  lope = 0.       
+00012cb0: 2020 2020 2065 7863 6570 7420 6e70 2e6c       except np.l
+00012cc0: 696e 616c 672e 4c69 6e41 6c67 4572 726f  inalg.LinAlgErro
+00012cd0: 7220 6173 2065 3a20 2320 7072 6167 6d61  r as e: # pragma
+00012ce0: 3a20 6e6f 2063 6f76 6572 0a20 2020 2020  : no cover.     
+00012cf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00012d00: 6465 6661 756c 745f 6c6f 6767 6572 2e64  default_logger.d
+00012d10: 6562 7567 2865 2c20 6578 635f 696e 666f  ebug(e, exc_info
+00012d20: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00012d30: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+00012d40: 745b 2254 7265 6e64 225d 203d 2028 0a20  t["Trend"] = (. 
+00012d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d60: 2020 2073 6176 6564 5b30 5d20 2b20 636f     saved[0] + co
+00012d70: 6c6f 7254 6578 742e 424f 4c44 202b 2063  lorText.BOLD + c
+00012d80: 6f6c 6f72 5465 7874 2e57 4152 4e20 2b20  olorText.WARN + 
+00012d90: 2255 6e6b 6e6f 776e 2220 2b20 636f 6c6f  "Unknown" + colo
+00012da0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+00012db0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00012dc0: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00012dd0: 4469 6374 5b22 5472 656e 6422 5d20 3d20  Dict["Trend"] = 
+00012de0: 7361 7665 645b 315d 202b 2022 556e 6b6e  saved[1] + "Unkn
+00012df0: 6f77 6e22 0a20 2020 2020 2020 2020 2020  own".           
+00012e00: 2020 2020 2072 6574 7572 6e20 7361 7665       return save
+00012e10: 4469 6374 5b22 5472 656e 6422 5d0a 2020  Dict["Trend"].  
+00012e20: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00012e30: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+00012e40: 2020 2320 7072 6167 6d61 3a20 6e6f 2063    # pragma: no c
+00012e50: 6f76 6572 0a20 2020 2020 2020 2020 2020  over.           
+00012e60: 2020 2020 2073 656c 662e 6465 6661 756c       self.defaul
+00012e70: 745f 6c6f 6767 6572 2e64 6562 7567 2865  t_logger.debug(e
+00012e80: 2c20 6578 635f 696e 666f 3d54 7275 6529  , exc_info=True)
+00012e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012ea0: 2073 6c6f 7065 2c20 5f20 3d20 302c 2030   slope, _ = 0, 0
+00012eb0: 0a20 2020 2020 2020 2020 2020 2061 6e67  .            ang
+00012ec0: 6c65 203d 206e 702e 7261 6432 6465 6728  le = np.rad2deg(
+00012ed0: 6e70 2e61 7263 7461 6e28 736c 6f70 6529  np.arctan(slope)
+00012ee0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00012ef0: 2061 6e67 6c65 203d 3d20 303a 0a20 2020   angle == 0:.   
+00012f00: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+00012f10: 6565 6e44 6963 745b 2254 7265 6e64 225d  eenDict["Trend"]
+00012f20: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00012f30: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
+00012f40: 5d20 2b20 636f 6c6f 7254 6578 742e 424f  ] + colorText.BO
+00012f50: 4c44 202b 2063 6f6c 6f72 5465 7874 2e57  LD + colorText.W
+00012f60: 4152 4e20 2b20 2255 6e6b 6e6f 776e 2220  ARN + "Unknown" 
+00012f70: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+00012f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012fa0: 2020 7361 7665 4469 6374 5b22 5472 656e    saveDict["Tren
+00012fb0: 6422 5d20 3d20 7361 7665 645b 315d 202b  d"] = saved[1] +
+00012fc0: 2022 556e 6b6e 6f77 6e22 0a20 2020 2020   "Unknown".     
+00012fd0: 2020 2020 2020 2065 6c69 6620 616e 676c         elif angl
+00012fe0: 6520 3c3d 2033 3020 616e 6420 616e 676c  e <= 30 and angl
+00012ff0: 6520 3e3d 202d 3330 3a0a 2020 2020 2020  e >= -30:.      
+00013000: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+00013010: 4469 6374 5b22 5472 656e 6422 5d20 3d20  Dict["Trend"] = 
+00013020: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00013030: 2020 2020 2020 7361 7665 645b 305d 202b        saved[0] +
+00013040: 2063 6f6c 6f72 5465 7874 2e42 4f4c 4420   colorText.BOLD 
+00013050: 2b20 636f 6c6f 7254 6578 742e 5741 524e  + colorText.WARN
+00013060: 202b 2022 5369 6465 7761 7973 2220 2b20   + "Sideways" + 
+00013070: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+00013080: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00013090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130a0: 7361 7665 4469 6374 5b22 5472 656e 6422  saveDict["Trend"
+000130b0: 5d20 3d20 7361 7665 645b 315d 202b 2022  ] = saved[1] + "
+000130c0: 5369 6465 7761 7973 220a 2020 2020 2020  Sideways".      
+000130d0: 2020 2020 2020 656c 6966 2061 6e67 6c65        elif angle
+000130e0: 203e 3d20 3330 2061 6e64 2061 6e67 6c65   >= 30 and angle
+000130f0: 203c 2036 313a 0a20 2020 2020 2020 2020   < 61:.         
+00013100: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+00013110: 745b 2254 7265 6e64 225d 203d 2028 0a20  t["Trend"] = (. 
+00013120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013130: 2020 2073 6176 6564 5b30 5d20 2b20 636f     saved[0] + co
+00013140: 6c6f 7254 6578 742e 424f 4c44 202b 2063  lorText.BOLD + c
+00013150: 6f6c 6f72 5465 7874 2e47 5245 454e 202b  olorText.GREEN +
+00013160: 2022 5765 616b 2055 7022 202b 2063 6f6c   "Weak Up" + col
+00013170: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+00013180: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00013190: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+000131a0: 6544 6963 745b 2254 7265 6e64 225d 203d  eDict["Trend"] =
+000131b0: 2073 6176 6564 5b31 5d20 2b20 2257 6561   saved[1] + "Wea
+000131c0: 6b20 5570 220a 2020 2020 2020 2020 2020  k Up".          
+000131d0: 2020 656c 6966 2061 6e67 6c65 203e 3d20    elif angle >= 
+000131e0: 3630 3a0a 2020 2020 2020 2020 2020 2020  60:.            
+000131f0: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+00013200: 5472 656e 6422 5d20 3d20 280a 2020 2020  Trend"] = (.    
+00013210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013220: 7361 7665 645b 305d 202b 2063 6f6c 6f72  saved[0] + color
+00013230: 5465 7874 2e42 4f4c 4420 2b20 636f 6c6f  Text.BOLD + colo
+00013240: 7254 6578 742e 4752 4545 4e20 2b20 2253  rText.GREEN + "S
+00013250: 7472 6f6e 6720 5570 2220 2b20 636f 6c6f  trong Up" + colo
+00013260: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+00013270: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00013280: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00013290: 4469 6374 5b22 5472 656e 6422 5d20 3d20  Dict["Trend"] = 
+000132a0: 7361 7665 645b 315d 202b 2022 5374 726f  saved[1] + "Stro
+000132b0: 6e67 2055 7022 0a20 2020 2020 2020 2020  ng Up".         
+000132c0: 2020 2065 6c69 6620 616e 676c 6520 3c3d     elif angle <=
+000132d0: 202d 3330 2061 6e64 2061 6e67 6c65 203e   -30 and angle >
+000132e0: 202d 3631 3a0a 2020 2020 2020 2020 2020   -61:.          
+000132f0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+00013300: 5b22 5472 656e 6422 5d20 3d20 280a 2020  ["Trend"] = (.  
+00013310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013320: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
+00013330: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
+00013340: 6c6f 7254 6578 742e 4641 494c 202b 2022  lorText.FAIL + "
+00013350: 5765 616b 2044 6f77 6e22 202b 2063 6f6c  Weak Down" + col
+00013360: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+00013370: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00013380: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00013390: 6544 6963 745b 2254 7265 6e64 225d 203d  eDict["Trend"] =
+000133a0: 2073 6176 6564 5b31 5d20 2b20 2257 6561   saved[1] + "Wea
+000133b0: 6b20 446f 776e 220a 2020 2020 2020 2020  k Down".        
+000133c0: 2020 2020 656c 6966 2061 6e67 6c65 203c      elif angle <
+000133d0: 202d 3630 3a0a 2020 2020 2020 2020 2020   -60:.          
+000133e0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+000133f0: 5b22 5472 656e 6422 5d20 3d20 280a 2020  ["Trend"] = (.  
+00013400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013410: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
+00013420: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
+00013430: 6c6f 7254 6578 742e 4641 494c 202b 2022  lorText.FAIL + "
+00013440: 5374 726f 6e67 2044 6f77 6e22 202b 2063  Strong Down" + c
+00013450: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
+00013460: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00013470: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00013480: 6176 6544 6963 745b 2254 7265 6e64 225d  aveDict["Trend"]
+00013490: 203d 2073 6176 6564 5b31 5d20 2b20 2253   = saved[1] + "S
+000134a0: 7472 6f6e 6720 446f 776e 220a 2020 2020  trong Down".    
+000134b0: 2020 2020 6578 6365 7074 206e 702e 6c69      except np.li
+000134c0: 6e61 6c67 2e4c 696e 416c 6745 7272 6f72  nalg.LinAlgError
+000134d0: 2061 7320 653a 2023 2070 7261 676d 613a   as e: # pragma:
+000134e0: 206e 6f20 636f 7665 720a 2020 2020 2020   no cover.      
+000134f0: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
+00013500: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
+00013510: 652c 2065 7863 5f69 6e66 6f3d 5472 7565  e, exc_info=True
+00013520: 290a 2020 2020 2020 2020 2020 2020 7363  ).            sc
+00013530: 7265 656e 4469 6374 5b22 5472 656e 6422  reenDict["Trend"
+00013540: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+00013550: 2020 2020 2020 7361 7665 645b 305d 202b        saved[0] +
+00013560: 2063 6f6c 6f72 5465 7874 2e42 4f4c 4420   colorText.BOLD 
+00013570: 2b20 636f 6c6f 7254 6578 742e 5741 524e  + colorText.WARN
+00013580: 202b 2022 556e 6b6e 6f77 6e22 202b 2063   + "Unknown" + c
+00013590: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
+000135a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000135b0: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+000135c0: 2254 7265 6e64 225d 203d 2073 6176 6564  "Trend"] = saved
+000135d0: 5b31 5d20 2b20 2255 6e6b 6e6f 776e 220a  [1] + "Unknown".
+000135e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000135f0: 6176 6544 6963 745b 2254 7265 6e64 225d  aveDict["Trend"]
+00013600: 0a0a 2020 2020 2320 4669 6e64 2073 746f  ..    # Find sto
+00013610: 636b 7320 6170 7072 6f63 6869 6e67 2074  cks approching t
+00013620: 6f20 6c6f 6e67 2074 6572 6d20 7472 656e  o long term tren
+00013630: 646c 696e 6573 0a20 2020 2064 6566 2066  dlines.    def f
+00013640: 696e 6454 7265 6e64 6c69 6e65 7328 7365  indTrendlines(se
+00013650: 6c66 2c20 6466 2c20 7363 7265 656e 4469  lf, df, screenDi
+00013660: 6374 2c20 7361 7665 4469 6374 2c20 7065  ct, saveDict, pe
+00013670: 7263 656e 7461 6765 3d30 2e30 3529 3a0a  rcentage=0.05):.
+00013680: 2020 2020 2020 2020 2320 7065 7269 6f64          # period
+00013690: 203d 2069 6e74 2822 222e 6a6f 696e 2863   = int("".join(c
+000136a0: 2066 6f72 2063 2069 6e20 7365 6c66 2e63   for c in self.c
+000136b0: 6f6e 6669 674d 616e 6167 6572 2e70 6572  onfigManager.per
+000136c0: 696f 6420 6966 2063 2e69 7364 6967 6974  iod if c.isdigit
+000136d0: 2829 2929 0a20 2020 2020 2020 2023 2069  ())).        # i
+000136e0: 6620 6c65 6e28 6461 7461 2920 3c20 7065  f len(data) < pe
+000136f0: 7269 6f64 3a0a 2020 2020 2020 2020 2320  riod:.        # 
+00013700: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00013710: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00013720: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
+00013730: 2020 6461 7461 203d 2064 6174 615b 3a3a    data = data[::
+00013740: 2d31 5d0a 2020 2020 2020 2020 6461 7461  -1].        data
+00013750: 5b22 4e75 6d62 6572 225d 203d 206e 702e  ["Number"] = np.
+00013760: 6172 616e 6765 286c 656e 2864 6174 6129  arange(len(data)
+00013770: 2920 2b20 310a 2020 2020 2020 2020 6461  ) + 1.        da
+00013780: 7461 5f6c 6f77 203d 2064 6174 612e 636f  ta_low = data.co
+00013790: 7079 2829 0a20 2020 2020 2020 2070 6f69  py().        poi
+000137a0: 6e74 7320 3d20 3330 0a0a 2020 2020 2020  nts = 30..      
+000137b0: 2020 2222 2220 4967 6e6f 7269 6e67 2074    """ Ignoring t
+000137c0: 6865 2052 6573 6974 616e 6365 2066 6f72  he Resitance for
+000137d0: 206c 6f6e 672d 7465 726d 2070 7572 706f   long-term purpo
+000137e0: 7365 0a20 2020 2020 2020 2077 6869 6c65  se.        while
+000137f0: 206c 656e 2864 6174 615f 6869 6768 2920   len(data_high) 
+00013800: 3e20 706f 696e 7473 3a0a 2020 2020 2020  > points:.      
+00013810: 2020 2020 2020 736c 6f70 652c 2069 6e74        slope, int
+00013820: 6572 6365 7074 2c20 725f 7661 6c75 652c  ercept, r_value,
+00013830: 2070 5f76 616c 7565 2c20 7374 645f 6572   p_value, std_er
+00013840: 7220 3d20 6c69 6e72 6567 7265 7373 2878  r = linregress(x
+00013850: 3d64 6174 615f 6869 6768 5b27 4e75 6d62  =data_high['Numb
+00013860: 6572 275d 2c20 793d 6461 7461 5f68 6967  er'], y=data_hig
+00013870: 685b 2748 6967 6827 5d29 0a20 2020 2020  h['High']).     
+00013880: 2020 2020 2020 2064 6174 615f 6869 6768         data_high
+00013890: 203d 2064 6174 615f 6869 6768 2e6c 6f63   = data_high.loc
+000138a0: 5b64 6174 615f 6869 6768 5b27 4869 6768  [data_high['High
+000138b0: 275d 203e 2073 6c6f 7065 202a 2064 6174  '] > slope * dat
+000138c0: 615f 6869 6768 5b27 4e75 6d62 6572 275d  a_high['Number']
+000138d0: 202b 2069 6e74 6572 6365 7074 5d0a 2020   + intercept].  
+000138e0: 2020 2020 2020 736c 6f70 652c 2069 6e74        slope, int
+000138f0: 6572 6365 7074 2c20 725f 7661 6c75 652c  ercept, r_value,
+00013900: 2070 5f76 616c 7565 2c20 7374 645f 6572   p_value, std_er
+00013910: 7220 3d20 6c69 6e72 6567 7265 7373 2878  r = linregress(x
+00013920: 3d64 6174 615f 6869 6768 5b27 4e75 6d62  =data_high['Numb
+00013930: 6572 275d 2c20 793d 6461 7461 5f68 6967  er'], y=data_hig
+00013940: 685b 2743 6c6f 7365 275d 290a 2020 2020  h['Close']).    
+00013950: 2020 2020 6461 7461 5b27 5265 7369 7374      data['Resist
+00013960: 616e 6365 275d 203d 2073 6c6f 7065 202a  ance'] = slope *
+00013970: 2064 6174 615b 274e 756d 6265 7227 5d20   data['Number'] 
+00013980: 2b20 696e 7465 7263 6570 740a 2020 2020  + intercept.    
+00013990: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+000139a0: 2077 6869 6c65 206c 656e 2864 6174 615f   while len(data_
+000139b0: 6c6f 7729 203e 2070 6f69 6e74 733a 0a20  low) > points:. 
+000139c0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+000139d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139e0: 736c 6f70 652c 2069 6e74 6572 6365 7074  slope, intercept
+000139f0: 2c20 725f 7661 6c75 652c 2070 5f76 616c  , r_value, p_val
+00013a00: 7565 2c20 7374 645f 6572 7220 3d20 6c69  ue, std_err = li
+00013a10: 6e72 6567 7265 7373 280a 2020 2020 2020  nregress(.      
+00013a20: 2020 2020 2020 2020 2020 2020 2020 783d                x=
+00013a30: 6461 7461 5f6c 6f77 5b22 4e75 6d62 6572  data_low["Number
+00013a40: 225d 2c20 793d 6461 7461 5f6c 6f77 5b22  "], y=data_low["
+00013a50: 4c6f 7722 5d0a 2020 2020 2020 2020 2020  Low"].          
+00013a60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00013a70: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00013a80: 7469 6f6e 2061 7320 653a 2020 2320 7072  tion as e:  # pr
+00013a90: 6167 6d61 3a20 6e6f 2063 6f76 6572 0a20  agma: no cover. 
+00013aa0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00013ab0: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
+00013ac0: 6572 2e64 6562 7567 2865 2c20 6578 635f  er.debug(e, exc_
+00013ad0: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
+00013ae0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00013af0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+00013b00: 6461 7461 5f6c 6f77 203d 2064 6174 615f  data_low = data_
+00013b10: 6c6f 772e 6c6f 635b 0a20 2020 2020 2020  low.loc[.       
+00013b20: 2020 2020 2020 2020 2064 6174 615f 6c6f           data_lo
+00013b30: 775b 224c 6f77 225d 203c 2073 6c6f 7065  w["Low"] < slope
+00013b40: 202a 2064 6174 615f 6c6f 775b 224e 756d   * data_low["Num
+00013b50: 6265 7222 5d20 2b20 696e 7465 7263 6570  ber"] + intercep
+00013b60: 740a 2020 2020 2020 2020 2020 2020 5d0a  t.            ].
+00013b70: 0a20 2020 2020 2020 2073 6c6f 7065 2c20  .        slope, 
+00013b80: 696e 7465 7263 6570 742c 2072 5f76 616c  intercept, r_val
+00013b90: 7565 2c20 705f 7661 6c75 652c 2073 7464  ue, p_value, std
+00013ba0: 5f65 7272 203d 206c 696e 7265 6772 6573  _err = linregres
+00013bb0: 7328 0a20 2020 2020 2020 2020 2020 2078  s(.            x
+00013bc0: 3d64 6174 615f 6c6f 775b 224e 756d 6265  =data_low["Numbe
+00013bd0: 7222 5d2c 2079 3d64 6174 615f 6c6f 775b  r"], y=data_low[
+00013be0: 2243 6c6f 7365 225d 0a20 2020 2020 2020  "Close"].       
+00013bf0: 2029 0a20 2020 2020 2020 2064 6174 615b   ).        data[
+00013c00: 2253 7570 706f 7274 225d 203d 2073 6c6f  "Support"] = slo
+00013c10: 7065 202a 2064 6174 615b 224e 756d 6265  pe * data["Numbe
+00013c20: 7222 5d20 2b20 696e 7465 7263 6570 740a  r"] + intercept.
+00013c30: 2020 2020 2020 2020 6e6f 7720 3d20 6461          now = da
+00013c40: 7461 2e74 6169 6c28 3129 0a0a 2020 2020  ta.tail(1)..    
+00013c50: 2020 2020 6c69 6d69 745f 7570 7065 7220      limit_upper 
+00013c60: 3d20 6e6f 775b 2253 7570 706f 7274 225d  = now["Support"]
+00013c70: 2e69 6c6f 635b 305d 202b 2028 6e6f 775b  .iloc[0] + (now[
+00013c80: 2253 7570 706f 7274 225d 2e69 6c6f 635b  "Support"].iloc[
+00013c90: 305d 202a 2070 6572 6365 6e74 6167 6529  0] * percentage)
+00013ca0: 0a20 2020 2020 2020 206c 696d 6974 5f6c  .        limit_l
+00013cb0: 6f77 6572 203d 206e 6f77 5b22 5375 7070  ower = now["Supp
+00013cc0: 6f72 7422 5d2e 696c 6f63 5b30 5d20 2d20  ort"].iloc[0] - 
+00013cd0: 286e 6f77 5b22 5375 7070 6f72 7422 5d2e  (now["Support"].
+00013ce0: 696c 6f63 5b30 5d20 2a20 7065 7263 656e  iloc[0] * percen
+00013cf0: 7461 6765 290a 2020 2020 2020 2020 7361  tage).        sa
+00013d00: 7665 6420 3d20 7365 6c66 2e66 696e 6443  ved = self.findC
+00013d10: 7572 7265 6e74 5361 7665 6456 616c 7565  urrentSavedValue
+00013d20: 2873 6372 6565 6e44 6963 742c 2073 6176  (screenDict, sav
+00013d30: 6544 6963 742c 2022 5061 7474 6572 6e22  eDict, "Pattern"
+00013d40: 290a 2020 2020 2020 2020 6966 206c 696d  ).        if lim
+00013d50: 6974 5f6c 6f77 6572 203c 206e 6f77 5b22  it_lower < now["
+00013d60: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
+00013d70: 3c20 6c69 6d69 745f 7570 7065 7220 616e  < limit_upper an
+00013d80: 6420 736c 6f70 6520 3e20 302e 3135 3a0a  d slope > 0.15:.
+00013d90: 2020 2020 2020 2020 2020 2020 7363 7265              scre
+00013da0: 656e 4469 6374 5b22 5061 7474 6572 6e22  enDict["Pattern"
+00013db0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+00013dc0: 2020 2020 2020 7361 7665 645b 305d 202b        saved[0] +
+00013dd0: 2063 6f6c 6f72 5465 7874 2e42 4f4c 4420   colorText.BOLD 
+00013de0: 2b20 636f 6c6f 7254 6578 742e 4752 4545  + colorText.GREE
+00013df0: 4e20 2b20 2254 7265 6e64 6c69 6e65 2d53  N + "Trendline-S
+00013e00: 7570 706f 7274 2220 2b20 636f 6c6f 7254  upport" + colorT
+00013e10: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+00013e20: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00013e30: 2020 7361 7665 4469 6374 5b22 5061 7474    saveDict["Patt
+00013e40: 6572 6e22 5d20 3d20 7361 7665 645b 315d  ern"] = saved[1]
+00013e50: 202b 2022 5472 656e 646c 696e 652d 5375   + "Trendline-Su
+00013e60: 7070 6f72 7422 0a20 2020 2020 2020 2020  pport".         
+00013e70: 2020 2072 6574 7572 6e20 5472 7565 0a0a     return True..
+00013e80: 2020 2020 2020 2020 2222 2220 506c 6f74          """ Plot
+00013e90: 7320 666f 7220 6465 6275 6767 696e 670a  s for debugging.
+00013ea0: 2020 2020 2020 2020 696d 706f 7274 206d          import m
+00013eb0: 6174 706c 6f74 6c69 622e 7079 706c 6f74  atplotlib.pyplot
+00013ec0: 2061 7320 706c 740a 2020 2020 2020 2020   as plt.        
+00013ed0: 6669 672c 2061 7831 203d 2070 6c74 2e73  fig, ax1 = plt.s
+00013ee0: 7562 706c 6f74 7328 6669 6773 697a 653d  ubplots(figsize=
+00013ef0: 2831 352c 3130 2929 0a20 2020 2020 2020  (15,10)).       
+00013f00: 2063 6f6c 6f72 203d 2027 7461 623a 6772   color = 'tab:gr
+00013f10: 6565 6e27 0a20 2020 2020 2020 2078 6461  een'.        xda
+00013f20: 7465 203d 205b 782e 6461 7465 2829 2066  te = [x.date() f
+00013f30: 6f72 2078 2069 6e20 6461 7461 2e69 6e64  or x in data.ind
+00013f40: 6578 5d0a 2020 2020 2020 2020 6178 312e  ex].        ax1.
+00013f50: 7365 745f 786c 6162 656c 2827 4461 7465  set_xlabel('Date
+00013f60: 272c 2063 6f6c 6f72 3d63 6f6c 6f72 290a  ', color=color).
+00013f70: 2020 2020 2020 2020 6178 312e 706c 6f74          ax1.plot
+00013f80: 2878 6461 7465 2c20 6461 7461 2e43 6c6f  (xdate, data.Clo
+00013f90: 7365 2c20 6c61 6265 6c3d 2263 6c6f 7365  se, label="close
+00013fa0: 222c 2063 6f6c 6f72 3d63 6f6c 6f72 290a  ", color=color).
+00013fb0: 2020 2020 2020 2020 6178 312e 7469 636b          ax1.tick
+00013fc0: 5f70 6172 616d 7328 6178 6973 3d27 7827  _params(axis='x'
+00013fd0: 2c20 6c61 6265 6c63 6f6c 6f72 3d63 6f6c  , labelcolor=col
+00013fe0: 6f72 290a 0a20 2020 2020 2020 2061 7832  or)..        ax2
+00013ff0: 203d 2061 7831 2e74 7769 6e79 2829 2023   = ax1.twiny() #
+00014000: 2061 7832 2061 6e64 2061 7831 2077 696c   ax2 and ax1 wil
+00014010: 6c20 6861 7665 2063 6f6d 6d6f 6e20 7920  l have common y 
+00014020: 6178 6973 2061 6e64 2064 6966 6665 7265  axis and differe
+00014030: 6e74 2078 2061 7869 732c 2074 7769 6e79  nt x axis, twiny
+00014040: 0a20 2020 2020 2020 2061 7832 2e70 6c6f  .        ax2.plo
+00014050: 7428 6461 7461 2e4e 756d 6265 722c 2064  t(data.Number, d
+00014060: 6174 612e 5265 7369 7374 616e 6365 2c20  ata.Resistance, 
+00014070: 6c61 6265 6c3d 2252 6573 2229 0a20 2020  label="Res").   
+00014080: 2020 2020 2061 7832 2e70 6c6f 7428 6461       ax2.plot(da
+00014090: 7461 2e4e 756d 6265 722c 2064 6174 612e  ta.Number, data.
+000140a0: 5375 7070 6f72 742c 206c 6162 656c 3d22  Support, label="
+000140b0: 5375 7022 290a 0a20 2020 2020 2020 2070  Sup")..        p
+000140c0: 6c74 2e6c 6567 656e 6428 290a 2020 2020  lt.legend().    
+000140d0: 2020 2020 706c 742e 6772 6964 2829 0a20      plt.grid(). 
+000140e0: 2020 2020 2020 2070 6c74 2e73 686f 7728         plt.show(
+000140f0: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
+00014100: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00014110: 7365 0a0a 2020 2020 2320 406d 6561 7375  se..    # @measu
+00014120: 7265 5f74 696d 650a 2020 2020 6465 6620  re_time.    def 
+00014130: 6669 6e64 5570 7472 656e 6428 7365 6c66  findUptrend(self
+00014140: 2c20 6466 2c20 7363 7265 656e 4469 6374  , df, screenDict
+00014150: 2c20 7361 7665 4469 6374 2c20 7465 7374  , saveDict, test
+00014160: 696e 672c 2073 746f 636b 2c6f 6e6c 794d  ing, stock,onlyM
+00014170: 463d 4661 6c73 652c 686f 7374 4461 7461  F=False,hostData
+00014180: 3d4e 6f6e 652c 6578 6368 616e 6765 4e61  =None,exchangeNa
+00014190: 6d65 3d22 494e 4449 4122 2c72 6566 7265  me="INDIA",refre
+000141a0: 7368 4d46 416e 6446 563d 5472 7565 293a  shMFAndFV=True):
+000141b0: 0a20 2020 2020 2020 2023 2073 686f 756c  .        # shoul
+000141c0: 6450 726f 6365 6564 203d 2054 7275 650a  dProceed = True.
+000141d0: 2020 2020 2020 2020 6973 5570 7472 656e          isUptren
+000141e0: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
+000141f0: 2020 6973 446f 776e 7472 656e 6420 3d20    isDowntrend = 
+00014200: 4661 6c73 650a 2020 2020 2020 2020 6973  False.        is
+00014210: 3530 444d 4155 7074 7265 6e64 203d 2046  50DMAUptrend = F
+00014220: 616c 7365 0a20 2020 2020 2020 2069 7335  alse.        is5
+00014230: 3044 4d41 446f 776e 7472 656e 6420 3d20  0DMADowntrend = 
+00014240: 4661 6c73 650a 2020 2020 2020 2020 6465  False.        de
+00014250: 6369 7369 6f6e 203d 2022 220a 2020 2020  cision = "".    
+00014260: 2020 2020 646d 6135 3064 6563 6973 696f      dma50decisio
+00014270: 6e20 3d20 2222 0a20 2020 2020 2020 2066  n = "".        f
+00014280: 6169 7256 616c 7565 203d 2030 0a20 2020  airValue = 0.   
+00014290: 2020 2020 2066 6169 7256 616c 7565 4469       fairValueDi
+000142a0: 6666 203d 2030 0a20 2020 2020 2020 2023  ff = 0.        #
+000142b0: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
+000142c0: 7220 6c65 6e28 6466 2920 3c20 3232 3020  r len(df) < 220 
+000142d0: 6f72 2074 6573 7469 6e67 3a0a 2020 2020  or testing:.    
+000142e0: 2020 2020 2320 2020 2020 7368 6f75 6c64      #     should
+000142f0: 5072 6f63 6565 6420 3d20 4661 6c73 650a  Proceed = False.
+00014300: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+00014310: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00014320: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00014330: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00014340: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
+00014350: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00014360: 6120 3d20 6461 7461 5b3a 3a2d 315d 0a20  a = data[::-1]. 
+00014370: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00014380: 6f64 6179 5f73 6d61 203d 2070 6b74 616c  oday_sma = pktal
+00014390: 6962 2e53 4d41 2864 6174 615b 2243 6c6f  ib.SMA(data["Clo
+000143a0: 7365 225d 2c20 7469 6d65 7065 7269 6f64  se"], timeperiod
+000143b0: 3d35 3029 0a20 2020 2020 2020 2020 2020  =50).           
+000143c0: 2020 2020 2073 6d61 5f6d 696e 7573 3920       sma_minus9 
+000143d0: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
+000143e0: 7461 2e68 6561 6428 6c65 6e28 6461 7461  ta.head(len(data
+000143f0: 292d 3929 5b22 436c 6f73 6522 5d2c 2074  )-9)["Close"], t
+00014400: 696d 6570 6572 696f 643d 3530 290a 2020  imeperiod=50).  
+00014410: 2020 2020 2020 2020 2020 2020 2020 736d                sm
+00014420: 615f 6d69 6e75 7331 3420 3d20 706b 7461  a_minus14 = pkta
+00014430: 6c69 622e 534d 4128 6461 7461 2e68 6561  lib.SMA(data.hea
+00014440: 6428 6c65 6e28 6461 7461 292d 3134 295b  d(len(data)-14)[
+00014450: 2243 6c6f 7365 225d 2c20 7469 6d65 7065  "Close"], timepe
+00014460: 7269 6f64 3d35 3029 0a20 2020 2020 2020  riod=50).       
+00014470: 2020 2020 2020 2020 2073 6d61 5f6d 696e           sma_min
+00014480: 7573 3230 203d 2070 6b74 616c 6962 2e53  us20 = pktalib.S
+00014490: 4d41 2864 6174 612e 6865 6164 286c 656e  MA(data.head(len
+000144a0: 2864 6174 6129 2d32 3029 5b22 436c 6f73  (data)-20)["Clos
+000144b0: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
+000144c0: 3530 290a 2020 2020 2020 2020 2020 2020  50).            
+000144d0: 2020 2020 746f 6461 795f 6c6d 6120 3d20      today_lma = 
+000144e0: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
+000144f0: 5b22 436c 6f73 6522 5d2c 2074 696d 6570  ["Close"], timep
+00014500: 6572 696f 643d 3230 3029 0a20 2020 2020  eriod=200).     
+00014510: 2020 2020 2020 2020 2020 206c 6d61 5f6d             lma_m
+00014520: 696e 7573 3230 203d 2070 6b74 616c 6962  inus20 = pktalib
+00014530: 2e53 4d41 2864 6174 612e 6865 6164 286c  .SMA(data.head(l
+00014540: 656e 2864 6174 6129 2d32 3029 5b22 436c  en(data)-20)["Cl
+00014550: 6f73 6522 5d2c 2074 696d 6570 6572 696f  ose"], timeperio
+00014560: 643d 3230 3029 0a20 2020 2020 2020 2020  d=200).         
+00014570: 2020 2020 2020 206c 6d61 5f6d 696e 7573         lma_minus
+00014580: 3830 203d 2070 6b74 616c 6962 2e53 4d41  80 = pktalib.SMA
+00014590: 2864 6174 612e 6865 6164 286c 656e 2864  (data.head(len(d
+000145a0: 6174 6129 2d38 3029 5b22 436c 6f73 6522  ata)-80)["Close"
+000145b0: 5d2c 2074 696d 6570 6572 696f 643d 3230  ], timeperiod=20
+000145c0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+000145d0: 2020 206c 6d61 5f6d 696e 7573 3130 3020     lma_minus100 
+000145e0: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
+000145f0: 7461 2e68 6561 6428 6c65 6e28 6461 7461  ta.head(len(data
+00014600: 292d 3130 3029 5b22 436c 6f73 6522 5d2c  )-100)["Close"],
+00014610: 2074 696d 6570 6572 696f 643d 3230 3029   timeperiod=200)
+00014620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014630: 2074 6f64 6179 5f6c 6d61 203d 2074 6f64   today_lma = tod
+00014640: 6179 5f6c 6d61 2e69 6c6f 635b 6c65 6e28  ay_lma.iloc[len(
+00014650: 746f 6461 795f 6c6d 6129 2d31 5d20 6966  today_lma)-1] if
+00014660: 2074 6f64 6179 5f6c 6d61 2069 7320 6e6f   today_lma is no
+00014670: 7420 4e6f 6e65 2065 6c73 6520 300a 2020  t None else 0.  
+00014680: 2020 2020 2020 2020 2020 2020 2020 6c6d                lm
+00014690: 615f 6d69 6e75 7332 3020 3d20 6c6d 615f  a_minus20 = lma_
+000146a0: 6d69 6e75 7332 302e 696c 6f63 5b6c 656e  minus20.iloc[len
+000146b0: 286c 6d61 5f6d 696e 7573 3230 292d 315d  (lma_minus20)-1]
+000146c0: 2069 6620 6c6d 615f 6d69 6e75 7332 3020   if lma_minus20 
+000146d0: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
+000146e0: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
+000146f0: 2020 206c 6d61 5f6d 696e 7573 3830 203d     lma_minus80 =
+00014700: 206c 6d61 5f6d 696e 7573 3830 2e69 6c6f   lma_minus80.ilo
+00014710: 635b 6c65 6e28 6c6d 615f 6d69 6e75 7338  c[len(lma_minus8
+00014720: 3029 2d31 5d20 6966 206c 6d61 5f6d 696e  0)-1] if lma_min
+00014730: 7573 3830 2069 7320 6e6f 7420 4e6f 6e65  us80 is not None
+00014740: 2065 6c73 6520 300a 2020 2020 2020 2020   else 0.        
+00014750: 2020 2020 2020 2020 6c6d 615f 6d69 6e75          lma_minu
+00014760: 7331 3030 203d 206c 6d61 5f6d 696e 7573  s100 = lma_minus
+00014770: 3130 302e 696c 6f63 5b6c 656e 286c 6d61  100.iloc[len(lma
+00014780: 5f6d 696e 7573 3130 3029 2d31 5d20 6966  _minus100)-1] if
+00014790: 206c 6d61 5f6d 696e 7573 3130 3020 6973   lma_minus100 is
+000147a0: 206e 6f74 204e 6f6e 6520 656c 7365 2030   not None else 0
+000147b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000147c0: 2074 6f64 6179 5f73 6d61 203d 2074 6f64   today_sma = tod
+000147d0: 6179 5f73 6d61 2e69 6c6f 635b 6c65 6e28  ay_sma.iloc[len(
+000147e0: 746f 6461 795f 736d 6129 2d31 5d20 6966  today_sma)-1] if
+000147f0: 2074 6f64 6179 5f73 6d61 2069 7320 6e6f   today_sma is no
+00014800: 7420 4e6f 6e65 2065 6c73 6520 300a 2020  t None else 0.  
+00014810: 2020 2020 2020 2020 2020 2020 2020 736d                sm
+00014820: 615f 6d69 6e75 7339 203d 2073 6d61 5f6d  a_minus9 = sma_m
+00014830: 696e 7573 392e 696c 6f63 5b6c 656e 2873  inus9.iloc[len(s
+00014840: 6d61 5f6d 696e 7573 3929 2d31 5d20 6966  ma_minus9)-1] if
+00014850: 2073 6d61 5f6d 696e 7573 3920 6973 206e   sma_minus9 is n
+00014860: 6f74 204e 6f6e 6520 656c 7365 2030 0a20  ot None else 0. 
+00014870: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00014880: 6d61 5f6d 696e 7573 3134 203d 2073 6d61  ma_minus14 = sma
+00014890: 5f6d 696e 7573 3134 2e69 6c6f 635b 6c65  _minus14.iloc[le
+000148a0: 6e28 736d 615f 6d69 6e75 7331 3429 2d31  n(sma_minus14)-1
+000148b0: 5d20 6966 2073 6d61 5f6d 696e 7573 3134  ] if sma_minus14
+000148c0: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+000148d0: 6520 300a 2020 2020 2020 2020 2020 2020  e 0.            
+000148e0: 2020 2020 736d 615f 6d69 6e75 7332 3020      sma_minus20 
+000148f0: 3d20 736d 615f 6d69 6e75 7332 302e 696c  = sma_minus20.il
+00014900: 6f63 5b6c 656e 2873 6d61 5f6d 696e 7573  oc[len(sma_minus
+00014910: 3230 292d 315d 2069 6620 736d 615f 6d69  20)-1] if sma_mi
+00014920: 6e75 7332 3020 6973 206e 6f74 204e 6f6e  nus20 is not Non
+00014930: 6520 656c 7365 2030 0a20 2020 2020 2020  e else 0.       
+00014940: 2020 2020 2020 2020 2069 7355 7074 7265           isUptre
+00014950: 6e64 203d 2028 746f 6461 795f 6c6d 6120  nd = (today_lma 
+00014960: 3e20 6c6d 615f 6d69 6e75 7332 3029 206f  > lma_minus20) o
+00014970: 7220 2874 6f64 6179 5f6c 6d61 203e 206c  r (today_lma > l
+00014980: 6d61 5f6d 696e 7573 3830 2920 6f72 2028  ma_minus80) or (
+00014990: 746f 6461 795f 6c6d 6120 3e20 6c6d 615f  today_lma > lma_
+000149a0: 6d69 6e75 7331 3030 290a 2020 2020 2020  minus100).      
+000149b0: 2020 2020 2020 2020 2020 6973 446f 776e            isDown
+000149c0: 7472 656e 6420 3d20 2874 6f64 6179 5f6c  trend = (today_l
+000149d0: 6d61 203c 206c 6d61 5f6d 696e 7573 3230  ma < lma_minus20
+000149e0: 2920 616e 6420 2874 6f64 6179 5f6c 6d61  ) and (today_lma
+000149f0: 203c 206c 6d61 5f6d 696e 7573 3830 2920   < lma_minus80) 
+00014a00: 616e 6420 2874 6f64 6179 5f6c 6d61 203c  and (today_lma <
+00014a10: 206c 6d61 5f6d 696e 7573 3130 3029 0a20   lma_minus100). 
+00014a20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00014a30: 7335 3044 4d41 5570 7472 656e 6420 3d20  s50DMAUptrend = 
+00014a40: 2874 6f64 6179 5f73 6d61 203e 2073 6d61  (today_sma > sma
+00014a50: 5f6d 696e 7573 3929 206f 7220 2874 6f64  _minus9) or (tod
+00014a60: 6179 5f73 6d61 203e 2073 6d61 5f6d 696e  ay_sma > sma_min
+00014a70: 7573 3134 2920 6f72 2028 746f 6461 795f  us14) or (today_
+00014a80: 736d 6120 3e20 736d 615f 6d69 6e75 7332  sma > sma_minus2
+00014a90: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+00014aa0: 2020 2069 7335 3044 4d41 446f 776e 7472     is50DMADowntr
+00014ab0: 656e 6420 3d20 2874 6f64 6179 5f73 6d61  end = (today_sma
+00014ac0: 203c 2073 6d61 5f6d 696e 7573 3929 2061   < sma_minus9) a
+00014ad0: 6e64 2028 746f 6461 795f 736d 6120 3c20  nd (today_sma < 
+00014ae0: 736d 615f 6d69 6e75 7331 3429 2061 6e64  sma_minus14) and
+00014af0: 2028 746f 6461 795f 736d 6120 3c20 736d   (today_sma < sm
+00014b00: 615f 6d69 6e75 7332 3029 0a20 2020 2020  a_minus20).     
+00014b10: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00014b20: 6365 7074 696f 6e3a 2020 2320 7072 6167  ception:  # prag
+00014b30: 6d61 3a20 6e6f 2063 6f76 6572 0a20 2020  ma: no cover.   
+00014b40: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+00014b50: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
+00014b60: 6572 2e64 6562 7567 2865 2c20 6578 635f  er.debug(e, exc_
+00014b70: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
+00014b80: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00014b90: 2020 2020 2020 2020 6465 6369 7369 6f6e          decision
+00014ba0: 203d 2027 543a e296 b227 2069 6620 6973   = 'T:...' if is
+00014bb0: 5570 7472 656e 6420 656c 7365 2028 2754  Uptrend else ('T
+00014bc0: 3ae2 96bc 2720 6966 2069 7344 6f77 6e74  :...' if isDownt
+00014bd0: 7265 6e64 2065 6c73 6520 2727 290a 2020  rend else '').  
+00014be0: 2020 2020 2020 646d 6135 3064 6563 6973        dma50decis
+00014bf0: 696f 6e20 3d20 2774 3ae2 96b2 2720 6966  ion = 't:...' if
+00014c00: 2069 7335 3044 4d41 5570 7472 656e 6420   is50DMAUptrend 
+00014c10: 656c 7365 2028 2774 3ae2 96bc 2720 6966  else ('t:...' if
+00014c20: 2069 7335 3044 4d41 446f 776e 7472 656e   is50DMADowntren
+00014c30: 6420 656c 7365 2027 2729 0a20 2020 2020  d else '').     
+00014c40: 2020 206d 665f 696e 7374 5f6f 776e 6572     mf_inst_owner
+00014c50: 7368 6970 4368 616e 6765 203d 2030 0a20  shipChange = 0. 
+00014c60: 2020 2020 2020 2063 6861 6e67 655f 6d69         change_mi
+00014c70: 6c6c 696f 6e73 203d 2222 0a20 2020 2020  llions ="".     
+00014c80: 2020 206d 6620 3d20 2222 0a20 2020 2020     mf = "".     
+00014c90: 2020 206d 6673 203d 2022 220a 2020 2020     mfs = "".    
+00014ca0: 2020 2020 6966 2072 6566 7265 7368 4d46      if refreshMF
+00014cb0: 416e 6446 563a 0a20 2020 2020 2020 2020  AndFV:.         
+00014cc0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00014cd0: 2020 2020 2020 2020 6d66 5f69 6e73 745f          mf_inst_
+00014ce0: 6f77 6e65 7273 6869 7043 6861 6e67 6520  ownershipChange 
+00014cf0: 3d20 7365 6c66 2e67 6574 4d75 7475 616c  = self.getMutual
+00014d00: 4675 6e64 5374 6174 7573 2873 746f 636b  FundStatus(stock
+00014d10: 2c6f 6e6c 794d 463d 6f6e 6c79 4d46 2c68  ,onlyMF=onlyMF,h
+00014d20: 6f73 7444 6174 613d 686f 7374 4461 7461  ostData=hostData
+00014d30: 2c66 6f72 6365 3d28 686f 7374 4461 7461  ,force=(hostData
+00014d40: 2069 7320 4e6f 6e65 206f 7220 686f 7374   is None or host
+00014d50: 4461 7461 2e65 6d70 7479 206f 7220 6e6f  Data.empty or no
+00014d60: 7420 2822 4d46 2220 696e 2068 6f73 7444  t ("MF" in hostD
+00014d70: 6174 612e 636f 6c75 6d6e 7320 6f72 2022  ata.columns or "
+00014d80: 4649 4922 2069 6e20 686f 7374 4461 7461  FII" in hostData
+00014d90: 2e63 6f6c 756d 6e73 2929 2c65 7863 6861  .columns)),excha
+00014da0: 6e67 654e 616d 653d 6578 6368 616e 6765  ngeName=exchange
+00014db0: 4e61 6d65 290a 2020 2020 2020 2020 2020  Name).          
+00014dc0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00014dd0: 6e63 6528 6d66 5f69 6e73 745f 6f77 6e65  nce(mf_inst_owne
+00014de0: 7273 6869 7043 6861 6e67 652c 2070 642e  rshipChange, pd.
+00014df0: 5365 7269 6573 293a 0a20 2020 2020 2020  Series):.       
+00014e00: 2020 2020 2020 2020 2020 2020 206d 665f               mf_
+00014e10: 696e 7374 5f6f 776e 6572 7368 6970 4368  inst_ownershipCh
+00014e20: 616e 6765 203d 2030 0a20 2020 2020 2020  ange = 0.       
+00014e30: 2020 2020 2020 2020 2072 6f75 6e64 4f66           roundOf
+00014e40: 6620 3d20 320a 2020 2020 2020 2020 2020  f = 2.          
+00014e50: 2020 2020 2020 6d69 6c6c 696f 6e73 203d        millions =
+00014e60: 2072 6f75 6e64 286d 665f 696e 7374 5f6f   round(mf_inst_o
+00014e70: 776e 6572 7368 6970 4368 616e 6765 2f31  wnershipChange/1
+00014e80: 3030 3030 3030 2c72 6f75 6e64 4f66 6629  000000,roundOff)
+00014e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014ea0: 2077 6869 6c65 2066 6c6f 6174 286d 696c   while float(mil
+00014eb0: 6c69 6f6e 7329 203d 3d20 3020 616e 6420  lions) == 0 and 
+00014ec0: 726f 756e 644f 6666 203c 3d35 3a0a 2020  roundOff <=5:.  
+00014ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ee0: 2020 726f 756e 644f 6666 202b 3d31 0a20    roundOff +=1. 
+00014ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f00: 2020 206d 696c 6c69 6f6e 7320 3d20 726f     millions = ro
+00014f10: 756e 6428 6d66 5f69 6e73 745f 6f77 6e65  und(mf_inst_owne
+00014f20: 7273 6869 7043 6861 6e67 652f 3130 3030  rshipChange/1000
+00014f30: 3030 302c 726f 756e 644f 6666 290a 2020  000,roundOff).  
+00014f40: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00014f50: 616e 6765 5f6d 696c 6c69 6f6e 7320 3d20  ange_millions = 
+00014f60: 6622 287b 6d69 6c6c 696f 6e73 7d4d 2922  f"({millions}M)"
+00014f70: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00014f80: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00014f90: 2065 3a20 2023 2070 7261 676d 613a 206e   e:  # pragma: n
+00014fa0: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
+00014fb0: 2020 2020 2020 2020 7365 6c66 2e64 6566          self.def
+00014fc0: 6175 6c74 5f6c 6f67 6765 722e 6465 6275  ault_logger.debu
+00014fd0: 6728 652c 2065 7863 5f69 6e66 6f3d 5472  g(e, exc_info=Tr
+00014fe0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00014ff0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00015000: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00015010: 2020 2020 2020 2020 2020 234c 6574 2773            #Let's
+00015020: 2067 6574 2074 6865 2066 6169 7220 7661   get the fair va
+00015030: 6c75 652c 2065 6974 6865 7220 7361 7665  lue, either save
+00015040: 6420 6f72 2066 7265 7368 2066 726f 6d20  d or fresh from 
+00015050: 7365 7276 6963 650a 2020 2020 2020 2020  service.        
+00015060: 2020 2020 2020 2020 6661 6972 5661 6c75          fairValu
+00015070: 6520 3d20 7365 6c66 2e67 6574 4661 6972  e = self.getFair
+00015080: 5661 6c75 6528 7374 6f63 6b2c 686f 7374  Value(stock,host
+00015090: 4461 7461 2c66 6f72 6365 3d28 686f 7374  Data,force=(host
+000150a0: 4461 7461 2069 7320 4e6f 6e65 206f 7220  Data is None or 
+000150b0: 686f 7374 4461 7461 2e65 6d70 7479 206f  hostData.empty o
+000150c0: 7220 2246 6169 7256 616c 7565 2220 6e6f  r "FairValue" no
+000150d0: 7420 696e 2068 6f73 7444 6174 612e 636f  t in hostData.co
+000150e0: 6c75 6d6e 7329 2c65 7863 6861 6e67 654e  lumns),exchangeN
+000150f0: 616d 653d 6578 6368 616e 6765 4e61 6d65  ame=exchangeName
+00015100: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015110: 2020 6966 2066 6169 7256 616c 7565 2069    if fairValue i
+00015120: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2066  s not None and f
+00015130: 6169 7256 616c 7565 2021 3d20 303a 0a20  airValue != 0:. 
+00015140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015150: 2020 206c 7470 203d 2073 6176 6544 6963     ltp = saveDic
+00015160: 745b 224c 5450 225d 0a20 2020 2020 2020  t["LTP"].       
+00015170: 2020 2020 2020 2020 2020 2020 2066 6169               fai
+00015180: 7256 616c 7565 4469 6666 203d 2072 6f75  rValueDiff = rou
+00015190: 6e64 2866 6169 7256 616c 7565 202d 206c  nd(fairValue - l
+000151a0: 7470 2c30 290a 2020 2020 2020 2020 2020  tp,0).          
+000151b0: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
+000151c0: 6374 5b22 4661 6972 5661 6c75 6522 5d20  ct["FairValue"] 
+000151d0: 3d20 7374 7228 6661 6972 5661 6c75 6529  = str(fairValue)
+000151e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000151f0: 2020 2020 2073 6176 6544 6963 745b 2246       saveDict["F
+00015200: 5644 6966 6622 5d20 3d20 6661 6972 5661  VDiff"] = fairVa
+00015210: 6c75 6544 6966 660a 2020 2020 2020 2020  lueDiff.        
+00015220: 2020 2020 2020 2020 2020 2020 7363 7265              scre
+00015230: 656e 4469 6374 5b22 4656 4469 6666 225d  enDict["FVDiff"]
+00015240: 203d 2066 6169 7256 616c 7565 4469 6666   = fairValueDiff
+00015250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015260: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+00015270: 2246 6169 7256 616c 7565 225d 203d 2028  "FairValue"] = (
+00015280: 636f 6c6f 7254 6578 742e 4752 4545 4e20  colorText.GREEN 
+00015290: 6966 2066 6169 7256 616c 7565 203e 3d20  if fairValue >= 
+000152a0: 6c74 7020 656c 7365 2063 6f6c 6f72 5465  ltp else colorTe
+000152b0: 7874 2e46 4149 4c29 202b 2073 6176 6544  xt.FAIL) + saveD
+000152c0: 6963 745b 2246 6169 7256 616c 7565 225d  ict["FairValue"]
+000152d0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+000152e0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+000152f0: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00015300: 2065 3a20 2023 2070 7261 676d 613a 206e   e:  # pragma: n
+00015310: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
+00015320: 2020 2020 2020 2020 7365 6c66 2e64 6566          self.def
+00015330: 6175 6c74 5f6c 6f67 6765 722e 6465 6275  ault_logger.debu
+00015340: 6728 652c 2065 7863 5f69 6e66 6f3d 5472  g(e, exc_info=Tr
+00015350: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00015360: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00015370: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00015380: 2020 6966 206d 665f 696e 7374 5f6f 776e    if mf_inst_own
+00015390: 6572 7368 6970 4368 616e 6765 203e 2030  ershipChange > 0
+000153a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000153b0: 2020 6d66 203d 2066 224d 4649 3ae2 96b2    mf = f"MFI:...
+000153c0: 207b 6368 616e 6765 5f6d 696c 6c69 6f6e   {change_million
+000153d0: 737d 220a 2020 2020 2020 2020 2020 2020  s}".            
+000153e0: 2020 2020 6d66 7320 3d20 636f 6c6f 7254      mfs = colorT
+000153f0: 6578 742e 4752 4545 4e20 2b20 6d66 202b  ext.GREEN + mf +
+00015400: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+00015410: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00015420: 6d66 5f69 6e73 745f 6f77 6e65 7273 6869  mf_inst_ownershi
+00015430: 7043 6861 6e67 6520 3c20 303a 0a20 2020  pChange < 0:.   
+00015440: 2020 2020 2020 2020 2020 2020 206d 6620               mf 
+00015450: 3d20 6622 4d46 493a e296 bc20 7b63 6861  = f"MFI:... {cha
+00015460: 6e67 655f 6d69 6c6c 696f 6e73 7d22 0a20  nge_millions}". 
+00015470: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00015480: 6673 203d 2063 6f6c 6f72 5465 7874 2e46  fs = colorText.F
+00015490: 4149 4c20 2b20 6d66 202b 2063 6f6c 6f72  AIL + mf + color
+000154a0: 5465 7874 2e45 4e44 0a0a 2020 2020 2020  Text.END..      
+000154b0: 2020 7361 7665 6420 3d20 7365 6c66 2e66    saved = self.f
+000154c0: 696e 6443 7572 7265 6e74 5361 7665 6456  indCurrentSavedV
+000154d0: 616c 7565 2873 6372 6565 6e44 6963 742c  alue(screenDict,
+000154e0: 7361 7665 4469 6374 2c22 5472 656e 6422  saveDict,"Trend"
+000154f0: 290a 2020 2020 2020 2020 6465 6369 7369  ).        decisi
+00015500: 6f6e 5f73 6372 203d 2028 636f 6c6f 7254  on_scr = (colorT
+00015510: 6578 742e 4752 4545 4e20 6966 2069 7355  ext.GREEN if isU
+00015520: 7074 7265 6e64 2065 6c73 6520 2863 6f6c  ptrend else (col
+00015530: 6f72 5465 7874 2e46 4149 4c20 6966 2069  orText.FAIL if i
+00015540: 7344 6f77 6e74 7265 6e64 2065 6c73 6520  sDowntrend else 
+00015550: 636f 6c6f 7254 6578 742e 5741 524e 2929  colorText.WARN))
+00015560: 202b 2066 227b 6465 6369 7369 6f6e 7d22   + f"{decision}"
+00015570: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+00015580: 0a20 2020 2020 2020 2064 6d61 3530 6465  .        dma50de
+00015590: 6369 7369 6f6e 5f73 6372 203d 2028 636f  cision_scr = (co
+000155a0: 6c6f 7254 6578 742e 4752 4545 4e20 6966  lorText.GREEN if
+000155b0: 2069 7335 3044 4d41 5570 7472 656e 6420   is50DMAUptrend 
+000155c0: 656c 7365 2028 636f 6c6f 7254 6578 742e  else (colorText.
+000155d0: 4641 494c 2069 6620 6973 3530 444d 4144  FAIL if is50DMAD
+000155e0: 6f77 6e74 7265 6e64 2065 6c73 6520 636f  owntrend else co
+000155f0: 6c6f 7254 6578 742e 5741 524e 2929 202b  lorText.WARN)) +
+00015600: 2066 227b 646d 6135 3064 6563 6973 696f   f"{dma50decisio
+00015610: 6e7d 2220 2b20 636f 6c6f 7254 6578 742e  n}" + colorText.
+00015620: 454e 440a 2020 2020 2020 2020 7361 7665  END.        save
+00015630: 4469 6374 5b22 5472 656e 6422 5d20 3d20  Dict["Trend"] = 
+00015640: 6622 7b73 6176 6564 5b31 5d7d 207b 6465  f"{saved[1]} {de
+00015650: 6369 7369 6f6e 7d20 7b64 6d61 3530 6465  cision} {dma50de
+00015660: 6369 7369 6f6e 7d20 7b6d 667d 220a 2020  cision} {mf}".  
+00015670: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+00015680: 5b22 5472 656e 6422 5d20 3d20 6622 7b73  ["Trend"] = f"{s
+00015690: 6176 6564 5b30 5d7d 207b 6465 6369 7369  aved[0]} {decisi
+000156a0: 6f6e 5f73 6372 7d20 7b64 6d61 3530 6465  on_scr} {dma50de
+000156b0: 6369 7369 6f6e 5f73 6372 7d20 7b6d 6673  cision_scr} {mfs
+000156c0: 7d22 0a20 2020 2020 2020 2073 6176 6544  }".        saveD
+000156d0: 6963 745b 224d 4649 225d 203d 206d 665f  ict["MFI"] = mf_
+000156e0: 696e 7374 5f6f 776e 6572 7368 6970 4368  inst_ownershipCh
+000156f0: 616e 6765 0a20 2020 2020 2020 2073 6372  ange.        scr
+00015700: 6565 6e44 6963 745b 224d 4649 225d 203d  eenDict["MFI"] =
+00015710: 206d 665f 696e 7374 5f6f 776e 6572 7368   mf_inst_ownersh
+00015720: 6970 4368 616e 6765 0a20 2020 2020 2020  ipChange.       
+00015730: 2072 6574 7572 6e20 6973 5570 7472 656e   return isUptren
+00015740: 642c 206d 665f 696e 7374 5f6f 776e 6572  d, mf_inst_owner
+00015750: 7368 6970 4368 616e 6765 2c20 6661 6972  shipChange, fair
+00015760: 5661 6c75 6544 6966 660a 2020 2020 0a20  ValueDiff.    . 
+00015770: 2020 2023 2050 7269 7661 7465 206d 6574     # Private met
+00015780: 686f 6420 746f 2066 696e 6420 6361 6e64  hod to find cand
+00015790: 6c65 2074 7970 650a 2020 2020 2320 5472  le type.    # Tr
+000157a0: 7565 203d 2042 756c 6c69 7368 2c20 4661  ue = Bullish, Fa
+000157b0: 6c73 6520 3d20 4265 6172 6973 680a 2020  lse = Bearish.  
+000157c0: 2020 6465 6620 6765 7443 616e 646c 6554    def getCandleT
+000157d0: 7970 6528 7365 6c66 2c20 6461 696c 7944  ype(self, dailyD
+000157e0: 6174 6129 3a0a 2020 2020 2020 2020 7265  ata):.        re
+000157f0: 7475 726e 2062 6f6f 6c28 6461 696c 7944  turn bool(dailyD
+00015800: 6174 615b 2243 6c6f 7365 225d 2e69 6c6f  ata["Close"].ilo
+00015810: 635b 305d 203e 3d20 6461 696c 7944 6174  c[0] >= dailyDat
+00015820: 615b 224f 7065 6e22 5d2e 696c 6f63 5b30  a["Open"].iloc[0
+00015830: 5d29 0a0a 2020 2020 6465 6620 6765 7443  ])..    def getC
+00015840: 616e 646c 6542 6f64 7948 6569 6768 7428  andleBodyHeight(
+00015850: 7365 6c66 2c20 6461 696c 7944 6174 6129  self, dailyData)
+00015860: 3a0a 2020 2020 2020 2020 626f 6479 4865  :.        bodyHe
+00015870: 6967 6874 203d 2064 6169 6c79 4461 7461  ight = dailyData
+00015880: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+00015890: 5d20 2d20 6461 696c 7944 6174 615b 224f  ] - dailyData["O
+000158a0: 7065 6e22 5d2e 696c 6f63 5b30 5d0a 2020  pen"].iloc[0].  
+000158b0: 2020 2020 2020 7265 7475 726e 2062 6f64        return bod
+000158c0: 7948 6569 6768 740a 0a20 2020 2064 6566  yHeight..    def
+000158d0: 2067 6574 4661 6972 5661 6c75 6528 7365   getFairValue(se
+000158e0: 6c66 2c20 7374 6f63 6b2c 2068 6f73 7444  lf, stock, hostD
+000158f0: 6174 613d 4e6f 6e65 2c20 666f 7263 653d  ata=None, force=
+00015900: 4661 6c73 652c 6578 6368 616e 6765 4e61  False,exchangeNa
+00015910: 6d65 3d22 494e 4449 4122 293a 0a20 2020  me="INDIA"):.   
+00015920: 2020 2020 2069 6620 686f 7374 4461 7461       if hostData
+00015930: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
+00015940: 686f 7374 4461 7461 2920 3c20 313a 0a20  hostData) < 1:. 
+00015950: 2020 2020 2020 2020 2020 2068 6f73 7444             hostD
+00015960: 6174 6120 3d20 7064 2e44 6174 6146 7261  ata = pd.DataFra
+00015970: 6d65 2829 0a20 2020 2020 2020 2023 204c  me().        # L
+00015980: 6574 2773 206c 6f6f 6b20 666f 7220 6661  et's look for fa
+00015990: 6972 2076 616c 7565 730a 2020 2020 2020  ir values.      
+000159a0: 2020 6661 6972 5661 6c75 6520 3d20 300a    fairValue = 0.
+000159b0: 2020 2020 2020 2020 6966 2022 4661 6972          if "Fair
+000159c0: 5661 6c75 6522 2069 6e20 686f 7374 4461  Value" in hostDa
+000159d0: 7461 2e63 6f6c 756d 6e73 2061 6e64 2050  ta.columns and P
+000159e0: 4b44 6174 6555 7469 6c69 7469 6573 2e63  KDateUtilities.c
+000159f0: 7572 7265 6e74 4461 7465 5469 6d65 2829  urrentDateTime()
+00015a00: 2e77 6565 6b64 6179 2829 203c 3d20 343a  .weekday() <= 4:
+00015a10: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+00015a20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015a30: 2020 6661 6972 5661 6c75 6520 3d20 686f    fairValue = ho
+00015a40: 7374 4461 7461 2e6c 6f63 5b68 6f73 7444  stData.loc[hostD
+00015a50: 6174 612e 696e 6465 785b 2d31 5d2c 2246  ata.index[-1],"F
+00015a60: 6169 7256 616c 7565 225d 0a20 2020 2020  airValue"].     
+00015a70: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
+00015a80: 6579 4572 726f 722c 496e 6465 7845 7272  eyError,IndexErr
+00015a90: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00015aa0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00015ab0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00015ac0: 2020 2020 2020 2020 6966 2050 4b44 6174          if PKDat
+00015ad0: 6555 7469 6c69 7469 6573 2e63 7572 7265  eUtilities.curre
+00015ae0: 6e74 4461 7465 5469 6d65 2829 2e77 6565  ntDateTime().wee
+00015af0: 6b64 6179 2829 203e 3d20 3520 6f72 2066  kday() >= 5 or f
+00015b00: 6f72 6365 3a0a 2020 2020 2020 2020 2020  orce:.          
+00015b10: 2020 2020 2020 7365 6375 7269 7479 203d        security =
+00015b20: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00015b30: 2020 2020 2020 2320 5265 6672 6573 6820        # Refresh 
+00015b40: 6561 6368 2073 6174 7572 6461 7920 6f72  each saturday or
+00015b50: 2073 756e 6461 7920 6f72 2077 6865 6e20   sunday or when 
+00015b60: 6e6f 7420 666f 756e 6420 696e 2073 6176  not found in sav
+00015b70: 6564 2064 6174 610a 2020 2020 2020 2020  ed data.        
+00015b80: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00015b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ba0: 2077 6974 6820 5375 7070 7265 7373 4f75   with SuppressOu
+00015bb0: 7470 7574 2873 7570 7072 6573 735f 7374  tput(suppress_st
+00015bc0: 6465 7272 3d54 7275 652c 2073 7570 7072  derr=True, suppr
+00015bd0: 6573 735f 7374 646f 7574 3d54 7275 6529  ess_stdout=True)
+00015be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015bf0: 2020 2020 2020 2020 2020 7365 6375 7269            securi
+00015c00: 7479 203d 2053 746f 636b 2873 746f 636b  ty = Stock(stock
+00015c10: 2c65 7863 6861 6e67 653d 6578 6368 616e  ,exchange=exchan
+00015c20: 6765 4e61 6d65 290a 2020 2020 2020 2020  geName).        
+00015c30: 2020 2020 2020 2020 6578 6365 7074 2056          except V
+00015c40: 616c 7565 4572 726f 723a 2023 2070 7261  alueError: # pra
+00015c50: 676d 613a 206e 6f20 636f 7665 720a 2020  gma: no cover.  
+00015c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c70: 2020 2320 5765 2064 6964 206e 6f74 2066    # We did not f
+00015c80: 696e 6420 7468 6520 7374 6f63 6b3f 2049  ind the stock? I
+00015c90: 7427 7320 6f6b 6179 2e20 4d6f 7665 206f  t's okay. Move o
+00015ca0: 6e20 746f 2074 6865 206e 6578 7420 6f6e  n to the next on
+00015cb0: 652e 0a20 2020 2020 2020 2020 2020 2020  e..             
+00015cc0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00015cd0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00015ce0: 7074 2028 5469 6d65 6f75 7445 7272 6f72  pt (TimeoutError
+00015cf0: 2c20 436f 6e6e 6563 7469 6f6e 4572 726f  , ConnectionErro
+00015d00: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
+00015d10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00015d20: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
+00015d30: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
+00015d40: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
+00015d50: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00015d60: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00015d70: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00015d80: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+00015d90: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00015da0: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
+00015db0: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
+00015dc0: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
+00015dd0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00015de0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00015df0: 2020 6966 2073 6563 7572 6974 7920 6973    if security is
+00015e00: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00015e10: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00015e20: 6974 6820 5375 7070 7265 7373 4f75 7470  ith SuppressOutp
+00015e30: 7574 2873 7570 7072 6573 735f 7374 6465  ut(suppress_stde
+00015e40: 7272 3d54 7275 652c 2073 7570 7072 6573  rr=True, suppres
+00015e50: 735f 7374 646f 7574 3d54 7275 6529 3a0a  s_stdout=True):.
+00015e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e70: 2020 2020 2020 2020 6676 203d 2073 6563          fv = sec
+00015e80: 7572 6974 792e 6661 6972 5661 6c75 6528  urity.fairValue(
+00015e90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015ea0: 2020 2020 2020 6966 2066 7620 6973 206e        if fv is n
+00015eb0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00015ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ed0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00015ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ef0: 2020 6676 5265 7370 6f6e 7365 5661 6c75    fvResponseValu
+00015f00: 6520 3d20 6676 5b22 6c61 7465 7374 4661  e = fv["latestFa
+00015f10: 6972 5661 6c75 6522 5d0a 2020 2020 2020  irValue"].      
+00015f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f30: 2020 2020 2020 6966 2066 7652 6573 706f        if fvRespo
+00015f40: 6e73 6556 616c 7565 2069 7320 6e6f 7420  nseValue is not 
+00015f50: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00015f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f70: 2020 2020 2020 6661 6972 5661 6c75 6520        fairValue 
+00015f80: 3d20 666c 6f61 7428 6676 5265 7370 6f6e  = float(fvRespon
+00015f90: 7365 5661 6c75 6529 0a20 2020 2020 2020  seValue).       
+00015fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015fb0: 2065 7863 6570 743a 2023 2070 7261 676d   except: # pragm
+00015fc0: 613a 206e 6f20 636f 7665 720a 2020 2020  a: no cover.    
+00015fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015fe0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00015ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016000: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
+00016010: 6465 6661 756c 745f 6c6f 6767 6572 2e64  default_logger.d
+00016020: 6562 7567 2866 227b 657d 5c6e 5265 7370  ebug(f"{e}\nResp
+00016030: 6f6e 7365 3a66 763a 5c6e 7b66 767d 222c  onse:fv:\n{fv}",
+00016040: 2065 7863 5f69 6e66 6f3d 5472 7565 290a   exc_info=True).
+00016050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016060: 2020 2020 6661 6972 5661 6c75 6520 3d20      fairValue = 
+00016070: 726f 756e 6428 666c 6f61 7428 6661 6972  round(float(fair
+00016080: 5661 6c75 6529 2c31 290a 2020 2020 2020  Value),1).      
+00016090: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+000160a0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+000160b0: 2020 2020 2020 2020 2020 2068 6f73 7444             hostD
+000160c0: 6174 612e 6c6f 635b 686f 7374 4461 7461  ata.loc[hostData
+000160d0: 2e69 6e64 6578 5b2d 315d 2c22 4661 6972  .index[-1],"Fair
+000160e0: 5661 6c75 6522 5d20 3d20 6661 6972 5661  Value"] = fairVa
+000160f0: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
+00016100: 2020 2020 2020 2020 6578 6365 7074 2028          except (
+00016110: 4b65 7945 7272 6f72 2c49 6e64 6578 4572  KeyError,IndexEr
+00016120: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
+00016130: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00016140: 7373 0a20 2020 2020 2020 2072 6574 7572  ss.        retur
+00016150: 6e20 6661 6972 5661 6c75 650a 0a20 2020  n fairValue..   
+00016160: 2064 6566 2067 6574 4d75 7475 616c 4675   def getMutualFu
+00016170: 6e64 5374 6174 7573 2873 656c 662c 2073  ndStatus(self, s
+00016180: 746f 636b 2c6f 6e6c 794d 463d 4661 6c73  tock,onlyMF=Fals
+00016190: 652c 2068 6f73 7444 6174 613d 4e6f 6e65  e, hostData=None
+000161a0: 2c20 666f 7263 653d 4661 6c73 652c 6578  , force=False,ex
+000161b0: 6368 616e 6765 4e61 6d65 3d22 494e 4449  changeName="INDI
+000161c0: 4122 293a 0a20 2020 2020 2020 2069 6620  A"):.        if 
+000161d0: 686f 7374 4461 7461 2069 7320 4e6f 6e65  hostData is None
+000161e0: 206f 7220 6c65 6e28 686f 7374 4461 7461   or len(hostData
+000161f0: 2920 3c20 313a 0a20 2020 2020 2020 2020  ) < 1:.         
+00016200: 2020 2068 6f73 7444 6174 6120 3d20 7064     hostData = pd
+00016210: 2e44 6174 6146 7261 6d65 2829 0a20 2020  .DataFrame().   
+00016220: 2020 2020 200a 2020 2020 2020 2020 6e65       .        ne
+00016230: 7443 6861 6e67 654d 4620 3d20 300a 2020  tChangeMF = 0.  
+00016240: 2020 2020 2020 6e65 7443 6861 6e67 6549        netChangeI
+00016250: 6e73 7420 3d20 300a 2020 2020 2020 2020  nst = 0.        
+00016260: 6c61 7465 7374 5f6d 6664 6174 6520 3d20  latest_mfdate = 
+00016270: 4e6f 6e65 0a20 2020 2020 2020 206c 6174  None.        lat
+00016280: 6573 745f 696e 7374 6461 7465 203d 204e  est_instdate = N
+00016290: 6f6e 650a 2020 2020 2020 2020 6e65 6564  one.        need
+000162a0: 7346 7265 7368 5570 6461 7465 203d 2054  sFreshUpdate = T
+000162b0: 7275 650a 2020 2020 2020 2020 6c61 7374  rue.        last
+000162c0: 4461 794c 6173 744d 6f6e 7468 203d 2050  DayLastMonth = P
+000162d0: 4b44 6174 6555 7469 6c69 7469 6573 2e6c  KDateUtilities.l
+000162e0: 6173 745f 6461 795f 6f66 5f70 7265 7669  ast_day_of_previ
+000162f0: 6f75 735f 6d6f 6e74 6828 504b 4461 7465  ous_month(PKDate
+00016300: 5574 696c 6974 6965 732e 6375 7272 656e  Utilities.curren
+00016310: 7444 6174 6554 696d 6528 2929 0a20 2020  tDateTime()).   
+00016320: 2020 2020 2069 6620 686f 7374 4461 7461       if hostData
+00016330: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00016340: 206c 656e 2868 6f73 7444 6174 6129 203e   len(hostData) >
+00016350: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00016360: 6966 2022 4d46 2220 696e 2068 6f73 7444  if "MF" in hostD
+00016370: 6174 612e 636f 6c75 6d6e 7320 6f72 2022  ata.columns or "
+00016380: 4649 4922 2069 6e20 686f 7374 4461 7461  FII" in hostData
+00016390: 2e63 6f6c 756d 6e73 3a0a 2020 2020 2020  .columns:.      
+000163a0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+000163b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163c0: 2020 206e 6574 4368 616e 6765 4d46 203d     netChangeMF =
+000163d0: 2068 6f73 7444 6174 612e 6c6f 635b 686f   hostData.loc[ho
+000163e0: 7374 4461 7461 2e69 6e64 6578 5b2d 315d  stData.index[-1]
+000163f0: 2c22 4d46 225d 0a20 2020 2020 2020 2020  ,"MF"].         
+00016400: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
+00016410: 6579 4572 726f 722c 496e 6465 7845 7272  eyError,IndexErr
+00016420: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00016430: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00016440: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00016450: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00016460: 2020 2020 2020 206e 6574 4368 616e 6765         netChange
+00016470: 496e 7374 203d 2068 6f73 7444 6174 612e  Inst = hostData.
+00016480: 6c6f 635b 686f 7374 4461 7461 2e69 6e64  loc[hostData.ind
+00016490: 6578 5b2d 315d 2c22 4649 4922 5d0a 2020  ex[-1],"FII"].  
+000164a0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+000164b0: 6365 7074 2028 4b65 7945 7272 6f72 2c49  cept (KeyError,I
+000164c0: 6e64 6578 4572 726f 7229 3a0a 2020 2020  ndexError):.    
+000164d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164e0: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
+000164f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00016500: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00016510: 7465 7374 5f6d 6664 6174 6520 3d20 686f  test_mfdate = ho
+00016520: 7374 4461 7461 2e6c 6f63 5b68 6f73 7444  stData.loc[hostD
+00016530: 6174 612e 696e 6465 785b 2d31 5d2c 224d  ata.index[-1],"M
+00016540: 465f 4461 7465 225d 0a20 2020 2020 2020  F_Date"].       
+00016550: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016560: 6973 696e 7374 616e 6365 286c 6174 6573  isinstance(lates
+00016570: 745f 6d66 6461 7465 2c20 666c 6f61 7429  t_mfdate, float)
+00016580: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016590: 2020 2020 2020 2020 2020 6c61 7465 7374            latest
+000165a0: 5f6d 6664 6174 6520 3d20 6461 7465 7469  _mfdate = dateti
+000165b0: 6d65 2e64 6174 6574 696d 652e 6672 6f6d  me.datetime.from
+000165c0: 7469 6d65 7374 616d 7028 6c61 7465 7374  timestamp(latest
+000165d0: 5f6d 6664 6174 6529 2e73 7472 6674 696d  _mfdate).strftim
+000165e0: 6528 2725 592d 256d 2d25 6427 290a 2020  e('%Y-%m-%d').  
+000165f0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00016600: 6365 7074 2028 4b65 7945 7272 6f72 2c49  cept (KeyError,I
+00016610: 6e64 6578 4572 726f 7229 3a0a 2020 2020  ndexError):.    
+00016620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016630: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
+00016640: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00016650: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00016660: 7465 7374 5f69 6e73 7464 6174 6520 3d20  test_instdate = 
+00016670: 686f 7374 4461 7461 2e6c 6f63 5b68 6f73  hostData.loc[hos
+00016680: 7444 6174 612e 696e 6465 785b 2d31 5d2c  tData.index[-1],
+00016690: 2246 4949 5f44 6174 6522 5d0a 2020 2020  "FII_Date"].    
+000166a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000166b0: 6966 2069 7369 6e73 7461 6e63 6528 6c61  if isinstance(la
+000166c0: 7465 7374 5f69 6e73 7464 6174 652c 2066  test_instdate, f
+000166d0: 6c6f 6174 293a 0a20 2020 2020 2020 2020  loat):.         
+000166e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000166f0: 6174 6573 745f 696e 7374 6461 7465 203d  atest_instdate =
+00016700: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
+00016710: 6d65 2e66 726f 6d74 696d 6573 7461 6d70  me.fromtimestamp
+00016720: 286c 6174 6573 745f 696e 7374 6461 7465  (latest_instdate
+00016730: 292e 7374 7266 7469 6d65 2827 2559 2d25  ).strftime('%Y-%
+00016740: 6d2d 2564 2729 0a20 2020 2020 2020 2020  m-%d').         
+00016750: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
+00016760: 6579 4572 726f 722c 496e 6465 7845 7272  eyError,IndexErr
+00016770: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00016780: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00016790: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000167a0: 206c 6174 6573 745f 6d66 6461 7465 2069   latest_mfdate i
+000167b0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000167c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000167d0: 7361 7665 645f 6d66 6461 7465 203d 2050  saved_mfdate = P
+000167e0: 4b44 6174 6555 7469 6c69 7469 6573 2e64  KDateUtilities.d
+000167f0: 6174 6546 726f 6d59 6d64 5374 7269 6e67  ateFromYmdString
+00016800: 286c 6174 6573 745f 6d66 6461 7465 2e73  (latest_mfdate.s
+00016810: 706c 6974 2822 5422 295b 305d 290a 2020  plit("T")[0]).  
+00016820: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00016830: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00016840: 2020 2020 2020 2020 7361 7665 645f 6d66          saved_mf
+00016850: 6461 7465 203d 206c 6173 7444 6179 4c61  date = lastDayLa
+00016860: 7374 4d6f 6e74 6820 2d20 6461 7465 7469  stMonth - dateti
+00016870: 6d65 2e74 696d 6564 656c 7461 2831 290a  me.timedelta(1).
+00016880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016890: 6966 206c 6174 6573 745f 696e 7374 6461  if latest_instda
+000168a0: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a0a  te is not None:.
+000168b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000168c0: 2020 2020 7361 7665 645f 696e 7374 6461      saved_instda
+000168d0: 7465 203d 2050 4b44 6174 6555 7469 6c69  te = PKDateUtili
+000168e0: 7469 6573 2e64 6174 6546 726f 6d59 6d64  ties.dateFromYmd
+000168f0: 5374 7269 6e67 286c 6174 6573 745f 696e  String(latest_in
+00016900: 7374 6461 7465 2e73 706c 6974 2822 5422  stdate.split("T"
+00016910: 295b 305d 290a 2020 2020 2020 2020 2020  )[0]).          
+00016920: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00016930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016940: 7361 7665 645f 696e 7374 6461 7465 203d  saved_instdate =
+00016950: 206c 6173 7444 6179 4c61 7374 4d6f 6e74   lastDayLastMont
+00016960: 6820 2d20 6461 7465 7469 6d65 2e74 696d  h - datetime.tim
+00016970: 6564 656c 7461 2831 290a 2020 2020 2020  edelta(1).      
+00016980: 2020 2020 2020 2020 2020 746f 6461 7920            today 
+00016990: 3d20 504b 4461 7465 5574 696c 6974 6965  = PKDateUtilitie
+000169a0: 732e 6375 7272 656e 7444 6174 6554 696d  s.currentDateTim
+000169b0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+000169c0: 2020 2020 6e65 6564 7346 7265 7368 5570      needsFreshUp
+000169d0: 6461 7465 203d 2028 7361 7665 645f 6d66  date = (saved_mf
+000169e0: 6461 7465 2e64 6174 6528 2920 3c20 6c61  date.date() < la
+000169f0: 7374 4461 794c 6173 744d 6f6e 7468 2e64  stDayLastMonth.d
+00016a00: 6174 6528 2929 2061 6e64 2028 7361 7665  ate()) and (save
+00016a10: 645f 696e 7374 6461 7465 2e64 6174 6528  d_instdate.date(
+00016a20: 2920 3c20 6c61 7374 4461 794c 6173 744d  ) < lastDayLastM
+00016a30: 6f6e 7468 2e64 6174 6528 2929 0a20 2020  onth.date()).   
+00016a40: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00016a50: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00016a60: 6565 6473 4672 6573 6855 7064 6174 6520  eedsFreshUpdate 
+00016a70: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
+00016a80: 6966 206e 6565 6473 4672 6573 6855 7064  if needsFreshUpd
+00016a90: 6174 6520 616e 6420 666f 7263 653a 0a20  ate and force:. 
+00016aa0: 2020 2020 2020 2020 2020 206e 6574 4368             netCh
+00016ab0: 616e 6765 4d46 2c20 6e65 7443 6861 6e67  angeMF, netChang
+00016ac0: 6549 6e73 742c 206c 6174 6573 745f 6d66  eInst, latest_mf
+00016ad0: 6461 7465 2c20 6c61 7465 7374 5f69 6e73  date, latest_ins
+00016ae0: 7464 6174 6520 3d20 7365 6c66 2e67 6574  tdate = self.get
+00016af0: 4672 6573 684d 4649 5374 6174 7573 2873  FreshMFIStatus(s
+00016b00: 746f 636b 2c65 7863 6861 6e67 654e 616d  tock,exchangeNam
+00016b10: 653d 6578 6368 616e 6765 4e61 6d65 290a  e=exchangeName).
+00016b20: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00016b30: 6574 4368 616e 6765 4d46 2069 7320 6e6f  etChangeMF is no
+00016b40: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00016b50: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00016b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b70: 2068 6f73 7444 6174 612e 6c6f 635b 686f   hostData.loc[ho
+00016b80: 7374 4461 7461 2e69 6e64 6578 5b2d 315d  stData.index[-1]
+00016b90: 2c22 4d46 225d 203d 206e 6574 4368 616e  ,"MF"] = netChan
+00016ba0: 6765 4d46 0a20 2020 2020 2020 2020 2020  geMF.           
+00016bb0: 2020 2020 2065 7863 6570 7420 284b 6579       except (Key
+00016bc0: 4572 726f 722c 496e 6465 7845 7272 6f72  Error,IndexError
+00016bd0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00016be0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00016bf0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00016c00: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00016c10: 7443 6861 6e67 654d 4620 3d20 300a 2020  tChangeMF = 0.  
+00016c20: 2020 2020 2020 2020 2020 6966 206c 6174            if lat
+00016c30: 6573 745f 6d66 6461 7465 2069 7320 6e6f  est_mfdate is no
+00016c40: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00016c50: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00016c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c70: 2068 6f73 7444 6174 612e 6c6f 635b 686f   hostData.loc[ho
+00016c80: 7374 4461 7461 2e69 6e64 6578 5b2d 315d  stData.index[-1]
+00016c90: 2c22 4d46 5f44 6174 6522 5d20 3d20 6c61  ,"MF_Date"] = la
+00016ca0: 7465 7374 5f6d 6664 6174 650a 2020 2020  test_mfdate.    
+00016cb0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00016cc0: 7074 2028 4b65 7945 7272 6f72 2c49 6e64  pt (KeyError,Ind
+00016cd0: 6578 4572 726f 7229 3a0a 2020 2020 2020  exError):.      
+00016ce0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00016cf0: 7373 0a20 2020 2020 2020 2020 2020 2069  ss.            i
+00016d00: 6620 6e65 7443 6861 6e67 6549 6e73 7420  f netChangeInst 
+00016d10: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00016d20: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00016d30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016d40: 2020 2020 2020 686f 7374 4461 7461 2e6c        hostData.l
+00016d50: 6f63 5b68 6f73 7444 6174 612e 696e 6465  oc[hostData.inde
+00016d60: 785b 2d31 5d2c 2246 4949 225d 203d 206e  x[-1],"FII"] = n
+00016d70: 6574 4368 616e 6765 496e 7374 0a20 2020  etChangeInst.   
+00016d80: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00016d90: 6570 7420 284b 6579 4572 726f 722c 496e  ept (KeyError,In
+00016da0: 6465 7845 7272 6f72 293a 0a20 2020 2020  dexError):.     
+00016db0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00016dc0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+00016dd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00016de0: 2020 2020 2020 6e65 7443 6861 6e67 6549        netChangeI
+00016df0: 6e73 7420 3d20 300a 2020 2020 2020 2020  nst = 0.        
+00016e00: 2020 2020 6966 206c 6174 6573 745f 696e      if latest_in
+00016e10: 7374 6461 7465 2069 7320 6e6f 7420 4e6f  stdate is not No
+00016e20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00016e30: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00016e40: 2020 2020 2020 2020 2020 2020 2068 6f73               hos
+00016e50: 7444 6174 612e 6c6f 635b 686f 7374 4461  tData.loc[hostDa
+00016e60: 7461 2e69 6e64 6578 5b2d 315d 2c22 4649  ta.index[-1],"FI
+00016e70: 495f 4461 7465 225d 203d 206c 6174 6573  I_Date"] = lates
+00016e80: 745f 696e 7374 6461 7465 0a20 2020 2020  t_instdate.     
+00016e90: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00016ea0: 7420 284b 6579 4572 726f 722c 496e 6465  t (KeyError,Inde
+00016eb0: 7845 7272 6f72 293a 0a20 2020 2020 2020  xError):.       
+00016ec0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00016ed0: 730a 2020 2020 2020 2020 6c61 7374 4461  s.        lastDa
+00016ee0: 794c 6173 744d 6f6e 7468 203d 206c 6173  yLastMonth = las
+00016ef0: 7444 6179 4c61 7374 4d6f 6e74 682e 7374  tDayLastMonth.st
+00016f00: 7266 7469 6d65 2822 2559 2d25 6d2d 2564  rftime("%Y-%m-%d
+00016f10: 5430 303a 3030 3a30 302e 3030 3022 290a  T00:00:00.000").
+00016f20: 2020 2020 2020 2020 6966 206f 6e6c 794d          if onlyM
+00016f30: 463a 0a20 2020 2020 2020 2020 2020 2072  F:.            r
+00016f40: 6574 7572 6e20 6e65 7443 6861 6e67 654d  eturn netChangeM
+00016f50: 460a 2020 2020 2020 2020 6966 206c 6174  F.        if lat
+00016f60: 6573 745f 696e 7374 6461 7465 203d 3d20  est_instdate == 
+00016f70: 6c61 7465 7374 5f6d 6664 6174 653a 0a20  latest_mfdate:. 
+00016f80: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00016f90: 6e20 286e 6574 4368 616e 6765 4d46 202b  n (netChangeMF +
+00016fa0: 206e 6574 4368 616e 6765 496e 7374 290a   netChangeInst).
+00016fb0: 2020 2020 2020 2020 656c 6966 206c 6174          elif lat
+00016fc0: 6573 745f 6d66 6461 7465 203d 3d20 6c61  est_mfdate == la
+00016fd0: 7374 4461 794c 6173 744d 6f6e 7468 3a0a  stDayLastMonth:.
+00016fe0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00016ff0: 726e 206e 6574 4368 616e 6765 4d46 0a20  rn netChangeMF. 
+00017000: 2020 2020 2020 2065 6c69 6620 6c61 7465         elif late
+00017010: 7374 5f69 6e73 7464 6174 6520 3d3d 206c  st_instdate == l
+00017020: 6173 7444 6179 4c61 7374 4d6f 6e74 683a  astDayLastMonth:
+00017030: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00017040: 7572 6e20 6e65 7443 6861 6e67 6549 6e73  urn netChangeIns
+00017050: 740a 2020 2020 2020 2020 656c 7365 3a0a  t.        else:.
+00017060: 2020 2020 2020 2020 2020 2020 2320 6669              # fi
+00017070: 6e64 2074 6865 206c 6174 6573 7420 6461  nd the latest da
+00017080: 7465 0a20 2020 2020 2020 2020 2020 2069  te.            i
+00017090: 6620 6c61 7465 7374 5f6d 6664 6174 6520  f latest_mfdate 
+000170a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000170b0: 2020 2020 2020 2020 2020 2020 206c 6174               lat
+000170c0: 6573 745f 6d66 6461 7465 203d 2050 4b44  est_mfdate = PKD
+000170d0: 6174 6555 7469 6c69 7469 6573 2e64 6174  ateUtilities.dat
+000170e0: 6546 726f 6d59 6d64 5374 7269 6e67 286c  eFromYmdString(l
+000170f0: 6174 6573 745f 6d66 6461 7465 2e73 706c  atest_mfdate.spl
+00017100: 6974 2822 5422 295b 305d 290a 2020 2020  it("T")[0]).    
+00017110: 2020 2020 2020 2020 6966 206c 6174 6573          if lates
+00017120: 745f 696e 7374 6461 7465 2069 7320 6e6f  t_instdate is no
+00017130: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00017140: 2020 2020 2020 2020 6c61 7465 7374 5f69          latest_i
+00017150: 6e73 7464 6174 6520 3d20 504b 4461 7465  nstdate = PKDate
+00017160: 5574 696c 6974 6965 732e 6461 7465 4672  Utilities.dateFr
+00017170: 6f6d 596d 6453 7472 696e 6728 6c61 7465  omYmdString(late
+00017180: 7374 5f69 6e73 7464 6174 652e 7370 6c69  st_instdate.spli
+00017190: 7428 2254 2229 5b30 5d29 0a20 2020 2020  t("T")[0]).     
+000171a0: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
+000171b0: 7443 6861 6e67 654d 4620 6966 2028 286c  tChangeMF if ((l
+000171c0: 6174 6573 745f 6d66 6461 7465 2069 7320  atest_mfdate is 
+000171d0: 6e6f 7420 4e6f 6e65 2920 616e 6420 6c61  not None) and la
+000171e0: 7465 7374 5f6d 6664 6174 6520 3e20 286c  test_mfdate > (l
+000171f0: 6174 6573 745f 696e 7374 6461 7465 2069  atest_instdate i
+00017200: 6620 6c61 7465 7374 5f69 6e73 7464 6174  f latest_instdat
+00017210: 6520 6973 206e 6f74 204e 6f6e 6520 656c  e is not None el
+00017220: 7365 2028 6c61 7465 7374 5f6d 6664 6174  se (latest_mfdat
+00017230: 6520 2d20 6461 7465 7469 6d65 2e74 696d  e - datetime.tim
+00017240: 6564 656c 7461 2831 2929 2929 2065 6c73  edelta(1)))) els
+00017250: 6520 6e65 7443 6861 6e67 6549 6e73 740a  e netChangeInst.
+00017260: 0a20 2020 2064 6566 2067 6574 4672 6573  .    def getFres
+00017270: 684d 4649 5374 6174 7573 2873 656c 662c  hMFIStatus(self,
+00017280: 2073 746f 636b 2c65 7863 6861 6e67 654e   stock,exchangeN
+00017290: 616d 653d 2249 4e44 4941 2229 3a0a 2020  ame="INDIA"):.  
+000172a0: 2020 2020 2020 6368 616e 6765 5374 6174        changeStat
+000172b0: 7573 4461 7461 4d46 203d 204e 6f6e 650a  usDataMF = None.
+000172c0: 2020 2020 2020 2020 6368 616e 6765 5374          changeSt
+000172d0: 6174 7573 4461 7461 496e 7374 203d 204e  atusDataInst = N
+000172e0: 6f6e 650a 2020 2020 2020 2020 6e65 7443  one.        netC
+000172f0: 6861 6e67 654d 4620 3d20 300a 2020 2020  hangeMF = 0.    
+00017300: 2020 2020 6e65 7443 6861 6e67 6549 6e73      netChangeIns
+00017310: 7420 3d20 300a 2020 2020 2020 2020 6c61  t = 0.        la
+00017320: 7465 7374 5f6d 6664 6174 6520 3d20 4e6f  test_mfdate = No
+00017330: 6e65 0a20 2020 2020 2020 206c 6174 6573  ne.        lates
+00017340: 745f 696e 7374 6461 7465 203d 204e 6f6e  t_instdate = Non
+00017350: 650a 2020 2020 2020 2020 7365 6375 7269  e.        securi
+00017360: 7479 203d 204e 6f6e 650a 2020 2020 2020  ty = None.      
+00017370: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00017380: 2020 2077 6974 6820 5375 7070 7265 7373     with Suppress
+00017390: 4f75 7470 7574 2873 7570 7072 6573 735f  Output(suppress_
+000173a0: 7374 6465 7272 3d54 7275 652c 2073 7570  stderr=True, sup
+000173b0: 7072 6573 735f 7374 646f 7574 3d54 7275  press_stdout=Tru
+000173c0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000173d0: 2020 2020 7365 6375 7269 7479 203d 2053      security = S
+000173e0: 746f 636b 2873 746f 636b 2c65 7863 6861  tock(stock,excha
+000173f0: 6e67 653d 6578 6368 616e 6765 4e61 6d65  nge=exchangeName
+00017400: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00017410: 2056 616c 7565 4572 726f 723a 0a20 2020   ValueError:.   
+00017420: 2020 2020 2020 2020 2023 2057 6520 6469           # We di
+00017430: 6420 6e6f 7420 6669 6e64 2074 6865 2073  d not find the s
+00017440: 746f 636b 3f20 4974 2773 206f 6b61 792e  tock? It's okay.
+00017450: 204d 6f76 6520 6f6e 2074 6f20 7468 6520   Move on to the 
+00017460: 6e65 7874 206f 6e65 2e0a 2020 2020 2020  next one..      
+00017470: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00017480: 2020 2065 7863 6570 7420 2854 696d 656f     except (Timeo
+00017490: 7574 4572 726f 722c 2043 6f6e 6e65 6374  utError, Connect
+000174a0: 696f 6e45 7272 6f72 2920 6173 2065 3a0a  ionError) as e:.
+000174b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000174c0: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
+000174d0: 6465 6275 6728 652c 2065 7863 5f69 6e66  debug(e, exc_inf
+000174e0: 6f3d 5472 7565 290a 2020 2020 2020 2020  o=True).        
+000174f0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00017500: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00017510: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+00017520: 2020 2020 7365 6c66 2e64 6566 6175 6c74      self.default
+00017530: 5f6c 6f67 6765 722e 6465 6275 6728 652c  _logger.debug(e,
+00017540: 2065 7863 5f69 6e66 6f3d 5472 7565 290a   exc_info=True).
+00017550: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00017560: 0a20 2020 2020 2020 2069 6620 7365 6375  .        if secu
+00017570: 7269 7479 2069 7320 6e6f 7420 4e6f 6e65  rity is not None
+00017580: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+00017590: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+000175a0: 2020 2077 6974 6820 5375 7070 7265 7373     with Suppress
+000175b0: 4f75 7470 7574 2873 7570 7072 6573 735f  Output(suppress_
+000175c0: 7374 6465 7272 3d54 7275 652c 2073 7570  stderr=True, sup
+000175d0: 7072 6573 735f 7374 646f 7574 3d54 7275  press_stdout=Tru
+000175e0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000175f0: 2020 2020 2020 2020 6368 616e 6765 5374          changeSt
+00017600: 6174 7573 526f 7773 4d46 203d 2073 6563  atusRowsMF = sec
+00017610: 7572 6974 792e 6d75 7475 616c 4675 6e64  urity.mutualFund
+00017620: 4f77 6e65 7273 6869 7028 746f 703d 3529  Ownership(top=5)
+00017630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017640: 2020 2020 2063 6861 6e67 6553 7461 7475       changeStatu
+00017650: 7352 6f77 7349 6e73 7420 3d20 7365 6375  sRowsInst = secu
+00017660: 7269 7479 2e69 6e73 7469 7475 7469 6f6e  rity.institution
+00017670: 4f77 6e65 7273 6869 7028 746f 703d 3529  Ownership(top=5)
+00017680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017690: 2020 2020 2063 6861 6e67 6553 7461 7475       changeStatu
+000176a0: 7344 6174 614d 4620 3d20 7365 6375 7269  sDataMF = securi
+000176b0: 7479 2e6d 7574 7561 6c46 756e 6446 4949  ty.mutualFundFII
+000176c0: 4368 616e 6765 4461 7461 2863 6861 6e67  ChangeData(chang
+000176d0: 6553 7461 7475 7352 6f77 734d 4629 0a20  eStatusRowsMF). 
+000176e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176f0: 2020 2063 6861 6e67 6553 7461 7475 7344     changeStatusD
+00017700: 6174 6149 6e73 7420 3d20 7365 6375 7269  ataInst = securi
+00017710: 7479 2e6d 7574 7561 6c46 756e 6446 4949  ty.mutualFundFII
+00017720: 4368 616e 6765 4461 7461 2863 6861 6e67  ChangeData(chang
+00017730: 6553 7461 7475 7352 6f77 7349 6e73 7429  eStatusRowsInst)
+00017740: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00017750: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00017760: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00017770: 2020 2020 7365 6c66 2e64 6566 6175 6c74      self.default
+00017780: 5f6c 6f67 6765 722e 6465 6275 6728 652c  _logger.debug(e,
+00017790: 2065 7863 5f69 6e66 6f3d 5472 7565 290a   exc_info=True).
+000177a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177b0: 2320 5479 7065 4572 726f 7220 6f72 2043  # TypeError or C
+000177c0: 6f6e 6e65 6374 696f 6e45 7272 6f72 2062  onnectionError b
+000177d0: 6563 6175 7365 2077 6520 636f 756c 6420  ecause we could 
+000177e0: 6e6f 7420 6669 6e64 2074 6865 2073 746f  not find the sto
+000177f0: 636b 206f 7220 4d46 4920 6461 7461 2069  ck or MFI data i
+00017800: 736e 2774 2061 7661 696c 6162 6c65 3f0a  sn't available?.
+00017810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017820: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
+00017830: 206c 6173 7444 6179 4c61 7374 4d6f 6e74   lastDayLastMont
+00017840: 6820 3d20 504b 4461 7465 5574 696c 6974  h = PKDateUtilit
+00017850: 6965 732e 6c61 7374 5f64 6179 5f6f 665f  ies.last_day_of_
+00017860: 7072 6576 696f 7573 5f6d 6f6e 7468 2850  previous_month(P
+00017870: 4b44 6174 6555 7469 6c69 7469 6573 2e63  KDateUtilities.c
+00017880: 7572 7265 6e74 4461 7465 5469 6d65 2829  urrentDateTime()
+00017890: 290a 2020 2020 2020 2020 2020 2020 6c61  ).            la
+000178a0: 7374 4461 794c 6173 744d 6f6e 7468 203d  stDayLastMonth =
+000178b0: 206c 6173 7444 6179 4c61 7374 4d6f 6e74   lastDayLastMont
+000178c0: 682e 7374 7266 7469 6d65 2822 2559 2d25  h.strftime("%Y-%
+000178d0: 6d2d 2564 5430 303a 3030 3a30 302e 3030  m-%dT00:00:00.00
+000178e0: 3022 290a 2020 2020 2020 2020 2020 2020  0").            
+000178f0: 6966 2063 6861 6e67 6553 7461 7475 7344  if changeStatusD
+00017900: 6174 614d 4620 6973 206e 6f74 204e 6f6e  ataMF is not Non
+00017910: 6520 616e 6420 6c65 6e28 6368 616e 6765  e and len(change
+00017920: 5374 6174 7573 4461 7461 4d46 2920 3e20  StatusDataMF) > 
+00017930: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00017940: 2020 2064 665f 6772 6f75 7065 644d 4620     df_groupedMF 
+00017950: 3d20 6368 616e 6765 5374 6174 7573 4461  = changeStatusDa
+00017960: 7461 4d46 2e67 726f 7570 6279 2822 6461  taMF.groupby("da
+00017970: 7465 222c 2073 6f72 743d 4661 6c73 6529  te", sort=False)
+00017980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017990: 2066 6f72 206d 6664 6174 652c 2064 665f   for mfdate, df_
+000179a0: 6772 6f75 704d 4620 696e 2064 665f 6772  groupMF in df_gr
+000179b0: 6f75 7065 644d 463a 0a20 2020 2020 2020  oupedMF:.       
+000179c0: 2020 2020 2020 2020 2020 2020 206e 6574               net
+000179d0: 4368 616e 6765 4d46 203d 2064 665f 6772  ChangeMF = df_gr
+000179e0: 6f75 704d 465b 2263 6861 6e67 6541 6d6f  oupMF["changeAmo
+000179f0: 756e 7422 5d2e 7375 6d28 290a 2020 2020  unt"].sum().    
+00017a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a10: 6c61 7465 7374 5f6d 6664 6174 6520 3d20  latest_mfdate = 
+00017a20: 6d66 6461 7465 0a20 2020 2020 2020 2020  mfdate.         
+00017a30: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00017a40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00017a50: 6368 616e 6765 5374 6174 7573 4461 7461  changeStatusData
+00017a60: 496e 7374 2069 7320 6e6f 7420 4e6f 6e65  Inst is not None
+00017a70: 2061 6e64 206c 656e 2863 6861 6e67 6553   and len(changeS
+00017a80: 7461 7475 7344 6174 6149 6e73 7429 203e  tatusDataInst) >
+00017a90: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00017aa0: 2020 2020 6466 5f67 726f 7570 6564 496e      df_groupedIn
+00017ab0: 7374 203d 2063 6861 6e67 6553 7461 7475  st = changeStatu
+00017ac0: 7344 6174 6149 6e73 742e 6772 6f75 7062  sDataInst.groupb
+00017ad0: 7928 2264 6174 6522 2c20 736f 7274 3d46  y("date", sort=F
+00017ae0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+00017af0: 2020 2020 2020 666f 7220 696e 7374 6461        for instda
+00017b00: 7465 2c20 6466 5f67 726f 7570 496e 7374  te, df_groupInst
+00017b10: 2069 6e20 6466 5f67 726f 7570 6564 496e   in df_groupedIn
+00017b20: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00017b30: 2020 2020 2020 2020 6966 2028 6c61 7465          if (late
+00017b40: 7374 5f6d 6664 6174 6520 6973 206e 6f74  st_mfdate is not
+00017b50: 204e 6f6e 6520 616e 6420 6c61 7465 7374   None and latest
+00017b60: 5f6d 6664 6174 6520 3d3d 2069 6e73 7464  _mfdate == instd
+00017b70: 6174 6529 206f 7220 286c 6174 6573 745f  ate) or (latest_
+00017b80: 6d66 6461 7465 2069 7320 4e6f 6e65 2920  mfdate is None) 
+00017b90: 6f72 2028 696e 7374 6461 7465 203d 3d20  or (instdate == 
+00017ba0: 6c61 7374 4461 794c 6173 744d 6f6e 7468  lastDayLastMonth
+00017bb0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00017bc0: 2020 2020 2020 2020 2020 206e 6574 4368             netCh
+00017bd0: 616e 6765 496e 7374 203d 2064 665f 6772  angeInst = df_gr
+00017be0: 6f75 7049 6e73 745b 2263 6861 6e67 6541  oupInst["changeA
+00017bf0: 6d6f 756e 7422 5d2e 7375 6d28 290a 2020  mount"].sum().  
+00017c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c10: 2020 2020 2020 6c61 7465 7374 5f69 6e73        latest_ins
+00017c20: 7464 6174 6520 3d20 696e 7374 6461 7465  tdate = instdate
+00017c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017c40: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+00017c50: 2020 2072 6574 7572 6e20 6e65 7443 6861     return netCha
+00017c60: 6e67 654d 462c 6e65 7443 6861 6e67 6549  ngeMF,netChangeI
+00017c70: 6e73 742c 6c61 7465 7374 5f6d 6664 6174  nst,latest_mfdat
+00017c80: 652c 6c61 7465 7374 5f69 6e73 7464 6174  e,latest_instdat
+00017c90: 650a 0a0a 2020 2020 6465 6620 6765 744e  e...    def getN
+00017ca0: 6966 7479 5072 6564 6963 7469 6f6e 2873  iftyPrediction(s
+00017cb0: 656c 662c 2064 6629 3a0a 2020 2020 2020  elf, df):.      
+00017cc0: 2020 696d 706f 7274 2077 6172 6e69 6e67    import warning
+00017cd0: 730a 0a20 2020 2020 2020 2077 6172 6e69  s..        warni
+00017ce0: 6e67 732e 6669 6c74 6572 7761 726e 696e  ngs.filterwarnin
+00017cf0: 6773 2822 6967 6e6f 7265 2229 0a20 2020  gs("ignore").   
+00017d00: 2020 2020 2064 6174 6120 3d20 6466 2e63       data = df.c
+00017d10: 6f70 7928 290a 2020 2020 2020 2020 6d6f  opy().        mo
+00017d20: 6465 6c2c 2070 6b6c 203d 2055 7469 6c69  del, pkl = Utili
+00017d30: 7479 2e74 6f6f 6c73 2e67 6574 4e69 6674  ty.tools.getNift
+00017d40: 794d 6f64 656c 2829 0a20 2020 2020 2020  yModel().       
+00017d50: 2069 6620 6d6f 6465 6c20 6973 204e 6f6e   if model is Non
+00017d60: 6520 6f72 2070 6b6c 2069 7320 4e6f 6e65  e or pkl is None
+00017d70: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00017d80: 7475 726e 2030 2c20 2255 6e6b 6e6f 776e  turn 0, "Unknown
+00017d90: 222c 2022 556e 6b6e 6f77 6e22 0a20 2020  ", "Unknown".   
+00017da0: 2020 2020 2077 6974 6820 5375 7070 7265       with Suppre
+00017db0: 7373 4f75 7470 7574 2873 7570 7072 6573  ssOutput(suppres
+00017dc0: 735f 7374 6465 7272 3d54 7275 652c 2073  s_stderr=True, s
+00017dd0: 7570 7072 6573 735f 7374 646f 7574 3d54  uppress_stdout=T
+00017de0: 7275 6529 3a0a 2020 2020 2020 2020 2020  rue):.          
+00017df0: 2020 6461 7461 203d 2064 6174 615b 706b    data = data[pk
+00017e00: 6c5b 2263 6f6c 756d 6e73 225d 5d0a 2020  l["columns"]].  
+00017e10: 2020 2020 2020 2020 2020 2323 2320 7632            ### v2
+00017e20: 2050 7265 7072 6f63 6573 7369 6e67 0a20   Preprocessing. 
+00017e30: 2020 2020 2020 2020 2020 2064 6174 615b             data[
+00017e40: 2248 6967 6822 5d20 3d20 6461 7461 5b22  "High"] = data["
+00017e50: 4869 6768 225d 2e70 6374 5f63 6861 6e67  High"].pct_chang
+00017e60: 6528 2920 2a20 3130 300a 2020 2020 2020  e() * 100.      
+00017e70: 2020 2020 2020 6461 7461 5b22 4c6f 7722        data["Low"
+00017e80: 5d20 3d20 6461 7461 5b22 4c6f 7722 5d2e  ] = data["Low"].
+00017e90: 7063 745f 6368 616e 6765 2829 202a 2031  pct_change() * 1
+00017ea0: 3030 0a20 2020 2020 2020 2020 2020 2064  00.            d
+00017eb0: 6174 615b 224f 7065 6e22 5d20 3d20 6461  ata["Open"] = da
+00017ec0: 7461 5b22 4f70 656e 225d 2e70 6374 5f63  ta["Open"].pct_c
+00017ed0: 6861 6e67 6528 2920 2a20 3130 300a 2020  hange() * 100.  
+00017ee0: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
+00017ef0: 436c 6f73 6522 5d20 3d20 6461 7461 5b22  Close"] = data["
+00017f00: 436c 6f73 6522 5d2e 7063 745f 6368 616e  Close"].pct_chan
+00017f10: 6765 2829 202a 2031 3030 0a20 2020 2020  ge() * 100.     
+00017f20: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00017f30: 7461 2e69 6c6f 635b 2d31 5d0a 2020 2020  ta.iloc[-1].    
+00017f40: 2020 2020 2020 2020 2323 230a 2020 2020          ###.    
+00017f50: 2020 2020 2020 2020 6461 7461 203d 2070          data = p
+00017f60: 6b6c 5b22 7363 616c 6572 225d 2e74 7261  kl["scaler"].tra
+00017f70: 6e73 666f 726d 285b 6461 7461 5d29 0a20  nsform([data]). 
+00017f80: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00017f90: 5375 7070 7265 7373 4f75 7470 7574 2873  SuppressOutput(s
+00017fa0: 7570 7072 6573 735f 7374 646f 7574 3d54  uppress_stdout=T
+00017fb0: 7275 652c 2073 7570 7072 6573 735f 7374  rue, suppress_st
+00017fc0: 6465 7272 3d54 7275 6529 3a0a 2020 2020  derr=True):.    
+00017fd0: 2020 2020 2020 2020 2020 2020 7072 6564              pred
+00017fe0: 203d 206d 6f64 656c 2e70 7265 6469 6374   = model.predict
+00017ff0: 2864 6174 6129 5b30 5d0a 2020 2020 2020  (data)[0].      
+00018000: 2020 6966 2070 7265 6420 3e20 302e 353a    if pred > 0.5:
+00018010: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+00018020: 5465 7874 203d 2022 4245 4152 4953 4822  Text = "BEARISH"
+00018030: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+00018040: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00018050: 2020 2020 2063 6f6c 6f72 5465 7874 2e42       colorText.B
+00018060: 4f4c 440a 2020 2020 2020 2020 2020 2020  OLD.            
+00018070: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+00018080: 4641 494c 0a20 2020 2020 2020 2020 2020  FAIL.           
+00018090: 2020 2020 202b 206f 7574 5465 7874 0a20       + outText. 
+000180a0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+000180b0: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+000180c0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+000180d0: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
+000180e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000180f0: 2020 2020 2020 2020 2020 7375 6720 3d20            sug = 
+00018100: 2248 6f6c 6420 796f 7572 2053 686f 7274  "Hold your Short
+00018110: 2070 6f73 6974 696f 6e21 220a 2020 2020   position!".    
+00018120: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00018130: 2020 2020 2020 6f75 7454 6578 7420 3d20        outText = 
+00018140: 2242 554c 4c49 5348 220a 2020 2020 2020  "BULLISH".      
+00018150: 2020 2020 2020 6f75 7420 3d20 280a 2020        out = (.  
+00018160: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00018170: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
+00018180: 2020 2020 2020 2020 2020 2020 202b 2063               + c
+00018190: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
+000181a0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+000181b0: 206f 7574 5465 7874 0a20 2020 2020 2020   outText.       
+000181c0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+000181d0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+000181e0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+000181f0: 5465 7874 2e42 4f4c 440a 2020 2020 2020  Text.BOLD.      
+00018200: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00018210: 2020 2020 7375 6720 3d20 2253 7461 7920      sug = "Stay 
+00018220: 4275 6c6c 6973 6821 220a 2020 2020 2020  Bullish!".      
+00018230: 2020 6966 2050 4b44 6174 6555 7469 6c69    if PKDateUtili
+00018240: 7469 6573 2e69 7343 6c6f 7369 6e67 486f  ties.isClosingHo
+00018250: 7572 2829 3a0a 2020 2020 2020 2020 2020  ur():.          
+00018260: 2020 4f75 7470 7574 436f 6e74 726f 6c73    OutputControls
+00018270: 2829 2e70 7269 6e74 4f75 7470 7574 280a  ().printOutput(.
+00018280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018290: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
+000182a0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+000182b0: 2063 6f6c 6f72 5465 7874 2e57 4152 4e0a   colorText.WARN.
+000182c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182d0: 2b20 224e 6f74 653a 2054 6865 2041 4920  + "Note: The AI 
+000182e0: 7072 6564 6963 7469 6f6e 2073 686f 756c  prediction shoul
+000182f0: 6420 6265 2065 7865 6375 7465 6420 4166  d be executed Af
+00018300: 7465 7220 3320 504d 206f 7220 4e65 6172  ter 3 PM or Near
+00018310: 2074 6f20 436c 6f73 696e 6720 7469 6d65   to Closing time
+00018320: 2061 7320 7468 6520 5072 6564 6963 7469   as the Predicti
+00018330: 6f6e 2041 6363 7572 6163 7920 6973 2062  on Accuracy is b
+00018340: 6173 6564 206f 6e20 7468 6520 436c 6f73  ased on the Clos
+00018350: 696e 6720 7072 6963 6521 220a 2020 2020  ing price!".    
+00018360: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+00018370: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+00018380: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00018390: 2020 7072 6564 6963 7469 6f6e 5465 7874    predictionText
+000183a0: 203d 2022 4d61 726b 6574 206d 6179 204f   = "Market may O
+000183b0: 7065 6e20 7b7d 206e 6578 7420 6461 7921  pen {} next day!
+000183c0: 207b 7d22 2e66 6f72 6d61 7428 6f75 742c   {}".format(out,
+000183d0: 2073 7567 290a 2020 2020 2020 2020 7374   sug).        st
+000183e0: 7265 6e67 7468 5465 7874 203d 2022 5072  rengthText = "Pr
+000183f0: 6f62 6162 696c 6974 792f 5374 7265 6e67  obability/Streng
+00018400: 7468 206f 6620 5072 6564 6963 7469 6f6e  th of Prediction
+00018410: 203d 207b 7d25 222e 666f 726d 6174 280a   = {}%".format(.
+00018420: 2020 2020 2020 2020 2020 2020 5574 696c              Util
+00018430: 6974 792e 746f 6f6c 732e 6765 7453 6967  ity.tools.getSig
+00018440: 6d6f 6964 436f 6e66 6964 656e 6365 2870  moidConfidence(p
+00018450: 7265 645b 305d 290a 2020 2020 2020 2020  red[0]).        
+00018460: 290a 2020 2020 2020 2020 4f75 7470 7574  ).        Output
+00018470: 436f 6e74 726f 6c73 2829 2e70 7269 6e74  Controls().print
+00018480: 4f75 7470 7574 280a 2020 2020 2020 2020  Output(.        
+00018490: 2020 2020 636f 6c6f 7254 6578 742e 424f      colorText.BO
+000184a0: 4c44 0a20 2020 2020 2020 2020 2020 202b  LD.            +
+000184b0: 2063 6f6c 6f72 5465 7874 2e42 4c55 450a   colorText.BLUE.
+000184c0: 2020 2020 2020 2020 2020 2020 2b20 225c              + "\
+000184d0: 6e22 0a20 2020 2020 2020 2020 2020 202b  n".            +
+000184e0: 2022 5b2b 5d20 4e69 6674 7920 4149 2050   "[+] Nifty AI P
+000184f0: 7265 6469 6374 696f 6e20 2d3e 2022 0a20  rediction -> ". 
+00018500: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+00018510: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+00018520: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+00018530: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
+00018540: 2020 2020 2b20 7072 6564 6963 7469 6f6e      + prediction
+00018550: 5465 7874 0a20 2020 2020 2020 2020 2020  Text.           
+00018560: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+00018570: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00018580: 2020 204f 7574 7075 7443 6f6e 7472 6f6c     OutputControl
+00018590: 7328 292e 7072 696e 744f 7574 7075 7428  s().printOutput(
+000185a0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+000185b0: 6f72 5465 7874 2e42 4f4c 440a 2020 2020  orText.BOLD.    
+000185c0: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
+000185d0: 6578 742e 424c 5545 0a20 2020 2020 2020  ext.BLUE.       
+000185e0: 2020 2020 202b 2022 5c6e 220a 2020 2020       + "\n".    
+000185f0: 2020 2020 2020 2020 2b20 225b 2b5d 204e          + "[+] N
+00018600: 6966 7479 2041 4920 5072 6564 6963 7469  ifty AI Predicti
+00018610: 6f6e 202d 3e20 220a 2020 2020 2020 2020  on -> ".        
+00018620: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+00018630: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+00018640: 2b20 7374 7265 6e67 7468 5465 7874 0a20  + strengthText. 
+00018650: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00018660: 2020 7265 7475 726e 2070 7265 642c 2070    return pred, p
+00018670: 7265 6469 6374 696f 6e54 6578 742e 7265  redictionText.re
+00018680: 706c 6163 6528 6f75 742c 206f 7574 5465  place(out, outTe
+00018690: 7874 292c 2073 7472 656e 6774 6854 6578  xt), strengthTex
+000186a0: 740a 0a20 2020 2064 6566 206d 6f6e 6974  t..    def monit
+000186b0: 6f72 4669 7665 456d 6128 7365 6c66 2c20  orFiveEma(self, 
+000186c0: 6665 7463 6865 722c 2072 6573 756c 745f  fetcher, result_
+000186d0: 6466 2c20 6c61 7374 5f73 6967 6e61 6c2c  df, last_signal,
+000186e0: 2072 6973 6b5f 7265 7761 7264 3d33 293a   risk_reward=3):
+000186f0: 0a20 2020 2020 2020 2063 6f6c 5f6e 616d  .        col_nam
+00018700: 6573 203d 205b 2248 6967 6822 2c20 224c  es = ["High", "L
+00018710: 6f77 222c 2022 436c 6f73 6522 2c20 2235  ow", "Close", "5
+00018720: 454d 4122 5d0a 2020 2020 2020 2020 6461  EMA"].        da
+00018730: 7461 5f6c 6973 7420 3d20 5b22 6e69 6674  ta_list = ["nift
+00018740: 795f 6275 7922 2c20 2262 616e 6b6e 6966  y_buy", "banknif
+00018750: 7479 5f62 7579 222c 2022 6e69 6674 795f  ty_buy", "nifty_
+00018760: 7365 6c6c 222c 2022 6261 6e6b 6e69 6674  sell", "banknift
+00018770: 795f 7365 6c6c 225d 0a0a 2020 2020 2020  y_sell"]..      
+00018780: 2020 6461 7461 5f74 7570 6c65 203d 2066    data_tuple = f
+00018790: 6574 6368 6572 2e66 6574 6368 4669 7665  etcher.fetchFive
+000187a0: 456d 6144 6174 6128 290a 2020 2020 2020  EmaData().      
+000187b0: 2020 666f 7220 636e 7420 696e 2072 616e    for cnt in ran
+000187c0: 6765 286c 656e 2864 6174 615f 7475 706c  ge(len(data_tupl
+000187d0: 6529 293a 0a20 2020 2020 2020 2020 2020  e)):.           
+000187e0: 2064 203d 2064 6174 615f 7475 706c 655b   d = data_tuple[
+000187f0: 636e 745d 0a20 2020 2020 2020 2020 2020  cnt].           
+00018800: 2064 5b22 3545 4d41 225d 203d 2070 6b74   d["5EMA"] = pkt
+00018810: 616c 6962 2e45 4d41 2864 5b22 436c 6f73  alib.EMA(d["Clos
+00018820: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
+00018830: 3529 0a20 2020 2020 2020 2020 2020 2064  5).            d
+00018840: 203d 2064 5b63 6f6c 5f6e 616d 6573 5d0a   = d[col_names].
+00018850: 2020 2020 2020 2020 2020 2020 6420 3d20              d = 
+00018860: 642e 6472 6f70 6e61 2829 2e72 6f75 6e64  d.dropna().round
+00018870: 2832 290a 0a20 2020 2020 2020 2020 2020  (2)..           
+00018880: 2077 6974 6820 5375 7070 7265 7373 4f75   with SuppressOu
+00018890: 7470 7574 2873 7570 7072 6573 735f 7374  tput(suppress_st
+000188a0: 6465 7272 3d54 7275 652c 2073 7570 7072  derr=True, suppr
+000188b0: 6573 735f 7374 646f 7574 3d54 7275 6529  ess_stdout=True)
+000188c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000188d0: 2020 6966 2022 7365 6c6c 2220 696e 2064    if "sell" in d
+000188e0: 6174 615f 6c69 7374 5b63 6e74 5d3a 0a20  ata_list[cnt]:. 
+000188f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018900: 2020 2073 7472 6563 6865 6420 3d20 645b     streched = d[
+00018910: 2864 2e4c 6f77 203e 2064 5b22 3545 4d41  (d.Low > d["5EMA
+00018920: 225d 2920 2620 2864 2e4c 6f77 202d 2064  "]) & (d.Low - d
+00018930: 5b22 3545 4d41 225d 203e 2030 2e35 295d  ["5EMA"] > 0.5)]
+00018940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018950: 2020 2020 2073 7472 6563 6865 645b 2253       streched["S
+00018960: 4c22 5d20 3d20 7374 7265 6368 6564 2e48  L"] = streched.H
+00018970: 6967 680a 2020 2020 2020 2020 2020 2020  igh.            
+00018980: 2020 2020 2020 2020 7661 6c69 6461 7465          validate
+00018990: 203d 2064 5b0a 2020 2020 2020 2020 2020   = d[.          
+000189a0: 2020 2020 2020 2020 2020 2020 2020 2864                (d
+000189b0: 2e4c 6f77 2e73 6869 6674 2831 2920 3e20  .Low.shift(1) > 
+000189c0: 645b 2235 454d 4122 5d2e 7368 6966 7428  d["5EMA"].shift(
+000189d0: 3129 290a 2020 2020 2020 2020 2020 2020  1)).            
+000189e0: 2020 2020 2020 2020 2020 2020 2620 2864              & (d
+000189f0: 2e4c 6f77 2e73 6869 6674 2831 2920 2d20  .Low.shift(1) - 
+00018a00: 645b 2235 454d 4122 5d2e 7368 6966 7428  d["5EMA"].shift(
+00018a10: 3129 203e 2030 2e35 290a 2020 2020 2020  1) > 0.5).      
+00018a20: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+00018a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a40: 2020 2020 6f6c 645f 696e 6465 7820 3d20      old_index = 
+00018a50: 7661 6c69 6461 7465 2e69 6e64 6578 0a20  validate.index. 
+00018a60: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00018a70: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00018a80: 2020 2020 2020 2020 206d 6173 6b20 3d20           mask = 
+00018a90: 2864 2e48 6967 6820 3c20 645b 2235 454d  (d.High < d["5EM
+00018aa0: 4122 5d29 2026 2028 645b 2235 454d 4122  A"]) & (d["5EMA"
+00018ab0: 5d20 2d20 642e 4869 6768 203e 2030 2e35  ] - d.High > 0.5
+00018ac0: 2920 2023 2042 7579 0a20 2020 2020 2020  )  # Buy.       
+00018ad0: 2020 2020 2020 2020 2020 2020 2073 7472               str
+00018ae0: 6563 6865 6420 3d20 645b 6d61 736b 5d0a  eched = d[mask].
+00018af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b00: 2020 2020 7374 7265 6368 6564 5b22 534c      streched["SL
+00018b10: 225d 203d 2073 7472 6563 6865 642e 4c6f  "] = streched.Lo
+00018b20: 770a 2020 2020 2020 2020 2020 2020 2020  w.              
+00018b30: 2020 2020 2020 7661 6c69 6461 7465 203d        validate =
+00018b40: 2064 2e6c 6f63 5b6d 6173 6b2e 7368 6966   d.loc[mask.shif
+00018b50: 7428 3129 2e66 696c 6c6e 6128 4661 6c73  t(1).fillna(Fals
+00018b60: 6529 5d0a 2020 2020 2020 2020 2020 2020  e)].            
+00018b70: 2020 2020 2020 2020 6f6c 645f 696e 6465          old_inde
+00018b80: 7820 3d20 7661 6c69 6461 7465 2e69 6e64  x = validate.ind
+00018b90: 6578 0a20 2020 2020 2020 2020 2020 2074  ex.            t
+00018ba0: 6774 203d 2070 642e 4461 7461 4672 616d  gt = pd.DataFram
+00018bb0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00018bc0: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
+00018bd0: 2020 2020 2020 2020 2076 616c 6964 6174           validat
+00018be0: 652e 436c 6f73 652e 7265 7365 745f 696e  e.Close.reset_in
+00018bf0: 6465 7828 6472 6f70 3d54 7275 6529 0a20  dex(drop=True). 
+00018c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c10: 2020 202d 2028 0a20 2020 2020 2020 2020     - (.         
+00018c20: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00018c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018c40: 2020 2020 2020 2020 2020 2020 2073 7472               str
+00018c50: 6563 6865 642e 534c 2e72 6573 6574 5f69  eched.SL.reset_i
+00018c60: 6e64 6578 2864 726f 703d 5472 7565 290a  ndex(drop=True).
+00018c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c80: 2020 2020 2020 2020 2020 2020 2d20 7661              - va
+00018c90: 6c69 6461 7465 2e43 6c6f 7365 2e72 6573  lidate.Close.res
+00018ca0: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
+00018cb0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00018cc0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00018cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ce0: 2020 2020 2020 2a20 7269 736b 5f72 6577        * risk_rew
+00018cf0: 6172 640a 2020 2020 2020 2020 2020 2020  ard.            
+00018d00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00018d10: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00018d20: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+00018d30: 756d 6e73 3d5b 2254 6172 6765 7422 5d2c  umns=["Target"],
+00018d40: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00018d50: 2020 2020 2020 2020 2020 2076 616c 6964             valid
+00018d60: 6174 6520 3d20 7064 2e63 6f6e 6361 7428  ate = pd.concat(
 00018d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018d80: 2066 696e 616c 203d 2076 616c 6964 6174   final = validat
-00018d90: 655b 7661 6c69 6461 7465 2e43 6c6f 7365  e[validate.Close
-00018da0: 203c 2076 616c 6964 6174 655b 2235 454d   < validate["5EM
-00018db0: 4122 5d5d 2e74 6169 6c28 3129 0a20 2020  A"]].tail(1).   
-00018dc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00018dd0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00018de0: 696e 616c 203d 2076 616c 6964 6174 655b  inal = validate[
-00018df0: 7661 6c69 6461 7465 2e43 6c6f 7365 203e  validate.Close >
-00018e00: 2076 616c 6964 6174 655b 2235 454d 4122   validate["5EMA"
-00018e10: 5d5d 2e74 6169 6c28 3129 0a0a 2020 2020  ]].tail(1)..    
-00018e20: 2020 2020 2020 2020 6966 2064 6174 615f          if data_
-00018e30: 6c69 7374 5b63 6e74 5d20 6e6f 7420 696e  list[cnt] not in
-00018e40: 206c 6173 745f 7369 676e 616c 3a0a 2020   last_signal:.  
-00018e50: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00018e60: 7374 5f73 6967 6e61 6c5b 6461 7461 5f6c  st_signal[data_l
-00018e70: 6973 745b 636e 745d 5d20 3d20 6669 6e61  ist[cnt]] = fina
-00018e80: 6c0a 2020 2020 2020 2020 2020 2020 656c  l.            el
-00018e90: 6966 2064 6174 615f 6c69 7374 5b63 6e74  if data_list[cnt
-00018ea0: 5d20 696e 206c 6173 745f 7369 676e 616c  ] in last_signal
-00018eb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018ec0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00018ed0: 2020 2020 2020 2020 2020 2063 6f6e 6469             condi
-00018ee0: 7469 6f6e 203d 206c 6173 745f 7369 676e  tion = last_sign
-00018ef0: 616c 5b64 6174 615f 6c69 7374 5b63 6e74  al[data_list[cnt
-00018f00: 5d5d 5b30 5d5b 2253 4c22 5d5b 305d 0a20  ]][0]["SL"][0]. 
-00018f10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00018f20: 7863 6570 7420 4b65 7945 7272 6f72 2061  xcept KeyError a
-00018f30: 7320 653a 2023 2070 7261 676d 613a 206e  s e: # pragma: n
-00018f40: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
-00018f50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018f60: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
-00018f70: 6465 6275 6728 652c 2065 7863 5f69 6e66  debug(e, exc_inf
-00018f80: 6f3d 5472 7565 290a 2020 2020 2020 2020  o=True).        
-00018f90: 2020 2020 2020 2020 2020 2020 636f 6e64              cond
-00018fa0: 6974 696f 6e20 3d20 6c61 7374 5f73 6967  ition = last_sig
-00018fb0: 6e61 6c5b 6461 7461 5f6c 6973 745b 636e  nal[data_list[cn
-00018fc0: 745d 5d5b 2253 4c22 5d5b 305d 0a20 2020  t]]["SL"][0].   
-00018fd0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-00018fe0: 6620 6c61 7374 5f73 6967 6e61 6c5b 6461  f last_signal[da
-00018ff0: 7461 5f6c 6973 745b 636e 745d 5d20 6973  ta_list[cnt]] is
-00019000: 206e 6f74 2066 696e 616c 3a20 2020 2020   not final:     
-00019010: 2020 2020 2023 2044 6562 7567 202d 2053       # Debug - S
-00019020: 686f 7773 2061 6c6c 2063 6f6e 6469 7469  hows all conditi
-00019030: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
-00019040: 2020 2020 6966 206c 656e 2866 696e 616c      if len(final
-00019050: 5b22 534c 225d 2920 3e20 3020 616e 6420  ["SL"]) > 0 and 
-00019060: 636f 6e64 6974 696f 6e20 213d 2066 696e  condition != fin
-00019070: 616c 5b22 534c 225d 2e69 6c6f 635b 305d  al["SL"].iloc[0]
-00019080: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019090: 2020 2020 2020 2320 446f 2073 6f6d 6574        # Do somet
-000190a0: 6869 6e67 2077 6974 6820 7265 7375 6c74  hing with result
-000190b0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-000190c0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000190d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190e0: 2020 2072 6573 756c 745f 6466 203d 2070     result_df = p
-000190f0: 642e 636f 6e63 6174 280a 2020 2020 2020  d.concat(.      
-00019100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019110: 2020 2020 2020 5b0a 2020 2020 2020 2020        [.        
-00019120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019130: 2020 2020 2020 2020 7265 7375 6c74 5f64          result_d
-00019140: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
-00019150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019160: 2020 2070 642e 4461 7461 4672 616d 6528     pd.DataFrame(
-00019170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019190: 2020 2020 205b 0a20 2020 2020 2020 2020       [.         
-000191a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191b0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-000191c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000191d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191e0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-000191f0: 6f72 5465 7874 2e42 4c55 450a 2020 2020  orText.BLUE.    
-00019200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019220: 2020 2020 2020 2020 2b20 7374 7228 6669          + str(fi
-00019230: 6e61 6c2e 696e 6465 785b 305d 290a 2020  nal.index[0]).  
-00019240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019260: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-00019270: 7254 6578 742e 454e 442c 0a20 2020 2020  rText.END,.     
+00018d80: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+00018d90: 2020 2020 2020 2076 616c 6964 6174 652e         validate.
+00018da0: 7265 7365 745f 696e 6465 7828 6472 6f70  reset_index(drop
+00018db0: 3d54 7275 6529 2c0a 2020 2020 2020 2020  =True),.        
+00018dc0: 2020 2020 2020 2020 2020 2020 7374 7265              stre
+00018dd0: 6368 6564 5b22 534c 225d 2e72 6573 6574  ched["SL"].reset
+00018de0: 5f69 6e64 6578 2864 726f 703d 5472 7565  _index(drop=True
+00018df0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00018e00: 2020 2020 2020 2074 6774 2c0a 2020 2020         tgt,.    
+00018e10: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
+00018e20: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00018e30: 7869 733d 312c 0a20 2020 2020 2020 2020  xis=1,.         
+00018e40: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00018e50: 2076 616c 6964 6174 6520 3d20 7661 6c69   validate = vali
+00018e60: 6461 7465 2e74 6169 6c28 6c65 6e28 6f6c  date.tail(len(ol
+00018e70: 645f 696e 6465 7829 290a 2020 2020 2020  d_index)).      
+00018e80: 2020 2020 2020 7661 6c69 6461 7465 203d        validate =
+00018e90: 2076 616c 6964 6174 652e 7365 745f 696e   validate.set_in
+00018ea0: 6465 7828 6f6c 645f 696e 6465 7829 0a20  dex(old_index). 
+00018eb0: 2020 2020 2020 2020 2020 2069 6620 2273             if "s
+00018ec0: 656c 6c22 2069 6e20 6461 7461 5f6c 6973  ell" in data_lis
+00018ed0: 745b 636e 745d 3a0a 2020 2020 2020 2020  t[cnt]:.        
+00018ee0: 2020 2020 2020 2020 6669 6e61 6c20 3d20          final = 
+00018ef0: 7661 6c69 6461 7465 5b76 616c 6964 6174  validate[validat
+00018f00: 652e 436c 6f73 6520 3c20 7661 6c69 6461  e.Close < valida
+00018f10: 7465 5b22 3545 4d41 225d 5d2e 7461 696c  te["5EMA"]].tail
+00018f20: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+00018f30: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00018f40: 2020 2020 2020 6669 6e61 6c20 3d20 7661        final = va
+00018f50: 6c69 6461 7465 5b76 616c 6964 6174 652e  lidate[validate.
+00018f60: 436c 6f73 6520 3e20 7661 6c69 6461 7465  Close > validate
+00018f70: 5b22 3545 4d41 225d 5d2e 7461 696c 2831  ["5EMA"]].tail(1
+00018f80: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00018f90: 6620 6461 7461 5f6c 6973 745b 636e 745d  f data_list[cnt]
+00018fa0: 206e 6f74 2069 6e20 6c61 7374 5f73 6967   not in last_sig
+00018fb0: 6e61 6c3a 0a20 2020 2020 2020 2020 2020  nal:.           
+00018fc0: 2020 2020 206c 6173 745f 7369 676e 616c       last_signal
+00018fd0: 5b64 6174 615f 6c69 7374 5b63 6e74 5d5d  [data_list[cnt]]
+00018fe0: 203d 2066 696e 616c 0a20 2020 2020 2020   = final.       
+00018ff0: 2020 2020 2065 6c69 6620 6461 7461 5f6c       elif data_l
+00019000: 6973 745b 636e 745d 2069 6e20 6c61 7374  ist[cnt] in last
+00019010: 5f73 6967 6e61 6c3a 0a20 2020 2020 2020  _signal:.       
+00019020: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00019030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019040: 2020 636f 6e64 6974 696f 6e20 3d20 6c61    condition = la
+00019050: 7374 5f73 6967 6e61 6c5b 6461 7461 5f6c  st_signal[data_l
+00019060: 6973 745b 636e 745d 5d5b 305d 5b22 534c  ist[cnt]][0]["SL
+00019070: 225d 5b30 5d0a 2020 2020 2020 2020 2020  "][0].          
+00019080: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+00019090: 4572 726f 7220 6173 2065 3a20 2320 7072  Error as e: # pr
+000190a0: 6167 6d61 3a20 6e6f 2063 6f76 6572 0a20  agma: no cover. 
+000190b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190c0: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
+000190d0: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
+000190e0: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
+000190f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019100: 2020 2063 6f6e 6469 7469 6f6e 203d 206c     condition = l
+00019110: 6173 745f 7369 676e 616c 5b64 6174 615f  ast_signal[data_
+00019120: 6c69 7374 5b63 6e74 5d5d 5b22 534c 225d  list[cnt]]["SL"]
+00019130: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00019140: 2020 2020 2320 6966 206c 6173 745f 7369      # if last_si
+00019150: 676e 616c 5b64 6174 615f 6c69 7374 5b63  gnal[data_list[c
+00019160: 6e74 5d5d 2069 7320 6e6f 7420 6669 6e61  nt]] is not fina
+00019170: 6c3a 2020 2020 2020 2020 2020 2320 4465  l:          # De
+00019180: 6275 6720 2d20 5368 6f77 7320 616c 6c20  bug - Shows all 
+00019190: 636f 6e64 6974 696f 6e73 0a20 2020 2020  conditions.     
+000191a0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+000191b0: 6e28 6669 6e61 6c5b 2253 4c22 5d29 203e  n(final["SL"]) >
+000191c0: 2030 2061 6e64 2063 6f6e 6469 7469 6f6e   0 and condition
+000191d0: 2021 3d20 6669 6e61 6c5b 2253 4c22 5d2e   != final["SL"].
+000191e0: 696c 6f63 5b30 5d3a 0a20 2020 2020 2020  iloc[0]:.       
+000191f0: 2020 2020 2020 2020 2020 2020 2023 2044               # D
+00019200: 6f20 736f 6d65 7468 696e 6720 7769 7468  o something with
+00019210: 2072 6573 756c 7473 0a20 2020 2020 2020   results.       
+00019220: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00019230: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019240: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00019250: 5f64 6620 3d20 7064 2e63 6f6e 6361 7428  _df = pd.concat(
+00019260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019270: 2020 2020 2020 2020 2020 2020 205b 0a20               [. 
 00019280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192a0: 2020 2020 2020 2063 6f6c 6f72 5465 7874         colorText
-000192b0: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
-000192c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192e0: 2020 2b20 636f 6c6f 7254 6578 742e 5741    + colorText.WA
-000192f0: 524e 0a20 2020 2020 2020 2020 2020 2020  RN.             
+00019290: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000192a0: 6573 756c 745f 6466 2c0a 2020 2020 2020  esult_df,.      
+000192b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192c0: 2020 2020 2020 2020 2020 7064 2e44 6174            pd.Dat
+000192d0: 6146 7261 6d65 280a 2020 2020 2020 2020  aFrame(.        
+000192e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192f0: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
 00019300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019310: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00019320: 2064 6174 615f 6c69 7374 5b63 6e74 5d2e   data_list[cnt].
-00019330: 7370 6c69 7428 225f 2229 5b30 5d2e 7570  split("_")[0].up
-00019340: 7065 7228 290a 2020 2020 2020 2020 2020  per().          
-00019350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019370: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-00019380: 442c 0a20 2020 2020 2020 2020 2020 2020  D,.             
-00019390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193a0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000193b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019320: 2020 2020 2020 5b0a 2020 2020 2020 2020        [.        
+00019330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019350: 2020 2020 636f 6c6f 7254 6578 742e 424c      colorText.BL
+00019360: 5545 0a20 2020 2020 2020 2020 2020 2020  UE.             
+00019370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019380: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00019390: 2073 7472 2866 696e 616c 2e69 6e64 6578   str(final.index
+000193a0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+000193b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000193c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193e0: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
+000193d0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+000193e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 000193f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019420: 2b20 636f 6c6f 7254 6578 742e 4641 494c  + colorText.FAIL
-00019430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019460: 202b 2064 6174 615f 6c69 7374 5b63 6e74   + data_list[cnt
-00019470: 5d2e 7370 6c69 7428 225f 2229 5b31 5d2e  ].split("_")[1].
-00019480: 7570 7065 7228 290a 2020 2020 2020 2020  upper().        
-00019490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194b0: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-000194c0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-000194d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00019400: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00019410: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
+00019420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019440: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+00019450: 5465 7874 2e57 4152 4e0a 2020 2020 2020  Text.WARN.      
+00019460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019480: 2020 2020 2020 2b20 6461 7461 5f6c 6973        + data_lis
+00019490: 745b 636e 745d 2e73 706c 6974 2822 5f22  t[cnt].split("_"
+000194a0: 295b 305d 2e75 7070 6572 2829 0a20 2020  )[0].upper().   
+000194b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194d0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+000194e0: 5465 7874 2e45 4e44 2c0a 2020 2020 2020  Text.END,.      
+000194f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019520: 2020 6966 2022 7365 6c6c 2220 696e 2064    if "sell" in d
-00019530: 6174 615f 6c69 7374 5b63 6e74 5d0a 2020  ata_list[cnt].  
-00019540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019560: 2020 2020 2020 2020 2020 656c 7365 2028            else (
-00019570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195a0: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
+00019510: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
+00019520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019540: 2020 2020 2020 2020 636f 6c6f 7254 6578          colorTex
+00019550: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
+00019560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019580: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+00019590: 7874 2e46 4149 4c0a 2020 2020 2020 2020  xt.FAIL.        
+000195a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000195b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195e0: 2b20 636f 6c6f 7254 6578 742e 4752 4545  + colorText.GREE
-000195f0: 4e0a 2020 2020 2020 2020 2020 2020 2020  N.              
+000195c0: 2020 2020 2020 2020 2b20 6461 7461 5f6c          + data_l
+000195d0: 6973 745b 636e 745d 2e73 706c 6974 2822  ist[cnt].split("
+000195e0: 5f22 295b 315d 2e75 7070 6572 2829 0a20  _")[1].upper(). 
+000195f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019620: 2020 2b20 6461 7461 5f6c 6973 745b 636e    + data_list[cn
-00019630: 745d 2e73 706c 6974 2822 5f22 295b 315d  t].split("_")[1]
-00019640: 2e75 7070 6572 2829 0a20 2020 2020 2020  .upper().       
-00019650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019610: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00019620: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+00019630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019650: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
 00019660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019670: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-00019680: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-00019690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196b0: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+00019670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019680: 2020 2020 2020 2020 2069 6620 2273 656c           if "sel
+00019690: 6c22 2069 6e20 6461 7461 5f6c 6973 745b  l" in data_list[
+000196a0: 636e 745d 0a20 2020 2020 2020 2020 2020  cnt].           
+000196b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000196c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196e0: 2020 2020 636f 6c6f 7254 6578 742e 4641      colorText.FA
-000196f0: 494c 0a20 2020 2020 2020 2020 2020 2020  IL.             
-00019700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019710: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00019720: 2073 7472 2866 696e 616c 2e53 4c5b 305d   str(final.SL[0]
-00019730: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019750: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00019760: 636f 6c6f 7254 6578 742e 454e 442c 0a20  colorText.END,. 
+000196d0: 2065 6c73 6520 280a 2020 2020 2020 2020   else (.        
+000196e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019700: 2020 2020 2020 2020 636f 6c6f 7254 6578          colorTex
+00019710: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
+00019720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019740: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+00019750: 7874 2e47 5245 454e 0a20 2020 2020 2020  xt.GREEN.       
+00019760: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019790: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
-000197a0: 5465 7874 2e47 5245 454e 0a20 2020 2020  Text.GREEN.     
+00019780: 2020 2020 2020 2020 202b 2064 6174 615f           + data_
+00019790: 6c69 7374 5b63 6e74 5d2e 7370 6c69 7428  list[cnt].split(
+000197a0: 225f 2229 5b31 5d2e 7570 7065 7228 290a  "_")[1].upper().
 000197b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000197c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197d0: 2020 2020 2020 202b 2073 7472 2866 696e         + str(fin
-000197e0: 616c 2e54 6172 6765 745b 305d 290a 2020  al.Target[0]).  
+000197d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197e0: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
 000197f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019810: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-00019820: 7254 6578 742e 454e 442c 0a20 2020 2020  rText.END,.     
+00019810: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+00019820: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019850: 2020 2020 2020 2066 2231 3a7b 7269 736b         f"1:{risk
-00019860: 5f72 6577 6172 647d 222c 0a20 2020 2020  _reward}",.     
+00019840: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+00019850: 5465 7874 2e46 4149 4c0a 2020 2020 2020  Text.FAIL.      
+00019860: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019890: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+00019880: 2020 2020 2020 2b20 7374 7228 6669 6e61        + str(fina
+00019890: 6c2e 534c 5b30 5d29 0a20 2020 2020 2020  l.SL[0]).       
 000198a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198b0: 2020 2020 2020 2020 205d 2c0a 2020 2020           ],.    
-000198c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198e0: 636f 6c75 6d6e 733d 7265 7375 6c74 5f64  columns=result_d
-000198f0: 662e 636f 6c75 6d6e 732c 0a20 2020 2020  f.columns,.     
-00019900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019910: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+000198b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198c0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+000198d0: 2e45 4e44 2c0a 2020 2020 2020 2020 2020  .END,.          
+000198e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019900: 2020 636f 6c6f 7254 6578 742e 4752 4545    colorText.GREE
+00019910: 4e0a 2020 2020 2020 2020 2020 2020 2020  N.              
 00019920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019930: 2020 2020 2020 2020 2020 5d2c 0a20 2020            ],.   
-00019940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019950: 2020 2020 2020 2020 2061 7869 733d 302c           axis=0,
-00019960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019970: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00019980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019990: 2020 2072 6573 756c 745f 6466 2e72 6573     result_df.res
-000199a0: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
-000199b0: 7565 2c20 696e 706c 6163 653d 5472 7565  ue, inplace=True
-000199c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000199d0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-000199e0: 6570 7469 6f6e 2061 7320 653a 2020 2320  eption as e:  # 
-000199f0: 7072 6167 6d61 3a20 6e6f 2063 6f76 6572  pragma: no cover
-00019a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019a10: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
-00019a20: 6661 756c 745f 6c6f 6767 6572 2e64 6562  fault_logger.deb
-00019a30: 7567 2865 2c20 6578 635f 696e 666f 3d54  ug(e, exc_info=T
-00019a40: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00019a50: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00019a60: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00019a70: 2020 2020 2020 2320 5468 656e 2075 7064        # Then upd
-00019a80: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-00019a90: 2020 2020 2020 2020 6c61 7374 5f73 6967          last_sig
-00019aa0: 6e61 6c5b 6461 7461 5f6c 6973 745b 636e  nal[data_list[cn
-00019ab0: 745d 5d20 3d20 5b66 696e 616c 5d0a 2020  t]] = [final].  
-00019ac0: 2020 2020 2020 6966 2072 6573 756c 745f        if result_
-00019ad0: 6466 2069 7320 6e6f 7420 4e6f 6e65 3a0a  df is not None:.
-00019ae0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00019af0: 6c74 5f64 662e 6472 6f70 5f64 7570 6c69  lt_df.drop_dupli
-00019b00: 6361 7465 7328 6b65 6570 3d22 6c61 7374  cates(keep="last
-00019b10: 222c 2069 6e70 6c61 6365 3d54 7275 6529  ", inplace=True)
-00019b20: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00019b30: 756c 745f 6466 2e73 6f72 745f 7661 6c75  ult_df.sort_valu
-00019b40: 6573 2862 793d 2254 696d 6522 2c20 696e  es(by="Time", in
-00019b50: 706c 6163 653d 5472 7565 290a 2020 2020  place=True).    
-00019b60: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-00019b70: 745f 6466 5b3a 3a2d 315d 0a0a 2020 2020  t_df[::-1]..    
-00019b80: 2320 5072 6570 726f 6365 7373 2074 6865  # Preprocess the
-00019b90: 2061 6371 7569 7265 6420 6461 7461 0a20   acquired data. 
-00019ba0: 2020 2064 6566 2070 7265 7072 6f63 6573     def preproces
-00019bb0: 7344 6174 6128 7365 6c66 2c20 6466 2c20  sData(self, df, 
-00019bc0: 6461 7973 546f 4c6f 6f6b 6261 636b 3d4e  daysToLookback=N
-00019bd0: 6f6e 6529 3a0a 2020 2020 2020 2020 6173  one):.        as
-00019be0: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
-00019bf0: 6466 2c20 7064 2e44 6174 6146 7261 6d65  df, pd.DataFrame
-00019c00: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-00019c10: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
-00019c20: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00019c30: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-00019c40: 7265 706c 6163 6528 6e70 2e69 6e66 2c20  replace(np.inf, 
-00019c50: 6e70 2e6e 616e 292e 7265 706c 6163 6528  np.nan).replace(
-00019c60: 2d6e 702e 696e 662c 206e 702e 6e61 6e29  -np.inf, np.nan)
-00019c70: 2e64 726f 706e 6128 686f 773d 2261 6c6c  .dropna(how="all
-00019c80: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-00019c90: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
-00019ca0: 6767 6572 2e69 6e66 6f28 6622 5072 6570  gger.info(f"Prep
-00019cb0: 726f 6365 7373 696e 6720 6461 7461 3a5c  rocessing data:\
-00019cc0: 6e7b 6461 7461 2e68 6561 6428 3129 7d5c  n{data.head(1)}\
-00019cd0: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-00019ce0: 6966 2064 6179 7354 6f4c 6f6f 6b62 6163  if daysToLookbac
-00019cf0: 6b20 6973 204e 6f6e 653a 0a20 2020 2020  k is None:.     
-00019d00: 2020 2020 2020 2020 2020 2064 6179 7354             daysT
-00019d10: 6f4c 6f6f 6b62 6163 6b20 3d20 7365 6c66  oLookback = self
-00019d20: 2e63 6f6e 6669 674d 616e 6167 6572 2e64  .configManager.d
-00019d30: 6179 7354 6f4c 6f6f 6b62 6163 6b0a 2020  aysToLookback.  
-00019d40: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00019d50: 662e 636f 6e66 6967 4d61 6e61 6765 722e  f.configManager.
-00019d60: 7573 6545 4d41 3a0a 2020 2020 2020 2020  useEMA:.        
-00019d70: 2020 2020 2020 2020 736d 6120 3d20 706b          sma = pk
-00019d80: 7461 6c69 622e 454d 4128 6461 7461 5b22  talib.EMA(data["
-00019d90: 436c 6f73 6522 5d2c 2074 696d 6570 6572  Close"], timeper
-00019da0: 696f 643d 3530 290a 2020 2020 2020 2020  iod=50).        
-00019db0: 2020 2020 2020 2020 6c6d 6120 3d20 706b          lma = pk
-00019dc0: 7461 6c69 622e 454d 4128 6461 7461 5b22  talib.EMA(data["
-00019dd0: 436c 6f73 6522 5d2c 2074 696d 6570 6572  Close"], timeper
-00019de0: 696f 643d 3230 3029 0a20 2020 2020 2020  iod=200).       
-00019df0: 2020 2020 2020 2020 2073 736d 6120 3d20           ssma = 
-00019e00: 706b 7461 6c69 622e 454d 4128 6461 7461  pktalib.EMA(data
-00019e10: 5b22 436c 6f73 6522 5d2c 2074 696d 6570  ["Close"], timep
-00019e20: 6572 696f 643d 3929 0a20 2020 2020 2020  eriod=9).       
-00019e30: 2020 2020 2020 2020 2073 736d 6132 3020           ssma20 
-00019e40: 3d20 706b 7461 6c69 622e 454d 4128 6461  = pktalib.EMA(da
-00019e50: 7461 5b22 436c 6f73 6522 5d2c 2074 696d  ta["Close"], tim
-00019e60: 6570 6572 696f 643d 3230 290a 2020 2020  eperiod=20).    
-00019e70: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00019e80: 2e69 6e73 6572 7428 6c65 6e28 6461 7461  .insert(len(data
-00019e90: 2e63 6f6c 756d 6e73 292c 2022 534d 4122  .columns), "SMA"
-00019ea0: 2c20 736d 6129 0a20 2020 2020 2020 2020  , sma).         
-00019eb0: 2020 2020 2020 2064 6174 612e 696e 7365         data.inse
-00019ec0: 7274 286c 656e 2864 6174 612e 636f 6c75  rt(len(data.colu
-00019ed0: 6d6e 7329 2c20 224c 4d41 222c 206c 6d61  mns), "LMA", lma
-00019ee0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019ef0: 2020 6461 7461 2e69 6e73 6572 7428 6c65    data.insert(le
-00019f00: 6e28 6461 7461 2e63 6f6c 756d 6e73 292c  n(data.columns),
-00019f10: 2022 5353 4d41 222c 2073 736d 6129 0a20   "SSMA", ssma). 
-00019f20: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00019f30: 6174 612e 696e 7365 7274 286c 656e 2864  ata.insert(len(d
-00019f40: 6174 612e 636f 6c75 6d6e 7329 2c20 2253  ata.columns), "S
-00019f50: 534d 4132 3022 2c20 7373 6d61 3230 290a  SMA20", ssma20).
-00019f60: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00019f70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019f80: 2020 736d 6120 3d20 706b 7461 6c69 622e    sma = pktalib.
-00019f90: 534d 4128 6461 7461 5b22 436c 6f73 6522  SMA(data["Close"
-00019fa0: 5d2c 2074 696d 6570 6572 696f 643d 3530  ], timeperiod=50
-00019fb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019fc0: 2020 6c6d 6120 3d20 706b 7461 6c69 622e    lma = pktalib.
-00019fd0: 534d 4128 6461 7461 5b22 436c 6f73 6522  SMA(data["Close"
-00019fe0: 5d2c 2074 696d 6570 6572 696f 643d 3230  ], timeperiod=20
-00019ff0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-0001a000: 2020 2073 736d 6120 3d20 706b 7461 6c69     ssma = pktali
-0001a010: 622e 534d 4128 6461 7461 5b22 436c 6f73  b.SMA(data["Clos
-0001a020: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
-0001a030: 3929 0a20 2020 2020 2020 2020 2020 2020  9).             
-0001a040: 2020 2073 736d 6132 3020 3d20 706b 7461     ssma20 = pkta
-0001a050: 6c69 622e 534d 4128 6461 7461 5b22 436c  lib.SMA(data["Cl
-0001a060: 6f73 6522 5d2c 2074 696d 6570 6572 696f  ose"], timeperio
-0001a070: 643d 3230 290a 2020 2020 2020 2020 2020  d=20).          
-0001a080: 2020 2020 2020 6461 7461 2e69 6e73 6572        data.inser
-0001a090: 7428 6c65 6e28 6461 7461 2e63 6f6c 756d  t(len(data.colum
-0001a0a0: 6e73 292c 2022 534d 4122 2c20 736d 6129  ns), "SMA", sma)
-0001a0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a0c0: 2064 6174 612e 696e 7365 7274 286c 656e   data.insert(len
-0001a0d0: 2864 6174 612e 636f 6c75 6d6e 7329 2c20  (data.columns), 
-0001a0e0: 224c 4d41 222c 206c 6d61 290a 2020 2020  "LMA", lma).    
-0001a0f0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0001a100: 2e69 6e73 6572 7428 6c65 6e28 6461 7461  .insert(len(data
-0001a110: 2e63 6f6c 756d 6e73 292c 2022 5353 4d41  .columns), "SSMA
-0001a120: 222c 2073 736d 6129 0a20 2020 2020 2020  ", ssma).       
-0001a130: 2020 2020 2020 2020 2064 6174 612e 696e           data.in
-0001a140: 7365 7274 286c 656e 2864 6174 612e 636f  sert(len(data.co
-0001a150: 6c75 6d6e 7329 2c20 2253 534d 4132 3022  lumns), "SSMA20"
-0001a160: 2c20 7373 6d61 3230 290a 2020 2020 2020  , ssma20).      
-0001a170: 2020 2020 2020 766f 6c20 3d20 706b 7461        vol = pkta
-0001a180: 6c69 622e 534d 4128 6461 7461 5b22 566f  lib.SMA(data["Vo
-0001a190: 6c75 6d65 225d 2c20 7469 6d65 7065 7269  lume"], timeperi
-0001a1a0: 6f64 3d32 3029 0a20 2020 2020 2020 2020  od=20).         
-0001a1b0: 2020 2072 7369 203d 2070 6b74 616c 6962     rsi = pktalib
-0001a1c0: 2e52 5349 2864 6174 615b 2243 6c6f 7365  .RSI(data["Close
-0001a1d0: 225d 2c20 7469 6d65 7065 7269 6f64 3d31  "], timeperiod=1
-0001a1e0: 3429 0a20 2020 2020 2020 2020 2020 2064  4).            d
-0001a1f0: 6174 612e 696e 7365 7274 286c 656e 2864  ata.insert(len(d
-0001a200: 6174 612e 636f 6c75 6d6e 7329 2c20 2256  ata.columns), "V
-0001a210: 6f6c 4d41 222c 2076 6f6c 290a 2020 2020  olMA", vol).    
+00019930: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00019940: 7374 7228 6669 6e61 6c2e 5461 7267 6574  str(final.Target
+00019950: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+00019960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019980: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+00019990: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000199a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199b0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+000199c0: 313a 7b72 6973 6b5f 7265 7761 7264 7d22  1:{risk_reward}"
+000199d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000199e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199f0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+00019a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a20: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00019a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a40: 2020 2020 2020 2063 6f6c 756d 6e73 3d72         columns=r
+00019a50: 6573 756c 745f 6466 2e63 6f6c 756d 6e73  esult_df.columns
+00019a60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a80: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+00019a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019aa0: 205d 2c0a 2020 2020 2020 2020 2020 2020   ],.            
+00019ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ac0: 6178 6973 3d30 2c0a 2020 2020 2020 2020  axis=0,.        
+00019ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ae0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019af0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00019b00: 5f64 662e 7265 7365 745f 696e 6465 7828  _df.reset_index(
+00019b10: 6472 6f70 3d54 7275 652c 2069 6e70 6c61  drop=True, inpla
+00019b20: 6365 3d54 7275 6529 0a20 2020 2020 2020  ce=True).       
+00019b30: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00019b40: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00019b50: 2065 3a20 2023 2070 7261 676d 613a 206e   e:  # pragma: n
+00019b60: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
+00019b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b80: 7365 6c66 2e64 6566 6175 6c74 5f6c 6f67  self.default_log
+00019b90: 6765 722e 6465 6275 6728 652c 2065 7863  ger.debug(e, exc
+00019ba0: 5f69 6e66 6f3d 5472 7565 290a 2020 2020  _info=True).    
+00019bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019bc0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00019bd0: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+00019be0: 6865 6e20 7570 6461 7465 0a20 2020 2020  hen update.     
+00019bf0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00019c00: 6173 745f 7369 676e 616c 5b64 6174 615f  ast_signal[data_
+00019c10: 6c69 7374 5b63 6e74 5d5d 203d 205b 6669  list[cnt]] = [fi
+00019c20: 6e61 6c5d 0a20 2020 2020 2020 2069 6620  nal].        if 
+00019c30: 7265 7375 6c74 5f64 6620 6973 206e 6f74  result_df is not
+00019c40: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00019c50: 2020 2072 6573 756c 745f 6466 2e64 726f     result_df.dro
+00019c60: 705f 6475 706c 6963 6174 6573 286b 6565  p_duplicates(kee
+00019c70: 703d 226c 6173 7422 2c20 696e 706c 6163  p="last", inplac
+00019c80: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+00019c90: 2020 2020 7265 7375 6c74 5f64 662e 736f      result_df.so
+00019ca0: 7274 5f76 616c 7565 7328 6279 3d22 5469  rt_values(by="Ti
+00019cb0: 6d65 222c 2069 6e70 6c61 6365 3d54 7275  me", inplace=Tru
+00019cc0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+00019cd0: 6e20 7265 7375 6c74 5f64 665b 3a3a 2d31  n result_df[::-1
+00019ce0: 5d0a 0a20 2020 2023 2050 7265 7072 6f63  ]..    # Preproc
+00019cf0: 6573 7320 7468 6520 6163 7175 6972 6564  ess the acquired
+00019d00: 2064 6174 610a 2020 2020 6465 6620 7072   data.    def pr
+00019d10: 6570 726f 6365 7373 4461 7461 2873 656c  eprocessData(sel
+00019d20: 662c 2064 662c 2064 6179 7354 6f4c 6f6f  f, df, daysToLoo
+00019d30: 6b62 6163 6b3d 4e6f 6e65 293a 0a20 2020  kback=None):.   
+00019d40: 2020 2020 2061 7373 6572 7420 6973 696e       assert isin
+00019d50: 7374 616e 6365 2864 662c 2070 642e 4461  stance(df, pd.Da
+00019d60: 7461 4672 616d 6529 0a20 2020 2020 2020  taFrame).       
+00019d70: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+00019d80: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+00019d90: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+00019da0: 3d20 6461 7461 2e72 6570 6c61 6365 286e  = data.replace(n
+00019db0: 702e 696e 662c 206e 702e 6e61 6e29 2e72  p.inf, np.nan).r
+00019dc0: 6570 6c61 6365 282d 6e70 2e69 6e66 2c20  eplace(-np.inf, 
+00019dd0: 6e70 2e6e 616e 292e 6472 6f70 6e61 2868  np.nan).dropna(h
+00019de0: 6f77 3d22 616c 6c22 290a 2020 2020 2020  ow="all").      
+00019df0: 2020 2020 2020 2320 7365 6c66 2e64 6566        # self.def
+00019e00: 6175 6c74 5f6c 6f67 6765 722e 696e 666f  ault_logger.info
+00019e10: 2866 2250 7265 7072 6f63 6573 7369 6e67  (f"Preprocessing
+00019e20: 2064 6174 613a 5c6e 7b64 6174 612e 6865   data:\n{data.he
+00019e30: 6164 2831 297d 5c6e 2229 0a20 2020 2020  ad(1)}\n").     
+00019e40: 2020 2020 2020 2069 6620 6461 7973 546f         if daysTo
+00019e50: 4c6f 6f6b 6261 636b 2069 7320 4e6f 6e65  Lookback is None
+00019e60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019e70: 2020 6461 7973 546f 4c6f 6f6b 6261 636b    daysToLookback
+00019e80: 203d 2073 656c 662e 636f 6e66 6967 4d61   = self.configMa
+00019e90: 6e61 6765 722e 6461 7973 546f 4c6f 6f6b  nager.daysToLook
+00019ea0: 6261 636b 0a20 2020 2020 2020 2020 2020  back.           
+00019eb0: 2069 6620 7365 6c66 2e63 6f6e 6669 674d   if self.configM
+00019ec0: 616e 6167 6572 2e75 7365 454d 413a 0a20  anager.useEMA:. 
+00019ed0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00019ee0: 6d61 203d 2070 6b74 616c 6962 2e45 4d41  ma = pktalib.EMA
+00019ef0: 2864 6174 615b 2243 6c6f 7365 225d 2c20  (data["Close"], 
+00019f00: 7469 6d65 7065 7269 6f64 3d35 3029 0a20  timeperiod=50). 
+00019f10: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00019f20: 6d61 203d 2070 6b74 616c 6962 2e45 4d41  ma = pktalib.EMA
+00019f30: 2864 6174 615b 2243 6c6f 7365 225d 2c20  (data["Close"], 
+00019f40: 7469 6d65 7065 7269 6f64 3d32 3030 290a  timeperiod=200).
+00019f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f60: 7373 6d61 203d 2070 6b74 616c 6962 2e45  ssma = pktalib.E
+00019f70: 4d41 2864 6174 615b 2243 6c6f 7365 225d  MA(data["Close"]
+00019f80: 2c20 7469 6d65 7065 7269 6f64 3d39 290a  , timeperiod=9).
+00019f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fa0: 7373 6d61 3230 203d 2070 6b74 616c 6962  ssma20 = pktalib
+00019fb0: 2e45 4d41 2864 6174 615b 2243 6c6f 7365  .EMA(data["Close
+00019fc0: 225d 2c20 7469 6d65 7065 7269 6f64 3d32  "], timeperiod=2
+00019fd0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+00019fe0: 2020 2064 6174 612e 696e 7365 7274 286c     data.insert(l
+00019ff0: 656e 2864 6174 612e 636f 6c75 6d6e 7329  en(data.columns)
+0001a000: 2c20 2253 4d41 222c 2073 6d61 290a 2020  , "SMA", sma).  
+0001a010: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0001a020: 7461 2e69 6e73 6572 7428 6c65 6e28 6461  ta.insert(len(da
+0001a030: 7461 2e63 6f6c 756d 6e73 292c 2022 4c4d  ta.columns), "LM
+0001a040: 4122 2c20 6c6d 6129 0a20 2020 2020 2020  A", lma).       
+0001a050: 2020 2020 2020 2020 2064 6174 612e 696e           data.in
+0001a060: 7365 7274 286c 656e 2864 6174 612e 636f  sert(len(data.co
+0001a070: 6c75 6d6e 7329 2c20 2253 534d 4122 2c20  lumns), "SSMA", 
+0001a080: 7373 6d61 290a 2020 2020 2020 2020 2020  ssma).          
+0001a090: 2020 2020 2020 6461 7461 2e69 6e73 6572        data.inser
+0001a0a0: 7428 6c65 6e28 6461 7461 2e63 6f6c 756d  t(len(data.colum
+0001a0b0: 6e73 292c 2022 5353 4d41 3230 222c 2073  ns), "SSMA20", s
+0001a0c0: 736d 6132 3029 0a20 2020 2020 2020 2020  sma20).         
+0001a0d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001a0e0: 2020 2020 2020 2020 2073 6d61 203d 2070           sma = p
+0001a0f0: 6b74 616c 6962 2e53 4d41 2864 6174 615b  ktalib.SMA(data[
+0001a100: 2243 6c6f 7365 225d 2c20 7469 6d65 7065  "Close"], timepe
+0001a110: 7269 6f64 3d35 3029 0a20 2020 2020 2020  riod=50).       
+0001a120: 2020 2020 2020 2020 206c 6d61 203d 2070           lma = p
+0001a130: 6b74 616c 6962 2e53 4d41 2864 6174 615b  ktalib.SMA(data[
+0001a140: 2243 6c6f 7365 225d 2c20 7469 6d65 7065  "Close"], timepe
+0001a150: 7269 6f64 3d32 3030 290a 2020 2020 2020  riod=200).      
+0001a160: 2020 2020 2020 2020 2020 7373 6d61 203d            ssma =
+0001a170: 2070 6b74 616c 6962 2e53 4d41 2864 6174   pktalib.SMA(dat
+0001a180: 615b 2243 6c6f 7365 225d 2c20 7469 6d65  a["Close"], time
+0001a190: 7065 7269 6f64 3d39 290a 2020 2020 2020  period=9).      
+0001a1a0: 2020 2020 2020 2020 2020 7373 6d61 3230            ssma20
+0001a1b0: 203d 2070 6b74 616c 6962 2e53 4d41 2864   = pktalib.SMA(d
+0001a1c0: 6174 615b 2243 6c6f 7365 225d 2c20 7469  ata["Close"], ti
+0001a1d0: 6d65 7065 7269 6f64 3d32 3029 0a20 2020  meperiod=20).   
+0001a1e0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0001a1f0: 612e 696e 7365 7274 286c 656e 2864 6174  a.insert(len(dat
+0001a200: 612e 636f 6c75 6d6e 7329 2c20 2253 4d41  a.columns), "SMA
+0001a210: 222c 2073 6d61 290a 2020 2020 2020 2020  ", sma).        
 0001a220: 2020 2020 2020 2020 6461 7461 2e69 6e73          data.ins
 0001a230: 6572 7428 6c65 6e28 6461 7461 2e63 6f6c  ert(len(data.col
-0001a240: 756d 6e73 292c 2022 5253 4922 2c20 7273  umns), "RSI", rs
-0001a250: 6929 0a20 2020 2020 2020 2020 2020 2063  i).            c
-0001a260: 6369 203d 2070 6b74 616c 6962 2e43 4349  ci = pktalib.CCI
-0001a270: 2864 6174 615b 2248 6967 6822 5d2c 2064  (data["High"], d
-0001a280: 6174 615b 224c 6f77 225d 2c20 6461 7461  ata["Low"], data
-0001a290: 5b22 436c 6f73 6522 5d2c 2074 696d 6570  ["Close"], timep
-0001a2a0: 6572 696f 643d 3134 290a 2020 2020 2020  eriod=14).      
-0001a2b0: 2020 2020 2020 6461 7461 2e69 6e73 6572        data.inser
-0001a2c0: 7428 6c65 6e28 6461 7461 2e63 6f6c 756d  t(len(data.colum
-0001a2d0: 6e73 292c 2022 4343 4922 2c20 6363 6929  ns), "CCI", cci)
-0001a2e0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-0001a2f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a300: 2020 6661 7374 6b2c 2066 6173 7464 203d    fastk, fastd =
-0001a310: 2070 6b74 616c 6962 2e53 544f 4348 5253   pktalib.STOCHRS
-0001a320: 4928 0a20 2020 2020 2020 2020 2020 2020  I(.             
-0001a330: 2020 2020 2020 2064 6174 615b 2243 6c6f         data["Clo
-0001a340: 7365 225d 2c20 7469 6d65 7065 7269 6f64  se"], timeperiod
-0001a350: 3d31 342c 2066 6173 746b 5f70 6572 696f  =14, fastk_perio
-0001a360: 643d 352c 2066 6173 7464 5f70 6572 696f  d=5, fastd_perio
-0001a370: 643d 332c 2066 6173 7464 5f6d 6174 7970  d=3, fastd_matyp
-0001a380: 653d 300a 2020 2020 2020 2020 2020 2020  e=0.            
-0001a390: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0001a3a0: 2020 2020 2020 6461 7461 2e69 6e73 6572        data.inser
-0001a3b0: 7428 6c65 6e28 6461 7461 2e63 6f6c 756d  t(len(data.colum
-0001a3c0: 6e73 292c 2022 4641 5354 4b22 2c20 6661  ns), "FASTK", fa
-0001a3d0: 7374 6b29 0a20 2020 2020 2020 2020 2020  stk).           
-0001a3e0: 2020 2020 2064 6174 612e 696e 7365 7274       data.insert
-0001a3f0: 286c 656e 2864 6174 612e 636f 6c75 6d6e  (len(data.column
-0001a400: 7329 2c20 2246 4153 5444 222c 2066 6173  s), "FASTD", fas
-0001a410: 7464 290a 2020 2020 2020 2020 2020 2020  td).            
-0001a420: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0001a430: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001a440: 2020 2020 2020 2073 656c 662e 6465 6661         self.defa
-0001a450: 756c 745f 6c6f 6767 6572 2e64 6562 7567  ult_logger.debug
-0001a460: 2865 2c20 6578 635f 696e 666f 3d54 7275  (e, exc_info=Tru
-0001a470: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001a480: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-0001a490: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0001a4a0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001a4b0: 2020 2020 2020 2073 656c 662e 6465 6661         self.defa
-0001a4c0: 756c 745f 6c6f 6767 6572 2e64 6562 7567  ult_logger.debug
-0001a4d0: 2865 2c20 6578 635f 696e 666f 3d54 7275  (e, exc_info=Tru
-0001a4e0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001a4f0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-0001a500: 6461 7461 203d 2064 6174 615b 3a3a 2d31  data = data[::-1
-0001a510: 5d20 2023 2052 6576 6572 7365 2074 6865  ]  # Reverse the
-0001a520: 2064 6174 6166 7261 6d65 0a20 2020 2020   dataframe.     
-0001a530: 2020 2023 2064 6174 6120 3d20 6461 7461     # data = data
-0001a540: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-0001a550: 2020 2023 2064 6174 6120 3d20 6461 7461     # data = data
-0001a560: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
-0001a570: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
-0001a580: 2020 2020 2020 2066 756c 6c44 6174 6120         fullData 
-0001a590: 3d20 6461 7461 0a20 2020 2020 2020 2074  = data.        t
-0001a5a0: 7269 6d6d 6564 4461 7461 203d 2064 6174  rimmedData = dat
-0001a5b0: 612e 6865 6164 2864 6179 7354 6f4c 6f6f  a.head(daysToLoo
-0001a5c0: 6b62 6163 6b29 0a20 2020 2020 2020 2072  kback).        r
-0001a5d0: 6574 7572 6e20 2866 756c 6c44 6174 612c  eturn (fullData,
-0001a5e0: 2074 7269 6d6d 6564 4461 7461 290a 0a20   trimmedData).. 
-0001a5f0: 2020 2023 2056 616c 6964 6174 6520 6966     # Validate if
-0001a600: 2074 6865 2073 746f 636b 2069 7320 6275   the stock is bu
-0001a610: 6c6c 6973 6820 696e 2074 6865 2073 686f  llish in the sho
-0001a620: 7274 2074 6572 6d0a 2020 2020 6465 6620  rt term.    def 
-0001a630: 7661 6c69 6461 7465 3135 4d69 6e75 7465  validate15Minute
-0001a640: 5072 6963 6556 6f6c 756d 6542 7265 616b  PriceVolumeBreak
-0001a650: 6f75 7428 7365 6c66 2c20 6466 293a 0a20  out(self, df):. 
-0001a660: 2020 2020 2020 2069 6620 6466 2069 7320         if df is 
-0001a670: 4e6f 6e65 206f 7220 6c65 6e28 6466 2920  None or len(df) 
-0001a680: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0001a690: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-0001a6a0: 2020 2020 2020 2023 2068 7474 7073 3a2f         # https:/
-0001a6b0: 2f63 6861 7274 696e 6b2e 636f 6d2f 7363  /chartink.com/sc
-0001a6c0: 7265 656e 6572 2f31 352d 6d69 6e2d 7072  reener/15-min-pr
-0001a6d0: 6963 652d 766f 6c75 6d65 2d62 7265 616b  ice-volume-break
-0001a6e0: 6f75 740a 2020 2020 2020 2020 6461 7461  out.        data
-0001a6f0: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-0001a700: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0001a710: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-0001a720: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-0001a730: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-0001a740: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-0001a750: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0001a760: 5b3a 3a2d 315d 2020 2320 5265 7665 7273  [::-1]  # Revers
-0001a770: 6520 7468 6520 6461 7461 6672 616d 6520  e the dataframe 
-0001a780: 736f 2074 6861 7420 6974 7320 7468 6520  so that its the 
-0001a790: 6f6c 6465 7374 2064 6174 6520 6669 7273  oldest date firs
-0001a7a0: 740a 2020 2020 2020 2020 6461 7461 5b22  t.        data["
-0001a7b0: 534d 4132 3022 5d20 3d20 706b 7461 6c69  SMA20"] = pktali
-0001a7c0: 622e 534d 4128 6461 7461 5b22 436c 6f73  b.SMA(data["Clos
-0001a7d0: 6522 5d2c 2032 3029 0a20 2020 2020 2020  e"], 20).       
-0001a7e0: 2064 6174 615b 2253 4d41 3230 5622 5d20   data["SMA20V"] 
-0001a7f0: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
-0001a800: 7461 5b22 566f 6c75 6d65 225d 2c20 3230  ta["Volume"], 20
-0001a810: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-0001a820: 2064 6174 615b 0a20 2020 2020 2020 2020   data[.         
-0001a830: 2020 203a 3a2d 310a 2020 2020 2020 2020     ::-1.        
-0001a840: 5d20 2023 2052 6576 6572 7365 2074 6865  ]  # Reverse the
-0001a850: 2064 6174 6166 7261 6d65 2073 6f20 7468   dataframe so th
-0001a860: 6174 2069 7427 7320 7468 6520 6d6f 7374  at it's the most
-0001a870: 2072 6563 656e 7420 6461 7465 2066 6972   recent date fir
-0001a880: 7374 0a20 2020 2020 2020 2072 6563 656e  st.        recen
-0001a890: 7420 3d20 6461 7461 2e68 6561 6428 3329  t = data.head(3)
-0001a8a0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-0001a8b0: 7265 6365 6e74 2920 3c20 333a 0a20 2020  recent) < 3:.   
-0001a8c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001a8d0: 4661 6c73 650a 2020 2020 2020 2020 636f  False.        co
-0001a8e0: 6e64 3120 3d20 7265 6365 6e74 5b22 436c  nd1 = recent["Cl
-0001a8f0: 6f73 6522 5d2e 696c 6f63 5b30 5d20 3e20  ose"].iloc[0] > 
-0001a900: 7265 6365 6e74 5b22 436c 6f73 6522 5d2e  recent["Close"].
-0001a910: 696c 6f63 5b31 5d0a 2020 2020 2020 2020  iloc[1].        
-0001a920: 636f 6e64 3220 3d20 636f 6e64 3120 616e  cond2 = cond1 an
-0001a930: 6420 2872 6563 656e 745b 2243 6c6f 7365  d (recent["Close
-0001a940: 225d 2e69 6c6f 635b 305d 203e 2072 6563  "].iloc[0] > rec
-0001a950: 656e 745b 2253 4d41 3230 225d 2e69 6c6f  ent["SMA20"].ilo
-0001a960: 635b 305d 290a 2020 2020 2020 2020 636f  c[0]).        co
-0001a970: 6e64 3320 3d20 636f 6e64 3220 616e 6420  nd3 = cond2 and 
-0001a980: 2872 6563 656e 745b 2243 6c6f 7365 225d  (recent["Close"]
-0001a990: 2e69 6c6f 635b 315d 203e 2072 6563 656e  .iloc[1] > recen
-0001a9a0: 745b 2248 6967 6822 5d2e 696c 6f63 5b32  t["High"].iloc[2
-0001a9b0: 5d29 0a20 2020 2020 2020 2063 6f6e 6434  ]).        cond4
-0001a9c0: 203d 2063 6f6e 6433 2061 6e64 2028 7265   = cond3 and (re
-0001a9d0: 6365 6e74 5b22 566f 6c75 6d65 225d 2e69  cent["Volume"].i
-0001a9e0: 6c6f 635b 305d 203e 2072 6563 656e 745b  loc[0] > recent[
-0001a9f0: 2253 4d41 3230 5622 5d2e 696c 6f63 5b30  "SMA20V"].iloc[0
-0001aa00: 5d29 0a20 2020 2020 2020 2063 6f6e 6435  ]).        cond5
-0001aa10: 203d 2063 6f6e 6434 2061 6e64 2028 7265   = cond4 and (re
-0001aa20: 6365 6e74 5b22 566f 6c75 6d65 225d 2e69  cent["Volume"].i
-0001aa30: 6c6f 635b 315d 203e 2072 6563 656e 745b  loc[1] > recent[
-0001aa40: 2253 4d41 3230 5622 5d2e 696c 6f63 5b30  "SMA20V"].iloc[0
-0001aa50: 5d29 0a20 2020 2020 2020 2072 6574 7572  ]).        retur
-0001aa60: 6e20 636f 6e64 350a 0a20 2020 2064 6566  n cond5..    def
-0001aa70: 2076 616c 6964 6174 6542 756c 6c69 7368   validateBullish
-0001aa80: 466f 7254 6f6d 6f72 726f 7728 7365 6c66  ForTomorrow(self
-0001aa90: 2c20 6466 293a 0a20 2020 2020 2020 2069  , df):.        i
-0001aaa0: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
-0001aab0: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
-0001aac0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001aad0: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-0001aae0: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
-0001aaf0: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
-0001ab00: 2f2f 6368 6172 7469 6e6b 2e63 6f6d 2f73  //chartink.com/s
-0001ab10: 6372 6565 6e65 722f 6275 6c6c 6973 682d  creener/bullish-
-0001ab20: 666f 722d 746f 6d6f 7272 6f77 0a20 2020  for-tomorrow.   
-0001ab30: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0001ab40: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-0001ab50: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-0001ab60: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-0001ab70: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-0001ab80: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0001ab90: 5b3a 3a2d 315d 2020 2320 5265 7665 7273  [::-1]  # Revers
-0001aba0: 6520 7468 6520 6461 7461 6672 616d 6520  e the dataframe 
-0001abb0: 736f 2074 6861 7420 6974 7320 7468 6520  so that its the 
-0001abc0: 6f6c 6465 7374 2064 6174 6520 6669 7273  oldest date firs
-0001abd0: 740a 2020 2020 2020 2020 6d61 6364 4c69  t.        macdLi
-0001abe0: 6e65 203d 2070 6b74 616c 6962 2e4d 4143  ne = pktalib.MAC
-0001abf0: 4428 6461 7461 5b22 436c 6f73 6522 5d2c  D(data["Close"],
-0001ac00: 2031 322c 2032 362c 2039 295b 305d 2e74   12, 26, 9)[0].t
-0001ac10: 6169 6c28 3329 0a20 2020 2020 2020 206d  ail(3).        m
-0001ac20: 6163 6453 6967 6e61 6c20 3d20 706b 7461  acdSignal = pkta
-0001ac30: 6c69 622e 4d41 4344 2864 6174 615b 2243  lib.MACD(data["C
-0001ac40: 6c6f 7365 225d 2c20 3132 2c20 3236 2c20  lose"], 12, 26, 
-0001ac50: 3929 5b31 5d2e 7461 696c 2833 290a 2020  9)[1].tail(3).  
-0001ac60: 2020 2020 2020 6d61 6364 4869 7374 203d        macdHist =
-0001ac70: 2070 6b74 616c 6962 2e4d 4143 4428 6461   pktalib.MACD(da
-0001ac80: 7461 5b22 436c 6f73 6522 5d2c 2031 322c  ta["Close"], 12,
-0001ac90: 2032 362c 2039 295b 325d 2e74 6169 6c28   26, 9)[2].tail(
-0001aca0: 3329 0a0a 2020 2020 2020 2020 7265 7475  3)..        retu
-0001acb0: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
-0001acc0: 2028 6d61 6364 4869 7374 2e69 6c6f 635b   (macdHist.iloc[
-0001acd0: 3a31 5d2e 696c 6f63 5b30 5d20 3c20 6d61  :1].iloc[0] < ma
-0001ace0: 6364 4869 7374 2e69 6c6f 635b 3a32 5d2e  cdHist.iloc[:2].
-0001acf0: 696c 6f63 5b31 5d29 0a20 2020 2020 2020  iloc[1]).       
-0001ad00: 2020 2020 2061 6e64 2028 6d61 6364 4869       and (macdHi
-0001ad10: 7374 2e69 6c6f 635b 3a33 5d2e 696c 6f63  st.iloc[:3].iloc
-0001ad20: 5b32 5d20 3e20 6d61 6364 4869 7374 2e69  [2] > macdHist.i
-0001ad30: 6c6f 635b 3a32 5d2e 696c 6f63 5b31 5d29  loc[:2].iloc[1])
-0001ad40: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-0001ad50: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0001ad60: 2020 2028 6d61 6364 4c69 6e65 2e69 6c6f     (macdLine.ilo
-0001ad70: 635b 3a33 5d2e 696c 6f63 5b32 5d20 2d20  c[:3].iloc[2] - 
-0001ad80: 6d61 6364 5369 676e 616c 2e69 6c6f 635b  macdSignal.iloc[
-0001ad90: 3a33 5d2e 696c 6f63 5b32 5d29 0a20 2020  :3].iloc[2]).   
-0001ada0: 2020 2020 2020 2020 2020 2020 202d 2028               - (
-0001adb0: 6d61 6364 4c69 6e65 2e69 6c6f 635b 3a32  macdLine.iloc[:2
-0001adc0: 5d2e 696c 6f63 5b31 5d20 2d20 6d61 6364  ].iloc[1] - macd
-0001add0: 5369 676e 616c 2e69 6c6f 635b 3a32 5d2e  Signal.iloc[:2].
-0001ade0: 696c 6f63 5b31 5d29 0a20 2020 2020 2020  iloc[1]).       
-0001adf0: 2020 2020 2020 2020 203e 3d20 302e 340a           >= 0.4.
-0001ae00: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001ae10: 2020 2020 2020 2020 2020 616e 6420 280a            and (.
-0001ae20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae30: 286d 6163 644c 696e 652e 696c 6f63 5b3a  (macdLine.iloc[:
-0001ae40: 325d 2e69 6c6f 635b 315d 202d 206d 6163  2].iloc[1] - mac
-0001ae50: 6453 6967 6e61 6c2e 696c 6f63 5b3a 325d  dSignal.iloc[:2]
-0001ae60: 2e69 6c6f 635b 315d 290a 2020 2020 2020  .iloc[1]).      
-0001ae70: 2020 2020 2020 2020 2020 2d20 286d 6163            - (mac
-0001ae80: 644c 696e 652e 696c 6f63 5b3a 315d 2e69  dLine.iloc[:1].i
-0001ae90: 6c6f 635b 305d 202d 206d 6163 6453 6967  loc[0] - macdSig
-0001aea0: 6e61 6c2e 696c 6f63 5b3a 315d 2e69 6c6f  nal.iloc[:1].ilo
-0001aeb0: 635b 305d 290a 2020 2020 2020 2020 2020  c[0]).          
-0001aec0: 2020 2020 2020 3c3d 2030 2e32 0a20 2020        <= 0.2.   
-0001aed0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001aee0: 2020 2020 2020 2061 6e64 2028 6d61 6364         and (macd
-0001aef0: 4c69 6e65 2e69 6c6f 635b 3a33 5d2e 696c  Line.iloc[:3].il
-0001af00: 6f63 5b32 5d20 3e20 6d61 6364 5369 676e  oc[2] > macdSign
-0001af10: 616c 2e69 6c6f 635b 3a33 5d2e 696c 6f63  al.iloc[:3].iloc
-0001af20: 5b32 5d29 0a20 2020 2020 2020 2020 2020  [2]).           
-0001af30: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
-0001af40: 2020 2020 2020 2028 6d61 6364 4c69 6e65         (macdLine
-0001af50: 2e69 6c6f 635b 3a33 5d2e 696c 6f63 5b32  .iloc[:3].iloc[2
-0001af60: 5d20 2d20 6d61 6364 5369 676e 616c 2e69  ] - macdSignal.i
-0001af70: 6c6f 635b 3a33 5d2e 696c 6f63 5b32 5d29  loc[:3].iloc[2])
-0001af80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001af90: 202d 2028 6d61 6364 4c69 6e65 2e69 6c6f   - (macdLine.ilo
-0001afa0: 635b 3a32 5d2e 696c 6f63 5b31 5d20 2d20  c[:2].iloc[1] - 
-0001afb0: 6d61 6364 5369 676e 616c 2e69 6c6f 635b  macdSignal.iloc[
-0001afc0: 3a32 5d2e 696c 6f63 5b31 5d29 0a20 2020  :2].iloc[1]).   
-0001afd0: 2020 2020 2020 2020 2020 2020 203c 2031               < 1
-0001afe0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001aff0: 2020 2020 2020 2029 0a0a 2020 2020 2340         )..    #@
-0001b000: 6d65 6173 7572 655f 7469 6d65 0a20 2020  measure_time.   
-0001b010: 2023 2076 616c 6964 6174 6520 6966 2043   # validate if C
-0001b020: 4349 2069 7320 7769 7468 696e 2067 6976  CI is within giv
-0001b030: 656e 2072 616e 6765 0a20 2020 2064 6566  en range.    def
-0001b040: 2076 616c 6964 6174 6543 4349 2873 656c   validateCCI(sel
-0001b050: 662c 2064 662c 2073 6372 6565 6e44 6963  f, df, screenDic
-0001b060: 742c 2073 6176 6544 6963 742c 206d 696e  t, saveDict, min
-0001b070: 4343 492c 206d 6178 4343 4929 3a0a 2020  CCI, maxCCI):.  
-0001b080: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
-0001b090: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
-0001b0a0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0001b0b0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-0001b0c0: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
-0001b0d0: 636f 7079 2829 0a20 2020 2020 2020 2064  copy().        d
-0001b0e0: 6174 6120 3d20 6461 7461 2e66 696c 6c6e  ata = data.filln
-0001b0f0: 6128 3029 0a20 2020 2020 2020 2064 6174  a(0).        dat
-0001b100: 6120 3d20 6461 7461 2e72 6570 6c61 6365  a = data.replace
-0001b110: 285b 6e70 2e69 6e66 2c20 2d6e 702e 696e  ([np.inf, -np.in
-0001b120: 665d 2c20 3029 0a20 2020 2020 2020 2063  f], 0).        c
-0001b130: 6369 203d 2069 6e74 2864 6174 612e 6865  ci = int(data.he
-0001b140: 6164 2831 295b 2243 4349 225d 2e69 6c6f  ad(1)["CCI"].ilo
-0001b150: 635b 305d 290a 2020 2020 2020 2020 7361  c[0]).        sa
-0001b160: 7665 4469 6374 5b22 4343 4922 5d20 3d20  veDict["CCI"] = 
-0001b170: 6363 690a 2020 2020 2020 2020 6966 2028  cci.        if (
-0001b180: 6363 6920 3e3d 206d 696e 4343 4920 616e  cci >= minCCI an
-0001b190: 6420 6363 6920 3c3d 206d 6178 4343 4929  d cci <= maxCCI)
-0001b1a0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0001b1b0: 2028 2255 7022 2069 6e20 7361 7665 4469   ("Up" in saveDi
-0001b1c0: 6374 5b22 5472 656e 6422 5d29 3a0a 2020  ct["Trend"]):.  
-0001b1d0: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-0001b1e0: 7265 656e 4469 6374 5b22 4343 4922 5d20  reenDict["CCI"] 
-0001b1f0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0001b200: 2020 2020 2020 2020 2863 6f6c 6f72 5465          (colorTe
-0001b210: 7874 2e42 4f4c 4420 6966 2028 2253 7472  xt.BOLD if ("Str
-0001b220: 6f6e 6722 2069 6e20 7361 7665 4469 6374  ong" in saveDict
-0001b230: 5b22 5472 656e 6422 5d29 2065 6c73 6520  ["Trend"]) else 
-0001b240: 2222 2920 2b20 636f 6c6f 7254 6578 742e  "") + colorText.
-0001b250: 4752 4545 4e20 2b20 7374 7228 6363 6929  GREEN + str(cci)
-0001b260: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-0001b270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b280: 2029 0a20 2020 2020 2020 2020 2020 2065   ).            e
-0001b290: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001b2a0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-0001b2b0: 2243 4349 225d 203d 2028 0a20 2020 2020  "CCI"] = (.     
-0001b2c0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0001b2d0: 636f 6c6f 7254 6578 742e 424f 4c44 2069  colorText.BOLD i
-0001b2e0: 6620 2822 5374 726f 6e67 2220 696e 2073  f ("Strong" in s
-0001b2f0: 6176 6544 6963 745b 2254 7265 6e64 225d  aveDict["Trend"]
-0001b300: 2920 656c 7365 2022 2229 202b 2063 6f6c  ) else "") + col
-0001b310: 6f72 5465 7874 2e46 4149 4c20 2b20 7374  orText.FAIL + st
-0001b320: 7228 6363 6929 202b 2063 6f6c 6f72 5465  r(cci) + colorTe
-0001b330: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-0001b340: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001b350: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-0001b360: 0a20 2020 2020 2020 2073 6372 6565 6e44  .        screenD
-0001b370: 6963 745b 2243 4349 225d 203d 2063 6f6c  ict["CCI"] = col
-0001b380: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-0001b390: 6c6f 7254 6578 742e 4641 494c 202b 2073  lorText.FAIL + s
-0001b3a0: 7472 2863 6369 2920 2b20 636f 6c6f 7254  tr(cci) + colorT
-0001b3b0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-0001b3c0: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
-0001b3d0: 2020 2320 4669 6e64 2043 6f6e 666c 7563    # Find Confluc
-0001b3e0: 656e 6365 0a20 2020 2064 6566 2076 616c  ence.    def val
-0001b3f0: 6964 6174 6543 6f6e 666c 7565 6e63 6528  idateConfluence(
-0001b400: 7365 6c66 2c20 7374 6f63 6b2c 2064 662c  self, stock, df,
-0001b410: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
-0001b420: 6544 6963 742c 2070 6572 6365 6e74 6167  eDict, percentag
-0001b430: 653d 302e 312c 636f 6e66 4669 6c74 6572  e=0.1,confFilter
-0001b440: 3d33 293a 0a20 2020 2020 2020 2069 6620  =3):.        if 
-0001b450: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
-0001b460: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
-0001b470: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0001b480: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
-0001b490: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
-0001b4a0: 2020 2020 2020 7265 6365 6e74 203d 2064        recent = d
-0001b4b0: 6174 612e 6865 6164 2832 290a 2020 2020  ata.head(2).    
-0001b4c0: 2020 2020 6966 206c 656e 2872 6563 656e      if len(recen
-0001b4d0: 7429 203c 2032 3a0a 2020 2020 2020 2020  t) < 2:.        
-0001b4e0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001b4f0: 0a20 2020 2020 2020 206b 6579 3120 3d20  .        key1 = 
-0001b500: 2253 4d41 220a 2020 2020 2020 2020 6b65  "SMA".        ke
-0001b510: 7932 203d 2022 4c4d 4122 0a20 2020 2020  y2 = "LMA".     
-0001b520: 2020 206b 6579 3320 3d20 2235 3044 4d41     key3 = "50DMA
-0001b530: 220a 2020 2020 2020 2020 6b65 7934 203d  ".        key4 =
-0001b540: 2022 3230 3044 4d41 220a 2020 2020 2020   "200DMA".      
-0001b550: 2020 6973 3230 444d 4143 726f 7373 6f76    is20DMACrossov
-0001b560: 6572 3530 444d 4120 3d20 2872 6563 656e  er50DMA = (recen
-0001b570: 745b 2253 534d 4132 3022 5d2e 696c 6f63  t["SSMA20"].iloc
-0001b580: 5b30 5d20 3e3d 2072 6563 656e 745b 2253  [0] >= recent["S
-0001b590: 4d41 225d 2e69 6c6f 635b 305d 2920 616e  MA"].iloc[0]) an
-0001b5a0: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
-0001b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5c0: 2872 6563 656e 745b 2253 534d 4132 3022  (recent["SSMA20"
-0001b5d0: 5d2e 696c 6f63 5b31 5d20 3c3d 2072 6563  ].iloc[1] <= rec
-0001b5e0: 656e 745b 2253 4d41 225d 2e69 6c6f 635b  ent["SMA"].iloc[
-0001b5f0: 315d 290a 2020 2020 2020 2020 6973 3530  1]).        is50
-0001b600: 444d 4143 726f 7373 6f76 6572 3230 3044  DMACrossover200D
-0001b610: 4d41 203d 2028 7265 6365 6e74 5b22 534d  MA = (recent["SM
-0001b620: 4122 5d2e 696c 6f63 5b30 5d20 3e3d 2072  A"].iloc[0] >= r
-0001b630: 6563 656e 745b 224c 4d41 225d 2e69 6c6f  ecent["LMA"].ilo
-0001b640: 635b 305d 2920 616e 6420 5c0a 2020 2020  c[0]) and \.    
-0001b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b660: 2020 2020 2020 2020 2872 6563 656e 745b          (recent[
-0001b670: 2253 4d41 225d 2e69 6c6f 635b 315d 203c  "SMA"].iloc[1] <
-0001b680: 3d20 7265 6365 6e74 5b22 4c4d 4122 5d2e  = recent["LMA"].
-0001b690: 696c 6f63 5b31 5d29 0a20 2020 2020 2020  iloc[1]).       
-0001b6a0: 2069 7347 6f6c 6465 6e43 726f 7373 4f76   isGoldenCrossOv
-0001b6b0: 6572 203d 2069 7332 3044 4d41 4372 6f73  er = is20DMACros
-0001b6c0: 736f 7665 7235 3044 4d41 206f 7220 6973  sover50DMA or is
-0001b6d0: 3530 444d 4143 726f 7373 6f76 6572 3230  50DMACrossover20
-0001b6e0: 3044 4d41 0a20 2020 2020 2020 2069 7335  0DMA.        is5
-0001b6f0: 3044 4d41 4372 6f73 736f 7665 7232 3030  0DMACrossover200
-0001b700: 444d 4144 6f77 6e20 3d20 2872 6563 656e  DMADown = (recen
-0001b710: 745b 2253 4d41 225d 2e69 6c6f 635b 305d  t["SMA"].iloc[0]
-0001b720: 203c 3d20 7265 6365 6e74 5b22 4c4d 4122   <= recent["LMA"
-0001b730: 5d2e 696c 6f63 5b30 5d29 2061 6e64 205c  ].iloc[0]) and \
-0001b740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b750: 2020 2020 2020 2020 2020 2020 2028 7265               (re
-0001b760: 6365 6e74 5b22 534d 4122 5d2e 696c 6f63  cent["SMA"].iloc
-0001b770: 5b31 5d20 3e3d 2072 6563 656e 745b 224c  [1] >= recent["L
-0001b780: 4d41 225d 2e69 6c6f 635b 315d 290a 2020  MA"].iloc[1]).  
-0001b790: 2020 2020 2020 6973 3230 444d 4143 726f        is20DMACro
-0001b7a0: 7373 6f76 6572 3530 444d 4144 6f77 6e20  ssover50DMADown 
-0001b7b0: 3d20 2872 6563 656e 745b 2253 534d 4132  = (recent["SSMA2
-0001b7c0: 3022 5d2e 696c 6f63 5b30 5d20 3c3d 2072  0"].iloc[0] <= r
-0001b7d0: 6563 656e 745b 2253 4d41 225d 2e69 6c6f  ecent["SMA"].ilo
-0001b7e0: 635b 305d 2920 616e 6420 5c0a 2020 2020  c[0]) and \.    
-0001b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b800: 2020 2020 2020 2020 2872 6563 656e 745b          (recent[
-0001b810: 2253 534d 4132 3022 5d2e 696c 6f63 5b31  "SSMA20"].iloc[1
-0001b820: 5d20 3e3d 2072 6563 656e 745b 2253 4d41  ] >= recent["SMA
-0001b830: 225d 2e69 6c6f 635b 315d 290a 2020 2020  "].iloc[1]).    
-0001b840: 2020 2020 6973 4465 6164 4372 6f73 734f      isDeadCrossO
-0001b850: 7665 7220 3d20 6973 3230 444d 4143 726f  ver = is20DMACro
-0001b860: 7373 6f76 6572 3530 444d 4144 6f77 6e20  ssover50DMADown 
-0001b870: 6f72 2069 7335 3044 4d41 4372 6f73 736f  or is50DMACrosso
-0001b880: 7665 7232 3030 444d 4144 6f77 6e0a 2020  ver200DMADown.  
-0001b890: 2020 2020 2020 6465 6164 784f 7665 7254        deadxOverT
-0001b8a0: 6578 7420 3d20 6627 4465 6164 4372 6f73  ext = f'DeadCros
-0001b8b0: 736f 7665 727b 2228 3230 2922 2069 6620  sover{"(20)" if 
-0001b8c0: 6973 3230 444d 4143 726f 7373 6f76 6572  is20DMACrossover
-0001b8d0: 3530 444d 4144 6f77 6e20 656c 7365 2028  50DMADown else (
-0001b8e0: 2228 3530 2922 2069 6620 6973 3530 444d  "(50)" if is50DM
-0001b8f0: 4143 726f 7373 6f76 6572 3230 3044 4d41  ACrossover200DMA
-0001b900: 446f 776e 2065 6c73 6520 2222 297d 270a  Down else "")}'.
-0001b910: 2020 2020 2020 2020 676f 6c64 656e 784f          goldenxO
-0001b920: 7665 7254 6578 7420 3d20 6627 476f 6c64  verText = f'Gold
-0001b930: 656e 4372 6f73 736f 7665 727b 2228 3230  enCrossover{"(20
-0001b940: 2922 2069 6620 6973 3230 444d 4143 726f  )" if is20DMACro
-0001b950: 7373 6f76 6572 3530 444d 4120 656c 7365  ssover50DMA else
-0001b960: 2028 2228 3530 2922 2069 6620 6973 3530   ("(50)" if is50
-0001b970: 444d 4143 726f 7373 6f76 6572 3230 3044  DMACrossover200D
-0001b980: 4d41 2065 6c73 6520 2222 297d 270a 2020  MA else "")}'.  
-0001b990: 2020 2020 2020 6966 2069 7332 3044 4d41        if is20DMA
-0001b9a0: 4372 6f73 736f 7665 7235 3044 4d41 206f  Crossover50DMA o
-0001b9b0: 7220 6973 3230 444d 4143 726f 7373 6f76  r is20DMACrossov
-0001b9c0: 6572 3530 444d 4144 6f77 6e3a 0a20 2020  er50DMADown:.   
-0001b9d0: 2020 2020 2020 2020 206b 6579 3120 3d20           key1 = 
-0001b9e0: 2253 534d 4132 3022 0a20 2020 2020 2020  "SSMA20".       
-0001b9f0: 2020 2020 206b 6579 3220 3d20 2253 4d41       key2 = "SMA
-0001ba00: 220a 2020 2020 2020 2020 2020 2020 6b65  ".            ke
-0001ba10: 7933 203d 2022 3230 444d 4122 0a20 2020  y3 = "20DMA".   
-0001ba20: 2020 2020 2020 2020 206b 6579 3420 3d20           key4 = 
-0001ba30: 2235 3044 4d41 220a 2020 2020 2020 2020  "50DMA".        
-0001ba40: 6973 3530 444d 4155 7054 7265 6e64 203d  is50DMAUpTrend =
-0001ba50: 2028 7265 6365 6e74 5b6b 6579 315d 2e69   (recent[key1].i
-0001ba60: 6c6f 635b 305d 203e 2072 6563 656e 745b  loc[0] > recent[
-0001ba70: 6b65 7932 5d2e 696c 6f63 5b31 5d29 0a20  key2].iloc[1]). 
-0001ba80: 2020 2020 2020 2069 7335 3044 4d41 446f         is50DMADo
-0001ba90: 776e 5472 656e 6420 3d20 2872 6563 656e  wnTrend = (recen
-0001baa0: 745b 6b65 7931 5d2e 696c 6f63 5b30 5d20  t[key1].iloc[0] 
-0001bab0: 3c20 7265 6365 6e74 5b6b 6579 315d 2e69  < recent[key1].i
-0001bac0: 6c6f 635b 315d 290a 2020 2020 2020 2020  loc[1]).        
-0001bad0: 6973 3530 444d 4120 3d20 2872 6563 656e  is50DMA = (recen
-0001bae0: 745b 6b65 7931 5d2e 696c 6f63 5b30 5d20  t[key1].iloc[0] 
-0001baf0: 3c3d 2072 6563 656e 745b 2243 6c6f 7365  <= recent["Close
-0001bb00: 225d 2e69 6c6f 635b 305d 290a 2020 2020  "].iloc[0]).    
-0001bb10: 2020 2020 6973 3230 3044 4d41 203d 2028      is200DMA = (
-0001bb20: 7265 6365 6e74 5b6b 6579 325d 2e69 6c6f  recent[key2].ilo
-0001bb30: 635b 305d 203c 3d20 7265 6365 6e74 5b22  c[0] <= recent["
-0001bb40: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d29  Close"].iloc[0])
-0001bb50: 0a20 2020 2020 2020 2064 6966 6665 7265  .        differe
-0001bb60: 6e63 6520 3d20 726f 756e 6428 2872 6563  nce = round((rec
-0001bb70: 656e 745b 6b65 7931 5d2e 696c 6f63 5b30  ent[key1].iloc[0
-0001bb80: 5d20 2d20 7265 6365 6e74 5b6b 6579 325d  ] - recent[key2]
-0001bb90: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
-0001bba0: 2020 2020 2020 2020 2020 2f20 7265 6365            / rece
-0001bbb0: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
-0001bbc0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-0001bbd0: 2020 2020 2a20 3130 302c 0a20 2020 2020      * 100,.     
-0001bbe0: 2020 2020 2020 2020 2020 2032 2c0a 2020             2,.  
-0001bbf0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001bc00: 2020 2020 7361 7665 4469 6374 5b22 436f      saveDict["Co
-0001bc10: 6e66 444d 4144 6966 6665 7265 6e63 6522  nfDMADifference"
-0001bc20: 5d20 3d20 6469 6666 6572 656e 6365 0a20  ] = difference. 
-0001bc30: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
-0001bc40: 745b 2243 6f6e 6644 4d41 4469 6666 6572  t["ConfDMADiffer
-0001bc50: 656e 6365 225d 203d 2064 6966 6665 7265  ence"] = differe
-0001bc60: 6e63 650a 2020 2020 2020 2020 7361 7665  nce.        save
-0001bc70: 6420 3d20 7365 6c66 2e66 696e 6443 7572  d = self.findCur
-0001bc80: 7265 6e74 5361 7665 6456 616c 7565 2873  rentSavedValue(s
-0001bc90: 6372 6565 6e44 6963 742c 7361 7665 4469  creenDict,saveDi
-0001bca0: 6374 2c22 4d41 2d53 6967 6e61 6c22 290a  ct,"MA-Signal").
-0001bcb0: 2020 2020 2020 2020 2320 6469 6666 6572          # differ
-0001bcc0: 656e 6365 203d 2061 6273 2864 6966 6665  ence = abs(diffe
-0001bcd0: 7265 6e63 6529 0a20 2020 2020 2020 2063  rence).        c
-0001bce0: 6f6e 6654 6578 7420 3d20 6622 7b67 6f6c  onfText = f"{gol
-0001bcf0: 6465 6e78 4f76 6572 5465 7874 2069 6620  denxOverText if 
-0001bd00: 6973 476f 6c64 656e 4372 6f73 734f 7665  isGoldenCrossOve
-0001bd10: 7220 656c 7365 2028 6465 6164 784f 7665  r else (deadxOve
-0001bd20: 7254 6578 7420 6966 2069 7344 6561 6443  rText if isDeadC
-0001bd30: 726f 7373 4f76 6572 2065 6c73 6520 2827  rossOver else ('
-0001bd40: 436f 6e66 2e55 7027 2069 6620 6973 3530  Conf.Up' if is50
-0001bd50: 444d 4155 7054 7265 6e64 2065 6c73 6520  DMAUpTrend else 
-0001bd60: 2827 436f 6e66 2e44 6f77 6e27 2069 6620  ('Conf.Down' if 
-0001bd70: 6973 3530 444d 4144 6f77 6e54 7265 6e64  is50DMADownTrend
-0001bd80: 2065 6c73 6520 286b 6579 3320 6966 2069   else (key3 if i
-0001bd90: 7335 3044 4d41 2065 6c73 6520 286b 6579  s50DMA else (key
-0001bda0: 3420 6966 2069 7332 3030 444d 4120 656c  4 if is200DMA el
-0001bdb0: 7365 2027 556e 6b6e 6f77 6e27 2929 2929  se 'Unknown'))))
-0001bdc0: 297d 220a 2020 2020 2020 2020 6966 2061  )}".        if a
-0001bdd0: 6273 2872 6563 656e 745b 6b65 7931 5d2e  bs(recent[key1].
-0001bde0: 696c 6f63 5b30 5d20 2d20 7265 6365 6e74  iloc[0] - recent
-0001bdf0: 5b6b 6579 325d 2e69 6c6f 635b 305d 2920  [key2].iloc[0]) 
-0001be00: 3c3d 2028 0a20 2020 2020 2020 2020 2020  <= (.           
-0001be10: 2072 6563 656e 745b 6b65 7931 5d2e 696c   recent[key1].il
-0001be20: 6f63 5b30 5d20 2a20 7065 7263 656e 7461  oc[0] * percenta
-0001be30: 6765 0a20 2020 2020 2020 2029 3a0a 2020  ge.        ):.  
-0001be40: 2020 2020 2020 2020 2020 6966 2072 6563            if rec
-0001be50: 656e 745b 6b65 7931 5d2e 696c 6f63 5b30  ent[key1].iloc[0
-0001be60: 5d20 3e3d 2072 6563 656e 745b 6b65 7932  ] >= recent[key2
-0001be70: 5d2e 696c 6f63 5b30 5d3a 0a20 2020 2020  ].iloc[0]:.     
-0001be80: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0001be90: 6e44 6963 745b 224d 412d 5369 676e 616c  nDict["MA-Signal
-0001bea0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-0001beb0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-0001bec0: 5b30 5d20 0a20 2020 2020 2020 2020 2020  [0] .           
-0001bed0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-0001bee0: 5465 7874 2e42 4f4c 440a 2020 2020 2020  Text.BOLD.      
-0001bef0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001bf00: 2863 6f6c 6f72 5465 7874 2e47 5245 454e  (colorText.GREEN
-0001bf10: 2069 6620 6973 3530 444d 4155 7054 7265   if is50DMAUpTre
-0001bf20: 6e64 2065 6c73 6520 2863 6f6c 6f72 5465  nd else (colorTe
-0001bf30: 7874 2e46 4149 4c20 6966 2069 7335 3044  xt.FAIL if is50D
-0001bf40: 4d41 446f 776e 5472 656e 6420 656c 7365  MADownTrend else
-0001bf50: 2063 6f6c 6f72 5465 7874 2e57 4152 4e29   colorText.WARN)
-0001bf60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001bf70: 2020 2020 2020 2b20 6622 7b63 6f6e 6654        + f"{confT
-0001bf80: 6578 747d 2028 7b64 6966 6665 7265 6e63  ext} ({differenc
-0001bf90: 657d 2529 220a 2020 2020 2020 2020 2020  e}%)".          
-0001bfa0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0001bfb0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-0001bfc0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001bfd0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-0001bfe0: 4469 6374 5b22 4d41 2d53 6967 6e61 6c22  Dict["MA-Signal"
-0001bff0: 5d20 3d20 7361 7665 645b 315d 202b 2066  ] = saved[1] + f
-0001c000: 227b 636f 6e66 5465 7874 7d20 287b 6469  "{confText} ({di
-0001c010: 6666 6572 656e 6365 7d25 2922 0a20 2020  fference}%)".   
-0001c020: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001c030: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001c040: 6372 6565 6e44 6963 745b 224d 412d 5369  creenDict["MA-Si
-0001c050: 676e 616c 225d 203d 2028 0a20 2020 2020  gnal"] = (.     
-0001c060: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001c070: 6176 6564 5b30 5d20 0a20 2020 2020 2020  aved[0] .       
-0001c080: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0001c090: 6f6c 6f72 5465 7874 2e42 4f4c 440a 2020  olorText.BOLD.  
-0001c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0b0: 2020 2b20 2863 6f6c 6f72 5465 7874 2e47    + (colorText.G
-0001c0c0: 5245 454e 2069 6620 6973 3530 444d 4155  REEN if is50DMAU
-0001c0d0: 7054 7265 6e64 2065 6c73 6520 2863 6f6c  pTrend else (col
-0001c0e0: 6f72 5465 7874 2e46 4149 4c20 6966 2069  orText.FAIL if i
-0001c0f0: 7335 3044 4d41 446f 776e 5472 656e 6420  s50DMADownTrend 
-0001c100: 656c 7365 2063 6f6c 6f72 5465 7874 2e57  else colorText.W
-0001c110: 4152 4e29 290a 2020 2020 2020 2020 2020  ARN)).          
-0001c120: 2020 2020 2020 2020 2020 2b20 6622 7b63            + f"{c
-0001c130: 6f6e 6654 6578 747d 2028 7b64 6966 6665  onfText} ({diffe
-0001c140: 7265 6e63 657d 2529 220a 2020 2020 2020  rence}%)".      
-0001c150: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001c160: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
-0001c170: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0001c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c190: 7361 7665 4469 6374 5b22 4d41 2d53 6967  saveDict["MA-Sig
-0001c1a0: 6e61 6c22 5d20 3d20 7361 7665 645b 315d  nal"] = saved[1]
-0001c1b0: 202b 2066 227b 636f 6e66 5465 7874 7d20   + f"{confText} 
-0001c1c0: 287b 6469 6666 6572 656e 6365 7d25 2922  ({difference}%)"
-0001c1d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001c1e0: 7572 6e20 636f 6e66 4669 6c74 6572 203d  urn confFilter =
-0001c1f0: 3d20 3320 6f72 205c 0a20 2020 2020 2020  = 3 or \.       
-0001c200: 2020 2020 2020 2020 2028 636f 6e66 4669           (confFi
-0001c210: 6c74 6572 203d 3d20 3120 616e 6420 6e6f  lter == 1 and no
-0001c220: 7420 6973 4465 6164 4372 6f73 734f 7665  t isDeadCrossOve
-0001c230: 7220 616e 6420 2869 7335 3044 4d41 5570  r and (is50DMAUp
-0001c240: 5472 656e 6420 6f72 2028 6973 476f 6c64  Trend or (isGold
-0001c250: 656e 4372 6f73 734f 7665 7220 6f72 2027  enCrossOver or '
-0001c260: 5570 2720 696e 2063 6f6e 6654 6578 7429  Up' in confText)
-0001c270: 2929 206f 7220 5c0a 2020 2020 2020 2020  )) or \.        
-0001c280: 2020 2020 2020 2020 2863 6f6e 6646 696c          (confFil
-0001c290: 7465 7220 3d3d 2032 2061 6e64 206e 6f74  ter == 2 and not
-0001c2a0: 2069 7347 6f6c 6465 6e43 726f 7373 4f76   isGoldenCrossOv
-0001c2b0: 6572 2061 6e64 2028 6973 3530 444d 4144  er and (is50DMAD
-0001c2c0: 6f77 6e54 7265 6e64 206f 7220 6973 4465  ownTrend or isDe
-0001c2d0: 6164 4372 6f73 734f 7665 7220 6f72 2027  adCrossOver or '
-0001c2e0: 446f 776e 2720 696e 2063 6f6e 6654 6578  Down' in confTex
-0001c2f0: 7429 290a 2020 2020 2020 2020 2320 4d61  t)).        # Ma
-0001c300: 7962 6520 7468 6520 6469 6666 6572 656e  ybe the differen
-0001c310: 6365 2069 7320 6e6f 7420 7769 7468 696e  ce is not within
-0001c320: 2074 6865 2072 616e 6765 2c20 6275 7420   the range, but 
-0001c330: 7765 2764 2073 7469 6c6c 206c 696b 6520  we'd still like 
-0001c340: 746f 206b 6565 7020 7468 6520 7374 6f63  to keep the stoc
-0001c350: 6b20 696e 0a20 2020 2020 2020 2023 2074  k in.        # t
-0001c360: 6865 206c 6973 7420 6966 2069 7427 7320  he list if it's 
-0001c370: 6120 676f 6c64 656e 2063 726f 7373 6f76  a golden crossov
-0001c380: 6572 206f 7220 6465 6164 2063 726f 7373  er or dead cross
-0001c390: 6f76 6572 0a20 2020 2020 2020 2069 6620  over.        if 
-0001c3a0: 6973 476f 6c64 656e 4372 6f73 734f 7665  isGoldenCrossOve
-0001c3b0: 7220 6f72 2069 7344 6561 6443 726f 7373  r or isDeadCross
-0001c3c0: 4f76 6572 3a0a 2020 2020 2020 2020 2020  Over:.          
-0001c3d0: 2020 7363 7265 656e 4469 6374 5b22 4d41    screenDict["MA
-0001c3e0: 2d53 6967 6e61 6c22 5d20 3d20 280a 2020  -Signal"] = (.  
-0001c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c400: 2020 7361 7665 645b 305d 200a 2020 2020    saved[0] .    
-0001c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c420: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
-0001c430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c440: 2020 2020 202b 2028 636f 6c6f 7254 6578       + (colorTex
-0001c450: 742e 4752 4545 4e20 6966 2069 7335 3044  t.GREEN if is50D
-0001c460: 4d41 5570 5472 656e 6420 656c 7365 2028  MAUpTrend else (
-0001c470: 636f 6c6f 7254 6578 742e 4641 494c 2069  colorText.FAIL i
-0001c480: 6620 6973 3530 444d 4144 6f77 6e54 7265  f is50DMADownTre
-0001c490: 6e64 2065 6c73 6520 636f 6c6f 7254 6578  nd else colorTex
-0001c4a0: 742e 5741 524e 2929 0a20 2020 2020 2020  t.WARN)).       
-0001c4b0: 2020 2020 2020 2020 2020 2020 202b 2066               + f
-0001c4c0: 227b 636f 6e66 5465 7874 7d20 287b 6469  "{confText} ({di
-0001c4d0: 6666 6572 656e 6365 7d25 2922 0a20 2020  fference}%)".   
-0001c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4f0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-0001c500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c510: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-0001c520: 6176 6544 6963 745b 224d 412d 5369 676e  aveDict["MA-Sign
-0001c530: 616c 225d 203d 2073 6176 6564 5b31 5d20  al"] = saved[1] 
-0001c540: 2b20 6622 7b63 6f6e 6654 6578 747d 2028  + f"{confText} (
-0001c550: 7b64 6966 6665 7265 6e63 657d 2529 220a  {difference}%)".
-0001c560: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001c570: 726e 2063 6f6e 6646 696c 7465 7220 3d3d  rn confFilter ==
-0001c580: 2033 206f 7220 5c0a 2020 2020 2020 2020   3 or \.        
-0001c590: 2020 2020 2020 2020 2863 6f6e 6646 696c          (confFil
-0001c5a0: 7465 7220 3d3d 2031 2061 6e64 2069 7347  ter == 1 and isG
-0001c5b0: 6f6c 6465 6e43 726f 7373 4f76 6572 2920  oldenCrossOver) 
-0001c5c0: 6f72 205c 0a20 2020 2020 2020 2020 2020  or \.           
-0001c5d0: 2020 2020 2028 636f 6e66 4669 6c74 6572       (confFilter
-0001c5e0: 203d 3d20 3220 616e 6420 6973 4465 6164   == 2 and isDead
-0001c5f0: 4372 6f73 734f 7665 7229 0a20 2020 2020  CrossOver).     
-0001c600: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0001c610: 0a20 2020 2023 406d 6561 7375 7265 5f74  .    #@measure_t
-0001c620: 696d 650a 2020 2020 2320 5661 6c69 6461  ime.    # Valida
-0001c630: 7465 2069 6620 7368 6172 6520 7072 6963  te if share pric
-0001c640: 6573 2061 7265 2063 6f6e 736f 6c69 6461  es are consolida
-0001c650: 7469 6e67 0a20 2020 2064 6566 2076 616c  ting.    def val
-0001c660: 6964 6174 6543 6f6e 736f 6c69 6461 7469  idateConsolidati
-0001c670: 6f6e 2873 656c 662c 2064 662c 2073 6372  on(self, df, scr
-0001c680: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
-0001c690: 742c 2070 6572 6365 6e74 6167 653d 3130  t, percentage=10
-0001c6a0: 293a 0a20 2020 2020 2020 2069 6620 6466  ):.        if df
-0001c6b0: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
-0001c6c0: 6466 2920 3d3d 2030 3a0a 2020 2020 2020  df) == 0:.      
-0001c6d0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0001c6e0: 7365 0a20 2020 2020 2020 2064 6174 6120  se.        data 
-0001c6f0: 3d20 6466 2e63 6f70 7928 290a 2020 2020  = df.copy().    
-0001c700: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-0001c710: 6669 6c6c 6e61 2830 290a 2020 2020 2020  fillna(0).      
-0001c720: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
-0001c730: 706c 6163 6528 5b6e 702e 696e 662c 202d  place([np.inf, -
-0001c740: 6e70 2e69 6e66 5d2c 2030 290a 2020 2020  np.inf], 0).    
-0001c750: 2020 2020 6863 203d 2064 6174 612e 6465      hc = data.de
-0001c760: 7363 7269 6265 2829 5b22 436c 6f73 6522  scribe()["Close"
-0001c770: 5d5b 226d 6178 225d 0a20 2020 2020 2020  ]["max"].       
-0001c780: 206c 6320 3d20 6461 7461 2e64 6573 6372   lc = data.descr
-0001c790: 6962 6528 295b 2243 6c6f 7365 225d 5b22  ibe()["Close"]["
-0001c7a0: 6d69 6e22 5d0a 2020 2020 2020 2020 6966  min"].        if
-0001c7b0: 2028 6863 202d 206c 6329 203c 3d20 2868   (hc - lc) <= (h
-0001c7c0: 6320 2a20 7065 7263 656e 7461 6765 202f  c * percentage /
-0001c7d0: 2031 3030 2920 616e 6420 2868 6320 2d20   100) and (hc - 
-0001c7e0: 6c63 2021 3d20 3029 3a0a 2020 2020 2020  lc != 0):.      
-0001c7f0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-0001c800: 5b22 436f 6e73 6f6c 2e22 5d20 3d20 280a  ["Consol."] = (.
-0001c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c820: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
-0001c830: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001c840: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
-0001c850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c860: 202b 2022 5261 6e67 653a 220a 2020 2020   + "Range:".    
-0001c870: 2020 2020 2020 2020 2020 2020 2b20 7374              + st
-0001c880: 7228 726f 756e 6428 2861 6273 2828 6863  r(round((abs((hc
-0001c890: 202d 206c 6329 202f 2068 6329 202a 2031   - lc) / hc) * 1
-0001c8a0: 3030 292c 2031 2929 0a20 2020 2020 2020  00), 1)).       
-0001c8b0: 2020 2020 2020 2020 202b 2022 2522 0a20           + "%". 
-0001c8c0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001c8d0: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0001c8e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001c8f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001c900: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
-0001c910: 745b 2243 6f6e 736f 6c2e 225d 203d 2028  t["Consol."] = (
-0001c920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c930: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
-0001c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c950: 2b20 636f 6c6f 7254 6578 742e 4641 494c  + colorText.FAIL
-0001c960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c970: 202b 2022 5261 6e67 653a 220a 2020 2020   + "Range:".    
-0001c980: 2020 2020 2020 2020 2020 2020 2b20 7374              + st
-0001c990: 7228 726f 756e 6428 2861 6273 2828 6863  r(round((abs((hc
-0001c9a0: 202d 206c 6329 202f 2068 6329 202a 2031   - lc) / hc) * 1
-0001c9b0: 3030 292c 2031 2929 0a20 2020 2020 2020  00), 1)).       
-0001c9c0: 2020 2020 2020 2020 202b 2022 2522 0a20           + "%". 
-0001c9d0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001c9e0: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0001c9f0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001ca00: 2020 2020 2073 6176 6544 6963 745b 2243       saveDict["C
-0001ca10: 6f6e 736f 6c2e 225d 203d 2066 2752 616e  onsol."] = f'Ran
-0001ca20: 6765 3a7b 7374 7228 726f 756e 6428 2861  ge:{str(round((a
-0001ca30: 6273 2828 6863 2d6c 6329 2f68 6329 2a31  bs((hc-lc)/hc)*1
-0001ca40: 3030 292c 3129 292b 2225 227d 270a 2020  00),1))+"%"}'.  
-0001ca50: 2020 2020 2020 7265 7475 726e 2072 6f75        return rou
-0001ca60: 6e64 2828 6162 7328 2868 6320 2d20 6c63  nd((abs((hc - lc
-0001ca70: 2920 2f20 6863 2920 2a20 3130 3029 2c20  ) / hc) * 100), 
-0001ca80: 3129 0a0a 2020 2020 2320 7661 6c69 6461  1)..    # valida
-0001ca90: 7465 2069 6620 7468 6520 7374 6f63 6b20  te if the stock 
-0001caa0: 6861 7320 6265 656e 2068 6176 696e 6720  has been having 
-0001cab0: 6869 6768 6572 2068 6967 6873 2c20 6869  higher highs, hi
-0001cac0: 6768 6572 206c 6f77 730a 2020 2020 2320  gher lows.    # 
-0001cad0: 616e 6420 6869 6768 6572 2063 6c6f 7365  and higher close
-0001cae0: 2077 6974 6820 6c61 7465 7374 2063 6c6f   with latest clo
-0001caf0: 7365 203e 2073 7570 6572 7472 656e 6420  se > supertrend 
-0001cb00: 616e 6420 382d 454d 412e 0a20 2020 2064  and 8-EMA..    d
-0001cb10: 6566 2076 616c 6964 6174 6548 6967 6865  ef validateHighe
-0001cb20: 7248 6967 6873 4869 6768 6572 4c6f 7773  rHighsHigherLows
-0001cb30: 4869 6768 6572 436c 6f73 6528 7365 6c66  HigherClose(self
-0001cb40: 2c20 6466 293a 0a20 2020 2020 2020 2069  , df):.        i
-0001cb50: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
-0001cb60: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
-0001cb70: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001cb80: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-0001cb90: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
-0001cba0: 2020 2020 2020 2020 6461 7930 203d 2064          day0 = d
-0001cbb0: 6174 610a 2020 2020 2020 2020 6461 7931  ata.        day1
-0001cbc0: 203d 2064 6174 615b 313a 5d0a 2020 2020   = data[1:].    
-0001cbd0: 2020 2020 6461 7932 203d 2064 6174 615b      day2 = data[
-0001cbe0: 323a 5d0a 2020 2020 2020 2020 6461 7933  2:].        day3
-0001cbf0: 203d 2064 6174 615b 333a 5d0a 2020 2020   = data[3:].    
-0001cc00: 2020 2020 6966 206c 656e 2864 6179 3129      if len(day1)
-0001cc10: 203c 2031 206f 7220 6c65 6e28 6461 7932   < 1 or len(day2
-0001cc20: 2920 3c20 3120 6f72 206c 656e 2864 6179  ) < 1 or len(day
-0001cc30: 3329 203c 2031 3a0a 2020 2020 2020 2020  3) < 1:.        
-0001cc40: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001cc50: 0a20 2020 2020 2020 2068 6967 6865 7248  .        higherH
-0001cc60: 6967 6873 203d 2028 0a20 2020 2020 2020  ighs = (.       
-0001cc70: 2020 2020 2028 6461 7930 5b22 4869 6768       (day0["High
-0001cc80: 225d 2e69 6c6f 635b 305d 203e 2064 6179  "].iloc[0] > day
-0001cc90: 315b 2248 6967 6822 5d2e 696c 6f63 5b30  1["High"].iloc[0
-0001cca0: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
-0001ccb0: 6e64 2028 6461 7931 5b22 4869 6768 225d  nd (day1["High"]
-0001ccc0: 2e69 6c6f 635b 305d 203e 2064 6179 325b  .iloc[0] > day2[
-0001ccd0: 2248 6967 6822 5d2e 696c 6f63 5b30 5d29  "High"].iloc[0])
-0001cce0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-0001ccf0: 2028 6461 7932 5b22 4869 6768 225d 2e69   (day2["High"].i
-0001cd00: 6c6f 635b 305d 203e 2064 6179 335b 2248  loc[0] > day3["H
-0001cd10: 6967 6822 5d2e 696c 6f63 5b30 5d29 0a20  igh"].iloc[0]). 
-0001cd20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001cd30: 2068 6967 6865 724c 6f77 7320 3d20 280a   higherLows = (.
-0001cd40: 2020 2020 2020 2020 2020 2020 2864 6179              (day
-0001cd50: 305b 224c 6f77 225d 2e69 6c6f 635b 305d  0["Low"].iloc[0]
-0001cd60: 203e 2064 6179 315b 224c 6f77 225d 2e69   > day1["Low"].i
-0001cd70: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
-0001cd80: 2020 2020 616e 6420 2864 6179 315b 224c      and (day1["L
-0001cd90: 6f77 225d 2e69 6c6f 635b 305d 203e 2064  ow"].iloc[0] > d
-0001cda0: 6179 325b 224c 6f77 225d 2e69 6c6f 635b  ay2["Low"].iloc[
-0001cdb0: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
-0001cdc0: 616e 6420 2864 6179 325b 224c 6f77 225d  and (day2["Low"]
-0001cdd0: 2e69 6c6f 635b 305d 203e 2064 6179 335b  .iloc[0] > day3[
-0001cde0: 224c 6f77 225d 2e69 6c6f 635b 305d 290a  "Low"].iloc[0]).
-0001cdf0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001ce00: 2020 6869 6768 6572 436c 6f73 6520 3d20    higherClose = 
-0001ce10: 280a 2020 2020 2020 2020 2020 2020 2864  (.            (d
-0001ce20: 6179 305b 2243 6c6f 7365 225d 2e69 6c6f  ay0["Close"].ilo
-0001ce30: 635b 305d 203e 2064 6179 315b 2243 6c6f  c[0] > day1["Clo
-0001ce40: 7365 225d 2e69 6c6f 635b 305d 290a 2020  se"].iloc[0]).  
-0001ce50: 2020 2020 2020 2020 2020 616e 6420 2864            and (d
-0001ce60: 6179 315b 2243 6c6f 7365 225d 2e69 6c6f  ay1["Close"].ilo
-0001ce70: 635b 305d 203e 2064 6179 325b 2243 6c6f  c[0] > day2["Clo
-0001ce80: 7365 225d 2e69 6c6f 635b 305d 290a 2020  se"].iloc[0]).  
-0001ce90: 2020 2020 2020 2020 2020 616e 6420 2864            and (d
-0001cea0: 6179 325b 2243 6c6f 7365 225d 2e69 6c6f  ay2["Close"].ilo
-0001ceb0: 635b 305d 203e 2064 6179 335b 2243 6c6f  c[0] > day3["Clo
-0001cec0: 7365 225d 2e69 6c6f 635b 305d 290a 2020  se"].iloc[0]).  
-0001ced0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001cee0: 2320 6869 6768 6572 5253 4920 3d20 2864  # higherRSI = (d
-0001cef0: 6179 305b 2252 5349 225d 2e69 6c6f 635b  ay0["RSI"].iloc[
-0001cf00: 305d 203e 2064 6179 315b 2252 5349 225d  0] > day1["RSI"]
-0001cf10: 2e69 6c6f 635b 305d 2920 616e 6420 5c0a  .iloc[0]) and \.
-0001cf20: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-0001cf30: 2020 2020 2020 2020 2020 2864 6179 315b            (day1[
-0001cf40: 2252 5349 225d 2e69 6c6f 635b 305d 203e  "RSI"].iloc[0] >
-0001cf50: 2064 6179 325b 2252 5349 225d 2e69 6c6f   day2["RSI"].ilo
-0001cf60: 635b 305d 2920 616e 6420 5c0a 2020 2020  c[0]) and \.    
-0001cf70: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0001cf80: 2020 2020 2020 2864 6179 325b 2252 5349        (day2["RSI
-0001cf90: 225d 2e69 6c6f 635b 305d 203e 2064 6179  "].iloc[0] > day
-0001cfa0: 335b 2252 5349 225d 2e69 6c6f 635b 305d  3["RSI"].iloc[0]
-0001cfb0: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
-0001cfc0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001cfd0: 2020 6461 7933 5b22 5253 4922 5d2e 696c    day3["RSI"].il
-0001cfe0: 6f63 5b30 5d20 3e3d 2035 3020 616e 6420  oc[0] >= 50 and 
-0001cff0: 6461 7930 5b22 5253 4922 5d2e 696c 6f63  day0["RSI"].iloc
-0001d000: 5b30 5d20 3e3d 2036 350a 2020 2020 2020  [0] >= 65.      
-0001d010: 2020 7265 7665 7273 6564 4461 7461 203d    reversedData =
-0001d020: 2064 6174 615b 3a3a 2d31 5d2e 636f 7079   data[::-1].copy
-0001d030: 2829 0a20 2020 2020 2020 2072 6576 6572  ().        rever
-0001d040: 7365 6444 6174 615b 2253 5550 4552 5422  sedData["SUPERT"
-0001d050: 5d20 3d20 706b 7461 6c69 622e 7375 7065  ] = pktalib.supe
-0001d060: 7274 7265 6e64 2872 6576 6572 7365 6444  rtrend(reversedD
-0001d070: 6174 612c 2037 2c20 3329 5b22 5355 5045  ata, 7, 3)["SUPE
-0001d080: 5254 5f37 5f33 2e30 225d 0a20 2020 2020  RT_7_3.0"].     
-0001d090: 2020 2072 6576 6572 7365 6444 6174 615b     reversedData[
-0001d0a0: 2245 4d41 3822 5d20 3d20 706b 7461 6c69  "EMA8"] = pktali
-0001d0b0: 622e 454d 4128 7265 7665 7273 6564 4461  b.EMA(reversedDa
-0001d0c0: 7461 5b22 436c 6f73 6522 5d2c 2074 696d  ta["Close"], tim
-0001d0d0: 6570 6572 696f 643d 3929 0a20 2020 2020  eperiod=9).     
-0001d0e0: 2020 2068 6967 6865 7243 6c6f 7365 203d     higherClose =
-0001d0f0: 2028 0a20 2020 2020 2020 2020 2020 2068   (.            h
-0001d100: 6967 6865 7243 6c6f 7365 0a20 2020 2020  igherClose.     
-0001d110: 2020 2020 2020 2061 6e64 2064 6179 305b         and day0[
-0001d120: 2243 6c6f 7365 225d 2e69 6c6f 635b 305d  "Close"].iloc[0]
-0001d130: 203e 2072 6576 6572 7365 6444 6174 612e   > reversedData.
-0001d140: 7461 696c 2831 295b 2253 5550 4552 5422  tail(1)["SUPERT"
-0001d150: 5d2e 696c 6f63 5b30 5d0a 2020 2020 2020  ].iloc[0].      
-0001d160: 2020 2020 2020 616e 6420 6461 7930 5b22        and day0["
-0001d170: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
-0001d180: 3e20 7265 7665 7273 6564 4461 7461 2e74  > reversedData.t
-0001d190: 6169 6c28 3129 5b22 454d 4138 225d 2e69  ail(1)["EMA8"].i
-0001d1a0: 6c6f 635b 305d 0a20 2020 2020 2020 2029  loc[0].        )
-0001d1b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001d1c0: 6869 6768 6572 4869 6768 7320 616e 6420  higherHighs and 
-0001d1d0: 6869 6768 6572 4c6f 7773 2061 6e64 2068  higherLows and h
-0001d1e0: 6967 6865 7243 6c6f 7365 0a0a 2020 2020  igherClose..    
-0001d1f0: 2340 6d65 6173 7572 655f 7469 6d65 0a20  #@measure_time. 
-0001d200: 2020 2023 2056 616c 6964 6174 6520 2749     # Validate 'I
-0001d210: 6e73 6964 6520 4261 7227 2073 7472 7563  nside Bar' struc
-0001d220: 7475 7265 2066 6f72 2072 6563 656e 7420  ture for recent 
-0001d230: 6461 7973 0a20 2020 2064 6566 2076 616c  days.    def val
-0001d240: 6964 6174 6549 6e73 6964 6542 6172 280a  idateInsideBar(.
-0001d250: 2020 2020 2020 2020 7365 6c66 2c20 6466          self, df
-0001d260: 2c20 7363 7265 656e 4469 6374 2c20 7361  , screenDict, sa
-0001d270: 7665 4469 6374 2c20 6368 6172 7450 6174  veDict, chartPat
-0001d280: 7465 726e 3d31 2c20 6461 7973 546f 4c6f  tern=1, daysToLo
-0001d290: 6f6b 6261 636b 3d35 0a20 2020 2029 3a0a  okback=5.    ):.
-0001d2a0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-0001d2b0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-0001d2c0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0001d2d0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0001d2e0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0001d2f0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-0001d300: 206f 7267 4461 7461 203d 2064 6174 610a   orgData = data.
-0001d310: 2020 2020 2020 2020 7361 7665 6420 3d20          saved = 
-0001d320: 7365 6c66 2e66 696e 6443 7572 7265 6e74  self.findCurrent
-0001d330: 5361 7665 6456 616c 7565 2873 6372 6565  SavedValue(scree
-0001d340: 6e44 6963 742c 2073 6176 6544 6963 742c  nDict, saveDict,
-0001d350: 2022 5061 7474 6572 6e22 290a 2020 2020   "Pattern").    
-0001d360: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0001d370: 6765 2869 6e74 2864 6179 7354 6f4c 6f6f  ge(int(daysToLoo
-0001d380: 6b62 6163 6b29 2c20 696e 7428 726f 756e  kback), int(roun
-0001d390: 6428 6461 7973 546f 4c6f 6f6b 6261 636b  d(daysToLookback
-0001d3a0: 202a 2030 2e35 2929 202d 2031 2c20 2d31   * 0.5)) - 1, -1
-0001d3b0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0001d3c0: 6620 6920 3d3d 2032 3a0a 2020 2020 2020  f i == 2:.      
-0001d3d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001d3e0: 2030 2020 2320 4578 6974 2069 6620 6f6e   0  # Exit if on
-0001d3f0: 6c79 206c 6173 7420 3220 6361 6e64 6c65  ly last 2 candle
-0001d400: 7320 6172 6520 6c65 6674 0a20 2020 2020  s are left.     
-0001d410: 2020 2020 2020 2069 6620 6368 6172 7450         if chartP
-0001d420: 6174 7465 726e 203d 3d20 313a 0a20 2020  attern == 1:.   
-0001d430: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001d440: 2255 7022 2069 6e20 7361 7665 4469 6374  "Up" in saveDict
-0001d450: 5b22 5472 656e 6422 5d20 616e 6420 280a  ["Trend"] and (.
-0001d460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d470: 2020 2020 2242 756c 6c22 2069 6e20 7361      "Bull" in sa
-0001d480: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
-0001d490: 6c22 5d0a 2020 2020 2020 2020 2020 2020  l"].            
-0001d4a0: 2020 2020 2020 2020 6f72 2022 5375 7070          or "Supp
-0001d4b0: 6f72 7422 2069 6e20 7361 7665 4469 6374  ort" in saveDict
-0001d4c0: 5b22 4d41 2d53 6967 6e61 6c22 5d0a 2020  ["MA-Signal"].  
-0001d4d0: 2020 2020 2020 2020 2020 2020 2020 293a                ):
-0001d4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d4f0: 2020 2020 2064 6174 6120 3d20 6f72 6744       data = orgD
-0001d500: 6174 612e 6865 6164 2869 290a 2020 2020  ata.head(i).    
-0001d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d520: 7265 6643 616e 646c 6520 3d20 6461 7461  refCandle = data
-0001d530: 2e74 6169 6c28 3129 0a20 2020 2020 2020  .tail(1).       
-0001d540: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001d550: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001d560: 2020 2020 2020 2020 2020 286c 656e 2864            (len(d
-0001d570: 6174 612e 4869 6768 5b64 6174 612e 4869  ata.High[data.Hi
-0001d580: 6768 203e 2072 6566 4361 6e64 6c65 2e48  gh > refCandle.H
-0001d590: 6967 682e 6974 656d 2829 5d29 203d 3d20  igh.item()]) == 
-0001d5a0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-0001d5b0: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-0001d5c0: 6c65 6e28 6461 7461 2e4c 6f77 5b64 6174  len(data.Low[dat
-0001d5d0: 612e 4c6f 7720 3c20 7265 6643 616e 646c  a.Low < refCandl
-0001d5e0: 652e 4c6f 772e 6974 656d 2829 5d29 203d  e.Low.item()]) =
-0001d5f0: 3d20 3029 0a20 2020 2020 2020 2020 2020  = 0).           
-0001d600: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-0001d610: 2028 6c65 6e28 6461 7461 2e4f 7065 6e5b   (len(data.Open[
-0001d620: 6461 7461 2e4f 7065 6e20 3e20 7265 6643  data.Open > refC
-0001d630: 616e 646c 652e 4869 6768 2e69 7465 6d28  andle.High.item(
-0001d640: 295d 2920 3d3d 2030 290a 2020 2020 2020  )]) == 0).      
-0001d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d660: 2020 616e 6420 286c 656e 2864 6174 612e    and (len(data.
-0001d670: 436c 6f73 655b 6461 7461 2e43 6c6f 7365  Close[data.Close
-0001d680: 203c 2072 6566 4361 6e64 6c65 2e4c 6f77   < refCandle.Low
-0001d690: 2e69 7465 6d28 295d 2920 3d3d 2030 290a  .item()]) == 0).
+0001a240: 756d 6e73 292c 2022 4c4d 4122 2c20 6c6d  umns), "LMA", lm
+0001a250: 6129 0a20 2020 2020 2020 2020 2020 2020  a).             
+0001a260: 2020 2064 6174 612e 696e 7365 7274 286c     data.insert(l
+0001a270: 656e 2864 6174 612e 636f 6c75 6d6e 7329  en(data.columns)
+0001a280: 2c20 2253 534d 4122 2c20 7373 6d61 290a  , "SSMA", ssma).
+0001a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a2a0: 6461 7461 2e69 6e73 6572 7428 6c65 6e28  data.insert(len(
+0001a2b0: 6461 7461 2e63 6f6c 756d 6e73 292c 2022  data.columns), "
+0001a2c0: 5353 4d41 3230 222c 2073 736d 6132 3029  SSMA20", ssma20)
+0001a2d0: 0a20 2020 2020 2020 2020 2020 2076 6f6c  .            vol
+0001a2e0: 203d 2070 6b74 616c 6962 2e53 4d41 2864   = pktalib.SMA(d
+0001a2f0: 6174 615b 2256 6f6c 756d 6522 5d2c 2074  ata["Volume"], t
+0001a300: 696d 6570 6572 696f 643d 3230 290a 2020  imeperiod=20).  
+0001a310: 2020 2020 2020 2020 2020 7273 6920 3d20            rsi = 
+0001a320: 706b 7461 6c69 622e 5253 4928 6461 7461  pktalib.RSI(data
+0001a330: 5b22 436c 6f73 6522 5d2c 2074 696d 6570  ["Close"], timep
+0001a340: 6572 696f 643d 3134 290a 2020 2020 2020  eriod=14).      
+0001a350: 2020 2020 2020 6461 7461 2e69 6e73 6572        data.inser
+0001a360: 7428 6c65 6e28 6461 7461 2e63 6f6c 756d  t(len(data.colum
+0001a370: 6e73 292c 2022 566f 6c4d 4122 2c20 766f  ns), "VolMA", vo
+0001a380: 6c29 0a20 2020 2020 2020 2020 2020 2064  l).            d
+0001a390: 6174 612e 696e 7365 7274 286c 656e 2864  ata.insert(len(d
+0001a3a0: 6174 612e 636f 6c75 6d6e 7329 2c20 2252  ata.columns), "R
+0001a3b0: 5349 222c 2072 7369 290a 2020 2020 2020  SI", rsi).      
+0001a3c0: 2020 2020 2020 6363 6920 3d20 706b 7461        cci = pkta
+0001a3d0: 6c69 622e 4343 4928 6461 7461 5b22 4869  lib.CCI(data["Hi
+0001a3e0: 6768 225d 2c20 6461 7461 5b22 4c6f 7722  gh"], data["Low"
+0001a3f0: 5d2c 2064 6174 615b 2243 6c6f 7365 225d  ], data["Close"]
+0001a400: 2c20 7469 6d65 7065 7269 6f64 3d31 3429  , timeperiod=14)
+0001a410: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+0001a420: 612e 696e 7365 7274 286c 656e 2864 6174  a.insert(len(dat
+0001a430: 612e 636f 6c75 6d6e 7329 2c20 2243 4349  a.columns), "CCI
+0001a440: 222c 2063 6369 290a 2020 2020 2020 2020  ", cci).        
+0001a450: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001a460: 2020 2020 2020 2020 2066 6173 746b 2c20           fastk, 
+0001a470: 6661 7374 6420 3d20 706b 7461 6c69 622e  fastd = pktalib.
+0001a480: 5354 4f43 4852 5349 280a 2020 2020 2020  STOCHRSI(.      
+0001a490: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0001a4a0: 7461 5b22 436c 6f73 6522 5d2c 2074 696d  ta["Close"], tim
+0001a4b0: 6570 6572 696f 643d 3134 2c20 6661 7374  eperiod=14, fast
+0001a4c0: 6b5f 7065 7269 6f64 3d35 2c20 6661 7374  k_period=5, fast
+0001a4d0: 645f 7065 7269 6f64 3d33 2c20 6661 7374  d_period=3, fast
+0001a4e0: 645f 6d61 7479 7065 3d30 0a20 2020 2020  d_matype=0.     
+0001a4f0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001a500: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0001a510: 612e 696e 7365 7274 286c 656e 2864 6174  a.insert(len(dat
+0001a520: 612e 636f 6c75 6d6e 7329 2c20 2246 4153  a.columns), "FAS
+0001a530: 544b 222c 2066 6173 746b 290a 2020 2020  TK", fastk).    
+0001a540: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0001a550: 2e69 6e73 6572 7428 6c65 6e28 6461 7461  .insert(len(data
+0001a560: 2e63 6f6c 756d 6e73 292c 2022 4641 5354  .columns), "FAST
+0001a570: 4422 2c20 6661 7374 6429 0a20 2020 2020  D", fastd).     
+0001a580: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+0001a590: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
+0001a5a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001a5b0: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
+0001a5c0: 722e 6465 6275 6728 652c 2065 7863 5f69  r.debug(e, exc_i
+0001a5d0: 6e66 6f3d 5472 7565 290a 2020 2020 2020  nfo=True).      
+0001a5e0: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+0001a5f0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+0001a600: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
+0001a610: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001a620: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
+0001a630: 722e 6465 6275 6728 652c 2065 7863 5f69  r.debug(e, exc_i
+0001a640: 6e66 6f3d 5472 7565 290a 2020 2020 2020  nfo=True).      
+0001a650: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+0001a660: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0001a670: 7461 5b3a 3a2d 315d 2020 2320 5265 7665  ta[::-1]  # Reve
+0001a680: 7273 6520 7468 6520 6461 7461 6672 616d  rse the datafram
+0001a690: 650a 2020 2020 2020 2020 2320 6461 7461  e.        # data
+0001a6a0: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
+0001a6b0: 290a 2020 2020 2020 2020 2320 6461 7461  ).        # data
+0001a6c0: 203d 2064 6174 612e 7265 706c 6163 6528   = data.replace(
+0001a6d0: 5b6e 702e 696e 662c 202d 6e70 2e69 6e66  [np.inf, -np.inf
+0001a6e0: 5d2c 2030 290a 2020 2020 2020 2020 6675  ], 0).        fu
+0001a6f0: 6c6c 4461 7461 203d 2064 6174 610a 2020  llData = data.  
+0001a700: 2020 2020 2020 7472 696d 6d65 6444 6174        trimmedDat
+0001a710: 6120 3d20 6461 7461 2e68 6561 6428 6461  a = data.head(da
+0001a720: 7973 546f 4c6f 6f6b 6261 636b 290a 2020  ysToLookback).  
+0001a730: 2020 2020 2020 7265 7475 726e 2028 6675        return (fu
+0001a740: 6c6c 4461 7461 2c20 7472 696d 6d65 6444  llData, trimmedD
+0001a750: 6174 6129 0a0a 2020 2020 2320 5661 6c69  ata)..    # Vali
+0001a760: 6461 7465 2069 6620 7468 6520 7374 6f63  date if the stoc
+0001a770: 6b20 6973 2062 756c 6c69 7368 2069 6e20  k is bullish in 
+0001a780: 7468 6520 7368 6f72 7420 7465 726d 0a20  the short term. 
+0001a790: 2020 2064 6566 2076 616c 6964 6174 6531     def validate1
+0001a7a0: 354d 696e 7574 6550 7269 6365 566f 6c75  5MinutePriceVolu
+0001a7b0: 6d65 4272 6561 6b6f 7574 2873 656c 662c  meBreakout(self,
+0001a7c0: 2064 6629 3a0a 2020 2020 2020 2020 6966   df):.        if
+0001a7d0: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
+0001a7e0: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
+0001a7f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001a800: 4661 6c73 650a 2020 2020 2020 2020 2320  False.        # 
+0001a810: 6874 7470 733a 2f2f 6368 6172 7469 6e6b  https://chartink
+0001a820: 2e63 6f6d 2f73 6372 6565 6e65 722f 3135  .com/screener/15
+0001a830: 2d6d 696e 2d70 7269 6365 2d76 6f6c 756d  -min-price-volum
+0001a840: 652d 6272 6561 6b6f 7574 0a20 2020 2020  e-breakout.     
+0001a850: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
+0001a860: 7928 290a 2020 2020 2020 2020 6461 7461  y().        data
+0001a870: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
+0001a880: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+0001a890: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
+0001a8a0: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
+0001a8b0: 2030 290a 2020 2020 2020 2020 6461 7461   0).        data
+0001a8c0: 203d 2064 6174 615b 3a3a 2d31 5d20 2023   = data[::-1]  #
+0001a8d0: 2052 6576 6572 7365 2074 6865 2064 6174   Reverse the dat
+0001a8e0: 6166 7261 6d65 2073 6f20 7468 6174 2069  aframe so that i
+0001a8f0: 7473 2074 6865 206f 6c64 6573 7420 6461  ts the oldest da
+0001a900: 7465 2066 6972 7374 0a20 2020 2020 2020  te first.       
+0001a910: 2064 6174 615b 2253 4d41 3230 225d 203d   data["SMA20"] =
+0001a920: 2070 6b74 616c 6962 2e53 4d41 2864 6174   pktalib.SMA(dat
+0001a930: 615b 2243 6c6f 7365 225d 2c20 3230 290a  a["Close"], 20).
+0001a940: 2020 2020 2020 2020 6461 7461 5b22 534d          data["SM
+0001a950: 4132 3056 225d 203d 2070 6b74 616c 6962  A20V"] = pktalib
+0001a960: 2e53 4d41 2864 6174 615b 2256 6f6c 756d  .SMA(data["Volum
+0001a970: 6522 5d2c 2032 3029 0a20 2020 2020 2020  e"], 20).       
+0001a980: 2064 6174 6120 3d20 6461 7461 5b0a 2020   data = data[.  
+0001a990: 2020 2020 2020 2020 2020 3a3a 2d31 0a20            ::-1. 
+0001a9a0: 2020 2020 2020 205d 2020 2320 5265 7665         ]  # Reve
+0001a9b0: 7273 6520 7468 6520 6461 7461 6672 616d  rse the datafram
+0001a9c0: 6520 736f 2074 6861 7420 6974 2773 2074  e so that it's t
+0001a9d0: 6865 206d 6f73 7420 7265 6365 6e74 2064  he most recent d
+0001a9e0: 6174 6520 6669 7273 740a 2020 2020 2020  ate first.      
+0001a9f0: 2020 7265 6365 6e74 203d 2064 6174 612e    recent = data.
+0001aa00: 6865 6164 2833 290a 2020 2020 2020 2020  head(3).        
+0001aa10: 6966 206c 656e 2872 6563 656e 7429 203c  if len(recent) <
+0001aa20: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
+0001aa30: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
+0001aa40: 2020 2020 2063 6f6e 6431 203d 2072 6563       cond1 = rec
+0001aa50: 656e 745b 2243 6c6f 7365 225d 2e69 6c6f  ent["Close"].ilo
+0001aa60: 635b 305d 203e 2072 6563 656e 745b 2243  c[0] > recent["C
+0001aa70: 6c6f 7365 225d 2e69 6c6f 635b 315d 0a20  lose"].iloc[1]. 
+0001aa80: 2020 2020 2020 2063 6f6e 6432 203d 2063         cond2 = c
+0001aa90: 6f6e 6431 2061 6e64 2028 7265 6365 6e74  ond1 and (recent
+0001aaa0: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+0001aab0: 5d20 3e20 7265 6365 6e74 5b22 534d 4132  ] > recent["SMA2
+0001aac0: 3022 5d2e 696c 6f63 5b30 5d29 0a20 2020  0"].iloc[0]).   
+0001aad0: 2020 2020 2063 6f6e 6433 203d 2063 6f6e       cond3 = con
+0001aae0: 6432 2061 6e64 2028 7265 6365 6e74 5b22  d2 and (recent["
+0001aaf0: 436c 6f73 6522 5d2e 696c 6f63 5b31 5d20  Close"].iloc[1] 
+0001ab00: 3e20 7265 6365 6e74 5b22 4869 6768 225d  > recent["High"]
+0001ab10: 2e69 6c6f 635b 325d 290a 2020 2020 2020  .iloc[2]).      
+0001ab20: 2020 636f 6e64 3420 3d20 636f 6e64 3320    cond4 = cond3 
+0001ab30: 616e 6420 2872 6563 656e 745b 2256 6f6c  and (recent["Vol
+0001ab40: 756d 6522 5d2e 696c 6f63 5b30 5d20 3e20  ume"].iloc[0] > 
+0001ab50: 7265 6365 6e74 5b22 534d 4132 3056 225d  recent["SMA20V"]
+0001ab60: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
+0001ab70: 2020 636f 6e64 3520 3d20 636f 6e64 3420    cond5 = cond4 
+0001ab80: 616e 6420 2872 6563 656e 745b 2256 6f6c  and (recent["Vol
+0001ab90: 756d 6522 5d2e 696c 6f63 5b31 5d20 3e20  ume"].iloc[1] > 
+0001aba0: 7265 6365 6e74 5b22 534d 4132 3056 225d  recent["SMA20V"]
+0001abb0: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
+0001abc0: 2020 7265 7475 726e 2063 6f6e 6435 0a0a    return cond5..
+0001abd0: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
+0001abe0: 4275 6c6c 6973 6846 6f72 546f 6d6f 7272  BullishForTomorr
+0001abf0: 6f77 2873 656c 662c 2064 6629 3a0a 2020  ow(self, df):.  
+0001ac00: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
+0001ac10: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
+0001ac20: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0001ac30: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0001ac40: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
+0001ac50: 636f 7079 2829 0a20 2020 2020 2020 2023  copy().        #
+0001ac60: 2068 7474 7073 3a2f 2f63 6861 7274 696e   https://chartin
+0001ac70: 6b2e 636f 6d2f 7363 7265 656e 6572 2f62  k.com/screener/b
+0001ac80: 756c 6c69 7368 2d66 6f72 2d74 6f6d 6f72  ullish-for-tomor
+0001ac90: 726f 770a 2020 2020 2020 2020 6461 7461  row.        data
+0001aca0: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
+0001acb0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+0001acc0: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
+0001acd0: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
+0001ace0: 2030 290a 2020 2020 2020 2020 6461 7461   0).        data
+0001acf0: 203d 2064 6174 615b 3a3a 2d31 5d20 2023   = data[::-1]  #
+0001ad00: 2052 6576 6572 7365 2074 6865 2064 6174   Reverse the dat
+0001ad10: 6166 7261 6d65 2073 6f20 7468 6174 2069  aframe so that i
+0001ad20: 7473 2074 6865 206f 6c64 6573 7420 6461  ts the oldest da
+0001ad30: 7465 2066 6972 7374 0a20 2020 2020 2020  te first.       
+0001ad40: 206d 6163 644c 696e 6520 3d20 706b 7461   macdLine = pkta
+0001ad50: 6c69 622e 4d41 4344 2864 6174 615b 2243  lib.MACD(data["C
+0001ad60: 6c6f 7365 225d 2c20 3132 2c20 3236 2c20  lose"], 12, 26, 
+0001ad70: 3929 5b30 5d2e 7461 696c 2833 290a 2020  9)[0].tail(3).  
+0001ad80: 2020 2020 2020 6d61 6364 5369 676e 616c        macdSignal
+0001ad90: 203d 2070 6b74 616c 6962 2e4d 4143 4428   = pktalib.MACD(
+0001ada0: 6461 7461 5b22 436c 6f73 6522 5d2c 2031  data["Close"], 1
+0001adb0: 322c 2032 362c 2039 295b 315d 2e74 6169  2, 26, 9)[1].tai
+0001adc0: 6c28 3329 0a20 2020 2020 2020 206d 6163  l(3).        mac
+0001add0: 6448 6973 7420 3d20 706b 7461 6c69 622e  dHist = pktalib.
+0001ade0: 4d41 4344 2864 6174 615b 2243 6c6f 7365  MACD(data["Close
+0001adf0: 225d 2c20 3132 2c20 3236 2c20 3929 5b32  "], 12, 26, 9)[2
+0001ae00: 5d2e 7461 696c 2833 290a 0a20 2020 2020  ].tail(3)..     
+0001ae10: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
+0001ae20: 2020 2020 2020 2020 286d 6163 6448 6973          (macdHis
+0001ae30: 742e 696c 6f63 5b3a 315d 2e69 6c6f 635b  t.iloc[:1].iloc[
+0001ae40: 305d 203c 206d 6163 6448 6973 742e 696c  0] < macdHist.il
+0001ae50: 6f63 5b3a 325d 2e69 6c6f 635b 315d 290a  oc[:2].iloc[1]).
+0001ae60: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0001ae70: 286d 6163 6448 6973 742e 696c 6f63 5b3a  (macdHist.iloc[:
+0001ae80: 335d 2e69 6c6f 635b 325d 203e 206d 6163  3].iloc[2] > mac
+0001ae90: 6448 6973 742e 696c 6f63 5b3a 325d 2e69  dHist.iloc[:2].i
+0001aea0: 6c6f 635b 315d 290a 2020 2020 2020 2020  loc[1]).        
+0001aeb0: 2020 2020 616e 6420 280a 2020 2020 2020      and (.      
+0001aec0: 2020 2020 2020 2020 2020 286d 6163 644c            (macdL
+0001aed0: 696e 652e 696c 6f63 5b3a 335d 2e69 6c6f  ine.iloc[:3].ilo
+0001aee0: 635b 325d 202d 206d 6163 6453 6967 6e61  c[2] - macdSigna
+0001aef0: 6c2e 696c 6f63 5b3a 335d 2e69 6c6f 635b  l.iloc[:3].iloc[
+0001af00: 325d 290a 2020 2020 2020 2020 2020 2020  2]).            
+0001af10: 2020 2020 2d20 286d 6163 644c 696e 652e      - (macdLine.
+0001af20: 696c 6f63 5b3a 325d 2e69 6c6f 635b 315d  iloc[:2].iloc[1]
+0001af30: 202d 206d 6163 6453 6967 6e61 6c2e 696c   - macdSignal.il
+0001af40: 6f63 5b3a 325d 2e69 6c6f 635b 315d 290a  oc[:2].iloc[1]).
+0001af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af60: 3e3d 2030 2e34 0a20 2020 2020 2020 2020  >= 0.4.         
+0001af70: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001af80: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
+0001af90: 2020 2020 2020 2028 6d61 6364 4c69 6e65         (macdLine
+0001afa0: 2e69 6c6f 635b 3a32 5d2e 696c 6f63 5b31  .iloc[:2].iloc[1
+0001afb0: 5d20 2d20 6d61 6364 5369 676e 616c 2e69  ] - macdSignal.i
+0001afc0: 6c6f 635b 3a32 5d2e 696c 6f63 5b31 5d29  loc[:2].iloc[1])
+0001afd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001afe0: 202d 2028 6d61 6364 4c69 6e65 2e69 6c6f   - (macdLine.ilo
+0001aff0: 635b 3a31 5d2e 696c 6f63 5b30 5d20 2d20  c[:1].iloc[0] - 
+0001b000: 6d61 6364 5369 676e 616c 2e69 6c6f 635b  macdSignal.iloc[
+0001b010: 3a31 5d2e 696c 6f63 5b30 5d29 0a20 2020  :1].iloc[0]).   
+0001b020: 2020 2020 2020 2020 2020 2020 203c 3d20               <= 
+0001b030: 302e 320a 2020 2020 2020 2020 2020 2020  0.2.            
+0001b040: 290a 2020 2020 2020 2020 2020 2020 616e  ).            an
+0001b050: 6420 286d 6163 644c 696e 652e 696c 6f63  d (macdLine.iloc
+0001b060: 5b3a 335d 2e69 6c6f 635b 325d 203e 206d  [:3].iloc[2] > m
+0001b070: 6163 6453 6967 6e61 6c2e 696c 6f63 5b3a  acdSignal.iloc[:
+0001b080: 335d 2e69 6c6f 635b 325d 290a 2020 2020  3].iloc[2]).    
+0001b090: 2020 2020 2020 2020 616e 6420 280a 2020          and (.  
+0001b0a0: 2020 2020 2020 2020 2020 2020 2020 286d                (m
+0001b0b0: 6163 644c 696e 652e 696c 6f63 5b3a 335d  acdLine.iloc[:3]
+0001b0c0: 2e69 6c6f 635b 325d 202d 206d 6163 6453  .iloc[2] - macdS
+0001b0d0: 6967 6e61 6c2e 696c 6f63 5b3a 335d 2e69  ignal.iloc[:3].i
+0001b0e0: 6c6f 635b 325d 290a 2020 2020 2020 2020  loc[2]).        
+0001b0f0: 2020 2020 2020 2020 2d20 286d 6163 644c          - (macdL
+0001b100: 696e 652e 696c 6f63 5b3a 325d 2e69 6c6f  ine.iloc[:2].ilo
+0001b110: 635b 315d 202d 206d 6163 6453 6967 6e61  c[1] - macdSigna
+0001b120: 6c2e 696c 6f63 5b3a 325d 2e69 6c6f 635b  l.iloc[:2].iloc[
+0001b130: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
+0001b140: 2020 2020 3c20 310a 2020 2020 2020 2020      < 1.        
+0001b150: 2020 2020 290a 2020 2020 2020 2020 290a      ).        ).
+0001b160: 0a20 2020 2023 406d 6561 7375 7265 5f74  .    #@measure_t
+0001b170: 696d 650a 2020 2020 2320 7661 6c69 6461  ime.    # valida
+0001b180: 7465 2069 6620 4343 4920 6973 2077 6974  te if CCI is wit
+0001b190: 6869 6e20 6769 7665 6e20 7261 6e67 650a  hin given range.
+0001b1a0: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
+0001b1b0: 4343 4928 7365 6c66 2c20 6466 2c20 7363  CCI(self, df, sc
+0001b1c0: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
+0001b1d0: 6374 2c20 6d69 6e43 4349 2c20 6d61 7843  ct, minCCI, maxC
+0001b1e0: 4349 293a 0a20 2020 2020 2020 2069 6620  CI):.        if 
+0001b1f0: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
+0001b200: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
+0001b210: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0001b220: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
+0001b230: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
+0001b240: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0001b250: 612e 6669 6c6c 6e61 2830 290a 2020 2020  a.fillna(0).    
+0001b260: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+0001b270: 7265 706c 6163 6528 5b6e 702e 696e 662c  replace([np.inf,
+0001b280: 202d 6e70 2e69 6e66 5d2c 2030 290a 2020   -np.inf], 0).  
+0001b290: 2020 2020 2020 6363 6920 3d20 696e 7428        cci = int(
+0001b2a0: 6461 7461 2e68 6561 6428 3129 5b22 4343  data.head(1)["CC
+0001b2b0: 4922 5d2e 696c 6f63 5b30 5d29 0a20 2020  I"].iloc[0]).   
+0001b2c0: 2020 2020 2073 6176 6544 6963 745b 2243       saveDict["C
+0001b2d0: 4349 225d 203d 2063 6369 0a20 2020 2020  CI"] = cci.     
+0001b2e0: 2020 2069 6620 2863 6369 203e 3d20 6d69     if (cci >= mi
+0001b2f0: 6e43 4349 2061 6e64 2063 6369 203c 3d20  nCCI and cci <= 
+0001b300: 6d61 7843 4349 293a 0a20 2020 2020 2020  maxCCI):.       
+0001b310: 2020 2020 2069 6620 2822 5570 2220 696e       if ("Up" in
+0001b320: 2073 6176 6544 6963 745b 2254 7265 6e64   saveDict["Trend
+0001b330: 225d 293a 0a20 2020 2020 2020 2020 2020  "]):.           
+0001b340: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+0001b350: 2243 4349 225d 203d 2028 0a20 2020 2020  "CCI"] = (.     
+0001b360: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001b370: 636f 6c6f 7254 6578 742e 424f 4c44 2069  colorText.BOLD i
+0001b380: 6620 2822 5374 726f 6e67 2220 696e 2073  f ("Strong" in s
+0001b390: 6176 6544 6963 745b 2254 7265 6e64 225d  aveDict["Trend"]
+0001b3a0: 2920 656c 7365 2022 2229 202b 2063 6f6c  ) else "") + col
+0001b3b0: 6f72 5465 7874 2e47 5245 454e 202b 2073  orText.GREEN + s
+0001b3c0: 7472 2863 6369 2920 2b20 636f 6c6f 7254  tr(cci) + colorT
+0001b3d0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+0001b3e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001b3f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001b400: 2020 2020 2020 2020 2020 2020 7363 7265              scre
+0001b410: 656e 4469 6374 5b22 4343 4922 5d20 3d20  enDict["CCI"] = 
+0001b420: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001b430: 2020 2020 2020 2863 6f6c 6f72 5465 7874        (colorText
+0001b440: 2e42 4f4c 4420 6966 2028 2253 7472 6f6e  .BOLD if ("Stron
+0001b450: 6722 2069 6e20 7361 7665 4469 6374 5b22  g" in saveDict["
+0001b460: 5472 656e 6422 5d29 2065 6c73 6520 2222  Trend"]) else ""
+0001b470: 2920 2b20 636f 6c6f 7254 6578 742e 4641  ) + colorText.FA
+0001b480: 494c 202b 2073 7472 2863 6369 2920 2b20  IL + str(cci) + 
+0001b490: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+0001b4a0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001b4b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001b4c0: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+0001b4d0: 7363 7265 656e 4469 6374 5b22 4343 4922  screenDict["CCI"
+0001b4e0: 5d20 3d20 636f 6c6f 7254 6578 742e 424f  ] = colorText.BO
+0001b4f0: 4c44 202b 2063 6f6c 6f72 5465 7874 2e46  LD + colorText.F
+0001b500: 4149 4c20 2b20 7374 7228 6363 6929 202b  AIL + str(cci) +
+0001b510: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+0001b520: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0001b530: 6c73 650a 0a20 2020 2023 2046 696e 6420  lse..    # Find 
+0001b540: 436f 6e66 6c75 6365 6e63 650a 2020 2020  Conflucence.    
+0001b550: 6465 6620 7661 6c69 6461 7465 436f 6e66  def validateConf
+0001b560: 6c75 656e 6365 2873 656c 662c 2073 746f  luence(self, sto
+0001b570: 636b 2c20 6466 2c20 7363 7265 656e 4469  ck, df, screenDi
+0001b580: 6374 2c20 7361 7665 4469 6374 2c20 7065  ct, saveDict, pe
+0001b590: 7263 656e 7461 6765 3d30 2e31 2c63 6f6e  rcentage=0.1,con
+0001b5a0: 6646 696c 7465 723d 3329 3a0a 2020 2020  fFilter=3):.    
+0001b5b0: 2020 2020 6966 2064 6620 6973 204e 6f6e      if df is Non
+0001b5c0: 6520 6f72 206c 656e 2864 6629 203d 3d20  e or len(df) == 
+0001b5d0: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+0001b5e0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+0001b5f0: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
+0001b600: 7079 2829 0a20 2020 2020 2020 2072 6563  py().        rec
+0001b610: 656e 7420 3d20 6461 7461 2e68 6561 6428  ent = data.head(
+0001b620: 3229 0a20 2020 2020 2020 2069 6620 6c65  2).        if le
+0001b630: 6e28 7265 6365 6e74 2920 3c20 323a 0a20  n(recent) < 2:. 
+0001b640: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001b650: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+0001b660: 6b65 7931 203d 2022 534d 4122 0a20 2020  key1 = "SMA".   
+0001b670: 2020 2020 206b 6579 3220 3d20 224c 4d41       key2 = "LMA
+0001b680: 220a 2020 2020 2020 2020 6b65 7933 203d  ".        key3 =
+0001b690: 2022 3530 444d 4122 0a20 2020 2020 2020   "50DMA".       
+0001b6a0: 206b 6579 3420 3d20 2232 3030 444d 4122   key4 = "200DMA"
+0001b6b0: 0a20 2020 2020 2020 2069 7332 3044 4d41  .        is20DMA
+0001b6c0: 4372 6f73 736f 7665 7235 3044 4d41 203d  Crossover50DMA =
+0001b6d0: 2028 7265 6365 6e74 5b22 5353 4d41 3230   (recent["SSMA20
+0001b6e0: 225d 2e69 6c6f 635b 305d 203e 3d20 7265  "].iloc[0] >= re
+0001b6f0: 6365 6e74 5b22 534d 4122 5d2e 696c 6f63  cent["SMA"].iloc
+0001b700: 5b30 5d29 2061 6e64 205c 0a20 2020 2020  [0]) and \.     
+0001b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b720: 2020 2020 2020 2028 7265 6365 6e74 5b22         (recent["
+0001b730: 5353 4d41 3230 225d 2e69 6c6f 635b 315d  SSMA20"].iloc[1]
+0001b740: 203c 3d20 7265 6365 6e74 5b22 534d 4122   <= recent["SMA"
+0001b750: 5d2e 696c 6f63 5b31 5d29 0a20 2020 2020  ].iloc[1]).     
+0001b760: 2020 2069 7335 3044 4d41 4372 6f73 736f     is50DMACrosso
+0001b770: 7665 7232 3030 444d 4120 3d20 2872 6563  ver200DMA = (rec
+0001b780: 656e 745b 2253 4d41 225d 2e69 6c6f 635b  ent["SMA"].iloc[
+0001b790: 305d 203e 3d20 7265 6365 6e74 5b22 4c4d  0] >= recent["LM
+0001b7a0: 4122 5d2e 696c 6f63 5b30 5d29 2061 6e64  A"].iloc[0]) and
+0001b7b0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0001b7c0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001b7d0: 7265 6365 6e74 5b22 534d 4122 5d2e 696c  recent["SMA"].il
+0001b7e0: 6f63 5b31 5d20 3c3d 2072 6563 656e 745b  oc[1] <= recent[
+0001b7f0: 224c 4d41 225d 2e69 6c6f 635b 315d 290a  "LMA"].iloc[1]).
+0001b800: 2020 2020 2020 2020 6973 476f 6c64 656e          isGolden
+0001b810: 4372 6f73 734f 7665 7220 3d20 6973 3230  CrossOver = is20
+0001b820: 444d 4143 726f 7373 6f76 6572 3530 444d  DMACrossover50DM
+0001b830: 4120 6f72 2069 7335 3044 4d41 4372 6f73  A or is50DMACros
+0001b840: 736f 7665 7232 3030 444d 410a 2020 2020  sover200DMA.    
+0001b850: 2020 2020 6973 3530 444d 4143 726f 7373      is50DMACross
+0001b860: 6f76 6572 3230 3044 4d41 446f 776e 203d  over200DMADown =
+0001b870: 2028 7265 6365 6e74 5b22 534d 4122 5d2e   (recent["SMA"].
+0001b880: 696c 6f63 5b30 5d20 3c3d 2072 6563 656e  iloc[0] <= recen
+0001b890: 745b 224c 4d41 225d 2e69 6c6f 635b 305d  t["LMA"].iloc[0]
+0001b8a0: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
+0001b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8c0: 2020 2020 2872 6563 656e 745b 2253 4d41      (recent["SMA
+0001b8d0: 225d 2e69 6c6f 635b 315d 203e 3d20 7265  "].iloc[1] >= re
+0001b8e0: 6365 6e74 5b22 4c4d 4122 5d2e 696c 6f63  cent["LMA"].iloc
+0001b8f0: 5b31 5d29 0a20 2020 2020 2020 2069 7332  [1]).        is2
+0001b900: 3044 4d41 4372 6f73 736f 7665 7235 3044  0DMACrossover50D
+0001b910: 4d41 446f 776e 203d 2028 7265 6365 6e74  MADown = (recent
+0001b920: 5b22 5353 4d41 3230 225d 2e69 6c6f 635b  ["SSMA20"].iloc[
+0001b930: 305d 203c 3d20 7265 6365 6e74 5b22 534d  0] <= recent["SM
+0001b940: 4122 5d2e 696c 6f63 5b30 5d29 2061 6e64  A"].iloc[0]) and
+0001b950: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0001b960: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001b970: 7265 6365 6e74 5b22 5353 4d41 3230 225d  recent["SSMA20"]
+0001b980: 2e69 6c6f 635b 315d 203e 3d20 7265 6365  .iloc[1] >= rece
+0001b990: 6e74 5b22 534d 4122 5d2e 696c 6f63 5b31  nt["SMA"].iloc[1
+0001b9a0: 5d29 0a20 2020 2020 2020 2069 7344 6561  ]).        isDea
+0001b9b0: 6443 726f 7373 4f76 6572 203d 2069 7332  dCrossOver = is2
+0001b9c0: 3044 4d41 4372 6f73 736f 7665 7235 3044  0DMACrossover50D
+0001b9d0: 4d41 446f 776e 206f 7220 6973 3530 444d  MADown or is50DM
+0001b9e0: 4143 726f 7373 6f76 6572 3230 3044 4d41  ACrossover200DMA
+0001b9f0: 446f 776e 0a20 2020 2020 2020 2064 6561  Down.        dea
+0001ba00: 6478 4f76 6572 5465 7874 203d 2066 2744  dxOverText = f'D
+0001ba10: 6561 6443 726f 7373 6f76 6572 7b22 2832  eadCrossover{"(2
+0001ba20: 3029 2220 6966 2069 7332 3044 4d41 4372  0)" if is20DMACr
+0001ba30: 6f73 736f 7665 7235 3044 4d41 446f 776e  ossover50DMADown
+0001ba40: 2065 6c73 6520 2822 2835 3029 2220 6966   else ("(50)" if
+0001ba50: 2069 7335 3044 4d41 4372 6f73 736f 7665   is50DMACrossove
+0001ba60: 7232 3030 444d 4144 6f77 6e20 656c 7365  r200DMADown else
+0001ba70: 2022 2229 7d27 0a20 2020 2020 2020 2067   "")}'.        g
+0001ba80: 6f6c 6465 6e78 4f76 6572 5465 7874 203d  oldenxOverText =
+0001ba90: 2066 2747 6f6c 6465 6e43 726f 7373 6f76   f'GoldenCrossov
+0001baa0: 6572 7b22 2832 3029 2220 6966 2069 7332  er{"(20)" if is2
+0001bab0: 3044 4d41 4372 6f73 736f 7665 7235 3044  0DMACrossover50D
+0001bac0: 4d41 2065 6c73 6520 2822 2835 3029 2220  MA else ("(50)" 
+0001bad0: 6966 2069 7335 3044 4d41 4372 6f73 736f  if is50DMACrosso
+0001bae0: 7665 7232 3030 444d 4120 656c 7365 2022  ver200DMA else "
+0001baf0: 2229 7d27 0a20 2020 2020 2020 2069 6620  ")}'.        if 
+0001bb00: 6973 3230 444d 4143 726f 7373 6f76 6572  is20DMACrossover
+0001bb10: 3530 444d 4120 6f72 2069 7332 3044 4d41  50DMA or is20DMA
+0001bb20: 4372 6f73 736f 7665 7235 3044 4d41 446f  Crossover50DMADo
+0001bb30: 776e 3a0a 2020 2020 2020 2020 2020 2020  wn:.            
+0001bb40: 6b65 7931 203d 2022 5353 4d41 3230 220a  key1 = "SSMA20".
+0001bb50: 2020 2020 2020 2020 2020 2020 6b65 7932              key2
+0001bb60: 203d 2022 534d 4122 0a20 2020 2020 2020   = "SMA".       
+0001bb70: 2020 2020 206b 6579 3320 3d20 2232 3044       key3 = "20D
+0001bb80: 4d41 220a 2020 2020 2020 2020 2020 2020  MA".            
+0001bb90: 6b65 7934 203d 2022 3530 444d 4122 0a20  key4 = "50DMA". 
+0001bba0: 2020 2020 2020 2069 7335 3044 4d41 5570         is50DMAUp
+0001bbb0: 5472 656e 6420 3d20 2872 6563 656e 745b  Trend = (recent[
+0001bbc0: 6b65 7931 5d2e 696c 6f63 5b30 5d20 3e20  key1].iloc[0] > 
+0001bbd0: 7265 6365 6e74 5b6b 6579 325d 2e69 6c6f  recent[key2].ilo
+0001bbe0: 635b 315d 290a 2020 2020 2020 2020 6973  c[1]).        is
+0001bbf0: 3530 444d 4144 6f77 6e54 7265 6e64 203d  50DMADownTrend =
+0001bc00: 2028 7265 6365 6e74 5b6b 6579 315d 2e69   (recent[key1].i
+0001bc10: 6c6f 635b 305d 203c 2072 6563 656e 745b  loc[0] < recent[
+0001bc20: 6b65 7931 5d2e 696c 6f63 5b31 5d29 0a20  key1].iloc[1]). 
+0001bc30: 2020 2020 2020 2069 7335 3044 4d41 203d         is50DMA =
+0001bc40: 2028 7265 6365 6e74 5b6b 6579 315d 2e69   (recent[key1].i
+0001bc50: 6c6f 635b 305d 203c 3d20 7265 6365 6e74  loc[0] <= recent
+0001bc60: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+0001bc70: 5d29 0a20 2020 2020 2020 2069 7332 3030  ]).        is200
+0001bc80: 444d 4120 3d20 2872 6563 656e 745b 6b65  DMA = (recent[ke
+0001bc90: 7932 5d2e 696c 6f63 5b30 5d20 3c3d 2072  y2].iloc[0] <= r
+0001bca0: 6563 656e 745b 2243 6c6f 7365 225d 2e69  ecent["Close"].i
+0001bcb0: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
+0001bcc0: 6469 6666 6572 656e 6365 203d 2072 6f75  difference = rou
+0001bcd0: 6e64 2828 7265 6365 6e74 5b6b 6579 315d  nd((recent[key1]
+0001bce0: 2e69 6c6f 635b 305d 202d 2072 6563 656e  .iloc[0] - recen
+0001bcf0: 745b 6b65 7932 5d2e 696c 6f63 5b30 5d29  t[key2].iloc[0])
+0001bd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bd10: 202f 2072 6563 656e 745b 2243 6c6f 7365   / recent["Close
+0001bd20: 225d 2e69 6c6f 635b 305d 0a20 2020 2020  "].iloc[0].     
+0001bd30: 2020 2020 2020 2020 2020 202a 2031 3030             * 100
+0001bd40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001bd50: 2020 322c 0a20 2020 2020 2020 2020 2020    2,.           
+0001bd60: 2029 0a20 2020 2020 2020 2073 6176 6544   ).        saveD
+0001bd70: 6963 745b 2243 6f6e 6644 4d41 4469 6666  ict["ConfDMADiff
+0001bd80: 6572 656e 6365 225d 203d 2064 6966 6665  erence"] = diffe
+0001bd90: 7265 6e63 650a 2020 2020 2020 2020 7363  rence.        sc
+0001bda0: 7265 656e 4469 6374 5b22 436f 6e66 444d  reenDict["ConfDM
+0001bdb0: 4144 6966 6665 7265 6e63 6522 5d20 3d20  ADifference"] = 
+0001bdc0: 6469 6666 6572 656e 6365 0a20 2020 2020  difference.     
+0001bdd0: 2020 2073 6176 6564 203d 2073 656c 662e     saved = self.
+0001bde0: 6669 6e64 4375 7272 656e 7453 6176 6564  findCurrentSaved
+0001bdf0: 5661 6c75 6528 7363 7265 656e 4469 6374  Value(screenDict
+0001be00: 2c73 6176 6544 6963 742c 224d 412d 5369  ,saveDict,"MA-Si
+0001be10: 676e 616c 2229 0a20 2020 2020 2020 2023  gnal").        #
+0001be20: 2064 6966 6665 7265 6e63 6520 3d20 6162   difference = ab
+0001be30: 7328 6469 6666 6572 656e 6365 290a 2020  s(difference).  
+0001be40: 2020 2020 2020 636f 6e66 5465 7874 203d        confText =
+0001be50: 2066 227b 676f 6c64 656e 784f 7665 7254   f"{goldenxOverT
+0001be60: 6578 7420 6966 2069 7347 6f6c 6465 6e43  ext if isGoldenC
+0001be70: 726f 7373 4f76 6572 2065 6c73 6520 2864  rossOver else (d
+0001be80: 6561 6478 4f76 6572 5465 7874 2069 6620  eadxOverText if 
+0001be90: 6973 4465 6164 4372 6f73 734f 7665 7220  isDeadCrossOver 
+0001bea0: 656c 7365 2028 2743 6f6e 662e 5570 2720  else ('Conf.Up' 
+0001beb0: 6966 2069 7335 3044 4d41 5570 5472 656e  if is50DMAUpTren
+0001bec0: 6420 656c 7365 2028 2743 6f6e 662e 446f  d else ('Conf.Do
+0001bed0: 776e 2720 6966 2069 7335 3044 4d41 446f  wn' if is50DMADo
+0001bee0: 776e 5472 656e 6420 656c 7365 2028 6b65  wnTrend else (ke
+0001bef0: 7933 2069 6620 6973 3530 444d 4120 656c  y3 if is50DMA el
+0001bf00: 7365 2028 6b65 7934 2069 6620 6973 3230  se (key4 if is20
+0001bf10: 3044 4d41 2065 6c73 6520 2755 6e6b 6e6f  0DMA else 'Unkno
+0001bf20: 776e 2729 2929 2929 7d22 0a20 2020 2020  wn')))))}".     
+0001bf30: 2020 2069 6620 6162 7328 7265 6365 6e74     if abs(recent
+0001bf40: 5b6b 6579 315d 2e69 6c6f 635b 305d 202d  [key1].iloc[0] -
+0001bf50: 2072 6563 656e 745b 6b65 7932 5d2e 696c   recent[key2].il
+0001bf60: 6f63 5b30 5d29 203c 3d20 280a 2020 2020  oc[0]) <= (.    
+0001bf70: 2020 2020 2020 2020 7265 6365 6e74 5b6b          recent[k
+0001bf80: 6579 315d 2e69 6c6f 635b 305d 202a 2070  ey1].iloc[0] * p
+0001bf90: 6572 6365 6e74 6167 650a 2020 2020 2020  ercentage.      
+0001bfa0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0001bfb0: 2069 6620 7265 6365 6e74 5b6b 6579 315d   if recent[key1]
+0001bfc0: 2e69 6c6f 635b 305d 203e 3d20 7265 6365  .iloc[0] >= rece
+0001bfd0: 6e74 5b6b 6579 325d 2e69 6c6f 635b 305d  nt[key2].iloc[0]
+0001bfe0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001bff0: 2020 7363 7265 656e 4469 6374 5b22 4d41    screenDict["MA
+0001c000: 2d53 6967 6e61 6c22 5d20 3d20 280a 2020  -Signal"] = (.  
+0001c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c020: 2020 7361 7665 645b 305d 200a 2020 2020    saved[0] .    
+0001c030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c040: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
+0001c050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c060: 2020 2020 202b 2028 636f 6c6f 7254 6578       + (colorTex
+0001c070: 742e 4752 4545 4e20 6966 2069 7335 3044  t.GREEN if is50D
+0001c080: 4d41 5570 5472 656e 6420 656c 7365 2028  MAUpTrend else (
+0001c090: 636f 6c6f 7254 6578 742e 4641 494c 2069  colorText.FAIL i
+0001c0a0: 6620 6973 3530 444d 4144 6f77 6e54 7265  f is50DMADownTre
+0001c0b0: 6e64 2065 6c73 6520 636f 6c6f 7254 6578  nd else colorTex
+0001c0c0: 742e 5741 524e 2929 0a20 2020 2020 2020  t.WARN)).       
+0001c0d0: 2020 2020 2020 2020 2020 2020 202b 2066               + f
+0001c0e0: 227b 636f 6e66 5465 7874 7d20 287b 6469  "{confText} ({di
+0001c0f0: 6666 6572 656e 6365 7d25 2922 0a20 2020  fference}%)".   
+0001c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c110: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0001c120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c130: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0001c140: 2020 2073 6176 6544 6963 745b 224d 412d     saveDict["MA-
+0001c150: 5369 676e 616c 225d 203d 2073 6176 6564  Signal"] = saved
+0001c160: 5b31 5d20 2b20 6622 7b63 6f6e 6654 6578  [1] + f"{confTex
+0001c170: 747d 2028 7b64 6966 6665 7265 6e63 657d  t} ({difference}
+0001c180: 2529 220a 2020 2020 2020 2020 2020 2020  %)".            
+0001c190: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001c1a0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+0001c1b0: 5b22 4d41 2d53 6967 6e61 6c22 5d20 3d20  ["MA-Signal"] = 
+0001c1c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001c1d0: 2020 2020 2020 7361 7665 645b 305d 200a        saved[0] .
+0001c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1f0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0001c200: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
+0001c210: 2020 2020 2020 2020 202b 2028 636f 6c6f           + (colo
+0001c220: 7254 6578 742e 4752 4545 4e20 6966 2069  rText.GREEN if i
+0001c230: 7335 3044 4d41 5570 5472 656e 6420 656c  s50DMAUpTrend el
+0001c240: 7365 2028 636f 6c6f 7254 6578 742e 4641  se (colorText.FA
+0001c250: 494c 2069 6620 6973 3530 444d 4144 6f77  IL if is50DMADow
+0001c260: 6e54 7265 6e64 2065 6c73 6520 636f 6c6f  nTrend else colo
+0001c270: 7254 6578 742e 5741 524e 2929 0a20 2020  rText.WARN)).   
+0001c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c290: 202b 2066 227b 636f 6e66 5465 7874 7d20   + f"{confText} 
+0001c2a0: 287b 6469 6666 6572 656e 6365 7d25 2922  ({difference}%)"
+0001c2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c2c0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0001c2d0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+0001c2e0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0001c2f0: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+0001c300: 224d 412d 5369 676e 616c 225d 203d 2073  "MA-Signal"] = s
+0001c310: 6176 6564 5b31 5d20 2b20 6622 7b63 6f6e  aved[1] + f"{con
+0001c320: 6654 6578 747d 2028 7b64 6966 6665 7265  fText} ({differe
+0001c330: 6e63 657d 2529 220a 2020 2020 2020 2020  nce}%)".        
+0001c340: 2020 2020 7265 7475 726e 2063 6f6e 6646      return confF
+0001c350: 696c 7465 7220 3d3d 2033 206f 7220 5c0a  ilter == 3 or \.
+0001c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c370: 2863 6f6e 6646 696c 7465 7220 3d3d 2031  (confFilter == 1
+0001c380: 2061 6e64 206e 6f74 2069 7344 6561 6443   and not isDeadC
+0001c390: 726f 7373 4f76 6572 2061 6e64 2028 6973  rossOver and (is
+0001c3a0: 3530 444d 4155 7054 7265 6e64 206f 7220  50DMAUpTrend or 
+0001c3b0: 2869 7347 6f6c 6465 6e43 726f 7373 4f76  (isGoldenCrossOv
+0001c3c0: 6572 206f 7220 2755 7027 2069 6e20 636f  er or 'Up' in co
+0001c3d0: 6e66 5465 7874 2929 2920 6f72 205c 0a20  nfText))) or \. 
+0001c3e0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001c3f0: 636f 6e66 4669 6c74 6572 203d 3d20 3220  confFilter == 2 
+0001c400: 616e 6420 6e6f 7420 6973 476f 6c64 656e  and not isGolden
+0001c410: 4372 6f73 734f 7665 7220 616e 6420 2869  CrossOver and (i
+0001c420: 7335 3044 4d41 446f 776e 5472 656e 6420  s50DMADownTrend 
+0001c430: 6f72 2069 7344 6561 6443 726f 7373 4f76  or isDeadCrossOv
+0001c440: 6572 206f 7220 2744 6f77 6e27 2069 6e20  er or 'Down' in 
+0001c450: 636f 6e66 5465 7874 2929 0a20 2020 2020  confText)).     
+0001c460: 2020 2023 204d 6179 6265 2074 6865 2064     # Maybe the d
+0001c470: 6966 6665 7265 6e63 6520 6973 206e 6f74  ifference is not
+0001c480: 2077 6974 6869 6e20 7468 6520 7261 6e67   within the rang
+0001c490: 652c 2062 7574 2077 6527 6420 7374 696c  e, but we'd stil
+0001c4a0: 6c20 6c69 6b65 2074 6f20 6b65 6570 2074  l like to keep t
+0001c4b0: 6865 2073 746f 636b 2069 6e0a 2020 2020  he stock in.    
+0001c4c0: 2020 2020 2320 7468 6520 6c69 7374 2069      # the list i
+0001c4d0: 6620 6974 2773 2061 2067 6f6c 6465 6e20  f it's a golden 
+0001c4e0: 6372 6f73 736f 7665 7220 6f72 2064 6561  crossover or dea
+0001c4f0: 6420 6372 6f73 736f 7665 720a 2020 2020  d crossover.    
+0001c500: 2020 2020 6966 2069 7347 6f6c 6465 6e43      if isGoldenC
+0001c510: 726f 7373 4f76 6572 206f 7220 6973 4465  rossOver or isDe
+0001c520: 6164 4372 6f73 734f 7665 723a 0a20 2020  adCrossOver:.   
+0001c530: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+0001c540: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
+0001c550: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0001c560: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
+0001c570: 5d20 0a20 2020 2020 2020 2020 2020 2020  ] .             
+0001c580: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+0001c590: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
+0001c5a0: 2020 2020 2020 2020 2020 2020 2b20 2863              + (c
+0001c5b0: 6f6c 6f72 5465 7874 2e47 5245 454e 2069  olorText.GREEN i
+0001c5c0: 6620 6973 3530 444d 4155 7054 7265 6e64  f is50DMAUpTrend
+0001c5d0: 2065 6c73 6520 2863 6f6c 6f72 5465 7874   else (colorText
+0001c5e0: 2e46 4149 4c20 6966 2069 7335 3044 4d41  .FAIL if is50DMA
+0001c5f0: 446f 776e 5472 656e 6420 656c 7365 2063  DownTrend else c
+0001c600: 6f6c 6f72 5465 7874 2e57 4152 4e29 290a  olorText.WARN)).
+0001c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c620: 2020 2020 2b20 6622 7b63 6f6e 6654 6578      + f"{confTex
+0001c630: 747d 2028 7b64 6966 6665 7265 6e63 657d  t} ({difference}
+0001c640: 2529 220a 2020 2020 2020 2020 2020 2020  %)".            
+0001c650: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
+0001c660: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+0001c670: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001c680: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+0001c690: 4d41 2d53 6967 6e61 6c22 5d20 3d20 7361  MA-Signal"] = sa
+0001c6a0: 7665 645b 315d 202b 2066 227b 636f 6e66  ved[1] + f"{conf
+0001c6b0: 5465 7874 7d20 287b 6469 6666 6572 656e  Text} ({differen
+0001c6c0: 6365 7d25 2922 0a20 2020 2020 2020 2020  ce}%)".         
+0001c6d0: 2020 2072 6574 7572 6e20 636f 6e66 4669     return confFi
+0001c6e0: 6c74 6572 203d 3d20 3320 6f72 205c 0a20  lter == 3 or \. 
+0001c6f0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001c700: 636f 6e66 4669 6c74 6572 203d 3d20 3120  confFilter == 1 
+0001c710: 616e 6420 6973 476f 6c64 656e 4372 6f73  and isGoldenCros
+0001c720: 734f 7665 7229 206f 7220 5c0a 2020 2020  sOver) or \.    
+0001c730: 2020 2020 2020 2020 2020 2020 2863 6f6e              (con
+0001c740: 6646 696c 7465 7220 3d3d 2032 2061 6e64  fFilter == 2 and
+0001c750: 2069 7344 6561 6443 726f 7373 4f76 6572   isDeadCrossOver
+0001c760: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001c770: 2046 616c 7365 0a0a 2020 2020 2340 6d65   False..    #@me
+0001c780: 6173 7572 655f 7469 6d65 0a20 2020 2023  asure_time.    #
+0001c790: 2056 616c 6964 6174 6520 6966 2073 6861   Validate if sha
+0001c7a0: 7265 2070 7269 6365 7320 6172 6520 636f  re prices are co
+0001c7b0: 6e73 6f6c 6964 6174 696e 670a 2020 2020  nsolidating.    
+0001c7c0: 6465 6620 7661 6c69 6461 7465 436f 6e73  def validateCons
+0001c7d0: 6f6c 6964 6174 696f 6e28 7365 6c66 2c20  olidation(self, 
+0001c7e0: 6466 2c20 7363 7265 656e 4469 6374 2c20  df, screenDict, 
+0001c7f0: 7361 7665 4469 6374 2c20 7065 7263 656e  saveDict, percen
+0001c800: 7461 6765 3d31 3029 3a0a 2020 2020 2020  tage=10):.      
+0001c810: 2020 6966 2064 6620 6973 204e 6f6e 6520    if df is None 
+0001c820: 6f72 206c 656e 2864 6629 203d 3d20 303a  or len(df) == 0:
+0001c830: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001c840: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
+0001c850: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
+0001c860: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
+0001c870: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
+0001c880: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+0001c890: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
+0001c8a0: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
+0001c8b0: 3029 0a20 2020 2020 2020 2068 6320 3d20  0).        hc = 
+0001c8c0: 6461 7461 2e64 6573 6372 6962 6528 295b  data.describe()[
+0001c8d0: 2243 6c6f 7365 225d 5b22 6d61 7822 5d0a  "Close"]["max"].
+0001c8e0: 2020 2020 2020 2020 6c63 203d 2064 6174          lc = dat
+0001c8f0: 612e 6465 7363 7269 6265 2829 5b22 436c  a.describe()["Cl
+0001c900: 6f73 6522 5d5b 226d 696e 225d 0a20 2020  ose"]["min"].   
+0001c910: 2020 2020 2069 6620 2868 6320 2d20 6c63       if (hc - lc
+0001c920: 2920 3c3d 2028 6863 202a 2070 6572 6365  ) <= (hc * perce
+0001c930: 6e74 6167 6520 2f20 3130 3029 2061 6e64  ntage / 100) and
+0001c940: 2028 6863 202d 206c 6320 213d 2030 293a   (hc - lc != 0):
+0001c950: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
+0001c960: 6565 6e44 6963 745b 2243 6f6e 736f 6c2e  eenDict["Consol.
+0001c970: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+0001c980: 2020 2020 2020 2063 6f6c 6f72 5465 7874         colorText
+0001c990: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
+0001c9a0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0001c9b0: 742e 4752 4545 4e0a 2020 2020 2020 2020  t.GREEN.        
+0001c9c0: 2020 2020 2020 2020 2b20 2252 616e 6765          + "Range
+0001c9d0: 3a22 0a20 2020 2020 2020 2020 2020 2020  :".             
+0001c9e0: 2020 202b 2073 7472 2872 6f75 6e64 2828     + str(round((
+0001c9f0: 6162 7328 2868 6320 2d20 6c63 2920 2f20  abs((hc - lc) / 
+0001ca00: 6863 2920 2a20 3130 3029 2c20 3129 290a  hc) * 100), 1)).
+0001ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca20: 2b20 2225 220a 2020 2020 2020 2020 2020  + "%".          
+0001ca30: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0001ca40: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+0001ca50: 2020 290a 2020 2020 2020 2020 656c 7365    ).        else
+0001ca60: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
+0001ca70: 7265 656e 4469 6374 5b22 436f 6e73 6f6c  reenDict["Consol
+0001ca80: 2e22 5d20 3d20 280a 2020 2020 2020 2020  ."] = (.        
+0001ca90: 2020 2020 2020 2020 636f 6c6f 7254 6578          colorTex
+0001caa0: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
+0001cab0: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+0001cac0: 7874 2e46 4149 4c0a 2020 2020 2020 2020  xt.FAIL.        
+0001cad0: 2020 2020 2020 2020 2b20 2252 616e 6765          + "Range
+0001cae0: 3a22 0a20 2020 2020 2020 2020 2020 2020  :".             
+0001caf0: 2020 202b 2073 7472 2872 6f75 6e64 2828     + str(round((
+0001cb00: 6162 7328 2868 6320 2d20 6c63 2920 2f20  abs((hc - lc) / 
+0001cb10: 6863 2920 2a20 3130 3029 2c20 3129 290a  hc) * 100), 1)).
+0001cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb30: 2b20 2225 220a 2020 2020 2020 2020 2020  + "%".          
+0001cb40: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0001cb50: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+0001cb60: 2020 290a 2020 2020 2020 2020 7361 7665    ).        save
+0001cb70: 4469 6374 5b22 436f 6e73 6f6c 2e22 5d20  Dict["Consol."] 
+0001cb80: 3d20 6627 5261 6e67 653a 7b73 7472 2872  = f'Range:{str(r
+0001cb90: 6f75 6e64 2828 6162 7328 2868 632d 6c63  ound((abs((hc-lc
+0001cba0: 292f 6863 292a 3130 3029 2c31 2929 2b22  )/hc)*100),1))+"
+0001cbb0: 2522 7d27 0a20 2020 2020 2020 2072 6574  %"}'.        ret
+0001cbc0: 7572 6e20 726f 756e 6428 2861 6273 2828  urn round((abs((
+0001cbd0: 6863 202d 206c 6329 202f 2068 6329 202a  hc - lc) / hc) *
+0001cbe0: 2031 3030 292c 2031 290a 0a20 2020 2023   100), 1)..    #
+0001cbf0: 2076 616c 6964 6174 6520 6966 2074 6865   validate if the
+0001cc00: 2073 746f 636b 2068 6173 2062 6565 6e20   stock has been 
+0001cc10: 6861 7669 6e67 2068 6967 6865 7220 6869  having higher hi
+0001cc20: 6768 732c 2068 6967 6865 7220 6c6f 7773  ghs, higher lows
+0001cc30: 0a20 2020 2023 2061 6e64 2068 6967 6865  .    # and highe
+0001cc40: 7220 636c 6f73 6520 7769 7468 206c 6174  r close with lat
+0001cc50: 6573 7420 636c 6f73 6520 3e20 7375 7065  est close > supe
+0001cc60: 7274 7265 6e64 2061 6e64 2038 2d45 4d41  rtrend and 8-EMA
+0001cc70: 2e0a 2020 2020 6465 6620 7661 6c69 6461  ..    def valida
+0001cc80: 7465 4869 6768 6572 4869 6768 7348 6967  teHigherHighsHig
+0001cc90: 6865 724c 6f77 7348 6967 6865 7243 6c6f  herLowsHigherClo
+0001cca0: 7365 2873 656c 662c 2064 6629 3a0a 2020  se(self, df):.  
+0001ccb0: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
+0001ccc0: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
+0001ccd0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0001cce0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0001ccf0: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
+0001cd00: 636f 7079 2829 0a20 2020 2020 2020 2064  copy().        d
+0001cd10: 6179 3020 3d20 6461 7461 0a20 2020 2020  ay0 = data.     
+0001cd20: 2020 2064 6179 3120 3d20 6461 7461 5b31     day1 = data[1
+0001cd30: 3a5d 0a20 2020 2020 2020 2064 6179 3220  :].        day2 
+0001cd40: 3d20 6461 7461 5b32 3a5d 0a20 2020 2020  = data[2:].     
+0001cd50: 2020 2064 6179 3320 3d20 6461 7461 5b33     day3 = data[3
+0001cd60: 3a5d 0a20 2020 2020 2020 2069 6620 6c65  :].        if le
+0001cd70: 6e28 6461 7931 2920 3c20 3120 6f72 206c  n(day1) < 1 or l
+0001cd80: 656e 2864 6179 3229 203c 2031 206f 7220  en(day2) < 1 or 
+0001cd90: 6c65 6e28 6461 7933 2920 3c20 313a 0a20  len(day3) < 1:. 
+0001cda0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001cdb0: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+0001cdc0: 6869 6768 6572 4869 6768 7320 3d20 280a  higherHighs = (.
+0001cdd0: 2020 2020 2020 2020 2020 2020 2864 6179              (day
+0001cde0: 305b 2248 6967 6822 5d2e 696c 6f63 5b30  0["High"].iloc[0
+0001cdf0: 5d20 3e20 6461 7931 5b22 4869 6768 225d  ] > day1["High"]
+0001ce00: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
+0001ce10: 2020 2020 2020 616e 6420 2864 6179 315b        and (day1[
+0001ce20: 2248 6967 6822 5d2e 696c 6f63 5b30 5d20  "High"].iloc[0] 
+0001ce30: 3e20 6461 7932 5b22 4869 6768 225d 2e69  > day2["High"].i
+0001ce40: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
+0001ce50: 2020 2020 616e 6420 2864 6179 325b 2248      and (day2["H
+0001ce60: 6967 6822 5d2e 696c 6f63 5b30 5d20 3e20  igh"].iloc[0] > 
+0001ce70: 6461 7933 5b22 4869 6768 225d 2e69 6c6f  day3["High"].ilo
+0001ce80: 635b 305d 290a 2020 2020 2020 2020 290a  c[0]).        ).
+0001ce90: 2020 2020 2020 2020 6869 6768 6572 4c6f          higherLo
+0001cea0: 7773 203d 2028 0a20 2020 2020 2020 2020  ws = (.         
+0001ceb0: 2020 2028 6461 7930 5b22 4c6f 7722 5d2e     (day0["Low"].
+0001cec0: 696c 6f63 5b30 5d20 3e20 6461 7931 5b22  iloc[0] > day1["
+0001ced0: 4c6f 7722 5d2e 696c 6f63 5b30 5d29 0a20  Low"].iloc[0]). 
+0001cee0: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
+0001cef0: 6461 7931 5b22 4c6f 7722 5d2e 696c 6f63  day1["Low"].iloc
+0001cf00: 5b30 5d20 3e20 6461 7932 5b22 4c6f 7722  [0] > day2["Low"
+0001cf10: 5d2e 696c 6f63 5b30 5d29 0a20 2020 2020  ].iloc[0]).     
+0001cf20: 2020 2020 2020 2061 6e64 2028 6461 7932         and (day2
+0001cf30: 5b22 4c6f 7722 5d2e 696c 6f63 5b30 5d20  ["Low"].iloc[0] 
+0001cf40: 3e20 6461 7933 5b22 4c6f 7722 5d2e 696c  > day3["Low"].il
+0001cf50: 6f63 5b30 5d29 0a20 2020 2020 2020 2029  oc[0]).        )
+0001cf60: 0a20 2020 2020 2020 2068 6967 6865 7243  .        higherC
+0001cf70: 6c6f 7365 203d 2028 0a20 2020 2020 2020  lose = (.       
+0001cf80: 2020 2020 2028 6461 7930 5b22 436c 6f73       (day0["Clos
+0001cf90: 6522 5d2e 696c 6f63 5b30 5d20 3e20 6461  e"].iloc[0] > da
+0001cfa0: 7931 5b22 436c 6f73 6522 5d2e 696c 6f63  y1["Close"].iloc
+0001cfb0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+0001cfc0: 2061 6e64 2028 6461 7931 5b22 436c 6f73   and (day1["Clos
+0001cfd0: 6522 5d2e 696c 6f63 5b30 5d20 3e20 6461  e"].iloc[0] > da
+0001cfe0: 7932 5b22 436c 6f73 6522 5d2e 696c 6f63  y2["Close"].iloc
+0001cff0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+0001d000: 2061 6e64 2028 6461 7932 5b22 436c 6f73   and (day2["Clos
+0001d010: 6522 5d2e 696c 6f63 5b30 5d20 3e20 6461  e"].iloc[0] > da
+0001d020: 7933 5b22 436c 6f73 6522 5d2e 696c 6f63  y3["Close"].iloc
+0001d030: 5b30 5d29 0a20 2020 2020 2020 2029 0a20  [0]).        ). 
+0001d040: 2020 2020 2020 2023 2068 6967 6865 7252         # higherR
+0001d050: 5349 203d 2028 6461 7930 5b22 5253 4922  SI = (day0["RSI"
+0001d060: 5d2e 696c 6f63 5b30 5d20 3e20 6461 7931  ].iloc[0] > day1
+0001d070: 5b22 5253 4922 5d2e 696c 6f63 5b30 5d29  ["RSI"].iloc[0])
+0001d080: 2061 6e64 205c 0a20 2020 2020 2020 2023   and \.        #
+0001d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0a0: 2028 6461 7931 5b22 5253 4922 5d2e 696c   (day1["RSI"].il
+0001d0b0: 6f63 5b30 5d20 3e20 6461 7932 5b22 5253  oc[0] > day2["RS
+0001d0c0: 4922 5d2e 696c 6f63 5b30 5d29 2061 6e64  I"].iloc[0]) and
+0001d0d0: 205c 0a20 2020 2020 2020 2023 2020 2020   \.        #    
+0001d0e0: 2020 2020 2020 2020 2020 2020 2028 6461               (da
+0001d0f0: 7932 5b22 5253 4922 5d2e 696c 6f63 5b30  y2["RSI"].iloc[0
+0001d100: 5d20 3e20 6461 7933 5b22 5253 4922 5d2e  ] > day3["RSI"].
+0001d110: 696c 6f63 5b30 5d29 2061 6e64 205c 0a20  iloc[0]) and \. 
+0001d120: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+0001d130: 2020 2020 2020 2020 2064 6179 335b 2252           day3["R
+0001d140: 5349 225d 2e69 6c6f 635b 305d 203e 3d20  SI"].iloc[0] >= 
+0001d150: 3530 2061 6e64 2064 6179 305b 2252 5349  50 and day0["RSI
+0001d160: 225d 2e69 6c6f 635b 305d 203e 3d20 3635  "].iloc[0] >= 65
+0001d170: 0a20 2020 2020 2020 2072 6576 6572 7365  .        reverse
+0001d180: 6444 6174 6120 3d20 6461 7461 5b3a 3a2d  dData = data[::-
+0001d190: 315d 2e63 6f70 7928 290a 2020 2020 2020  1].copy().      
+0001d1a0: 2020 7265 7665 7273 6564 4461 7461 5b22    reversedData["
+0001d1b0: 5355 5045 5254 225d 203d 2070 6b74 616c  SUPERT"] = pktal
+0001d1c0: 6962 2e73 7570 6572 7472 656e 6428 7265  ib.supertrend(re
+0001d1d0: 7665 7273 6564 4461 7461 2c20 372c 2033  versedData, 7, 3
+0001d1e0: 295b 2253 5550 4552 545f 375f 332e 3022  )["SUPERT_7_3.0"
+0001d1f0: 5d0a 2020 2020 2020 2020 7265 7665 7273  ].        revers
+0001d200: 6564 4461 7461 5b22 454d 4138 225d 203d  edData["EMA8"] =
+0001d210: 2070 6b74 616c 6962 2e45 4d41 2872 6576   pktalib.EMA(rev
+0001d220: 6572 7365 6444 6174 615b 2243 6c6f 7365  ersedData["Close
+0001d230: 225d 2c20 7469 6d65 7065 7269 6f64 3d39  "], timeperiod=9
+0001d240: 290a 2020 2020 2020 2020 6869 6768 6572  ).        higher
+0001d250: 436c 6f73 6520 3d20 280a 2020 2020 2020  Close = (.      
+0001d260: 2020 2020 2020 6869 6768 6572 436c 6f73        higherClos
+0001d270: 650a 2020 2020 2020 2020 2020 2020 616e  e.            an
+0001d280: 6420 6461 7930 5b22 436c 6f73 6522 5d2e  d day0["Close"].
+0001d290: 696c 6f63 5b30 5d20 3e20 7265 7665 7273  iloc[0] > revers
+0001d2a0: 6564 4461 7461 2e74 6169 6c28 3129 5b22  edData.tail(1)["
+0001d2b0: 5355 5045 5254 225d 2e69 6c6f 635b 305d  SUPERT"].iloc[0]
+0001d2c0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+0001d2d0: 2064 6179 305b 2243 6c6f 7365 225d 2e69   day0["Close"].i
+0001d2e0: 6c6f 635b 305d 203e 2072 6576 6572 7365  loc[0] > reverse
+0001d2f0: 6444 6174 612e 7461 696c 2831 295b 2245  dData.tail(1)["E
+0001d300: 4d41 3822 5d2e 696c 6f63 5b30 5d0a 2020  MA8"].iloc[0].  
+0001d310: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001d320: 7265 7475 726e 2068 6967 6865 7248 6967  return higherHig
+0001d330: 6873 2061 6e64 2068 6967 6865 724c 6f77  hs and higherLow
+0001d340: 7320 616e 6420 6869 6768 6572 436c 6f73  s and higherClos
+0001d350: 650a 0a20 2020 2023 406d 6561 7375 7265  e..    #@measure
+0001d360: 5f74 696d 650a 2020 2020 2320 5661 6c69  _time.    # Vali
+0001d370: 6461 7465 2027 496e 7369 6465 2042 6172  date 'Inside Bar
+0001d380: 2720 7374 7275 6374 7572 6520 666f 7220  ' structure for 
+0001d390: 7265 6365 6e74 2064 6179 730a 2020 2020  recent days.    
+0001d3a0: 6465 6620 7661 6c69 6461 7465 496e 7369  def validateInsi
+0001d3b0: 6465 4261 7228 0a20 2020 2020 2020 2073  deBar(.        s
+0001d3c0: 656c 662c 2064 662c 2073 6372 6565 6e44  elf, df, screenD
+0001d3d0: 6963 742c 2073 6176 6544 6963 742c 2063  ict, saveDict, c
+0001d3e0: 6861 7274 5061 7474 6572 6e3d 312c 2064  hartPattern=1, d
+0001d3f0: 6179 7354 6f4c 6f6f 6b62 6163 6b3d 350a  aysToLookback=5.
+0001d400: 2020 2020 293a 0a20 2020 2020 2020 2069      ):.        i
+0001d410: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
+0001d420: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
+0001d430: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001d440: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
+0001d450: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
+0001d460: 2020 2020 2020 2020 6f72 6744 6174 6120          orgData 
+0001d470: 3d20 6461 7461 0a20 2020 2020 2020 2073  = data.        s
+0001d480: 6176 6564 203d 2073 656c 662e 6669 6e64  aved = self.find
+0001d490: 4375 7272 656e 7453 6176 6564 5661 6c75  CurrentSavedValu
+0001d4a0: 6528 7363 7265 656e 4469 6374 2c20 7361  e(screenDict, sa
+0001d4b0: 7665 4469 6374 2c20 2250 6174 7465 726e  veDict, "Pattern
+0001d4c0: 2229 0a20 2020 2020 2020 2066 6f72 2069  ").        for i
+0001d4d0: 2069 6e20 7261 6e67 6528 696e 7428 6461   in range(int(da
+0001d4e0: 7973 546f 4c6f 6f6b 6261 636b 292c 2069  ysToLookback), i
+0001d4f0: 6e74 2872 6f75 6e64 2864 6179 7354 6f4c  nt(round(daysToL
+0001d500: 6f6f 6b62 6163 6b20 2a20 302e 3529 2920  ookback * 0.5)) 
+0001d510: 2d20 312c 202d 3129 3a0a 2020 2020 2020  - 1, -1):.      
+0001d520: 2020 2020 2020 6966 2069 203d 3d20 323a        if i == 2:
+0001d530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d540: 2072 6574 7572 6e20 3020 2023 2045 7869   return 0  # Exi
+0001d550: 7420 6966 206f 6e6c 7920 6c61 7374 2032  t if only last 2
+0001d560: 2063 616e 646c 6573 2061 7265 206c 6566   candles are lef
+0001d570: 740a 2020 2020 2020 2020 2020 2020 6966  t.            if
+0001d580: 2063 6861 7274 5061 7474 6572 6e20 3d3d   chartPattern ==
+0001d590: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0001d5a0: 2020 2020 6966 2022 5570 2220 696e 2073      if "Up" in s
+0001d5b0: 6176 6544 6963 745b 2254 7265 6e64 225d  aveDict["Trend"]
+0001d5c0: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
+0001d5d0: 2020 2020 2020 2020 2020 2022 4275 6c6c             "Bull
+0001d5e0: 2220 696e 2073 6176 6544 6963 745b 224d  " in saveDict["M
+0001d5f0: 412d 5369 676e 616c 225d 0a20 2020 2020  A-Signal"].     
+0001d600: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0001d610: 7220 2253 7570 706f 7274 2220 696e 2073  r "Support" in s
+0001d620: 6176 6544 6963 745b 224d 412d 5369 676e  aveDict["MA-Sign
+0001d630: 616c 225d 0a20 2020 2020 2020 2020 2020  al"].           
+0001d640: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+0001d650: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0001d660: 203d 206f 7267 4461 7461 2e68 6561 6428   = orgData.head(
+0001d670: 6929 0a20 2020 2020 2020 2020 2020 2020  i).             
+0001d680: 2020 2020 2020 2072 6566 4361 6e64 6c65         refCandle
+0001d690: 203d 2064 6174 612e 7461 696c 2831 290a   = data.tail(1).
 0001d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6b0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-0001d6c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001d6d0: 6372 6565 6e44 6963 745b 2250 6174 7465  creenDict["Patte
-0001d6e0: 726e 225d 203d 2028 0a20 2020 2020 2020  rn"] = (.       
-0001d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d700: 2020 2020 2073 6176 6564 5b30 5d0a 2020       saved[0].  
+0001d6b0: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+0001d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6d0: 2028 6c65 6e28 6461 7461 2e48 6967 685b   (len(data.High[
+0001d6e0: 6461 7461 2e48 6967 6820 3e20 7265 6643  data.High > refC
+0001d6f0: 616e 646c 652e 4869 6768 2e69 7465 6d28  andle.High.item(
+0001d700: 295d 2920 3d3d 2030 290a 2020 2020 2020  )]) == 0).      
 0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d720: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0001d730: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
-0001d740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d750: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-0001d760: 7874 2e57 4152 4e0a 2020 2020 2020 2020  xt.WARN.        
-0001d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d780: 2020 2020 2b20 2822 496e 7369 6465 2042      + ("Inside B
-0001d790: 6172 2028 2564 2922 2025 2069 290a 2020  ar (%d)" % i).  
-0001d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7b0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0001d7c0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-0001d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7e0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0001d7f0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-0001d800: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
-0001d810: 3d20 7361 7665 645b 315d 202b 2022 496e  = saved[1] + "In
-0001d820: 7369 6465 2042 6172 2028 2564 2922 2025  side Bar (%d)" %
-0001d830: 2069 0a20 2020 2020 2020 2020 2020 2020   i.             
-0001d840: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001d850: 6e20 690a 2020 2020 2020 2020 2020 2020  n i.            
-0001d860: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001d870: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001d880: 7475 726e 2030 0a20 2020 2020 2020 2020  turn 0.         
-0001d890: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001d8a0: 2020 2020 2020 2020 2069 6620 2244 6f77           if "Dow
-0001d8b0: 6e22 2069 6e20 7361 7665 4469 6374 5b22  n" in saveDict["
-0001d8c0: 5472 656e 6422 5d20 616e 6420 280a 2020  Trend"] and (.  
+0001d720: 2020 616e 6420 286c 656e 2864 6174 612e    and (len(data.
+0001d730: 4c6f 775b 6461 7461 2e4c 6f77 203c 2072  Low[data.Low < r
+0001d740: 6566 4361 6e64 6c65 2e4c 6f77 2e69 7465  efCandle.Low.ite
+0001d750: 6d28 295d 2920 3d3d 2030 290a 2020 2020  m()]) == 0).    
+0001d760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d770: 2020 2020 616e 6420 286c 656e 2864 6174      and (len(dat
+0001d780: 612e 4f70 656e 5b64 6174 612e 4f70 656e  a.Open[data.Open
+0001d790: 203e 2072 6566 4361 6e64 6c65 2e48 6967   > refCandle.Hig
+0001d7a0: 682e 6974 656d 2829 5d29 203d 3d20 3029  h.item()]) == 0)
+0001d7b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d7c0: 2020 2020 2020 2020 2061 6e64 2028 6c65           and (le
+0001d7d0: 6e28 6461 7461 2e43 6c6f 7365 5b64 6174  n(data.Close[dat
+0001d7e0: 612e 436c 6f73 6520 3c20 7265 6643 616e  a.Close < refCan
+0001d7f0: 646c 652e 4c6f 772e 6974 656d 2829 5d29  dle.Low.item()])
+0001d800: 203d 3d20 3029 0a20 2020 2020 2020 2020   == 0).         
+0001d810: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
+0001d820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d830: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+0001d840: 5b22 5061 7474 6572 6e22 5d20 3d20 280a  ["Pattern"] = (.
+0001d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d860: 2020 2020 2020 2020 2020 2020 7361 7665              save
+0001d870: 645b 305d 0a20 2020 2020 2020 2020 2020  d[0].           
+0001d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d890: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
+0001d8a0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0001d8b0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0001d8c0: 636f 6c6f 7254 6578 742e 5741 524e 0a20  colorText.WARN. 
 0001d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8e0: 2020 2242 6561 7222 2069 6e20 7361 7665    "Bear" in save
-0001d8f0: 4469 6374 5b22 4d41 2d53 6967 6e61 6c22  Dict["MA-Signal"
-0001d900: 5d20 6f72 2022 5265 7369 7374 2220 696e  ] or "Resist" in
-0001d910: 2073 6176 6544 6963 745b 224d 412d 5369   saveDict["MA-Si
-0001d920: 676e 616c 225d 0a20 2020 2020 2020 2020  gnal"].         
-0001d930: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0001d940: 2020 2020 2020 2020 2020 2020 2020 6461                da
-0001d950: 7461 203d 206f 7267 4461 7461 2e68 6561  ta = orgData.hea
-0001d960: 6428 6929 0a20 2020 2020 2020 2020 2020  d(i).           
-0001d970: 2020 2020 2020 2020 2072 6566 4361 6e64           refCand
-0001d980: 6c65 203d 2064 6174 612e 7461 696c 2831  le = data.tail(1
-0001d990: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d9a0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-0001d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9c0: 2020 2028 6c65 6e28 6461 7461 2e48 6967     (len(data.Hig
-0001d9d0: 685b 6461 7461 2e48 6967 6820 3e20 7265  h[data.High > re
-0001d9e0: 6643 616e 646c 652e 4869 6768 2e69 7465  fCandle.High.ite
-0001d9f0: 6d28 295d 2920 3d3d 2030 290a 2020 2020  m()]) == 0).    
+0001d8e0: 2020 2020 2020 2020 2020 202b 2028 2249             + ("I
+0001d8f0: 6e73 6964 6520 4261 7220 2825 6429 2220  nside Bar (%d)" 
+0001d900: 2520 6929 0a20 2020 2020 2020 2020 2020  % i).           
+0001d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d920: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0001d930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d940: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d960: 2020 2073 6176 6544 6963 745b 2250 6174     saveDict["Pat
+0001d970: 7465 726e 225d 203d 2073 6176 6564 5b31  tern"] = saved[1
+0001d980: 5d20 2b20 2249 6e73 6964 6520 4261 7220  ] + "Inside Bar 
+0001d990: 2825 6429 2220 2520 690a 2020 2020 2020  (%d)" % i.      
+0001d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9b0: 2020 7265 7475 726e 2069 0a20 2020 2020    return i.     
+0001d9c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001d9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d9e0: 2020 2020 2072 6574 7572 6e20 300a 2020       return 0.  
+0001d9f0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
 0001da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da10: 2020 2020 616e 6420 286c 656e 2864 6174      and (len(dat
-0001da20: 612e 4c6f 775b 6461 7461 2e4c 6f77 203c  a.Low[data.Low <
-0001da30: 2072 6566 4361 6e64 6c65 2e4c 6f77 2e69   refCandle.Low.i
-0001da40: 7465 6d28 295d 2920 3d3d 2030 290a 2020  tem()]) == 0).  
-0001da50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da60: 2020 2020 2020 616e 6420 286c 656e 2864        and (len(d
-0001da70: 6174 612e 4f70 656e 5b64 6174 612e 4f70  ata.Open[data.Op
-0001da80: 656e 203e 2072 6566 4361 6e64 6c65 2e48  en > refCandle.H
-0001da90: 6967 682e 6974 656d 2829 5d29 203d 3d20  igh.item()]) == 
-0001daa0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-0001dab0: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-0001dac0: 6c65 6e28 6461 7461 2e43 6c6f 7365 5b64  len(data.Close[d
-0001dad0: 6174 612e 436c 6f73 6520 3c20 7265 6643  ata.Close < refC
-0001dae0: 616e 646c 652e 4c6f 772e 6974 656d 2829  andle.Low.item()
-0001daf0: 5d29 203d 3d20 3029 0a20 2020 2020 2020  ]) == 0).       
-0001db00: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-0001db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db20: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-0001db30: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
-0001db40: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001db50: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-0001db60: 7665 645b 305d 0a20 2020 2020 2020 2020  ved[0].         
-0001db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db80: 2020 202b 2063 6f6c 6f72 5465 7874 2e42     + colorText.B
-0001db90: 4f4c 440a 2020 2020 2020 2020 2020 2020  OLD.            
-0001dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbb0: 2b20 636f 6c6f 7254 6578 742e 5741 524e  + colorText.WARN
-0001dbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dbd0: 2020 2020 2020 2020 2020 2020 202b 2028               + (
-0001dbe0: 2249 6e73 6964 6520 4261 7220 2825 6429  "Inside Bar (%d)
-0001dbf0: 2220 2520 6929 0a20 2020 2020 2020 2020  " % i).         
-0001dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc10: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
-0001dc20: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
-0001dc30: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc50: 2020 2020 2073 6176 6544 6963 745b 2250       saveDict["P
-0001dc60: 6174 7465 726e 225d 203d 2073 6176 6564  attern"] = saved
-0001dc70: 5b31 5d20 2b20 2249 6e73 6964 6520 4261  [1] + "Inside Ba
-0001dc80: 7220 2825 6429 2220 2520 690a 2020 2020  r (%d)" % i.    
-0001dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dca0: 2020 2020 7265 7475 726e 2069 0a20 2020      return i.   
-0001dcb0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001dcc0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001dcd0: 2020 2020 2020 2072 6574 7572 6e20 300a         return 0.
-0001dce0: 2020 2020 2020 2020 7265 7475 726e 2030          return 0
-0001dcf0: 0a0a 2020 2020 2320 4669 6e64 2049 504f  ..    # Find IPO
-0001dd00: 2062 6173 650a 2020 2020 6465 6620 7661   base.    def va
-0001dd10: 6c69 6461 7465 4970 6f42 6173 6528 7365  lidateIpoBase(se
-0001dd20: 6c66 2c20 7374 6f63 6b2c 2064 662c 2073  lf, stock, df, s
-0001dd30: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
-0001dd40: 6963 742c 2070 6572 6365 6e74 6167 653d  ict, percentage=
-0001dd50: 302e 3329 3a0a 2020 2020 2020 2020 6966  0.3):.        if
-0001dd60: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
-0001dd70: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
-0001dd80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001dd90: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
-0001dda0: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
-0001ddb0: 2020 2020 2020 206c 6973 7469 6e67 5072         listingPr
-0001ddc0: 6963 6520 3d20 6461 7461 5b3a 3a2d 315d  ice = data[::-1]
-0001ddd0: 2e68 6561 6428 3129 5b22 4f70 656e 225d  .head(1)["Open"]
-0001dde0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
-0001ddf0: 2063 7572 7265 6e74 5072 6963 6520 3d20   currentPrice = 
-0001de00: 6461 7461 2e68 6561 6428 3129 5b22 436c  data.head(1)["Cl
-0001de10: 6f73 6522 5d2e 696c 6f63 5b30 5d0a 2020  ose"].iloc[0].  
-0001de20: 2020 2020 2020 4154 4820 3d20 6461 7461        ATH = data
-0001de30: 2e64 6573 6372 6962 6528 295b 2248 6967  .describe()["Hig
-0001de40: 6822 5d5b 226d 6178 225d 0a20 2020 2020  h"]["max"].     
-0001de50: 2020 2069 6620 4154 4820 3e20 286c 6973     if ATH > (lis
-0001de60: 7469 6e67 5072 6963 6520 2b20 286c 6973  tingPrice + (lis
-0001de70: 7469 6e67 5072 6963 6520 2a20 7065 7263  tingPrice * perc
-0001de80: 656e 7461 6765 2929 3a0a 2020 2020 2020  entage)):.      
-0001de90: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0001dea0: 7365 0a20 2020 2020 2020 2061 7761 7920  se.        away 
-0001deb0: 3d20 726f 756e 6428 2828 6375 7272 656e  = round(((curren
-0001dec0: 7450 7269 6365 202d 206c 6973 7469 6e67  tPrice - listing
-0001ded0: 5072 6963 6529 202f 206c 6973 7469 6e67  Price) / listing
-0001dee0: 5072 6963 6529 202a 2031 3030 2c20 3129  Price) * 100, 1)
-0001def0: 0a20 2020 2020 2020 2069 6620 280a 2020  .        if (.  
-0001df00: 2020 2020 2020 2020 2020 286c 6973 7469            (listi
-0001df10: 6e67 5072 6963 6520 2d20 286c 6973 7469  ngPrice - (listi
-0001df20: 6e67 5072 6963 6520 2a20 7065 7263 656e  ngPrice * percen
-0001df30: 7461 6765 2929 0a20 2020 2020 2020 2020  tage)).         
-0001df40: 2020 203c 3d20 6375 7272 656e 7450 7269     <= currentPri
-0001df50: 6365 0a20 2020 2020 2020 2020 2020 203c  ce.            <
-0001df60: 3d20 286c 6973 7469 6e67 5072 6963 6520  = (listingPrice 
-0001df70: 2b20 286c 6973 7469 6e67 5072 6963 6520  + (listingPrice 
-0001df80: 2a20 7065 7263 656e 7461 6765 2929 0a20  * percentage)). 
-0001df90: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0001dfa0: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
-0001dfb0: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
-0001dfc0: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
-0001dfd0: 6963 742c 2073 6176 6544 6963 742c 2022  ict, saveDict, "
-0001dfe0: 5061 7474 6572 6e22 290a 2020 2020 2020  Pattern").      
-0001dff0: 2020 2020 2020 6966 2061 7761 7920 3e20        if away > 
-0001e000: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0001e010: 2020 2073 6372 6565 6e44 6963 745b 2250     screenDict["P
-0001e020: 6174 7465 726e 225d 203d 2028 0a20 2020  attern"] = (.   
-0001e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e040: 2073 6176 6564 5b30 5d20 0a20 2020 2020   saved[0] .     
-0001e050: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001e060: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
-0001e070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e080: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-0001e090: 4752 4545 4e0a 2020 2020 2020 2020 2020  GREEN.          
-0001e0a0: 2020 2020 2020 2020 2020 2b20 6622 4950            + f"IP
-0001e0b0: 4f20 4261 7365 2028 7b61 7761 797d 2025  O Base ({away} %
-0001e0c0: 2922 0a20 2020 2020 2020 2020 2020 2020  )".             
-0001e0d0: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-0001e0e0: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-0001e0f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001e100: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001e110: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0001e120: 6e44 6963 745b 2250 6174 7465 726e 225d  nDict["Pattern"]
-0001e130: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-0001e140: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
-0001e150: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001e160: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-0001e170: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
-0001e180: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
-0001e190: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
-0001e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1b0: 202b 2022 4950 4f20 4261 7365 2022 0a20   + "IPO Base ". 
-0001e1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1d0: 2020 202b 2063 6f6c 6f72 5465 7874 2e46     + colorText.F
-0001e1e0: 4149 4c0a 2020 2020 2020 2020 2020 2020  AIL.            
-0001e1f0: 2020 2020 2020 2020 2b20 6622 287b 6177          + f"({aw
-0001e200: 6179 7d20 2529 220a 2020 2020 2020 2020  ay} %)".        
-0001e210: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
-0001e220: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
-0001e230: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001e240: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
-0001e250: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
-0001e260: 7361 7665 645b 315d 202b 2066 2249 504f  saved[1] + f"IPO
-0001e270: 2042 6173 6520 287b 6177 6179 7d20 2529   Base ({away} %)
-0001e280: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
-0001e290: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0001e2a0: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-0001e2b0: 2020 2020 2340 6d65 6173 7572 655f 7469      #@measure_ti
-0001e2c0: 6d65 0a20 2020 2023 2056 616c 6964 6174  me.    # Validat
-0001e2d0: 6520 4c6f 7265 6e74 7a69 616e 2043 6c61  e Lorentzian Cla
-0001e2e0: 7373 6966 6963 6174 696f 6e20 7369 676e  ssification sign
-0001e2f0: 616c 0a20 2020 2064 6566 2076 616c 6964  al.    def valid
-0001e300: 6174 654c 6f72 656e 747a 6961 6e28 7365  ateLorentzian(se
-0001e310: 6c66 2c20 6466 2c20 7363 7265 656e 4469  lf, df, screenDi
-0001e320: 6374 2c20 7361 7665 4469 6374 2c20 6c6f  ct, saveDict, lo
-0001e330: 6f6b 466f 723d 3329 3a0a 2020 2020 2020  okFor=3):.      
-0001e340: 2020 6966 2064 6620 6973 204e 6f6e 6520    if df is None 
-0001e350: 6f72 206c 656e 2864 6629 203d 3d20 303a  or len(df) == 0:
-0001e360: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001e370: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0001e380: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-0001e390: 2829 0a20 2020 2020 2020 2023 206c 6f6f  ().        # loo
-0001e3a0: 6b46 6f72 3a20 312d 4275 792c 2032 2d53  kFor: 1-Buy, 2-S
-0001e3b0: 656c 6c2c 2033 2d41 6e79 0a20 2020 2020  ell, 3-Any.     
-0001e3c0: 2020 2064 6174 6120 3d20 6461 7461 5b3a     data = data[:
-0001e3d0: 3a2d 315d 2020 2320 5265 7665 7273 6520  :-1]  # Reverse 
-0001e3e0: 7468 6520 6461 7461 6672 616d 650a 2020  the dataframe.  
-0001e3f0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-0001e400: 612e 7265 6e61 6d65 280a 2020 2020 2020  a.rename(.      
-0001e410: 2020 2020 2020 636f 6c75 6d6e 733d 7b0a        columns={.
-0001e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e430: 224f 7065 6e22 3a20 226f 7065 6e22 2c0a  "Open": "open",.
-0001e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e450: 2243 6c6f 7365 223a 2022 636c 6f73 6522  "Close": "close"
-0001e460: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001e470: 2020 2248 6967 6822 3a20 2268 6967 6822    "High": "high"
-0001e480: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001e490: 2020 224c 6f77 223a 2022 6c6f 7722 2c0a    "Low": "low",.
-0001e4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4b0: 2256 6f6c 756d 6522 3a20 2276 6f6c 756d  "Volume": "volum
-0001e4c0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-0001e4d0: 7d0a 2020 2020 2020 2020 290a 2020 2020  }.        ).    
-0001e4e0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0001e4f0: 2020 2020 2077 6974 6820 5375 7070 7265       with Suppre
-0001e500: 7373 4f75 7470 7574 2873 7570 7072 6573  ssOutput(suppres
-0001e510: 735f 7374 646f 7574 3d54 7275 652c 2073  s_stdout=True, s
-0001e520: 7570 7072 6573 735f 7374 6465 7272 3d54  uppress_stderr=T
-0001e530: 7275 6529 3a0a 2020 2020 2020 2020 2020  rue):.          
-0001e540: 2020 2020 2020 6c63 203d 2061 7461 2e4c        lc = ata.L
-0001e550: 6f72 656e 747a 6961 6e43 6c61 7373 6966  orentzianClassif
-0001e560: 6963 6174 696f 6e28 6461 7461 3d64 6174  ication(data=dat
-0001e570: 6129 0a20 2020 2020 2020 2020 2020 2073  a).            s
-0001e580: 6176 6564 203d 2073 656c 662e 6669 6e64  aved = self.find
-0001e590: 4375 7272 656e 7453 6176 6564 5661 6c75  CurrentSavedValu
-0001e5a0: 6528 7363 7265 656e 4469 6374 2c20 7361  e(screenDict, sa
-0001e5b0: 7665 4469 6374 2c20 2250 6174 7465 726e  veDict, "Pattern
-0001e5c0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-0001e5d0: 6620 6c63 2e64 662e 696c 6f63 5b2d 315d  f lc.df.iloc[-1]
-0001e5e0: 5b22 6973 4e65 7742 7579 5369 676e 616c  ["isNewBuySignal
-0001e5f0: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-0001e600: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
-0001e610: 5061 7474 6572 6e22 5d20 3d20 280a 2020  Pattern"] = (.  
-0001e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e630: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
-0001e640: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-0001e650: 6c6f 7254 6578 742e 4752 4545 4e20 2b20  lorText.GREEN + 
-0001e660: 224c 6f72 656e 747a 6961 6e2d 4275 7922  "Lorentzian-Buy"
-0001e670: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-0001e680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e690: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0001e6a0: 2020 2073 6176 6544 6963 745b 2250 6174     saveDict["Pat
-0001e6b0: 7465 726e 225d 203d 2073 6176 6564 5b31  tern"] = saved[1
-0001e6c0: 5d20 2b20 224c 6f72 656e 747a 6961 6e2d  ] + "Lorentzian-
-0001e6d0: 4275 7922 0a20 2020 2020 2020 2020 2020  Buy".           
-0001e6e0: 2020 2020 2069 6620 6c6f 6f6b 466f 7220       if lookFor 
-0001e6f0: 213d 2032 3a20 2320 4e6f 7420 5365 6c6c  != 2: # Not Sell
-0001e700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e710: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-0001e720: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0001e730: 6620 6c63 2e64 662e 696c 6f63 5b2d 315d  f lc.df.iloc[-1]
-0001e740: 5b22 6973 4e65 7753 656c 6c53 6967 6e61  ["isNewSellSigna
-0001e750: 6c22 5d3a 0a20 2020 2020 2020 2020 2020  l"]:.           
-0001e760: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-0001e770: 2250 6174 7465 726e 225d 203d 2028 0a20  "Pattern"] = (. 
-0001e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e790: 2020 2073 6176 6564 5b30 5d20 2b20 636f     saved[0] + co
-0001e7a0: 6c6f 7254 6578 742e 424f 4c44 202b 2063  lorText.BOLD + c
-0001e7b0: 6f6c 6f72 5465 7874 2e46 4149 4c20 2b20  olorText.FAIL + 
-0001e7c0: 224c 6f72 656e 747a 6961 6e2d 5365 6c6c  "Lorentzian-Sell
-0001e7d0: 2220 2b20 636f 6c6f 7254 6578 742e 454e  " + colorText.EN
-0001e7e0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-0001e7f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0001e800: 2020 2020 7361 7665 4469 6374 5b22 5061      saveDict["Pa
-0001e810: 7474 6572 6e22 5d20 3d20 7361 7665 645b  ttern"] = saved[
-0001e820: 315d 202b 2022 4c6f 7265 6e74 7a69 616e  1] + "Lorentzian
-0001e830: 2d53 656c 6c22 0a20 2020 2020 2020 2020  -Sell".         
-0001e840: 2020 2020 2020 2069 6620 6c6f 6f6b 466f         if lookFo
-0001e850: 7220 213d 2031 3a20 2320 4e6f 7420 4275  r != 1: # Not Bu
-0001e860: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-0001e870: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-0001e880: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0001e890: 2045 7863 6570 7469 6f6e 3a20 2023 2070   Exception:  # p
-0001e8a0: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
-0001e8b0: 2020 2020 2020 2020 2020 2020 2320 5661              # Va
-0001e8c0: 6c75 6545 7272 6f72 3a20 6f70 6572 616e  lueError: operan
-0001e8d0: 6473 2063 6f75 6c64 206e 6f74 2062 6520  ds could not be 
-0001e8e0: 6272 6f61 6463 6173 7420 746f 6765 7468  broadcast togeth
-0001e8f0: 6572 2077 6974 6820 7368 6170 6573 2028  er with shapes (
-0001e900: 3230 2c29 2028 3236 2c29 0a20 2020 2020  20,) (26,).     
-0001e910: 2020 2020 2020 2023 2046 696c 6520 222f         # File "/
-0001e920: 6f70 742f 686f 6d65 6272 6577 2f6c 6962  opt/homebrew/lib
-0001e930: 2f70 7974 686f 6e33 2e31 312f 7369 7465  /python3.11/site
-0001e940: 2d70 6163 6b61 6765 732f 6164 7661 6e63  -packages/advanc
-0001e950: 6564 5f74 612f 4c6f 7265 6e74 7a69 616e  ed_ta/Lorentzian
-0001e960: 436c 6173 7369 6669 6361 7469 6f6e 2f43  Classification/C
-0001e970: 6c61 7373 6966 6965 722e 7079 222c 206c  lassifier.py", l
-0001e980: 696e 6520 3138 362c 2069 6e20 5f5f 696e  ine 186, in __in
-0001e990: 6974 5f5f 0a20 2020 2020 2020 2020 2020  it__.           
-0001e9a0: 2023 2046 696c 6520 222f 6f70 742f 686f   # File "/opt/ho
-0001e9b0: 6d65 6272 6577 2f6c 6962 2f70 7974 686f  mebrew/lib/pytho
-0001e9c0: 6e33 2e31 312f 7369 7465 2d70 6163 6b61  n3.11/site-packa
-0001e9d0: 6765 732f 6164 7661 6e63 6564 5f74 612f  ges/advanced_ta/
-0001e9e0: 4c6f 7265 6e74 7a69 616e 436c 6173 7369  LorentzianClassi
-0001e9f0: 6669 6361 7469 6f6e 2f43 6c61 7373 6966  fication/Classif
-0001ea00: 6965 722e 7079 222c 206c 696e 6520 3339  ier.py", line 39
-0001ea10: 352c 2069 6e20 5f5f 636c 6173 7369 6679  5, in __classify
-0001ea20: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
-0001ea30: 696c 6520 222f 6f70 742f 686f 6d65 6272  ile "/opt/homebr
-0001ea40: 6577 2f6c 6962 2f70 7974 686f 6e33 2e31  ew/lib/python3.1
-0001ea50: 312f 7369 7465 2d70 6163 6b61 6765 732f  1/site-packages/
-0001ea60: 7061 6e64 6173 2f63 6f72 652f 6f70 732f  pandas/core/ops/
-0001ea70: 636f 6d6d 6f6e 2e70 7922 2c20 6c69 6e65  common.py", line
-0001ea80: 2037 362c 2069 6e20 6e65 775f 6d65 7468   76, in new_meth
-0001ea90: 6f64 0a20 2020 2020 2020 2020 2020 2023  od.            #
-0001eaa0: 2046 696c 6520 222f 6f70 742f 686f 6d65   File "/opt/home
-0001eab0: 6272 6577 2f6c 6962 2f70 7974 686f 6e33  brew/lib/python3
-0001eac0: 2e31 312f 7369 7465 2d70 6163 6b61 6765  .11/site-package
-0001ead0: 732f 7061 6e64 6173 2f63 6f72 652f 6172  s/pandas/core/ar
-0001eae0: 7261 796c 696b 652e 7079 222c 206c 696e  raylike.py", lin
-0001eaf0: 6520 3730 2c20 696e 205f 5f61 6e64 5f5f  e 70, in __and__
-0001eb00: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
-0001eb10: 696c 6520 222f 6f70 742f 686f 6d65 6272  ile "/opt/homebr
-0001eb20: 6577 2f6c 6962 2f70 7974 686f 6e33 2e31  ew/lib/python3.1
-0001eb30: 312f 7369 7465 2d70 6163 6b61 6765 732f  1/site-packages/
-0001eb40: 7061 6e64 6173 2f63 6f72 652f 7365 7269  pandas/core/seri
-0001eb50: 6573 2e70 7922 2c20 6c69 6e65 2035 3831  es.py", line 581
-0001eb60: 302c 2069 6e20 5f6c 6f67 6963 616c 5f6d  0, in _logical_m
-0001eb70: 6574 686f 640a 2020 2020 2020 2020 2020  ethod.          
-0001eb80: 2020 2320 4669 6c65 2022 2f6f 7074 2f68    # File "/opt/h
-0001eb90: 6f6d 6562 7265 772f 6c69 622f 7079 7468  omebrew/lib/pyth
-0001eba0: 6f6e 332e 3131 2f73 6974 652d 7061 636b  on3.11/site-pack
-0001ebb0: 6167 6573 2f70 616e 6461 732f 636f 7265  ages/pandas/core
-0001ebc0: 2f6f 7073 2f61 7272 6179 5f6f 7073 2e70  /ops/array_ops.p
-0001ebd0: 7922 2c20 6c69 6e65 2034 3536 2c20 696e  y", line 456, in
-0001ebe0: 206c 6f67 6963 616c 5f6f 700a 2020 2020   logical_op.    
-0001ebf0: 2020 2020 2020 2020 2320 4669 6c65 2022          # File "
-0001ec00: 2f6f 7074 2f68 6f6d 6562 7265 772f 6c69  /opt/homebrew/li
-0001ec10: 622f 7079 7468 6f6e 332e 3131 2f73 6974  b/python3.11/sit
-0001ec20: 652d 7061 636b 6167 6573 2f70 616e 6461  e-packages/panda
-0001ec30: 732f 636f 7265 2f6f 7073 2f61 7272 6179  s/core/ops/array
-0001ec40: 5f6f 7073 2e70 7922 2c20 6c69 6e65 2033  _ops.py", line 3
-0001ec50: 3634 2c20 696e 206e 615f 6c6f 6769 6361  64, in na_logica
-0001ec60: 6c5f 6f70 0a20 2020 2020 2020 2020 2020  l_op.           
-0001ec70: 2023 2073 656c 662e 6465 6661 756c 745f   # self.default_
-0001ec80: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
-0001ec90: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
-0001eca0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-0001ecb0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0001ecc0: 616c 7365 0a0a 2020 2020 2320 7661 6c69  alse..    # vali
-0001ecd0: 6461 7465 2069 6620 7468 6520 7374 6f63  date if the stoc
-0001ece0: 6b20 6861 7320 6265 656e 2068 6176 696e  k has been havin
-0001ecf0: 6720 6c6f 7765 7220 6c6f 7773 2c20 6c6f  g lower lows, lo
-0001ed00: 7765 7220 6869 6768 730a 2020 2020 6465  wer highs.    de
-0001ed10: 6620 7661 6c69 6461 7465 4c6f 7765 7248  f validateLowerH
-0001ed20: 6967 6873 4c6f 7765 724c 6f77 7328 7365  ighsLowerLows(se
-0001ed30: 6c66 2c20 6466 293a 0a20 2020 2020 2020  lf, df):.       
-0001ed40: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
-0001ed50: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
-0001ed60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001ed70: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0001ed80: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
-0001ed90: 290a 2020 2020 2020 2020 6461 7930 203d  ).        day0 =
-0001eda0: 2064 6174 610a 2020 2020 2020 2020 6461   data.        da
-0001edb0: 7931 203d 2064 6174 615b 313a 5d0a 2020  y1 = data[1:].  
-0001edc0: 2020 2020 2020 6461 7932 203d 2064 6174        day2 = dat
-0001edd0: 615b 323a 5d0a 2020 2020 2020 2020 6461  a[2:].        da
-0001ede0: 7933 203d 2064 6174 615b 333a 5d0a 2020  y3 = data[3:].  
-0001edf0: 2020 2020 2020 6c6f 7765 7248 6967 6873        lowerHighs
-0001ee00: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-0001ee10: 2028 6461 7930 5b22 4869 6768 225d 2e69   (day0["High"].i
-0001ee20: 6c6f 635b 305d 203c 2064 6179 315b 2248  loc[0] < day1["H
-0001ee30: 6967 6822 5d2e 696c 6f63 5b30 5d29 0a20  igh"].iloc[0]). 
-0001ee40: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-0001ee50: 6461 7931 5b22 4869 6768 225d 2e69 6c6f  day1["High"].ilo
-0001ee60: 635b 305d 203c 2064 6179 325b 2248 6967  c[0] < day2["Hig
-0001ee70: 6822 5d2e 696c 6f63 5b30 5d29 0a20 2020  h"].iloc[0]).   
-0001ee80: 2020 2020 2020 2020 2061 6e64 2028 6461           and (da
-0001ee90: 7932 5b22 4869 6768 225d 2e69 6c6f 635b  y2["High"].iloc[
-0001eea0: 305d 203c 2064 6179 335b 2248 6967 6822  0] < day3["High"
-0001eeb0: 5d2e 696c 6f63 5b30 5d29 0a20 2020 2020  ].iloc[0]).     
-0001eec0: 2020 2029 0a20 2020 2020 2020 206c 6f77     ).        low
-0001eed0: 6572 4c6f 7773 203d 2028 0a20 2020 2020  erLows = (.     
-0001eee0: 2020 2020 2020 2028 6461 7930 5b22 4c6f         (day0["Lo
-0001eef0: 7722 5d2e 696c 6f63 5b30 5d20 3c20 6461  w"].iloc[0] < da
-0001ef00: 7931 5b22 4c6f 7722 5d2e 696c 6f63 5b30  y1["Low"].iloc[0
-0001ef10: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
-0001ef20: 6e64 2028 6461 7931 5b22 4c6f 7722 5d2e  nd (day1["Low"].
-0001ef30: 696c 6f63 5b30 5d20 3c20 6461 7932 5b22  iloc[0] < day2["
-0001ef40: 4c6f 7722 5d2e 696c 6f63 5b30 5d29 0a20  Low"].iloc[0]). 
-0001ef50: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-0001ef60: 6461 7932 5b22 4c6f 7722 5d2e 696c 6f63  day2["Low"].iloc
-0001ef70: 5b30 5d20 3c20 6461 7933 5b22 4c6f 7722  [0] < day3["Low"
-0001ef80: 5d2e 696c 6f63 5b30 5d29 0a20 2020 2020  ].iloc[0]).     
-0001ef90: 2020 2029 0a20 2020 2020 2020 2068 6967     ).        hig
-0001efa0: 6865 7252 5349 203d 2028 0a20 2020 2020  herRSI = (.     
-0001efb0: 2020 2020 2020 2028 6461 7930 5b22 5253         (day0["RS
-0001efc0: 4922 5d2e 696c 6f63 5b30 5d20 3c20 6461  I"].iloc[0] < da
-0001efd0: 7931 5b22 5253 4922 5d2e 696c 6f63 5b30  y1["RSI"].iloc[0
-0001efe0: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
-0001eff0: 6e64 2028 6461 7931 5b22 5253 4922 5d2e  nd (day1["RSI"].
-0001f000: 696c 6f63 5b30 5d20 3c20 6461 7932 5b22  iloc[0] < day2["
-0001f010: 5253 4922 5d2e 696c 6f63 5b30 5d29 0a20  RSI"].iloc[0]). 
-0001f020: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-0001f030: 6461 7932 5b22 5253 4922 5d2e 696c 6f63  day2["RSI"].iloc
-0001f040: 5b30 5d20 3c20 6461 7933 5b22 5253 4922  [0] < day3["RSI"
-0001f050: 5d2e 696c 6f63 5b30 5d29 0a20 2020 2020  ].iloc[0]).     
-0001f060: 2020 2020 2020 2061 6e64 2064 6179 305b         and day0[
-0001f070: 2252 5349 225d 2e69 6c6f 635b 305d 203e  "RSI"].iloc[0] >
-0001f080: 3d20 3530 0a20 2020 2020 2020 2029 0a20  = 50.        ). 
-0001f090: 2020 2020 2020 2072 6574 7572 6e20 6c6f         return lo
-0001f0a0: 7765 7248 6967 6873 2061 6e64 206c 6f77  werHighs and low
-0001f0b0: 6572 4c6f 7773 2061 6e64 2068 6967 6865  erLows and highe
-0001f0c0: 7252 5349 0a0a 2020 2020 2320 5661 6c69  rRSI..    # Vali
-0001f0d0: 6461 7465 2069 6620 7265 6365 6e74 2076  date if recent v
-0001f0e0: 6f6c 756d 6520 6973 206c 6f77 6573 7420  olume is lowest 
-0001f0f0: 6f66 206c 6173 7420 274e 2720 4461 7973  of last 'N' Days
-0001f100: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
-0001f110: 654c 6f77 6573 7456 6f6c 756d 6528 7365  eLowestVolume(se
-0001f120: 6c66 2c20 6466 2c20 6461 7973 466f 724c  lf, df, daysForL
-0001f130: 6f77 6573 7456 6f6c 756d 6529 3a0a 2020  owestVolume):.  
-0001f140: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
-0001f150: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
-0001f160: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0001f170: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-0001f180: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
-0001f190: 636f 7079 2829 0a20 2020 2020 2020 2064  copy().        d
-0001f1a0: 6174 6120 3d20 6461 7461 2e66 696c 6c6e  ata = data.filln
-0001f1b0: 6128 3029 0a20 2020 2020 2020 2064 6174  a(0).        dat
-0001f1c0: 6120 3d20 6461 7461 2e72 6570 6c61 6365  a = data.replace
-0001f1d0: 285b 6e70 2e69 6e66 2c20 2d6e 702e 696e  ([np.inf, -np.in
-0001f1e0: 665d 2c20 3029 0a20 2020 2020 2020 2069  f], 0).        i
-0001f1f0: 6620 6461 7973 466f 724c 6f77 6573 7456  f daysForLowestV
-0001f200: 6f6c 756d 6520 6973 204e 6f6e 653a 0a20  olume is None:. 
-0001f210: 2020 2020 2020 2020 2020 2064 6179 7346             daysF
-0001f220: 6f72 4c6f 7765 7374 566f 6c75 6d65 203d  orLowestVolume =
-0001f230: 2033 300a 2020 2020 2020 2020 6966 206c   30.        if l
-0001f240: 656e 2864 6174 6129 203c 2064 6179 7346  en(data) < daysF
-0001f250: 6f72 4c6f 7765 7374 566f 6c75 6d65 3a0a  orLowestVolume:.
-0001f260: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001f270: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0001f280: 2064 6174 6120 3d20 6461 7461 2e68 6561   data = data.hea
-0001f290: 6428 6461 7973 466f 724c 6f77 6573 7456  d(daysForLowestV
-0001f2a0: 6f6c 756d 6529 0a20 2020 2020 2020 2072  olume).        r
-0001f2b0: 6563 656e 7420 3d20 6461 7461 2e68 6561  ecent = data.hea
-0001f2c0: 6428 3129 0a20 2020 2020 2020 2069 6620  d(1).        if 
-0001f2d0: 6c65 6e28 7265 6365 6e74 2920 3c20 313a  len(recent) < 1:
-0001f2e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001f2f0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0001f300: 2020 6966 2028 7265 6365 6e74 5b22 566f    if (recent["Vo
-0001f310: 6c75 6d65 225d 2e69 6c6f 635b 305d 203c  lume"].iloc[0] <
-0001f320: 3d20 6461 7461 2e64 6573 6372 6962 6528  = data.describe(
-0001f330: 295b 2256 6f6c 756d 6522 5d5b 226d 696e  )["Volume"]["min
-0001f340: 225d 2920 616e 6420 7265 6365 6e74 5b0a  "]) and recent[.
-0001f350: 2020 2020 2020 2020 2020 2020 2256 6f6c              "Vol
-0001f360: 756d 6522 0a20 2020 2020 2020 205d 5b30  ume".        ][0
-0001f370: 5d20 213d 206e 702e 6e61 6e3a 0a20 2020  ] != np.nan:.   
-0001f380: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001f390: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
-0001f3a0: 7572 6e20 4661 6c73 650a 0a20 2020 2023  urn False..    #
-0001f3b0: 2056 616c 6964 6174 6520 4c54 5020 7769   Validate LTP wi
-0001f3c0: 7468 696e 206c 696d 6974 730a 2020 2020  thin limits.    
-0001f3d0: 6465 6620 7661 6c69 6461 7465 4c54 5028  def validateLTP(
-0001f3e0: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
-0001f3f0: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
-0001f400: 6d69 6e4c 5450 3d4e 6f6e 652c 206d 6178  minLTP=None, max
-0001f410: 4c54 503d 4e6f 6e65 2c6d 696e 4368 616e  LTP=None,minChan
-0001f420: 6765 3d30 293a 0a20 2020 2020 2020 2064  ge=0):.        d
-0001f430: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
-0001f440: 2020 2020 2020 2020 6c74 7056 616c 6964          ltpValid
-0001f450: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0001f460: 2069 6620 6d69 6e4c 5450 2069 7320 4e6f   if minLTP is No
-0001f470: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001f480: 6d69 6e4c 5450 203d 2073 656c 662e 636f  minLTP = self.co
-0001f490: 6e66 6967 4d61 6e61 6765 722e 6d69 6e4c  nfigManager.minL
-0001f4a0: 5450 0a20 2020 2020 2020 2069 6620 6d61  TP.        if ma
-0001f4b0: 784c 5450 2069 7320 4e6f 6e65 3a0a 2020  xLTP is None:.  
-0001f4c0: 2020 2020 2020 2020 2020 6d61 784c 5450            maxLTP
-0001f4d0: 203d 2073 656c 662e 636f 6e66 6967 4d61   = self.configMa
-0001f4e0: 6e61 6765 722e 6d61 784c 5450 0a20 2020  nager.maxLTP.   
-0001f4f0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0001f500: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-0001f510: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-0001f520: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-0001f530: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-0001f540: 2020 2020 2072 6563 656e 7420 3d20 6461       recent = da
-0001f550: 7461 2e68 6561 6428 3129 0a0a 2020 2020  ta.head(1)..    
-0001f560: 2020 2020 7063 745f 6368 616e 6765 203d      pct_change =
-0001f570: 2028 6461 7461 5b3a 3a2d 315d 5b22 436c   (data[::-1]["Cl
-0001f580: 6f73 6522 5d2e 7063 745f 6368 616e 6765  ose"].pct_change
-0001f590: 2829 202a 2031 3030 292e 696c 6f63 5b2d  () * 100).iloc[-
-0001f5a0: 315d 0a20 2020 2020 2020 2069 6620 7063  1].        if pc
-0001f5b0: 745f 6368 616e 6765 203d 3d20 6e70 2e69  t_change == np.i
-0001f5c0: 6e66 206f 7220 7063 745f 6368 616e 6765  nf or pct_change
-0001f5d0: 203d 3d20 2d6e 702e 696e 663a 0a20 2020   == -np.inf:.   
-0001f5e0: 2020 2020 2020 2020 2070 6374 5f63 6861           pct_cha
-0001f5f0: 6e67 6520 3d20 300a 2020 2020 2020 2020  nge = 0.        
-0001f600: 7063 745f 7361 7665 203d 2022 252e 3166  pct_save = "%.1f
-0001f610: 2525 2220 2520 7063 745f 6368 616e 6765  %%" % pct_change
-0001f620: 0a20 2020 2020 2020 2069 6620 7063 745f  .        if pct_
-0001f630: 6368 616e 6765 203e 2030 2e32 3a0a 2020  change > 0.2:.  
-0001f640: 2020 2020 2020 2020 2020 7063 745f 6368            pct_ch
-0001f650: 616e 6765 203d 2063 6f6c 6f72 5465 7874  ange = colorText
-0001f660: 2e47 5245 454e 202b 2028 2225 2e31 6625  .GREEN + ("%.1f%
-0001f670: 2522 2025 2070 6374 5f63 6861 6e67 6529  %" % pct_change)
-0001f680: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-0001f690: 0a20 2020 2020 2020 2065 6c69 6620 7063  .        elif pc
-0001f6a0: 745f 6368 616e 6765 203c 202d 302e 323a  t_change < -0.2:
-0001f6b0: 0a20 2020 2020 2020 2020 2020 2070 6374  .            pct
-0001f6c0: 5f63 6861 6e67 6520 3d20 636f 6c6f 7254  _change = colorT
-0001f6d0: 6578 742e 4641 494c 202b 2028 2225 2e31  ext.FAIL + ("%.1
-0001f6e0: 6625 2522 2025 2070 6374 5f63 6861 6e67  f%%" % pct_chang
-0001f6f0: 6529 202b 2063 6f6c 6f72 5465 7874 2e45  e) + colorText.E
-0001f700: 4e44 0a20 2020 2020 2020 2065 6c73 653a  ND.        else:
-0001f710: 0a20 2020 2020 2020 2020 2020 2070 6374  .            pct
-0001f720: 5f63 6861 6e67 6520 3d20 636f 6c6f 7254  _change = colorT
-0001f730: 6578 742e 5741 524e 202b 2028 2225 2e31  ext.WARN + ("%.1
-0001f740: 6625 2522 2025 2070 6374 5f63 6861 6e67  f%%" % pct_chang
-0001f750: 6529 202b 2063 6f6c 6f72 5465 7874 2e45  e) + colorText.E
-0001f760: 4e44 0a20 2020 2020 2020 2073 6176 6544  ND.        saveD
-0001f770: 6963 745b 2225 4368 6e67 225d 203d 2070  ict["%Chng"] = p
-0001f780: 6374 5f73 6176 650a 2020 2020 2020 2020  ct_save.        
-0001f790: 7363 7265 656e 4469 6374 5b22 2543 686e  screenDict["%Chn
-0001f7a0: 6722 5d20 3d20 7063 745f 6368 616e 6765  g"] = pct_change
-0001f7b0: 0a20 2020 2020 2020 206c 7470 203d 2072  .        ltp = r
-0001f7c0: 6f75 6e64 2872 6563 656e 745b 2243 6c6f  ound(recent["Clo
-0001f7d0: 7365 225d 2e69 6c6f 635b 305d 2c20 3229  se"].iloc[0], 2)
-0001f7e0: 0a20 2020 2020 2020 2076 6572 6966 7953  .        verifyS
-0001f7f0: 7461 6765 5477 6f20 3d20 5472 7565 0a20  tageTwo = True. 
-0001f800: 2020 2020 2020 2069 6620 6c65 6e28 6461         if len(da
-0001f810: 7461 2920 3e20 3235 303a 0a20 2020 2020  ta) > 250:.     
-0001f820: 2020 2020 2020 2079 6561 726c 794c 6f77         yearlyLow
-0001f830: 203d 2064 6174 612e 6865 6164 2832 3530   = data.head(250
-0001f840: 295b 2243 6c6f 7365 225d 2e6d 696e 2829  )["Close"].min()
-0001f850: 0a20 2020 2020 2020 2020 2020 2079 6561  .            yea
-0001f860: 726c 7948 6967 6820 3d20 6461 7461 2e68  rlyHigh = data.h
-0001f870: 6561 6428 3235 3029 5b22 436c 6f73 6522  ead(250)["Close"
-0001f880: 5d2e 6d61 7828 290a 2020 2020 2020 2020  ].max().        
-0001f890: 2020 2020 6966 206c 7470 203c 2028 3220      if ltp < (2 
-0001f8a0: 2a20 7965 6172 6c79 4c6f 7729 2061 6e64  * yearlyLow) and
-0001f8b0: 206c 7470 203c 2028 302e 3735 202a 2079   ltp < (0.75 * y
-0001f8c0: 6561 726c 7948 6967 6829 3a0a 2020 2020  earlyHigh):.    
-0001f8d0: 2020 2020 2020 2020 2020 2020 7665 7269              veri
-0001f8e0: 6679 5374 6167 6554 776f 203d 2046 616c  fyStageTwo = Fal
-0001f8f0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-0001f900: 2020 2073 6372 6565 6e44 6963 745b 2253     screenDict["S
-0001f910: 746f 636b 225d 203d 2063 6f6c 6f72 5465  tock"] = colorTe
-0001f920: 7874 2e46 4149 4c20 2b20 7361 7665 4469  xt.FAIL + saveDi
-0001f930: 6374 5b22 5374 6f63 6b22 5d20 2b20 636f  ct["Stock"] + co
-0001f940: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
-0001f950: 2020 2020 6966 206c 7470 203e 3d20 6d69      if ltp >= mi
-0001f960: 6e4c 5450 2061 6e64 206c 7470 203c 3d20  nLTP and ltp <= 
-0001f970: 6d61 784c 5450 3a0a 2020 2020 2020 2020  maxLTP:.        
-0001f980: 2020 2020 6c74 7056 616c 6964 203d 2054      ltpValid = T
-0001f990: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0001f9a0: 6966 206d 696e 4368 616e 6765 2021 3d20  if minChange != 
-0001f9b0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0001f9c0: 2020 2023 2055 7365 7220 6861 7320 7375     # User has su
-0001f9d0: 7070 6c69 6564 2073 6f6d 6520 6669 6c74  pplied some filt
-0001f9e0: 6572 2066 6f72 2070 6572 6365 6e74 6167  er for percentag
-0001f9f0: 6520 6368 616e 6765 0a20 2020 2020 2020  e change.       
-0001fa00: 2020 2020 2020 2020 206c 7470 5661 6c69           ltpVali
-0001fa10: 6420 3d20 666c 6f61 7428 7374 7228 7063  d = float(str(pc
-0001fa20: 745f 7361 7665 292e 7265 706c 6163 6528  t_save).replace(
-0001fa30: 2225 222c 2222 2929 203e 3d20 6d69 6e43  "%","")) >= minC
-0001fa40: 6861 6e67 650a 2020 2020 2020 2020 2020  hange.          
-0001fa50: 2020 7361 7665 4469 6374 5b22 4c54 5022    saveDict["LTP"
-0001fa60: 5d20 3d20 726f 756e 6428 6c74 702c 2032  ] = round(ltp, 2
-0001fa70: 290a 2020 2020 2020 2020 2020 2020 7363  ).            sc
-0001fa80: 7265 656e 4469 6374 5b22 4c54 5022 5d20  reenDict["LTP"] 
-0001fa90: 3d20 2863 6f6c 6f72 5465 7874 2e47 5245  = (colorText.GRE
-0001faa0: 454e 2069 6620 6c74 7056 616c 6964 2065  EN if ltpValid e
-0001fab0: 6c73 6520 636f 6c6f 7254 6578 742e 4641  lse colorText.FA
-0001fac0: 494c 2920 2b20 2822 252e 3266 2220 2520  IL) + ("%.2f" % 
-0001fad0: 6c74 7029 202b 2063 6f6c 6f72 5465 7874  ltp) + colorText
-0001fae0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-0001faf0: 2072 6574 7572 6e20 6c74 7056 616c 6964   return ltpValid
-0001fb00: 2c20 7665 7269 6679 5374 6167 6554 776f  , verifyStageTwo
-0001fb10: 0a20 2020 2020 2020 2073 6372 6565 6e44  .        screenD
-0001fb20: 6963 745b 224c 5450 225d 203d 2063 6f6c  ict["LTP"] = col
-0001fb30: 6f72 5465 7874 2e46 4149 4c20 2b20 2822  orText.FAIL + ("
-0001fb40: 252e 3266 2220 2520 6c74 7029 202b 2063  %.2f" % ltp) + c
-0001fb50: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-0001fb60: 2020 2020 2073 6176 6544 6963 745b 224c       saveDict["L
-0001fb70: 5450 225d 203d 2072 6f75 6e64 286c 7470  TP"] = round(ltp
-0001fb80: 2c20 3229 0a20 2020 2020 2020 2072 6574  , 2).        ret
-0001fb90: 7572 6e20 6c74 7056 616c 6964 2c20 7665  urn ltpValid, ve
-0001fba0: 7269 6679 5374 6167 6554 776f 0a0a 2020  rifyStageTwo..  
-0001fbb0: 2020 6465 6620 7661 6c69 6461 7465 4c54    def validateLT
-0001fbc0: 5046 6f72 506f 7274 666f 6c69 6f43 616c  PForPortfolioCal
-0001fbd0: 6328 7365 6c66 2c20 6466 2c20 7363 7265  c(self, df, scre
-0001fbe0: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
-0001fbf0: 2c72 6571 7565 7374 6564 5065 7269 6f64  ,requestedPeriod
-0001fc00: 3d30 293a 0a20 2020 2020 2020 2064 6174  =0):.        dat
-0001fc10: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
-0001fc20: 2020 2020 2020 7065 7269 6f64 7320 3d20        periods = 
-0001fc30: 7365 6c66 2e63 6f6e 6669 674d 616e 6167  self.configManag
-0001fc40: 6572 2e70 6572 696f 6473 5261 6e67 650a  er.periodsRange.
-0001fc50: 2020 2020 2020 2020 6966 2072 6571 7565          if reque
-0001fc60: 7374 6564 5065 7269 6f64 203e 2030 2061  stedPeriod > 0 a
-0001fc70: 6e64 2072 6571 7565 7374 6564 5065 7269  nd requestedPeri
-0001fc80: 6f64 206e 6f74 2069 6e20 7065 7269 6f64  od not in period
-0001fc90: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-0001fca0: 6572 696f 6473 2e61 7070 656e 6428 7265  eriods.append(re
-0001fcb0: 7175 6573 7465 6450 6572 696f 6429 0a20  questedPeriod). 
-0001fcc0: 2020 2020 2020 2070 7265 7669 6f75 735f         previous_
-0001fcd0: 7265 6365 6e74 203d 2064 6174 612e 6865  recent = data.he
-0001fce0: 6164 2831 290a 2020 2020 2020 2020 7072  ad(1).        pr
-0001fcf0: 6576 696f 7573 5f72 6563 656e 742e 7265  evious_recent.re
-0001fd00: 7365 745f 696e 6465 7828 696e 706c 6163  set_index(inplac
-0001fd10: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-0001fd20: 6361 6c63 5f64 6174 6520 3d20 7374 7228  calc_date = str(
-0001fd30: 7072 6576 696f 7573 5f72 6563 656e 742e  previous_recent.
-0001fd40: 696c 6f63 5b3a 2c20 305d 5b30 5d29 2e73  iloc[:, 0][0]).s
-0001fd50: 706c 6974 2822 2022 295b 305d 0a20 2020  plit(" ")[0].   
-0001fd60: 2020 2020 2066 6f72 2070 7264 2069 6e20       for prd in 
-0001fd70: 7065 7269 6f64 733a 0a20 2020 2020 2020  periods:.       
-0001fd80: 2020 2020 2069 6620 6c65 6e28 6461 7461       if len(data
-0001fd90: 2920 3e3d 2070 7264 202b 2031 3a0a 2020  ) >= prd + 1:.  
-0001fda0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001fdb0: 6576 4c74 7020 3d20 6461 7461 5b22 436c  evLtp = data["Cl
-0001fdc0: 6f73 6522 5d2e 696c 6f63 5b30 5d0a 2020  ose"].iloc[0].  
-0001fdd0: 2020 2020 2020 2020 2020 2020 2020 6c74                lt
-0001fde0: 7054 6479 203d 2064 6174 615b 2243 6c6f  pTdy = data["Clo
-0001fdf0: 7365 225d 2e69 6c6f 635b 7072 645d 0a20  se"].iloc[prd]. 
-0001fe00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001fe10: 6620 6973 696e 7374 616e 6365 2870 7265  f isinstance(pre
-0001fe20: 764c 7470 2c70 642e 5365 7269 6573 293a  vLtp,pd.Series):
-0001fe30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fe40: 2020 2020 2070 7265 764c 7470 203d 2070       prevLtp = p
-0001fe50: 7265 764c 7470 5b30 5d0a 2020 2020 2020  revLtp[0].      
-0001fe60: 2020 2020 2020 2020 2020 2020 2020 6c74                lt
-0001fe70: 7054 6479 203d 206c 7470 5464 795b 305d  pTdy = ltpTdy[0]
-0001fe80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fe90: 2073 6372 6565 6e44 6963 745b 6622 4c54   screenDict[f"LT
-0001fea0: 507b 7072 647d 225d 203d 2028 0a20 2020  P{prd}"] = (.   
-0001feb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fec0: 2028 636f 6c6f 7254 6578 742e 4752 4545   (colorText.GREE
-0001fed0: 4e20 6966 2028 6c74 7054 6479 203e 3d20  N if (ltpTdy >= 
-0001fee0: 7072 6576 4c74 7029 2065 6c73 6520 2863  prevLtp) else (c
-0001fef0: 6f6c 6f72 5465 7874 2e46 4149 4c29 290a  olorText.FAIL)).
-0001ff00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff10: 2020 2020 2b20 7374 7228 227b 3a2e 3266      + str("{:.2f
-0001ff20: 7d22 2e66 6f72 6d61 7428 6c74 7054 6479  }".format(ltpTdy
-0001ff30: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0001ff40: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-0001ff50: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-0001ff60: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001ff70: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-0001ff80: 6963 745b 6622 4772 6f77 7468 7b70 7264  ict[f"Growth{prd
-0001ff90: 7d22 5d20 3d20 280a 2020 2020 2020 2020  }"] = (.        
-0001ffa0: 2020 2020 2020 2020 2020 2020 2863 6f6c              (col
-0001ffb0: 6f72 5465 7874 2e47 5245 454e 2069 6620  orText.GREEN if 
-0001ffc0: 286c 7470 5464 7920 3e3d 2070 7265 764c  (ltpTdy >= prevL
-0001ffd0: 7470 2920 656c 7365 2028 636f 6c6f 7254  tp) else (colorT
-0001ffe0: 6578 742e 4641 494c 2929 0a20 2020 2020  ext.FAIL)).     
-0001fff0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00020000: 2073 7472 2822 7b3a 2e32 667d 222e 666f   str("{:.2f}".fo
-00020010: 726d 6174 286c 7470 5464 7920 2d20 7072  rmat(ltpTdy - pr
-00020020: 6576 4c74 7029 290a 2020 2020 2020 2020  evLtp)).        
-00020030: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
-00020040: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
-00020050: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00020060: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00020070: 7665 4469 6374 5b66 224c 5450 7b70 7264  veDict[f"LTP{prd
-00020080: 7d22 5d20 3d20 726f 756e 6428 6c74 7054  }"] = round(ltpT
-00020090: 6479 2c20 3229 0a20 2020 2020 2020 2020  dy, 2).         
-000200a0: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
-000200b0: 6622 4772 6f77 7468 7b70 7264 7d22 5d20  f"Growth{prd}"] 
-000200c0: 3d20 726f 756e 6428 6c74 7054 6479 202d  = round(ltpTdy -
-000200d0: 2070 7265 764c 7470 2c20 3229 0a20 2020   prevLtp, 2).   
-000200e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000200f0: 7072 6420 3d3d 2032 3220 6f72 2028 7072  prd == 22 or (pr
-00020100: 6420 3d3d 2072 6571 7565 7374 6564 5065  d == requestedPe
-00020110: 7269 6f64 293a 0a20 2020 2020 2020 2020  riod):.         
-00020120: 2020 2020 2020 2020 2020 2063 6861 6e67             chang
-00020130: 6550 6572 6365 6e74 203d 2072 6f75 6e64  ePercent = round
-00020140: 2828 2870 7265 764c 7470 2d6c 7470 5464  (((prevLtp-ltpTd
-00020150: 7929 2069 6620 7265 7175 6573 7465 6450  y) if requestedP
-00020160: 6572 696f 6420 3d3d 3020 656c 7365 2028  eriod ==0 else (
-00020170: 6c74 7054 6479 202d 2070 7265 764c 7470  ltpTdy - prevLtp
-00020180: 2929 2a31 3030 2f6c 7470 5464 792c 2032  ))*100/ltpTdy, 2
-00020190: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000201a0: 2020 2020 2020 7361 7665 4469 6374 5b66        saveDict[f
-000201b0: 227b 7072 647d 2d50 6420 2522 5d20 3d20  "{prd}-Pd %"] = 
-000201c0: 6622 7b63 6861 6e67 6550 6572 6365 6e74  f"{changePercent
-000201d0: 7d25 2220 6966 206e 6f74 2070 642e 6973  }%" if not pd.is
-000201e0: 6e61 2863 6861 6e67 6550 6572 6365 6e74  na(changePercent
-000201f0: 2920 656c 7365 2027 2d27 0a20 2020 2020  ) else '-'.     
-00020200: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00020210: 6372 6565 6e44 6963 745b 6622 7b70 7264  creenDict[f"{prd
-00020220: 7d2d 5064 2025 225d 203d 2028 2863 6f6c  }-Pd %"] = ((col
-00020230: 6f72 5465 7874 2e47 5245 454e 2069 6620  orText.GREEN if 
-00020240: 6368 616e 6765 5065 7263 656e 7420 3e3d  changePercent >=
-00020250: 3020 656c 7365 2063 6f6c 6f72 5465 7874  0 else colorText
-00020260: 2e46 4149 4c29 202b 2066 227b 6368 616e  .FAIL) + f"{chan
-00020270: 6765 5065 7263 656e 747d 2522 202b 2063  gePercent}%" + c
-00020280: 6f6c 6f72 5465 7874 2e45 4e44 2920 6966  olorText.END) if
-00020290: 206e 6f74 2070 642e 6973 6e61 2863 6861   not pd.isna(cha
-000202a0: 6e67 6550 6572 6365 6e74 2920 656c 7365  ngePercent) else
-000202b0: 2027 2d27 0a20 2020 2020 2020 2020 2020   '-'.           
-000202c0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-000202d0: 2244 6174 6522 5d20 3d20 6361 6c63 5f64  "Date"] = calc_d
-000202e0: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-000202f0: 2020 2020 7361 7665 4469 6374 5b22 4461      saveDict["Da
-00020300: 7465 225d 203d 2063 616c 635f 6461 7465  te"] = calc_date
-00020310: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00020320: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00020330: 2020 2073 6176 6544 6963 745b 6622 4c54     saveDict[f"LT
-00020340: 507b 7072 647d 225d 203d 206e 702e 6e61  P{prd}"] = np.na
-00020350: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00020360: 2020 7361 7665 4469 6374 5b66 2247 726f    saveDict[f"Gro
-00020370: 7774 687b 7072 647d 225d 203d 206e 702e  wth{prd}"] = np.
-00020380: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
-00020390: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
-000203a0: 4461 7465 225d 203d 2063 616c 635f 6461  Date"] = calc_da
-000203b0: 7465 0a20 2020 2020 2020 2020 2020 2020  te.             
-000203c0: 2020 2073 6176 6544 6963 745b 2244 6174     saveDict["Dat
-000203d0: 6522 5d20 3d20 6361 6c63 5f64 6174 650a  e"] = calc_date.
-000203e0: 0a20 2020 2023 2046 696e 6420 7374 6f63  .    # Find stoc
-000203f0: 6b73 2074 6861 7420 6172 6520 6265 6172  ks that are bear
-00020400: 6973 6820 696e 7472 6164 6179 3a20 4d61  ish intraday: Ma
-00020410: 6364 2048 6973 746f 6772 616d 206e 6567  cd Histogram neg
-00020420: 6174 6976 650a 2020 2020 6465 6620 7661  ative.    def va
-00020430: 6c69 6461 7465 4d41 4344 4869 7374 6f67  lidateMACDHistog
-00020440: 7261 6d42 656c 6f77 3028 7365 6c66 2c20  ramBelow0(self, 
-00020450: 6466 293a 0a20 2020 2020 2020 2069 6620  df):.        if 
-00020460: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
-00020470: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
-00020480: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00020490: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
-000204a0: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
-000204b0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-000204c0: 612e 6669 6c6c 6e61 2830 290a 2020 2020  a.fillna(0).    
-000204d0: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-000204e0: 7265 706c 6163 6528 5b6e 702e 696e 662c  replace([np.inf,
-000204f0: 202d 6e70 2e69 6e66 5d2c 2030 290a 2020   -np.inf], 0).  
-00020500: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-00020510: 615b 3a3a 2d31 5d20 2023 2052 6576 6572  a[::-1]  # Rever
-00020520: 7365 2074 6865 2064 6174 6166 7261 6d65  se the dataframe
-00020530: 2073 6f20 7468 6174 2069 7473 2074 6865   so that its the
-00020540: 206f 6c64 6573 7420 6461 7465 2066 6972   oldest date fir
-00020550: 7374 0a20 2020 2020 2020 206d 6163 6420  st.        macd 
-00020560: 3d20 706b 7461 6c69 622e 4d41 4344 2864  = pktalib.MACD(d
-00020570: 6174 615b 2243 6c6f 7365 225d 2c20 3132  ata["Close"], 12
-00020580: 2c20 3236 2c20 3929 5b32 5d2e 7461 696c  , 26, 9)[2].tail
-00020590: 2831 290a 2020 2020 2020 2020 7265 7475  (1).        retu
-000205a0: 726e 206d 6163 642e 696c 6f63 5b3a 315d  rn macd.iloc[:1]
-000205b0: 5b30 5d20 3c20 300a 0a20 2020 2023 406d  [0] < 0..    #@m
-000205c0: 6561 7375 7265 5f74 696d 650a 2020 2020  easure_time.    
-000205d0: 2320 4669 6e64 2069 6620 7374 6f63 6b20  # Find if stock 
-000205e0: 6761 696e 696e 6720 6275 6c6c 6973 6820  gaining bullish 
-000205f0: 6d6f 6d65 6e74 756d 0a20 2020 2064 6566  momentum.    def
-00020600: 2076 616c 6964 6174 654d 6f6d 656e 7475   validateMomentu
-00020610: 6d28 7365 6c66 2c20 6466 2c20 7363 7265  m(self, df, scre
-00020620: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
-00020630: 293a 0a20 2020 2020 2020 2069 6620 6466  ):.        if df
-00020640: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
-00020650: 6466 2920 3d3d 2030 3a0a 2020 2020 2020  df) == 0:.      
-00020660: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00020670: 7365 0a20 2020 2020 2020 2064 6174 6120  se.        data 
-00020680: 3d20 6466 2e63 6f70 7928 290a 2020 2020  = df.copy().    
-00020690: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000206a0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-000206b0: 2e68 6561 6428 3329 0a20 2020 2020 2020  .head(3).       
-000206c0: 2020 2020 2069 6620 6c65 6e28 6461 7461       if len(data
-000206d0: 2920 3c20 333a 0a20 2020 2020 2020 2020  ) < 3:.         
-000206e0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000206f0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00020700: 666f 7220 726f 7720 696e 2064 6174 612e  for row in data.
-00020710: 6974 6572 726f 7773 2829 3a0a 2020 2020  iterrows():.    
-00020720: 2020 2020 2020 2020 2020 2020 2320 416c              # Al
-00020730: 6c20 3320 6361 6e64 6c65 7320 7368 6f75  l 3 candles shou
-00020740: 6c64 2062 6520 4772 6565 6e20 616e 6420  ld be Green and 
-00020750: 4e4f 5420 4369 7263 7569 7473 0a20 2020  NOT Circuits.   
-00020760: 2020 2020 2020 2020 2020 2020 2079 6320               yc 
-00020770: 3d20 726f 775b 315d 5b22 436c 6f73 6522  = row[1]["Close"
-00020780: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00020790: 2020 796f 203d 2072 6f77 5b31 5d5b 224f    yo = row[1]["O
-000207a0: 7065 6e22 5d0a 2020 2020 2020 2020 2020  pen"].          
-000207b0: 2020 2020 2020 6966 2079 6320 3c3d 2079        if yc <= y
-000207c0: 6f3a 0a20 2020 2020 2020 2020 2020 2020  o:.             
-000207d0: 2020 2020 2020 2023 2073 656c 662e 6465         # self.de
-000207e0: 6661 756c 745f 6c6f 6767 6572 2e69 6e66  fault_logger.inf
-000207f0: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
-00020800: 2020 2020 2020 2023 2020 2020 2066 2753         #     f'S
-00020810: 746f 636b 3a7b 7361 7665 4469 6374 5b22  tock:{saveDict["
-00020820: 5374 6f63 6b22 5d7d 2c20 6973 206e 6f74  Stock"]}, is not
-00020830: 2061 206d 6f6d 656e 7475 6d2d 6761 696e   a momentum-gain
-00020840: 6572 2062 6563 6175 7365 2079 6573 7465  er because yeste
-00020850: 7264 6179 2d63 6c6f 7365 2028 7b79 637d  rday-close ({yc}
-00020860: 2920 3c3d 2079 6573 7465 7264 6179 2d6f  ) <= yesterday-o
-00020870: 7065 6e20 287b 796f 7d29 270a 2020 2020  pen ({yo})'.    
-00020880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020890: 2320 290a 2020 2020 2020 2020 2020 2020  # ).            
-000208a0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000208b0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-000208c0: 206f 7065 6e44 6573 6320 3d20 6461 7461   openDesc = data
-000208d0: 2e73 6f72 745f 7661 6c75 6573 2862 793d  .sort_values(by=
-000208e0: 5b22 4f70 656e 225d 2c20 6173 6365 6e64  ["Open"], ascend
-000208f0: 696e 673d 4661 6c73 6529 0a20 2020 2020  ing=False).     
-00020900: 2020 2020 2020 2063 6c6f 7365 4465 7363         closeDesc
-00020910: 203d 2064 6174 612e 736f 7274 5f76 616c   = data.sort_val
-00020920: 7565 7328 6279 3d5b 2243 6c6f 7365 225d  ues(by=["Close"]
-00020930: 2c20 6173 6365 6e64 696e 673d 4661 6c73  , ascending=Fals
-00020940: 6529 0a20 2020 2020 2020 2020 2020 2076  e).            v
-00020950: 6f6c 4465 7363 203d 2064 6174 612e 736f  olDesc = data.so
-00020960: 7274 5f76 616c 7565 7328 6279 3d5b 2256  rt_values(by=["V
-00020970: 6f6c 756d 6522 5d2c 2061 7363 656e 6469  olume"], ascendi
-00020980: 6e67 3d46 616c 7365 290a 2020 2020 2020  ng=False).      
-00020990: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000209a0: 2020 2020 2020 2020 2020 2069 6620 280a             if (.
-000209b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000209c0: 2020 2020 6461 7461 2e65 7175 616c 7328      data.equals(
-000209d0: 6f70 656e 4465 7363 290a 2020 2020 2020  openDesc).      
-000209e0: 2020 2020 2020 2020 2020 2020 2020 616e                an
-000209f0: 6420 6461 7461 2e65 7175 616c 7328 636c  d data.equals(cl
-00020a00: 6f73 6544 6573 6329 0a20 2020 2020 2020  oseDesc).       
-00020a10: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00020a20: 2064 6174 612e 6571 7561 6c73 2876 6f6c   data.equals(vol
-00020a30: 4465 7363 290a 2020 2020 2020 2020 2020  Desc).          
-00020a40: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00020a50: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-00020a60: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
-00020a70: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
-00020a80: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00020a90: 2020 2066 2753 746f 636b 3a7b 7361 7665     f'Stock:{save
-00020aa0: 4469 6374 5b22 5374 6f63 6b22 5d7d 2c20  Dict["Stock"]}, 
-00020ab0: 6f70 656e 2c63 6c6f 7365 2061 6e64 2076  open,close and v
-00020ac0: 6f6c 756d 6520 6571 7561 6c20 6672 6f6d  olume equal from
-00020ad0: 2064 6179 2062 6566 6f72 6520 7965 7374   day before yest
-00020ae0: 6572 6461 792e 2041 2070 6f74 656e 7469  erday. A potenti
-00020af0: 616c 206d 6f6d 656e 7475 6d2d 6761 696e  al momentum-gain
-00020b00: 6572 2127 0a20 2020 2020 2020 2020 2020  er!'.           
-00020b10: 2020 2020 2020 2020 2023 2029 0a20 2020           # ).   
-00020b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b30: 2074 6f20 3d20 6461 7461 5b22 4f70 656e   to = data["Open
-00020b40: 225d 2e69 6c6f 635b 305d 0a20 2020 2020  "].iloc[0].     
-00020b50: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-00020b60: 6320 3d20 6461 7461 5b22 436c 6f73 6522  c = data["Close"
-00020b70: 5d2e 696c 6f63 5b31 5d0a 2020 2020 2020  ].iloc[1].      
-00020b80: 2020 2020 2020 2020 2020 2020 2020 796f                yo
-00020b90: 203d 2064 6174 615b 224f 7065 6e22 5d2e   = data["Open"].
-00020ba0: 696c 6f63 5b31 5d0a 2020 2020 2020 2020  iloc[1].        
-00020bb0: 2020 2020 2020 2020 2020 2020 6479 6320              dyc 
-00020bc0: 3d20 6461 7461 5b22 436c 6f73 6522 5d2e  = data["Close"].
-00020bd0: 696c 6f63 5b32 5d0a 2020 2020 2020 2020  iloc[2].        
-00020be0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00020bf0: 746f 203e 3d20 7963 2920 616e 6420 2879  to >= yc) and (y
-00020c00: 6f20 3e3d 2064 7963 293a 0a20 2020 2020  o >= dyc):.     
-00020c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c20: 2020 2023 2073 656c 662e 6465 6661 756c     # self.defaul
-00020c30: 745f 6c6f 6767 6572 2e69 6e66 6f28 0a20  t_logger.info(. 
-00020c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c50: 2020 2020 2020 2023 2020 2020 2066 2753         #     f'S
-00020c60: 746f 636b 3a7b 7361 7665 4469 6374 5b22  tock:{saveDict["
-00020c70: 5374 6f63 6b22 5d7d 2c20 6973 2061 206d  Stock"]}, is a m
-00020c80: 6f6d 656e 7475 6d2d 6761 696e 6572 2062  omentum-gainer b
-00020c90: 6563 6175 7365 2074 6f64 6179 2d6f 7065  ecause today-ope
-00020ca0: 6e20 287b 746f 7d29 203e 3d20 7965 7374  n ({to}) >= yest
-00020cb0: 6572 6461 792d 636c 6f73 6520 287b 7963  erday-close ({yc
-00020cc0: 7d29 2061 6e64 2079 6573 7465 7264 6179  }) and yesterday
-00020cd0: 2d6f 7065 6e28 7b79 6f7d 2920 3e3d 2064  -open({yo}) >= d
-00020ce0: 6179 2d62 6566 6f72 652d 636c 6f73 6528  ay-before-close(
-00020cf0: 7b64 7963 7d29 270a 2020 2020 2020 2020  {dyc})'.        
-00020d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d10: 2320 290a 2020 2020 2020 2020 2020 2020  # ).            
-00020d20: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00020d30: 6420 3d20 7365 6c66 2e66 696e 6443 7572  d = self.findCur
-00020d40: 7265 6e74 5361 7665 6456 616c 7565 2873  rentSavedValue(s
-00020d50: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
-00020d60: 6963 742c 2022 5061 7474 6572 6e22 290a  ict, "Pattern").
-00020d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d80: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-00020d90: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
-00020da0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00020db0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00020dc0: 7665 645b 305d 0a20 2020 2020 2020 2020  ved[0].         
-00020dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020de0: 2020 202b 2063 6f6c 6f72 5465 7874 2e42     + colorText.B
-00020df0: 4f4c 440a 2020 2020 2020 2020 2020 2020  OLD.            
-00020e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e10: 2b20 636f 6c6f 7254 6578 742e 4752 4545  + colorText.GREE
-00020e20: 4e0a 2020 2020 2020 2020 2020 2020 2020  N.              
-00020e30: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00020e40: 224d 6f6d 656e 7475 6d20 4761 696e 6572  "Momentum Gainer
-00020e50: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00020e60: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00020e70: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+0001da10: 6966 2022 446f 776e 2220 696e 2073 6176  if "Down" in sav
+0001da20: 6544 6963 745b 2254 7265 6e64 225d 2061  eDict["Trend"] a
+0001da30: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
+0001da40: 2020 2020 2020 2020 2022 4265 6172 2220           "Bear" 
+0001da50: 696e 2073 6176 6544 6963 745b 224d 412d  in saveDict["MA-
+0001da60: 5369 676e 616c 225d 206f 7220 2252 6573  Signal"] or "Res
+0001da70: 6973 7422 2069 6e20 7361 7665 4469 6374  ist" in saveDict
+0001da80: 5b22 4d41 2d53 6967 6e61 6c22 5d0a 2020  ["MA-Signal"].  
+0001da90: 2020 2020 2020 2020 2020 2020 2020 293a                ):
+0001daa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dab0: 2020 2020 2064 6174 6120 3d20 6f72 6744       data = orgD
+0001dac0: 6174 612e 6865 6164 2869 290a 2020 2020  ata.head(i).    
+0001dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dae0: 7265 6643 616e 646c 6520 3d20 6461 7461  refCandle = data
+0001daf0: 2e74 6169 6c28 3129 0a20 2020 2020 2020  .tail(1).       
+0001db00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001db10: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001db20: 2020 2020 2020 2020 2020 286c 656e 2864            (len(d
+0001db30: 6174 612e 4869 6768 5b64 6174 612e 4869  ata.High[data.Hi
+0001db40: 6768 203e 2072 6566 4361 6e64 6c65 2e48  gh > refCandle.H
+0001db50: 6967 682e 6974 656d 2829 5d29 203d 3d20  igh.item()]) == 
+0001db60: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+0001db70: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
+0001db80: 6c65 6e28 6461 7461 2e4c 6f77 5b64 6174  len(data.Low[dat
+0001db90: 612e 4c6f 7720 3c20 7265 6643 616e 646c  a.Low < refCandl
+0001dba0: 652e 4c6f 772e 6974 656d 2829 5d29 203d  e.Low.item()]) =
+0001dbb0: 3d20 3029 0a20 2020 2020 2020 2020 2020  = 0).           
+0001dbc0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+0001dbd0: 2028 6c65 6e28 6461 7461 2e4f 7065 6e5b   (len(data.Open[
+0001dbe0: 6461 7461 2e4f 7065 6e20 3e20 7265 6643  data.Open > refC
+0001dbf0: 616e 646c 652e 4869 6768 2e69 7465 6d28  andle.High.item(
+0001dc00: 295d 2920 3d3d 2030 290a 2020 2020 2020  )]) == 0).      
+0001dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc20: 2020 616e 6420 286c 656e 2864 6174 612e    and (len(data.
+0001dc30: 436c 6f73 655b 6461 7461 2e43 6c6f 7365  Close[data.Close
+0001dc40: 203c 2072 6566 4361 6e64 6c65 2e4c 6f77   < refCandle.Low
+0001dc50: 2e69 7465 6d28 295d 2920 3d3d 2030 290a  .item()]) == 0).
+0001dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc70: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+0001dc80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001dc90: 6372 6565 6e44 6963 745b 2250 6174 7465  creenDict["Patte
+0001dca0: 726e 225d 203d 2028 0a20 2020 2020 2020  rn"] = (.       
+0001dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcc0: 2020 2020 2073 6176 6564 5b30 5d0a 2020       saved[0].  
+0001dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dce0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+0001dcf0: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
+0001dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd10: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+0001dd20: 7874 2e57 4152 4e0a 2020 2020 2020 2020  xt.WARN.        
+0001dd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd40: 2020 2020 2b20 2822 496e 7369 6465 2042      + ("Inside B
+0001dd50: 6172 2028 2564 2922 2025 2069 290a 2020  ar (%d)" % i).  
+0001dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd70: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+0001dd80: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+0001dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dda0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0001ddb0: 2020 2020 2020 2020 2020 2020 7361 7665              save
+0001ddc0: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+0001ddd0: 3d20 7361 7665 645b 315d 202b 2022 496e  = saved[1] + "In
+0001dde0: 7369 6465 2042 6172 2028 2564 2922 2025  side Bar (%d)" %
+0001ddf0: 2069 0a20 2020 2020 2020 2020 2020 2020   i.             
+0001de00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001de10: 6e20 690a 2020 2020 2020 2020 2020 2020  n i.            
+0001de20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001de30: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001de40: 7475 726e 2030 0a20 2020 2020 2020 2072  turn 0.        r
+0001de50: 6574 7572 6e20 300a 0a20 2020 2023 2046  eturn 0..    # F
+0001de60: 696e 6420 4950 4f20 6261 7365 0a20 2020  ind IPO base.   
+0001de70: 2064 6566 2076 616c 6964 6174 6549 706f   def validateIpo
+0001de80: 4261 7365 2873 656c 662c 2073 746f 636b  Base(self, stock
+0001de90: 2c20 6466 2c20 7363 7265 656e 4469 6374  , df, screenDict
+0001dea0: 2c20 7361 7665 4469 6374 2c20 7065 7263  , saveDict, perc
+0001deb0: 656e 7461 6765 3d30 2e33 293a 0a20 2020  entage=0.3):.   
+0001dec0: 2020 2020 2069 6620 6466 2069 7320 4e6f       if df is No
+0001ded0: 6e65 206f 7220 6c65 6e28 6466 2920 3d3d  ne or len(df) ==
+0001dee0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0001def0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
+0001df00: 2020 2020 2064 6174 6120 3d20 6466 2e63       data = df.c
+0001df10: 6f70 7928 290a 2020 2020 2020 2020 6c69  opy().        li
+0001df20: 7374 696e 6750 7269 6365 203d 2064 6174  stingPrice = dat
+0001df30: 615b 3a3a 2d31 5d2e 6865 6164 2831 295b  a[::-1].head(1)[
+0001df40: 224f 7065 6e22 5d2e 696c 6f63 5b30 5d0a  "Open"].iloc[0].
+0001df50: 2020 2020 2020 2020 6375 7272 656e 7450          currentP
+0001df60: 7269 6365 203d 2064 6174 612e 6865 6164  rice = data.head
+0001df70: 2831 295b 2243 6c6f 7365 225d 2e69 6c6f  (1)["Close"].ilo
+0001df80: 635b 305d 0a20 2020 2020 2020 2041 5448  c[0].        ATH
+0001df90: 203d 2064 6174 612e 6465 7363 7269 6265   = data.describe
+0001dfa0: 2829 5b22 4869 6768 225d 5b22 6d61 7822  ()["High"]["max"
+0001dfb0: 5d0a 2020 2020 2020 2020 6966 2041 5448  ].        if ATH
+0001dfc0: 203e 2028 6c69 7374 696e 6750 7269 6365   > (listingPrice
+0001dfd0: 202b 2028 6c69 7374 696e 6750 7269 6365   + (listingPrice
+0001dfe0: 202a 2070 6572 6365 6e74 6167 6529 293a   * percentage)):
+0001dff0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001e000: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
+0001e010: 2020 6177 6179 203d 2072 6f75 6e64 2828    away = round((
+0001e020: 2863 7572 7265 6e74 5072 6963 6520 2d20  (currentPrice - 
+0001e030: 6c69 7374 696e 6750 7269 6365 2920 2f20  listingPrice) / 
+0001e040: 6c69 7374 696e 6750 7269 6365 2920 2a20  listingPrice) * 
+0001e050: 3130 302c 2031 290a 2020 2020 2020 2020  100, 1).        
+0001e060: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+0001e070: 2028 6c69 7374 696e 6750 7269 6365 202d   (listingPrice -
+0001e080: 2028 6c69 7374 696e 6750 7269 6365 202a   (listingPrice *
+0001e090: 2070 6572 6365 6e74 6167 6529 290a 2020   percentage)).  
+0001e0a0: 2020 2020 2020 2020 2020 3c3d 2063 7572            <= cur
+0001e0b0: 7265 6e74 5072 6963 650a 2020 2020 2020  rentPrice.      
+0001e0c0: 2020 2020 2020 3c3d 2028 6c69 7374 696e        <= (listin
+0001e0d0: 6750 7269 6365 202b 2028 6c69 7374 696e  gPrice + (listin
+0001e0e0: 6750 7269 6365 202a 2070 6572 6365 6e74  gPrice * percent
+0001e0f0: 6167 6529 290a 2020 2020 2020 2020 293a  age)).        ):
+0001e100: 0a20 2020 2020 2020 2020 2020 2073 6176  .            sav
+0001e110: 6564 203d 2073 656c 662e 6669 6e64 4375  ed = self.findCu
+0001e120: 7272 656e 7453 6176 6564 5661 6c75 6528  rrentSavedValue(
+0001e130: 7363 7265 656e 4469 6374 2c20 7361 7665  screenDict, save
+0001e140: 4469 6374 2c20 2250 6174 7465 726e 2229  Dict, "Pattern")
+0001e150: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001e160: 6177 6179 203e 2030 3a0a 2020 2020 2020  away > 0:.      
+0001e170: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+0001e180: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+0001e190: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0001e1a0: 2020 2020 2020 2020 7361 7665 645b 305d          saved[0]
+0001e1b0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0001e1c0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0001e1d0: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
+0001e1e0: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+0001e1f0: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
+0001e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e210: 202b 2066 2249 504f 2042 6173 6520 287b   + f"IPO Base ({
+0001e220: 6177 6179 7d20 2529 220a 2020 2020 2020  away} %)".      
+0001e230: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0001e240: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+0001e250: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001e260: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001e270: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001e280: 2020 7363 7265 656e 4469 6374 5b22 5061    screenDict["Pa
+0001e290: 7474 6572 6e22 5d20 3d20 280a 2020 2020  ttern"] = (.    
+0001e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2b0: 7361 7665 645b 305d 0a20 2020 2020 2020  saved[0].       
+0001e2c0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
+0001e2d0: 6f6c 6f72 5465 7874 2e42 4f4c 440a 2020  olorText.BOLD.  
+0001e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2f0: 2020 2b20 636f 6c6f 7254 6578 742e 4752    + colorText.GR
+0001e300: 4545 4e0a 2020 2020 2020 2020 2020 2020  EEN.            
+0001e310: 2020 2020 2020 2020 2b20 2249 504f 2042          + "IPO B
+0001e320: 6173 6520 220a 2020 2020 2020 2020 2020  ase ".          
+0001e330: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+0001e340: 7254 6578 742e 4641 494c 0a20 2020 2020  rText.FAIL.     
+0001e350: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001e360: 2066 2228 7b61 7761 797d 2025 2922 0a20   f"({away} %)". 
+0001e370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e380: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
+0001e390: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
+0001e3a0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001e3b0: 2073 6176 6544 6963 745b 2250 6174 7465   saveDict["Patte
+0001e3c0: 726e 225d 203d 2073 6176 6564 5b31 5d20  rn"] = saved[1] 
+0001e3d0: 2b20 6622 4950 4f20 4261 7365 2028 7b61  + f"IPO Base ({a
+0001e3e0: 7761 797d 2025 2922 0a20 2020 2020 2020  way} %)".       
+0001e3f0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+0001e400: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001e410: 4661 6c73 650a 0a20 2020 2023 406d 6561  False..    #@mea
+0001e420: 7375 7265 5f74 696d 650a 2020 2020 2320  sure_time.    # 
+0001e430: 5661 6c69 6461 7465 204c 6f72 656e 747a  Validate Lorentz
+0001e440: 6961 6e20 436c 6173 7369 6669 6361 7469  ian Classificati
+0001e450: 6f6e 2073 6967 6e61 6c0a 2020 2020 6465  on signal.    de
+0001e460: 6620 7661 6c69 6461 7465 4c6f 7265 6e74  f validateLorent
+0001e470: 7a69 616e 2873 656c 662c 2064 662c 2073  zian(self, df, s
+0001e480: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
+0001e490: 6963 742c 206c 6f6f 6b46 6f72 3d33 293a  ict, lookFor=3):
+0001e4a0: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
+0001e4b0: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
+0001e4c0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+0001e4d0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001e4e0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+0001e4f0: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
+0001e500: 2020 2320 6c6f 6f6b 466f 723a 2031 2d42    # lookFor: 1-B
+0001e510: 7579 2c20 322d 5365 6c6c 2c20 332d 416e  uy, 2-Sell, 3-An
+0001e520: 790a 2020 2020 2020 2020 6461 7461 203d  y.        data =
+0001e530: 2064 6174 615b 3a3a 2d31 5d20 2023 2052   data[::-1]  # R
+0001e540: 6576 6572 7365 2074 6865 2064 6174 6166  everse the dataf
+0001e550: 7261 6d65 0a20 2020 2020 2020 2064 6174  rame.        dat
+0001e560: 6120 3d20 6461 7461 2e72 656e 616d 6528  a = data.rename(
+0001e570: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+0001e580: 756d 6e73 3d7b 0a20 2020 2020 2020 2020  umns={.         
+0001e590: 2020 2020 2020 2022 4f70 656e 223a 2022         "Open": "
+0001e5a0: 6f70 656e 222c 0a20 2020 2020 2020 2020  open",.         
+0001e5b0: 2020 2020 2020 2022 436c 6f73 6522 3a20         "Close": 
+0001e5c0: 2263 6c6f 7365 222c 0a20 2020 2020 2020  "close",.       
+0001e5d0: 2020 2020 2020 2020 2022 4869 6768 223a           "High":
+0001e5e0: 2022 6869 6768 222c 0a20 2020 2020 2020   "high",.       
+0001e5f0: 2020 2020 2020 2020 2022 4c6f 7722 3a20           "Low": 
+0001e600: 226c 6f77 222c 0a20 2020 2020 2020 2020  "low",.         
+0001e610: 2020 2020 2020 2022 566f 6c75 6d65 223a         "Volume":
+0001e620: 2022 766f 6c75 6d65 222c 0a20 2020 2020   "volume",.     
+0001e630: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0001e640: 2029 0a20 2020 2020 2020 2074 7279 3a0a   ).        try:.
+0001e650: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0001e660: 2053 7570 7072 6573 734f 7574 7075 7428   SuppressOutput(
+0001e670: 7375 7070 7265 7373 5f73 7464 6f75 743d  suppress_stdout=
+0001e680: 5472 7565 2c20 7375 7070 7265 7373 5f73  True, suppress_s
+0001e690: 7464 6572 723d 5472 7565 293a 0a20 2020  tderr=True):.   
+0001e6a0: 2020 2020 2020 2020 2020 2020 206c 6320               lc 
+0001e6b0: 3d20 6174 612e 4c6f 7265 6e74 7a69 616e  = ata.Lorentzian
+0001e6c0: 436c 6173 7369 6669 6361 7469 6f6e 2864  Classification(d
+0001e6d0: 6174 613d 6461 7461 290a 2020 2020 2020  ata=data).      
+0001e6e0: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
+0001e6f0: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
+0001e700: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
+0001e710: 6963 742c 2073 6176 6544 6963 742c 2022  ict, saveDict, "
+0001e720: 5061 7474 6572 6e22 290a 2020 2020 2020  Pattern").      
+0001e730: 2020 2020 2020 6966 206c 632e 6466 2e69        if lc.df.i
+0001e740: 6c6f 635b 2d31 5d5b 2269 734e 6577 4275  loc[-1]["isNewBu
+0001e750: 7953 6967 6e61 6c22 5d3a 0a20 2020 2020  ySignal"]:.     
+0001e760: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+0001e770: 6e44 6963 745b 2250 6174 7465 726e 225d  nDict["Pattern"]
+0001e780: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0001e790: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
+0001e7a0: 5d20 2b20 636f 6c6f 7254 6578 742e 424f  ] + colorText.BO
+0001e7b0: 4c44 202b 2063 6f6c 6f72 5465 7874 2e47  LD + colorText.G
+0001e7c0: 5245 454e 202b 2022 4c6f 7265 6e74 7a69  REEN + "Lorentzi
+0001e7d0: 616e 2d42 7579 2220 2b20 636f 6c6f 7254  an-Buy" + colorT
+0001e7e0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+0001e7f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001e800: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
+0001e810: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
+0001e820: 7361 7665 645b 315d 202b 2022 4c6f 7265  saved[1] + "Lore
+0001e830: 6e74 7a69 616e 2d42 7579 220a 2020 2020  ntzian-Buy".    
+0001e840: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0001e850: 6f6f 6b46 6f72 2021 3d20 323a 2023 204e  ookFor != 2: # N
+0001e860: 6f74 2053 656c 6c0a 2020 2020 2020 2020  ot Sell.        
+0001e870: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001e880: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+0001e890: 2020 2020 656c 6966 206c 632e 6466 2e69      elif lc.df.i
+0001e8a0: 6c6f 635b 2d31 5d5b 2269 734e 6577 5365  loc[-1]["isNewSe
+0001e8b0: 6c6c 5369 676e 616c 225d 3a0a 2020 2020  llSignal"]:.    
+0001e8c0: 2020 2020 2020 2020 2020 2020 7363 7265              scre
+0001e8d0: 656e 4469 6374 5b22 5061 7474 6572 6e22  enDict["Pattern"
+0001e8e0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+0001e8f0: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
+0001e900: 305d 202b 2063 6f6c 6f72 5465 7874 2e42  0] + colorText.B
+0001e910: 4f4c 4420 2b20 636f 6c6f 7254 6578 742e  OLD + colorText.
+0001e920: 4641 494c 202b 2022 4c6f 7265 6e74 7a69  FAIL + "Lorentzi
+0001e930: 616e 2d53 656c 6c22 202b 2063 6f6c 6f72  an-Sell" + color
+0001e940: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+0001e950: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001e960: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+0001e970: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
+0001e980: 2073 6176 6564 5b31 5d20 2b20 224c 6f72   saved[1] + "Lor
+0001e990: 656e 747a 6961 6e2d 5365 6c6c 220a 2020  entzian-Sell".  
+0001e9a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001e9b0: 206c 6f6f 6b46 6f72 2021 3d20 313a 2023   lookFor != 1: #
+0001e9c0: 204e 6f74 2042 7579 0a20 2020 2020 2020   Not Buy.       
+0001e9d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001e9e0: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+0001e9f0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+0001ea00: 6e3a 2020 2320 7072 6167 6d61 3a20 6e6f  n:  # pragma: no
+0001ea10: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
+0001ea20: 2020 2023 2056 616c 7565 4572 726f 723a     # ValueError:
+0001ea30: 206f 7065 7261 6e64 7320 636f 756c 6420   operands could 
+0001ea40: 6e6f 7420 6265 2062 726f 6164 6361 7374  not be broadcast
+0001ea50: 2074 6f67 6574 6865 7220 7769 7468 2073   together with s
+0001ea60: 6861 7065 7320 2832 302c 2920 2832 362c  hapes (20,) (26,
+0001ea70: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0001ea80: 4669 6c65 2022 2f6f 7074 2f68 6f6d 6562  File "/opt/homeb
+0001ea90: 7265 772f 6c69 622f 7079 7468 6f6e 332e  rew/lib/python3.
+0001eaa0: 3131 2f73 6974 652d 7061 636b 6167 6573  11/site-packages
+0001eab0: 2f61 6476 616e 6365 645f 7461 2f4c 6f72  /advanced_ta/Lor
+0001eac0: 656e 747a 6961 6e43 6c61 7373 6966 6963  entzianClassific
+0001ead0: 6174 696f 6e2f 436c 6173 7369 6669 6572  ation/Classifier
+0001eae0: 2e70 7922 2c20 6c69 6e65 2031 3836 2c20  .py", line 186, 
+0001eaf0: 696e 205f 5f69 6e69 745f 5f0a 2020 2020  in __init__.    
+0001eb00: 2020 2020 2020 2020 2320 4669 6c65 2022          # File "
+0001eb10: 2f6f 7074 2f68 6f6d 6562 7265 772f 6c69  /opt/homebrew/li
+0001eb20: 622f 7079 7468 6f6e 332e 3131 2f73 6974  b/python3.11/sit
+0001eb30: 652d 7061 636b 6167 6573 2f61 6476 616e  e-packages/advan
+0001eb40: 6365 645f 7461 2f4c 6f72 656e 747a 6961  ced_ta/Lorentzia
+0001eb50: 6e43 6c61 7373 6966 6963 6174 696f 6e2f  nClassification/
+0001eb60: 436c 6173 7369 6669 6572 2e70 7922 2c20  Classifier.py", 
+0001eb70: 6c69 6e65 2033 3935 2c20 696e 205f 5f63  line 395, in __c
+0001eb80: 6c61 7373 6966 790a 2020 2020 2020 2020  lassify.        
+0001eb90: 2020 2020 2320 4669 6c65 2022 2f6f 7074      # File "/opt
+0001eba0: 2f68 6f6d 6562 7265 772f 6c69 622f 7079  /homebrew/lib/py
+0001ebb0: 7468 6f6e 332e 3131 2f73 6974 652d 7061  thon3.11/site-pa
+0001ebc0: 636b 6167 6573 2f70 616e 6461 732f 636f  ckages/pandas/co
+0001ebd0: 7265 2f6f 7073 2f63 6f6d 6d6f 6e2e 7079  re/ops/common.py
+0001ebe0: 222c 206c 696e 6520 3736 2c20 696e 206e  ", line 76, in n
+0001ebf0: 6577 5f6d 6574 686f 640a 2020 2020 2020  ew_method.      
+0001ec00: 2020 2020 2020 2320 4669 6c65 2022 2f6f        # File "/o
+0001ec10: 7074 2f68 6f6d 6562 7265 772f 6c69 622f  pt/homebrew/lib/
+0001ec20: 7079 7468 6f6e 332e 3131 2f73 6974 652d  python3.11/site-
+0001ec30: 7061 636b 6167 6573 2f70 616e 6461 732f  packages/pandas/
+0001ec40: 636f 7265 2f61 7272 6179 6c69 6b65 2e70  core/arraylike.p
+0001ec50: 7922 2c20 6c69 6e65 2037 302c 2069 6e20  y", line 70, in 
+0001ec60: 5f5f 616e 645f 5f0a 2020 2020 2020 2020  __and__.        
+0001ec70: 2020 2020 2320 4669 6c65 2022 2f6f 7074      # File "/opt
+0001ec80: 2f68 6f6d 6562 7265 772f 6c69 622f 7079  /homebrew/lib/py
+0001ec90: 7468 6f6e 332e 3131 2f73 6974 652d 7061  thon3.11/site-pa
+0001eca0: 636b 6167 6573 2f70 616e 6461 732f 636f  ckages/pandas/co
+0001ecb0: 7265 2f73 6572 6965 732e 7079 222c 206c  re/series.py", l
+0001ecc0: 696e 6520 3538 3130 2c20 696e 205f 6c6f  ine 5810, in _lo
+0001ecd0: 6769 6361 6c5f 6d65 7468 6f64 0a20 2020  gical_method.   
+0001ece0: 2020 2020 2020 2020 2023 2046 696c 6520           # File 
+0001ecf0: 222f 6f70 742f 686f 6d65 6272 6577 2f6c  "/opt/homebrew/l
+0001ed00: 6962 2f70 7974 686f 6e33 2e31 312f 7369  ib/python3.11/si
+0001ed10: 7465 2d70 6163 6b61 6765 732f 7061 6e64  te-packages/pand
+0001ed20: 6173 2f63 6f72 652f 6f70 732f 6172 7261  as/core/ops/arra
+0001ed30: 795f 6f70 732e 7079 222c 206c 696e 6520  y_ops.py", line 
+0001ed40: 3435 362c 2069 6e20 6c6f 6769 6361 6c5f  456, in logical_
+0001ed50: 6f70 0a20 2020 2020 2020 2020 2020 2023  op.            #
+0001ed60: 2046 696c 6520 222f 6f70 742f 686f 6d65   File "/opt/home
+0001ed70: 6272 6577 2f6c 6962 2f70 7974 686f 6e33  brew/lib/python3
+0001ed80: 2e31 312f 7369 7465 2d70 6163 6b61 6765  .11/site-package
+0001ed90: 732f 7061 6e64 6173 2f63 6f72 652f 6f70  s/pandas/core/op
+0001eda0: 732f 6172 7261 795f 6f70 732e 7079 222c  s/array_ops.py",
+0001edb0: 206c 696e 6520 3336 342c 2069 6e20 6e61   line 364, in na
+0001edc0: 5f6c 6f67 6963 616c 5f6f 700a 2020 2020  _logical_op.    
+0001edd0: 2020 2020 2020 2020 2320 7365 6c66 2e64          # self.d
+0001ede0: 6566 6175 6c74 5f6c 6f67 6765 722e 6465  efault_logger.de
+0001edf0: 6275 6728 652c 2065 7863 5f69 6e66 6f3d  bug(e, exc_info=
+0001ee00: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0001ee10: 2020 7061 7373 0a20 2020 2020 2020 2072    pass.        r
+0001ee20: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+0001ee30: 2023 2076 616c 6964 6174 6520 6966 2074   # validate if t
+0001ee40: 6865 2073 746f 636b 2068 6173 2062 6565  he stock has bee
+0001ee50: 6e20 6861 7669 6e67 206c 6f77 6572 206c  n having lower l
+0001ee60: 6f77 732c 206c 6f77 6572 2068 6967 6873  ows, lower highs
+0001ee70: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
+0001ee80: 654c 6f77 6572 4869 6768 734c 6f77 6572  eLowerHighsLower
+0001ee90: 4c6f 7773 2873 656c 662c 2064 6629 3a0a  Lows(self, df):.
+0001eea0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+0001eeb0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+0001eec0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0001eed0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0001eee0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0001eef0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+0001ef00: 2064 6179 3020 3d20 6461 7461 0a20 2020   day0 = data.   
+0001ef10: 2020 2020 2064 6179 3120 3d20 6461 7461       day1 = data
+0001ef20: 5b31 3a5d 0a20 2020 2020 2020 2064 6179  [1:].        day
+0001ef30: 3220 3d20 6461 7461 5b32 3a5d 0a20 2020  2 = data[2:].   
+0001ef40: 2020 2020 2064 6179 3320 3d20 6461 7461       day3 = data
+0001ef50: 5b33 3a5d 0a20 2020 2020 2020 206c 6f77  [3:].        low
+0001ef60: 6572 4869 6768 7320 3d20 280a 2020 2020  erHighs = (.    
+0001ef70: 2020 2020 2020 2020 2864 6179 305b 2248          (day0["H
+0001ef80: 6967 6822 5d2e 696c 6f63 5b30 5d20 3c20  igh"].iloc[0] < 
+0001ef90: 6461 7931 5b22 4869 6768 225d 2e69 6c6f  day1["High"].ilo
+0001efa0: 635b 305d 290a 2020 2020 2020 2020 2020  c[0]).          
+0001efb0: 2020 616e 6420 2864 6179 315b 2248 6967    and (day1["Hig
+0001efc0: 6822 5d2e 696c 6f63 5b30 5d20 3c20 6461  h"].iloc[0] < da
+0001efd0: 7932 5b22 4869 6768 225d 2e69 6c6f 635b  y2["High"].iloc[
+0001efe0: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+0001eff0: 616e 6420 2864 6179 325b 2248 6967 6822  and (day2["High"
+0001f000: 5d2e 696c 6f63 5b30 5d20 3c20 6461 7933  ].iloc[0] < day3
+0001f010: 5b22 4869 6768 225d 2e69 6c6f 635b 305d  ["High"].iloc[0]
+0001f020: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+0001f030: 2020 2020 6c6f 7765 724c 6f77 7320 3d20      lowerLows = 
+0001f040: 280a 2020 2020 2020 2020 2020 2020 2864  (.            (d
+0001f050: 6179 305b 224c 6f77 225d 2e69 6c6f 635b  ay0["Low"].iloc[
+0001f060: 305d 203c 2064 6179 315b 224c 6f77 225d  0] < day1["Low"]
+0001f070: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
+0001f080: 2020 2020 2020 616e 6420 2864 6179 315b        and (day1[
+0001f090: 224c 6f77 225d 2e69 6c6f 635b 305d 203c  "Low"].iloc[0] <
+0001f0a0: 2064 6179 325b 224c 6f77 225d 2e69 6c6f   day2["Low"].ilo
+0001f0b0: 635b 305d 290a 2020 2020 2020 2020 2020  c[0]).          
+0001f0c0: 2020 616e 6420 2864 6179 325b 224c 6f77    and (day2["Low
+0001f0d0: 225d 2e69 6c6f 635b 305d 203c 2064 6179  "].iloc[0] < day
+0001f0e0: 335b 224c 6f77 225d 2e69 6c6f 635b 305d  3["Low"].iloc[0]
+0001f0f0: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+0001f100: 2020 2020 6869 6768 6572 5253 4920 3d20      higherRSI = 
+0001f110: 280a 2020 2020 2020 2020 2020 2020 2864  (.            (d
+0001f120: 6179 305b 2252 5349 225d 2e69 6c6f 635b  ay0["RSI"].iloc[
+0001f130: 305d 203c 2064 6179 315b 2252 5349 225d  0] < day1["RSI"]
+0001f140: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
+0001f150: 2020 2020 2020 616e 6420 2864 6179 315b        and (day1[
+0001f160: 2252 5349 225d 2e69 6c6f 635b 305d 203c  "RSI"].iloc[0] <
+0001f170: 2064 6179 325b 2252 5349 225d 2e69 6c6f   day2["RSI"].ilo
+0001f180: 635b 305d 290a 2020 2020 2020 2020 2020  c[0]).          
+0001f190: 2020 616e 6420 2864 6179 325b 2252 5349    and (day2["RSI
+0001f1a0: 225d 2e69 6c6f 635b 305d 203c 2064 6179  "].iloc[0] < day
+0001f1b0: 335b 2252 5349 225d 2e69 6c6f 635b 305d  3["RSI"].iloc[0]
+0001f1c0: 290a 2020 2020 2020 2020 2020 2020 616e  ).            an
+0001f1d0: 6420 6461 7930 5b22 5253 4922 5d2e 696c  d day0["RSI"].il
+0001f1e0: 6f63 5b30 5d20 3e3d 2035 300a 2020 2020  oc[0] >= 50.    
+0001f1f0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+0001f200: 7475 726e 206c 6f77 6572 4869 6768 7320  turn lowerHighs 
+0001f210: 616e 6420 6c6f 7765 724c 6f77 7320 616e  and lowerLows an
+0001f220: 6420 6869 6768 6572 5253 490a 0a20 2020  d higherRSI..   
+0001f230: 2023 2056 616c 6964 6174 6520 6966 2072   # Validate if r
+0001f240: 6563 656e 7420 766f 6c75 6d65 2069 7320  ecent volume is 
+0001f250: 6c6f 7765 7374 206f 6620 6c61 7374 2027  lowest of last '
+0001f260: 4e27 2044 6179 730a 2020 2020 6465 6620  N' Days.    def 
+0001f270: 7661 6c69 6461 7465 4c6f 7765 7374 566f  validateLowestVo
+0001f280: 6c75 6d65 2873 656c 662c 2064 662c 2064  lume(self, df, d
+0001f290: 6179 7346 6f72 4c6f 7765 7374 566f 6c75  aysForLowestVolu
+0001f2a0: 6d65 293a 0a20 2020 2020 2020 2069 6620  me):.        if 
+0001f2b0: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
+0001f2c0: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
+0001f2d0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0001f2e0: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
+0001f2f0: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
+0001f300: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0001f310: 612e 6669 6c6c 6e61 2830 290a 2020 2020  a.fillna(0).    
+0001f320: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+0001f330: 7265 706c 6163 6528 5b6e 702e 696e 662c  replace([np.inf,
+0001f340: 202d 6e70 2e69 6e66 5d2c 2030 290a 2020   -np.inf], 0).  
+0001f350: 2020 2020 2020 6966 2064 6179 7346 6f72        if daysFor
+0001f360: 4c6f 7765 7374 566f 6c75 6d65 2069 7320  LowestVolume is 
+0001f370: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0001f380: 2020 6461 7973 466f 724c 6f77 6573 7456    daysForLowestV
+0001f390: 6f6c 756d 6520 3d20 3330 0a20 2020 2020  olume = 30.     
+0001f3a0: 2020 2069 6620 6c65 6e28 6461 7461 2920     if len(data) 
+0001f3b0: 3c20 6461 7973 466f 724c 6f77 6573 7456  < daysForLowestV
+0001f3c0: 6f6c 756d 653a 0a20 2020 2020 2020 2020  olume:.         
+0001f3d0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0001f3e0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0001f3f0: 6174 612e 6865 6164 2864 6179 7346 6f72  ata.head(daysFor
+0001f400: 4c6f 7765 7374 566f 6c75 6d65 290a 2020  LowestVolume).  
+0001f410: 2020 2020 2020 7265 6365 6e74 203d 2064        recent = d
+0001f420: 6174 612e 6865 6164 2831 290a 2020 2020  ata.head(1).    
+0001f430: 2020 2020 6966 206c 656e 2872 6563 656e      if len(recen
+0001f440: 7429 203c 2031 3a0a 2020 2020 2020 2020  t) < 1:.        
+0001f450: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001f460: 0a20 2020 2020 2020 2069 6620 2872 6563  .        if (rec
+0001f470: 656e 745b 2256 6f6c 756d 6522 5d2e 696c  ent["Volume"].il
+0001f480: 6f63 5b30 5d20 3c3d 2064 6174 612e 6465  oc[0] <= data.de
+0001f490: 7363 7269 6265 2829 5b22 566f 6c75 6d65  scribe()["Volume
+0001f4a0: 225d 5b22 6d69 6e22 5d29 2061 6e64 2072  "]["min"]) and r
+0001f4b0: 6563 656e 745b 0a20 2020 2020 2020 2020  ecent[.         
+0001f4c0: 2020 2022 566f 6c75 6d65 220a 2020 2020     "Volume".    
+0001f4d0: 2020 2020 5d5b 305d 2021 3d20 6e70 2e6e      ][0] != np.n
+0001f4e0: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
+0001f4f0: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+0001f500: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001f510: 0a0a 2020 2020 2320 5661 6c69 6461 7465  ..    # Validate
+0001f520: 204c 5450 2077 6974 6869 6e20 6c69 6d69   LTP within limi
+0001f530: 7473 0a20 2020 2064 6566 2076 616c 6964  ts.    def valid
+0001f540: 6174 654c 5450 2873 656c 662c 2064 662c  ateLTP(self, df,
+0001f550: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
+0001f560: 6544 6963 742c 206d 696e 4c54 503d 4e6f  eDict, minLTP=No
+0001f570: 6e65 2c20 6d61 784c 5450 3d4e 6f6e 652c  ne, maxLTP=None,
+0001f580: 6d69 6e43 6861 6e67 653d 3029 3a0a 2020  minChange=0):.  
+0001f590: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
+0001f5a0: 636f 7079 2829 0a20 2020 2020 2020 206c  copy().        l
+0001f5b0: 7470 5661 6c69 6420 3d20 4661 6c73 650a  tpValid = False.
+0001f5c0: 2020 2020 2020 2020 6966 206d 696e 4c54          if minLT
+0001f5d0: 5020 6973 204e 6f6e 653a 0a20 2020 2020  P is None:.     
+0001f5e0: 2020 2020 2020 206d 696e 4c54 5020 3d20         minLTP = 
+0001f5f0: 7365 6c66 2e63 6f6e 6669 674d 616e 6167  self.configManag
+0001f600: 6572 2e6d 696e 4c54 500a 2020 2020 2020  er.minLTP.      
+0001f610: 2020 6966 206d 6178 4c54 5020 6973 204e    if maxLTP is N
+0001f620: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001f630: 206d 6178 4c54 5020 3d20 7365 6c66 2e63   maxLTP = self.c
+0001f640: 6f6e 6669 674d 616e 6167 6572 2e6d 6178  onfigManager.max
+0001f650: 4c54 500a 2020 2020 2020 2020 6461 7461  LTP.        data
+0001f660: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
+0001f670: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+0001f680: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
+0001f690: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
+0001f6a0: 2030 290a 2020 2020 2020 2020 7265 6365   0).        rece
+0001f6b0: 6e74 203d 2064 6174 612e 6865 6164 2831  nt = data.head(1
+0001f6c0: 290a 0a20 2020 2020 2020 2070 6374 5f63  )..        pct_c
+0001f6d0: 6861 6e67 6520 3d20 2864 6174 615b 3a3a  hange = (data[::
+0001f6e0: 2d31 5d5b 2243 6c6f 7365 225d 2e70 6374  -1]["Close"].pct
+0001f6f0: 5f63 6861 6e67 6528 2920 2a20 3130 3029  _change() * 100)
+0001f700: 2e69 6c6f 635b 2d31 5d0a 2020 2020 2020  .iloc[-1].      
+0001f710: 2020 6966 2070 6374 5f63 6861 6e67 6520    if pct_change 
+0001f720: 3d3d 206e 702e 696e 6620 6f72 2070 6374  == np.inf or pct
+0001f730: 5f63 6861 6e67 6520 3d3d 202d 6e70 2e69  _change == -np.i
+0001f740: 6e66 3a0a 2020 2020 2020 2020 2020 2020  nf:.            
+0001f750: 7063 745f 6368 616e 6765 203d 2030 0a20  pct_change = 0. 
+0001f760: 2020 2020 2020 2070 6374 5f73 6176 6520         pct_save 
+0001f770: 3d20 2225 2e31 6625 2522 2025 2070 6374  = "%.1f%%" % pct
+0001f780: 5f63 6861 6e67 650a 2020 2020 2020 2020  _change.        
+0001f790: 6966 2070 6374 5f63 6861 6e67 6520 3e20  if pct_change > 
+0001f7a0: 302e 323a 0a20 2020 2020 2020 2020 2020  0.2:.           
+0001f7b0: 2070 6374 5f63 6861 6e67 6520 3d20 636f   pct_change = co
+0001f7c0: 6c6f 7254 6578 742e 4752 4545 4e20 2b20  lorText.GREEN + 
+0001f7d0: 2822 252e 3166 2525 2220 2520 7063 745f  ("%.1f%%" % pct_
+0001f7e0: 6368 616e 6765 2920 2b20 636f 6c6f 7254  change) + colorT
+0001f7f0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+0001f800: 656c 6966 2070 6374 5f63 6861 6e67 6520  elif pct_change 
+0001f810: 3c20 2d30 2e32 3a0a 2020 2020 2020 2020  < -0.2:.        
+0001f820: 2020 2020 7063 745f 6368 616e 6765 203d      pct_change =
+0001f830: 2063 6f6c 6f72 5465 7874 2e46 4149 4c20   colorText.FAIL 
+0001f840: 2b20 2822 252e 3166 2525 2220 2520 7063  + ("%.1f%%" % pc
+0001f850: 745f 6368 616e 6765 2920 2b20 636f 6c6f  t_change) + colo
+0001f860: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+0001f870: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001f880: 2020 2020 7063 745f 6368 616e 6765 203d      pct_change =
+0001f890: 2063 6f6c 6f72 5465 7874 2e57 4152 4e20   colorText.WARN 
+0001f8a0: 2b20 2822 252e 3166 2525 2220 2520 7063  + ("%.1f%%" % pc
+0001f8b0: 745f 6368 616e 6765 2920 2b20 636f 6c6f  t_change) + colo
+0001f8c0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+0001f8d0: 2020 7361 7665 4469 6374 5b22 2543 686e    saveDict["%Chn
+0001f8e0: 6722 5d20 3d20 7063 745f 7361 7665 0a20  g"] = pct_save. 
+0001f8f0: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+0001f900: 745b 2225 4368 6e67 225d 203d 2070 6374  t["%Chng"] = pct
+0001f910: 5f63 6861 6e67 650a 2020 2020 2020 2020  _change.        
+0001f920: 6c74 7020 3d20 726f 756e 6428 7265 6365  ltp = round(rece
+0001f930: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
+0001f940: 5b30 5d2c 2032 290a 2020 2020 2020 2020  [0], 2).        
+0001f950: 7665 7269 6679 5374 6167 6554 776f 203d  verifyStageTwo =
+0001f960: 2054 7275 650a 2020 2020 2020 2020 6966   True.        if
+0001f970: 206c 656e 2864 6174 6129 203e 2032 3530   len(data) > 250
+0001f980: 3a0a 2020 2020 2020 2020 2020 2020 7965  :.            ye
+0001f990: 6172 6c79 4c6f 7720 3d20 6461 7461 2e68  arlyLow = data.h
+0001f9a0: 6561 6428 3235 3029 5b22 436c 6f73 6522  ead(250)["Close"
+0001f9b0: 5d2e 6d69 6e28 290a 2020 2020 2020 2020  ].min().        
+0001f9c0: 2020 2020 7965 6172 6c79 4869 6768 203d      yearlyHigh =
+0001f9d0: 2064 6174 612e 6865 6164 2832 3530 295b   data.head(250)[
+0001f9e0: 2243 6c6f 7365 225d 2e6d 6178 2829 0a20  "Close"].max(). 
+0001f9f0: 2020 2020 2020 2020 2020 2069 6620 6c74             if lt
+0001fa00: 7020 3c20 2832 202a 2079 6561 726c 794c  p < (2 * yearlyL
+0001fa10: 6f77 2920 616e 6420 6c74 7020 3c20 2830  ow) and ltp < (0
+0001fa20: 2e37 3520 2a20 7965 6172 6c79 4869 6768  .75 * yearlyHigh
+0001fa30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001fa40: 2020 2076 6572 6966 7953 7461 6765 5477     verifyStageTw
+0001fa50: 6f20 3d20 4661 6c73 650a 2020 2020 2020  o = False.      
+0001fa60: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+0001fa70: 4469 6374 5b22 5374 6f63 6b22 5d20 3d20  Dict["Stock"] = 
+0001fa80: 636f 6c6f 7254 6578 742e 4641 494c 202b  colorText.FAIL +
+0001fa90: 2073 6176 6544 6963 745b 2253 746f 636b   saveDict["Stock
+0001faa0: 225d 202b 2063 6f6c 6f72 5465 7874 2e45  "] + colorText.E
+0001fab0: 4e44 0a20 2020 2020 2020 2069 6620 6c74  ND.        if lt
+0001fac0: 7020 3e3d 206d 696e 4c54 5020 616e 6420  p >= minLTP and 
+0001fad0: 6c74 7020 3c3d 206d 6178 4c54 503a 0a20  ltp <= maxLTP:. 
+0001fae0: 2020 2020 2020 2020 2020 206c 7470 5661             ltpVa
+0001faf0: 6c69 6420 3d20 5472 7565 0a20 2020 2020  lid = True.     
+0001fb00: 2020 2020 2020 2069 6620 6d69 6e43 6861         if minCha
+0001fb10: 6e67 6520 213d 2030 3a0a 2020 2020 2020  nge != 0:.      
+0001fb20: 2020 2020 2020 2020 2020 2320 5573 6572            # User
+0001fb30: 2068 6173 2073 7570 706c 6965 6420 736f   has supplied so
+0001fb40: 6d65 2066 696c 7465 7220 666f 7220 7065  me filter for pe
+0001fb50: 7263 656e 7461 6765 2063 6861 6e67 650a  rcentage change.
+0001fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb70: 6c74 7056 616c 6964 203d 2066 6c6f 6174  ltpValid = float
+0001fb80: 2873 7472 2870 6374 5f73 6176 6529 2e72  (str(pct_save).r
+0001fb90: 6570 6c61 6365 2822 2522 2c22 2229 2920  eplace("%","")) 
+0001fba0: 3e3d 206d 696e 4368 616e 6765 0a20 2020  >= minChange.   
+0001fbb0: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
+0001fbc0: 745b 224c 5450 225d 203d 2072 6f75 6e64  t["LTP"] = round
+0001fbd0: 286c 7470 2c20 3229 0a20 2020 2020 2020  (ltp, 2).       
+0001fbe0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+0001fbf0: 224c 5450 225d 203d 2028 636f 6c6f 7254  "LTP"] = (colorT
+0001fc00: 6578 742e 4752 4545 4e20 6966 206c 7470  ext.GREEN if ltp
+0001fc10: 5661 6c69 6420 656c 7365 2063 6f6c 6f72  Valid else color
+0001fc20: 5465 7874 2e46 4149 4c29 202b 2028 2225  Text.FAIL) + ("%
+0001fc30: 2e32 6622 2025 206c 7470 2920 2b20 636f  .2f" % ltp) + co
+0001fc40: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+0001fc50: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+0001fc60: 7470 5661 6c69 642c 2076 6572 6966 7953  tpValid, verifyS
+0001fc70: 7461 6765 5477 6f0a 2020 2020 2020 2020  tageTwo.        
+0001fc80: 7363 7265 656e 4469 6374 5b22 4c54 5022  screenDict["LTP"
+0001fc90: 5d20 3d20 636f 6c6f 7254 6578 742e 4641  ] = colorText.FA
+0001fca0: 494c 202b 2028 2225 2e32 6622 2025 206c  IL + ("%.2f" % l
+0001fcb0: 7470 2920 2b20 636f 6c6f 7254 6578 742e  tp) + colorText.
+0001fcc0: 454e 440a 2020 2020 2020 2020 7361 7665  END.        save
+0001fcd0: 4469 6374 5b22 4c54 5022 5d20 3d20 726f  Dict["LTP"] = ro
+0001fce0: 756e 6428 6c74 702c 2032 290a 2020 2020  und(ltp, 2).    
+0001fcf0: 2020 2020 7265 7475 726e 206c 7470 5661      return ltpVa
+0001fd00: 6c69 642c 2076 6572 6966 7953 7461 6765  lid, verifyStage
+0001fd10: 5477 6f0a 0a20 2020 2064 6566 2076 616c  Two..    def val
+0001fd20: 6964 6174 654c 5450 466f 7250 6f72 7466  idateLTPForPortf
+0001fd30: 6f6c 696f 4361 6c63 2873 656c 662c 2064  olioCalc(self, d
+0001fd40: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
+0001fd50: 6176 6544 6963 742c 7265 7175 6573 7465  aveDict,requeste
+0001fd60: 6450 6572 696f 643d 3029 3a0a 2020 2020  dPeriod=0):.    
+0001fd70: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
+0001fd80: 7079 2829 0a20 2020 2020 2020 2070 6572  py().        per
+0001fd90: 696f 6473 203d 2073 656c 662e 636f 6e66  iods = self.conf
+0001fda0: 6967 4d61 6e61 6765 722e 7065 7269 6f64  igManager.period
+0001fdb0: 7352 616e 6765 0a20 2020 2020 2020 2069  sRange.        i
+0001fdc0: 6620 7265 7175 6573 7465 6450 6572 696f  f requestedPerio
+0001fdd0: 6420 3e20 3020 616e 6420 7265 7175 6573  d > 0 and reques
+0001fde0: 7465 6450 6572 696f 6420 6e6f 7420 696e  tedPeriod not in
+0001fdf0: 2070 6572 696f 6473 3a0a 2020 2020 2020   periods:.      
+0001fe00: 2020 2020 2020 7065 7269 6f64 732e 6170        periods.ap
+0001fe10: 7065 6e64 2872 6571 7565 7374 6564 5065  pend(requestedPe
+0001fe20: 7269 6f64 290a 2020 2020 2020 2020 7072  riod).        pr
+0001fe30: 6576 696f 7573 5f72 6563 656e 7420 3d20  evious_recent = 
+0001fe40: 6461 7461 2e68 6561 6428 3129 0a20 2020  data.head(1).   
+0001fe50: 2020 2020 2070 7265 7669 6f75 735f 7265       previous_re
+0001fe60: 6365 6e74 2e72 6573 6574 5f69 6e64 6578  cent.reset_index
+0001fe70: 2869 6e70 6c61 6365 3d54 7275 6529 0a20  (inplace=True). 
+0001fe80: 2020 2020 2020 2063 616c 635f 6461 7465         calc_date
+0001fe90: 203d 2073 7472 2870 7265 7669 6f75 735f   = str(previous_
+0001fea0: 7265 6365 6e74 2e69 6c6f 635b 3a2c 2030  recent.iloc[:, 0
+0001feb0: 5d5b 305d 292e 7370 6c69 7428 2220 2229  ][0]).split(" ")
+0001fec0: 5b30 5d0a 2020 2020 2020 2020 666f 7220  [0].        for 
+0001fed0: 7072 6420 696e 2070 6572 696f 6473 3a0a  prd in periods:.
+0001fee0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0001fef0: 656e 2864 6174 6129 203e 3d20 7072 6420  en(data) >= prd 
+0001ff00: 2b20 313a 0a20 2020 2020 2020 2020 2020  + 1:.           
+0001ff10: 2020 2020 2070 7265 764c 7470 203d 2064       prevLtp = d
+0001ff20: 6174 615b 2243 6c6f 7365 225d 2e69 6c6f  ata["Close"].ilo
+0001ff30: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
+0001ff40: 2020 2020 206c 7470 5464 7920 3d20 6461       ltpTdy = da
+0001ff50: 7461 5b22 436c 6f73 6522 5d2e 696c 6f63  ta["Close"].iloc
+0001ff60: 5b70 7264 5d0a 2020 2020 2020 2020 2020  [prd].          
+0001ff70: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0001ff80: 6e63 6528 7072 6576 4c74 702c 7064 2e53  nce(prevLtp,pd.S
+0001ff90: 6572 6965 7329 3a0a 2020 2020 2020 2020  eries):.        
+0001ffa0: 2020 2020 2020 2020 2020 2020 7072 6576              prev
+0001ffb0: 4c74 7020 3d20 7072 6576 4c74 705b 305d  Ltp = prevLtp[0]
+0001ffc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ffd0: 2020 2020 206c 7470 5464 7920 3d20 6c74       ltpTdy = lt
+0001ffe0: 7054 6479 5b30 5d0a 2020 2020 2020 2020  pTdy[0].        
+0001fff0: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+00020000: 6374 5b66 224c 5450 7b70 7264 7d22 5d20  ct[f"LTP{prd}"] 
+00020010: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00020020: 2020 2020 2020 2020 2863 6f6c 6f72 5465          (colorTe
+00020030: 7874 2e47 5245 454e 2069 6620 286c 7470  xt.GREEN if (ltp
+00020040: 5464 7920 3e3d 2070 7265 764c 7470 2920  Tdy >= prevLtp) 
+00020050: 656c 7365 2028 636f 6c6f 7254 6578 742e  else (colorText.
+00020060: 4641 494c 2929 0a20 2020 2020 2020 2020  FAIL)).         
+00020070: 2020 2020 2020 2020 2020 202b 2073 7472             + str
+00020080: 2822 7b3a 2e32 667d 222e 666f 726d 6174  ("{:.2f}".format
+00020090: 286c 7470 5464 7929 290a 2020 2020 2020  (ltpTdy)).      
+000200a0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+000200b0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+000200c0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000200d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200e0: 7363 7265 656e 4469 6374 5b66 2247 726f  screenDict[f"Gro
+000200f0: 7774 687b 7072 647d 225d 203d 2028 0a20  wth{prd}"] = (. 
+00020100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020110: 2020 2028 636f 6c6f 7254 6578 742e 4752     (colorText.GR
+00020120: 4545 4e20 6966 2028 6c74 7054 6479 203e  EEN if (ltpTdy >
+00020130: 3d20 7072 6576 4c74 7029 2065 6c73 6520  = prevLtp) else 
+00020140: 2863 6f6c 6f72 5465 7874 2e46 4149 4c29  (colorText.FAIL)
+00020150: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020160: 2020 2020 2020 2b20 7374 7228 227b 3a2e        + str("{:.
+00020170: 3266 7d22 2e66 6f72 6d61 7428 6c74 7054  2f}".format(ltpT
+00020180: 6479 202d 2070 7265 764c 7470 2929 0a20  dy - prevLtp)). 
+00020190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000201a0: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
+000201b0: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
+000201c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000201d0: 2020 2020 2073 6176 6544 6963 745b 6622       saveDict[f"
+000201e0: 4c54 507b 7072 647d 225d 203d 2072 6f75  LTP{prd}"] = rou
+000201f0: 6e64 286c 7470 5464 792c 2032 290a 2020  nd(ltpTdy, 2).  
+00020200: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00020210: 7665 4469 6374 5b66 2247 726f 7774 687b  veDict[f"Growth{
+00020220: 7072 647d 225d 203d 2072 6f75 6e64 286c  prd}"] = round(l
+00020230: 7470 5464 7920 2d20 7072 6576 4c74 702c  tpTdy - prevLtp,
+00020240: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+00020250: 2020 2020 6966 2070 7264 203d 3d20 3232      if prd == 22
+00020260: 206f 7220 2870 7264 203d 3d20 7265 7175   or (prd == requ
+00020270: 6573 7465 6450 6572 696f 6429 3a0a 2020  estedPeriod):.  
+00020280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020290: 2020 6368 616e 6765 5065 7263 656e 7420    changePercent 
+000202a0: 3d20 726f 756e 6428 2828 7072 6576 4c74  = round(((prevLt
+000202b0: 702d 6c74 7054 6479 2920 6966 2072 6571  p-ltpTdy) if req
+000202c0: 7565 7374 6564 5065 7269 6f64 203d 3d30  uestedPeriod ==0
+000202d0: 2065 6c73 6520 286c 7470 5464 7920 2d20   else (ltpTdy - 
+000202e0: 7072 6576 4c74 7029 292a 3130 302f 6c74  prevLtp))*100/lt
+000202f0: 7054 6479 2c20 3229 0a20 2020 2020 2020  pTdy, 2).       
+00020300: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00020310: 6544 6963 745b 6622 7b70 7264 7d2d 5064  eDict[f"{prd}-Pd
+00020320: 2025 225d 203d 2066 227b 6368 616e 6765   %"] = f"{change
+00020330: 5065 7263 656e 747d 2522 2069 6620 6e6f  Percent}%" if no
+00020340: 7420 7064 2e69 736e 6128 6368 616e 6765  t pd.isna(change
+00020350: 5065 7263 656e 7429 2065 6c73 6520 272d  Percent) else '-
+00020360: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00020370: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+00020380: 5b66 227b 7072 647d 2d50 6420 2522 5d20  [f"{prd}-Pd %"] 
+00020390: 3d20 2828 636f 6c6f 7254 6578 742e 4752  = ((colorText.GR
+000203a0: 4545 4e20 6966 2063 6861 6e67 6550 6572  EEN if changePer
+000203b0: 6365 6e74 203e 3d30 2065 6c73 6520 636f  cent >=0 else co
+000203c0: 6c6f 7254 6578 742e 4641 494c 2920 2b20  lorText.FAIL) + 
+000203d0: 6622 7b63 6861 6e67 6550 6572 6365 6e74  f"{changePercent
+000203e0: 7d25 2220 2b20 636f 6c6f 7254 6578 742e  }%" + colorText.
+000203f0: 454e 4429 2069 6620 6e6f 7420 7064 2e69  END) if not pd.i
+00020400: 736e 6128 6368 616e 6765 5065 7263 656e  sna(changePercen
+00020410: 7429 2065 6c73 6520 272d 270a 2020 2020  t) else '-'.    
+00020420: 2020 2020 2020 2020 2020 2020 7363 7265              scre
+00020430: 656e 4469 6374 5b22 4461 7465 225d 203d  enDict["Date"] =
+00020440: 2063 616c 635f 6461 7465 0a20 2020 2020   calc_date.     
+00020450: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+00020460: 6963 745b 2244 6174 6522 5d20 3d20 6361  ict["Date"] = ca
+00020470: 6c63 5f64 6174 650a 2020 2020 2020 2020  lc_date.        
+00020480: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00020490: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
+000204a0: 6374 5b66 224c 5450 7b70 7264 7d22 5d20  ct[f"LTP{prd}"] 
+000204b0: 3d20 6e70 2e6e 616e 0a20 2020 2020 2020  = np.nan.       
+000204c0: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
+000204d0: 745b 6622 4772 6f77 7468 7b70 7264 7d22  t[f"Growth{prd}"
+000204e0: 5d20 3d20 6e70 2e6e 616e 0a20 2020 2020  ] = np.nan.     
+000204f0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+00020500: 6e44 6963 745b 2244 6174 6522 5d20 3d20  nDict["Date"] = 
+00020510: 6361 6c63 5f64 6174 650a 2020 2020 2020  calc_date.      
+00020520: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
+00020530: 6374 5b22 4461 7465 225d 203d 2063 616c  ct["Date"] = cal
+00020540: 635f 6461 7465 0a0a 2020 2020 2320 4669  c_date..    # Fi
+00020550: 6e64 2073 746f 636b 7320 7468 6174 2061  nd stocks that a
+00020560: 7265 2062 6561 7269 7368 2069 6e74 7261  re bearish intra
+00020570: 6461 793a 204d 6163 6420 4869 7374 6f67  day: Macd Histog
+00020580: 7261 6d20 6e65 6761 7469 7665 0a20 2020  ram negative.   
+00020590: 2064 6566 2076 616c 6964 6174 654d 4143   def validateMAC
+000205a0: 4448 6973 746f 6772 616d 4265 6c6f 7730  DHistogramBelow0
+000205b0: 2873 656c 662c 2064 6629 3a0a 2020 2020  (self, df):.    
+000205c0: 2020 2020 6966 2064 6620 6973 204e 6f6e      if df is Non
+000205d0: 6520 6f72 206c 656e 2864 6629 203d 3d20  e or len(df) == 
+000205e0: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+000205f0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00020600: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
+00020610: 7079 2829 0a20 2020 2020 2020 2064 6174  py().        dat
+00020620: 6120 3d20 6461 7461 2e66 696c 6c6e 6128  a = data.fillna(
+00020630: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
+00020640: 3d20 6461 7461 2e72 6570 6c61 6365 285b  = data.replace([
+00020650: 6e70 2e69 6e66 2c20 2d6e 702e 696e 665d  np.inf, -np.inf]
+00020660: 2c20 3029 0a20 2020 2020 2020 2064 6174  , 0).        dat
+00020670: 6120 3d20 6461 7461 5b3a 3a2d 315d 2020  a = data[::-1]  
+00020680: 2320 5265 7665 7273 6520 7468 6520 6461  # Reverse the da
+00020690: 7461 6672 616d 6520 736f 2074 6861 7420  taframe so that 
+000206a0: 6974 7320 7468 6520 6f6c 6465 7374 2064  its the oldest d
+000206b0: 6174 6520 6669 7273 740a 2020 2020 2020  ate first.      
+000206c0: 2020 6d61 6364 203d 2070 6b74 616c 6962    macd = pktalib
+000206d0: 2e4d 4143 4428 6461 7461 5b22 436c 6f73  .MACD(data["Clos
+000206e0: 6522 5d2c 2031 322c 2032 362c 2039 295b  e"], 12, 26, 9)[
+000206f0: 325d 2e74 6169 6c28 3129 0a20 2020 2020  2].tail(1).     
+00020700: 2020 2072 6574 7572 6e20 6d61 6364 2e69     return macd.i
+00020710: 6c6f 635b 3a31 5d5b 305d 203c 2030 0a0a  loc[:1][0] < 0..
+00020720: 2020 2020 2340 6d65 6173 7572 655f 7469      #@measure_ti
+00020730: 6d65 0a20 2020 2023 2046 696e 6420 6966  me.    # Find if
+00020740: 2073 746f 636b 2067 6169 6e69 6e67 2062   stock gaining b
+00020750: 756c 6c69 7368 206d 6f6d 656e 7475 6d0a  ullish momentum.
+00020760: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
+00020770: 4d6f 6d65 6e74 756d 2873 656c 662c 2064  Momentum(self, d
+00020780: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
+00020790: 6176 6544 6963 7429 3a0a 2020 2020 2020  aveDict):.      
+000207a0: 2020 6966 2064 6620 6973 204e 6f6e 6520    if df is None 
+000207b0: 6f72 206c 656e 2864 6629 203d 3d20 303a  or len(df) == 0:
+000207c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000207d0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
+000207e0: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
+000207f0: 2829 0a20 2020 2020 2020 2074 7279 3a0a  ().        try:.
+00020800: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00020810: 203d 2064 6174 612e 6865 6164 2833 290a   = data.head(3).
+00020820: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00020830: 656e 2864 6174 6129 203c 2033 3a0a 2020  en(data) < 3:.  
+00020840: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00020850: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00020860: 2020 2020 2020 2066 6f72 2072 6f77 2069         for row i
+00020870: 6e20 6461 7461 2e69 7465 7272 6f77 7328  n data.iterrows(
+00020880: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00020890: 2020 2023 2041 6c6c 2033 2063 616e 646c     # All 3 candl
+000208a0: 6573 2073 686f 756c 6420 6265 2047 7265  es should be Gre
+000208b0: 656e 2061 6e64 204e 4f54 2043 6972 6375  en and NOT Circu
+000208c0: 6974 730a 2020 2020 2020 2020 2020 2020  its.            
+000208d0: 2020 2020 7963 203d 2072 6f77 5b31 5d5b      yc = row[1][
+000208e0: 2243 6c6f 7365 225d 0a20 2020 2020 2020  "Close"].       
+000208f0: 2020 2020 2020 2020 2079 6f20 3d20 726f           yo = ro
+00020900: 775b 315d 5b22 4f70 656e 225d 0a20 2020  w[1]["Open"].   
+00020910: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00020920: 7963 203c 3d20 796f 3a0a 2020 2020 2020  yc <= yo:.      
+00020930: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00020940: 7365 6c66 2e64 6566 6175 6c74 5f6c 6f67  self.default_log
+00020950: 6765 722e 696e 666f 280a 2020 2020 2020  ger.info(.      
+00020960: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00020970: 2020 2020 6627 5374 6f63 6b3a 7b73 6176      f'Stock:{sav
+00020980: 6544 6963 745b 2253 746f 636b 225d 7d2c  eDict["Stock"]},
+00020990: 2069 7320 6e6f 7420 6120 6d6f 6d65 6e74   is not a moment
+000209a0: 756d 2d67 6169 6e65 7220 6265 6361 7573  um-gainer becaus
+000209b0: 6520 7965 7374 6572 6461 792d 636c 6f73  e yesterday-clos
+000209c0: 6520 287b 7963 7d29 203c 3d20 7965 7374  e ({yc}) <= yest
+000209d0: 6572 6461 792d 6f70 656e 2028 7b79 6f7d  erday-open ({yo}
+000209e0: 2927 0a20 2020 2020 2020 2020 2020 2020  )'.             
+000209f0: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
+00020a00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00020a10: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00020a20: 2020 2020 2020 2020 6f70 656e 4465 7363          openDesc
+00020a30: 203d 2064 6174 612e 736f 7274 5f76 616c   = data.sort_val
+00020a40: 7565 7328 6279 3d5b 224f 7065 6e22 5d2c  ues(by=["Open"],
+00020a50: 2061 7363 656e 6469 6e67 3d46 616c 7365   ascending=False
+00020a60: 290a 2020 2020 2020 2020 2020 2020 636c  ).            cl
+00020a70: 6f73 6544 6573 6320 3d20 6461 7461 2e73  oseDesc = data.s
+00020a80: 6f72 745f 7661 6c75 6573 2862 793d 5b22  ort_values(by=["
+00020a90: 436c 6f73 6522 5d2c 2061 7363 656e 6469  Close"], ascendi
+00020aa0: 6e67 3d46 616c 7365 290a 2020 2020 2020  ng=False).      
+00020ab0: 2020 2020 2020 766f 6c44 6573 6320 3d20        volDesc = 
+00020ac0: 6461 7461 2e73 6f72 745f 7661 6c75 6573  data.sort_values
+00020ad0: 2862 793d 5b22 566f 6c75 6d65 225d 2c20  (by=["Volume"], 
+00020ae0: 6173 6365 6e64 696e 673d 4661 6c73 6529  ascending=False)
+00020af0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+00020b00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00020b10: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
+00020b20: 2020 2020 2020 2020 2020 2064 6174 612e             data.
+00020b30: 6571 7561 6c73 286f 7065 6e44 6573 6329  equals(openDesc)
+00020b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020b50: 2020 2020 2061 6e64 2064 6174 612e 6571       and data.eq
+00020b60: 7561 6c73 2863 6c6f 7365 4465 7363 290a  uals(closeDesc).
+00020b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b80: 2020 2020 616e 6420 6461 7461 2e65 7175      and data.equ
+00020b90: 616c 7328 766f 6c44 6573 6329 0a20 2020  als(volDesc).   
+00020ba0: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
+00020bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020bc0: 2020 2020 2320 7365 6c66 2e64 6566 6175      # self.defau
+00020bd0: 6c74 5f6c 6f67 6765 722e 696e 666f 280a  lt_logger.info(.
+00020be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020bf0: 2020 2020 2320 2020 2020 6627 5374 6f63      #     f'Stoc
+00020c00: 6b3a 7b73 6176 6544 6963 745b 2253 746f  k:{saveDict["Sto
+00020c10: 636b 225d 7d2c 206f 7065 6e2c 636c 6f73  ck"]}, open,clos
+00020c20: 6520 616e 6420 766f 6c75 6d65 2065 7175  e and volume equ
+00020c30: 616c 2066 726f 6d20 6461 7920 6265 666f  al from day befo
+00020c40: 7265 2079 6573 7465 7264 6179 2e20 4120  re yesterday. A 
+00020c50: 706f 7465 6e74 6961 6c20 6d6f 6d65 6e74  potential moment
+00020c60: 756d 2d67 6169 6e65 7221 270a 2020 2020  um-gainer!'.    
+00020c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c80: 2320 290a 2020 2020 2020 2020 2020 2020  # ).            
+00020c90: 2020 2020 2020 2020 746f 203d 2064 6174          to = dat
+00020ca0: 615b 224f 7065 6e22 5d2e 696c 6f63 5b30  a["Open"].iloc[0
+00020cb0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00020cc0: 2020 2020 2020 7963 203d 2064 6174 615b        yc = data[
+00020cd0: 2243 6c6f 7365 225d 2e69 6c6f 635b 315d  "Close"].iloc[1]
+00020ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020cf0: 2020 2020 2079 6f20 3d20 6461 7461 5b22       yo = data["
+00020d00: 4f70 656e 225d 2e69 6c6f 635b 315d 0a20  Open"].iloc[1]. 
+00020d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d20: 2020 2064 7963 203d 2064 6174 615b 2243     dyc = data["C
+00020d30: 6c6f 7365 225d 2e69 6c6f 635b 325d 0a20  lose"].iloc[2]. 
+00020d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d50: 2020 2069 6620 2874 6f20 3e3d 2079 6329     if (to >= yc)
+00020d60: 2061 6e64 2028 796f 203e 3d20 6479 6329   and (yo >= dyc)
+00020d70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00020d80: 2020 2020 2020 2020 2020 2320 7365 6c66            # self
+00020d90: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
+00020da0: 696e 666f 280a 2020 2020 2020 2020 2020  info(.          
+00020db0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00020dc0: 2020 2020 6627 5374 6f63 6b3a 7b73 6176      f'Stock:{sav
+00020dd0: 6544 6963 745b 2253 746f 636b 225d 7d2c  eDict["Stock"]},
+00020de0: 2069 7320 6120 6d6f 6d65 6e74 756d 2d67   is a momentum-g
+00020df0: 6169 6e65 7220 6265 6361 7573 6520 746f  ainer because to
+00020e00: 6461 792d 6f70 656e 2028 7b74 6f7d 2920  day-open ({to}) 
+00020e10: 3e3d 2079 6573 7465 7264 6179 2d63 6c6f  >= yesterday-clo
+00020e20: 7365 2028 7b79 637d 2920 616e 6420 7965  se ({yc}) and ye
+00020e30: 7374 6572 6461 792d 6f70 656e 287b 796f  sterday-open({yo
+00020e40: 7d29 203e 3d20 6461 792d 6265 666f 7265  }) >= day-before
+00020e50: 2d63 6c6f 7365 287b 6479 637d 2927 0a20  -close({dyc})'. 
+00020e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e70: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
 00020e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00020ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020eb0: 7361 7665 4469 6374 5b22 5061 7474 6572  saveDict["Patter
-00020ec0: 6e22 5d20 3d20 7361 7665 645b 315d 202b  n"] = saved[1] +
-00020ed0: 2022 4d6f 6d65 6e74 756d 2047 6169 6e65   "Momentum Gaine
-00020ee0: 7222 0a20 2020 2020 2020 2020 2020 2020  r".             
-00020ef0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00020f00: 6e20 5472 7565 0a20 2020 2020 2020 2020  n True.         
-00020f10: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
-00020f20: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
-00020f30: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
-00020f40: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00020f50: 2066 2753 746f 636b 3a7b 7361 7665 4469   f'Stock:{saveDi
-00020f60: 6374 5b22 5374 6f63 6b22 5d7d 2c20 6973  ct["Stock"]}, is
-00020f70: 206e 6f74 2061 206d 6f6d 656e 7475 6d2d   not a momentum-
-00020f80: 6761 696e 6572 2062 6563 6175 7365 2065  gainer because e
-00020f90: 6974 6865 7220 746f 6461 792d 6f70 656e  ither today-open
-00020fa0: 2028 7b74 6f7d 2920 3c20 7965 7374 6572   ({to}) < yester
-00020fb0: 6461 792d 636c 6f73 6520 287b 7963 7d29  day-close ({yc})
-00020fc0: 206f 7220 7965 7374 6572 6461 792d 6f70   or yesterday-op
-00020fd0: 656e 287b 796f 7d29 203c 2064 6179 2d62  en({yo}) < day-b
-00020fe0: 6566 6f72 652d 636c 6f73 6528 7b64 7963  efore-close({dyc
-00020ff0: 7d29 270a 2020 2020 2020 2020 2020 2020  })'.            
-00021000: 2020 2020 2020 2020 2320 290a 2020 2020          # ).    
-00021010: 2020 2020 2020 2020 6578 6365 7074 2049          except I
-00021020: 6e64 6578 4572 726f 7220 6173 2065 3a20  ndexError as e: 
-00021030: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
-00021040: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-00021050: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
-00021060: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
-00021070: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
-00021080: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00021090: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
-000210a0: 6572 2e64 6562 7567 2864 6174 6129 0a20  er.debug(data). 
-000210b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000210c0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-000210d0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-000210e0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-000210f0: 7074 696f 6e20 6173 2065 3a20 2023 2070  ption as e:  # p
-00021100: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
-00021110: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00021120: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
-00021130: 6465 6275 6728 652c 2065 7863 5f69 6e66  debug(e, exc_inf
-00021140: 6f3d 5472 7565 290a 2020 2020 2020 2020  o=True).        
-00021150: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00021160: 0a0a 2020 2020 2340 6d65 6173 7572 655f  ..    #@measure_
-00021170: 7469 6d65 0a20 2020 2023 2056 616c 6964  time.    # Valid
-00021180: 6174 6520 4d6f 7669 6e67 2061 7665 7261  ate Moving avera
-00021190: 6765 7320 616e 6420 6c6f 6f6b 2066 6f72  ges and look for
-000211a0: 2062 7579 2f73 656c 6c20 7369 676e 616c   buy/sell signal
-000211b0: 730a 2020 2020 6465 6620 7661 6c69 6461  s.    def valida
-000211c0: 7465 4d6f 7669 6e67 4176 6572 6167 6573  teMovingAverages
-000211d0: 2873 656c 662c 2064 662c 2073 6372 6565  (self, df, scree
-000211e0: 6e44 6963 742c 2073 6176 6544 6963 742c  nDict, saveDict,
-000211f0: 206d 6152 616e 6765 3d32 2e35 2c6d 614c   maRange=2.5,maL
-00021200: 656e 6774 683d 3029 3a0a 2020 2020 2020  ength=0):.      
-00021210: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-00021220: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
-00021230: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-00021240: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00021250: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
-00021260: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
-00021270: 3029 0a20 2020 2020 2020 2072 6563 656e  0).        recen
-00021280: 7420 3d20 6461 7461 2e68 6561 6428 3129  t = data.head(1)
-00021290: 0a20 2020 2020 2020 206d 6153 6967 6e61  .        maSigna
-000212a0: 6c73 203d 205b 5d0a 2020 2020 2020 2020  ls = [].        
-000212b0: 6966 2073 7472 286d 614c 656e 6774 6829  if str(maLength)
-000212c0: 2069 6e20 5b22 3022 2c22 3222 2c22 3322   in ["0","2","3"
-000212d0: 5d3a 0a20 2020 2020 2020 2020 2020 2073  ]:.            s
-000212e0: 6176 6564 203d 2073 656c 662e 6669 6e64  aved = self.find
-000212f0: 4375 7272 656e 7453 6176 6564 5661 6c75  CurrentSavedValu
-00021300: 6528 7363 7265 656e 4469 6374 2c73 6176  e(screenDict,sav
-00021310: 6544 6963 742c 224d 412d 5369 676e 616c  eDict,"MA-Signal
-00021320: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-00021330: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00021340: 2020 2020 7265 6365 6e74 5b22 534d 4122      recent["SMA"
-00021350: 5d2e 696c 6f63 5b30 5d20 3e20 7265 6365  ].iloc[0] > rece
-00021360: 6e74 5b22 4c4d 4122 5d2e 696c 6f63 5b30  nt["LMA"].iloc[0
-00021370: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00021380: 2020 616e 6420 7265 6365 6e74 5b22 436c    and recent["Cl
-00021390: 6f73 6522 5d2e 696c 6f63 5b30 5d20 3e20  ose"].iloc[0] > 
-000213a0: 7265 6365 6e74 5b22 534d 4122 5d2e 696c  recent["SMA"].il
-000213b0: 6f63 5b30 5d0a 2020 2020 2020 2020 2020  oc[0].          
-000213c0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-000213d0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-000213e0: 224d 412d 5369 676e 616c 225d 203d 2028  "MA-Signal"] = (
-000213f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021400: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
-00021410: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
-00021420: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
-00021430: 202b 2022 4275 6c6c 6973 6822 202b 2063   + "Bullish" + c
-00021440: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-00021450: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00021460: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00021470: 6176 6544 6963 745b 224d 412d 5369 676e  aveDict["MA-Sign
-00021480: 616c 225d 203d 2073 6176 6564 5b31 5d20  al"] = saved[1] 
-00021490: 2b20 2242 756c 6c69 7368 220a 2020 2020  + "Bullish".    
-000214a0: 2020 2020 2020 2020 2020 2020 6d61 5369              maSi
-000214b0: 676e 616c 732e 6170 7065 6e64 2822 3322  gnals.append("3"
-000214c0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-000214d0: 6966 2072 6563 656e 745b 2253 4d41 225d  if recent["SMA"]
-000214e0: 2e69 6c6f 635b 305d 203c 2072 6563 656e  .iloc[0] < recen
-000214f0: 745b 224c 4d41 225d 2e69 6c6f 635b 305d  t["LMA"].iloc[0]
-00021500: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021510: 2020 7363 7265 656e 4469 6374 5b22 4d41    screenDict["MA
-00021520: 2d53 6967 6e61 6c22 5d20 3d20 280a 2020  -Signal"] = (.  
-00021530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021540: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
-00021550: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-00021560: 6c6f 7254 6578 742e 4641 494c 202b 2022  lorText.FAIL + "
-00021570: 4265 6172 6973 6822 202b 2063 6f6c 6f72  Bearish" + color
-00021580: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-00021590: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000215a0: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-000215b0: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
-000215c0: 203d 2073 6176 6564 5b31 5d20 2b20 2242   = saved[1] + "B
-000215d0: 6561 7269 7368 220a 2020 2020 2020 2020  earish".        
-000215e0: 2020 2020 2020 2020 6d61 5369 676e 616c          maSignal
-000215f0: 732e 6170 7065 6e64 2822 3222 290a 2020  s.append("2").  
-00021600: 2020 2020 2020 2020 2020 656c 6966 2072            elif r
-00021610: 6563 656e 745b 2253 4d41 225d 2e69 6c6f  ecent["SMA"].ilo
-00021620: 635b 305d 203d 3d20 303a 0a20 2020 2020  c[0] == 0:.     
-00021630: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-00021640: 6e44 6963 745b 224d 412d 5369 676e 616c  nDict["MA-Signal
-00021650: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-00021660: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-00021670: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-00021680: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
-00021690: 2e57 4152 4e20 2b20 2255 6e6b 6e6f 776e  .WARN + "Unknown
-000216a0: 2220 2b20 636f 6c6f 7254 6578 742e 454e  " + colorText.EN
-000216b0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-000216c0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000216d0: 2020 2020 7361 7665 4469 6374 5b22 4d41      saveDict["MA
-000216e0: 2d53 6967 6e61 6c22 5d20 3d20 7361 7665  -Signal"] = save
-000216f0: 645b 315d 202b 2022 556e 6b6e 6f77 6e22  d[1] + "Unknown"
-00021700: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00021710: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00021720: 2020 2073 6372 6565 6e44 6963 745b 224d     screenDict["M
-00021730: 412d 5369 676e 616c 225d 203d 2028 0a20  A-Signal"] = (. 
-00021740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021750: 2020 2073 6176 6564 5b30 5d20 2b20 636f     saved[0] + co
-00021760: 6c6f 7254 6578 742e 424f 4c44 202b 2063  lorText.BOLD + c
-00021770: 6f6c 6f72 5465 7874 2e57 4152 4e20 2b20  olorText.WARN + 
-00021780: 224e 6575 7472 616c 2220 2b20 636f 6c6f  "Neutral" + colo
-00021790: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-000217a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000217b0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-000217c0: 4469 6374 5b22 4d41 2d53 6967 6e61 6c22  Dict["MA-Signal"
-000217d0: 5d20 3d20 7361 7665 645b 315d 202b 2022  ] = saved[1] + "
-000217e0: 4e65 7574 7261 6c22 0a20 2020 2020 2020  Neutral".       
-000217f0: 2072 6576 6572 7365 6444 6174 6120 3d20   reversedData = 
-00021800: 6461 7461 5b3a 3a2d 315d 2020 2320 5265  data[::-1]  # Re
-00021810: 7665 7273 6520 7468 6520 6461 7461 6672  verse the datafr
-00021820: 616d 650a 2020 2020 2020 2020 656d 615f  ame.        ema_
-00021830: 3230 203d 2070 6b74 616c 6962 2e45 4d41  20 = pktalib.EMA
-00021840: 2872 6576 6572 7365 6444 6174 615b 2243  (reversedData["C
-00021850: 6c6f 7365 225d 2c32 3029 2e74 6169 6c28  lose"],20).tail(
-00021860: 3129 2e69 6c6f 635b 305d 0a20 2020 2020  1).iloc[0].     
-00021870: 2020 2076 7761 7020 3d20 706b 7461 6c69     vwap = pktali
-00021880: 622e 5657 4150 2872 6576 6572 7365 6444  b.VWAP(reversedD
-00021890: 6174 615b 2248 6967 6822 5d2c 7265 7665  ata["High"],reve
-000218a0: 7273 6564 4461 7461 5b22 4c6f 7722 5d2c  rsedData["Low"],
-000218b0: 7265 7665 7273 6564 4461 7461 5b22 436c  reversedData["Cl
-000218c0: 6f73 6522 5d2c 7265 7665 7273 6564 4461  ose"],reversedDa
-000218d0: 7461 5b22 566f 6c75 6d65 225d 292e 7461  ta["Volume"]).ta
-000218e0: 696c 2831 292e 696c 6f63 5b30 5d0a 2020  il(1).iloc[0].  
-000218f0: 2020 2020 2020 736d 6144 6576 203d 2064        smaDev = d
-00021900: 6174 615b 2253 4d41 225d 2e69 6c6f 635b  ata["SMA"].iloc[
-00021910: 305d 202a 206d 6152 616e 6765 202f 2031  0] * maRange / 1
-00021920: 3030 0a20 2020 2020 2020 206c 6d61 4465  00.        lmaDe
-00021930: 7620 3d20 6461 7461 5b22 4c4d 4122 5d2e  v = data["LMA"].
-00021940: 696c 6f63 5b30 5d20 2a20 6d61 5261 6e67  iloc[0] * maRang
-00021950: 6520 2f20 3130 300a 2020 2020 2020 2020  e / 100.        
-00021960: 656d 6144 6576 203d 2065 6d61 5f32 3020  emaDev = ema_20 
-00021970: 2a20 6d61 5261 6e67 6520 2f20 3130 300a  * maRange / 100.
-00021980: 2020 2020 2020 2020 7677 6170 4465 7620          vwapDev 
-00021990: 3d20 7677 6170 202a 206d 6152 616e 6765  = vwap * maRange
-000219a0: 202f 2031 3030 0a20 2020 2020 2020 206f   / 100.        o
-000219b0: 7065 6e2c 2068 6967 682c 206c 6f77 2c20  pen, high, low, 
-000219c0: 636c 6f73 652c 2073 6d61 2c20 6c6d 6120  close, sma, lma 
-000219d0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-000219e0: 6461 7461 5b22 4f70 656e 225d 2e69 6c6f  data["Open"].ilo
-000219f0: 635b 305d 2c0a 2020 2020 2020 2020 2020  c[0],.          
-00021a00: 2020 6461 7461 5b22 4869 6768 225d 2e69    data["High"].i
-00021a10: 6c6f 635b 305d 2c0a 2020 2020 2020 2020  loc[0],.        
-00021a20: 2020 2020 6461 7461 5b22 4c6f 7722 5d2e      data["Low"].
-00021a30: 696c 6f63 5b30 5d2c 0a20 2020 2020 2020  iloc[0],.       
-00021a40: 2020 2020 2064 6174 615b 2243 6c6f 7365       data["Close
-00021a50: 225d 2e69 6c6f 635b 305d 2c0a 2020 2020  "].iloc[0],.    
-00021a60: 2020 2020 2020 2020 6461 7461 5b22 534d          data["SM
-00021a70: 4122 5d2e 696c 6f63 5b30 5d2c 0a20 2020  A"].iloc[0],.   
-00021a80: 2020 2020 2020 2020 2064 6174 615b 224c           data["L
-00021a90: 4d41 225d 2e69 6c6f 635b 305d 2c0a 2020  MA"].iloc[0],.  
-00021aa0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00021ab0: 6d61 7320 3d20 5b73 6d61 2c6c 6d61 2c65  mas = [sma,lma,e
-00021ac0: 6d61 5f32 302c 7677 6170 5d20 6966 206d  ma_20,vwap] if m
-00021ad0: 614c 656e 6774 683d 3d30 2065 6c73 6520  aLength==0 else 
-00021ae0: 5b73 6d61 2c6c 6d61 2c65 6d61 5f32 305d  [sma,lma,ema_20]
-00021af0: 0a20 2020 2020 2020 206d 6144 6576 7320  .        maDevs 
-00021b00: 3d20 5b73 6d61 4465 762c 206c 6d61 4465  = [smaDev, lmaDe
-00021b10: 762c 2065 6d61 4465 762c 2076 7761 7044  v, emaDev, vwapD
-00021b20: 6576 5d20 6966 206d 614c 656e 6774 683d  ev] if maLength=
-00021b30: 3d30 2065 6c73 6520 5b73 6d61 4465 762c  =0 else [smaDev,
-00021b40: 206c 6d61 4465 762c 2065 6d61 4465 765d   lmaDev, emaDev]
-00021b50: 0a20 2020 2020 2020 206d 6154 6578 7473  .        maTexts
-00021b60: 203d 205b 2235 304d 4122 2c22 3230 304d   = ["50MA","200M
-00021b70: 4122 2c22 3230 454d 4122 2c22 5657 4150  A","20EMA","VWAP
-00021b80: 225d 2069 6620 6d61 4c65 6e67 7468 3d3d  "] if maLength==
-00021b90: 3020 656c 7365 205b 2235 304d 4122 2c22  0 else ["50MA","
-00021ba0: 3230 304d 4122 2c22 3230 454d 4122 5d0a  200MA","20EMA"].
-00021bb0: 2020 2020 2020 2020 6d61 5265 7665 7273          maRevers
-00021bc0: 616c 203d 2030 0a20 2020 2020 2020 2069  al = 0.        i
-00021bd0: 6e64 6578 203d 2030 0a20 2020 2020 2020  ndex = 0.       
-00021be0: 2062 756c 6c69 7368 4361 6e64 6c65 203d   bullishCandle =
-00021bf0: 2073 656c 662e 6765 7443 616e 646c 6554   self.getCandleT
-00021c00: 7970 6528 6461 7461 290a 2020 2020 2020  ype(data).      
-00021c10: 2020 6966 2073 7472 286d 614c 656e 6774    if str(maLengt
-00021c20: 6829 206e 6f74 2069 6e20 5b22 3222 2c22  h) not in ["2","
-00021c30: 3322 5d3a 0a20 2020 2020 2020 2020 2020  3"]:.           
-00021c40: 2066 6f72 206d 6120 696e 206d 6173 3a0a   for ma in mas:.
-00021c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c60: 7361 7665 6420 3d20 7365 6c66 2e66 696e  saved = self.fin
-00021c70: 6443 7572 7265 6e74 5361 7665 6456 616c  dCurrentSavedVal
-00021c80: 7565 2873 6372 6565 6e44 6963 742c 7361  ue(screenDict,sa
-00021c90: 7665 4469 6374 2c22 4d41 2d53 6967 6e61  veDict,"MA-Signa
-00021ca0: 6c22 290a 2020 2020 2020 2020 2020 2020  l").            
-00021cb0: 2020 2020 2320 5461 6b69 6e67 2053 7570      # Taking Sup
-00021cc0: 706f 7274 0a20 2020 2020 2020 2020 2020  port.           
-00021cd0: 2020 2020 2069 6620 636c 6f73 6520 3e20       if close > 
-00021ce0: 6d61 2061 6e64 206c 6f77 203c 3d20 286d  ma and low <= (m
-00021cf0: 6120 2b20 6d61 4465 7673 5b69 6e64 6578  a + maDevs[index
-00021d00: 5d29 2061 6e64 2073 7472 286d 614c 656e  ]) and str(maLen
-00021d10: 6774 6829 2069 6e20 5b22 3022 2c22 3122  gth) in ["0","1"
-00021d20: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00021d30: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
-00021d40: 745b 224d 412d 5369 676e 616c 225d 203d  t["MA-Signal"] =
-00021d50: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00021d60: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-00021d70: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-00021d80: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
-00021d90: 2e47 5245 454e 202b 2066 227b 6d61 5465  .GREEN + f"{maTe
-00021da0: 7874 735b 696e 6465 785d 7d2d 5375 7070  xts[index]}-Supp
-00021db0: 6f72 7422 202b 2063 6f6c 6f72 5465 7874  ort" + colorText
-00021dc0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-00021dd0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00021de0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00021df0: 6176 6544 6963 745b 224d 412d 5369 676e  aveDict["MA-Sign
-00021e00: 616c 225d 203d 2073 6176 6564 5b31 5d20  al"] = saved[1] 
-00021e10: 2b20 6622 7b6d 6154 6578 7473 5b69 6e64  + f"{maTexts[ind
-00021e20: 6578 5d7d 2d53 7570 706f 7274 220a 2020  ex]}-Support".  
-00021e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e40: 2020 6d61 5265 7665 7273 616c 203d 2031    maReversal = 1
-00021e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021e60: 2020 2020 206d 6153 6967 6e61 6c73 2e61       maSignals.a
-00021e70: 7070 656e 6428 2231 2229 0a20 2020 2020  ppend("1").     
-00021e80: 2020 2020 2020 2020 2020 2023 2056 616c             # Val
-00021e90: 6964 6174 696e 6720 5265 7369 7374 616e  idating Resistan
-00021ea0: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
-00021eb0: 2020 2065 6c69 6620 636c 6f73 6520 3c20     elif close < 
-00021ec0: 6d61 2061 6e64 2068 6967 6820 3e3d 2028  ma and high >= (
-00021ed0: 6d61 202d 206d 6144 6576 735b 696e 6465  ma - maDevs[inde
-00021ee0: 785d 2920 616e 6420 7374 7228 6d61 4c65  x]) and str(maLe
-00021ef0: 6e67 7468 2920 696e 205b 2230 222c 2236  ngth) in ["0","6
-00021f00: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-00021f10: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-00021f20: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d20  ct["MA-Signal"] 
-00021f30: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00021f40: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00021f50: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
-00021f60: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
-00021f70: 742e 4641 494c 202b 2066 227b 6d61 5465  t.FAIL + f"{maTe
-00021f80: 7874 735b 696e 6465 785d 7d2d 5265 7369  xts[index]}-Resi
-00021f90: 7374 2220 2b20 636f 6c6f 7254 6578 742e  st" + colorText.
-00021fa0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-00021fb0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00021fc0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00021fd0: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
-00021fe0: 6c22 5d20 3d20 7361 7665 645b 315d 202b  l"] = saved[1] +
-00021ff0: 2066 227b 6d61 5465 7874 735b 696e 6465   f"{maTexts[inde
-00022000: 785d 7d2d 5265 7369 7374 220a 2020 2020  x]}-Resist".    
-00022010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022020: 6d61 5265 7665 7273 616c 203d 202d 310a  maReversal = -1.
-00022030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022040: 2020 2020 6d61 5369 676e 616c 732e 6170      maSignals.ap
-00022050: 7065 6e64 2822 3622 290a 2020 2020 2020  pend("6").      
-00022060: 2020 2020 2020 2020 2020 2320 466f 7220            # For 
-00022070: 6120 4275 6c6c 6973 6820 4361 6e64 6c65  a Bullish Candle
-00022080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022090: 2069 6620 6275 6c6c 6973 6843 616e 646c   if bullishCandl
-000220a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000220b0: 2020 2020 2020 2023 2043 726f 7373 696e         # Crossin
-000220c0: 6720 7570 0a20 2020 2020 2020 2020 2020  g up.           
-000220d0: 2020 2020 2020 2020 2069 6620 6f70 656e           if open
-000220e0: 203c 206d 6120 616e 6420 636c 6f73 6520   < ma and close 
-000220f0: 3e20 6d61 2061 6e64 2073 7472 286d 614c  > ma and str(maL
-00022100: 656e 6774 6829 2069 6e20 5b22 3022 2c22  ength) in ["0","
-00022110: 3522 5d3a 0a20 2020 2020 2020 2020 2020  5"]:.           
-00022120: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-00022130: 6565 6e44 6963 745b 224d 412d 5369 676e  eenDict["MA-Sign
-00022140: 616c 225d 203d 2028 0a20 2020 2020 2020  al"] = (.       
-00022150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022160: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
-00022170: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
-00022180: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
-00022190: 202b 2066 2242 756c 6c43 726f 7373 2d7b   + f"BullCross-{
-000221a0: 6d61 5465 7874 735b 696e 6465 785d 7d22  maTexts[index]}"
-000221b0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+00020e90: 2020 2073 6176 6564 203d 2073 656c 662e     saved = self.
+00020ea0: 6669 6e64 4375 7272 656e 7453 6176 6564  findCurrentSaved
+00020eb0: 5661 6c75 6528 7363 7265 656e 4469 6374  Value(screenDict
+00020ec0: 2c20 7361 7665 4469 6374 2c20 2250 6174  , saveDict, "Pat
+00020ed0: 7465 726e 2229 0a20 2020 2020 2020 2020  tern").         
+00020ee0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00020ef0: 6372 6565 6e44 6963 745b 2250 6174 7465  creenDict["Patte
+00020f00: 726e 225d 203d 2028 0a20 2020 2020 2020  rn"] = (.       
+00020f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f20: 2020 2020 2073 6176 6564 5b30 5d0a 2020       saved[0].  
+00020f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f40: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+00020f50: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
+00020f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f70: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+00020f80: 7874 2e47 5245 454e 0a20 2020 2020 2020  xt.GREEN.       
+00020f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fa0: 2020 2020 202b 2022 4d6f 6d65 6e74 756d       + "Momentum
+00020fb0: 2047 6169 6e65 7222 0a20 2020 2020 2020   Gainer".       
+00020fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fd0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+00020fe0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+00020ff0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00021000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021010: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00021020: 2250 6174 7465 726e 225d 203d 2073 6176  "Pattern"] = sav
+00021030: 6564 5b31 5d20 2b20 224d 6f6d 656e 7475  ed[1] + "Momentu
+00021040: 6d20 4761 696e 6572 220a 2020 2020 2020  m Gainer".      
+00021050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021060: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+00021070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021080: 2020 2320 7365 6c66 2e64 6566 6175 6c74    # self.default
+00021090: 5f6c 6f67 6765 722e 696e 666f 280a 2020  _logger.info(.  
+000210a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000210b0: 2020 2320 2020 2020 6627 5374 6f63 6b3a    #     f'Stock:
+000210c0: 7b73 6176 6544 6963 745b 2253 746f 636b  {saveDict["Stock
+000210d0: 225d 7d2c 2069 7320 6e6f 7420 6120 6d6f  "]}, is not a mo
+000210e0: 6d65 6e74 756d 2d67 6169 6e65 7220 6265  mentum-gainer be
+000210f0: 6361 7573 6520 6569 7468 6572 2074 6f64  cause either tod
+00021100: 6179 2d6f 7065 6e20 287b 746f 7d29 203c  ay-open ({to}) <
+00021110: 2079 6573 7465 7264 6179 2d63 6c6f 7365   yesterday-close
+00021120: 2028 7b79 637d 2920 6f72 2079 6573 7465   ({yc}) or yeste
+00021130: 7264 6179 2d6f 7065 6e28 7b79 6f7d 2920  rday-open({yo}) 
+00021140: 3c20 6461 792d 6265 666f 7265 2d63 6c6f  < day-before-clo
+00021150: 7365 287b 6479 637d 2927 0a20 2020 2020  se({dyc})'.     
+00021160: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00021170: 2029 0a20 2020 2020 2020 2020 2020 2065   ).            e
+00021180: 7863 6570 7420 496e 6465 7845 7272 6f72  xcept IndexError
+00021190: 2061 7320 653a 2023 2070 7261 676d 613a   as e: # pragma:
+000211a0: 206e 6f20 636f 7665 720a 2020 2020 2020   no cover.      
+000211b0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+000211c0: 6566 6175 6c74 5f6c 6f67 6765 722e 6465  efault_logger.de
+000211d0: 6275 6728 652c 2065 7863 5f69 6e66 6f3d  bug(e, exc_info=
+000211e0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+000211f0: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
+00021200: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
+00021210: 6461 7461 290a 2020 2020 2020 2020 2020  data).          
+00021220: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00021230: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00021240: 6c73 650a 2020 2020 2020 2020 6578 6365  lse.        exce
+00021250: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00021260: 653a 2020 2320 7072 6167 6d61 3a20 6e6f  e:  # pragma: no
+00021270: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
+00021280: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
+00021290: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
+000212a0: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
+000212b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000212c0: 6e20 4661 6c73 650a 0a20 2020 2023 406d  n False..    #@m
+000212d0: 6561 7375 7265 5f74 696d 650a 2020 2020  easure_time.    
+000212e0: 2320 5661 6c69 6461 7465 204d 6f76 696e  # Validate Movin
+000212f0: 6720 6176 6572 6167 6573 2061 6e64 206c  g averages and l
+00021300: 6f6f 6b20 666f 7220 6275 792f 7365 6c6c  ook for buy/sell
+00021310: 2073 6967 6e61 6c73 0a20 2020 2064 6566   signals.    def
+00021320: 2076 616c 6964 6174 654d 6f76 696e 6741   validateMovingA
+00021330: 7665 7261 6765 7328 7365 6c66 2c20 6466  verages(self, df
+00021340: 2c20 7363 7265 656e 4469 6374 2c20 7361  , screenDict, sa
+00021350: 7665 4469 6374 2c20 6d61 5261 6e67 653d  veDict, maRange=
+00021360: 322e 352c 6d61 4c65 6e67 7468 3d30 293a  2.5,maLength=0):
+00021370: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00021380: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
+00021390: 2020 6461 7461 203d 2064 6174 612e 6669    data = data.fi
+000213a0: 6c6c 6e61 2830 290a 2020 2020 2020 2020  llna(0).        
+000213b0: 6461 7461 203d 2064 6174 612e 7265 706c  data = data.repl
+000213c0: 6163 6528 5b6e 702e 696e 662c 202d 6e70  ace([np.inf, -np
+000213d0: 2e69 6e66 5d2c 2030 290a 2020 2020 2020  .inf], 0).      
+000213e0: 2020 7265 6365 6e74 203d 2064 6174 612e    recent = data.
+000213f0: 6865 6164 2831 290a 2020 2020 2020 2020  head(1).        
+00021400: 6d61 5369 676e 616c 7320 3d20 5b5d 0a20  maSignals = []. 
+00021410: 2020 2020 2020 2069 6620 7374 7228 6d61         if str(ma
+00021420: 4c65 6e67 7468 2920 696e 205b 2230 222c  Length) in ["0",
+00021430: 2232 222c 2233 225d 3a0a 2020 2020 2020  "2","3"]:.      
+00021440: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
+00021450: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
+00021460: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
+00021470: 6963 742c 7361 7665 4469 6374 2c22 4d41  ict,saveDict,"MA
+00021480: 2d53 6967 6e61 6c22 290a 2020 2020 2020  -Signal").      
+00021490: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+000214a0: 2020 2020 2020 2020 2020 2072 6563 656e             recen
+000214b0: 745b 2253 4d41 225d 2e69 6c6f 635b 305d  t["SMA"].iloc[0]
+000214c0: 203e 2072 6563 656e 745b 224c 4d41 225d   > recent["LMA"]
+000214d0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+000214e0: 2020 2020 2020 2020 2061 6e64 2072 6563           and rec
+000214f0: 656e 745b 2243 6c6f 7365 225d 2e69 6c6f  ent["Close"].ilo
+00021500: 635b 305d 203e 2072 6563 656e 745b 2253  c[0] > recent["S
+00021510: 4d41 225d 2e69 6c6f 635b 305d 0a20 2020  MA"].iloc[0].   
+00021520: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+00021530: 2020 2020 2020 2020 2020 2020 7363 7265              scre
+00021540: 656e 4469 6374 5b22 4d41 2d53 6967 6e61  enDict["MA-Signa
+00021550: 6c22 5d20 3d20 280a 2020 2020 2020 2020  l"] = (.        
+00021560: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00021570: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
+00021580: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
+00021590: 742e 4752 4545 4e20 2b20 2242 756c 6c69  t.GREEN + "Bulli
+000215a0: 7368 2220 2b20 636f 6c6f 7254 6578 742e  sh" + colorText.
+000215b0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+000215c0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000215d0: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+000215e0: 4d41 2d53 6967 6e61 6c22 5d20 3d20 7361  MA-Signal"] = sa
+000215f0: 7665 645b 315d 202b 2022 4275 6c6c 6973  ved[1] + "Bullis
+00021600: 6822 0a20 2020 2020 2020 2020 2020 2020  h".             
+00021610: 2020 206d 6153 6967 6e61 6c73 2e61 7070     maSignals.app
+00021620: 656e 6428 2233 2229 0a20 2020 2020 2020  end("3").       
+00021630: 2020 2020 2065 6c69 6620 7265 6365 6e74       elif recent
+00021640: 5b22 534d 4122 5d2e 696c 6f63 5b30 5d20  ["SMA"].iloc[0] 
+00021650: 3c20 7265 6365 6e74 5b22 4c4d 4122 5d2e  < recent["LMA"].
+00021660: 696c 6f63 5b30 5d3a 0a20 2020 2020 2020  iloc[0]:.       
+00021670: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+00021680: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
+00021690: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+000216a0: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
+000216b0: 5d20 2b20 636f 6c6f 7254 6578 742e 424f  ] + colorText.BO
+000216c0: 4c44 202b 2063 6f6c 6f72 5465 7874 2e46  LD + colorText.F
+000216d0: 4149 4c20 2b20 2242 6561 7269 7368 2220  AIL + "Bearish" 
+000216e0: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+000216f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021700: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021710: 2020 7361 7665 4469 6374 5b22 4d41 2d53    saveDict["MA-S
+00021720: 6967 6e61 6c22 5d20 3d20 7361 7665 645b  ignal"] = saved[
+00021730: 315d 202b 2022 4265 6172 6973 6822 0a20  1] + "Bearish". 
+00021740: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00021750: 6153 6967 6e61 6c73 2e61 7070 656e 6428  aSignals.append(
+00021760: 2232 2229 0a20 2020 2020 2020 2020 2020  "2").           
+00021770: 2065 6c69 6620 7265 6365 6e74 5b22 534d   elif recent["SM
+00021780: 4122 5d2e 696c 6f63 5b30 5d20 3d3d 2030  A"].iloc[0] == 0
+00021790: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000217a0: 2020 7363 7265 656e 4469 6374 5b22 4d41    screenDict["MA
+000217b0: 2d53 6967 6e61 6c22 5d20 3d20 280a 2020  -Signal"] = (.  
+000217c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000217d0: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
+000217e0: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
+000217f0: 6c6f 7254 6578 742e 5741 524e 202b 2022  lorText.WARN + "
+00021800: 556e 6b6e 6f77 6e22 202b 2063 6f6c 6f72  Unknown" + color
+00021810: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+00021820: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00021830: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+00021840: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
+00021850: 203d 2073 6176 6564 5b31 5d20 2b20 2255   = saved[1] + "U
+00021860: 6e6b 6e6f 776e 220a 2020 2020 2020 2020  nknown".        
+00021870: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00021880: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+00021890: 4469 6374 5b22 4d41 2d53 6967 6e61 6c22  Dict["MA-Signal"
+000218a0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+000218b0: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
+000218c0: 305d 202b 2063 6f6c 6f72 5465 7874 2e42  0] + colorText.B
+000218d0: 4f4c 4420 2b20 636f 6c6f 7254 6578 742e  OLD + colorText.
+000218e0: 5741 524e 202b 2022 4e65 7574 7261 6c22  WARN + "Neutral"
+000218f0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+00021900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021910: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00021920: 2020 2073 6176 6544 6963 745b 224d 412d     saveDict["MA-
+00021930: 5369 676e 616c 225d 203d 2073 6176 6564  Signal"] = saved
+00021940: 5b31 5d20 2b20 224e 6575 7472 616c 220a  [1] + "Neutral".
+00021950: 2020 2020 2020 2020 7265 7665 7273 6564          reversed
+00021960: 4461 7461 203d 2064 6174 615b 3a3a 2d31  Data = data[::-1
+00021970: 5d20 2023 2052 6576 6572 7365 2074 6865  ]  # Reverse the
+00021980: 2064 6174 6166 7261 6d65 0a20 2020 2020   dataframe.     
+00021990: 2020 2065 6d61 5f32 3020 3d20 706b 7461     ema_20 = pkta
+000219a0: 6c69 622e 454d 4128 7265 7665 7273 6564  lib.EMA(reversed
+000219b0: 4461 7461 5b22 436c 6f73 6522 5d2c 3230  Data["Close"],20
+000219c0: 292e 7461 696c 2831 292e 696c 6f63 5b30  ).tail(1).iloc[0
+000219d0: 5d0a 2020 2020 2020 2020 7677 6170 203d  ].        vwap =
+000219e0: 2070 6b74 616c 6962 2e56 5741 5028 7265   pktalib.VWAP(re
+000219f0: 7665 7273 6564 4461 7461 5b22 4869 6768  versedData["High
+00021a00: 225d 2c72 6576 6572 7365 6444 6174 615b  "],reversedData[
+00021a10: 224c 6f77 225d 2c72 6576 6572 7365 6444  "Low"],reversedD
+00021a20: 6174 615b 2243 6c6f 7365 225d 2c72 6576  ata["Close"],rev
+00021a30: 6572 7365 6444 6174 615b 2256 6f6c 756d  ersedData["Volum
+00021a40: 6522 5d29 2e74 6169 6c28 3129 2e69 6c6f  e"]).tail(1).ilo
+00021a50: 635b 305d 0a20 2020 2020 2020 2073 6d61  c[0].        sma
+00021a60: 4465 7620 3d20 6461 7461 5b22 534d 4122  Dev = data["SMA"
+00021a70: 5d2e 696c 6f63 5b30 5d20 2a20 6d61 5261  ].iloc[0] * maRa
+00021a80: 6e67 6520 2f20 3130 300a 2020 2020 2020  nge / 100.      
+00021a90: 2020 6c6d 6144 6576 203d 2064 6174 615b    lmaDev = data[
+00021aa0: 224c 4d41 225d 2e69 6c6f 635b 305d 202a  "LMA"].iloc[0] *
+00021ab0: 206d 6152 616e 6765 202f 2031 3030 0a20   maRange / 100. 
+00021ac0: 2020 2020 2020 2065 6d61 4465 7620 3d20         emaDev = 
+00021ad0: 656d 615f 3230 202a 206d 6152 616e 6765  ema_20 * maRange
+00021ae0: 202f 2031 3030 0a20 2020 2020 2020 2076   / 100.        v
+00021af0: 7761 7044 6576 203d 2076 7761 7020 2a20  wapDev = vwap * 
+00021b00: 6d61 5261 6e67 6520 2f20 3130 300a 2020  maRange / 100.  
+00021b10: 2020 2020 2020 6f70 656e 2c20 6869 6768        open, high
+00021b20: 2c20 6c6f 772c 2063 6c6f 7365 2c20 736d  , low, close, sm
+00021b30: 612c 206c 6d61 203d 2028 0a20 2020 2020  a, lma = (.     
+00021b40: 2020 2020 2020 2064 6174 615b 224f 7065         data["Ope
+00021b50: 6e22 5d2e 696c 6f63 5b30 5d2c 0a20 2020  n"].iloc[0],.   
+00021b60: 2020 2020 2020 2020 2064 6174 615b 2248           data["H
+00021b70: 6967 6822 5d2e 696c 6f63 5b30 5d2c 0a20  igh"].iloc[0],. 
+00021b80: 2020 2020 2020 2020 2020 2064 6174 615b             data[
+00021b90: 224c 6f77 225d 2e69 6c6f 635b 305d 2c0a  "Low"].iloc[0],.
+00021ba0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00021bb0: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+00021bc0: 5d2c 0a20 2020 2020 2020 2020 2020 2064  ],.            d
+00021bd0: 6174 615b 2253 4d41 225d 2e69 6c6f 635b  ata["SMA"].iloc[
+00021be0: 305d 2c0a 2020 2020 2020 2020 2020 2020  0],.            
+00021bf0: 6461 7461 5b22 4c4d 4122 5d2e 696c 6f63  data["LMA"].iloc
+00021c00: 5b30 5d2c 0a20 2020 2020 2020 2029 0a20  [0],.        ). 
+00021c10: 2020 2020 2020 206d 6173 203d 205b 736d         mas = [sm
+00021c20: 612c 6c6d 612c 656d 615f 3230 2c76 7761  a,lma,ema_20,vwa
+00021c30: 705d 2069 6620 6d61 4c65 6e67 7468 3d3d  p] if maLength==
+00021c40: 3020 656c 7365 205b 736d 612c 6c6d 612c  0 else [sma,lma,
+00021c50: 656d 615f 3230 5d0a 2020 2020 2020 2020  ema_20].        
+00021c60: 6d61 4465 7673 203d 205b 736d 6144 6576  maDevs = [smaDev
+00021c70: 2c20 6c6d 6144 6576 2c20 656d 6144 6576  , lmaDev, emaDev
+00021c80: 2c20 7677 6170 4465 765d 2069 6620 6d61  , vwapDev] if ma
+00021c90: 4c65 6e67 7468 3d3d 3020 656c 7365 205b  Length==0 else [
+00021ca0: 736d 6144 6576 2c20 6c6d 6144 6576 2c20  smaDev, lmaDev, 
+00021cb0: 656d 6144 6576 5d0a 2020 2020 2020 2020  emaDev].        
+00021cc0: 6d61 5465 7874 7320 3d20 5b22 3530 4d41  maTexts = ["50MA
+00021cd0: 222c 2232 3030 4d41 222c 2232 3045 4d41  ","200MA","20EMA
+00021ce0: 222c 2256 5741 5022 5d20 6966 206d 614c  ","VWAP"] if maL
+00021cf0: 656e 6774 683d 3d30 2065 6c73 6520 5b22  ength==0 else ["
+00021d00: 3530 4d41 222c 2232 3030 4d41 222c 2232  50MA","200MA","2
+00021d10: 3045 4d41 225d 0a20 2020 2020 2020 206d  0EMA"].        m
+00021d20: 6152 6576 6572 7361 6c20 3d20 300a 2020  aReversal = 0.  
+00021d30: 2020 2020 2020 696e 6465 7820 3d20 300a        index = 0.
+00021d40: 2020 2020 2020 2020 6275 6c6c 6973 6843          bullishC
+00021d50: 616e 646c 6520 3d20 7365 6c66 2e67 6574  andle = self.get
+00021d60: 4361 6e64 6c65 5479 7065 2864 6174 6129  CandleType(data)
+00021d70: 0a20 2020 2020 2020 2069 6620 7374 7228  .        if str(
+00021d80: 6d61 4c65 6e67 7468 2920 6e6f 7420 696e  maLength) not in
+00021d90: 205b 2232 222c 2233 225d 3a0a 2020 2020   ["2","3"]:.    
+00021da0: 2020 2020 2020 2020 666f 7220 6d61 2069          for ma i
+00021db0: 6e20 6d61 733a 0a20 2020 2020 2020 2020  n mas:.         
+00021dc0: 2020 2020 2020 2073 6176 6564 203d 2073         saved = s
+00021dd0: 656c 662e 6669 6e64 4375 7272 656e 7453  elf.findCurrentS
+00021de0: 6176 6564 5661 6c75 6528 7363 7265 656e  avedValue(screen
+00021df0: 4469 6374 2c73 6176 6544 6963 742c 224d  Dict,saveDict,"M
+00021e00: 412d 5369 676e 616c 2229 0a20 2020 2020  A-Signal").     
+00021e10: 2020 2020 2020 2020 2020 2023 2054 616b             # Tak
+00021e20: 696e 6720 5375 7070 6f72 740a 2020 2020  ing Support.    
+00021e30: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00021e40: 6c6f 7365 203e 206d 6120 616e 6420 6c6f  lose > ma and lo
+00021e50: 7720 3c3d 2028 6d61 202b 206d 6144 6576  w <= (ma + maDev
+00021e60: 735b 696e 6465 785d 2920 616e 6420 7374  s[index]) and st
+00021e70: 7228 6d61 4c65 6e67 7468 2920 696e 205b  r(maLength) in [
+00021e80: 2230 222c 2231 225d 3a0a 2020 2020 2020  "0","1"]:.      
+00021e90: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+00021ea0: 7265 656e 4469 6374 5b22 4d41 2d53 6967  reenDict["MA-Sig
+00021eb0: 6e61 6c22 5d20 3d20 280a 2020 2020 2020  nal"] = (.      
+00021ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ed0: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
+00021ee0: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
+00021ef0: 6c6f 7254 6578 742e 4752 4545 4e20 2b20  lorText.GREEN + 
+00021f00: 6622 7b6d 6154 6578 7473 5b69 6e64 6578  f"{maTexts[index
+00021f10: 5d7d 2d53 7570 706f 7274 2220 2b20 636f  ]}-Support" + co
+00021f20: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+00021f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021f40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021f50: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+00021f60: 4d41 2d53 6967 6e61 6c22 5d20 3d20 7361  MA-Signal"] = sa
+00021f70: 7665 645b 315d 202b 2066 227b 6d61 5465  ved[1] + f"{maTe
+00021f80: 7874 735b 696e 6465 785d 7d2d 5375 7070  xts[index]}-Supp
+00021f90: 6f72 7422 0a20 2020 2020 2020 2020 2020  ort".           
+00021fa0: 2020 2020 2020 2020 206d 6152 6576 6572           maRever
+00021fb0: 7361 6c20 3d20 310a 2020 2020 2020 2020  sal = 1.        
+00021fc0: 2020 2020 2020 2020 2020 2020 6d61 5369              maSi
+00021fd0: 676e 616c 732e 6170 7065 6e64 2822 3122  gnals.append("1"
+00021fe0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021ff0: 2020 2320 5661 6c69 6461 7469 6e67 2052    # Validating R
+00022000: 6573 6973 7461 6e63 650a 2020 2020 2020  esistance.      
+00022010: 2020 2020 2020 2020 2020 656c 6966 2063            elif c
+00022020: 6c6f 7365 203c 206d 6120 616e 6420 6869  lose < ma and hi
+00022030: 6768 203e 3d20 286d 6120 2d20 6d61 4465  gh >= (ma - maDe
+00022040: 7673 5b69 6e64 6578 5d29 2061 6e64 2073  vs[index]) and s
+00022050: 7472 286d 614c 656e 6774 6829 2069 6e20  tr(maLength) in 
+00022060: 5b22 3022 2c22 3622 5d3a 0a20 2020 2020  ["0","6"]:.     
+00022070: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00022080: 6372 6565 6e44 6963 745b 224d 412d 5369  creenDict["MA-Si
+00022090: 676e 616c 225d 203d 2028 0a20 2020 2020  gnal"] = (.     
+000220a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000220b0: 2020 2073 6176 6564 5b30 5d20 2b20 636f     saved[0] + co
+000220c0: 6c6f 7254 6578 742e 424f 4c44 202b 2063  lorText.BOLD + c
+000220d0: 6f6c 6f72 5465 7874 2e46 4149 4c20 2b20  olorText.FAIL + 
+000220e0: 6622 7b6d 6154 6578 7473 5b69 6e64 6578  f"{maTexts[index
+000220f0: 5d7d 2d52 6573 6973 7422 202b 2063 6f6c  ]}-Resist" + col
+00022100: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+00022110: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00022120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022130: 2020 2020 2073 6176 6544 6963 745b 224d       saveDict["M
+00022140: 412d 5369 676e 616c 225d 203d 2073 6176  A-Signal"] = sav
+00022150: 6564 5b31 5d20 2b20 6622 7b6d 6154 6578  ed[1] + f"{maTex
+00022160: 7473 5b69 6e64 6578 5d7d 2d52 6573 6973  ts[index]}-Resis
+00022170: 7422 0a20 2020 2020 2020 2020 2020 2020  t".             
+00022180: 2020 2020 2020 206d 6152 6576 6572 7361         maReversa
+00022190: 6c20 3d20 2d31 0a20 2020 2020 2020 2020  l = -1.         
+000221a0: 2020 2020 2020 2020 2020 206d 6153 6967             maSig
+000221b0: 6e61 6c73 2e61 7070 656e 6428 2236 2229  nals.append("6")
 000221c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000221d0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000221e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000221f0: 2020 2073 6176 6544 6963 745b 224d 412d     saveDict["MA-
-00022200: 5369 676e 616c 225d 203d 2073 6176 6564  Signal"] = saved
-00022210: 5b31 5d20 2b20 6622 4275 6c6c 4372 6f73  [1] + f"BullCros
-00022220: 732d 7b6d 6154 6578 7473 5b69 6e64 6578  s-{maTexts[index
-00022230: 5d7d 220a 2020 2020 2020 2020 2020 2020  ]}".            
-00022240: 2020 2020 2020 2020 2020 2020 6d61 5265              maRe
-00022250: 7665 7273 616c 203d 2031 0a20 2020 2020  versal = 1.     
-00022260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022270: 2020 206d 6153 6967 6e61 6c73 2e61 7070     maSignals.app
-00022280: 656e 6428 2235 2229 0a20 2020 2020 2020  end("5").       
-00022290: 2020 2020 2020 2020 2023 2046 6f72 2061           # For a
-000222a0: 2042 6561 7269 7368 2043 616e 646c 650a   Bearish Candle.
+000221d0: 2023 2046 6f72 2061 2042 756c 6c69 7368   # For a Bullish
+000221e0: 2043 616e 646c 650a 2020 2020 2020 2020   Candle.        
+000221f0: 2020 2020 2020 2020 6966 2062 756c 6c69          if bulli
+00022200: 7368 4361 6e64 6c65 3a0a 2020 2020 2020  shCandle:.      
+00022210: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00022220: 4372 6f73 7369 6e67 2075 700a 2020 2020  Crossing up.    
+00022230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022240: 6966 206f 7065 6e20 3c20 6d61 2061 6e64  if open < ma and
+00022250: 2063 6c6f 7365 203e 206d 6120 616e 6420   close > ma and 
+00022260: 7374 7228 6d61 4c65 6e67 7468 2920 696e  str(maLength) in
+00022270: 205b 2230 222c 2235 225d 3a0a 2020 2020   ["0","5"]:.    
+00022280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022290: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+000222a0: 4d41 2d53 6967 6e61 6c22 5d20 3d20 280a  MA-Signal"] = (.
 000222b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000222c0: 656c 6966 206e 6f74 2062 756c 6c69 7368  elif not bullish
-000222d0: 4361 6e64 6c65 3a0a 2020 2020 2020 2020  Candle:.        
-000222e0: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
-000222f0: 6f73 7369 6e67 2064 6f77 6e0a 2020 2020  ossing down.    
-00022300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022310: 6966 206f 7065 6e20 3e20 736d 6120 616e  if open > sma an
-00022320: 6420 636c 6f73 6520 3c20 736d 6120 616e  d close < sma an
-00022330: 6420 7374 7228 6d61 4c65 6e67 7468 2920  d str(maLength) 
-00022340: 696e 205b 2230 222c 2234 225d 3a0a 2020  in ["0","4"]:.  
-00022350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022360: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-00022370: 5b22 4d41 2d53 6967 6e61 6c22 5d20 3d20  ["MA-Signal"] = 
-00022380: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00022390: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-000223a0: 7665 645b 305d 202b 2063 6f6c 6f72 5465  ved[0] + colorTe
-000223b0: 7874 2e42 4f4c 4420 2b20 636f 6c6f 7254  xt.BOLD + colorT
-000223c0: 6578 742e 4641 494c 202b 2066 2242 6561  ext.FAIL + f"Bea
-000223d0: 7243 726f 7373 2d7b 6d61 5465 7874 735b  rCross-{maTexts[
-000223e0: 696e 6465 785d 7d22 202b 2063 6f6c 6f72  index]}" + color
-000223f0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-00022400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022410: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00022420: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00022430: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
-00022440: 203d 2073 6176 6564 5b31 5d20 2b20 6622   = saved[1] + f"
-00022450: 4265 6172 4372 6f73 732d 7b6d 6154 6578  BearCross-{maTex
-00022460: 7473 5b69 6e64 6578 5d7d 220a 2020 2020  ts[index]}".    
-00022470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022480: 2020 2020 6d61 5265 7665 7273 616c 203d      maReversal =
-00022490: 202d 310a 2020 2020 2020 2020 2020 2020   -1.            
-000224a0: 2020 2020 2020 2020 2020 2020 6d61 5369              maSi
-000224b0: 676e 616c 732e 6170 7065 6e64 2822 3422  gnals.append("4"
-000224c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000224d0: 2020 696e 6465 7820 2b3d 2031 0a20 2020    index += 1.   
-000224e0: 2020 2020 2072 6574 7572 6e56 616c 7565       returnValue
-000224f0: 203d 206d 6152 6576 6572 7361 6c0a 2020   = maReversal.  
-00022500: 2020 2020 2020 6966 206d 614c 656e 6774        if maLengt
-00022510: 6820 213d 2030 3a0a 2020 2020 2020 2020  h != 0:.        
-00022520: 2020 2020 7265 7475 726e 5661 6c75 6520      returnValue 
-00022530: 3d20 7374 7228 6d61 4c65 6e67 7468 2920  = str(maLength) 
-00022540: 696e 206d 6153 6967 6e61 6c73 0a20 2020  in maSignals.   
-00022550: 2020 2020 2072 6574 7572 6e20 7265 7475       return retu
-00022560: 726e 5661 6c75 650a 0a20 2020 2023 2046  rnValue..    # F
-00022570: 696e 6420 4e52 7820 7261 6e67 6520 666f  ind NRx range fo
-00022580: 7220 5265 7665 7273 616c 0a20 2020 2064  r Reversal.    d
-00022590: 6566 2076 616c 6964 6174 654e 6172 726f  ef validateNarro
-000225a0: 7752 616e 6765 2873 656c 662c 2064 662c  wRange(self, df,
-000225b0: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
-000225c0: 6544 6963 742c 206e 723d 3429 3a0a 2020  eDict, nr=4):.  
-000225d0: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
-000225e0: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
-000225f0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00022600: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-00022610: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
-00022620: 636f 7079 2829 0a20 2020 2020 2020 2073  copy().        s
-00022630: 6176 6564 203d 2073 656c 662e 6669 6e64  aved = self.find
-00022640: 4375 7272 656e 7453 6176 6564 5661 6c75  CurrentSavedValu
-00022650: 6528 7363 7265 656e 4469 6374 2c20 7361  e(screenDict, sa
-00022660: 7665 4469 6374 2c20 2250 6174 7465 726e  veDict, "Pattern
-00022670: 2229 0a20 2020 2020 2020 2069 6620 504b  ").        if PK
-00022680: 4461 7465 5574 696c 6974 6965 732e 6973  DateUtilities.is
-00022690: 5472 6164 696e 6754 696d 6528 293a 0a20  TradingTime():. 
-000226a0: 2020 2020 2020 2020 2020 2072 616e 6765             range
-000226b0: 4461 7461 203d 2064 6174 612e 6865 6164  Data = data.head
-000226c0: 286e 7220 2b20 3129 5b31 3a5d 0a20 2020  (nr + 1)[1:].   
-000226d0: 2020 2020 2020 2020 206e 6f77 5f63 616e           now_can
-000226e0: 646c 6520 3d20 6461 7461 2e68 6561 6428  dle = data.head(
-000226f0: 3129 0a20 2020 2020 2020 2020 2020 2072  1).            r
-00022700: 616e 6765 4461 7461 5b22 5261 6e67 6522  angeData["Range"
-00022710: 5d20 3d20 6162 7328 7261 6e67 6544 6174  ] = abs(rangeDat
-00022720: 615b 2243 6c6f 7365 225d 202d 2072 616e  a["Close"] - ran
-00022730: 6765 4461 7461 5b22 4f70 656e 225d 290a  geData["Open"]).
-00022740: 2020 2020 2020 2020 2020 2020 7265 6365              rece
-00022750: 6e74 203d 2072 616e 6765 4461 7461 2e68  nt = rangeData.h
-00022760: 6561 6428 3129 0a20 2020 2020 2020 2020  ead(1).         
-00022770: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00022780: 2020 2020 2020 2020 6c65 6e28 7265 6365          len(rece
-00022790: 6e74 2920 3d3d 2031 0a20 2020 2020 2020  nt) == 1.       
-000227a0: 2020 2020 2020 2020 2061 6e64 2072 6563           and rec
-000227b0: 656e 745b 2252 616e 6765 225d 2e69 6c6f  ent["Range"].ilo
-000227c0: 635b 305d 203d 3d20 7261 6e67 6544 6174  c[0] == rangeDat
-000227d0: 612e 6465 7363 7269 6265 2829 5b22 5261  a.describe()["Ra
-000227e0: 6e67 6522 5d5b 226d 696e 225d 0a20 2020  nge"]["min"].   
-000227f0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-00022800: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00022810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022820: 2020 2020 2073 656c 662e 6765 7443 616e       self.getCan
-00022830: 646c 6554 7970 6528 7265 6365 6e74 290a  dleType(recent).
-00022840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022850: 2020 2020 616e 6420 6e6f 775f 6361 6e64      and now_cand
-00022860: 6c65 5b22 436c 6f73 6522 5d2e 696c 6f63  le["Close"].iloc
-00022870: 5b30 5d20 3e3d 2072 6563 656e 745b 2243  [0] >= recent["C
-00022880: 6c6f 7365 225d 2e69 6c6f 635b 305d 0a20  lose"].iloc[0]. 
-00022890: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000228a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000228b0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-000228c0: 5b22 5061 7474 6572 6e22 5d20 3d20 280a  ["Pattern"] = (.
-000228d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000228e0: 2020 2020 2020 2020 7361 7665 645b 305d          saved[0]
-000228f0: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
-00022900: 4420 2b20 636f 6c6f 7254 6578 742e 4752  D + colorText.GR
-00022910: 4545 4e20 2b20 6622 4275 792d 4e52 7b6e  EEN + f"Buy-NR{n
-00022920: 727d 2220 2b20 636f 6c6f 7254 6578 742e  r}" + colorText.
-00022930: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-00022940: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00022950: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00022960: 7665 4469 6374 5b22 5061 7474 6572 6e22  veDict["Pattern"
-00022970: 5d20 3d20 7361 7665 645b 315d 202b 2066  ] = saved[1] + f
-00022980: 2242 7579 2d4e 527b 6e72 7d22 0a20 2020  "Buy-NR{nr}".   
-00022990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000229a0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
-000229b0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-000229c0: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-000229d0: 2020 2020 2020 2020 6e6f 7420 7365 6c66          not self
-000229e0: 2e67 6574 4361 6e64 6c65 5479 7065 2872  .getCandleType(r
-000229f0: 6563 656e 7429 0a20 2020 2020 2020 2020  ecent).         
-00022a00: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
-00022a10: 6f77 5f63 616e 646c 655b 2243 6c6f 7365  ow_candle["Close
-00022a20: 225d 2e69 6c6f 635b 305d 203c 3d20 7265  "].iloc[0] <= re
-00022a30: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
-00022a40: 6f63 5b30 5d0a 2020 2020 2020 2020 2020  oc[0].          
-00022a50: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00022a60: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-00022a70: 6565 6e44 6963 745b 2250 6174 7465 726e  eenDict["Pattern
-00022a80: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-00022a90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00022aa0: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
-00022ab0: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
-00022ac0: 5465 7874 2e46 4149 4c20 2b20 6622 5365  Text.FAIL + f"Se
-00022ad0: 6c6c 2d4e 527b 6e72 7d22 202b 2063 6f6c  ll-NR{nr}" + col
-00022ae0: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
-00022af0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00022b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022b10: 2020 2020 2073 6176 6544 6963 745b 2250       saveDict["P
-00022b20: 6174 7465 726e 225d 203d 2073 6176 6564  attern"] = saved
-00022b30: 5b31 5d20 2b20 6622 5365 6c6c 2d4e 527b  [1] + f"Sell-NR{
-00022b40: 6e72 7d22 0a20 2020 2020 2020 2020 2020  nr}".           
-00022b50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00022b60: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00022b70: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-00022b80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00022b90: 2020 2020 2020 2020 7261 6e67 6544 6174          rangeDat
-00022ba0: 6120 3d20 6461 7461 2e68 6561 6428 6e72  a = data.head(nr
-00022bb0: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
-00022bc0: 6e67 6544 6174 612e 6c6f 635b 3a2c 2752  ngeData.loc[:,'R
-00022bd0: 616e 6765 275d 203d 2061 6273 2872 616e  ange'] = abs(ran
-00022be0: 6765 4461 7461 5b22 436c 6f73 6522 5d20  geData["Close"] 
-00022bf0: 2d20 7261 6e67 6544 6174 615b 224f 7065  - rangeData["Ope
-00022c00: 6e22 5d29 0a20 2020 2020 2020 2020 2020  n"]).           
-00022c10: 2072 6563 656e 7420 3d20 7261 6e67 6544   recent = rangeD
-00022c20: 6174 612e 6865 6164 2831 290a 2020 2020  ata.head(1).    
-00022c30: 2020 2020 2020 2020 6966 2072 6563 656e          if recen
-00022c40: 745b 2252 616e 6765 225d 2e69 6c6f 635b  t["Range"].iloc[
-00022c50: 305d 203d 3d20 7261 6e67 6544 6174 612e  0] == rangeData.
-00022c60: 6465 7363 7269 6265 2829 5b22 5261 6e67  describe()["Rang
-00022c70: 6522 5d5b 226d 696e 225d 3a0a 2020 2020  e"]["min"]:.    
-00022c80: 2020 2020 2020 2020 2020 2020 7363 7265              scre
-00022c90: 656e 4469 6374 5b22 5061 7474 6572 6e22  enDict["Pattern"
-00022ca0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-00022cb0: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
-00022cc0: 305d 202b 2063 6f6c 6f72 5465 7874 2e42  0] + colorText.B
-00022cd0: 4f4c 4420 2b20 636f 6c6f 7254 6578 742e  OLD + colorText.
-00022ce0: 4752 4545 4e20 2b20 6622 4e52 7b6e 727d  GREEN + f"NR{nr}
-00022cf0: 2220 2b20 636f 6c6f 7254 6578 742e 454e  " + colorText.EN
-00022d00: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-00022d10: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00022d20: 2020 2020 7361 7665 4469 6374 5b22 5061      saveDict["Pa
-00022d30: 7474 6572 6e22 5d20 3d20 7361 7665 645b  ttern"] = saved[
-00022d40: 315d 202b 2066 224e 527b 6e72 7d22 0a20  1] + f"NR{nr}". 
-00022d50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00022d60: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-00022d70: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00022d80: 6c73 650a 0a20 2020 2023 2046 696e 6420  lse..    # Find 
-00022d90: 6966 2073 746f 636b 2069 7320 6e65 776c  if stock is newl
-00022da0: 7920 6c69 7374 6564 0a20 2020 2064 6566  y listed.    def
-00022db0: 2076 616c 6964 6174 654e 6577 6c79 4c69   validateNewlyLi
-00022dc0: 7374 6564 2873 656c 662c 2064 662c 2064  sted(self, df, d
-00022dd0: 6179 7354 6f4c 6f6f 6b62 6163 6b29 3a0a  aysToLookback):.
-00022de0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-00022df0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-00022e00: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00022e10: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-00022e20: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-00022e30: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-00022e40: 2064 6179 7354 6f4c 6f6f 6b62 6163 6b20   daysToLookback 
-00022e50: 3d20 696e 7428 6461 7973 546f 4c6f 6f6b  = int(daysToLook
-00022e60: 6261 636b 5b3a 2d31 5d29 0a20 2020 2020  back[:-1]).     
-00022e70: 2020 2072 6563 656e 7420 3d20 6461 7461     recent = data
-00022e80: 2e68 6561 6428 3129 0a20 2020 2020 2020  .head(1).       
-00022e90: 2069 6620 6c65 6e28 7265 6365 6e74 2920   if len(recent) 
-00022ea0: 3c20 313a 0a20 2020 2020 2020 2020 2020  < 1:.           
-00022eb0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-00022ec0: 2020 2020 2020 6966 206c 656e 2864 6174        if len(dat
-00022ed0: 6129 203c 2064 6179 7354 6f4c 6f6f 6b62  a) < daysToLookb
-00022ee0: 6163 6b20 616e 6420 280a 2020 2020 2020  ack and (.      
-00022ef0: 2020 2020 2020 7265 6365 6e74 5b22 436c        recent["Cl
-00022f00: 6f73 6522 5d2e 696c 6f63 5b30 5d20 213d  ose"].iloc[0] !=
-00022f10: 206e 702e 6e61 6e20 616e 6420 7265 6365   np.nan and rece
-00022f20: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
-00022f30: 5b30 5d20 3e20 300a 2020 2020 2020 2020  [0] > 0.        
-00022f40: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00022f50: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-00022f60: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-00022f70: 0a20 2020 2023 2056 616c 6964 6174 6520  .    # Validate 
-00022f80: 6966 2074 6865 2073 746f 636b 2070 7269  if the stock pri
-00022f90: 6365 7320 6172 6520 6174 206c 6561 7374  ces are at least
-00022fa0: 2072 6973 696e 6720 6279 2032 2520 666f   rising by 2% fo
-00022fb0: 7220 7468 6520 6c61 7374 2033 2073 6573  r the last 3 ses
-00022fc0: 7369 6f6e 730a 2020 2020 6465 6620 7661  sions.    def va
-00022fd0: 6c69 6461 7465 5072 6963 6552 6973 696e  lidatePriceRisin
-00022fe0: 6742 7941 744c 6561 7374 3250 6572 6365  gByAtLeast2Perce
-00022ff0: 6e74 2873 656c 662c 2064 662c 2073 6372  nt(self, df, scr
-00023000: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
-00023010: 7429 3a0a 2020 2020 2020 2020 6966 2064  t):.        if d
-00023020: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-00023030: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-00023040: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00023050: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-00023060: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-00023070: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-00023080: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-00023090: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-000230a0: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-000230b0: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-000230c0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-000230d0: 2e68 6561 6428 3429 0a20 2020 2020 2020  .head(4).       
-000230e0: 2069 6620 6c65 6e28 6461 7461 2920 3c20   if len(data) < 
-000230f0: 343a 0a20 2020 2020 2020 2020 2020 2072  4:.            r
-00023100: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00023110: 2020 2020 6461 7930 203d 2064 6174 612e      day0 = data.
-00023120: 696c 6f63 5b30 5d5b 2243 6c6f 7365 225d  iloc[0]["Close"]
-00023130: 2e69 7465 6d28 290a 2020 2020 2020 2020  .item().        
-00023140: 6461 794d 696e 7573 3120 3d20 6461 7461  dayMinus1 = data
-00023150: 2e69 6c6f 635b 315d 5b22 436c 6f73 6522  .iloc[1]["Close"
-00023160: 5d2e 6974 656d 2829 0a20 2020 2020 2020  ].item().       
-00023170: 2064 6179 4d69 6e75 7332 203d 2064 6174   dayMinus2 = dat
-00023180: 612e 696c 6f63 5b32 5d5b 2243 6c6f 7365  a.iloc[2]["Close
-00023190: 225d 2e69 7465 6d28 290a 2020 2020 2020  "].item().      
-000231a0: 2020 6461 794d 696e 7573 3320 3d20 6461    dayMinus3 = da
-000231b0: 7461 2e69 6c6f 635b 335d 5b22 436c 6f73  ta.iloc[3]["Clos
-000231c0: 6522 5d2e 6974 656d 2829 0a20 2020 2020  e"].item().     
-000231d0: 2020 2070 6572 6365 6e74 3320 3d20 726f     percent3 = ro
-000231e0: 756e 6428 2864 6179 4d69 6e75 7332 202d  und((dayMinus2 -
-000231f0: 2064 6179 4d69 6e75 7333 2920 2a20 3130   dayMinus3) * 10
-00023200: 3020 2f20 6461 794d 696e 7573 332c 2032  0 / dayMinus3, 2
-00023210: 290a 2020 2020 2020 2020 7065 7263 656e  ).        percen
-00023220: 7432 203d 2072 6f75 6e64 2828 6461 794d  t2 = round((dayM
-00023230: 696e 7573 3120 2d20 6461 794d 696e 7573  inus1 - dayMinus
-00023240: 3229 202a 2031 3030 202f 2064 6179 4d69  2) * 100 / dayMi
-00023250: 6e75 7332 2c20 3229 0a20 2020 2020 2020  nus2, 2).       
-00023260: 2070 6572 6365 6e74 3120 3d20 726f 756e   percent1 = roun
-00023270: 6428 2864 6179 3020 2d20 6461 794d 696e  d((day0 - dayMin
-00023280: 7573 3129 202a 2031 3030 202f 2064 6179  us1) * 100 / day
-00023290: 4d69 6e75 7331 2c20 3229 0a0a 2020 2020  Minus1, 2)..    
-000232a0: 2020 2020 6966 2070 6572 6365 6e74 3120      if percent1 
-000232b0: 3e3d 2032 2061 6e64 2070 6572 6365 6e74  >= 2 and percent
-000232c0: 3220 3e3d 2032 2061 6e64 2070 6572 6365  2 >= 2 and perce
-000232d0: 6e74 3320 3e3d 2032 3a0a 2020 2020 2020  nt3 >= 2:.      
-000232e0: 2020 2020 2020 7063 745f 6368 616e 6765        pct_change
-000232f0: 5f74 6578 7420 3d20 280a 2020 2020 2020  _text = (.      
-00023300: 2020 2020 2020 2020 2020 2822 252e 3166            ("%.1f
-00023310: 2525 2220 2520 7065 7263 656e 7431 290a  %%" % percent1).
-00023320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023330: 2b20 2822 2028 252e 3166 2525 2c22 2025  + (" (%.1f%%," %
-00023340: 2070 6572 6365 6e74 3229 0a20 2020 2020   percent2).     
-00023350: 2020 2020 2020 2020 2020 202b 2028 2220             + (" 
-00023360: 252e 3166 2525 2922 2025 2070 6572 6365  %.1f%%)" % perce
-00023370: 6e74 3329 0a20 2020 2020 2020 2020 2020  nt3).           
-00023380: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-00023390: 6176 6544 6963 745b 2225 4368 6e67 225d  aveDict["%Chng"]
-000233a0: 203d 2070 6374 5f63 6861 6e67 655f 7465   = pct_change_te
-000233b0: 7874 0a20 2020 2020 2020 2020 2020 2073  xt.            s
-000233c0: 6372 6565 6e44 6963 745b 2225 4368 6e67  creenDict["%Chng
-000233d0: 225d 203d 2063 6f6c 6f72 5465 7874 2e47  "] = colorText.G
-000233e0: 5245 454e 202b 2070 6374 5f63 6861 6e67  REEN + pct_chang
-000233f0: 655f 7465 7874 202b 2063 6f6c 6f72 5465  e_text + colorTe
-00023400: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-00023410: 2020 2072 6574 7572 6e20 5472 7565 2061     return True a
-00023420: 6e64 2073 656c 662e 6765 7443 616e 646c  nd self.getCandl
-00023430: 6554 7970 6528 6461 7461 2e68 6561 6428  eType(data.head(
-00023440: 3129 290a 2020 2020 2020 2020 7265 7475  1)).        retu
-00023450: 726e 2046 616c 7365 0a0a 2020 2020 2340  rn False..    #@
-00023460: 6d65 6173 7572 655f 7469 6d65 0a20 2020  measure_time.   
-00023470: 2023 2076 616c 6964 6174 6520 6966 2052   # validate if R
-00023480: 5349 2069 7320 7769 7468 696e 2067 6976  SI is within giv
-00023490: 656e 2072 616e 6765 0a20 2020 2064 6566  en range.    def
-000234a0: 2076 616c 6964 6174 6552 5349 2873 656c   validateRSI(sel
-000234b0: 662c 2064 662c 2073 6372 6565 6e44 6963  f, df, screenDic
-000234c0: 742c 2073 6176 6544 6963 742c 206d 696e  t, saveDict, min
-000234d0: 5253 492c 206d 6178 5253 492c 7273 694b  RSI, maxRSI,rsiK
-000234e0: 6579 3d22 5253 4922 293a 0a20 2020 2020  ey="RSI"):.     
-000234f0: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
-00023500: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
-00023510: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00023520: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-00023530: 2020 2069 6620 7273 694b 6579 206e 6f74     if rsiKey not
-00023540: 2069 6e20 6466 2e63 6f6c 756d 6e73 3a0a   in df.columns:.
-00023550: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00023560: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-00023570: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
-00023580: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-00023590: 2064 6174 612e 6669 6c6c 6e61 2830 290a   data.fillna(0).
-000235a0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-000235b0: 6174 612e 7265 706c 6163 6528 5b6e 702e  ata.replace([np.
-000235c0: 696e 662c 202d 6e70 2e69 6e66 5d2c 2030  inf, -np.inf], 0
-000235d0: 290a 2020 2020 2020 2020 7273 6920 3d20  ).        rsi = 
-000235e0: 696e 7428 6461 7461 2e68 6561 6428 3129  int(data.head(1)
-000235f0: 5b72 7369 4b65 795d 2e69 6c6f 635b 305d  [rsiKey].iloc[0]
-00023600: 290a 2020 2020 2020 2020 7361 7665 4469  ).        saveDi
-00023610: 6374 5b72 7369 4b65 795d 203d 2072 7369  ct[rsiKey] = rsi
-00023620: 0a20 2020 2020 2020 2023 2068 7474 7073  .        # https
-00023630: 3a2f 2f63 6861 7274 696e 6b2e 636f 6d2f  ://chartink.com/
-00023640: 7363 7265 656e 6572 2f72 7369 2d73 6372  screener/rsi-scr
-00023650: 6565 6e69 6e67 0a20 2020 2020 2020 2069  eening.        i
-00023660: 6620 7273 693e 2030 2061 6e64 2072 7369  f rsi> 0 and rsi
-00023670: 203e 3d20 6d69 6e52 5349 2061 6e64 2072   >= minRSI and r
-00023680: 7369 203c 3d20 6d61 7852 5349 3a20 2023  si <= maxRSI:  #
-00023690: 206f 7220 2872 7369 203c 3d20 3731 2061   or (rsi <= 71 a
-000236a0: 6e64 2072 7369 203e 3d20 3637 293a 0a20  nd rsi >= 67):. 
-000236b0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-000236c0: 6e44 6963 745b 7273 694b 6579 5d20 3d20  nDict[rsiKey] = 
-000236d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000236e0: 2020 636f 6c6f 7254 6578 742e 424f 4c44    colorText.BOLD
-000236f0: 202b 2063 6f6c 6f72 5465 7874 2e47 5245   + colorText.GRE
-00023700: 454e 202b 2073 7472 2872 7369 2920 2b20  EN + str(rsi) + 
-00023710: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
-00023720: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00023730: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00023740: 7275 6520 6966 2028 7273 694b 6579 203d  rue if (rsiKey =
-00023750: 3d20 2252 5349 6922 2920 656c 7365 2028  = "RSIi") else (
-00023760: 7365 6c66 2e76 616c 6964 6174 6552 5349  self.validateRSI
-00023770: 2864 662c 2073 6372 6565 6e44 6963 742c  (df, screenDict,
-00023780: 2073 6176 6544 6963 742c 206d 696e 5253   saveDict, minRS
-00023790: 492c 206d 6178 5253 492c 7273 694b 6579  I, maxRSI,rsiKey
-000237a0: 3d22 5253 4969 2229 206f 7220 5472 7565  ="RSIi") or True
-000237b0: 290a 2020 2020 2020 2020 7363 7265 656e  ).        screen
-000237c0: 4469 6374 5b72 7369 4b65 795d 203d 2063  Dict[rsiKey] = c
-000237d0: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
-000237e0: 636f 6c6f 7254 6578 742e 4641 494c 202b  colorText.FAIL +
-000237f0: 2073 7472 2872 7369 2920 2b20 636f 6c6f   str(rsi) + colo
-00023800: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00023810: 2020 2320 4966 2065 6974 6865 7220 6461    # If either da
-00023820: 696c 7920 6f72 2069 6e74 7261 6461 7920  ily or intraday 
-00023830: 5253 4920 636f 6d65 7320 7769 7468 696e  RSI comes within
-00023840: 2072 616e 6765 3f0a 2020 2020 2020 2020   range?.        
-00023850: 7265 7475 726e 2046 616c 7365 2069 6620  return False if 
-00023860: 2872 7369 4b65 7920 3d3d 2022 5253 4969  (rsiKey == "RSIi
-00023870: 2229 2065 6c73 6520 2873 656c 662e 7661  ") else (self.va
-00023880: 6c69 6461 7465 5253 4928 6466 2c20 7363  lidateRSI(df, sc
-00023890: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
-000238a0: 6374 2c20 6d69 6e52 5349 2c20 6d61 7852  ct, minRSI, maxR
-000238b0: 5349 2c72 7369 4b65 793d 2252 5349 6922  SI,rsiKey="RSIi"
-000238c0: 2929 0a0a 2020 2020 2320 5661 6c69 6461  ))..    # Valida
-000238d0: 7465 2069 6620 7468 6520 7374 6f63 6b20  te if the stock 
-000238e0: 6973 2062 756c 6c69 7368 2069 6e20 7468  is bullish in th
-000238f0: 6520 7368 6f72 7420 7465 726d 0a20 2020  e short term.   
-00023900: 2064 6566 2076 616c 6964 6174 6553 686f   def validateSho
-00023910: 7274 5465 726d 4275 6c6c 6973 6828 7365  rtTermBullish(se
-00023920: 6c66 2c20 6466 2c20 7363 7265 656e 4469  lf, df, screenDi
-00023930: 6374 2c20 7361 7665 4469 6374 293a 0a20  ct, saveDict):. 
-00023940: 2020 2020 2020 2069 6620 6466 2069 7320         if df is 
-00023950: 4e6f 6e65 206f 7220 6c65 6e28 6466 2920  None or len(df) 
-00023960: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00023970: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-00023980: 2020 2020 2020 2064 6174 6120 3d20 6466         data = df
-00023990: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-000239a0: 2320 6874 7470 733a 2f2f 6368 6172 7469  # https://charti
-000239b0: 6e6b 2e63 6f6d 2f73 6372 6565 6e65 722f  nk.com/screener/
-000239c0: 7368 6f72 742d 7465 726d 2d62 756c 6c69  short-term-bulli
-000239d0: 7368 0a20 2020 2020 2020 2064 6174 6120  sh.        data 
-000239e0: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-000239f0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00023a00: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
-00023a10: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
-00023a20: 3029 0a20 2020 2020 2020 2072 6563 656e  0).        recen
-00023a30: 7420 3d20 6461 7461 2e68 6561 6428 3129  t = data.head(1)
-00023a40: 0a20 2020 2020 2020 2066 6b20 3d20 3020  .        fk = 0 
-00023a50: 6966 206c 656e 2864 6174 6129 203c 2033  if len(data) < 3
-00023a60: 2065 6c73 6520 6e70 2e72 6f75 6e64 2864   else np.round(d
-00023a70: 6174 615b 2246 4153 544b 225d 2e69 6c6f  ata["FASTK"].ilo
-00023a80: 635b 325d 2c20 3529 0a20 2020 2020 2020  c[2], 5).       
-00023a90: 2023 2052 6576 6572 7365 2074 6865 2064   # Reverse the d
-00023aa0: 6174 6166 7261 6d65 2066 6f72 2069 6368  ataframe for ich
-00023ab0: 696d 6f6b 7520 6361 6c63 756c 6174 696f  imoku calculatio
-00023ac0: 6e73 2077 6974 6820 6461 7465 2069 6e20  ns with date in 
-00023ad0: 6173 6365 6e64 696e 6720 6f72 6465 720a  ascending order.
-00023ae0: 2020 2020 2020 2020 6466 5f6e 6577 203d          df_new =
-00023af0: 2064 6174 615b 3a3a 2d31 5d0a 2020 2020   data[::-1].    
-00023b00: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00023b10: 2020 2020 2064 665f 6963 6869 203d 2064       df_ichi = d
-00023b20: 665f 6e65 772e 7265 6e61 6d65 280a 2020  f_new.rename(.  
-00023b30: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00023b40: 6c75 6d6e 733d 7b0a 2020 2020 2020 2020  lumns={.        
-00023b50: 2020 2020 2020 2020 2020 2020 224f 7065              "Ope
-00023b60: 6e22 3a20 226f 7065 6e22 2c0a 2020 2020  n": "open",.    
-00023b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b80: 2248 6967 6822 3a20 2268 6967 6822 2c0a  "High": "high",.
-00023b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ba0: 2020 2020 224c 6f77 223a 2022 6c6f 7722      "Low": "low"
-00023bb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00023bc0: 2020 2020 2020 2243 6c6f 7365 223a 2022        "Close": "
-00023bd0: 636c 6f73 6522 2c0a 2020 2020 2020 2020  close",.        
-00023be0: 2020 2020 2020 2020 2020 2020 2256 6f6c              "Vol
-00023bf0: 756d 6522 3a20 2276 6f6c 756d 6522 2c0a  ume": "volume",.
-00023c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c10: 7d0a 2020 2020 2020 2020 2020 2020 290a  }.            ).
-00023c20: 2020 2020 2020 2020 2020 2020 6963 6869              ichi
-00023c30: 203d 2070 6b74 616c 6962 2e69 6368 696d   = pktalib.ichim
-00023c40: 6f6b 7528 6466 5f69 6368 692c 2039 2c20  oku(df_ichi, 9, 
-00023c50: 3236 2c20 3532 2c20 3236 290a 2020 2020  26, 52, 26).    
-00023c60: 2020 2020 2020 2020 6966 2069 6368 6920          if ichi 
-00023c70: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00023c80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00023c90: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00023ca0: 2020 6466 5f6e 6577 203d 2070 642e 636f    df_new = pd.co
-00023cb0: 6e63 6174 285b 6466 5f6e 6577 2c20 6963  ncat([df_new, ic
-00023cc0: 6869 5d2c 2061 7869 733d 3129 0a20 2020  hi], axis=1).   
-00023cd0: 2020 2020 2020 2020 2023 2052 6576 6572           # Rever
-00023ce0: 7365 2061 6761 696e 2074 6f20 6765 7420  se again to get 
-00023cf0: 7468 6520 6d6f 7374 2072 6563 656e 7420  the most recent 
-00023d00: 6461 7465 206f 6e20 746f 700a 2020 2020  date on top.    
-00023d10: 2020 2020 2020 2020 6466 5f6e 6577 203d          df_new =
-00023d20: 2064 665f 6e65 775b 3a3a 2d31 5d0a 2020   df_new[::-1].  
-00023d30: 2020 2020 2020 2020 2020 6466 5f6e 6577            df_new
-00023d40: 203d 2064 665f 6e65 772e 6865 6164 2831   = df_new.head(1
-00023d50: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-00023d60: 5f6e 6577 5b22 636c 6f75 645f 6772 6565  _new["cloud_gree
-00023d70: 6e22 5d20 3d20 6466 5f6e 6577 5b22 4953  n"] = df_new["IS
-00023d80: 415f 3922 5d2e 696c 6f63 5b30 5d20 3e20  A_9"].iloc[0] > 
-00023d90: 6466 5f6e 6577 5b22 4953 425f 3236 225d  df_new["ISB_26"]
-00023da0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
-00023db0: 2020 2020 2064 665f 6e65 775b 2263 6c6f       df_new["clo
-00023dc0: 7564 5f72 6564 225d 203d 2064 665f 6e65  ud_red"] = df_ne
-00023dd0: 775b 2249 5342 5f32 3622 5d2e 696c 6f63  w["ISB_26"].iloc
-00023de0: 5b30 5d20 3e20 6466 5f6e 6577 5b22 4953  [0] > df_new["IS
-00023df0: 415f 3922 5d2e 696c 6f63 5b30 5d0a 2020  A_9"].iloc[0].  
-00023e00: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00023e10: 6570 7469 6f6e 2061 7320 653a 2020 2320  eption as e:  # 
-00023e20: 7072 6167 6d61 3a20 6e6f 2063 6f76 6572  pragma: no cover
-00023e30: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00023e40: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
-00023e50: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
-00023e60: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
-00023e70: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00023e80: 2020 6162 6f76 6543 6c6f 7564 546f 7020    aboveCloudTop 
-00023e90: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00023ea0: 2320 6261 7365 6c69 6e65 203e 2063 6c6f  # baseline > clo
-00023eb0: 7564 2074 6f70 2028 636c 6f75 6420 6973  ud top (cloud is
-00023ec0: 2062 6f75 6e64 2062 7920 7370 616e 2061   bound by span a
-00023ed0: 2061 6e64 2073 7061 6e20 6229 2061 6e64   and span b) and
-00023ee0: 2063 6c6f 7365 2069 7320 3e20 636c 6f75   close is > clou
-00023ef0: 6420 746f 700a 2020 2020 2020 2020 6966  d top.        if
-00023f00: 2064 665f 6e65 775b 2263 6c6f 7564 5f67   df_new["cloud_g
-00023f10: 7265 656e 225d 2e69 6c6f 635b 305d 3a0a  reen"].iloc[0]:.
-00023f20: 2020 2020 2020 2020 2020 2020 6162 6f76              abov
-00023f30: 6543 6c6f 7564 546f 7020 3d20 280a 2020  eCloudTop = (.  
-00023f40: 2020 2020 2020 2020 2020 2020 2020 6466                df
-00023f50: 5f6e 6577 5b22 494b 535f 3236 225d 2e69  _new["IKS_26"].i
-00023f60: 6c6f 635b 305d 203e 2064 665f 6e65 775b  loc[0] > df_new[
-00023f70: 2249 5341 5f39 225d 2e69 6c6f 635b 305d  "ISA_9"].iloc[0]
-00023f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023f90: 2061 6e64 2072 6563 656e 745b 2243 6c6f   and recent["Clo
-00023fa0: 7365 225d 2e69 6c6f 635b 305d 203e 2064  se"].iloc[0] > d
-00023fb0: 665f 6e65 775b 2249 5341 5f39 225d 2e69  f_new["ISA_9"].i
-00023fc0: 6c6f 635b 305d 0a20 2020 2020 2020 2020  loc[0].         
-00023fd0: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
-00023fe0: 6620 6466 5f6e 6577 5b22 636c 6f75 645f  f df_new["cloud_
-00023ff0: 7265 6422 5d2e 696c 6f63 5b30 5d3a 0a20  red"].iloc[0]:. 
-00024000: 2020 2020 2020 2020 2020 2061 626f 7665             above
-00024010: 436c 6f75 6454 6f70 203d 2028 0a20 2020  CloudTop = (.   
-00024020: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-00024030: 6e65 775b 2249 4b53 5f32 3622 5d2e 696c  new["IKS_26"].il
-00024040: 6f63 5b30 5d20 3e20 6466 5f6e 6577 5b22  oc[0] > df_new["
-00024050: 4953 425f 3236 225d 2e69 6c6f 635b 305d  ISB_26"].iloc[0]
-00024060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024070: 2061 6e64 2072 6563 656e 745b 2243 6c6f   and recent["Clo
-00024080: 7365 225d 2e69 6c6f 635b 305d 203e 2064  se"].iloc[0] > d
-00024090: 665f 6e65 775b 2249 5342 5f32 3622 5d2e  f_new["ISB_26"].
-000240a0: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
-000240b0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-000240c0: 204c 6174 6573 7420 4963 6869 6d6f 6b75   Latest Ichimoku
-000240d0: 2062 6173 656c 696e 6520 6973 203c 206c   baseline is < l
-000240e0: 6174 6573 7420 4963 6869 6d6f 6b75 2063  atest Ichimoku c
-000240f0: 6f6e 7665 7273 696f 6e20 6c69 6e65 0a20  onversion line. 
-00024100: 2020 2020 2020 2069 6620 6162 6f76 6543         if aboveC
-00024110: 6c6f 7564 546f 7020 616e 6420 6466 5f6e  loudTop and df_n
-00024120: 6577 5b22 494b 535f 3236 225d 2e69 6c6f  ew["IKS_26"].ilo
-00024130: 635b 305d 203c 2064 665f 6e65 775b 2249  c[0] < df_new["I
-00024140: 5453 5f39 225d 2e69 6c6f 635b 305d 3a0a  TS_9"].iloc[0]:.
-00024150: 2020 2020 2020 2020 2020 2020 2320 5374              # St
-00024160: 6f63 6852 5349 2063 726f 7373 6564 2032  ochRSI crossed 2
-00024170: 3020 616e 6420 5253 4920 3e20 3530 0a20  0 and RSI > 50. 
-00024180: 2020 2020 2020 2020 2020 2069 6620 666b             if fk
-00024190: 203e 2032 3020 616e 6420 7265 6365 6e74   > 20 and recent
-000241a0: 5b22 5253 4922 5d2e 696c 6f63 5b30 5d20  ["RSI"].iloc[0] 
-000241b0: 3e20 3530 3a0a 2020 2020 2020 2020 2020  > 50:.          
-000241c0: 2020 2020 2020 2320 636f 6e64 6974 696f        # conditio
-000241d0: 6e20 6f66 2063 726f 7373 696e 6720 7468  n of crossing th
-000241e0: 6520 5374 6f63 6852 5349 206d 6169 6e20  e StochRSI main 
-000241f0: 7369 676e 616c 206c 696e 6520 6672 6f6d  signal line from
-00024200: 2062 6f74 746f 6d20 746f 2074 6f70 0a20   bottom to top. 
-00024210: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00024220: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00024230: 2020 2020 2020 2020 6461 7461 5b22 4641          data["FA
-00024240: 5354 4422 5d2e 696c 6f63 5b31 3030 5d20  STD"].iloc[100] 
-00024250: 3c20 6461 7461 5b22 4641 5354 4b22 5d2e  < data["FASTK"].
-00024260: 696c 6f63 5b31 3030 5d0a 2020 2020 2020  iloc[100].      
-00024270: 2020 2020 2020 2020 2020 2020 2020 616e                an
-00024280: 6420 6461 7461 5b22 4641 5354 4422 5d2e  d data["FASTD"].
-00024290: 696c 6f63 5b31 3031 5d20 3e20 6461 7461  iloc[101] > data
-000242a0: 5b22 4641 5354 4b22 5d2e 696c 6f63 5b31  ["FASTK"].iloc[1
-000242b0: 3031 5d0a 2020 2020 2020 2020 2020 2020  01].            
-000242c0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-000242d0: 2020 2020 2020 2020 2020 2023 2063 6c6f             # clo
-000242e0: 7365 203e 2035 3020 7065 7269 6f64 2053  se > 50 period S
-000242f0: 4d41 2f45 4d41 2061 6e64 2032 3030 2070  MA/EMA and 200 p
-00024300: 6572 696f 6420 534d 412f 454d 410a 2020  eriod SMA/EMA.  
-00024310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024320: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-00024330: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00024340: 6563 656e 745b 2253 534d 4122 5d2e 696c  ecent["SSMA"].il
-00024350: 6f63 5b30 5d20 3e20 7265 6365 6e74 5b22  oc[0] > recent["
-00024360: 534d 4122 5d2e 696c 6f63 5b30 5d0a 2020  SMA"].iloc[0].  
-00024370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024380: 2020 2020 2020 616e 6420 7265 6365 6e74        and recent
-00024390: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
-000243a0: 5d20 3e20 7265 6365 6e74 5b22 5353 4d41  ] > recent["SSMA
-000243b0: 225d 2e69 6c6f 635b 305d 0a20 2020 2020  "].iloc[0].     
-000243c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000243d0: 2020 2061 6e64 2072 6563 656e 745b 2243     and recent["C
-000243e0: 6c6f 7365 225d 2e69 6c6f 635b 305d 203e  lose"].iloc[0] >
-000243f0: 2072 6563 656e 745b 224c 4d41 225d 2e69   recent["LMA"].i
-00024400: 6c6f 635b 305d 0a20 2020 2020 2020 2020  loc[0].         
-00024410: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
-00024420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024430: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
-00024440: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
-00024450: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
-00024460: 6963 742c 7361 7665 4469 6374 2c22 4d41  ict,saveDict,"MA
-00024470: 2d53 6967 6e61 6c22 290a 2020 2020 2020  -Signal").      
-00024480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024490: 2020 7363 7265 656e 4469 6374 5b22 4d41    screenDict["MA
-000244a0: 2d53 6967 6e61 6c22 5d20 3d20 280a 2020  -Signal"] = (.  
-000244b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000244c0: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
-000244d0: 305d 202b 2063 6f6c 6f72 5465 7874 2e42  0] + colorText.B
-000244e0: 4f4c 4420 2b20 636f 6c6f 7254 6578 742e  OLD + colorText.
-000244f0: 4752 4545 4e20 2b20 2242 756c 6c69 7368  GREEN + "Bullish
-00024500: 2220 2b20 636f 6c6f 7254 6578 742e 454e  " + colorText.EN
-00024510: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-00024520: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00024530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024540: 2020 2020 7361 7665 4469 6374 5b22 4d41      saveDict["MA
-00024550: 2d53 6967 6e61 6c22 5d20 3d20 7361 7665  -Signal"] = save
-00024560: 645b 315d 202b 2022 4275 6c6c 6973 6822  d[1] + "Bullish"
-00024570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024580: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00024590: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
-000245a0: 7572 6e20 4661 6c73 650a 2020 2020 0a20  urn False.    . 
-000245b0: 2020 2023 2056 616c 6964 6174 6520 5643     # Validate VC
-000245c0: 5020 6173 2070 6572 204d 6172 6b20 4d69  P as per Mark Mi
-000245d0: 6e65 7276 696e 690a 2020 2020 2320 6874  nervini.    # ht
-000245e0: 7470 733a 2f2f 6368 6172 7469 6e6b 2e63  tps://chartink.c
-000245f0: 6f6d 2f73 6372 6565 6e65 722f 766f 6c61  om/screener/vola
-00024600: 7469 6c69 7479 2d63 6f6d 7072 6573 7369  tility-compressi
-00024610: 6f6e 0a20 2020 2064 6566 2076 616c 6964  on.    def valid
-00024620: 6174 6556 4350 4d61 726b 4d69 6e65 7276  ateVCPMarkMinerv
-00024630: 696e 6928 7365 6c66 2c20 6466 3a70 642e  ini(self, df:pd.
-00024640: 4461 7461 4672 616d 652c 2073 6372 6565  DataFrame, scree
-00024650: 6e44 6963 742c 2073 6176 6544 6963 7429  nDict, saveDict)
-00024660: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
-00024670: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
-00024680: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
-00024690: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-000246a0: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
-000246b0: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
-000246c0: 2020 206f 686c 635f 6469 6374 203d 207b     ohlc_dict = {
-000246d0: 0a20 2020 2020 2020 2020 2020 2027 4f70  .            'Op
-000246e0: 656e 273a 2766 6972 7374 272c 0a20 2020  en':'first',.   
-000246f0: 2020 2020 2020 2020 2027 4869 6768 273a           'High':
-00024700: 276d 6178 272c 0a20 2020 2020 2020 2020  'max',.         
-00024710: 2020 2027 4c6f 7727 3a27 6d69 6e27 2c0a     'Low':'min',.
-00024720: 2020 2020 2020 2020 2020 2020 2743 6c6f              'Clo
-00024730: 7365 273a 276c 6173 7427 2c0a 2020 2020  se':'last',.    
-00024740: 2020 2020 2020 2020 2756 6f6c 756d 6527          'Volume'
-00024750: 3a27 7375 6d27 0a20 2020 2020 2020 207d  :'sum'.        }
-00024760: 0a20 2020 2020 2020 2023 2066 696e 616c  .        # final
-00024770: 5f64 6620 3d20 6466 2e72 6573 616d 706c  _df = df.resampl
-00024780: 6528 2757 2d46 5249 272c 2063 6c6f 7365  e('W-FRI', close
-00024790: 643d 276c 6566 7427 292e 6167 6728 6f68  d='left').agg(oh
-000247a0: 6c63 5f64 6963 7429 2e73 6869 6674 2827  lc_dict).shift('
-000247b0: 3164 2729 0a20 2020 2020 2020 2077 6565  1d').        wee
-000247c0: 6b6c 7944 6174 6120 3d20 6461 7461 2e72  klyData = data.r
-000247d0: 6573 616d 706c 6528 2757 2729 2e61 6767  esample('W').agg
-000247e0: 286f 686c 635f 6469 6374 290a 2020 2020  (ohlc_dict).    
-000247f0: 2020 2020 7265 7665 7273 6564 4461 7461      reversedData
-00024800: 203d 2064 6174 615b 3a3a 2d31 5d20 2023   = data[::-1]  #
-00024810: 2052 6576 6572 7365 2074 6865 2064 6174   Reverse the dat
-00024820: 6166 7261 6d65 0a20 2020 2020 2020 2072  aframe.        r
-00024830: 6563 656e 745f 636c 6f73 6520 3d20 6461  ecent_close = da
-00024840: 7461 5b22 436c 6f73 6522 5d2e 6865 6164  ta["Close"].head
-00024850: 2831 292e 696c 6f63 5b30 5d0a 2020 2020  (1).iloc[0].    
-00024860: 2020 2020 775f 656d 615f 3133 203d 2070      w_ema_13 = p
-00024870: 6b74 616c 6962 2e45 4d41 2877 6565 6b6c  ktalib.EMA(weekl
-00024880: 7944 6174 615b 2243 6c6f 7365 225d 2c74  yData["Close"],t
-00024890: 696d 6570 6572 696f 643d 3133 292e 7461  imeperiod=13).ta
-000248a0: 696c 2831 292e 696c 6f63 5b30 5d0a 2020  il(1).iloc[0].  
-000248b0: 2020 2020 2020 775f 656d 615f 3236 203d        w_ema_26 =
-000248c0: 2070 6b74 616c 6962 2e45 4d41 2877 6565   pktalib.EMA(wee
-000248d0: 6b6c 7944 6174 615b 2243 6c6f 7365 225d  klyData["Close"]
-000248e0: 2c74 696d 6570 6572 696f 643d 3236 292e  ,timeperiod=26).
-000248f0: 7461 696c 2831 292e 696c 6f63 5b30 5d0a  tail(1).iloc[0].
-00024900: 2020 2020 2020 2020 775f 736d 615f 3530          w_sma_50
-00024910: 203d 2070 6b74 616c 6962 2e53 4d41 2877   = pktalib.SMA(w
-00024920: 6565 6b6c 7944 6174 615b 2243 6c6f 7365  eeklyData["Close
-00024930: 225d 2c74 696d 6570 6572 696f 643d 3530  "],timeperiod=50
-00024940: 292e 7461 696c 2831 292e 696c 6f63 5b30  ).tail(1).iloc[0
-00024950: 5d0a 2020 2020 2020 2020 775f 736d 615f  ].        w_sma_
-00024960: 3430 203d 2070 6b74 616c 6962 2e53 4d41  40 = pktalib.SMA
-00024970: 2877 6565 6b6c 7944 6174 615b 2243 6c6f  (weeklyData["Clo
-00024980: 7365 225d 2c74 696d 6570 6572 696f 643d  se"],timeperiod=
-00024990: 3430 292e 7461 696c 2831 292e 696c 6f63  40).tail(1).iloc
-000249a0: 5b30 5d0a 2020 2020 2020 2020 775f 736d  [0].        w_sm
-000249b0: 615f 3430 5f35 775f 6167 6f20 3d20 706b  a_40_5w_ago = pk
-000249c0: 7461 6c69 622e 534d 4128 7765 656b 6c79  talib.SMA(weekly
-000249d0: 4461 7461 2e68 6561 6428 6c65 6e28 7765  Data.head(len(we
-000249e0: 656b 6c79 4461 7461 292d 3529 5b22 436c  eklyData)-5)["Cl
+000222c0: 2020 2020 2020 2020 2020 2020 7361 7665              save
+000222d0: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
+000222e0: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
+000222f0: 742e 4752 4545 4e20 2b20 6622 4275 6c6c  t.GREEN + f"Bull
+00022300: 4372 6f73 732d 7b6d 6154 6578 7473 5b69  Cross-{maTexts[i
+00022310: 6e64 6578 5d7d 2220 2b20 636f 6c6f 7254  ndex]}" + colorT
+00022320: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+00022330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022340: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00022350: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
+00022360: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d20  ct["MA-Signal"] 
+00022370: 3d20 7361 7665 645b 315d 202b 2066 2242  = saved[1] + f"B
+00022380: 756c 6c43 726f 7373 2d7b 6d61 5465 7874  ullCross-{maText
+00022390: 735b 696e 6465 785d 7d22 0a20 2020 2020  s[index]}".     
+000223a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000223b0: 2020 206d 6152 6576 6572 7361 6c20 3d20     maReversal = 
+000223c0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+000223d0: 2020 2020 2020 2020 2020 6d61 5369 676e            maSign
+000223e0: 616c 732e 6170 7065 6e64 2822 3522 290a  als.append("5").
+000223f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022400: 2320 466f 7220 6120 4265 6172 6973 6820  # For a Bearish 
+00022410: 4361 6e64 6c65 0a20 2020 2020 2020 2020  Candle.         
+00022420: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
+00022430: 6275 6c6c 6973 6843 616e 646c 653a 0a20  bullishCandle:. 
+00022440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022450: 2020 2023 2043 726f 7373 696e 6720 646f     # Crossing do
+00022460: 776e 0a20 2020 2020 2020 2020 2020 2020  wn.             
+00022470: 2020 2020 2020 2069 6620 6f70 656e 203e         if open >
+00022480: 2073 6d61 2061 6e64 2063 6c6f 7365 203c   sma and close <
+00022490: 2073 6d61 2061 6e64 2073 7472 286d 614c   sma and str(maL
+000224a0: 656e 6774 6829 2069 6e20 5b22 3022 2c22  ength) in ["0","
+000224b0: 3422 5d3a 0a20 2020 2020 2020 2020 2020  4"]:.           
+000224c0: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+000224d0: 6565 6e44 6963 745b 224d 412d 5369 676e  eenDict["MA-Sign
+000224e0: 616c 225d 203d 2028 0a20 2020 2020 2020  al"] = (.       
+000224f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022500: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
+00022510: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
+00022520: 2063 6f6c 6f72 5465 7874 2e46 4149 4c20   colorText.FAIL 
+00022530: 2b20 6622 4265 6172 4372 6f73 732d 7b6d  + f"BearCross-{m
+00022540: 6154 6578 7473 5b69 6e64 6578 5d7d 2220  aTexts[index]}" 
+00022550: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+00022560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022570: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00022580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022590: 2020 7361 7665 4469 6374 5b22 4d41 2d53    saveDict["MA-S
+000225a0: 6967 6e61 6c22 5d20 3d20 7361 7665 645b  ignal"] = saved[
+000225b0: 315d 202b 2066 2242 6561 7243 726f 7373  1] + f"BearCross
+000225c0: 2d7b 6d61 5465 7874 735b 696e 6465 785d  -{maTexts[index]
+000225d0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+000225e0: 2020 2020 2020 2020 2020 206d 6152 6576             maRev
+000225f0: 6572 7361 6c20 3d20 2d31 0a20 2020 2020  ersal = -1.     
+00022600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022610: 2020 206d 6153 6967 6e61 6c73 2e61 7070     maSignals.app
+00022620: 656e 6428 2234 2229 0a20 2020 2020 2020  end("4").       
+00022630: 2020 2020 2020 2020 2069 6e64 6578 202b           index +
+00022640: 3d20 310a 2020 2020 2020 2020 7265 7475  = 1.        retu
+00022650: 726e 5661 6c75 6520 3d20 6d61 5265 7665  rnValue = maReve
+00022660: 7273 616c 0a20 2020 2020 2020 2069 6620  rsal.        if 
+00022670: 6d61 4c65 6e67 7468 2021 3d20 303a 0a20  maLength != 0:. 
+00022680: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00022690: 6e56 616c 7565 203d 2073 7472 286d 614c  nValue = str(maL
+000226a0: 656e 6774 6829 2069 6e20 6d61 5369 676e  ength) in maSign
+000226b0: 616c 730a 2020 2020 2020 2020 7265 7475  als.        retu
+000226c0: 726e 2072 6574 7572 6e56 616c 7565 0a0a  rn returnValue..
+000226d0: 2020 2020 2320 4669 6e64 204e 5278 2072      # Find NRx r
+000226e0: 616e 6765 2066 6f72 2052 6576 6572 7361  ange for Reversa
+000226f0: 6c0a 2020 2020 6465 6620 7661 6c69 6461  l.    def valida
+00022700: 7465 4e61 7272 6f77 5261 6e67 6528 7365  teNarrowRange(se
+00022710: 6c66 2c20 6466 2c20 7363 7265 656e 4469  lf, df, screenDi
+00022720: 6374 2c20 7361 7665 4469 6374 2c20 6e72  ct, saveDict, nr
+00022730: 3d34 293a 0a20 2020 2020 2020 2069 6620  =4):.        if 
+00022740: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
+00022750: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
+00022760: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00022770: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
+00022780: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
+00022790: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
+000227a0: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
+000227b0: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
+000227c0: 6963 742c 2073 6176 6544 6963 742c 2022  ict, saveDict, "
+000227d0: 5061 7474 6572 6e22 290a 2020 2020 2020  Pattern").      
+000227e0: 2020 6966 2050 4b44 6174 6555 7469 6c69    if PKDateUtili
+000227f0: 7469 6573 2e69 7354 7261 6469 6e67 5469  ties.isTradingTi
+00022800: 6d65 2829 3a0a 2020 2020 2020 2020 2020  me():.          
+00022810: 2020 7261 6e67 6544 6174 6120 3d20 6461    rangeData = da
+00022820: 7461 2e68 6561 6428 6e72 202b 2031 295b  ta.head(nr + 1)[
+00022830: 313a 5d0a 2020 2020 2020 2020 2020 2020  1:].            
+00022840: 6e6f 775f 6361 6e64 6c65 203d 2064 6174  now_candle = dat
+00022850: 612e 6865 6164 2831 290a 2020 2020 2020  a.head(1).      
+00022860: 2020 2020 2020 7261 6e67 6544 6174 615b        rangeData[
+00022870: 2252 616e 6765 225d 203d 2061 6273 2872  "Range"] = abs(r
+00022880: 616e 6765 4461 7461 5b22 436c 6f73 6522  angeData["Close"
+00022890: 5d20 2d20 7261 6e67 6544 6174 615b 224f  ] - rangeData["O
+000228a0: 7065 6e22 5d29 0a20 2020 2020 2020 2020  pen"]).         
+000228b0: 2020 2072 6563 656e 7420 3d20 7261 6e67     recent = rang
+000228c0: 6544 6174 612e 6865 6164 2831 290a 2020  eData.head(1).  
+000228d0: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
+000228e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000228f0: 656e 2872 6563 656e 7429 203d 3d20 310a  en(recent) == 1.
+00022900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022910: 616e 6420 7265 6365 6e74 5b22 5261 6e67  and recent["Rang
+00022920: 6522 5d2e 696c 6f63 5b30 5d20 3d3d 2072  e"].iloc[0] == r
+00022930: 616e 6765 4461 7461 2e64 6573 6372 6962  angeData.describ
+00022940: 6528 295b 2252 616e 6765 225d 5b22 6d69  e()["Range"]["mi
+00022950: 6e22 5d0a 2020 2020 2020 2020 2020 2020  n"].            
+00022960: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00022970: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
+00022980: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00022990: 2e67 6574 4361 6e64 6c65 5479 7065 2872  .getCandleType(r
+000229a0: 6563 656e 7429 0a20 2020 2020 2020 2020  ecent).         
+000229b0: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
+000229c0: 6f77 5f63 616e 646c 655b 2243 6c6f 7365  ow_candle["Close
+000229d0: 225d 2e69 6c6f 635b 305d 203e 3d20 7265  "].iloc[0] >= re
+000229e0: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
+000229f0: 6f63 5b30 5d0a 2020 2020 2020 2020 2020  oc[0].          
+00022a00: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00022a10: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+00022a20: 6565 6e44 6963 745b 2250 6174 7465 726e  eenDict["Pattern
+00022a30: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+00022a40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00022a50: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
+00022a60: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
+00022a70: 5465 7874 2e47 5245 454e 202b 2066 2242  Text.GREEN + f"B
+00022a80: 7579 2d4e 527b 6e72 7d22 202b 2063 6f6c  uy-NR{nr}" + col
+00022a90: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+00022aa0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00022ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022ac0: 2020 2020 2073 6176 6544 6963 745b 2250       saveDict["P
+00022ad0: 6174 7465 726e 225d 203d 2073 6176 6564  attern"] = saved
+00022ae0: 5b31 5d20 2b20 6622 4275 792d 4e52 7b6e  [1] + f"Buy-NR{n
+00022af0: 727d 220a 2020 2020 2020 2020 2020 2020  r}".            
+00022b00: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00022b10: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00022b20: 2020 2020 656c 6966 2028 0a20 2020 2020      elif (.     
+00022b30: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00022b40: 6f74 2073 656c 662e 6765 7443 616e 646c  ot self.getCandl
+00022b50: 6554 7970 6528 7265 6365 6e74 290a 2020  eType(recent).  
+00022b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b70: 2020 616e 6420 6e6f 775f 6361 6e64 6c65    and now_candle
+00022b80: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+00022b90: 5d20 3c3d 2072 6563 656e 745b 2243 6c6f  ] <= recent["Clo
+00022ba0: 7365 225d 2e69 6c6f 635b 305d 0a20 2020  se"].iloc[0].   
+00022bb0: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
+00022bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bd0: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+00022be0: 5061 7474 6572 6e22 5d20 3d20 280a 2020  Pattern"] = (.  
+00022bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022c00: 2020 2020 2020 7361 7665 645b 305d 202b        saved[0] +
+00022c10: 2063 6f6c 6f72 5465 7874 2e42 4f4c 4420   colorText.BOLD 
+00022c20: 2b20 636f 6c6f 7254 6578 742e 4641 494c  + colorText.FAIL
+00022c30: 202b 2066 2253 656c 6c2d 4e52 7b6e 727d   + f"Sell-NR{nr}
+00022c40: 2220 2b20 636f 6c6f 7254 6578 742e 454e  " + colorText.EN
+00022c50: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+00022c60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00022c70: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00022c80: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+00022c90: 3d20 7361 7665 645b 315d 202b 2066 2253  = saved[1] + f"S
+00022ca0: 656c 6c2d 4e52 7b6e 727d 220a 2020 2020  ell-NR{nr}".    
+00022cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022cc0: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+00022cd0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00022ce0: 616c 7365 0a20 2020 2020 2020 2065 6c73  alse.        els
+00022cf0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00022d00: 616e 6765 4461 7461 203d 2064 6174 612e  angeData = data.
+00022d10: 6865 6164 286e 7229 0a20 2020 2020 2020  head(nr).       
+00022d20: 2020 2020 2072 616e 6765 4461 7461 2e6c       rangeData.l
+00022d30: 6f63 5b3a 2c27 5261 6e67 6527 5d20 3d20  oc[:,'Range'] = 
+00022d40: 6162 7328 7261 6e67 6544 6174 615b 2243  abs(rangeData["C
+00022d50: 6c6f 7365 225d 202d 2072 616e 6765 4461  lose"] - rangeDa
+00022d60: 7461 5b22 4f70 656e 225d 290a 2020 2020  ta["Open"]).    
+00022d70: 2020 2020 2020 2020 7265 6365 6e74 203d          recent =
+00022d80: 2072 616e 6765 4461 7461 2e68 6561 6428   rangeData.head(
+00022d90: 3129 0a20 2020 2020 2020 2020 2020 2069  1).            i
+00022da0: 6620 7265 6365 6e74 5b22 5261 6e67 6522  f recent["Range"
+00022db0: 5d2e 696c 6f63 5b30 5d20 3d3d 2072 616e  ].iloc[0] == ran
+00022dc0: 6765 4461 7461 2e64 6573 6372 6962 6528  geData.describe(
+00022dd0: 295b 2252 616e 6765 225d 5b22 6d69 6e22  )["Range"]["min"
+00022de0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00022df0: 2020 2073 6372 6565 6e44 6963 745b 2250     screenDict["P
+00022e00: 6174 7465 726e 225d 203d 2028 0a20 2020  attern"] = (.   
+00022e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022e20: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
+00022e30: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+00022e40: 6f72 5465 7874 2e47 5245 454e 202b 2066  orText.GREEN + f
+00022e50: 224e 527b 6e72 7d22 202b 2063 6f6c 6f72  "NR{nr}" + color
+00022e60: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+00022e70: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00022e80: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+00022e90: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
+00022ea0: 2073 6176 6564 5b31 5d20 2b20 6622 4e52   saved[1] + f"NR
+00022eb0: 7b6e 727d 220a 2020 2020 2020 2020 2020  {nr}".          
+00022ec0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00022ed0: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
+00022ee0: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
+00022ef0: 2320 4669 6e64 2069 6620 7374 6f63 6b20  # Find if stock 
+00022f00: 6973 206e 6577 6c79 206c 6973 7465 640a  is newly listed.
+00022f10: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
+00022f20: 4e65 776c 794c 6973 7465 6428 7365 6c66  NewlyListed(self
+00022f30: 2c20 6466 2c20 6461 7973 546f 4c6f 6f6b  , df, daysToLook
+00022f40: 6261 636b 293a 0a20 2020 2020 2020 2069  back):.        i
+00022f50: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
+00022f60: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
+00022f70: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00022f80: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
+00022f90: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
+00022fa0: 2020 2020 2020 2020 6461 7973 546f 4c6f          daysToLo
+00022fb0: 6f6b 6261 636b 203d 2069 6e74 2864 6179  okback = int(day
+00022fc0: 7354 6f4c 6f6f 6b62 6163 6b5b 3a2d 315d  sToLookback[:-1]
+00022fd0: 290a 2020 2020 2020 2020 7265 6365 6e74  ).        recent
+00022fe0: 203d 2064 6174 612e 6865 6164 2831 290a   = data.head(1).
+00022ff0: 2020 2020 2020 2020 6966 206c 656e 2872          if len(r
+00023000: 6563 656e 7429 203c 2031 3a0a 2020 2020  ecent) < 1:.    
+00023010: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00023020: 616c 7365 0a20 2020 2020 2020 2069 6620  alse.        if 
+00023030: 6c65 6e28 6461 7461 2920 3c20 6461 7973  len(data) < days
+00023040: 546f 4c6f 6f6b 6261 636b 2061 6e64 2028  ToLookback and (
+00023050: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
+00023060: 656e 745b 2243 6c6f 7365 225d 2e69 6c6f  ent["Close"].ilo
+00023070: 635b 305d 2021 3d20 6e70 2e6e 616e 2061  c[0] != np.nan a
+00023080: 6e64 2072 6563 656e 745b 2243 6c6f 7365  nd recent["Close
+00023090: 225d 2e69 6c6f 635b 305d 203e 2030 0a20  "].iloc[0] > 0. 
+000230a0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+000230b0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+000230c0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+000230d0: 2046 616c 7365 0a0a 2020 2020 2320 5661   False..    # Va
+000230e0: 6c69 6461 7465 2069 6620 7468 6520 7374  lidate if the st
+000230f0: 6f63 6b20 7072 6963 6573 2061 7265 2061  ock prices are a
+00023100: 7420 6c65 6173 7420 7269 7369 6e67 2062  t least rising b
+00023110: 7920 3225 2066 6f72 2074 6865 206c 6173  y 2% for the las
+00023120: 7420 3320 7365 7373 696f 6e73 0a20 2020  t 3 sessions.   
+00023130: 2064 6566 2076 616c 6964 6174 6550 7269   def validatePri
+00023140: 6365 5269 7369 6e67 4279 4174 4c65 6173  ceRisingByAtLeas
+00023150: 7432 5065 7263 656e 7428 7365 6c66 2c20  t2Percent(self, 
+00023160: 6466 2c20 7363 7265 656e 4469 6374 2c20  df, screenDict, 
+00023170: 7361 7665 4469 6374 293a 0a20 2020 2020  saveDict):.     
+00023180: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
+00023190: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
+000231a0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000231b0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+000231c0: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
+000231d0: 7928 290a 2020 2020 2020 2020 6461 7461  y().        data
+000231e0: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
+000231f0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+00023200: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
+00023210: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
+00023220: 2030 290a 2020 2020 2020 2020 6461 7461   0).        data
+00023230: 203d 2064 6174 612e 6865 6164 2834 290a   = data.head(4).
+00023240: 2020 2020 2020 2020 6966 206c 656e 2864          if len(d
+00023250: 6174 6129 203c 2034 3a0a 2020 2020 2020  ata) < 4:.      
+00023260: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00023270: 7365 0a20 2020 2020 2020 2064 6179 3020  se.        day0 
+00023280: 3d20 6461 7461 2e69 6c6f 635b 305d 5b22  = data.iloc[0]["
+00023290: 436c 6f73 6522 5d2e 6974 656d 2829 0a20  Close"].item(). 
+000232a0: 2020 2020 2020 2064 6179 4d69 6e75 7331         dayMinus1
+000232b0: 203d 2064 6174 612e 696c 6f63 5b31 5d5b   = data.iloc[1][
+000232c0: 2243 6c6f 7365 225d 2e69 7465 6d28 290a  "Close"].item().
+000232d0: 2020 2020 2020 2020 6461 794d 696e 7573          dayMinus
+000232e0: 3220 3d20 6461 7461 2e69 6c6f 635b 325d  2 = data.iloc[2]
+000232f0: 5b22 436c 6f73 6522 5d2e 6974 656d 2829  ["Close"].item()
+00023300: 0a20 2020 2020 2020 2064 6179 4d69 6e75  .        dayMinu
+00023310: 7333 203d 2064 6174 612e 696c 6f63 5b33  s3 = data.iloc[3
+00023320: 5d5b 2243 6c6f 7365 225d 2e69 7465 6d28  ]["Close"].item(
+00023330: 290a 2020 2020 2020 2020 7065 7263 656e  ).        percen
+00023340: 7433 203d 2072 6f75 6e64 2828 6461 794d  t3 = round((dayM
+00023350: 696e 7573 3220 2d20 6461 794d 696e 7573  inus2 - dayMinus
+00023360: 3329 202a 2031 3030 202f 2064 6179 4d69  3) * 100 / dayMi
+00023370: 6e75 7333 2c20 3229 0a20 2020 2020 2020  nus3, 2).       
+00023380: 2070 6572 6365 6e74 3220 3d20 726f 756e   percent2 = roun
+00023390: 6428 2864 6179 4d69 6e75 7331 202d 2064  d((dayMinus1 - d
+000233a0: 6179 4d69 6e75 7332 2920 2a20 3130 3020  ayMinus2) * 100 
+000233b0: 2f20 6461 794d 696e 7573 322c 2032 290a  / dayMinus2, 2).
+000233c0: 2020 2020 2020 2020 7065 7263 656e 7431          percent1
+000233d0: 203d 2072 6f75 6e64 2828 6461 7930 202d   = round((day0 -
+000233e0: 2064 6179 4d69 6e75 7331 2920 2a20 3130   dayMinus1) * 10
+000233f0: 3020 2f20 6461 794d 696e 7573 312c 2032  0 / dayMinus1, 2
+00023400: 290a 0a20 2020 2020 2020 2069 6620 7065  )..        if pe
+00023410: 7263 656e 7431 203e 3d20 3220 616e 6420  rcent1 >= 2 and 
+00023420: 7065 7263 656e 7432 203e 3d20 3220 616e  percent2 >= 2 an
+00023430: 6420 7065 7263 656e 7433 203e 3d20 323a  d percent3 >= 2:
+00023440: 0a20 2020 2020 2020 2020 2020 2070 6374  .            pct
+00023450: 5f63 6861 6e67 655f 7465 7874 203d 2028  _change_text = (
+00023460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023470: 2028 2225 2e31 6625 2522 2025 2070 6572   ("%.1f%%" % per
+00023480: 6365 6e74 3129 0a20 2020 2020 2020 2020  cent1).         
+00023490: 2020 2020 2020 202b 2028 2220 2825 2e31         + (" (%.1
+000234a0: 6625 252c 2220 2520 7065 7263 656e 7432  f%%," % percent2
+000234b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000234c0: 2020 2b20 2822 2025 2e31 6625 2529 2220    + (" %.1f%%)" 
+000234d0: 2520 7065 7263 656e 7433 290a 2020 2020  % percent3).    
+000234e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000234f0: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+00023500: 2543 686e 6722 5d20 3d20 7063 745f 6368  %Chng"] = pct_ch
+00023510: 616e 6765 5f74 6578 740a 2020 2020 2020  ange_text.      
+00023520: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+00023530: 5b22 2543 686e 6722 5d20 3d20 636f 6c6f  ["%Chng"] = colo
+00023540: 7254 6578 742e 4752 4545 4e20 2b20 7063  rText.GREEN + pc
+00023550: 745f 6368 616e 6765 5f74 6578 7420 2b20  t_change_text + 
+00023560: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+00023570: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00023580: 2054 7275 6520 616e 6420 7365 6c66 2e67   True and self.g
+00023590: 6574 4361 6e64 6c65 5479 7065 2864 6174  etCandleType(dat
+000235a0: 612e 6865 6164 2831 2929 0a20 2020 2020  a.head(1)).     
+000235b0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+000235c0: 0a20 2020 2023 406d 6561 7375 7265 5f74  .    #@measure_t
+000235d0: 696d 650a 2020 2020 2320 7661 6c69 6461  ime.    # valida
+000235e0: 7465 2069 6620 5253 4920 6973 2077 6974  te if RSI is wit
+000235f0: 6869 6e20 6769 7665 6e20 7261 6e67 650a  hin given range.
+00023600: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
+00023610: 5253 4928 7365 6c66 2c20 6466 2c20 7363  RSI(self, df, sc
+00023620: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
+00023630: 6374 2c20 6d69 6e52 5349 2c20 6d61 7852  ct, minRSI, maxR
+00023640: 5349 2c72 7369 4b65 793d 2252 5349 2229  SI,rsiKey="RSI")
+00023650: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+00023660: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+00023670: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+00023680: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00023690: 650a 2020 2020 2020 2020 6966 2072 7369  e.        if rsi
+000236a0: 4b65 7920 6e6f 7420 696e 2064 662e 636f  Key not in df.co
+000236b0: 6c75 6d6e 733a 0a20 2020 2020 2020 2020  lumns:.         
+000236c0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+000236d0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+000236e0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+000236f0: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
+00023700: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
+00023710: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
+00023720: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
+00023730: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
+00023740: 2072 7369 203d 2069 6e74 2864 6174 612e   rsi = int(data.
+00023750: 6865 6164 2831 295b 7273 694b 6579 5d2e  head(1)[rsiKey].
+00023760: 696c 6f63 5b30 5d29 0a20 2020 2020 2020  iloc[0]).       
+00023770: 2073 6176 6544 6963 745b 7273 694b 6579   saveDict[rsiKey
+00023780: 5d20 3d20 7273 690a 2020 2020 2020 2020  ] = rsi.        
+00023790: 2320 6874 7470 733a 2f2f 6368 6172 7469  # https://charti
+000237a0: 6e6b 2e63 6f6d 2f73 6372 6565 6e65 722f  nk.com/screener/
+000237b0: 7273 692d 7363 7265 656e 696e 670a 2020  rsi-screening.  
+000237c0: 2020 2020 2020 6966 2072 7369 3e20 3020        if rsi> 0 
+000237d0: 616e 6420 7273 6920 3e3d 206d 696e 5253  and rsi >= minRS
+000237e0: 4920 616e 6420 7273 6920 3c3d 206d 6178  I and rsi <= max
+000237f0: 5253 493a 2020 2320 6f72 2028 7273 6920  RSI:  # or (rsi 
+00023800: 3c3d 2037 3120 616e 6420 7273 6920 3e3d  <= 71 and rsi >=
+00023810: 2036 3729 3a0a 2020 2020 2020 2020 2020   67):.          
+00023820: 2020 7363 7265 656e 4469 6374 5b72 7369    screenDict[rsi
+00023830: 4b65 795d 203d 2028 0a20 2020 2020 2020  Key] = (.       
+00023840: 2020 2020 2020 2020 2063 6f6c 6f72 5465           colorTe
+00023850: 7874 2e42 4f4c 4420 2b20 636f 6c6f 7254  xt.BOLD + colorT
+00023860: 6578 742e 4752 4545 4e20 2b20 7374 7228  ext.GREEN + str(
+00023870: 7273 6929 202b 2063 6f6c 6f72 5465 7874  rsi) + colorText
+00023880: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+00023890: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
+000238a0: 6574 7572 6e20 5472 7565 2069 6620 2872  eturn True if (r
+000238b0: 7369 4b65 7920 3d3d 2022 5253 4969 2229  siKey == "RSIi")
+000238c0: 2065 6c73 6520 2873 656c 662e 7661 6c69   else (self.vali
+000238d0: 6461 7465 5253 4928 6466 2c20 7363 7265  dateRSI(df, scre
+000238e0: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
+000238f0: 2c20 6d69 6e52 5349 2c20 6d61 7852 5349  , minRSI, maxRSI
+00023900: 2c72 7369 4b65 793d 2252 5349 6922 2920  ,rsiKey="RSIi") 
+00023910: 6f72 2054 7275 6529 0a20 2020 2020 2020  or True).       
+00023920: 2073 6372 6565 6e44 6963 745b 7273 694b   screenDict[rsiK
+00023930: 6579 5d20 3d20 636f 6c6f 7254 6578 742e  ey] = colorText.
+00023940: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
+00023950: 2e46 4149 4c20 2b20 7374 7228 7273 6929  .FAIL + str(rsi)
+00023960: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+00023970: 0a20 2020 2020 2020 2023 2049 6620 6569  .        # If ei
+00023980: 7468 6572 2064 6169 6c79 206f 7220 696e  ther daily or in
+00023990: 7472 6164 6179 2052 5349 2063 6f6d 6573  traday RSI comes
+000239a0: 2077 6974 6869 6e20 7261 6e67 653f 0a20   within range?. 
+000239b0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000239c0: 6c73 6520 6966 2028 7273 694b 6579 203d  lse if (rsiKey =
+000239d0: 3d20 2252 5349 6922 2920 656c 7365 2028  = "RSIi") else (
+000239e0: 7365 6c66 2e76 616c 6964 6174 6552 5349  self.validateRSI
+000239f0: 2864 662c 2073 6372 6565 6e44 6963 742c  (df, screenDict,
+00023a00: 2073 6176 6544 6963 742c 206d 696e 5253   saveDict, minRS
+00023a10: 492c 206d 6178 5253 492c 7273 694b 6579  I, maxRSI,rsiKey
+00023a20: 3d22 5253 4969 2229 290a 0a20 2020 2023  ="RSIi"))..    #
+00023a30: 2056 616c 6964 6174 6520 6966 2074 6865   Validate if the
+00023a40: 2073 746f 636b 2069 7320 6275 6c6c 6973   stock is bullis
+00023a50: 6820 696e 2074 6865 2073 686f 7274 2074  h in the short t
+00023a60: 6572 6d0a 2020 2020 6465 6620 7661 6c69  erm.    def vali
+00023a70: 6461 7465 5368 6f72 7454 6572 6d42 756c  dateShortTermBul
+00023a80: 6c69 7368 2873 656c 662c 2064 662c 2073  lish(self, df, s
+00023a90: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
+00023aa0: 6963 7429 3a0a 2020 2020 2020 2020 6966  ict):.        if
+00023ab0: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
+00023ac0: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
+00023ad0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00023ae0: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
+00023af0: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
+00023b00: 2020 2020 2020 2023 2068 7474 7073 3a2f         # https:/
+00023b10: 2f63 6861 7274 696e 6b2e 636f 6d2f 7363  /chartink.com/sc
+00023b20: 7265 656e 6572 2f73 686f 7274 2d74 6572  reener/short-ter
+00023b30: 6d2d 6275 6c6c 6973 680a 2020 2020 2020  m-bullish.      
+00023b40: 2020 6461 7461 203d 2064 6174 612e 6669    data = data.fi
+00023b50: 6c6c 6e61 2830 290a 2020 2020 2020 2020  llna(0).        
+00023b60: 6461 7461 203d 2064 6174 612e 7265 706c  data = data.repl
+00023b70: 6163 6528 5b6e 702e 696e 662c 202d 6e70  ace([np.inf, -np
+00023b80: 2e69 6e66 5d2c 2030 290a 2020 2020 2020  .inf], 0).      
+00023b90: 2020 7265 6365 6e74 203d 2064 6174 612e    recent = data.
+00023ba0: 6865 6164 2831 290a 2020 2020 2020 2020  head(1).        
+00023bb0: 666b 203d 2030 2069 6620 6c65 6e28 6461  fk = 0 if len(da
+00023bc0: 7461 2920 3c20 3320 656c 7365 206e 702e  ta) < 3 else np.
+00023bd0: 726f 756e 6428 6461 7461 5b22 4641 5354  round(data["FAST
+00023be0: 4b22 5d2e 696c 6f63 5b32 5d2c 2035 290a  K"].iloc[2], 5).
+00023bf0: 2020 2020 2020 2020 2320 5265 7665 7273          # Revers
+00023c00: 6520 7468 6520 6461 7461 6672 616d 6520  e the dataframe 
+00023c10: 666f 7220 6963 6869 6d6f 6b75 2063 616c  for ichimoku cal
+00023c20: 6375 6c61 7469 6f6e 7320 7769 7468 2064  culations with d
+00023c30: 6174 6520 696e 2061 7363 656e 6469 6e67  ate in ascending
+00023c40: 206f 7264 6572 0a20 2020 2020 2020 2064   order.        d
+00023c50: 665f 6e65 7720 3d20 6461 7461 5b3a 3a2d  f_new = data[::-
+00023c60: 315d 0a20 2020 2020 2020 2074 7279 3a0a  1].        try:.
+00023c70: 2020 2020 2020 2020 2020 2020 6466 5f69              df_i
+00023c80: 6368 6920 3d20 6466 5f6e 6577 2e72 656e  chi = df_new.ren
+00023c90: 616d 6528 0a20 2020 2020 2020 2020 2020  ame(.           
+00023ca0: 2020 2020 2063 6f6c 756d 6e73 3d7b 0a20       columns={. 
+00023cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cc0: 2020 2022 4f70 656e 223a 2022 6f70 656e     "Open": "open
+00023cd0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00023ce0: 2020 2020 2020 2022 4869 6768 223a 2022         "High": "
+00023cf0: 6869 6768 222c 0a20 2020 2020 2020 2020  high",.         
+00023d00: 2020 2020 2020 2020 2020 2022 4c6f 7722             "Low"
+00023d10: 3a20 226c 6f77 222c 0a20 2020 2020 2020  : "low",.       
+00023d20: 2020 2020 2020 2020 2020 2020 2022 436c               "Cl
+00023d30: 6f73 6522 3a20 2263 6c6f 7365 222c 0a20  ose": "close",. 
+00023d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d50: 2020 2022 566f 6c75 6d65 223a 2022 766f     "Volume": "vo
+00023d60: 6c75 6d65 222c 0a20 2020 2020 2020 2020  lume",.         
+00023d70: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00023d80: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00023d90: 2020 2069 6368 6920 3d20 706b 7461 6c69     ichi = pktali
+00023da0: 622e 6963 6869 6d6f 6b75 2864 665f 6963  b.ichimoku(df_ic
+00023db0: 6869 2c20 392c 2032 362c 2035 322c 2032  hi, 9, 26, 52, 2
+00023dc0: 3629 0a20 2020 2020 2020 2020 2020 2069  6).            i
+00023dd0: 6620 6963 6869 2069 7320 4e6f 6e65 3a0a  f ichi is None:.
+00023de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023df0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
+00023e00: 2020 2020 2020 2020 2064 665f 6e65 7720           df_new 
+00023e10: 3d20 7064 2e63 6f6e 6361 7428 5b64 665f  = pd.concat([df_
+00023e20: 6e65 772c 2069 6368 695d 2c20 6178 6973  new, ichi], axis
+00023e30: 3d31 290a 2020 2020 2020 2020 2020 2020  =1).            
+00023e40: 2320 5265 7665 7273 6520 6167 6169 6e20  # Reverse again 
+00023e50: 746f 2067 6574 2074 6865 206d 6f73 7420  to get the most 
+00023e60: 7265 6365 6e74 2064 6174 6520 6f6e 2074  recent date on t
+00023e70: 6f70 0a20 2020 2020 2020 2020 2020 2064  op.            d
+00023e80: 665f 6e65 7720 3d20 6466 5f6e 6577 5b3a  f_new = df_new[:
+00023e90: 3a2d 315d 0a20 2020 2020 2020 2020 2020  :-1].           
+00023ea0: 2064 665f 6e65 7720 3d20 6466 5f6e 6577   df_new = df_new
+00023eb0: 2e68 6561 6428 3129 0a20 2020 2020 2020  .head(1).       
+00023ec0: 2020 2020 2064 665f 6e65 775b 2263 6c6f       df_new["clo
+00023ed0: 7564 5f67 7265 656e 225d 203d 2064 665f  ud_green"] = df_
+00023ee0: 6e65 775b 2249 5341 5f39 225d 2e69 6c6f  new["ISA_9"].ilo
+00023ef0: 635b 305d 203e 2064 665f 6e65 775b 2249  c[0] > df_new["I
+00023f00: 5342 5f32 3622 5d2e 696c 6f63 5b30 5d0a  SB_26"].iloc[0].
+00023f10: 2020 2020 2020 2020 2020 2020 6466 5f6e              df_n
+00023f20: 6577 5b22 636c 6f75 645f 7265 6422 5d20  ew["cloud_red"] 
+00023f30: 3d20 6466 5f6e 6577 5b22 4953 425f 3236  = df_new["ISB_26
+00023f40: 225d 2e69 6c6f 635b 305d 203e 2064 665f  "].iloc[0] > df_
+00023f50: 6e65 775b 2249 5341 5f39 225d 2e69 6c6f  new["ISA_9"].ilo
+00023f60: 635b 305d 0a20 2020 2020 2020 2065 7863  c[0].        exc
+00023f70: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00023f80: 2065 3a20 2023 2070 7261 676d 613a 206e   e:  # pragma: n
+00023f90: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
+00023fa0: 2020 2020 7365 6c66 2e64 6566 6175 6c74      self.default
+00023fb0: 5f6c 6f67 6765 722e 6465 6275 6728 652c  _logger.debug(e,
+00023fc0: 2065 7863 5f69 6e66 6f3d 5472 7565 290a   exc_info=True).
+00023fd0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00023fe0: 0a20 2020 2020 2020 2061 626f 7665 436c  .        aboveCl
+00023ff0: 6f75 6454 6f70 203d 2046 616c 7365 0a20  oudTop = False. 
+00024000: 2020 2020 2020 2023 2062 6173 656c 696e         # baselin
+00024010: 6520 3e20 636c 6f75 6420 746f 7020 2863  e > cloud top (c
+00024020: 6c6f 7564 2069 7320 626f 756e 6420 6279  loud is bound by
+00024030: 2073 7061 6e20 6120 616e 6420 7370 616e   span a and span
+00024040: 2062 2920 616e 6420 636c 6f73 6520 6973   b) and close is
+00024050: 203e 2063 6c6f 7564 2074 6f70 0a20 2020   > cloud top.   
+00024060: 2020 2020 2069 6620 6466 5f6e 6577 5b22       if df_new["
+00024070: 636c 6f75 645f 6772 6565 6e22 5d2e 696c  cloud_green"].il
+00024080: 6f63 5b30 5d3a 0a20 2020 2020 2020 2020  oc[0]:.         
+00024090: 2020 2061 626f 7665 436c 6f75 6454 6f70     aboveCloudTop
+000240a0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+000240b0: 2020 2020 2064 665f 6e65 775b 2249 4b53       df_new["IKS
+000240c0: 5f32 3622 5d2e 696c 6f63 5b30 5d20 3e20  _26"].iloc[0] > 
+000240d0: 6466 5f6e 6577 5b22 4953 415f 3922 5d2e  df_new["ISA_9"].
+000240e0: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
+000240f0: 2020 2020 2020 2020 616e 6420 7265 6365          and rece
+00024100: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
+00024110: 5b30 5d20 3e20 6466 5f6e 6577 5b22 4953  [0] > df_new["IS
+00024120: 415f 3922 5d2e 696c 6f63 5b30 5d0a 2020  A_9"].iloc[0].  
+00024130: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00024140: 2020 2020 656c 6966 2064 665f 6e65 775b      elif df_new[
+00024150: 2263 6c6f 7564 5f72 6564 225d 2e69 6c6f  "cloud_red"].ilo
+00024160: 635b 305d 3a0a 2020 2020 2020 2020 2020  c[0]:.          
+00024170: 2020 6162 6f76 6543 6c6f 7564 546f 7020    aboveCloudTop 
+00024180: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00024190: 2020 2020 6466 5f6e 6577 5b22 494b 535f      df_new["IKS_
+000241a0: 3236 225d 2e69 6c6f 635b 305d 203e 2064  26"].iloc[0] > d
+000241b0: 665f 6e65 775b 2249 5342 5f32 3622 5d2e  f_new["ISB_26"].
+000241c0: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
+000241d0: 2020 2020 2020 2020 616e 6420 7265 6365          and rece
+000241e0: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
+000241f0: 5b30 5d20 3e20 6466 5f6e 6577 5b22 4953  [0] > df_new["IS
+00024200: 425f 3236 225d 2e69 6c6f 635b 305d 0a20  B_26"].iloc[0]. 
+00024210: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00024220: 2020 2020 2020 2320 4c61 7465 7374 2049        # Latest I
+00024230: 6368 696d 6f6b 7520 6261 7365 6c69 6e65  chimoku baseline
+00024240: 2069 7320 3c20 6c61 7465 7374 2049 6368   is < latest Ich
+00024250: 696d 6f6b 7520 636f 6e76 6572 7369 6f6e  imoku conversion
+00024260: 206c 696e 650a 2020 2020 2020 2020 6966   line.        if
+00024270: 2061 626f 7665 436c 6f75 6454 6f70 2061   aboveCloudTop a
+00024280: 6e64 2064 665f 6e65 775b 2249 4b53 5f32  nd df_new["IKS_2
+00024290: 3622 5d2e 696c 6f63 5b30 5d20 3c20 6466  6"].iloc[0] < df
+000242a0: 5f6e 6577 5b22 4954 535f 3922 5d2e 696c  _new["ITS_9"].il
+000242b0: 6f63 5b30 5d3a 0a20 2020 2020 2020 2020  oc[0]:.         
+000242c0: 2020 2023 2053 746f 6368 5253 4920 6372     # StochRSI cr
+000242d0: 6f73 7365 6420 3230 2061 6e64 2052 5349  ossed 20 and RSI
+000242e0: 203e 2035 300a 2020 2020 2020 2020 2020   > 50.          
+000242f0: 2020 6966 2066 6b20 3e20 3230 2061 6e64    if fk > 20 and
+00024300: 2072 6563 656e 745b 2252 5349 225d 2e69   recent["RSI"].i
+00024310: 6c6f 635b 305d 203e 2035 303a 0a20 2020  loc[0] > 50:.   
+00024320: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+00024330: 6f6e 6469 7469 6f6e 206f 6620 6372 6f73  ondition of cros
+00024340: 7369 6e67 2074 6865 2053 746f 6368 5253  sing the StochRS
+00024350: 4920 6d61 696e 2073 6967 6e61 6c20 6c69  I main signal li
+00024360: 6e65 2066 726f 6d20 626f 7474 6f6d 2074  ne from bottom t
+00024370: 6f20 746f 700a 2020 2020 2020 2020 2020  o top.          
+00024380: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+00024390: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000243a0: 6174 615b 2246 4153 5444 225d 2e69 6c6f  ata["FASTD"].ilo
+000243b0: 635b 3130 305d 203c 2064 6174 615b 2246  c[100] < data["F
+000243c0: 4153 544b 225d 2e69 6c6f 635b 3130 305d  ASTK"].iloc[100]
+000243d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000243e0: 2020 2020 2061 6e64 2064 6174 615b 2246       and data["F
+000243f0: 4153 5444 225d 2e69 6c6f 635b 3130 315d  ASTD"].iloc[101]
+00024400: 203e 2064 6174 615b 2246 4153 544b 225d   > data["FASTK"]
+00024410: 2e69 6c6f 635b 3130 315d 0a20 2020 2020  .iloc[101].     
+00024420: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
+00024430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024440: 2020 2320 636c 6f73 6520 3e20 3530 2070    # close > 50 p
+00024450: 6572 696f 6420 534d 412f 454d 4120 616e  eriod SMA/EMA an
+00024460: 6420 3230 3020 7065 7269 6f64 2053 4d41  d 200 period SMA
+00024470: 2f45 4d41 0a20 2020 2020 2020 2020 2020  /EMA.           
+00024480: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
+00024490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000244a0: 2020 2020 2020 7265 6365 6e74 5b22 5353        recent["SS
+000244b0: 4d41 225d 2e69 6c6f 635b 305d 203e 2072  MA"].iloc[0] > r
+000244c0: 6563 656e 745b 2253 4d41 225d 2e69 6c6f  ecent["SMA"].ilo
+000244d0: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
+000244e0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+000244f0: 2072 6563 656e 745b 2243 6c6f 7365 225d   recent["Close"]
+00024500: 2e69 6c6f 635b 305d 203e 2072 6563 656e  .iloc[0] > recen
+00024510: 745b 2253 534d 4122 5d2e 696c 6f63 5b30  t["SSMA"].iloc[0
+00024520: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00024530: 2020 2020 2020 2020 2020 616e 6420 7265            and re
+00024540: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
+00024550: 6f63 5b30 5d20 3e20 7265 6365 6e74 5b22  oc[0] > recent["
+00024560: 4c4d 4122 5d2e 696c 6f63 5b30 5d0a 2020  LMA"].iloc[0].  
+00024570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024580: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00024590: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+000245a0: 6564 203d 2073 656c 662e 6669 6e64 4375  ed = self.findCu
+000245b0: 7272 656e 7453 6176 6564 5661 6c75 6528  rrentSavedValue(
+000245c0: 7363 7265 656e 4469 6374 2c73 6176 6544  screenDict,saveD
+000245d0: 6963 742c 224d 412d 5369 676e 616c 2229  ict,"MA-Signal")
+000245e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000245f0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+00024600: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
+00024610: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00024620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024630: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
+00024640: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+00024650: 6f72 5465 7874 2e47 5245 454e 202b 2022  orText.GREEN + "
+00024660: 4275 6c6c 6973 6822 202b 2063 6f6c 6f72  Bullish" + color
+00024670: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+00024680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024690: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+000246a0: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+000246b0: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
+000246c0: 203d 2073 6176 6564 5b31 5d20 2b20 2242   = saved[1] + "B
+000246d0: 756c 6c69 7368 220a 2020 2020 2020 2020  ullish".        
+000246e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000246f0: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+00024700: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00024710: 0a20 2020 200a 2020 2020 2320 5661 6c69  .    .    # Vali
+00024720: 6461 7465 2056 4350 2061 7320 7065 7220  date VCP as per 
+00024730: 4d61 726b 204d 696e 6572 7669 6e69 0a20  Mark Minervini. 
+00024740: 2020 2023 2068 7474 7073 3a2f 2f63 6861     # https://cha
+00024750: 7274 696e 6b2e 636f 6d2f 7363 7265 656e  rtink.com/screen
+00024760: 6572 2f76 6f6c 6174 696c 6974 792d 636f  er/volatility-co
+00024770: 6d70 7265 7373 696f 6e0a 2020 2020 6465  mpression.    de
+00024780: 6620 7661 6c69 6461 7465 5643 504d 6172  f validateVCPMar
+00024790: 6b4d 696e 6572 7669 6e69 2873 656c 662c  kMinervini(self,
+000247a0: 2064 663a 7064 2e44 6174 6146 7261 6d65   df:pd.DataFrame
+000247b0: 2c20 7363 7265 656e 4469 6374 2c20 7361  , screenDict, sa
+000247c0: 7665 4469 6374 293a 0a20 2020 2020 2020  veDict):.       
+000247d0: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
+000247e0: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
+000247f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00024800: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00024810: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+00024820: 290a 2020 2020 2020 2020 6f68 6c63 5f64  ).        ohlc_d
+00024830: 6963 7420 3d20 7b0a 2020 2020 2020 2020  ict = {.        
+00024840: 2020 2020 274f 7065 6e27 3a27 6669 7273      'Open':'firs
+00024850: 7427 2c0a 2020 2020 2020 2020 2020 2020  t',.            
+00024860: 2748 6967 6827 3a27 6d61 7827 2c0a 2020  'High':'max',.  
+00024870: 2020 2020 2020 2020 2020 274c 6f77 273a            'Low':
+00024880: 276d 696e 272c 0a20 2020 2020 2020 2020  'min',.         
+00024890: 2020 2027 436c 6f73 6527 3a27 6c61 7374     'Close':'last
+000248a0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
+000248b0: 566f 6c75 6d65 273a 2773 756d 270a 2020  Volume':'sum'.  
+000248c0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+000248d0: 2320 6669 6e61 6c5f 6466 203d 2064 662e  # final_df = df.
+000248e0: 7265 7361 6d70 6c65 2827 572d 4652 4927  resample('W-FRI'
+000248f0: 2c20 636c 6f73 6564 3d27 6c65 6674 2729  , closed='left')
+00024900: 2e61 6767 286f 686c 635f 6469 6374 292e  .agg(ohlc_dict).
+00024910: 7368 6966 7428 2731 6427 290a 2020 2020  shift('1d').    
+00024920: 2020 2020 7765 656b 6c79 4461 7461 203d      weeklyData =
+00024930: 2064 6174 612e 7265 7361 6d70 6c65 2827   data.resample('
+00024940: 5727 292e 6167 6728 6f68 6c63 5f64 6963  W').agg(ohlc_dic
+00024950: 7429 0a20 2020 2020 2020 2072 6576 6572  t).        rever
+00024960: 7365 6444 6174 6120 3d20 6461 7461 5b3a  sedData = data[:
+00024970: 3a2d 315d 2020 2320 5265 7665 7273 6520  :-1]  # Reverse 
+00024980: 7468 6520 6461 7461 6672 616d 650a 2020  the dataframe.  
+00024990: 2020 2020 2020 7265 6365 6e74 5f63 6c6f        recent_clo
+000249a0: 7365 203d 2064 6174 615b 2243 6c6f 7365  se = data["Close
+000249b0: 225d 2e68 6561 6428 3129 2e69 6c6f 635b  "].head(1).iloc[
+000249c0: 305d 0a20 2020 2020 2020 2077 5f65 6d61  0].        w_ema
+000249d0: 5f31 3320 3d20 706b 7461 6c69 622e 454d  _13 = pktalib.EM
+000249e0: 4128 7765 656b 6c79 4461 7461 5b22 436c  A(weeklyData["Cl
 000249f0: 6f73 6522 5d2c 7469 6d65 7065 7269 6f64  ose"],timeperiod
-00024a00: 3d34 3029 2e74 6169 6c28 3129 2e69 6c6f  =40).tail(1).ilo
-00024a10: 635b 305d 0a20 2020 2020 2020 2077 5f6d  c[0].        w_m
-00024a20: 696e 5f35 3020 3d20 6d69 6e28 312e 332a  in_50 = min(1.3*
-00024a30: 7765 656b 6c79 4461 7461 2e74 6169 6c28  weeklyData.tail(
-00024a40: 3530 295b 224c 6f77 225d 290a 2020 2020  50)["Low"]).    
-00024a50: 2020 2020 775f 6d61 785f 3530 203d 206d      w_max_50 = m
-00024a60: 6178 2830 2e37 352a 7765 656b 6c79 4461  ax(0.75*weeklyDa
-00024a70: 7461 2e74 6169 6c28 3530 295b 2248 6967  ta.tail(50)["Hig
-00024a80: 6822 5d29 0a20 2020 2020 2020 2077 5f65  h"]).        w_e
-00024a90: 6d61 5f32 365f 3230 775f 6167 6f20 3d20  ma_26_20w_ago = 
-00024aa0: 706b 7461 6c69 622e 454d 4128 7765 656b  pktalib.EMA(week
-00024ab0: 6c79 4461 7461 2e68 6561 6428 6c65 6e28  lyData.head(len(
-00024ac0: 7765 656b 6c79 4461 7461 292d 3230 295b  weeklyData)-20)[
-00024ad0: 2243 6c6f 7365 225d 2c74 696d 6570 6572  "Close"],timeper
-00024ae0: 696f 643d 3236 292e 7461 696c 2831 292e  iod=26).tail(1).
-00024af0: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
-00024b00: 7265 6365 6e74 5f65 6d61 5f31 335f 3230  recent_ema_13_20
-00024b10: 645f 6167 6f20 3d20 706b 7461 6c69 622e  d_ago = pktalib.
-00024b20: 454d 4128 7265 7665 7273 6564 4461 7461  EMA(reversedData
-00024b30: 2e68 6561 6428 6c65 6e28 7265 7665 7273  .head(len(revers
-00024b40: 6564 4461 7461 292d 3230 295b 2243 6c6f  edData)-20)["Clo
-00024b50: 7365 225d 2c74 696d 6570 6572 696f 643d  se"],timeperiod=
-00024b60: 3133 292e 7461 696c 2831 292e 696c 6f63  13).tail(1).iloc
-00024b70: 5b30 5d0a 2020 2020 2020 2020 775f 736d  [0].        w_sm
-00024b80: 615f 3430 5f35 775f 6167 6f20 3d20 706b  a_40_5w_ago = pk
-00024b90: 7461 6c69 622e 534d 4128 7765 656b 6c79  talib.SMA(weekly
-00024ba0: 4461 7461 2e68 6561 6428 6c65 6e28 7765  Data.head(len(we
-00024bb0: 656b 6c79 4461 7461 292d 3529 5b22 436c  eklyData)-5)["Cl
-00024bc0: 6f73 6522 5d2c 7469 6d65 7065 7269 6f64  ose"],timeperiod
-00024bd0: 3d34 3029 2e74 6169 6c28 3129 2e69 6c6f  =40).tail(1).ilo
-00024be0: 635b 305d 0a20 2020 2020 2020 2077 5f73  c[0].        w_s
-00024bf0: 6d61 5f34 305f 3130 775f 6167 6f20 3d20  ma_40_10w_ago = 
-00024c00: 706b 7461 6c69 622e 534d 4128 7765 656b  pktalib.SMA(week
-00024c10: 6c79 4461 7461 2e68 6561 6428 6c65 6e28  lyData.head(len(
-00024c20: 7765 656b 6c79 4461 7461 292d 3130 295b  weeklyData)-10)[
-00024c30: 2243 6c6f 7365 225d 2c74 696d 6570 6572  "Close"],timeper
-00024c40: 696f 643d 3430 292e 7461 696c 2831 292e  iod=40).tail(1).
-00024c50: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
-00024c60: 7265 6365 6e74 5f73 6d61 5f35 3020 3d20  recent_sma_50 = 
-00024c70: 706b 7461 6c69 622e 534d 4128 7265 7665  pktalib.SMA(reve
-00024c80: 7273 6564 4461 7461 5b22 436c 6f73 6522  rsedData["Close"
-00024c90: 5d2c 7469 6d65 7065 7269 6f64 3d35 3029  ],timeperiod=50)
-00024ca0: 2e74 6169 6c28 3129 2e69 6c6f 635b 305d  .tail(1).iloc[0]
-00024cb0: 0a20 2020 2020 2020 2077 5f77 6d61 5f38  .        w_wma_8
-00024cc0: 203d 2070 6b74 616c 6962 2e57 4d41 2877   = pktalib.WMA(w
-00024cd0: 6565 6b6c 7944 6174 615b 2243 6c6f 7365  eeklyData["Close
-00024ce0: 225d 2c74 696d 6570 6572 696f 643d 3829  "],timeperiod=8)
-00024cf0: 2e74 6169 6c28 3129 2e69 6c6f 635b 305d  .tail(1).iloc[0]
-00024d00: 0a20 2020 2020 2020 2077 5f73 6d61 5f38  .        w_sma_8
-00024d10: 203d 2070 6b74 616c 6962 2e53 4d41 2877   = pktalib.SMA(w
-00024d20: 6565 6b6c 7944 6174 615b 2243 6c6f 7365  eeklyData["Close
-00024d30: 225d 2c74 696d 6570 6572 696f 643d 3829  "],timeperiod=8)
-00024d40: 2e74 6169 6c28 3129 2e69 6c6f 635b 305d  .tail(1).iloc[0]
-00024d50: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00024d60: 2020 6973 5643 5020 3d20 775f 656d 615f    isVCP = w_ema_
-00024d70: 3133 203e 2077 5f65 6d61 5f32 3620 616e  13 > w_ema_26 an
-00024d80: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
-00024d90: 2020 2020 775f 656d 615f 3236 203e 2077      w_ema_26 > w
-00024da0: 5f73 6d61 5f35 3020 616e 6420 5c0a 2020  _sma_50 and \.  
-00024db0: 2020 2020 2020 2020 2020 2020 2020 775f                w_
-00024dc0: 736d 615f 3430 203e 2077 5f73 6d61 5f34  sma_40 > w_sma_4
-00024dd0: 305f 3577 5f61 676f 2061 6e64 205c 0a20  0_5w_ago and \. 
-00024de0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00024df0: 6563 656e 745f 636c 6f73 6520 3e3d 2077  ecent_close >= w
-00024e00: 5f6d 696e 5f35 3020 616e 6420 5c0a 2020  _min_50 and \.  
-00024e10: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00024e20: 6365 6e74 5f63 6c6f 7365 203e 3d20 775f  cent_close >= w_
-00024e30: 6d61 785f 3530 2061 6e64 205c 0a20 2020  max_50 and \.   
-00024e40: 2020 2020 2020 2020 2020 2020 2072 6563               rec
-00024e50: 656e 745f 656d 615f 3133 5f32 3064 5f61  ent_ema_13_20d_a
-00024e60: 676f 203e 2077 5f65 6d61 5f32 365f 3230  go > w_ema_26_20
-00024e70: 775f 6167 6f20 616e 6420 5c0a 2020 2020  w_ago and \.    
-00024e80: 2020 2020 2020 2020 2020 2020 775f 736d              w_sm
-00024e90: 615f 3430 5f35 775f 6167 6f20 3e20 775f  a_40_5w_ago > w_
-00024ea0: 736d 615f 3430 5f31 3077 5f61 676f 2061  sma_40_10w_ago a
-00024eb0: 6e64 205c 0a20 2020 2020 2020 2020 2020  nd \.           
-00024ec0: 2020 2020 2072 6563 656e 745f 636c 6f73       recent_clos
-00024ed0: 6520 3e20 7265 6365 6e74 5f73 6d61 5f35  e > recent_sma_5
-00024ee0: 3020 616e 6420 5c0a 2020 2020 2020 2020  0 and \.        
-00024ef0: 2020 2020 2020 2020 2877 5f77 6d61 5f38          (w_wma_8
-00024f00: 202d 2077 5f73 6d61 5f38 292a 362f 3239   - w_sma_8)*6/29
-00024f10: 203c 2030 2e35 2061 6e64 205c 0a20 2020   < 0.5 and \.   
-00024f20: 2020 2020 2020 2020 2020 2020 2072 6563               rec
-00024f30: 656e 745f 636c 6f73 6520 3e20 3130 0a20  ent_close > 10. 
-00024f40: 2020 2020 2020 2069 6620 6973 5643 503a         if isVCP:
-00024f50: 0a20 2020 2020 2020 2020 2020 2073 6176  .            sav
-00024f60: 6564 203d 2073 656c 662e 6669 6e64 4375  ed = self.findCu
-00024f70: 7272 656e 7453 6176 6564 5661 6c75 6528  rrentSavedValue(
-00024f80: 7363 7265 656e 4469 6374 2c20 7361 7665  screenDict, save
-00024f90: 4469 6374 2c20 2250 6174 7465 726e 2229  Dict, "Pattern")
-00024fa0: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
-00024fb0: 6565 6e44 6963 745b 2250 6174 7465 726e  eenDict["Pattern
-00024fc0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-00024fd0: 2020 2020 2020 2073 6176 6564 5b30 5d20         saved[0] 
-00024fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024ff0: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
-00025000: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-00025010: 2020 2b20 636f 6c6f 7254 6578 742e 4752    + colorText.GR
-00025020: 4545 4e0a 2020 2020 2020 2020 2020 2020  EEN.            
-00025030: 2020 2020 2b20 6622 5643 5028 4d69 6e65      + f"VCP(Mine
-00025040: 7276 696e 6929 220a 2020 2020 2020 2020  rvini)".        
-00025050: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-00025060: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-00025070: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00025080: 2020 7361 7665 4469 6374 5b22 5061 7474    saveDict["Patt
-00025090: 6572 6e22 5d20 3d20 7361 7665 645b 315d  ern"] = saved[1]
-000250a0: 202b 2066 2256 4350 284d 696e 6572 7669   + f"VCP(Minervi
-000250b0: 6e69 2922 0a20 2020 2020 2020 2072 6574  ni)".        ret
-000250c0: 7572 6e20 6973 5643 500a 2020 2020 0a20  urn isVCP.    . 
-000250d0: 2020 2023 2056 616c 6964 6174 6520 5643     # Validate VC
-000250e0: 500a 2020 2020 6465 6620 7661 6c69 6461  P.    def valida
-000250f0: 7465 5643 5028 0a20 2020 2020 2020 2073  teVCP(.        s
-00025100: 656c 662c 2064 662c 2073 6372 6565 6e44  elf, df, screenD
-00025110: 6963 742c 2073 6176 6544 6963 742c 2073  ict, saveDict, s
-00025120: 746f 636b 4e61 6d65 3d4e 6f6e 652c 2077  tockName=None, w
-00025130: 696e 646f 773d 332c 2070 6572 6365 6e74  indow=3, percent
-00025140: 6167 6546 726f 6d54 6f70 3d33 0a20 2020  ageFromTop=3.   
-00025150: 2029 3a0a 2020 2020 2020 2020 6966 2064   ):.        if d
-00025160: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-00025170: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-00025180: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00025190: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-000251a0: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-000251b0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-000251c0: 2020 2020 2020 7065 7263 656e 7461 6765        percentage
-000251d0: 4672 6f6d 546f 7020 2f3d 2031 3030 0a20  FromTop /= 100. 
-000251e0: 2020 2020 2020 2020 2020 2064 6174 612e             data.
-000251f0: 7265 7365 745f 696e 6465 7828 696e 706c  reset_index(inpl
-00025200: 6163 653d 5472 7565 290a 2020 2020 2020  ace=True).      
-00025210: 2020 2020 2020 6461 7461 2e72 656e 616d        data.renam
-00025220: 6528 636f 6c75 6d6e 733d 7b22 696e 6465  e(columns={"inde
-00025230: 7822 3a20 2244 6174 6522 7d2c 2069 6e70  x": "Date"}, inp
-00025240: 6c61 6365 3d54 7275 6529 0a20 2020 2020  lace=True).     
-00025250: 2020 2020 2020 2064 6174 615b 2274 6f70         data["top
-00025260: 7322 5d20 3d20 2864 6174 615b 2248 6967  s"] = (data["Hig
-00025270: 6822 5d2e 696c 6f63 5b6c 6973 7428 706b  h"].iloc[list(pk
-00025280: 7461 6c69 622e 6172 6772 656c 6578 7472  talib.argrelextr
-00025290: 656d 6128 6e70 2e61 7272 6179 2864 6174  ema(np.array(dat
-000252a0: 615b 2248 6967 6822 5d29 2c20 6e70 2e67  a["High"]), np.g
-000252b0: 7265 6174 6572 5f65 7175 616c 2c20 6f72  reater_equal, or
-000252c0: 6465 723d 7769 6e64 6f77 295b 305d 295d  der=window)[0])]
-000252d0: 2e68 6561 6428 3429 290a 2020 2020 2020  .head(4)).      
-000252e0: 2020 2020 2020 6461 7461 5b22 626f 7473        data["bots
-000252f0: 225d 203d 2028 6461 7461 5b22 4c6f 7722  "] = (data["Low"
-00025300: 5d2e 696c 6f63 5b6c 6973 7428 706b 7461  ].iloc[list(pkta
-00025310: 6c69 622e 6172 6772 656c 6578 7472 656d  lib.argrelextrem
-00025320: 6128 6e70 2e61 7272 6179 2864 6174 615b  a(np.array(data[
-00025330: 224c 6f77 225d 292c 206e 702e 6c65 7373  "Low"]), np.less
-00025340: 5f65 7175 616c 2c20 6f72 6465 723d 7769  _equal, order=wi
-00025350: 6e64 6f77 295b 305d 295d 2e68 6561 6428  ndow)[0])].head(
-00025360: 3429 290a 2020 2020 2020 2020 2020 2020  4)).            
-00025370: 6461 7461 203d 2064 6174 612e 6669 6c6c  data = data.fill
-00025380: 6e61 2830 290a 2020 2020 2020 2020 2020  na(0).          
-00025390: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
-000253a0: 706c 6163 6528 5b6e 702e 696e 662c 202d  place([np.inf, -
-000253b0: 6e70 2e69 6e66 5d2c 2030 290a 2020 2020  np.inf], 0).    
-000253c0: 2020 2020 2020 2020 746f 7073 203d 2064          tops = d
-000253d0: 6174 615b 6461 7461 2e74 6f70 7320 3e20  ata[data.tops > 
-000253e0: 305d 0a20 2020 2020 2020 2020 2020 2023  0].            #
-000253f0: 2062 6f74 7320 3d20 6461 7461 5b64 6174   bots = data[dat
-00025400: 612e 626f 7473 203e 2030 5d0a 2020 2020  a.bots > 0].    
-00025410: 2020 2020 2020 2020 6869 6768 6573 7454          highestT
-00025420: 6f70 203d 2072 6f75 6e64 2874 6f70 732e  op = round(tops.
-00025430: 6465 7363 7269 6265 2829 5b22 4869 6768  describe()["High
-00025440: 225d 5b22 6d61 7822 5d2c 2031 290a 2020  "]["max"], 1).  
-00025450: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
-00025460: 6564 546f 7073 203d 2074 6f70 735b 0a20  edTops = tops[. 
-00025470: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00025480: 6f70 732e 746f 7073 203e 2028 6869 6768  ops.tops > (high
-00025490: 6573 7454 6f70 202d 2028 6869 6768 6573  estTop - (highes
-000254a0: 7454 6f70 202a 2070 6572 6365 6e74 6167  tTop * percentag
-000254b0: 6546 726f 6d54 6f70 2929 0a20 2020 2020  eFromTop)).     
-000254c0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-000254d0: 2020 2020 2069 6620 6669 6c74 6572 6564       if filtered
-000254e0: 546f 7073 2e65 7175 616c 7328 746f 7073  Tops.equals(tops
-000254f0: 293a 2020 2320 546f 7073 2061 7265 2069  ):  # Tops are i
-00025500: 6e20 7468 6520 7261 6e67 650a 2020 2020  n the range.    
-00025510: 2020 2020 2020 2020 2020 2020 6c6f 7750              lowP
-00025520: 6f69 6e74 7320 3d20 5b5d 0a20 2020 2020  oints = [].     
-00025530: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00025540: 2069 6e20 7261 6e67 6528 6c65 6e28 746f   in range(len(to
-00025550: 7073 2920 2d20 3129 3a0a 2020 2020 2020  ps) - 1):.      
-00025560: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00025570: 6444 6174 6520 3d20 746f 7073 2e69 6c6f  dDate = tops.ilo
-00025580: 635b 695d 5b22 4461 7465 225d 0a20 2020  c[i]["Date"].   
-00025590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000255a0: 2073 7461 7274 4461 7465 203d 2074 6f70   startDate = top
-000255b0: 732e 696c 6f63 5b69 202b 2031 5d5b 2244  s.iloc[i + 1]["D
-000255c0: 6174 6522 5d0a 2020 2020 2020 2020 2020  ate"].          
-000255d0: 2020 2020 2020 2020 2020 6c6f 7750 6f69            lowPoi
-000255e0: 6e74 732e 6170 7065 6e64 280a 2020 2020  nts.append(.    
-000255f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025600: 2020 2020 6461 7461 5b0a 2020 2020 2020      data[.      
-00025610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025620: 2020 2020 2020 2864 6174 612e 4461 7465        (data.Date
-00025630: 203e 3d20 7374 6172 7444 6174 6529 2026   >= startDate) &
-00025640: 2028 6461 7461 2e44 6174 6520 3c3d 2065   (data.Date <= e
-00025650: 6e64 4461 7465 290a 2020 2020 2020 2020  ndDate).        
-00025660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025670: 5d2e 6465 7363 7269 6265 2829 5b22 4c6f  ].describe()["Lo
-00025680: 7722 5d5b 226d 696e 225d 0a20 2020 2020  w"]["min"].     
-00025690: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000256a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000256b0: 206c 6f77 506f 696e 7473 4f72 6720 3d20   lowPointsOrg = 
-000256c0: 6c6f 7750 6f69 6e74 730a 2020 2020 2020  lowPoints.      
-000256d0: 2020 2020 2020 2020 2020 6c6f 7750 6f69            lowPoi
-000256e0: 6e74 732e 736f 7274 2872 6576 6572 7365  nts.sort(reverse
-000256f0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00025700: 2020 2020 2020 206c 6f77 506f 696e 7473         lowPoints
-00025710: 536f 7274 6564 203d 206c 6f77 506f 696e  Sorted = lowPoin
-00025720: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
-00025730: 2020 2069 6620 6461 7461 2e65 6d70 7479     if data.empty
-00025740: 206f 7220 6c65 6e28 6c6f 7750 6f69 6e74   or len(lowPoint
-00025750: 7329 203c 2031 3a0a 2020 2020 2020 2020  s) < 1:.        
-00025760: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00025770: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-00025780: 2020 2020 2020 2020 206c 7470 203d 2064           ltp = d
-00025790: 6174 612e 6865 6164 2831 295b 2243 6c6f  ata.head(1)["Clo
-000257a0: 7365 225d 2e69 6c6f 635b 305d 0a20 2020  se"].iloc[0].   
-000257b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000257c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000257d0: 2020 2020 2020 6c6f 7750 6f69 6e74 734f        lowPointsO
-000257e0: 7267 203d 3d20 6c6f 7750 6f69 6e74 7353  rg == lowPointsS
-000257f0: 6f72 7465 640a 2020 2020 2020 2020 2020  orted.          
-00025800: 2020 2020 2020 2020 2020 616e 6420 6c74            and lt
-00025810: 7020 3c20 6869 6768 6573 7454 6f70 0a20  p < highestTop. 
-00025820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025830: 2020 2061 6e64 206c 7470 203e 206c 6f77     and ltp > low
-00025840: 506f 696e 7473 5b30 5d0a 2020 2020 2020  Points[0].      
-00025850: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-00025860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025870: 2073 6176 6564 203d 2073 656c 662e 6669   saved = self.fi
-00025880: 6e64 4375 7272 656e 7453 6176 6564 5661  ndCurrentSavedVa
-00025890: 6c75 6528 7363 7265 656e 4469 6374 2c20  lue(screenDict, 
-000258a0: 7361 7665 4469 6374 2c20 2250 6174 7465  saveDict, "Patte
-000258b0: 726e 2229 0a20 2020 2020 2020 2020 2020  rn").           
-000258c0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-000258d0: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
-000258e0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-000258f0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-00025900: 5b30 5d20 0a20 2020 2020 2020 2020 2020  [0] .           
-00025910: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-00025920: 6f6c 6f72 5465 7874 2e42 4f4c 440a 2020  olorText.BOLD.  
-00025930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025940: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-00025950: 742e 4752 4545 4e0a 2020 2020 2020 2020  t.GREEN.        
-00025960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025970: 2b20 6622 5643 5020 2842 4f3a 207b 6869  + f"VCP (BO: {hi
-00025980: 6768 6573 7454 6f70 7d29 220a 2020 2020  ghestTop})".    
-00025990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000259a0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-000259b0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-000259c0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000259d0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-000259e0: 7665 4469 6374 5b22 5061 7474 6572 6e22  veDict["Pattern"
-000259f0: 5d20 3d20 7361 7665 645b 315d 202b 2066  ] = saved[1] + f
-00025a00: 2256 4350 2028 424f 3a20 7b68 6967 6865  "VCP (BO: {highe
-00025a10: 7374 546f 707d 2922 0a20 2020 2020 2020  stTop})".       
-00025a20: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00025a30: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
-00025a40: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00025a50: 6e20 6173 2065 3a20 2023 2070 7261 676d  n as e:  # pragm
-00025a60: 613a 206e 6f20 636f 7665 720a 2020 2020  a: no cover.    
-00025a70: 2020 2020 2020 2020 7365 6c66 2e64 6566          self.def
-00025a80: 6175 6c74 5f6c 6f67 6765 722e 6465 6275  ault_logger.debu
-00025a90: 6728 652c 2065 7863 5f69 6e66 6f3d 5472  g(e, exc_info=Tr
-00025aa0: 7565 290a 2020 2020 2020 2020 7265 7475  ue).        retu
-00025ab0: 726e 2046 616c 7365 0a0a 2020 2020 2320  rn False..    # 
-00025ac0: 5661 6c69 6461 7465 2069 6620 766f 6c75  Validate if volu
-00025ad0: 6d65 206f 6620 6c61 7374 2064 6179 2069  me of last day i
-00025ae0: 7320 6869 6768 6572 2074 6861 6e20 6176  s higher than av
-00025af0: 670a 2020 2020 6465 6620 7661 6c69 6461  g.    def valida
-00025b00: 7465 566f 6c75 6d65 280a 2020 2020 2020  teVolume(.      
-00025b10: 2020 7365 6c66 2c20 6466 2c20 7363 7265    self, df, scre
-00025b20: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
-00025b30: 2c20 766f 6c75 6d65 5261 7469 6f3d 322e  , volumeRatio=2.
-00025b40: 352c 206d 696e 566f 6c75 6d65 3d31 3030  5, minVolume=100
-00025b50: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00025b60: 6966 2064 6620 6973 204e 6f6e 6520 6f72  if df is None or
-00025b70: 206c 656e 2864 6629 203d 3d20 303a 0a20   len(df) == 0:. 
-00025b80: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00025b90: 6e20 4661 6c73 652c 2046 616c 7365 0a20  n False, False. 
-00025ba0: 2020 2020 2020 2064 6174 6120 3d20 6466         data = df
-00025bb0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-00025bc0: 6461 7461 203d 2064 6174 612e 6669 6c6c  data = data.fill
-00025bd0: 6e61 2830 290a 2020 2020 2020 2020 6461  na(0).        da
-00025be0: 7461 203d 2064 6174 612e 7265 706c 6163  ta = data.replac
-00025bf0: 6528 5b6e 702e 696e 662c 202d 6e70 2e69  e([np.inf, -np.i
-00025c00: 6e66 5d2c 2030 290a 2020 2020 2020 2020  nf], 0).        
-00025c10: 7265 6365 6e74 203d 2064 6174 612e 6865  recent = data.he
-00025c20: 6164 2831 290a 2020 2020 2020 2020 2320  ad(1).        # 
-00025c30: 4569 7468 6572 2074 6865 2072 6f6c 6c69  Either the rolli
-00025c40: 6e67 2076 6f6c 756d 6520 6f66 2070 6173  ng volume of pas
-00025c50: 7420 3230 2073 6573 7369 6f6e 7320 6f72  t 20 sessions or
-00025c60: 2074 6f64 6179 2773 2076 6f6c 756d 6520   today's volume 
-00025c70: 7368 6f75 6c64 2062 6520 3e20 6d69 6e20  should be > min 
-00025c80: 766f 6c75 6d65 0a20 2020 2020 2020 2068  volume.        h
-00025c90: 6173 4d69 6e69 6d75 6d56 6f6c 756d 6520  asMinimumVolume 
-00025ca0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00025cb0: 7265 6365 6e74 5b22 566f 6c4d 4122 5d2e  recent["VolMA"].
-00025cc0: 696c 6f63 5b30 5d20 3e3d 206d 696e 566f  iloc[0] >= minVo
-00025cd0: 6c75 6d65 0a20 2020 2020 2020 2020 2020  lume.           
-00025ce0: 206f 7220 7265 6365 6e74 5b22 566f 6c75   or recent["Volu
-00025cf0: 6d65 225d 2e69 6c6f 635b 305d 203e 3d20  me"].iloc[0] >= 
-00025d00: 6d69 6e56 6f6c 756d 650a 2020 2020 2020  minVolume.      
-00025d10: 2020 290a 2020 2020 2020 2020 6966 2072    ).        if r
-00025d20: 6563 656e 745b 2256 6f6c 4d41 225d 2e69  ecent["VolMA"].i
-00025d30: 6c6f 635b 305d 203d 3d20 303a 2020 2320  loc[0] == 0:  # 
-00025d40: 4861 6e64 6c65 7320 4469 7669 6465 2062  Handles Divide b
-00025d50: 7920 3020 7761 726e 696e 670a 2020 2020  y 0 warning.    
-00025d60: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
-00025d70: 5b22 566f 6c75 6d65 225d 203d 2030 2020  ["Volume"] = 0  
-00025d80: 2320 2255 6e6b 6e6f 776e 220a 2020 2020  # "Unknown".    
-00025d90: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-00025da0: 6374 5b22 566f 6c75 6d65 225d 203d 2030  ct["Volume"] = 0
-00025db0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00025dc0: 7572 6e20 4661 6c73 652c 2068 6173 4d69  urn False, hasMi
-00025dd0: 6e69 6d75 6d56 6f6c 756d 650a 2020 2020  nimumVolume.    
-00025de0: 2020 2020 7261 7469 6f20 3d20 726f 756e      ratio = roun
-00025df0: 6428 7265 6365 6e74 5b22 566f 6c75 6d65  d(recent["Volume
-00025e00: 225d 2e69 6c6f 635b 305d 202f 2072 6563  "].iloc[0] / rec
-00025e10: 656e 745b 2256 6f6c 4d41 225d 2e69 6c6f  ent["VolMA"].ilo
-00025e20: 635b 305d 2c20 3229 0a20 2020 2020 2020  c[0], 2).       
-00025e30: 2073 6176 6544 6963 745b 2256 6f6c 756d   saveDict["Volum
-00025e40: 6522 5d20 3d20 7261 7469 6f0a 2020 2020  e"] = ratio.    
-00025e50: 2020 2020 6966 2072 6174 696f 203e 3d20      if ratio >= 
-00025e60: 766f 6c75 6d65 5261 7469 6f20 616e 6420  volumeRatio and 
-00025e70: 7261 7469 6f20 213d 206e 702e 6e61 6e20  ratio != np.nan 
-00025e80: 616e 6420 286e 6f74 206d 6174 682e 6973  and (not math.is
-00025e90: 696e 6628 7261 7469 6f29 293a 0a20 2020  inf(ratio)):.   
-00025ea0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-00025eb0: 6963 745b 2256 6f6c 756d 6522 5d20 3d20  ict["Volume"] = 
-00025ec0: 7261 7469 6f0a 2020 2020 2020 2020 2020  ratio.          
-00025ed0: 2020 7265 7475 726e 2054 7275 652c 2068    return True, h
-00025ee0: 6173 4d69 6e69 6d75 6d56 6f6c 756d 650a  asMinimumVolume.
-00025ef0: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-00025f00: 6374 5b22 566f 6c75 6d65 225d 203d 2072  ct["Volume"] = r
-00025f10: 6174 696f 0a20 2020 2020 2020 2072 6574  atio.        ret
-00025f20: 7572 6e20 4661 6c73 652c 2068 6173 4d69  urn False, hasMi
-00025f30: 6e69 6d75 6d56 6f6c 756d 650a 0a20 2020  nimumVolume..   
-00025f40: 2023 2046 696e 6420 6966 2073 746f 636b   # Find if stock
-00025f50: 2069 7320 7661 6c69 6461 7469 6e67 2076   is validating v
-00025f60: 6f6c 756d 6520 7370 7265 6164 2061 6e61  olume spread ana
-00025f70: 6c79 7369 730a 2020 2020 6465 6620 7661  lysis.    def va
-00025f80: 6c69 6461 7465 566f 6c75 6d65 5370 7265  lidateVolumeSpre
-00025f90: 6164 416e 616c 7973 6973 2873 656c 662c  adAnalysis(self,
-00025fa0: 2064 662c 2073 6372 6565 6e44 6963 742c   df, screenDict,
-00025fb0: 2073 6176 6544 6963 7429 3a0a 2020 2020   saveDict):.    
-00025fc0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00025fd0: 2020 2020 2069 6620 6466 2069 7320 4e6f       if df is No
-00025fe0: 6e65 206f 7220 6c65 6e28 6466 2920 3d3d  ne or len(df) ==
-00025ff0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00026000: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00026010: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00026020: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
-00026030: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-00026040: 2064 6174 612e 6865 6164 2832 290a 2020   data.head(2).  
-00026050: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00026060: 2864 6174 6129 203c 2032 3a0a 2020 2020  (data) < 2:.    
-00026070: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00026080: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-00026090: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-000260a0: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
-000260b0: 6b20 666f 7220 7072 6576 696f 7573 2052  k for previous R
-000260c0: 4544 2063 616e 646c 6573 0a20 2020 2020  ED candles.     
-000260d0: 2020 2020 2020 2020 2020 2023 2043 7572             # Cur
-000260e0: 7265 6e74 2063 616e 646c 6520 3d20 3074  rent candle = 0t
-000260f0: 682c 2050 7265 7669 6f75 7320 4361 6e64  h, Previous Cand
-00026100: 6c65 203d 2031 7374 2066 6f72 2066 6f6c  le = 1st for fol
-00026110: 6c6f 7769 6e67 206c 6f67 6963 0a20 2020  lowing logic.   
-00026120: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00026130: 6461 7461 2e69 6c6f 635b 315d 5b22 4f70  data.iloc[1]["Op
-00026140: 656e 225d 203e 3d20 6461 7461 2e69 6c6f  en"] >= data.ilo
-00026150: 635b 315d 5b22 436c 6f73 6522 5d3a 0a20  c[1]["Close"]:. 
-00026160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026170: 2020 2073 7072 6561 6431 203d 2061 6273     spread1 = abs
-00026180: 2864 6174 612e 696c 6f63 5b31 5d5b 224f  (data.iloc[1]["O
-00026190: 7065 6e22 5d20 2d20 6461 7461 2e69 6c6f  pen"] - data.ilo
-000261a0: 635b 315d 5b22 436c 6f73 6522 5d29 0a20  c[1]["Close"]). 
-000261b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261c0: 2020 2073 7072 6561 6430 203d 2061 6273     spread0 = abs
-000261d0: 2864 6174 612e 696c 6f63 5b30 5d5b 224f  (data.iloc[0]["O
-000261e0: 7065 6e22 5d20 2d20 6461 7461 2e69 6c6f  pen"] - data.ilo
-000261f0: 635b 305d 5b22 436c 6f73 6522 5d29 0a20  c[0]["Close"]). 
-00026200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026210: 2020 206c 6f77 6572 5f77 6963 6b5f 7370     lower_wick_sp
-00026220: 7265 6164 3020 3d20 280a 2020 2020 2020  read0 = (.      
-00026230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026240: 2020 6d61 7828 6461 7461 2e69 6c6f 635b    max(data.iloc[
-00026250: 305d 5b22 4f70 656e 225d 2c20 6461 7461  0]["Open"], data
-00026260: 2e69 6c6f 635b 305d 5b22 436c 6f73 6522  .iloc[0]["Close"
-00026270: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00026280: 2020 2020 2020 2020 2020 202d 2064 6174             - dat
-00026290: 612e 696c 6f63 5b30 5d5b 224c 6f77 225d  a.iloc[0]["Low"]
-000262a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000262b0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000262c0: 2020 2020 2020 2020 2020 2076 6f6c 3120             vol1 
-000262d0: 3d20 6461 7461 2e69 6c6f 635b 315d 5b22  = data.iloc[1]["
-000262e0: 566f 6c75 6d65 225d 0a20 2020 2020 2020  Volume"].       
-000262f0: 2020 2020 2020 2020 2020 2020 2076 6f6c               vol
-00026300: 3020 3d20 6461 7461 2e69 6c6f 635b 305d  0 = data.iloc[0]
-00026310: 5b22 566f 6c75 6d65 225d 0a20 2020 2020  ["Volume"].     
-00026320: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00026330: 6176 6564 203d 2073 656c 662e 6669 6e64  aved = self.find
-00026340: 4375 7272 656e 7453 6176 6564 5661 6c75  CurrentSavedValu
-00026350: 6528 7363 7265 656e 4469 6374 2c20 7361  e(screenDict, sa
-00026360: 7665 4469 6374 2c20 2250 6174 7465 726e  veDict, "Pattern
-00026370: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00026380: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
-00026390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000263a0: 2020 2020 7370 7265 6164 3020 3e20 7370      spread0 > sp
-000263b0: 7265 6164 310a 2020 2020 2020 2020 2020  read1.          
-000263c0: 2020 2020 2020 2020 2020 2020 2020 616e                an
-000263d0: 6420 766f 6c30 203c 2076 6f6c 310a 2020  d vol0 < vol1.  
-000263e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000263f0: 2020 2020 2020 616e 6420 6461 7461 2e69        and data.i
-00026400: 6c6f 635b 305d 5b22 566f 6c75 6d65 225d  loc[0]["Volume"]
-00026410: 203c 2064 6174 612e 696c 6f63 5b30 5d5b   < data.iloc[0][
-00026420: 2256 6f6c 4d41 225d 0a20 2020 2020 2020  "VolMA"].       
-00026430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026440: 2061 6e64 2064 6174 612e 696c 6f63 5b30   and data.iloc[0
-00026450: 5d5b 2243 6c6f 7365 225d 203c 3d20 6461  ]["Close"] <= da
-00026460: 7461 2e69 6c6f 635b 315d 5b22 4f70 656e  ta.iloc[1]["Open
-00026470: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
-00026480: 2020 2020 2020 2020 2020 2061 6e64 2073             and s
-00026490: 7072 6561 6430 203c 206c 6f77 6572 5f77  pread0 < lower_w
-000264a0: 6963 6b5f 7370 7265 6164 300a 2020 2020  ick_spread0.    
-000264b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000264c0: 2020 2020 616e 6420 6461 7461 2e69 6c6f      and data.ilo
-000264d0: 635b 305d 5b22 566f 6c75 6d65 225d 203c  c[0]["Volume"] <
-000264e0: 3d20 696e 7428 6461 7461 2e69 6c6f 635b  = int(data.iloc[
-000264f0: 315d 5b22 566f 6c75 6d65 225d 202a 2030  1]["Volume"] * 0
-00026500: 2e37 3529 0a20 2020 2020 2020 2020 2020  .75).           
-00026510: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-00026520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026530: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
-00026540: 5061 7474 6572 6e22 5d20 3d20 280a 2020  Pattern"] = (.  
-00026550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026560: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
-00026570: 305d 200a 2020 2020 2020 2020 2020 2020  0] .            
-00026580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026590: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
-000265a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000265b0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-000265c0: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
-000265d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000265e0: 2020 2020 2020 2020 2020 202b 2022 5375             + "Su
-000265f0: 7070 6c79 2044 726f 7567 6874 220a 2020  pply Drought".  
-00026600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026610: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-00026620: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00026630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026640: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00026650: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00026660: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
-00026670: 3d20 7361 7665 645b 315d 202b 2022 5375  = saved[1] + "Su
-00026680: 7070 6c79 2044 726f 7567 6874 220a 2020  pply Drought".  
-00026690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000266a0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-000266b0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000266c0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-000266d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000266e0: 2020 2073 7072 6561 6430 203c 2073 7072     spread0 < spr
-000266f0: 6561 6431 0a20 2020 2020 2020 2020 2020  ead1.           
-00026700: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00026710: 2076 6f6c 3020 3e20 766f 6c31 0a20 2020   vol0 > vol1.   
-00026720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026730: 2020 2020 2061 6e64 2064 6174 612e 696c       and data.il
-00026740: 6f63 5b30 5d5b 2256 6f6c 756d 6522 5d20  oc[0]["Volume"] 
-00026750: 3e20 6461 7461 2e69 6c6f 635b 305d 5b22  > data.iloc[0]["
-00026760: 566f 6c4d 4122 5d0a 2020 2020 2020 2020  VolMA"].        
-00026770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026780: 616e 6420 6461 7461 2e69 6c6f 635b 305d  and data.iloc[0]
-00026790: 5b22 436c 6f73 6522 5d20 3c3d 2064 6174  ["Close"] <= dat
-000267a0: 612e 696c 6f63 5b31 5d5b 224f 7065 6e22  a.iloc[1]["Open"
-000267b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000267c0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-000267d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267e0: 2073 6372 6565 6e44 6963 745b 2250 6174   screenDict["Pat
-000267f0: 7465 726e 225d 203d 2028 0a20 2020 2020  tern"] = (.     
-00026800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026810: 2020 2020 2020 2073 6176 6564 5b30 5d20         saved[0] 
-00026820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026830: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-00026840: 6f6c 6f72 5465 7874 2e42 4f4c 440a 2020  olorText.BOLD.  
-00026850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026860: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-00026870: 7254 6578 742e 4752 4545 4e0a 2020 2020  rText.GREEN.    
-00026880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026890: 2020 2020 2020 2020 2b20 2244 656d 616e          + "Deman
-000268a0: 6420 5269 7365 220a 2020 2020 2020 2020  d Rise".        
-000268b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000268c0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-000268d0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-000268e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000268f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026900: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
-00026910: 5061 7474 6572 6e22 5d20 3d20 7361 7665  Pattern"] = save
-00026920: 645b 315d 202b 2022 4465 6d61 6e64 2052  d[1] + "Demand R
-00026930: 6973 6522 0a20 2020 2020 2020 2020 2020  ise".           
-00026940: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00026950: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
-00026960: 2020 2020 2065 7863 6570 7420 496e 6465       except Inde
-00026970: 7845 7272 6f72 2061 7320 653a 2023 2070  xError as e: # p
-00026980: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
-00026990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000269a0: 7365 6c66 2e64 6566 6175 6c74 5f6c 6f67  self.default_log
-000269b0: 6765 722e 6465 6275 6728 652c 2065 7863  ger.debug(e, exc
-000269c0: 5f69 6e66 6f3d 5472 7565 290a 2020 2020  _info=True).    
-000269d0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-000269e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000269f0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-00026a00: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00026a10: 6f6e 2061 7320 653a 2020 2320 7072 6167  on as e:  # prag
-00026a20: 6d61 3a20 6e6f 2063 6f76 6572 0a20 2020  ma: no cover.   
-00026a30: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
-00026a40: 6661 756c 745f 6c6f 6767 6572 2e64 6562  fault_logger.deb
-00026a50: 7567 2865 2c20 6578 635f 696e 666f 3d54  ug(e, exc_info=T
-00026a60: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00026a70: 2072 6574 7572 6e20 4661 6c73 650a        return False.
+00024a00: 3d31 3329 2e74 6169 6c28 3129 2e69 6c6f  =13).tail(1).ilo
+00024a10: 635b 305d 0a20 2020 2020 2020 2077 5f65  c[0].        w_e
+00024a20: 6d61 5f32 3620 3d20 706b 7461 6c69 622e  ma_26 = pktalib.
+00024a30: 454d 4128 7765 656b 6c79 4461 7461 5b22  EMA(weeklyData["
+00024a40: 436c 6f73 6522 5d2c 7469 6d65 7065 7269  Close"],timeperi
+00024a50: 6f64 3d32 3629 2e74 6169 6c28 3129 2e69  od=26).tail(1).i
+00024a60: 6c6f 635b 305d 0a20 2020 2020 2020 2077  loc[0].        w
+00024a70: 5f73 6d61 5f35 3020 3d20 706b 7461 6c69  _sma_50 = pktali
+00024a80: 622e 534d 4128 7765 656b 6c79 4461 7461  b.SMA(weeklyData
+00024a90: 5b22 436c 6f73 6522 5d2c 7469 6d65 7065  ["Close"],timepe
+00024aa0: 7269 6f64 3d35 3029 2e74 6169 6c28 3129  riod=50).tail(1)
+00024ab0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+00024ac0: 2077 5f73 6d61 5f34 3020 3d20 706b 7461   w_sma_40 = pkta
+00024ad0: 6c69 622e 534d 4128 7765 656b 6c79 4461  lib.SMA(weeklyDa
+00024ae0: 7461 5b22 436c 6f73 6522 5d2c 7469 6d65  ta["Close"],time
+00024af0: 7065 7269 6f64 3d34 3029 2e74 6169 6c28  period=40).tail(
+00024b00: 3129 2e69 6c6f 635b 305d 0a20 2020 2020  1).iloc[0].     
+00024b10: 2020 2077 5f73 6d61 5f34 305f 3577 5f61     w_sma_40_5w_a
+00024b20: 676f 203d 2070 6b74 616c 6962 2e53 4d41  go = pktalib.SMA
+00024b30: 2877 6565 6b6c 7944 6174 612e 6865 6164  (weeklyData.head
+00024b40: 286c 656e 2877 6565 6b6c 7944 6174 6129  (len(weeklyData)
+00024b50: 2d35 295b 2243 6c6f 7365 225d 2c74 696d  -5)["Close"],tim
+00024b60: 6570 6572 696f 643d 3430 292e 7461 696c  eperiod=40).tail
+00024b70: 2831 292e 696c 6f63 5b30 5d0a 2020 2020  (1).iloc[0].    
+00024b80: 2020 2020 775f 6d69 6e5f 3530 203d 206d      w_min_50 = m
+00024b90: 696e 2831 2e33 2a77 6565 6b6c 7944 6174  in(1.3*weeklyDat
+00024ba0: 612e 7461 696c 2835 3029 5b22 4c6f 7722  a.tail(50)["Low"
+00024bb0: 5d29 0a20 2020 2020 2020 2077 5f6d 6178  ]).        w_max
+00024bc0: 5f35 3020 3d20 6d61 7828 302e 3735 2a77  _50 = max(0.75*w
+00024bd0: 6565 6b6c 7944 6174 612e 7461 696c 2835  eeklyData.tail(5
+00024be0: 3029 5b22 4869 6768 225d 290a 2020 2020  0)["High"]).    
+00024bf0: 2020 2020 775f 656d 615f 3236 5f32 3077      w_ema_26_20w
+00024c00: 5f61 676f 203d 2070 6b74 616c 6962 2e45  _ago = pktalib.E
+00024c10: 4d41 2877 6565 6b6c 7944 6174 612e 6865  MA(weeklyData.he
+00024c20: 6164 286c 656e 2877 6565 6b6c 7944 6174  ad(len(weeklyDat
+00024c30: 6129 2d32 3029 5b22 436c 6f73 6522 5d2c  a)-20)["Close"],
+00024c40: 7469 6d65 7065 7269 6f64 3d32 3629 2e74  timeperiod=26).t
+00024c50: 6169 6c28 3129 2e69 6c6f 635b 305d 0a20  ail(1).iloc[0]. 
+00024c60: 2020 2020 2020 2072 6563 656e 745f 656d         recent_em
+00024c70: 615f 3133 5f32 3064 5f61 676f 203d 2070  a_13_20d_ago = p
+00024c80: 6b74 616c 6962 2e45 4d41 2872 6576 6572  ktalib.EMA(rever
+00024c90: 7365 6444 6174 612e 6865 6164 286c 656e  sedData.head(len
+00024ca0: 2872 6576 6572 7365 6444 6174 6129 2d32  (reversedData)-2
+00024cb0: 3029 5b22 436c 6f73 6522 5d2c 7469 6d65  0)["Close"],time
+00024cc0: 7065 7269 6f64 3d31 3329 2e74 6169 6c28  period=13).tail(
+00024cd0: 3129 2e69 6c6f 635b 305d 0a20 2020 2020  1).iloc[0].     
+00024ce0: 2020 2077 5f73 6d61 5f34 305f 3577 5f61     w_sma_40_5w_a
+00024cf0: 676f 203d 2070 6b74 616c 6962 2e53 4d41  go = pktalib.SMA
+00024d00: 2877 6565 6b6c 7944 6174 612e 6865 6164  (weeklyData.head
+00024d10: 286c 656e 2877 6565 6b6c 7944 6174 6129  (len(weeklyData)
+00024d20: 2d35 295b 2243 6c6f 7365 225d 2c74 696d  -5)["Close"],tim
+00024d30: 6570 6572 696f 643d 3430 292e 7461 696c  eperiod=40).tail
+00024d40: 2831 292e 696c 6f63 5b30 5d0a 2020 2020  (1).iloc[0].    
+00024d50: 2020 2020 775f 736d 615f 3430 5f31 3077      w_sma_40_10w
+00024d60: 5f61 676f 203d 2070 6b74 616c 6962 2e53  _ago = pktalib.S
+00024d70: 4d41 2877 6565 6b6c 7944 6174 612e 6865  MA(weeklyData.he
+00024d80: 6164 286c 656e 2877 6565 6b6c 7944 6174  ad(len(weeklyDat
+00024d90: 6129 2d31 3029 5b22 436c 6f73 6522 5d2c  a)-10)["Close"],
+00024da0: 7469 6d65 7065 7269 6f64 3d34 3029 2e74  timeperiod=40).t
+00024db0: 6169 6c28 3129 2e69 6c6f 635b 305d 0a20  ail(1).iloc[0]. 
+00024dc0: 2020 2020 2020 2072 6563 656e 745f 736d         recent_sm
+00024dd0: 615f 3530 203d 2070 6b74 616c 6962 2e53  a_50 = pktalib.S
+00024de0: 4d41 2872 6576 6572 7365 6444 6174 615b  MA(reversedData[
+00024df0: 2243 6c6f 7365 225d 2c74 696d 6570 6572  "Close"],timeper
+00024e00: 696f 643d 3530 292e 7461 696c 2831 292e  iod=50).tail(1).
+00024e10: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
+00024e20: 775f 776d 615f 3820 3d20 706b 7461 6c69  w_wma_8 = pktali
+00024e30: 622e 574d 4128 7765 656b 6c79 4461 7461  b.WMA(weeklyData
+00024e40: 5b22 436c 6f73 6522 5d2c 7469 6d65 7065  ["Close"],timepe
+00024e50: 7269 6f64 3d38 292e 7461 696c 2831 292e  riod=8).tail(1).
+00024e60: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
+00024e70: 775f 736d 615f 3820 3d20 706b 7461 6c69  w_sma_8 = pktali
+00024e80: 622e 534d 4128 7765 656b 6c79 4461 7461  b.SMA(weeklyData
+00024e90: 5b22 436c 6f73 6522 5d2c 7469 6d65 7065  ["Close"],timepe
+00024ea0: 7269 6f64 3d38 292e 7461 696c 2831 292e  riod=8).tail(1).
+00024eb0: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
+00024ec0: 6e75 6d50 7265 7669 6f75 7343 616e 646c  numPreviousCandl
+00024ed0: 6573 203d 2032 300a 2020 2020 2020 2020  es = 20.        
+00024ee0: 7075 6c6c 6261 636b 4461 7461 203d 2064  pullbackData = d
+00024ef0: 6174 612e 6865 6164 286e 756d 5072 6576  ata.head(numPrev
+00024f00: 696f 7573 4361 6e64 6c65 7329 0a20 2020  iousCandles).   
+00024f10: 2020 2020 2070 756c 6c62 6163 6b44 6174       pullbackDat
+00024f20: 612e 6c6f 635b 3a2c 2750 756c 6c42 6163  a.loc[:,'PullBac
+00024f30: 6b27 5d20 3d20 7075 6c6c 6261 636b 4461  k'] = pullbackDa
+00024f40: 7461 5b22 436c 6f73 6522 5d2e 6c74 2870  ta["Close"].lt(p
+00024f50: 756c 6c62 6163 6b44 6174 615b 224f 7065  ullbackData["Ope
+00024f60: 6e22 5d29 2023 2e73 6869 6674 2870 6572  n"]) #.shift(per
+00024f70: 696f 6473 3d31 2929 2023 2620 6461 7461  iods=1)) #& data
+00024f80: 5b22 4c6f 7722 5d2e 6c74 2864 6174 615b  ["Low"].lt(data[
+00024f90: 224c 6f77 225d 2e73 6869 6674 2870 6572  "Low"].shift(per
+00024fa0: 696f 6473 3d31 2929 0a20 2020 2020 2020  iods=1)).       
+00024fb0: 2073 6872 696e 6b65 6456 6f6c 4461 7461   shrinkedVolData
+00024fc0: 203d 2070 756c 6c62 6163 6b44 6174 615b   = pullbackData[
+00024fd0: 7075 6c6c 6261 636b 4461 7461 5b22 5075  pullbackData["Pu
+00024fe0: 6c6c 4261 636b 225d 203d 3d20 5472 7565  llBack"] == True
+00024ff0: 5d2e 6865 6164 286e 756d 5072 6576 696f  ].head(numPrevio
+00025000: 7573 4361 6e64 6c65 7329 0a20 2020 2020  usCandles).     
+00025010: 2020 2072 6563 656e 744c 6172 6765 7374     recentLargest
+00025020: 566f 6c75 6d65 203d 206d 6178 2870 756c  Volume = max(pul
+00025030: 6c62 6163 6b44 6174 615b 7075 6c6c 6261  lbackData[pullba
+00025040: 636b 4461 7461 5b22 5075 6c6c 4261 636b  ckData["PullBack
+00025050: 225d 203d 3d20 4661 6c73 655d 2e68 6561  "] == False].hea
+00025060: 6428 3329 5b22 566f 6c75 6d65 225d 290a  d(3)["Volume"]).
+00025070: 2020 2020 2020 2020 2320 7075 6c6c 6261          # pullba
+00025080: 636b 4461 7461 2e6c 6f63 5b3a 2c27 5042  ckData.loc[:,'PB
+00025090: 566f 6c52 6174 696f 275d 203d 2070 756c  VolRatio'] = pul
+000250a0: 6c62 6163 6b44 6174 615b 2256 6f6c 756d  lbackData["Volum
+000250b0: 6522 5d2f 7265 6365 6e74 4c61 7267 6573  e"]/recentLarges
+000250c0: 7456 6f6c 756d 650a 2020 2020 2020 2020  tVolume.        
+000250d0: 766f 6c49 6e50 7265 7669 6f75 7350 756c  volInPreviousPul
+000250e0: 6c62 6163 6b73 5368 7269 6e6b 6564 203d  lbacksShrinked =
+000250f0: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
+00025100: 6620 6e6f 7420 7368 7269 6e6b 6564 566f  f not shrinkedVo
+00025110: 6c44 6174 612e 656d 7074 793a 0a20 2020  lData.empty:.   
+00025120: 2020 2020 2020 2020 2069 6e64 6578 203d           index =
+00025130: 2030 0a20 2020 2020 2020 2020 2020 2077   0.            w
+00025140: 6869 6c65 2069 6e64 6578 203c 206c 656e  hile index < len
+00025150: 2873 6872 696e 6b65 6456 6f6c 4461 7461  (shrinkedVolData
+00025160: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00025170: 2020 2076 6f6c 496e 5072 6576 696f 7573     volInPrevious
+00025180: 5075 6c6c 6261 636b 7353 6872 696e 6b65  PullbacksShrinke
+00025190: 6420 3d20 7368 7269 6e6b 6564 566f 6c44  d = shrinkedVolD
+000251a0: 6174 615b 2256 6f6c 756d 6522 5d2e 696c  ata["Volume"].il
+000251b0: 6f63 5b69 6e64 6578 5d20 3c20 7365 6c66  oc[index] < self
+000251c0: 2e63 6f6e 6669 674d 616e 6167 6572 2e76  .configManager.v
+000251d0: 6370 566f 6c75 6d65 436f 6e74 7261 6374  cpVolumeContract
+000251e0: 696f 6e52 6174 696f 202a 2072 6563 656e  ionRatio * recen
+000251f0: 744c 6172 6765 7374 566f 6c75 6d65 0a20  tLargestVolume. 
+00025200: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00025210: 6620 6e6f 7420 766f 6c49 6e50 7265 7669  f not volInPrevi
+00025220: 6f75 7350 756c 6c62 6163 6b73 5368 7269  ousPullbacksShri
+00025230: 6e6b 6564 3a0a 2020 2020 2020 2020 2020  nked:.          
+00025240: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+00025250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025260: 696e 6465 7820 2b3d 2031 0a20 2020 2020  index += 1.     
+00025270: 2020 2072 6563 656e 7456 6f6c 756d 6548     recentVolumeH
+00025280: 6173 4162 6f76 6541 7667 566f 6c20 3d20  asAboveAvgVol = 
+00025290: 7265 6365 6e74 4c61 7267 6573 7456 6f6c  recentLargestVol
+000252a0: 756d 6520 3e3d 2073 656c 662e 636f 6e66  ume >= self.conf
+000252b0: 6967 4d61 6e61 6765 722e 766f 6c75 6d65  igManager.volume
+000252c0: 5261 7469 6f20 2a20 6461 7461 5b22 566f  Ratio * data["Vo
+000252d0: 6c4d 4122 5d2e 696c 6f63 5b30 5d0a 2020  lMA"].iloc[0].  
+000252e0: 2020 2020 2020 6973 5643 5020 3d20 775f        isVCP = w_
+000252f0: 656d 615f 3133 203e 2077 5f65 6d61 5f32  ema_13 > w_ema_2
+00025300: 3620 616e 6420 5c0a 2020 2020 2020 2020  6 and \.        
+00025310: 2020 2020 2020 2020 775f 656d 615f 3236          w_ema_26
+00025320: 203e 2077 5f73 6d61 5f35 3020 616e 6420   > w_sma_50 and 
+00025330: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00025340: 2020 775f 736d 615f 3430 203e 2077 5f73    w_sma_40 > w_s
+00025350: 6d61 5f34 305f 3577 5f61 676f 2061 6e64  ma_40_5w_ago and
+00025360: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00025370: 2020 2072 6563 656e 745f 636c 6f73 6520     recent_close 
+00025380: 3e3d 2077 5f6d 696e 5f35 3020 616e 6420  >= w_min_50 and 
+00025390: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+000253a0: 2020 7265 6365 6e74 5f63 6c6f 7365 203e    recent_close >
+000253b0: 3d20 775f 6d61 785f 3530 2061 6e64 205c  = w_max_50 and \
+000253c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000253d0: 2072 6563 656e 745f 656d 615f 3133 5f32   recent_ema_13_2
+000253e0: 3064 5f61 676f 203e 2077 5f65 6d61 5f32  0d_ago > w_ema_2
+000253f0: 365f 3230 775f 6167 6f20 616e 6420 5c0a  6_20w_ago and \.
+00025400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025410: 775f 736d 615f 3430 5f35 775f 6167 6f20  w_sma_40_5w_ago 
+00025420: 3e20 775f 736d 615f 3430 5f31 3077 5f61  > w_sma_40_10w_a
+00025430: 676f 2061 6e64 205c 0a20 2020 2020 2020  go and \.       
+00025440: 2020 2020 2020 2020 2072 6563 656e 745f           recent_
+00025450: 636c 6f73 6520 3e20 7265 6365 6e74 5f73  close > recent_s
+00025460: 6d61 5f35 3020 616e 6420 5c0a 2020 2020  ma_50 and \.    
+00025470: 2020 2020 2020 2020 2020 2020 2877 5f77              (w_w
+00025480: 6d61 5f38 202d 2077 5f73 6d61 5f38 292a  ma_8 - w_sma_8)*
+00025490: 362f 3239 203c 2030 2e35 2061 6e64 205c  6/29 < 0.5 and \
+000254a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000254b0: 2076 6f6c 496e 5072 6576 696f 7573 5075   volInPreviousPu
+000254c0: 6c6c 6261 636b 7353 6872 696e 6b65 6420  llbacksShrinked 
+000254d0: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
+000254e0: 2020 2020 2020 7265 6365 6e74 566f 6c75        recentVolu
+000254f0: 6d65 4861 7341 626f 7665 4176 6756 6f6c  meHasAboveAvgVol
+00025500: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
+00025510: 2020 2020 2020 2072 6563 656e 745f 636c         recent_cl
+00025520: 6f73 6520 3e20 3130 0a20 2020 2020 2020  ose > 10.       
+00025530: 2069 6620 6973 5643 503a 0a20 2020 2020   if isVCP:.     
+00025540: 2020 2020 2020 2073 6176 6564 203d 2073         saved = s
+00025550: 656c 662e 6669 6e64 4375 7272 656e 7453  elf.findCurrentS
+00025560: 6176 6564 5661 6c75 6528 7363 7265 656e  avedValue(screen
+00025570: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
+00025580: 2250 6174 7465 726e 2229 0a20 2020 2020  "Pattern").     
+00025590: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+000255a0: 745b 2250 6174 7465 726e 225d 203d 2028  t["Pattern"] = (
+000255b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000255c0: 2073 6176 6564 5b30 5d20 0a20 2020 2020   saved[0] .     
+000255d0: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+000255e0: 6f72 5465 7874 2e42 4f4c 440a 2020 2020  orText.BOLD.    
+000255f0: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+00025600: 6c6f 7254 6578 742e 4752 4545 4e0a 2020  lorText.GREEN.  
+00025610: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00025620: 6622 5643 5028 4d69 6e65 7276 696e 6929  f"VCP(Minervini)
+00025630: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00025640: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
+00025650: 440a 2020 2020 2020 2020 2020 2020 290a  D.            ).
+00025660: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00025670: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+00025680: 3d20 7361 7665 645b 315d 202b 2066 2256  = saved[1] + f"V
+00025690: 4350 284d 696e 6572 7669 6e69 2922 0a20  CP(Minervini)". 
+000256a0: 2020 2020 2020 2072 6574 7572 6e20 6973         return is
+000256b0: 5643 500a 2020 2020 0a20 2020 2023 2056  VCP.    .    # V
+000256c0: 616c 6964 6174 6520 5643 500a 2020 2020  alidate VCP.    
+000256d0: 6465 6620 7661 6c69 6461 7465 5643 5028  def validateVCP(
+000256e0: 0a20 2020 2020 2020 2073 656c 662c 2064  .        self, d
+000256f0: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
+00025700: 6176 6544 6963 742c 2073 746f 636b 4e61  aveDict, stockNa
+00025710: 6d65 3d4e 6f6e 652c 2077 696e 646f 773d  me=None, window=
+00025720: 332c 2070 6572 6365 6e74 6167 6546 726f  3, percentageFro
+00025730: 6d54 6f70 3d33 0a20 2020 2029 3a0a 2020  mTop=3.    ):.  
+00025740: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
+00025750: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
+00025760: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00025770: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00025780: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
+00025790: 636f 7079 2829 0a20 2020 2020 2020 2074  copy().        t
+000257a0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000257b0: 7065 7263 656e 7461 6765 4672 6f6d 546f  percentageFromTo
+000257c0: 7020 2f3d 2031 3030 0a20 2020 2020 2020  p /= 100.       
+000257d0: 2020 2020 2064 6174 612e 7265 7365 745f       data.reset_
+000257e0: 696e 6465 7828 696e 706c 6163 653d 5472  index(inplace=Tr
+000257f0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00025800: 6461 7461 2e72 656e 616d 6528 636f 6c75  data.rename(colu
+00025810: 6d6e 733d 7b22 696e 6465 7822 3a20 2244  mns={"index": "D
+00025820: 6174 6522 7d2c 2069 6e70 6c61 6365 3d54  ate"}, inplace=T
+00025830: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00025840: 2064 6174 615b 2274 6f70 7322 5d20 3d20   data["tops"] = 
+00025850: 2864 6174 615b 2248 6967 6822 5d2e 696c  (data["High"].il
+00025860: 6f63 5b6c 6973 7428 706b 7461 6c69 622e  oc[list(pktalib.
+00025870: 6172 6772 656c 6578 7472 656d 6128 6e70  argrelextrema(np
+00025880: 2e61 7272 6179 2864 6174 615b 2248 6967  .array(data["Hig
+00025890: 6822 5d29 2c20 6e70 2e67 7265 6174 6572  h"]), np.greater
+000258a0: 5f65 7175 616c 2c20 6f72 6465 723d 7769  _equal, order=wi
+000258b0: 6e64 6f77 295b 305d 295d 2e68 6561 6428  ndow)[0])].head(
+000258c0: 3429 290a 2020 2020 2020 2020 2020 2020  4)).            
+000258d0: 6461 7461 5b22 626f 7473 225d 203d 2028  data["bots"] = (
+000258e0: 6461 7461 5b22 4c6f 7722 5d2e 696c 6f63  data["Low"].iloc
+000258f0: 5b6c 6973 7428 706b 7461 6c69 622e 6172  [list(pktalib.ar
+00025900: 6772 656c 6578 7472 656d 6128 6e70 2e61  grelextrema(np.a
+00025910: 7272 6179 2864 6174 615b 224c 6f77 225d  rray(data["Low"]
+00025920: 292c 206e 702e 6c65 7373 5f65 7175 616c  ), np.less_equal
+00025930: 2c20 6f72 6465 723d 7769 6e64 6f77 295b  , order=window)[
+00025940: 305d 295d 2e68 6561 6428 3429 290a 2020  0])].head(4)).  
+00025950: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+00025960: 2064 6174 612e 6669 6c6c 6e61 2830 290a   data.fillna(0).
+00025970: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00025980: 203d 2064 6174 612e 7265 706c 6163 6528   = data.replace(
+00025990: 5b6e 702e 696e 662c 202d 6e70 2e69 6e66  [np.inf, -np.inf
+000259a0: 5d2c 2030 290a 2020 2020 2020 2020 2020  ], 0).          
+000259b0: 2020 746f 7073 203d 2064 6174 615b 6461    tops = data[da
+000259c0: 7461 2e74 6f70 7320 3e20 305d 0a20 2020  ta.tops > 0].   
+000259d0: 2020 2020 2020 2020 2023 2062 6f74 7320           # bots 
+000259e0: 3d20 6461 7461 5b64 6174 612e 626f 7473  = data[data.bots
+000259f0: 203e 2030 5d0a 2020 2020 2020 2020 2020   > 0].          
+00025a00: 2020 6869 6768 6573 7454 6f70 203d 2072    highestTop = r
+00025a10: 6f75 6e64 2874 6f70 732e 6465 7363 7269  ound(tops.descri
+00025a20: 6265 2829 5b22 4869 6768 225d 5b22 6d61  be()["High"]["ma
+00025a30: 7822 5d2c 2031 290a 2020 2020 2020 2020  x"], 1).        
+00025a40: 2020 2020 6669 6c74 6572 6564 546f 7073      filteredTops
+00025a50: 203d 2074 6f70 735b 0a20 2020 2020 2020   = tops[.       
+00025a60: 2020 2020 2020 2020 2074 6f70 732e 746f           tops.to
+00025a70: 7073 203e 2028 6869 6768 6573 7454 6f70  ps > (highestTop
+00025a80: 202d 2028 6869 6768 6573 7454 6f70 202a   - (highestTop *
+00025a90: 2070 6572 6365 6e74 6167 6546 726f 6d54   percentageFromT
+00025aa0: 6f70 2929 0a20 2020 2020 2020 2020 2020  op)).           
+00025ab0: 205d 0a20 2020 2020 2020 2020 2020 2069   ].            i
+00025ac0: 6620 6669 6c74 6572 6564 546f 7073 2e65  f filteredTops.e
+00025ad0: 7175 616c 7328 746f 7073 293a 2020 2320  quals(tops):  # 
+00025ae0: 546f 7073 2061 7265 2069 6e20 7468 6520  Tops are in the 
+00025af0: 7261 6e67 650a 2020 2020 2020 2020 2020  range.          
+00025b00: 2020 2020 2020 6c6f 7750 6f69 6e74 7320        lowPoints 
+00025b10: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+00025b20: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00025b30: 6e67 6528 6c65 6e28 746f 7073 2920 2d20  nge(len(tops) - 
+00025b40: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
+00025b50: 2020 2020 2020 2020 656e 6444 6174 6520          endDate 
+00025b60: 3d20 746f 7073 2e69 6c6f 635b 695d 5b22  = tops.iloc[i]["
+00025b70: 4461 7465 225d 0a20 2020 2020 2020 2020  Date"].         
+00025b80: 2020 2020 2020 2020 2020 2073 7461 7274             start
+00025b90: 4461 7465 203d 2074 6f70 732e 696c 6f63  Date = tops.iloc
+00025ba0: 5b69 202b 2031 5d5b 2244 6174 6522 5d0a  [i + 1]["Date"].
+00025bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025bc0: 2020 2020 6c6f 7750 6f69 6e74 732e 6170      lowPoints.ap
+00025bd0: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
+00025be0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00025bf0: 7461 5b0a 2020 2020 2020 2020 2020 2020  ta[.            
+00025c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025c10: 2864 6174 612e 4461 7465 203e 3d20 7374  (data.Date >= st
+00025c20: 6172 7444 6174 6529 2026 2028 6461 7461  artDate) & (data
+00025c30: 2e44 6174 6520 3c3d 2065 6e64 4461 7465  .Date <= endDate
+00025c40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00025c50: 2020 2020 2020 2020 2020 5d2e 6465 7363            ].desc
+00025c60: 7269 6265 2829 5b22 4c6f 7722 5d5b 226d  ribe()["Low"]["m
+00025c70: 696e 225d 0a20 2020 2020 2020 2020 2020  in"].           
+00025c80: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00025c90: 2020 2020 2020 2020 2020 206c 6f77 506f             lowPo
+00025ca0: 696e 7473 4f72 6720 3d20 6c6f 7750 6f69  intsOrg = lowPoi
+00025cb0: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
+00025cc0: 2020 2020 6c6f 7750 6f69 6e74 732e 736f      lowPoints.so
+00025cd0: 7274 2872 6576 6572 7365 3d54 7275 6529  rt(reverse=True)
+00025ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025cf0: 206c 6f77 506f 696e 7473 536f 7274 6564   lowPointsSorted
+00025d00: 203d 206c 6f77 506f 696e 7473 0a20 2020   = lowPoints.   
+00025d10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00025d20: 6461 7461 2e65 6d70 7479 206f 7220 6c65  data.empty or le
+00025d30: 6e28 6c6f 7750 6f69 6e74 7329 203c 2031  n(lowPoints) < 1
+00025d40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00025d50: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00025d60: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+00025d70: 2020 206c 7470 203d 2064 6174 612e 6865     ltp = data.he
+00025d80: 6164 2831 295b 2243 6c6f 7365 225d 2e69  ad(1)["Close"].i
+00025d90: 6c6f 635b 305d 0a20 2020 2020 2020 2020  loc[0].         
+00025da0: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00025db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025dc0: 6c6f 7750 6f69 6e74 734f 7267 203d 3d20  lowPointsOrg == 
+00025dd0: 6c6f 7750 6f69 6e74 7353 6f72 7465 640a  lowPointsSorted.
+00025de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025df0: 2020 2020 616e 6420 6c74 7020 3c20 6869      and ltp < hi
+00025e00: 6768 6573 7454 6f70 0a20 2020 2020 2020  ghestTop.       
+00025e10: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00025e20: 206c 7470 203e 206c 6f77 506f 696e 7473   ltp > lowPoints
+00025e30: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00025e40: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00025e50: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+00025e60: 203d 2073 656c 662e 6669 6e64 4375 7272   = self.findCurr
+00025e70: 656e 7453 6176 6564 5661 6c75 6528 7363  entSavedValue(sc
+00025e80: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
+00025e90: 6374 2c20 2250 6174 7465 726e 2229 0a20  ct, "Pattern"). 
+00025ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025eb0: 2020 2073 6372 6565 6e44 6963 745b 2250     screenDict["P
+00025ec0: 6174 7465 726e 225d 203d 2028 0a20 2020  attern"] = (.   
+00025ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ee0: 2020 2020 2073 6176 6564 5b30 5d20 0a20       saved[0] . 
+00025ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f00: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+00025f10: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
+00025f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f30: 2b20 636f 6c6f 7254 6578 742e 4752 4545  + colorText.GREE
+00025f40: 4e0a 2020 2020 2020 2020 2020 2020 2020  N.              
+00025f50: 2020 2020 2020 2020 2020 2b20 6622 5643            + f"VC
+00025f60: 5020 2842 4f3a 207b 6869 6768 6573 7454  P (BO: {highestT
+00025f70: 6f70 7d29 220a 2020 2020 2020 2020 2020  op})".          
+00025f80: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00025f90: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+00025fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025fb0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00025fc0: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
+00025fd0: 5b22 5061 7474 6572 6e22 5d20 3d20 7361  ["Pattern"] = sa
+00025fe0: 7665 645b 315d 202b 2066 2256 4350 2028  ved[1] + f"VCP (
+00025ff0: 424f 3a20 7b68 6967 6865 7374 546f 707d  BO: {highestTop}
+00026000: 2922 0a20 2020 2020 2020 2020 2020 2020  )".             
+00026010: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00026020: 7565 0a20 2020 2020 2020 2065 7863 6570  ue.        excep
+00026030: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00026040: 3a20 2023 2070 7261 676d 613a 206e 6f20  :  # pragma: no 
+00026050: 636f 7665 720a 2020 2020 2020 2020 2020  cover.          
+00026060: 2020 7365 6c66 2e64 6566 6175 6c74 5f6c    self.default_l
+00026070: 6f67 6765 722e 6465 6275 6728 652c 2065  ogger.debug(e, e
+00026080: 7863 5f69 6e66 6f3d 5472 7565 290a 2020  xc_info=True).  
+00026090: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+000260a0: 7365 0a0a 2020 2020 2320 5661 6c69 6461  se..    # Valida
+000260b0: 7465 2069 6620 766f 6c75 6d65 206f 6620  te if volume of 
+000260c0: 6c61 7374 2064 6179 2069 7320 6869 6768  last day is high
+000260d0: 6572 2074 6861 6e20 6176 670a 2020 2020  er than avg.    
+000260e0: 6465 6620 7661 6c69 6461 7465 566f 6c75  def validateVolu
+000260f0: 6d65 280a 2020 2020 2020 2020 7365 6c66  me(.        self
+00026100: 2c20 6466 2c20 7363 7265 656e 4469 6374  , df, screenDict
+00026110: 2c20 7361 7665 4469 6374 2c20 766f 6c75  , saveDict, volu
+00026120: 6d65 5261 7469 6f3d 322e 352c 206d 696e  meRatio=2.5, min
+00026130: 566f 6c75 6d65 3d31 3030 0a20 2020 2029  Volume=100.    )
+00026140: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+00026150: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+00026160: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+00026170: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00026180: 652c 2046 616c 7365 0a20 2020 2020 2020  e, False.       
+00026190: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+000261a0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+000261b0: 2064 6174 612e 6669 6c6c 6e61 2830 290a   data.fillna(0).
+000261c0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+000261d0: 6174 612e 7265 706c 6163 6528 5b6e 702e  ata.replace([np.
+000261e0: 696e 662c 202d 6e70 2e69 6e66 5d2c 2030  inf, -np.inf], 0
+000261f0: 290a 2020 2020 2020 2020 7265 6365 6e74  ).        recent
+00026200: 203d 2064 6174 612e 6865 6164 2831 290a   = data.head(1).
+00026210: 2020 2020 2020 2020 2320 4569 7468 6572          # Either
+00026220: 2074 6865 2072 6f6c 6c69 6e67 2076 6f6c   the rolling vol
+00026230: 756d 6520 6f66 2070 6173 7420 3230 2073  ume of past 20 s
+00026240: 6573 7369 6f6e 7320 6f72 2074 6f64 6179  essions or today
+00026250: 2773 2076 6f6c 756d 6520 7368 6f75 6c64  's volume should
+00026260: 2062 6520 3e20 6d69 6e20 766f 6c75 6d65   be > min volume
+00026270: 0a20 2020 2020 2020 2068 6173 4d69 6e69  .        hasMini
+00026280: 6d75 6d56 6f6c 756d 6520 3d20 280a 2020  mumVolume = (.  
+00026290: 2020 2020 2020 2020 2020 7265 6365 6e74            recent
+000262a0: 5b22 566f 6c4d 4122 5d2e 696c 6f63 5b30  ["VolMA"].iloc[0
+000262b0: 5d20 3e3d 206d 696e 566f 6c75 6d65 0a20  ] >= minVolume. 
+000262c0: 2020 2020 2020 2020 2020 206f 7220 7265             or re
+000262d0: 6365 6e74 5b22 566f 6c75 6d65 225d 2e69  cent["Volume"].i
+000262e0: 6c6f 635b 305d 203e 3d20 6d69 6e56 6f6c  loc[0] >= minVol
+000262f0: 756d 650a 2020 2020 2020 2020 290a 2020  ume.        ).  
+00026300: 2020 2020 2020 6966 2072 6563 656e 745b        if recent[
+00026310: 2256 6f6c 4d41 225d 2e69 6c6f 635b 305d  "VolMA"].iloc[0]
+00026320: 203d 3d20 303a 2020 2320 4861 6e64 6c65   == 0:  # Handle
+00026330: 7320 4469 7669 6465 2062 7920 3020 7761  s Divide by 0 wa
+00026340: 726e 696e 670a 2020 2020 2020 2020 2020  rning.          
+00026350: 2020 7361 7665 4469 6374 5b22 566f 6c75    saveDict["Volu
+00026360: 6d65 225d 203d 2030 2020 2320 2255 6e6b  me"] = 0  # "Unk
+00026370: 6e6f 776e 220a 2020 2020 2020 2020 2020  nown".          
+00026380: 2020 7363 7265 656e 4469 6374 5b22 566f    screenDict["Vo
+00026390: 6c75 6d65 225d 203d 2030 0a20 2020 2020  lume"] = 0.     
+000263a0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000263b0: 6c73 652c 2068 6173 4d69 6e69 6d75 6d56  lse, hasMinimumV
+000263c0: 6f6c 756d 650a 2020 2020 2020 2020 7261  olume.        ra
+000263d0: 7469 6f20 3d20 726f 756e 6428 7265 6365  tio = round(rece
+000263e0: 6e74 5b22 566f 6c75 6d65 225d 2e69 6c6f  nt["Volume"].ilo
+000263f0: 635b 305d 202f 2072 6563 656e 745b 2256  c[0] / recent["V
+00026400: 6f6c 4d41 225d 2e69 6c6f 635b 305d 2c20  olMA"].iloc[0], 
+00026410: 3229 0a20 2020 2020 2020 2073 6176 6544  2).        saveD
+00026420: 6963 745b 2256 6f6c 756d 6522 5d20 3d20  ict["Volume"] = 
+00026430: 7261 7469 6f0a 2020 2020 2020 2020 6966  ratio.        if
+00026440: 2072 6174 696f 203e 3d20 766f 6c75 6d65   ratio >= volume
+00026450: 5261 7469 6f20 616e 6420 7261 7469 6f20  Ratio and ratio 
+00026460: 213d 206e 702e 6e61 6e20 616e 6420 286e  != np.nan and (n
+00026470: 6f74 206d 6174 682e 6973 696e 6628 7261  ot math.isinf(ra
+00026480: 7469 6f29 293a 0a20 2020 2020 2020 2020  tio)):.         
+00026490: 2020 2073 6372 6565 6e44 6963 745b 2256     screenDict["V
+000264a0: 6f6c 756d 6522 5d20 3d20 7261 7469 6f0a  olume"] = ratio.
+000264b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000264c0: 726e 2054 7275 652c 2068 6173 4d69 6e69  rn True, hasMini
+000264d0: 6d75 6d56 6f6c 756d 650a 2020 2020 2020  mumVolume.      
+000264e0: 2020 7363 7265 656e 4469 6374 5b22 566f    screenDict["Vo
+000264f0: 6c75 6d65 225d 203d 2072 6174 696f 0a20  lume"] = ratio. 
+00026500: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00026510: 6c73 652c 2068 6173 4d69 6e69 6d75 6d56  lse, hasMinimumV
+00026520: 6f6c 756d 650a 0a20 2020 2023 2046 696e  olume..    # Fin
+00026530: 6420 6966 2073 746f 636b 2069 7320 7661  d if stock is va
+00026540: 6c69 6461 7469 6e67 2076 6f6c 756d 6520  lidating volume 
+00026550: 7370 7265 6164 2061 6e61 6c79 7369 730a  spread analysis.
+00026560: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
+00026570: 566f 6c75 6d65 5370 7265 6164 416e 616c  VolumeSpreadAnal
+00026580: 7973 6973 2873 656c 662c 2064 662c 2073  ysis(self, df, s
+00026590: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
+000265a0: 6963 7429 3a0a 2020 2020 2020 2020 7472  ict):.        tr
+000265b0: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
+000265c0: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
+000265d0: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
+000265e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000265f0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00026600: 2020 2020 2020 2064 6174 6120 3d20 6466         data = df
+00026610: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+00026620: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+00026630: 6865 6164 2832 290a 2020 2020 2020 2020  head(2).        
+00026640: 2020 2020 6966 206c 656e 2864 6174 6129      if len(data)
+00026650: 203c 2032 3a0a 2020 2020 2020 2020 2020   < 2:.          
+00026660: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00026670: 7365 0a20 2020 2020 2020 2020 2020 2074  se.            t
+00026680: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00026690: 2020 2020 2320 4368 6563 6b20 666f 7220      # Check for 
+000266a0: 7072 6576 696f 7573 2052 4544 2063 616e  previous RED can
+000266b0: 646c 6573 0a20 2020 2020 2020 2020 2020  dles.           
+000266c0: 2020 2020 2023 2043 7572 7265 6e74 2063       # Current c
+000266d0: 616e 646c 6520 3d20 3074 682c 2050 7265  andle = 0th, Pre
+000266e0: 7669 6f75 7320 4361 6e64 6c65 203d 2031  vious Candle = 1
+000266f0: 7374 2066 6f72 2066 6f6c 6c6f 7769 6e67  st for following
+00026700: 206c 6f67 6963 0a20 2020 2020 2020 2020   logic.         
+00026710: 2020 2020 2020 2069 6620 6461 7461 2e69         if data.i
+00026720: 6c6f 635b 315d 5b22 4f70 656e 225d 203e  loc[1]["Open"] >
+00026730: 3d20 6461 7461 2e69 6c6f 635b 315d 5b22  = data.iloc[1]["
+00026740: 436c 6f73 6522 5d3a 0a20 2020 2020 2020  Close"]:.       
+00026750: 2020 2020 2020 2020 2020 2020 2073 7072               spr
+00026760: 6561 6431 203d 2061 6273 2864 6174 612e  ead1 = abs(data.
+00026770: 696c 6f63 5b31 5d5b 224f 7065 6e22 5d20  iloc[1]["Open"] 
+00026780: 2d20 6461 7461 2e69 6c6f 635b 315d 5b22  - data.iloc[1]["
+00026790: 436c 6f73 6522 5d29 0a20 2020 2020 2020  Close"]).       
+000267a0: 2020 2020 2020 2020 2020 2020 2073 7072               spr
+000267b0: 6561 6430 203d 2061 6273 2864 6174 612e  ead0 = abs(data.
+000267c0: 696c 6f63 5b30 5d5b 224f 7065 6e22 5d20  iloc[0]["Open"] 
+000267d0: 2d20 6461 7461 2e69 6c6f 635b 305d 5b22  - data.iloc[0]["
+000267e0: 436c 6f73 6522 5d29 0a20 2020 2020 2020  Close"]).       
+000267f0: 2020 2020 2020 2020 2020 2020 206c 6f77               low
+00026800: 6572 5f77 6963 6b5f 7370 7265 6164 3020  er_wick_spread0 
+00026810: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00026820: 2020 2020 2020 2020 2020 2020 6d61 7828              max(
+00026830: 6461 7461 2e69 6c6f 635b 305d 5b22 4f70  data.iloc[0]["Op
+00026840: 656e 225d 2c20 6461 7461 2e69 6c6f 635b  en"], data.iloc[
+00026850: 305d 5b22 436c 6f73 6522 5d29 0a20 2020  0]["Close"]).   
+00026860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026870: 2020 2020 202d 2064 6174 612e 696c 6f63       - data.iloc
+00026880: 5b30 5d5b 224c 6f77 225d 0a20 2020 2020  [0]["Low"].     
+00026890: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000268a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000268b0: 2020 2020 2076 6f6c 3120 3d20 6461 7461       vol1 = data
+000268c0: 2e69 6c6f 635b 315d 5b22 566f 6c75 6d65  .iloc[1]["Volume
+000268d0: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
+000268e0: 2020 2020 2020 2076 6f6c 3020 3d20 6461         vol0 = da
+000268f0: 7461 2e69 6c6f 635b 305d 5b22 566f 6c75  ta.iloc[0]["Volu
+00026900: 6d65 225d 0a20 2020 2020 2020 2020 2020  me"].           
+00026910: 2020 2020 2020 2020 2073 6176 6564 203d           saved =
+00026920: 2073 656c 662e 6669 6e64 4375 7272 656e   self.findCurren
+00026930: 7453 6176 6564 5661 6c75 6528 7363 7265  tSavedValue(scre
+00026940: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
+00026950: 2c20 2250 6174 7465 726e 2229 0a20 2020  , "Pattern").   
+00026960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026970: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00026980: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+00026990: 7265 6164 3020 3e20 7370 7265 6164 310a  read0 > spread1.
+000269a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000269b0: 2020 2020 2020 2020 616e 6420 766f 6c30          and vol0
+000269c0: 203c 2076 6f6c 310a 2020 2020 2020 2020   < vol1.        
+000269d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000269e0: 616e 6420 6461 7461 2e69 6c6f 635b 305d  and data.iloc[0]
+000269f0: 5b22 566f 6c75 6d65 225d 203c 2064 6174  ["Volume"] < dat
+00026a00: 612e 696c 6f63 5b30 5d5b 2256 6f6c 4d41  a.iloc[0]["VolMA
+00026a10: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
+00026a20: 2020 2020 2020 2020 2020 2061 6e64 2064             and d
+00026a30: 6174 612e 696c 6f63 5b30 5d5b 2243 6c6f  ata.iloc[0]["Clo
+00026a40: 7365 225d 203c 3d20 6461 7461 2e69 6c6f  se"] <= data.ilo
+00026a50: 635b 315d 5b22 4f70 656e 225d 0a20 2020  c[1]["Open"].   
+00026a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026a70: 2020 2020 2061 6e64 2073 7072 6561 6430       and spread0
+00026a80: 203c 206c 6f77 6572 5f77 6963 6b5f 7370   < lower_wick_sp
+00026a90: 7265 6164 300a 2020 2020 2020 2020 2020  read0.          
+00026aa0: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00026ab0: 6420 6461 7461 2e69 6c6f 635b 305d 5b22  d data.iloc[0]["
+00026ac0: 566f 6c75 6d65 225d 203c 3d20 696e 7428  Volume"] <= int(
+00026ad0: 6461 7461 2e69 6c6f 635b 315d 5b22 566f  data.iloc[1]["Vo
+00026ae0: 6c75 6d65 225d 202a 2030 2e37 3529 0a20  lume"] * 0.75). 
+00026af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b00: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+00026b10: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+00026b20: 7265 656e 4469 6374 5b22 5061 7474 6572  reenDict["Patter
+00026b30: 6e22 5d20 3d20 280a 2020 2020 2020 2020  n"] = (.        
+00026b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b50: 2020 2020 7361 7665 645b 305d 200a 2020      saved[0] .  
+00026b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b70: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+00026b80: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
+00026b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ba0: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+00026bb0: 7874 2e47 5245 454e 0a20 2020 2020 2020  xt.GREEN.       
+00026bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026bd0: 2020 2020 202b 2022 5375 7070 6c79 2044       + "Supply D
+00026be0: 726f 7567 6874 220a 2020 2020 2020 2020  rought".        
+00026bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c00: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+00026c10: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+00026c20: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00026c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c40: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+00026c50: 5061 7474 6572 6e22 5d20 3d20 7361 7665  Pattern"] = save
+00026c60: 645b 315d 202b 2022 5375 7070 6c79 2044  d[1] + "Supply D
+00026c70: 726f 7567 6874 220a 2020 2020 2020 2020  rought".        
+00026c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c90: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+00026ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026cb0: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+00026cc0: 2020 2020 2020 2020 2020 2020 2073 7072               spr
+00026cd0: 6561 6430 203c 2073 7072 6561 6431 0a20  ead0 < spread1. 
+00026ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026cf0: 2020 2020 2020 2061 6e64 2076 6f6c 3020         and vol0 
+00026d00: 3e20 766f 6c31 0a20 2020 2020 2020 2020  > vol1.         
+00026d10: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00026d20: 6e64 2064 6174 612e 696c 6f63 5b30 5d5b  nd data.iloc[0][
+00026d30: 2256 6f6c 756d 6522 5d20 3e20 6461 7461  "Volume"] > data
+00026d40: 2e69 6c6f 635b 305d 5b22 566f 6c4d 4122  .iloc[0]["VolMA"
+00026d50: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00026d60: 2020 2020 2020 2020 2020 616e 6420 6461            and da
+00026d70: 7461 2e69 6c6f 635b 305d 5b22 436c 6f73  ta.iloc[0]["Clos
+00026d80: 6522 5d20 3c3d 2064 6174 612e 696c 6f63  e"] <= data.iloc
+00026d90: 5b31 5d5b 224f 7065 6e22 5d0a 2020 2020  [1]["Open"].    
+00026da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026db0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00026dc0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+00026dd0: 6e44 6963 745b 2250 6174 7465 726e 225d  nDict["Pattern"]
+00026de0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00026df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026e00: 2073 6176 6564 5b30 5d20 0a20 2020 2020   saved[0] .     
+00026e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026e20: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+00026e30: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
+00026e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026e50: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+00026e60: 4752 4545 4e0a 2020 2020 2020 2020 2020  GREEN.          
+00026e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026e80: 2020 2b20 2244 656d 616e 6420 5269 7365    + "Demand Rise
+00026e90: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00026ea0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00026eb0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+00026ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ed0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00026ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ef0: 7361 7665 4469 6374 5b22 5061 7474 6572  saveDict["Patter
+00026f00: 6e22 5d20 3d20 7361 7665 645b 315d 202b  n"] = saved[1] +
+00026f10: 2022 4465 6d61 6e64 2052 6973 6522 0a20   "Demand Rise". 
+00026f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026f30: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00026f40: 7565 0a20 2020 2020 2020 2020 2020 2065  ue.            e
+00026f50: 7863 6570 7420 496e 6465 7845 7272 6f72  xcept IndexError
+00026f60: 2061 7320 653a 2023 2070 7261 676d 613a   as e: # pragma:
+00026f70: 206e 6f20 636f 7665 720a 2020 2020 2020   no cover.      
+00026f80: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00026f90: 6566 6175 6c74 5f6c 6f67 6765 722e 6465  efault_logger.de
+00026fa0: 6275 6728 652c 2065 7863 5f69 6e66 6f3d  bug(e, exc_info=
+00026fb0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00026fc0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00026fd0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00026fe0: 6c73 650a 2020 2020 2020 2020 6578 6365  lse.        exce
+00026ff0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00027000: 653a 2020 2320 7072 6167 6d61 3a20 6e6f  e:  # pragma: no
+00027010: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
+00027020: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
+00027030: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
+00027040: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
+00027050: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00027060: 6e20 4661 6c73 650a                      n False.
```

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/StockScreener.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/StockScreener.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/UserMenuChoicesHandler.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/UserMenuChoicesHandler.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/Utility.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/Utility.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/WorkflowManager.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/WorkflowManager.py`

 * *Files 2% similar despite different names*

```diff
@@ -46,15 +46,15 @@
             + f"{user}"
             + '","params":"'
             + f"{options}"
             + '","name":"'
             + f"{command}"
             + '"}}'
         )
-    elif workflowType == "X" or workflowType == "G":
+    elif workflowType == "X" or workflowType == "G" or workflowType == "P":
         workflow_name = "w8-workflow-alert-scan_generic.yml"
         if user is None or len(user) == 0:
             user = ""
             data = (
                 '{"ref":"'
                 + branch
                 + '","inputs":{"user":"'
```

### Comparing `pkscreener-0.45.20240528.420/pkscreener/classes/keys.py` & `pkscreener-0.45.20240529.421/pkscreener/classes/keys.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/courbd.ttf` & `pkscreener-0.45.20240529.421/pkscreener/courbd.ttf`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/pkscreener/globals.py` & `pkscreener-0.45.20240529.421/pkscreener/globals.py`

 * *Files 1% similar despite different names*

```diff
@@ -622,15 +622,15 @@
     return indexOption, executeOption
 
 def labelDataForPrinting(screenResults, saveResults, configManager, volumeRatio,executeOption, reversalOption):
     # Publish to gSheet with https://github.com/burnash/gspread
     global menuChoiceHierarchy, userPassedArgs
     try:
         isTrading = PKDateUtilities.isTradingTime() and not PKDateUtilities.isTodayHoliday()[0]
-        if "RUNNER" not in os.environ.keys() and (isTrading or userPassedArgs.monitor or ("RSIi" in saveResults.columns)):
+        if "RUNNER" not in os.environ.keys() and (isTrading or userPassedArgs.monitor or ("RSIi" in saveResults.columns)) and configManager.calculatersiintraday:
             screenResults['RSI'] = screenResults['RSI'].astype(str) + "/" + screenResults['RSIi'].astype(str)
             saveResults['RSI'] = saveResults['RSI'].astype(str) + "/" + saveResults['RSIi'].astype(str)
             screenResults.rename(columns={"RSI": "RSI/i"},inplace=True)
             saveResults.rename(columns={"RSI": "RSI/i"},inplace=True)
         sortKey = ["Volume"] if "RSI" not in menuChoiceHierarchy else ("RSIi" if (isTrading or "RSIi" in saveResults.columns) else "RSI")
         ascending = [False if "RSI" not in menuChoiceHierarchy else True]
         if executeOption == 21:
@@ -778,16 +778,16 @@
     options, menuOption, indexOption, executeOption = getTopLevelMenuChoices(
         startupoptions, testBuild, downloadOnly, defaultAnswer=defaultAnswer
     )
     # Print Level 1 menu options
     selectedMenu = initExecution(menuOption=menuOption)
     menuOption = selectedMenu.menuKey
     if menuOption in ["M", "D", "I", "L"]:
-        launcher = sys.argv[0]
-        launcher = f"python3.11 {launcher}" if launcher.endswith(".py") else launcher
+        launcher = f'"{sys.argv[0]}"'
+        launcher = f"python3.11 {launcher}" if launcher.endswith(".py\"") else launcher
         if menuOption in ["M"]:
             OutputControls().printOutput(f"{colorText.GREEN}Launching PKScreener in monitoring mode. If it does not launch, please try with the following:{colorText.END}\n{colorText.FAIL}{launcher} -a Y -m 'X'{colorText.END}\n{colorText.WARN}Press Ctrl + C to exit monitoring mode.{colorText.END}")
             sleep(2)
             os.system(f"{launcher} -a Y -m 'X'")
         elif menuOption in ["D"]:
             OutputControls().printOutput(f"{colorText.GREEN}Launching PKScreener to Download daily OHLC data. If it does not launch, please try with the following:{colorText.END}\n{colorText.FAIL}{launcher} -a Y -e -d{colorText.END}\n{colorText.WARN}Press Ctrl + C to exit at any time.{colorText.END}")
             sleep(2)
@@ -798,40 +798,48 @@
             os.system(f"{launcher} -a Y -e -d -i 1m")
         elif menuOption in ["L"]:
             OutputControls().printOutput(f"{colorText.GREEN}Launching PKScreener to collect logs. If it does not launch, please try with the following:{colorText.END}\n{colorText.FAIL}{launcher} -a Y -l{colorText.END}\n{colorText.WARN}Press Ctrl + C to exit at any time.{colorText.END}")
             sleep(2)
             os.system(f"{launcher} -a Y -l")
         sys.exit(0)
     if menuOption in ["P"]:
+        predefinedOption = None
+        selPredefinedOption = None
+        if len(options) >= 3:
+            predefinedOption = str(options[1])
+            selPredefinedOption = str(options[2])
         updateMenuChoiceHierarchy()
         selectedMenu = m0.find(menuOption)
         m1.renderForMenu(selectedMenu)
-        predefinedOption = input(colorText.BOLD + colorText.FAIL + "[+] Select option: ") or "1"
+        if predefinedOption is None:
+            predefinedOption = input(colorText.BOLD + colorText.FAIL + "[+] Select option: ") or "1"
         OutputControls().printOutput(colorText.END, end="")
         if predefinedOption not in ["1","2","3"]:
             return None, None
         if predefinedOption == "1":
             updateMenuChoiceHierarchy()
             selectedMenu = m1.find(predefinedOption)
             m2.renderForMenu(selectedMenu=selectedMenu)
-            selPredefinedOption = input(colorText.BOLD + colorText.FAIL + "[+] Select option: ") or "1"
+            if selPredefinedOption is None:
+                selPredefinedOption = input(colorText.BOLD + colorText.FAIL + "[+] Select option: ") or "1"
             OutputControls().printOutput(colorText.END, end="")
             if selPredefinedOption in PREDEFINED_SCAN_MENU_KEYS:
                 scannerOption = PIPED_SCANNERS[selPredefinedOption]
                 updateMenuChoiceHierarchy()
                 if userPassedArgs.pipedmenus is not None:
                     chosenOptions = scannerOption.split("-o ")[1]
                     userPassedArgs.options = chosenOptions.replace("'","")
                     return addOrRunPipedMenus()
-                launcher = sys.argv[0]
-                launcher = f"python3.11 {launcher}" if launcher.endswith(".py") else launcher
+                launcher = f'"{sys.argv[0]}"'
+                launcher = f"python3.11 {launcher}" if launcher.endswith(".py\"") else launcher
                 scannerOptionQuoted = scannerOption.replace("'",'"')
-                OutputControls().printOutput(f"{colorText.GREEN}Launching PKScreener with piped scanners. If it does not launch, please try with the following:{colorText.END}\n{colorText.FAIL}{launcher} {scannerOptionQuoted}{colorText.END}")
+                requestingUser = f" -u {userPassedArgs.user}" if userPassedArgs.user is not None else ""
+                OutputControls().printOutput(f"{colorText.GREEN}Launching PKScreener with piped scanners. If it does not launch, please try with the following:{colorText.END}\n{colorText.FAIL}{launcher} {scannerOptionQuoted}{requestingUser}{colorText.END}")
                 sleep(2)
-                os.system(f"{launcher} {scannerOptionQuoted}")
+                os.system(f"{launcher} {scannerOptionQuoted}{requestingUser}")
                 OutputControls().printOutput(
                         colorText.GREEN
                         + f"[+] Finished running all piped scanners!"
                         + colorText.END
                     )
                 if defaultAnswer is None:
                     input("Press <Enter> to exit...")
@@ -1574,15 +1582,15 @@
                 runOption = PKScanRunner.getFormattedChoices(userPassedArgs,selectedChoice)
                 df = saveResults.copy()
                 df["LastTradeDate"], df["LastTradeTime"] = getLatestTradeDateTime(stockDictPrimary)
                 gClient.df_to_sheet(df=df,sheetName=runOption)
                 OutputControls().printOutput(f"{colorText.GREEN} => Done in {round(time.time()-begin,2)}s{colorText.END}")
     except:
         pass
-    if "RUNNER" not in os.environ.keys() and (userPassedArgs is None or (userPassedArgs is not None and (userPassedArgs.answerdefault is None or userPassedArgs.systemlaunched))):
+    if "RUNNER" not in os.environ.keys() and not testing and (userPassedArgs is None or (userPassedArgs is not None and userPassedArgs.user is None and (userPassedArgs.answerdefault is None or userPassedArgs.systemlaunched))):
         prevOutput_results = saveResults.index if (saveResults is not None and not saveResults.empty) else []
         hasFoundStocks = len(prevOutput_results) > 0 and (("|" not in userPassedArgs.options) if (userPassedArgs is not None and userPassedArgs.options is not None) else True)
         if hasFoundStocks:
             monitorOption = userPassedArgs.systemlaunched if (userPassedArgs is not None and isinstance(userPassedArgs.systemlaunched,str) and userPassedArgs.systemlaunched is not None) else (userPassedArgs.options if (userPassedArgs is not None and userPassedArgs.options is not None) else "")
             if len(monitorOption) == 0:
                 for choice in selectedChoice.keys():
                     monitorOption = (f"{monitorOption}:" if len(monitorOption) > 0  else '') + f"{selectedChoice[choice]}"
@@ -1592,16 +1600,16 @@
                 ) or 'M'
             OutputControls().printOutput(colorText.END, end="")
             if pinOption in ["1","2"]:
                 if pinOption in ["2"]:
                     monitorOption = "X:0:0"
                     prevOutput_results = ",".join(prevOutput_results)
                     monitorOption = f"{monitorOption}:{prevOutput_results}"
-                launcher = sys.argv[0]
-                launcher = f"python3.11 {launcher}" if launcher.endswith(".py") else launcher
+                launcher = f'"{sys.argv[0]}"'
+                launcher = f"python3.11 {launcher}" if launcher.endswith(".py\"") else launcher
                 monitorOption = f'"{monitorOption}"'
                 scannerOptionQuoted = monitorOption.replace("'",'"')
                 OutputControls().printOutput(f"{colorText.GREEN}Launching PKScreener with pinned scan option. If it does not launch, please try with the following:{colorText.END}\n{colorText.FAIL}{launcher} -a Y -m {scannerOptionQuoted}{colorText.END}")
                 sleep(2)
                 os.system(f"{launcher} -a Y -m {scannerOptionQuoted}")
 
     if userPassedArgs is not None:
@@ -1720,23 +1728,26 @@
     userPassedArgs.pipedmenus = f"{userPassedArgs.pipedmenus}{('i '+configManager.duration) if configManager.isIntradayConfig() else ''}"
     updateMenuChoiceHierarchy()
     OutputControls().printOutput(
             colorText.GREEN
             + f"[+] {len(userPassedArgs.pipedmenus.split('|'))} Scanners piped so far: {colorText.END}{colorText.WARN+userPassedArgs.pipedmenus+colorText.END}\n{colorText.GREEN}[+] Do you want to add any more scanners into the pipe?"
             + colorText.END
         )
-    shouldAddMoreIntoPipe = input(colorText.FAIL + "[+] Select [Y/N] (Default:N): " + colorText.END) or 'n'
+    shouldAddMoreIntoPipe = 'n'
+    if userPassedArgs is None or (userPassedArgs is not None and userPassedArgs.answerdefault is None):
+        shouldAddMoreIntoPipe = input(colorText.FAIL + "[+] Select [Y/N] (Default:N): " + colorText.END) or 'n'
     if shouldAddMoreIntoPipe.lower() != 'y':
-        launcher = sys.argv[0]
-        launcher = f"python3.11 {launcher}" if launcher.endswith(".py") else launcher
+        launcher = f'"{sys.argv[0]}"'
+        launcher = f"python3.11 {launcher}" if launcher.endswith(".py\"") else launcher
         monitorOption = f'"{userPassedArgs.pipedmenus}"'
         scannerOptionQuoted = monitorOption.replace("'",'"').replace(":>",":D:D:D:>").replace("::",":")
-        OutputControls().printOutput(f"{colorText.GREEN}Launching PKScreener with piped scanners. If it does not launch, please try with the following:{colorText.END}\n{colorText.FAIL}{launcher} -a Y -e -o {scannerOptionQuoted}{colorText.END}")
+        requestingUser = f" -u {userPassedArgs.user}" if userPassedArgs.user is not None else ""
+        OutputControls().printOutput(f"{colorText.GREEN}Launching PKScreener with piped scanners. If it does not launch, please try with the following:{colorText.END}\n{colorText.FAIL}{launcher} -a Y -e -o {scannerOptionQuoted}{requestingUser}{colorText.END}")
         sleep(2)
-        os.system(f"{launcher} --systemlaunched -a Y -e -o {scannerOptionQuoted}")
+        os.system(f"{launcher} --systemlaunched -a Y -e -o {scannerOptionQuoted}{requestingUser}")
         userPassedArgs.pipedmenus = None
         OutputControls().printOutput(
                 colorText.GREEN
                 + f"[+] Finished running all piped scanners!"
                 + colorText.END
             )
         if defaultAnswer is None:
@@ -2227,15 +2238,16 @@
         Utility.tools.setLastScreenedResults(screenResults, saveResults, f"{PKScanRunner.getFormattedChoices(userPassedArgs,selectedChoice)}_{recordDate if recordDate is not None else ''}")
 
 def prepareGrowthOf10kResults(saveResults, selectedChoice, menuChoiceHierarchy, testing, user, pngName, pngExtension, eligible):
     targetDateG10k = None
     if selectedChoice["0"] == "G" or \
         (userPassedArgs.backtestdaysago is not None and 
          int(userPassedArgs.backtestdaysago) > 0 and 
-         "RUNNER" not in os.environ.keys()):
+         "RUNNER" not in os.environ.keys() and
+         configManager.enablePortfolioCalculations):
         if saveResults is not None and len(saveResults) > 0:
             df = PortfolioXRay.performXRay(saveResults, userPassedArgs,None, None)
             targetDateG10k = saveResults["Date"].iloc[0]
             if df is not None and len(df) > 0:
                 titleLabelG10k = f"For {userPassedArgs.backtestdaysago}-Period(s) from {targetDateG10k}, portfolio calculations in terms of Growth of 10k:"
                 g10kStyledTable = colorText.miniTabulator().tabulate(
                     df,
@@ -2680,15 +2692,17 @@
                     if os.path.exists(log_file_path):
                         sendMessageToTelegramChannel(caption=message,document_filePath=log_file_path, user="-1001785195297")
                     else:
                         sendMessageToTelegramChannel(message=message,user="-1001785195297")
                 except:
                     pass
                 # Let's try again with logging
-                os.system(f"{sys.argv[0]} -a Y -e -l -d {'-i 1m' if configManager.isIntradayConfig() else ''}")
+                launcher = f'"{sys.argv[0]}"'
+                launcher = f"python3.11 {launcher}" if launcher.endswith(".py\"") else launcher
+                os.system(f"{launcher} -a Y -e -l -d {'-i 1m' if configManager.isIntradayConfig() else ''}")
     else:
         OutputControls().printOutput(colorText.BOLD + colorText.GREEN + "[+] Skipped Saving!" + colorText.END)
 
 
 def saveNotifyResultsFile(
     screenResults, saveResults, defaultAnswer, menuChoiceHierarchy, user=None
 ):
```

### Comparing `pkscreener-0.45.20240528.420/pkscreener/pkscreener.ini` & `pkscreener-0.45.20240529.421/pkscreener/pkscreener.ini`

 * *Files 13% similar despite different names*

```diff
@@ -22,14 +22,15 @@
 morninganalysiscandleduration = 1m
 onlystagetwostocks = y
 period = 1y
 showpaststrategydata = n
 showunknowntrends = y
 shuffle = y
 useema = n
+vcpvolumecontractionratio = 0.4
 
 [filters]
 consolidationpercentage = 10.0
 maxprice = 50000.0
 minimumchangepercentage = 0.0
 minimumvolume = 10000
 minprice = 20.0
```

### Comparing `pkscreener-0.45.20240528.420/pkscreener/pkscreenerbot.py` & `pkscreener-0.45.20240529.421/pkscreener/pkscreenerbot.py`

 * *Files 11% similar despite different names*

```diff
@@ -109,30 +109,33 @@
 # Callback data
 ONE, TWO, THREE, FOUR = range(4)
 
 m0 = menus()
 m1 = menus()
 m2 = menus()
 m3 = menus()
+m4 = menus()
 int_timer = None
 
-TOP_LEVEL_SCANNER_MENUS = ["X", "B", "MI","DV"]
-TOP_LEVEL_SCANNER_SKIP_MENUS = ["M", "S", "G", "C", "P", "T", "D", "I", "E", "U", "L", "Z"]
+TOP_LEVEL_SCANNER_MENUS = ["X", "B", "MI","DV", "P"]
+TOP_LEVEL_SCANNER_SKIP_MENUS = ["M", "S", "G", "C", "T", "D", "I", "E", "U", "L", "Z", "P"]
 INDEX_SKIP_MENUS = ["W","E","M","Z","0","2","3","4","6","7","9","10","13"]
 SCANNER_SKIP_MENUS_1_TO_6 = ["0","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","42","M","Z"]
 SCANNER_SKIP_MENUS_7_TO_12 = ["0","1","2","3","4","5","6","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","42","M","Z"]
 SCANNER_SKIP_MENUS_13_TO_18 = ["0","1","2","3","4","5","6","7","8","9","10","11","12","19","20","21","22","23","24","25","26","27","28","29","30","31","32","42","M","Z"]
 SCANNER_SKIP_MENUS_19_TO_25 = ["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","22","26","27","28","29","30","31","32","42","M","Z"]
 SCANNER_SKIP_MENUS_26_TO_31 = ["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","32","42","M","Z"]
 SCANNER_MENUS_WITH_NO_SUBMENUS = ["1","2","3","10","11","12","13","14","15","16","17","18","19","20","21","23","24","25","26","27","28","29","30","31","32"]
 SCANNER_MENUS_WITH_SUBMENU_SUPPORT = ["6", "7", "21"]
+SCANNER_SUBMENUS_CHILDLEVEL_SUPPORT = {"6":[ "7","10"], "7":[ "3","6","9"]}
 
 INDEX_COMMANDS_SKIP_MENUS_SCANNER = ["W", "E", "M", "Z"]
 INDEX_COMMANDS_SKIP_MENUS_BACKTEST = ["W", "E", "M", "Z", "N", "0", "15"]
-UNSUPPORTED_COMMAND_MENUS =["22","42","M","Z"]
+PIPED_SCAN_SKIP_COMMAND_MENUS =["2", "3", "M", "0"]
+UNSUPPORTED_COMMAND_MENUS =["22","42","M","Z","0"]
 SUPPORTED_COMMAND_MENUS = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32"]
 
 def initializeIntradayTimer():
     try:
         if (not PKDateUtilities.isTodayHoliday()[0]):
             now = PKDateUtilities.currentDateTime()
             marketStartTime = PKDateUtilities.currentDateTime(simulate=True,hour=9,minute=14)
@@ -187,26 +190,32 @@
                         callback_data="C" + str(mnu.menuKey),
                     )
                 )
         keyboard = [inlineMenus]
         reply_markup = InlineKeyboardMarkup(keyboard)
         cmds = m0.renderForMenu(
             selectedMenu=None,
-            skip=TOP_LEVEL_SCANNER_SKIP_MENUS,
+            skip=TOP_LEVEL_SCANNER_SKIP_MENUS[:len(TOP_LEVEL_SCANNER_SKIP_MENUS)-1],
             asList=True,
             renderStyle=MenuRenderStyle.STANDALONE,
         )
     else:
         reply_markup = None
 
     if updatedResults is None:
         cmdText = ""
         for cmd in cmds:
             cmdText = f"{cmdText}\n\n{cmd.commandTextKey()} for {cmd.commandTextLabel()}"
         menuText = f"Welcome {user.first_name}, {(user.username)}! Please choose a menu option by selecting a button from below.\n\nYou can also explore a wide variety of all other scanners by typing in \n{cmdText}\n\n OR just use the buttons below to choose."
+        try:
+            if updateCarrier is not None and updateCarrier.data is not None and updateCarrier.data == "CP":
+                menuText = f"Piped Scanners are available using /P . Click on this /P to begin using piped scanners. To use other scanners, choose a menu option by selecting a button from below.\n\nYou can also explore a wide variety of all other scanners by typing in \n{cmdText}\n\n OR just use the buttons below to choose."
+        except:
+            pass
+        menuText = f"{menuText}\n\nClick /start if you want to restart the session."
     else:
         chosenBotMenuOption = f"{chosenBotMenuOption}\nInt. Monitor. MonitorIndex:{monitorIndex}\n{updatedResults}"
         menuText = updatedResults
     # Send message with text and appended InlineKeyboard
     if update.callback_query is not None:
         await sendUpdatedMenu(
             menuText=menuText, update=update, context=context, reply_markup=reply_markup, replaceWhiteSpaces=(updatedResults is None)
@@ -316,14 +325,17 @@
             resp = run_workflow(None, None,None, workflowType="R")
             await start(update, context,chosenBotMenuOption=f"{resp.status_code}: {resp.text}")
     return START_ROUTES
 
 async def XScanners(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
     """Show new choice of buttons"""
     query = update.callback_query
+    if query is None:
+        await start(update, context)
+        return START_ROUTES
     data = query.data.upper().replace("CX", "X").replace("CB", "B").replace("CG", "G").replace("CMI", "MI")
     if data[0:2] not in TOP_LEVEL_SCANNER_MENUS:
         return start(update, context)
     global bot_available
     if not bot_available:
         await start(update, context)
         return START_ROUTES
@@ -378,15 +390,15 @@
                 mnu.menuKey, callback_data=str(f"{query.data}_{mnu.menuKey}")
             )
         )
     keyboard = [inlineMenus]
     reply_markup = InlineKeyboardMarkup(keyboard)
     if query.message.text == menuText:
         menuText = f"{PKDateUtilities.currentDateTime()}:\n{menuText}"
-    menuText = f"{menuText}\nClick /start if you want to restart the session."
+    menuText = f"{menuText}\n\nClick /start if you want to restart the session."
     await query.edit_message_text(text=menuText, reply_markup=reply_markup)
     return START_ROUTES
 
 
 async def Level2(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
     """Show new choice of buttons"""
     inlineMenus = []
@@ -553,14 +565,15 @@
             await context.bot.send_message(
                 chat_id=int(f"-{Channel_Id}"),
                 text=f"Name: <b>{query.from_user.first_name}</b>, Username:@{query.from_user.username} with ID: <b>@{str(query.from_user.id)}</b> submitted scan request <b>{optionChoices}</b> to the bot!",
                 parse_mode=ParseMode.HTML,
             )
     except Exception:# pragma: no cover
         await start(update, context)
+    menuText =  menuText.replace("\n     ","\n").replace("\n    ","\n").replace(colorText.FAIL,"").replace(colorText.END,"")
     if not str(optionChoices.upper()).startswith("B"):
         await sendUpdatedMenu(
             menuText=menuText, update=update, context=context, reply_markup=reply_markup
         )
     return START_ROUTES
 
 def default_markup(inlineMenus):
@@ -577,15 +590,15 @@
     reply_markup = InlineKeyboardMarkup(keyboard)
     return reply_markup
 
 
 async def sendUpdatedMenu(menuText, update: Update, context, reply_markup, replaceWhiteSpaces=True):
     try:
         menuText.replace("     ", "").replace("    ", "").replace("\t", "").replace(colorText.FAIL,"").replace(colorText.END,"") if replaceWhiteSpaces else menuText
-        menuText = f"{menuText}\nClick /start if you want to restart the session."
+        menuText = f"{menuText}\n\nClick /start if you want to restart the session." if "/start" not in menuText else menuText
         if update.callback_query.message.text == menuText:
             menuText = f"{PKDateUtilities.currentDateTime()}:\n{menuText}"
         await update.callback_query.edit_message_text(
             text=menuText,
             parse_mode="HTML",
             reply_markup=reply_markup,
         )
@@ -605,24 +618,24 @@
             responseText = f"Thank you for choosing {optionChoices}!\n\nHere are the results:\n\nInsights: https://pkjmesra.github.io/PKScreener/Backtest-Reports/PKScreener_{optionChoices}_Insights_DateSorted.html"
             responseText = f"{responseText}\n\nSummary: https://pkjmesra.github.io/PKScreener/Backtest-Reports/PKScreener_{optionChoices}_Summary_StockSorted.html"
             responseText = f"{responseText}\n\nStock-wise: https://pkjmesra.github.io/PKScreener/Backtest-Reports/PKScreener_{optionChoices}_backtest_result_StockSorted.html"
             responseText = f"{responseText}\n\nOther Reports: https://pkjmesra.github.io/PKScreener/BacktestReports.html"
             if update is not None and update.message is not None:
                 await update.message.reply_text(responseText)
             else:
-                responseText = f"{responseText}\nClick /start if you want to restart the session."
+                responseText = f"{responseText}\n\nClick /start if you want to restart the session."
                 await update.callback_query.edit_message_text(
                     text=responseText,
                     reply_markup=default_markup([]),
                 )
             await shareUpdateWithChannel(
                 update=update, context=context, optionChoices=optionChoices
             )
             # run_workflow(optionChoices, str(user.id), str(options.upper()))
-        elif str(optionChoices.upper()).startswith("X"):
+        elif str(optionChoices.upper()).startswith("X") or str(optionChoices.upper()).startswith("P"):
             optionChoices = optionChoices.replace(" ", "").replace(">", "_")
             while optionChoices.endswith("_"):
                 optionChoices = optionChoices[:-1]
             run_workflow(
                 optionChoices, str(user.id), str(options.upper()), workflowType="X"
             )
         elif str(optionChoices.upper()).startswith("G"):
@@ -661,30 +674,30 @@
         [
             InlineKeyboardButton("Try Scanners", callback_data=str("CX")),
             # InlineKeyboardButton("Growth of 10k", callback_data=str("CG")),
         ]
     ]
     reply_markup = InlineKeyboardMarkup(keyboard)
     responseText = "Backtesting NOT implemented yet in this Bot!\n\n\nYou can use backtesting by downloading the software from https://github.com/pkjmesra/PKScreener/"
-    responseText = f"{responseText}\nClick /start if you want to restart the session."
+    responseText = f"{responseText}\n\nClick /start if you want to restart the session."
     await query.edit_message_text(
         text=responseText,
         reply_markup=reply_markup,
     )
     return START_ROUTES
 
 
 async def end(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
     """Returns `ConversationHandler.END`, which tells the
     ConversationHandler that the conversation is over.
     """
     query = update.callback_query
     await query.answer()
     responseText = "See https://github.com/pkjmesra/PKScreener/ for more details or join https://t.me/PKScreener. \n\n\nSee you next time!"
-    responseText = f"{responseText}\nClick /start if you want to restart the session."
+    responseText = f"{responseText}\n\nClick /start if you want to restart the session."
     await query.edit_message_text(
         text=responseText
     )
     return ConversationHandler.END
 
 
 # This can be your own ID, or one for a developer group/channel.
@@ -784,34 +797,36 @@
     if cmd == "help":
         await help_command(update=update, context=context)
         return START_ROUTES
     if cmd.upper() in TOP_LEVEL_SCANNER_MENUS:
         await shareUpdateWithChannel(update=update, context=context)
         m0.renderForMenu(
             selectedMenu=None,
-            skip=TOP_LEVEL_SCANNER_SKIP_MENUS,
+            skip=TOP_LEVEL_SCANNER_SKIP_MENUS[:len(TOP_LEVEL_SCANNER_SKIP_MENUS)-1],
+            asList=True,
             renderStyle=MenuRenderStyle.STANDALONE,
         )
         selectedMenu = m0.find(cmd.upper())
         cmdText = ""
         cmds = m1.renderForMenu(
             selectedMenu=selectedMenu,
-            skip=(INDEX_COMMANDS_SKIP_MENUS_SCANNER  if cmd in ["x"] else INDEX_COMMANDS_SKIP_MENUS_BACKTEST),
+            skip=(INDEX_COMMANDS_SKIP_MENUS_SCANNER  if cmd in ["x"] else (INDEX_COMMANDS_SKIP_MENUS_BACKTEST if cmd in ["b"] else PIPED_SCAN_SKIP_COMMAND_MENUS)),
             asList=True,
             renderStyle=MenuRenderStyle.STANDALONE,
         )
         for cmd in cmds:
             if cmd in ["N", "0"]:
                 continue
             cmdText = (
                 f"{cmdText}\n\n{cmd.commandTextKey()} for {cmd.commandTextLabel()}"
             )
         if cmd in ["x"]:
             cmdText = f"{cmdText}\n\nFor option 0 <Screen stocks by the stock name>, please type in the command in the following format\n/X_0 SBIN\n or \n/X_0_0 SBIN\nand hit send where SBIN is the NSE stock code.For multiple stocks, you can type in \n/X_0 SBIN,ICICIBANK,OtherStocks\nYou can put in any number of stocks separated by space or comma(,)."
         """Send a message when the command /help is issued."""
+        cmdText = f"{cmdText}\n\nClick /start if you want to restart the session."
         await update.message.reply_text(f"Choose an option:\n{cmdText}")
         return START_ROUTES
 
     if update.message is None:
         await help_command(update=update, context=context)
         return START_ROUTES
     if "x_0" in cmd or "x_0_0" in cmd or "b_0" in cmd or "g_0" in cmd:
@@ -836,24 +851,70 @@
             )
             await sendRequestSubmitted(cmd.upper(), update=update, context=context)
             return START_ROUTES
         else:
             if cmd in ["x"]:
                 cmdText = "For option 0 <Screen stocks by the stock name>, please type in the command in the following format\n/X_0 SBIN or /X_0_0 SBIN and hit send where SBIN is the NSE stock code.For multiple stocks, you can type in /X_0 SBIN,ICICIBANK,OtherStocks . You can put in any number of stocks separated by space or comma(,)."
             """Send a message when the command /help is issued."""
+            cmdText = f"{cmdText}\n\nClick /start if you want to restart the session."
             await update.message.reply_text(f"Choose an option:\n{cmdText}")
             return START_ROUTES
 
+    if "p_" in cmd:
+        await shareUpdateWithChannel(update=update, context=context)
+        selection = cmd.split("_")
+        if len(selection) == 2:
+            m0.renderForMenu(
+                selectedMenu=None,
+                skip=TOP_LEVEL_SCANNER_SKIP_MENUS[:len(TOP_LEVEL_SCANNER_SKIP_MENUS)-1],
+                asList=True,
+                renderStyle=MenuRenderStyle.STANDALONE,
+            )
+            selectedMenu = m0.find(selection[0].upper())
+            m1.renderForMenu(
+                selectedMenu=selectedMenu,
+                skip=PIPED_SCAN_SKIP_COMMAND_MENUS,
+                asList=True,
+                renderStyle=MenuRenderStyle.STANDALONE,
+            )
+            selectedMenu = m1.find(selection[1].upper())
+            cmds = m2.renderForMenu(
+                selectedMenu=selectedMenu,
+                skip=UNSUPPORTED_COMMAND_MENUS,
+                asList=True,
+                renderStyle=MenuRenderStyle.STANDALONE,
+            )
+            cmdText = ""
+            for cmd in cmds:
+                cmdText = (
+                    f"{cmdText}\n\n{cmd.commandTextKey()} for {cmd.commandTextLabel()}"
+                )
+            cmdText = f"{cmdText}\n\nClick /start if you want to restart the session."
+            await update.message.reply_text(f"Choose an option:\n{cmdText}")
+            return START_ROUTES
+        elif len(selection) == 3:
+            options = ":".join(selection)
+            await launchScreener(
+                options=options,
+                user=update.message.from_user,
+                context=context,
+                optionChoices=cmd.upper(),
+                update=update,
+            )
+            await sendRequestSubmitted(cmd.upper(), update=update, context=context)
+            return START_ROUTES
+        
     if "x_" in cmd or "b_" in cmd or "g_" in cmd:
         await shareUpdateWithChannel(update=update, context=context)
         selection = cmd.split("_")
         if len(selection) == 2:
             m0.renderForMenu(
                 selectedMenu=None,
                 skip=TOP_LEVEL_SCANNER_SKIP_MENUS,
+                asList=True,
                 renderStyle=MenuRenderStyle.STANDALONE,
             )
             selectedMenu = m0.find(selection[0].upper())
             m1.renderForMenu(
                 selectedMenu=selectedMenu,
                 skip=(
                     INDEX_COMMANDS_SKIP_MENUS_SCANNER
@@ -876,33 +937,36 @@
                 await sendRequestSubmitted(cmd.upper(), update=update, context=context)
                 return START_ROUTES
             elif (
                 "x_" in cmd and selectedMenu.menuKey == "0"
             ):  # a specific stock by name
                 cmdText = "For option 0 <Screen stocks by the stock name>, please type in the command in the following format\n/X_0 SBIN or /X_0_0 SBIN and hit send where SBIN is the NSE stock code.For multiple stocks, you can type in /X_0 SBIN,ICICIBANK,OtherStocks. You can put in any number of stocks separated by space or comma(,)."
                 """Send a message when the command /help is issued."""
+                cmdText = f"{cmdText}\n\nClick /start if you want to restart the session."
                 await update.message.reply_text(f"Choose an option:\n{cmdText}")
                 return START_ROUTES
             cmds = m2.renderForMenu(
                 selectedMenu=selectedMenu,
                 skip=UNSUPPORTED_COMMAND_MENUS,
                 asList=True,
                 renderStyle=MenuRenderStyle.STANDALONE,
             )
             cmdText = ""
             for cmd in cmds:
                 cmdText = (
                     f"{cmdText}\n\n{cmd.commandTextKey()} for {cmd.commandTextLabel()}"
                 )
+            cmdText = f"{cmdText}\n\nClick /start if you want to restart the session."
             await update.message.reply_text(f"Choose an option:\n{cmdText}")
             return START_ROUTES
         elif len(selection) == 3:
             m0.renderForMenu(
                 selectedMenu=None,
                 skip=TOP_LEVEL_SCANNER_SKIP_MENUS,
+                asList=True,
                 renderStyle=MenuRenderStyle.STANDALONE,
             )
             selectedMenu = m0.find(selection[0].upper())
             m1.renderForMenu(
                 selectedMenu=selectedMenu,
                 skip=(
                     INDEX_COMMANDS_SKIP_MENUS_SCANNER
@@ -926,28 +990,77 @@
                     asList=True,
                     renderStyle=MenuRenderStyle.STANDALONE,
                     skip=["0"],
                 )
                 cmdText = ""
                 for cmd in cmds:
                     cmdText = f"{cmdText}\n\n{cmd.commandTextKey()} for {cmd.commandTextLabel()}"
+                cmdText = f"{cmdText}\n\nClick /start if you want to restart the session."
                 await update.message.reply_text(f"Choose an option:\n{cmdText}")
                 return START_ROUTES
             else:
                 if selection[2] == "4":  # Last N days
                     selection.extend(["D", ""])
                 elif selection[2] == "5":  # RSI range
                     selection.extend(["D", "D"])
                 elif selection[2] == "8":  # CCI range
                     selection.extend(["D", "D"])
                 elif selection[2] == "9":  # Vol gainer ratio
                     selection.extend(["D", ""])
                 elif selection[2] in SUPPORTED_COMMAND_MENUS:
                     selection.extend(["", ""])
         if len(selection) >= 4:
+            if len(selection) == 4:
+                if selection[2] in SCANNER_SUBMENUS_CHILDLEVEL_SUPPORT.keys() and selection[3] in SCANNER_SUBMENUS_CHILDLEVEL_SUPPORT[selection[2]]:
+                    m0.renderForMenu(
+                        selectedMenu=None,
+                        skip=TOP_LEVEL_SCANNER_SKIP_MENUS,
+                        asList=True,
+                        renderStyle=MenuRenderStyle.STANDALONE,
+                    )
+                    selectedMenu = m0.find(selection[0].upper())
+                    m1.renderForMenu(
+                        selectedMenu=selectedMenu,
+                        skip=(
+                            INDEX_COMMANDS_SKIP_MENUS_SCANNER
+                            if "x_" in cmd
+                            else INDEX_COMMANDS_SKIP_MENUS_BACKTEST
+                        ),
+                        asList=True,
+                        renderStyle=MenuRenderStyle.STANDALONE,
+                    )
+                    selectedMenu = m1.find(selection[1].upper())
+                    m2.renderForMenu(
+                        selectedMenu=selectedMenu,
+                        skip=UNSUPPORTED_COMMAND_MENUS,
+                        asList=True,
+                        renderStyle=MenuRenderStyle.STANDALONE,
+                    )
+                    if selection[2] in SCANNER_MENUS_WITH_SUBMENU_SUPPORT:
+                        selectedMenu = m2.find(selection[2].upper())
+                        m3.renderForMenu(
+                            selectedMenu=selectedMenu,
+                            skip=["0"],
+                            asList=True,
+                            renderStyle=MenuRenderStyle.STANDALONE,
+                        )
+                        selectedMenu = m3.find(selection[3].upper())
+                        cmds = m4.renderForMenu(
+                            selectedMenu=selectedMenu,
+                            asList=True,
+                            renderStyle=MenuRenderStyle.STANDALONE,
+                            skip=["0"],
+                        )
+                        cmdText = ""
+                        for cmd in cmds:
+                            cmdText = f"{cmdText}\n\n{cmd.commandTextKey()} for {cmd.commandTextLabel()}"
+                        cmdText = f"{cmdText}\n\nClick /start if you want to restart the session."
+                        await update.message.reply_text(f"Choose an option:\n{cmdText}")
+                        return START_ROUTES
+
             options = ":".join(selection)
             await launchScreener(
                 options=options,
                 user=update.message.from_user,
                 context=context,
                 optionChoices=cmd.upper(),
                 update=update,
@@ -995,15 +1108,15 @@
         return
     global bot_available
     if not bot_available:
         await start(update, context)
         return START_ROUTES
     cmds = m0.renderForMenu(
         selectedMenu=None,
-        skip=TOP_LEVEL_SCANNER_SKIP_MENUS,
+        skip=TOP_LEVEL_SCANNER_SKIP_MENUS[:len(TOP_LEVEL_SCANNER_SKIP_MENUS)-1],
         asList=True,
         renderStyle=MenuRenderStyle.STANDALONE,
     )
     cmdText = ""
     for cmd in cmds:
         cmdText = f"{cmdText}\n\n{cmd.commandTextKey()} for {cmd.commandTextLabel()}"
     reply_markup = default_markup([])
@@ -1051,26 +1164,26 @@
         return True
     return False
 
 
 def addCommandsForMenuItems(application):
     cmds0 = m0.renderForMenu(
         selectedMenu=None,
-        skip=TOP_LEVEL_SCANNER_SKIP_MENUS,
+        skip=TOP_LEVEL_SCANNER_SKIP_MENUS[:len(TOP_LEVEL_SCANNER_SKIP_MENUS)-1],
         asList=True,
         renderStyle=MenuRenderStyle.STANDALONE,
     )
     for mnu0 in cmds0:
         p0 = mnu0.menuKey.upper()
         application.add_handler(CommandHandler(p0, command_handler))
         selectedMenu = m0.find(p0)
         cmds1 = m1.renderForMenu(
             selectedMenu=selectedMenu,
             skip=(
-                INDEX_COMMANDS_SKIP_MENUS_SCANNER if p0 == "X" else INDEX_COMMANDS_SKIP_MENUS_BACKTEST
+                INDEX_COMMANDS_SKIP_MENUS_SCANNER if p0 == "X" else (INDEX_COMMANDS_SKIP_MENUS_BACKTEST if p0 == "B" else PIPED_SCAN_SKIP_COMMAND_MENUS)
             ),
             asList=True,
             renderStyle=MenuRenderStyle.STANDALONE,
         )
         for mnu1 in cmds1:
             p1 = mnu1.menuKey.upper()
             if p1 in ["N", "0"]:
@@ -1088,27 +1201,40 @@
                 renderStyle=MenuRenderStyle.STANDALONE,
             )
             for mnu2 in cmds2:
                 p2 = mnu2.menuKey.upper()
                 application.add_handler(
                     CommandHandler(f"{p0}_{p1}_{p2}", command_handler)
                 )
-                if p2 in SCANNER_MENUS_WITH_SUBMENU_SUPPORT:
+                if (p2 in SCANNER_MENUS_WITH_SUBMENU_SUPPORT and p0 in ["X", "B"]):
                     selectedMenu = m2.find(p2)
                     cmds3 = m3.renderForMenu(
                         selectedMenu=selectedMenu,
                         asList=True,
                         renderStyle=MenuRenderStyle.STANDALONE,
                         skip=["0"],
                     )
                     for mnu3 in cmds3:
                         p3 = mnu3.menuKey.upper()
                         application.add_handler(
                             CommandHandler(f"{p0}_{p1}_{p2}_{p3}", command_handler)
                         )
+                        if p2 in SCANNER_SUBMENUS_CHILDLEVEL_SUPPORT.keys() and p3 in SCANNER_SUBMENUS_CHILDLEVEL_SUPPORT[p2]:
+                            selectedMenu = m3.find(p3)
+                            cmds4 = m4.renderForMenu(
+                                selectedMenu=selectedMenu,
+                                asList=True,
+                                renderStyle=MenuRenderStyle.STANDALONE,
+                                skip=["0"],
+                            )
+                            for mnu4 in cmds4:
+                                p4 = mnu4.menuKey.upper()
+                                application.add_handler(
+                                    CommandHandler(f"{p0}_{p1}_{p2}_{p3}_{p4}", command_handler)
+                                )
 
 # def send_stuff(context: CallbackContext):
 #   job = context.job
 
 #   keyboard = [ 
 #     [   
 #         InlineKeyboardButton("NEVER", callback_data="NEVER"),
@@ -1174,14 +1300,15 @@
                 CallbackQueryHandler(XScanners, pattern="^" + str("CX") + "$"),
                 CallbackQueryHandler(XScanners, pattern="^" + str("CB") + "$"),
                 CallbackQueryHandler(XScanners, pattern="^" + str("CMI_")),
                 CallbackQueryHandler(XDevModeHandler, pattern="^" + str("CDV_")),
                 # CallbackQueryHandler(XScanners, pattern="^" + str("CG") + "$"),
                 CallbackQueryHandler(Level2, pattern="^" + str("CX_")),
                 CallbackQueryHandler(Level2, pattern="^" + str("CB_")),
+                CallbackQueryHandler(Level2, pattern="^" + str("CP_")),
                 # CallbackQueryHandler(Level2, pattern="^" + str("CG_")),
                 CallbackQueryHandler(end, pattern="^" + str("CZ") + "$"),
                 CallbackQueryHandler(start, pattern="^"),
             ],
             END_ROUTES: [],
         },
         fallbacks=[CommandHandler("start", start)],
```

### Comparing `pkscreener-0.45.20240528.420/pkscreener/pkscreenercli.py` & `pkscreener-0.45.20240529.421/pkscreener/pkscreenercli.py`

 * *Files 5% similar despite different names*

```diff
@@ -101,186 +101,187 @@
             sys.__stdout__.close()
         except Exception as e:# pragma: no cover
             default_logger().debug(e, exc_info=True)
             pass
         sys.stdout = originalStdOut
         sys.__stdout__ = original__stdout
 
-# Argument Parsing for test purpose
-argParser = argparse.ArgumentParser()
-argParser.add_argument(
-    "-a",
-    "--answerdefault",
-    help="Pass default answer to questions/choices in the application. Example Y, N",
-    required=False,
-)
-argParser.add_argument(
-    "--backtestdaysago",
-    help="Run scanner for -b days ago from today.",
-    required=False,
-)
-argParser.add_argument(
-    "--barometer",
-    action="store_true",
-    help="Send global market barometer to telegram channel or a user",
-    required=False,
-)
-argParser.add_argument(
-    "--bot",
-    action="store_true",
-    help="Run only in telegram bot mode",
-    required=False,
-)
-argParser.add_argument(
-    "--botavailable",
-    action="store_true",
-    help="Enforce whether bot is going to be available or not.",
-    required=False,
-)
-argParser.add_argument(
-    "-c",
-    "--croninterval",
-    help="Pass interval in seconds to wait before the program is run again with same parameters",
-    required=False,
-)
-argParser.add_argument(
-    "-d",
-    "--download",
-    action="store_true",
-    help="Only download Stock data in .pkl file (No analysis will be run)",
-    required=False,
-)
-argParser.add_argument(
-    "-e",
-    "--exit",
-    action="store_true",
-    help="Exit right after executing just once",
-    required=False,
-)
-argParser.add_argument(
-    "--forceBacktestsForZeroResultDays",
-    help="Force run the backtests even for those days when we already have zero results saved in the repo",
-    action=argparse.BooleanOptionalAction,
-)
-argParser.add_argument(
-    "-i",
-    "--intraday",
-    help="Use Intraday configurations and use the candlestick duration that is passed. Acceptable values 1m, 5m, 10m, 15m, 1h etc.",
-    required=False,
-)
-argParser.add_argument(
-    "-m",
-    "--monitor",
-    help="Monitor for intraday scanners and their results.",
-    nargs='?',
-    const='X',
-    type=str,
-    required=False,
-)
-argParser.add_argument(
-    "--maxdisplayresults",
-    help="Maximum number of results to display.",
-    required=False,
-)
-argParser.add_argument(
-    "--maxprice",
-    help="Maximum Price for the stock to be considered.",
-    required=False,
-)
-argParser.add_argument(
-    "--minprice",
-    help="Minimum Price for the stock to be considered.",
-    required=False,
-)
-argParser.add_argument(
-    "-o",
-    "--options",
-    help="Pass selected options in the <MainMenu>:<SubMenu>:<SubMenu>:etc. format. For example: ./pkscreenercli.py -a Y -o X:12:10 -e will run the screener with answer Y as default choice to questions and scan with menu choices: Scanners > Nifty (All Stocks) > Closing at least 2%% up since last 3 day",
-    required=False,
-)
-argParser.add_argument(
-    "-p",
-    "--prodbuild",
-    action="store_true",
-    help="Run in production-build mode",
-    required=False,
-)
-argParser.add_argument(
-    "--runintradayanalysis",
-    action="store_true",
-    help="Run analysis for morning vs EoD LTP values",
-    required=False,
-)
-argParser.add_argument(
-    "--simulate",
-    type=json.loads, # '{"isTrading":true,"currentDateTime":"2024-04-29 09:35:38"}'
-    help="Simulate various conditions",
-    required=False,
-)
-argParser.add_argument(
-    "--singlethread",
-    action="store_true",
-    help="Run analysis for debugging purposes in a single process, single threaded environment",
-    required=False,
-)
-argParser.add_argument(
-    "--systemlaunched",
-    action="store_true",
-    help="Indicator to show that this is a system launched screener, using os.system",
-    required=False,
-)
-argParser.add_argument(
-    "-t",
-    "--testbuild",
-    action="store_true",
-    help="Run in test-build mode",
-    required=False,
-)
-argParser.add_argument(
-    "--telegram",
-    action="store_true",
-    help="Run with an assumption that this instance is launched via telegram bot",
-    required=False,
-)
-argParser.add_argument(
-    "-u",
-    "--user",
-    help="Telegram user ID to whom the results must be sent.",
-    required=False,
-)
-argParser.add_argument(
-    "-l",
-    "--log",
-    action="store_true",
-    help="Run with full logging enabled",
-    required=False,
-)
-argParser.add_argument("-v", action="store_true")  # Dummy Arg for pytest -v
-argParser.add_argument(
-    "--pipedtitle",
-    help="Piped Titles",
-    required=False,
-)
-argParser.add_argument(
-    "--pipedmenus",
-    help="Piped Menus",
-    required=False,
-)
-argsv = argParser.parse_known_args()
-args = argsv[0]
-# if sys.argv[0].endswith(".py"):
-#     args.monitor = 'X'
-#     args.answerdefault = 'Y'
-results = None
-resultStocks = None
-plainResults = None
-start_time = None
-dbTimestamp = None
-elapsed_time = None
-configManager = ConfigManager.tools()
+if __name__ == "__main__":
+    # Argument Parsing for test purpose
+    argParser = argparse.ArgumentParser()
+    argParser.add_argument(
+        "-a",
+        "--answerdefault",
+        help="Pass default answer to questions/choices in the application. Example Y, N",
+        required=False,
+    )
+    argParser.add_argument(
+        "--backtestdaysago",
+        help="Run scanner for -b days ago from today.",
+        required=False,
+    )
+    argParser.add_argument(
+        "--barometer",
+        action="store_true",
+        help="Send global market barometer to telegram channel or a user",
+        required=False,
+    )
+    argParser.add_argument(
+        "--bot",
+        action="store_true",
+        help="Run only in telegram bot mode",
+        required=False,
+    )
+    argParser.add_argument(
+        "--botavailable",
+        action="store_true",
+        help="Enforce whether bot is going to be available or not.",
+        required=False,
+    )
+    argParser.add_argument(
+        "-c",
+        "--croninterval",
+        help="Pass interval in seconds to wait before the program is run again with same parameters",
+        required=False,
+    )
+    argParser.add_argument(
+        "-d",
+        "--download",
+        action="store_true",
+        help="Only download Stock data in .pkl file (No analysis will be run)",
+        required=False,
+    )
+    argParser.add_argument(
+        "-e",
+        "--exit",
+        action="store_true",
+        help="Exit right after executing just once",
+        required=False,
+    )
+    argParser.add_argument(
+        "--forceBacktestsForZeroResultDays",
+        help="Force run the backtests even for those days when we already have zero results saved in the repo",
+        action=argparse.BooleanOptionalAction,
+    )
+    argParser.add_argument(
+        "-i",
+        "--intraday",
+        help="Use Intraday configurations and use the candlestick duration that is passed. Acceptable values 1m, 5m, 10m, 15m, 1h etc.",
+        required=False,
+    )
+    argParser.add_argument(
+        "-m",
+        "--monitor",
+        help="Monitor for intraday scanners and their results.",
+        nargs='?',
+        const='X',
+        type=str,
+        required=False,
+    )
+    argParser.add_argument(
+        "--maxdisplayresults",
+        help="Maximum number of results to display.",
+        required=False,
+    )
+    argParser.add_argument(
+        "--maxprice",
+        help="Maximum Price for the stock to be considered.",
+        required=False,
+    )
+    argParser.add_argument(
+        "--minprice",
+        help="Minimum Price for the stock to be considered.",
+        required=False,
+    )
+    argParser.add_argument(
+        "-o",
+        "--options",
+        help="Pass selected options in the <MainMenu>:<SubMenu>:<SubMenu>:etc. format. For example: ./pkscreenercli.py -a Y -o X:12:10 -e will run the screener with answer Y as default choice to questions and scan with menu choices: Scanners > Nifty (All Stocks) > Closing at least 2%% up since last 3 day",
+        required=False,
+    )
+    argParser.add_argument(
+        "-p",
+        "--prodbuild",
+        action="store_true",
+        help="Run in production-build mode",
+        required=False,
+    )
+    argParser.add_argument(
+        "--runintradayanalysis",
+        action="store_true",
+        help="Run analysis for morning vs EoD LTP values",
+        required=False,
+    )
+    argParser.add_argument(
+        "--simulate",
+        type=json.loads, # '{"isTrading":true,"currentDateTime":"2024-04-29 09:35:38"}'
+        help="Simulate various conditions",
+        required=False,
+    )
+    argParser.add_argument(
+        "--singlethread",
+        action="store_true",
+        help="Run analysis for debugging purposes in a single process, single threaded environment",
+        required=False,
+    )
+    argParser.add_argument(
+        "--systemlaunched",
+        action="store_true",
+        help="Indicator to show that this is a system launched screener, using os.system",
+        required=False,
+    )
+    argParser.add_argument(
+        "-t",
+        "--testbuild",
+        action="store_true",
+        help="Run in test-build mode",
+        required=False,
+    )
+    argParser.add_argument(
+        "--telegram",
+        action="store_true",
+        help="Run with an assumption that this instance is launched via telegram bot",
+        required=False,
+    )
+    argParser.add_argument(
+        "-u",
+        "--user",
+        help="Telegram user ID to whom the results must be sent.",
+        required=False,
+    )
+    argParser.add_argument(
+        "-l",
+        "--log",
+        action="store_true",
+        help="Run with full logging enabled",
+        required=False,
+    )
+    argParser.add_argument("-v", action="store_true")  # Dummy Arg for pytest -v
+    argParser.add_argument(
+        "--pipedtitle",
+        help="Piped Titles",
+        required=False,
+    )
+    argParser.add_argument(
+        "--pipedmenus",
+        help="Piped Menus",
+        required=False,
+    )
+    argsv = argParser.parse_known_args()
+    args = argsv[0]
+    # if sys.argv[0].endswith(".py"):
+    #     args.monitor = 'X'
+    #     args.answerdefault = 'Y'
+    results = None
+    resultStocks = None
+    plainResults = None
+    start_time = None
+    dbTimestamp = None
+    elapsed_time = None
+    configManager = ConfigManager.tools()
 
 def exitGracefully():
     from PKDevTools.classes import Archiver
     from pkscreener.globals import resetConfigToDefault
     filePath = os.path.join(Archiver.get_user_outputs_dir(), "monitor_outputs")
     index = 0
     while index < configManager.maxDashboardWidgetsPerRow*configManager.maxNumResultRowsInMonitor:
```

### Comparing `pkscreener-0.45.20240528.420/pkscreener.egg-info/PKG-INFO` & `pkscreener-0.45.20240529.421/pkscreener.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 Metadata-Version: 2.1
 Name: pkscreener
-Version: 0.45.20240528.420
+Version: 0.45.20240529.421
 Summary: A Python-based stock screener for NSE, India with alerts to Telegram Channel (pkscreener)
 Home-page: https://github.com/pkjmesra/pkscreener
-Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240528.420.zip
+Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240529.421.zip
 Author: pkjmesra
 Author-email: pkjmesra@gmail.com
 License: OSI Approved (MIT)
 Keywords: NSE,Technical Indicators,Scanning,Stock Scanners
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: Microsoft :: Windows
 Classifier: Operating System :: MacOS
@@ -274,19 +274,19 @@
 * Always backtest and analyze the stocks manually before you trade.
 * The Author(s), the software and any related/unrelated entity will not be held liable for your own investing decisions or losses. The authors or this softfware does not make any claim about the correctness of the results.
 * This screener began as a [fork](https://github.com/pranjal-joshi/Screeni-py) but has since added a lot of additional scanners, backtesting, Telegram bots, Alerts and a number of modifications and improvements.
 
 [MADE-IN-INDIA-badge]: https://img.shields.io/badge/MADE%20WITH%20%E2%9D%A4%20IN-INDIA-orange
 [MADE-IN-INDIA]: https://en.wikipedia.org/wiki/India
 [Windows-badge]: https://img.shields.io/badge/Windows-0078D6?logo=windows&logoColor=white
-[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240527.419/pkscreenercli.exe
+[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240528.420/pkscreenercli.exe
 [Linux-badge]: https://img.shields.io/badge/Linux-FCC624?logo=linux&logoColor=black
-[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240527.419/pkscreenercli.bin
+[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240528.420/pkscreenercli.bin
 [Mac OS-badge]: https://img.shields.io/badge/mac%20os-D3D3D3?logo=apple&logoColor=000000
-[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240527.419/pkscreenercli.run
+[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240528.420/pkscreenercli.run
 [GitHub release (latest by date)-badge]: https://img.shields.io/github/v/release/pkjmesra/PKScreener
 [GitHub release (latest by date)]: https://github.com/pkjmesra/PKScreener/releases/latest
 [pypi-badge]: https://img.shields.io/pypi/v/pkscreener.svg?style=flat-square
 [pypi]: https://pypi.python.org/pypi/pkscreener
 [wheel-badge]: https://img.shields.io/pypi/wheel/pkscreener.svg?style=flat-square
 [GitHub all releases]: https://img.shields.io/github/downloads/pkjmesra/PKScreener/total?color=Green&label=Downloads&style=for-the-badge
 [License-badge]: https://img.shields.io/github/license/pkjmesra/PKScreener?style=for-the-badge
```

### Comparing `pkscreener-0.45.20240528.420/pkscreener.egg-info/SOURCES.txt` & `pkscreener-0.45.20240529.421/pkscreener.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240528.420/setup.py` & `pkscreener-0.45.20240529.421/setup.py`

 * *Files identical despite different names*

