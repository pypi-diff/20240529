# Comparing `tmp/dothttp_req-0.0.8-py3-none-any.whl.zip` & `tmp/dothttp_req-0.0.9-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,44 +1,47 @@
-Zip file size: 62160 bytes, number of entries: 42
+Zip file size: 66502 bytes, number of entries: 45
 -rw-rw-r--  2.0 unx        0 b- defN 21-Feb-22 09:26 dotextensions/__init__.py
 -rw-rw-r--  2.0 unx     5359 b- defN 21-Mar-01 15:53 dotextensions/server.py
 -rw-rw-r--  2.0 unx      512 b- defN 21-Feb-22 09:26 dotextensions/server/__init__.py
 -rw-rw-r--  2.0 unx      835 b- defN 21-Feb-22 09:26 dotextensions/server/__main__.py
--rw-rw-r--  2.0 unx    13586 b- defN 21-Mar-07 00:50 dotextensions/server/commands.py
--rw-rw-r--  2.0 unx     3321 b- defN 21-Mar-07 01:30 dotextensions/server/server.py
+-rw-rw-r--  2.0 unx    13586 b- defN 21-Mar-20 16:08 dotextensions/server/commands.py
+-rw-rw-r--  2.0 unx     3321 b- defN 21-Mar-20 16:08 dotextensions/server/server.py
 -rw-rw-r--  2.0 unx    56120 b- defN 21-Mar-02 21:15 dotextensions/server/postman/__init__.py
 -rw-rw-r--  2.0 unx      449 b- defN 21-Mar-05 01:40 dotextensions/server/symbols/__init__.py
--rw-rw-r--  2.0 unx    29560 b- defN 21-Mar-07 00:50 dothttp/__init__.py
+-rw-rw-r--  2.0 unx    26524 b- defN 21-Mar-20 16:08 dothttp/__init__.py
 -rw-rw-r--  2.0 unx     3880 b- defN 21-Feb-22 09:26 dothttp/__main__.py
 -rw-rw-r--  2.0 unx      982 b- defN 21-Feb-26 05:53 dothttp/curl_utils.py
--rw-rw-r--  2.0 unx     1832 b- defN 21-Mar-06 06:28 dothttp/dsl_jsonparser.py
+-rw-rw-r--  2.0 unx     1817 b- defN 21-Mar-20 16:08 dothttp/dsl_jsonparser.py
 -rw-rw-r--  2.0 unx     2063 b- defN 21-Feb-22 09:26 dothttp/exceptions.py
--rw-rw-r--  2.0 unx     2357 b- defN 21-Mar-06 06:28 dothttp/http.tx
+-rw-rw-r--  2.0 unx     2363 b- defN 21-Mar-20 16:08 dothttp/http.tx
 -rw-rw-r--  2.0 unx      259 b- defN 21-Feb-22 09:26 dothttp/log_utils.py
--rw-rw-r--  2.0 unx     1100 b- defN 21-Mar-07 00:50 dothttp/parse_models.py
--rw-rw-r--  2.0 unx      267 b- defN 21-Feb-22 09:26 dothttp/property_schema.py
--rw-rw-r--  2.0 unx    29560 b- defN 21-Mar-07 00:50 dothttp_req/__init__.py
+-rw-rw-r--  2.0 unx     1100 b- defN 21-Mar-20 16:08 dothttp/parse_models.py
+-rw-rw-r--  2.0 unx      328 b- defN 21-Mar-18 15:59 dothttp/property_schema.py
+-rw-rw-r--  2.0 unx     7738 b- defN 21-Mar-19 18:22 dothttp/property_util.py
+-rw-rw-r--  2.0 unx    26524 b- defN 21-Mar-20 16:08 dothttp_req/__init__.py
 -rw-rw-r--  2.0 unx     3880 b- defN 21-Feb-22 09:26 dothttp_req/__main__.py
 -rw-rw-r--  2.0 unx      982 b- defN 21-Feb-26 05:53 dothttp_req/curl_utils.py
--rw-rw-r--  2.0 unx     1832 b- defN 21-Mar-06 06:28 dothttp_req/dsl_jsonparser.py
+-rw-rw-r--  2.0 unx     1817 b- defN 21-Mar-20 16:08 dothttp_req/dsl_jsonparser.py
 -rw-rw-r--  2.0 unx     2063 b- defN 21-Feb-22 09:26 dothttp_req/exceptions.py
--rw-rw-r--  2.0 unx     2357 b- defN 21-Mar-06 06:28 dothttp_req/http.tx
+-rw-rw-r--  2.0 unx     2363 b- defN 21-Mar-20 16:08 dothttp_req/http.tx
 -rw-rw-r--  2.0 unx      259 b- defN 21-Feb-22 09:26 dothttp_req/log_utils.py
--rw-rw-r--  2.0 unx     1100 b- defN 21-Mar-07 00:50 dothttp_req/parse_models.py
--rw-rw-r--  2.0 unx      267 b- defN 21-Feb-22 09:26 dothttp_req/property_schema.py
--rw-rw-r--  2.0 unx     1253 b- defN 21-Feb-22 09:26 test/__init__.py
+-rw-rw-r--  2.0 unx     1100 b- defN 21-Mar-20 16:08 dothttp_req/parse_models.py
+-rw-rw-r--  2.0 unx      328 b- defN 21-Mar-18 15:59 dothttp_req/property_schema.py
+-rw-rw-r--  2.0 unx     7738 b- defN 21-Mar-19 18:22 dothttp_req/property_util.py
+-rw-rw-r--  2.0 unx     1253 b- defN 21-Mar-18 12:58 test/__init__.py
 -rw-rw-r--  2.0 unx        0 b- defN 21-Feb-22 09:26 test/core/__init__.py
 -rw-rw-r--  2.0 unx     2284 b- defN 21-Feb-22 09:26 test/core/test_exceptions.py
 -rw-rw-r--  2.0 unx     2873 b- defN 21-Mar-06 06:28 test/core/test_multidef_http.py
 -rw-rw-r--  2.0 unx     6443 b- defN 21-Feb-27 05:09 test/core/test_payload.py
--rw-rw-r--  2.0 unx     5625 b- defN 21-Mar-06 06:28 test/core/test_request.py
--rw-rw-r--  2.0 unx     6501 b- defN 21-Mar-07 00:50 test/core/test_substition.py
+-rw-rw-r--  2.0 unx     3660 b- defN 21-Mar-18 13:47 test/core/test_random_substition.py
+-rw-rw-r--  2.0 unx     5615 b- defN 21-Mar-20 16:08 test/core/test_request.py
+-rw-rw-r--  2.0 unx     6825 b- defN 21-Mar-20 16:08 test/core/test_substition.py
 -rw-rw-r--  2.0 unx     2958 b- defN 21-Feb-27 05:09 test/core/test_target.py
 -rw-rw-r--  2.0 unx        0 b- defN 21-Feb-22 09:26 test/extensions/__init__.py
 -rw-rw-r--  2.0 unx     4882 b- defN 21-Feb-22 09:26 test/extensions/commands.py
--rw-rw-r--  2.0 unx    11357 b- defN 21-Mar-07 01:37 dothttp_req-0.0.8.dist-info/LICENSE.txt
--rw-rw-r--  2.0 unx     9418 b- defN 21-Mar-07 01:37 dothttp_req-0.0.8.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 21-Mar-07 01:37 dothttp_req-0.0.8.dist-info/WHEEL
--rw-rw-r--  2.0 unx       51 b- defN 21-Mar-07 01:37 dothttp_req-0.0.8.dist-info/entry_points.txt
--rw-rw-r--  2.0 unx       39 b- defN 21-Mar-07 01:37 dothttp_req-0.0.8.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     3468 b- defN 21-Mar-07 01:37 dothttp_req-0.0.8.dist-info/RECORD
-42 files, 222026 bytes uncompressed, 56652 bytes compressed:  74.5%
+-rw-rw-r--  2.0 unx    11357 b- defN 21-Mar-20 16:17 dothttp_req-0.0.9.dist-info/LICENSE.txt
+-rw-rw-r--  2.0 unx     9418 b- defN 21-Mar-20 16:17 dothttp_req-0.0.9.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 21-Mar-20 16:17 dothttp_req-0.0.9.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       51 b- defN 21-Mar-20 16:17 dothttp_req-0.0.9.dist-info/entry_points.txt
+-rw-rw-r--  2.0 unx       39 b- defN 21-Mar-20 16:17 dothttp_req-0.0.9.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     3726 b- defN 21-Mar-20 16:17 dothttp_req-0.0.9.dist-info/RECORD
+45 files, 235766 bytes uncompressed, 60592 bytes compressed:  74.3%
```

## zipnote {}

```diff
@@ -45,14 +45,17 @@
 
 Filename: dothttp/parse_models.py
 Comment: 
 
 Filename: dothttp/property_schema.py
 Comment: 
 
+Filename: dothttp/property_util.py
+Comment: 
+
 Filename: dothttp_req/__init__.py
 Comment: 
 
 Filename: dothttp_req/__main__.py
 Comment: 
 
 Filename: dothttp_req/curl_utils.py
@@ -72,14 +75,17 @@
 
 Filename: dothttp_req/parse_models.py
 Comment: 
 
 Filename: dothttp_req/property_schema.py
 Comment: 
 
+Filename: dothttp_req/property_util.py
+Comment: 
+
 Filename: test/__init__.py
 Comment: 
 
 Filename: test/core/__init__.py
 Comment: 
 
 Filename: test/core/test_exceptions.py
@@ -87,14 +93,17 @@
 
 Filename: test/core/test_multidef_http.py
 Comment: 
 
 Filename: test/core/test_payload.py
 Comment: 
 
+Filename: test/core/test_random_substition.py
+Comment: 
+
 Filename: test/core/test_request.py
 Comment: 
 
 Filename: test/core/test_substition.py
 Comment: 
 
 Filename: test/core/test_target.py
@@ -102,26 +111,26 @@
 
 Filename: test/extensions/__init__.py
 Comment: 
 
 Filename: test/extensions/commands.py
 Comment: 
 
-Filename: dothttp_req-0.0.8.dist-info/LICENSE.txt
+Filename: dothttp_req-0.0.9.dist-info/LICENSE.txt
 Comment: 
 
-Filename: dothttp_req-0.0.8.dist-info/METADATA
+Filename: dothttp_req-0.0.9.dist-info/METADATA
 Comment: 
 
-Filename: dothttp_req-0.0.8.dist-info/WHEEL
+Filename: dothttp_req-0.0.9.dist-info/WHEEL
 Comment: 
 
-Filename: dothttp_req-0.0.8.dist-info/entry_points.txt
+Filename: dothttp_req-0.0.9.dist-info/entry_points.txt
 Comment: 
 
-Filename: dothttp_req-0.0.8.dist-info/top_level.txt
+Filename: dothttp_req-0.0.9.dist-info/top_level.txt
 Comment: 
 
-Filename: dothttp_req-0.0.8.dist-info/RECORD
+Filename: dothttp_req-0.0.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## dothttp/__init__.py

```diff
@@ -18,14 +18,20 @@
 
 from .curl_utils import to_curl
 from .dsl_jsonparser import json_or_array_to_json
 from .exceptions import *
 from .exceptions import PropertyNotFoundException
 from .parse_models import Allhttp
 from .property_schema import property_schema
+from .property_util import PropertyProvider
+
+try:
+    import magic
+except ImportError:
+    magic = None
 
 try:
     import magic
 except ImportError:
     magic = None
 
 FORM_URLENCODED = "application/x-www-form-urlencoded"
@@ -160,51 +166,52 @@
                     base_logger.error(f'property json schema validation failed! ', exc_info=True)
                     raise PropertyFileException(message="property file has invalid json schema",
                                                 file=self.property_file)
 
         else:
             props = {}
         self.default_headers.update(props.get('headers', {}))
-        self.properties.update(props.get("*", {}))
+        self.property_util.add_env_property_from_dict(props.get("*", {}))
         if self.env:
             for env_name in self.env:
-                self.properties.update(props.get(env_name, {}))
-
-        return self.properties
+                self.property_util.add_env_property_from_dict(props.get(env_name, {}))
 
     def __init__(self, args: Config):
         self.args = args
         self.file = args.file
-        self.command_line_props = {}
-        self.properties = {}
         # dev can define default headers, which dev dont want to do it for all requests
         # in most scenarios, headers are either computed or common across all other requests
         # best syntax would be headers section of property file will define default headers
         self.default_headers = {}
         self.property_file = args.property_file
         self.env = args.env
         self.content = ''
         self.original_content = self.content = ''
+        self.property_util = PropertyProvider(self.property_file)
         self.load()
 
     def load(self):
         self.load_content()
         self.load_model()
         self.load_properties_n_headers()
         self.load_command_line_props()
         self.validate_names()
         self.load_props_needed_for_content()
         self.select_target()
 
     def load_command_line_props(self):
         for prop in self.args.properties:
             try:
-                key, value = prop.split("=")
+                index = prop.find("=")
+                if index == -1:
+                    raise
+                key = prop[:index]
+                value = prop[index + 1:]
                 base_logger.debug(f"detected command line property {key} value: {value}")
-                self.command_line_props[key] = value
+                self.property_util.add_command_property(key, value)
             except:
                 raise CommandLinePropError(prop=prop)
 
     def load_model(self):
         # textx has provided utility to load model metamodel.model_from_file(args.file)
         # but we had variable options, and it has to be dynamically populated
         try:
@@ -217,99 +224,19 @@
 
     def load_content(self):
         if not os.path.exists(self.file):
             raise HttpFileNotFoundException(file=self.file)
         with open(self.file, 'r') as f:
             self.original_content = self.content = f.read()
 
-    @staticmethod
-    def validate_n_gen(prop, cache: Dict[str, Property]):
-        p: Union[Property, None] = None
-        if '=' in prop:
-            key_values = prop.split('=')
-            if len(key_values) != 2:
-                raise HttpFileException(message='default property should not have multiple `=`')
-            key, value = key_values
-            # strip white space for keys
-            key = key.strip()
-
-            # strip white space for values
-            value = value.strip()
-            if value and value[0] == value[-1] and value[0] in {"'", '"'}:
-                # strip "'" "'" if it has any
-                # like ranga=" ramprasad" --> we should replace with " ramprasad"
-                value = value[1:-1]
-            if key in cache:
-                if cache[key].value and value != cache[key].value:
-                    raise HttpFileException(
-                        message=f'property: `{key}` is defaulted with two/more different values, panicked ')
-                p = cache[key]
-                p.text.append(prop)
-                p.value = value
-            else:
-                p = Property([prop], key, value)
-            cache.setdefault(key, p)
-        else:
-            if prop in cache:
-                cache[prop].text.append(prop)
-            else:
-                p = Property([prop])
-                cache.setdefault(prop, p)
-        return p
-
-    def get_most_possible_val(self, var):
-        args = self.command_line_props.get(var), self.properties.get(var), self.prop_cache[var].value
-        for arg in args:
-            if arg is not None:
-                return arg
-
     def get_updated_content(self, content) -> str:
-        """
-            1. properties defined in file itself ({{a=10}})
-                allowed values are
-                {{ a=ranga}} {{a=ranga }} {{ a=ranga }} {{ a="ranga" }} {{ a='ranga' }}
-                a=ranga for all above
-                {{ a="ranga "}}
-                in above case whitespace is considered
-            2. properties from command line
-            3. properties from file's activated env
-            4. properties from files's '*'
-        :return:
-        """
-        prop_cache = self.prop_cache
-
-        content_prop_needed = self.get_declared_props(content)
-        props_needed = set(content_prop_needed.keys())
+        return self.property_util.get_updated_content(content)
 
-        missing_props = props_needed - self.get_props_available()
-        if len(missing_props) != 0:
-            raise PropertyNotFoundException(
-                var=missing_props, propertyfile=self.property_file if self.property_file else "not specified")
-        for var in props_needed:
-            # command line props take preference
-            value = self.get_most_possible_val(var)
-            base_logger.debug(f'using `{value}` for property {var}')
-            for text_to_replace in content_prop_needed[var].text:
-                content = content.replace("{{" + text_to_replace + "}}", value)
-        return content
-
-    @functools.lru_cache
-    def get_props_available(self):
-        return set(self.properties.keys()).union(set(self.command_line_props.keys())).union(set(
-            key for key in self.prop_cache if self.prop_cache[key].value is not None))
-
-    def load_props_needed_for_content(self):
-        self.prop_cache = self.get_declared_props(self.content)
-
-    def get_declared_props(self, content):
-        out = BaseModelProcessor.var_regex.findall(content)
-        base_logger.debug(f'property used in `{self.file}` are `{out}`')
-        prop_cache: Dict[str, Property] = {}
-        tuple(self.validate_n_gen(x, prop_cache) for x in out if x)  # generates prop_cache, this could be done better
-        return prop_cache
+    def get_updated_content_object(self, content) -> str:
+        return self.property_util.get_updated_content(content, 'obj')
 
     def select_target(self):
         if target := self.args.target:
             if not isinstance(target, str):
                 target = str(target)
             if target.isdecimal():
                 if 1 <= int(target) <= len(self.model.allhttps):
@@ -334,14 +261,17 @@
         for index, http in enumerate(self.model.allhttps):
             name = http.namewrap.name if http.namewrap else str(index + 1)
             if name in names:
                 raise HttpFileException(message=f"target: `{name}` appeared twice or more. panicked while processing")
             names.append(name)
             names.append(str(index + 1))
 
+    def load_props_needed_for_content(self):
+        self.property_util.add_infile_properties(self.content)
+
 
 class RequestBase(BaseModelProcessor):
     def __init__(self, args: Config):
         super().__init__(args)
         self._cookie: Union[LWPCookieJar, None] = None
         self.httpdef = HttpDef()
         self._loaded = False
@@ -534,14 +464,15 @@
         self.load_url()
         self.load_headers()
         self.load_query()
         self.load_payload()
         self.load_auth()
         self._loaded = True
 
+    @functools.lru_cache
     def get_request(self):
         prep = self.get_request_notbody()
         payload = self.httpdef.payload
         prep.prepare_body(data=payload.data, json=payload.json, files=payload.files)
         # prep.prepare_hooks({"response": self.save_cookie_call_back})
         if payload.header and CONTENT_TYPE not in prep.headers:
             # if content-type is provided by header
```

## dothttp/dsl_jsonparser.py

```diff
@@ -19,15 +19,15 @@
             member in
             json_object.members}
 
 
 def get_key(member, update_content_func):
     if member.key:
         return update_content_func(member.key)
-    return get_json_data(member.var, update_content_func)
+    return update_content_func(member.var)
 
 
 def jsonmodel_to_json(model, update_content_func):
     if str_value := model.str:
         return update_content_func(str_value.value)
     elif var_value := model.var:
         return get_json_data(var_value, update_content_func)
```

## dothttp/http.tx

```diff
@@ -111,15 +111,15 @@
 ;
 
 CommentBlock:
     /\/\*(.|\n)*?\*\//
 ;
 
 VarString:
-    "{{" /\w+/ ("="  (/\w+/ | STRING))? "}}"
+    "{{" /[\w,$,:]+/ ("="  (/\w+/ | STRING))? "}}"
 ;
 
 DotString:
     STRING | /\w+/
 ;
 // allow only alphanumeric or string in double/single quotes
```

## dothttp/property_schema.py

```diff
@@ -1,13 +1,13 @@
 property_schema = {
     "type": "object",
     "patternProperties": {
         "\\w*$": {
             "type": "object",
             "patternProperties": {
                 "\\w*$": {
-                    "type": "string"
+                    "type": ["number", "string", "object", "array", "null", "boolean", "integer"]
                 }
             }
         }
     }
 }
```

## dothttp_req/__init__.py

```diff
@@ -18,14 +18,20 @@
 
 from .curl_utils import to_curl
 from .dsl_jsonparser import json_or_array_to_json
 from .exceptions import *
 from .exceptions import PropertyNotFoundException
 from .parse_models import Allhttp
 from .property_schema import property_schema
+from .property_util import PropertyProvider
+
+try:
+    import magic
+except ImportError:
+    magic = None
 
 try:
     import magic
 except ImportError:
     magic = None
 
 FORM_URLENCODED = "application/x-www-form-urlencoded"
@@ -160,51 +166,52 @@
                     base_logger.error(f'property json schema validation failed! ', exc_info=True)
                     raise PropertyFileException(message="property file has invalid json schema",
                                                 file=self.property_file)
 
         else:
             props = {}
         self.default_headers.update(props.get('headers', {}))
-        self.properties.update(props.get("*", {}))
+        self.property_util.add_env_property_from_dict(props.get("*", {}))
         if self.env:
             for env_name in self.env:
-                self.properties.update(props.get(env_name, {}))
-
-        return self.properties
+                self.property_util.add_env_property_from_dict(props.get(env_name, {}))
 
     def __init__(self, args: Config):
         self.args = args
         self.file = args.file
-        self.command_line_props = {}
-        self.properties = {}
         # dev can define default headers, which dev dont want to do it for all requests
         # in most scenarios, headers are either computed or common across all other requests
         # best syntax would be headers section of property file will define default headers
         self.default_headers = {}
         self.property_file = args.property_file
         self.env = args.env
         self.content = ''
         self.original_content = self.content = ''
+        self.property_util = PropertyProvider(self.property_file)
         self.load()
 
     def load(self):
         self.load_content()
         self.load_model()
         self.load_properties_n_headers()
         self.load_command_line_props()
         self.validate_names()
         self.load_props_needed_for_content()
         self.select_target()
 
     def load_command_line_props(self):
         for prop in self.args.properties:
             try:
-                key, value = prop.split("=")
+                index = prop.find("=")
+                if index == -1:
+                    raise
+                key = prop[:index]
+                value = prop[index + 1:]
                 base_logger.debug(f"detected command line property {key} value: {value}")
-                self.command_line_props[key] = value
+                self.property_util.add_command_property(key, value)
             except:
                 raise CommandLinePropError(prop=prop)
 
     def load_model(self):
         # textx has provided utility to load model metamodel.model_from_file(args.file)
         # but we had variable options, and it has to be dynamically populated
         try:
@@ -217,99 +224,19 @@
 
     def load_content(self):
         if not os.path.exists(self.file):
             raise HttpFileNotFoundException(file=self.file)
         with open(self.file, 'r') as f:
             self.original_content = self.content = f.read()
 
-    @staticmethod
-    def validate_n_gen(prop, cache: Dict[str, Property]):
-        p: Union[Property, None] = None
-        if '=' in prop:
-            key_values = prop.split('=')
-            if len(key_values) != 2:
-                raise HttpFileException(message='default property should not have multiple `=`')
-            key, value = key_values
-            # strip white space for keys
-            key = key.strip()
-
-            # strip white space for values
-            value = value.strip()
-            if value and value[0] == value[-1] and value[0] in {"'", '"'}:
-                # strip "'" "'" if it has any
-                # like ranga=" ramprasad" --> we should replace with " ramprasad"
-                value = value[1:-1]
-            if key in cache:
-                if cache[key].value and value != cache[key].value:
-                    raise HttpFileException(
-                        message=f'property: `{key}` is defaulted with two/more different values, panicked ')
-                p = cache[key]
-                p.text.append(prop)
-                p.value = value
-            else:
-                p = Property([prop], key, value)
-            cache.setdefault(key, p)
-        else:
-            if prop in cache:
-                cache[prop].text.append(prop)
-            else:
-                p = Property([prop])
-                cache.setdefault(prop, p)
-        return p
-
-    def get_most_possible_val(self, var):
-        args = self.command_line_props.get(var), self.properties.get(var), self.prop_cache[var].value
-        for arg in args:
-            if arg is not None:
-                return arg
-
     def get_updated_content(self, content) -> str:
-        """
-            1. properties defined in file itself ({{a=10}})
-                allowed values are
-                {{ a=ranga}} {{a=ranga }} {{ a=ranga }} {{ a="ranga" }} {{ a='ranga' }}
-                a=ranga for all above
-                {{ a="ranga "}}
-                in above case whitespace is considered
-            2. properties from command line
-            3. properties from file's activated env
-            4. properties from files's '*'
-        :return:
-        """
-        prop_cache = self.prop_cache
-
-        content_prop_needed = self.get_declared_props(content)
-        props_needed = set(content_prop_needed.keys())
+        return self.property_util.get_updated_content(content)
 
-        missing_props = props_needed - self.get_props_available()
-        if len(missing_props) != 0:
-            raise PropertyNotFoundException(
-                var=missing_props, propertyfile=self.property_file if self.property_file else "not specified")
-        for var in props_needed:
-            # command line props take preference
-            value = self.get_most_possible_val(var)
-            base_logger.debug(f'using `{value}` for property {var}')
-            for text_to_replace in content_prop_needed[var].text:
-                content = content.replace("{{" + text_to_replace + "}}", value)
-        return content
-
-    @functools.lru_cache
-    def get_props_available(self):
-        return set(self.properties.keys()).union(set(self.command_line_props.keys())).union(set(
-            key for key in self.prop_cache if self.prop_cache[key].value is not None))
-
-    def load_props_needed_for_content(self):
-        self.prop_cache = self.get_declared_props(self.content)
-
-    def get_declared_props(self, content):
-        out = BaseModelProcessor.var_regex.findall(content)
-        base_logger.debug(f'property used in `{self.file}` are `{out}`')
-        prop_cache: Dict[str, Property] = {}
-        tuple(self.validate_n_gen(x, prop_cache) for x in out if x)  # generates prop_cache, this could be done better
-        return prop_cache
+    def get_updated_content_object(self, content) -> str:
+        return self.property_util.get_updated_content(content, 'obj')
 
     def select_target(self):
         if target := self.args.target:
             if not isinstance(target, str):
                 target = str(target)
             if target.isdecimal():
                 if 1 <= int(target) <= len(self.model.allhttps):
@@ -334,14 +261,17 @@
         for index, http in enumerate(self.model.allhttps):
             name = http.namewrap.name if http.namewrap else str(index + 1)
             if name in names:
                 raise HttpFileException(message=f"target: `{name}` appeared twice or more. panicked while processing")
             names.append(name)
             names.append(str(index + 1))
 
+    def load_props_needed_for_content(self):
+        self.property_util.add_infile_properties(self.content)
+
 
 class RequestBase(BaseModelProcessor):
     def __init__(self, args: Config):
         super().__init__(args)
         self._cookie: Union[LWPCookieJar, None] = None
         self.httpdef = HttpDef()
         self._loaded = False
@@ -534,14 +464,15 @@
         self.load_url()
         self.load_headers()
         self.load_query()
         self.load_payload()
         self.load_auth()
         self._loaded = True
 
+    @functools.lru_cache
     def get_request(self):
         prep = self.get_request_notbody()
         payload = self.httpdef.payload
         prep.prepare_body(data=payload.data, json=payload.json, files=payload.files)
         # prep.prepare_hooks({"response": self.save_cookie_call_back})
         if payload.header and CONTENT_TYPE not in prep.headers:
             # if content-type is provided by header
```

## dothttp_req/dsl_jsonparser.py

```diff
@@ -19,15 +19,15 @@
             member in
             json_object.members}
 
 
 def get_key(member, update_content_func):
     if member.key:
         return update_content_func(member.key)
-    return get_json_data(member.var, update_content_func)
+    return update_content_func(member.var)
 
 
 def jsonmodel_to_json(model, update_content_func):
     if str_value := model.str:
         return update_content_func(str_value.value)
     elif var_value := model.var:
         return get_json_data(var_value, update_content_func)
```

## dothttp_req/http.tx

```diff
@@ -111,15 +111,15 @@
 ;
 
 CommentBlock:
     /\/\*(.|\n)*?\*\//
 ;
 
 VarString:
-    "{{" /\w+/ ("="  (/\w+/ | STRING))? "}}"
+    "{{" /[\w,$,:]+/ ("="  (/\w+/ | STRING))? "}}"
 ;
 
 DotString:
     STRING | /\w+/
 ;
 // allow only alphanumeric or string in double/single quotes
```

## dothttp_req/property_schema.py

```diff
@@ -1,13 +1,13 @@
 property_schema = {
     "type": "object",
     "patternProperties": {
         "\\w*$": {
             "type": "object",
             "patternProperties": {
                 "\\w*$": {
-                    "type": "string"
+                    "type": ["number", "string", "object", "array", "null", "boolean", "integer"]
                 }
             }
         }
     }
 }
```

## test/core/test_request.py

```diff
@@ -47,15 +47,15 @@
     def test_output(self):
         with tempfile.NamedTemporaryFile() as f:
             req = self.get_req_comp(f"{base_dir}/output.http",
                                     properties=[f"file={f.name}"])
             req.run()
             data = f.read()
             self.assertIn(
-                b'curl "https://dothttp.azurewebsites.net/" \\\n    -X GET \\\n    -H "connection: Keep-Alive" \\\n    -H ',
+                b'curl "https://req.dothttp.dev/" \\\n    -X GET \\\n    -H "connection: Keep-Alive" \\\n    -H ',
                 data
             )
 
     def test_non200(self):
         req = self.get_req_comp(f"{base_dir}/non200.http", info=True)
         req.run()
```

## test/core/test_substition.py

```diff
@@ -52,14 +52,19 @@
         self.assertEqual(b'{"google.com": "google.com"}', req.body)
 
     def test_define_on_second_occurence(self):
         req: PreparedRequest = self.get_request(f"{base_dir}/definevariableonsecond.http")
         self.assertEqual("https://dothttp.dev/", req.url)
         self.assertEqual('dothttp.dev', req.body)
 
+    def test_object_substitution(self):
+        req: PreparedRequest = self.get_request(f"{base_dir}/envvariableswithjson.http", env=['env3'])
+        self.assertEqual(b'{"object": {"key": "value"}, "int": 3, "str": "str", "null": null, "true": t'
+                         b'rue, "false": false, "float": 1.23}', req.body)
+
     def test_substitute_one_by_one(self):
         # path
         req: PreparedRequest = self.get_request(f"{base_dir}/header_subs.http", properties=["path=get"])
         self.assertEqual("https://req.dothttp.dev/get", req.url)
 
         # header
         req2: PreparedRequest = self.get_request(f"{base_dir}/header_subs.http", properties=["path=get"],
```

## Comparing `dothttp_req-0.0.8.dist-info/LICENSE.txt` & `dothttp_req-0.0.9.dist-info/LICENSE.txt`

 * *Files identical despite different names*

## Comparing `dothttp_req-0.0.8.dist-info/METADATA` & `dothttp_req-0.0.9.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: dothttp-req
-Version: 0.0.8
+Version: 0.0.9
 Summary: DotHttp recommended tool for making http requests.
 Home-page: UNKNOWN
 Author: prasanth
 Author-email: kesavarapu.siva@gmail.com
 License: MIT
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
```

## Comparing `dothttp_req-0.0.8.dist-info/RECORD` & `dothttp_req-0.0.9.dist-info/RECORD`

 * *Files 10% similar despite different names*

```diff
@@ -2,41 +2,44 @@
 dotextensions/server.py,sha256=SwOht8K9oYjZ-WOrLy-7Yj4Fdwz6ATXynlLNi_jkfV4,5359
 dotextensions/server/__init__.py,sha256=1UveJI4KJvEApIUTZy2zMxzO31CIHYf9GBUBcHyqa3I,512
 dotextensions/server/__main__.py,sha256=LmhY9_IkYBXbP2OVIa56z71A9-l1fXH3D7WrM8J7bbU,835
 dotextensions/server/commands.py,sha256=KTuZ76kZIeAPjmJniT-6H1mYz1akiXKPO-omkfr0Vzw,13586
 dotextensions/server/server.py,sha256=KBY_Xj_dTtL01GC9Kcf14YfcidECZZqhaFIWl7bIbmc,3321
 dotextensions/server/postman/__init__.py,sha256=WWEasHMLqSFD2KP9Kk_lIidknX-3M-FaWijoLTKG4fM,56120
 dotextensions/server/symbols/__init__.py,sha256=rc51VhCvCCxmTHMdajEZKRZMPPiqpsK5yPhE0OLMZjo,449
-dothttp/__init__.py,sha256=PceMoZOAhkiIyo0CFkY89yu33VXvYfWWbH7_T7eRBX4,29560
+dothttp/__init__.py,sha256=i5qmgR91WCBTiJmtar87005f_MTRb-0HX64PSTkLIts,26524
 dothttp/__main__.py,sha256=p7GJwDHfnyjFEOtDCzjY214eJou8Fw5bhcBNaHaDW6k,3880
 dothttp/curl_utils.py,sha256=z1kuHzy-fjhQCsTihZugePi69aF5I_klS4KaGivVLL4,982
-dothttp/dsl_jsonparser.py,sha256=Od6PZmE2Tbe9oI6nsA0PAToXBG4u25qu5rR17oneZus,1832
+dothttp/dsl_jsonparser.py,sha256=GRSqIKpiQ8641fA1HRdJgMXUFmiSF0TbLkyc-_5YTxI,1817
 dothttp/exceptions.py,sha256=834Ld8gpUCcx6ktgo1FdyNyfySm4udXT5agGWzFc13M,2063
-dothttp/http.tx,sha256=WqwgH6-OxsvH7HdlyDF8q1Cgi6Oej2t48SdDqDG8H3Q,2357
+dothttp/http.tx,sha256=LyWzdKBFLuMgfySb2Vn7y7qfs9t41cSqLuqb_D95IgA,2363
 dothttp/log_utils.py,sha256=AHjmRcEf_i7xdBcqUeyv-kJNEutPzpc2QIkfDlzwLhU,259
 dothttp/parse_models.py,sha256=-dvrR8NLDe9qfPai5Cm_TEU5qTmnyJ-yYWR3RVI3-Mo,1100
-dothttp/property_schema.py,sha256=GnX3RLFOU3BSB7_KWzwVAQDNR1uZDSX1Hk36RJiJ4L4,267
-dothttp_req/__init__.py,sha256=PceMoZOAhkiIyo0CFkY89yu33VXvYfWWbH7_T7eRBX4,29560
+dothttp/property_schema.py,sha256=xP86QpX_xAsYkaQH6grKBh5FGJF5R9D5-M3ufsYkjNI,328
+dothttp/property_util.py,sha256=FskljMu7gd30BuhNTDHxldWQY_fP7PYeUaCMzFnux9I,7738
+dothttp_req/__init__.py,sha256=i5qmgR91WCBTiJmtar87005f_MTRb-0HX64PSTkLIts,26524
 dothttp_req/__main__.py,sha256=p7GJwDHfnyjFEOtDCzjY214eJou8Fw5bhcBNaHaDW6k,3880
 dothttp_req/curl_utils.py,sha256=z1kuHzy-fjhQCsTihZugePi69aF5I_klS4KaGivVLL4,982
-dothttp_req/dsl_jsonparser.py,sha256=Od6PZmE2Tbe9oI6nsA0PAToXBG4u25qu5rR17oneZus,1832
+dothttp_req/dsl_jsonparser.py,sha256=GRSqIKpiQ8641fA1HRdJgMXUFmiSF0TbLkyc-_5YTxI,1817
 dothttp_req/exceptions.py,sha256=834Ld8gpUCcx6ktgo1FdyNyfySm4udXT5agGWzFc13M,2063
-dothttp_req/http.tx,sha256=WqwgH6-OxsvH7HdlyDF8q1Cgi6Oej2t48SdDqDG8H3Q,2357
+dothttp_req/http.tx,sha256=LyWzdKBFLuMgfySb2Vn7y7qfs9t41cSqLuqb_D95IgA,2363
 dothttp_req/log_utils.py,sha256=AHjmRcEf_i7xdBcqUeyv-kJNEutPzpc2QIkfDlzwLhU,259
 dothttp_req/parse_models.py,sha256=-dvrR8NLDe9qfPai5Cm_TEU5qTmnyJ-yYWR3RVI3-Mo,1100
-dothttp_req/property_schema.py,sha256=GnX3RLFOU3BSB7_KWzwVAQDNR1uZDSX1Hk36RJiJ4L4,267
+dothttp_req/property_schema.py,sha256=xP86QpX_xAsYkaQH6grKBh5FGJF5R9D5-M3ufsYkjNI,328
+dothttp_req/property_util.py,sha256=FskljMu7gd30BuhNTDHxldWQY_fP7PYeUaCMzFnux9I,7738
 test/__init__.py,sha256=Ibd9wTIXndAXq5SPkRGj8v4La6umx9vS5Lx5Gl9zXFo,1253
 test/core/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 test/core/test_exceptions.py,sha256=TILSXj2EN_eIfJpZGiJ4Q8R-KK_MuhkhM5-5Y20m5Ic,2284
 test/core/test_multidef_http.py,sha256=_6pNkSi2nDGrdTIAj1UG4gKg_SeyQ9KX5IcxFvq1HXY,2873
 test/core/test_payload.py,sha256=pdKJLeEW6X7kHW68akAGT_S_ypFQreqtrTrRAeWJsQk,6443
-test/core/test_request.py,sha256=pRNQRtJC19gUX2Q1NavEl4oJw9y-3Z47133VKcxuw28,5625
-test/core/test_substition.py,sha256=QhKvmmtuyTYJFpOm8_UxsHM84L4FUr10PVcyzzYgflo,6501
+test/core/test_random_substition.py,sha256=l2GTX1tNx7iGWgigT3qEEttBGufihF4L_jeU9azyRAM,3660
+test/core/test_request.py,sha256=x8BRtS6vk3v9jOgGpA1qIPZ5uWrAccBXA4it8-dOA6Y,5615
+test/core/test_substition.py,sha256=imdnZYX4lnLR7spHwJR-1XS3KjCj4LyjqLbI2FAn9co,6825
 test/core/test_target.py,sha256=ak3vCzNfzjVdTiMeUUaaV3ijn4L_EmlWr1W2LPcRQv0,2958
 test/extensions/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 test/extensions/commands.py,sha256=xBogFSO7jb2cMhpHvWiZivYq5YIGzKeknZz1q2Mqtzs,4882
-dothttp_req-0.0.8.dist-info/LICENSE.txt,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
-dothttp_req-0.0.8.dist-info/METADATA,sha256=aKyU9lhawZI-uCktLIZTwHjnxc2VsvmFfSV-6KllG9I,9418
-dothttp_req-0.0.8.dist-info/WHEEL,sha256=OqRkF0eY5GHssMorFjlbTIq072vpHpF60fIQA6lS9xA,92
-dothttp_req-0.0.8.dist-info/entry_points.txt,sha256=COovPDHMvsSRkauCbouWZJ_V9cxQ1-rD4LBj5-rhocM,51
-dothttp_req-0.0.8.dist-info/top_level.txt,sha256=pVFUJkF7ngaomzyhVWbEZtLyGynF4KHv6ZX8fAFG_2s,39
-dothttp_req-0.0.8.dist-info/RECORD,,
+dothttp_req-0.0.9.dist-info/LICENSE.txt,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
+dothttp_req-0.0.9.dist-info/METADATA,sha256=A-Z4Ci22tLPJ6Q_H2HqbNSv9464qUiz2m0qq7JojGms,9418
+dothttp_req-0.0.9.dist-info/WHEEL,sha256=OqRkF0eY5GHssMorFjlbTIq072vpHpF60fIQA6lS9xA,92
+dothttp_req-0.0.9.dist-info/entry_points.txt,sha256=COovPDHMvsSRkauCbouWZJ_V9cxQ1-rD4LBj5-rhocM,51
+dothttp_req-0.0.9.dist-info/top_level.txt,sha256=pVFUJkF7ngaomzyhVWbEZtLyGynF4KHv6ZX8fAFG_2s,39
+dothttp_req-0.0.9.dist-info/RECORD,,
```

